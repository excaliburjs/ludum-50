{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","lib/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","lib/excalibur/build/dist/node_modules/core-js/es/array/sort.js","lib/excalibur/build/dist/node_modules/core-js/es/object/keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/a-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/an-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-includes.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-method-is-strict.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-slice-simple.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-sort.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof-raw.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof.js","lib/excalibur/build/dist/node_modules/core-js/internals/copy-constructor-properties.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-non-enumerable-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/descriptors.js","lib/excalibur/build/dist/node_modules/core-js/internals/document-create-element.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-ff-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-is-ie-or-edge.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-user-agent.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-v8-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-webkit-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/entry-unbind.js","lib/excalibur/build/dist/node_modules/core-js/internals/enum-bug-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/export.js","lib/excalibur/build/dist/node_modules/core-js/internals/fails.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-bind-native.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-call.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-name.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-uncurry-this.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-built-in.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-method.js","lib/excalibur/build/dist/node_modules/core-js/internals/global.js","lib/excalibur/build/dist/node_modules/core-js/internals/has-own-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/hidden-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/ie8-dom-define.js","lib/excalibur/build/dist/node_modules/core-js/internals/indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/inspect-source.js","lib/excalibur/build/dist/node_modules/core-js/internals/internal-state.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-forced.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-pure.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/length-of-array-like.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-weak-map.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-define-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-names.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-symbols.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-is-prototype-of.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys-internal.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-property-is-enumerable.js","lib/excalibur/build/dist/node_modules/core-js/internals/ordinary-to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/own-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/path.js","lib/excalibur/build/dist/node_modules/core-js/internals/redefine.js","lib/excalibur/build/dist/node_modules/core-js/internals/require-object-coercible.js","lib/excalibur/build/dist/node_modules/core-js/internals/set-global.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-store.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-absolute-index.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-integer-or-infinity.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-length.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-property-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string-tag-support.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/try-to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/use-symbol-as-uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/v8-prototype-define-bug.js","lib/excalibur/build/dist/node_modules/core-js/internals/well-known-symbol.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.array.sort.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.object.keys.js","lib/excalibur/build/dist/webpack:/ex/Loader.css","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/api.js","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/sourceMaps.js","lib/excalibur/build/dist/webpack:/ex/webpack/bootstrap","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/global","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","lib/excalibur/build/dist/webpack:/ex/Flags.ts","lib/excalibur/build/dist/webpack:/ex/Util/Log.ts","lib/excalibur/build/dist/webpack:/ex/Polyfill.ts","lib/excalibur/build/dist/webpack:/ex/Id.ts","lib/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Side.ts","lib/excalibur/build/dist/webpack:/ex/Color.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","lib/excalibur/build/dist/webpack:/ex/Math/Random.ts","lib/excalibur/build/dist/webpack:/ex/Math/util.ts","lib/excalibur/build/dist/webpack:/ex/Util/Util.ts","lib/excalibur/build/dist/webpack:/ex/Math/matrix.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Filtering.ts","lib/excalibur/build/dist/webpack:/ex/Events.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","lib/excalibur/build/dist/webpack:/ex/Util/Watch.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","lib/excalibur/build/dist/webpack:/ex/EventDispatcher.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteEffects.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Texture.ts","lib/excalibur/build/dist/webpack:/ex/Configurable.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-source.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-target.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-adapter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-layout.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/quad-index-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","lib/excalibur/build/dist/webpack:/ex/Screen.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","lib/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","lib/excalibur/build/dist/webpack:/ex/Class.ts","lib/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","lib/excalibur/build/dist/webpack:/ex/Loader.ts","lib/excalibur/build/dist/webpack:/ex/Loader.logo.png","lib/excalibur/build/dist/webpack:/ex/Util/Detector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Physics.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","lib/excalibur/build/dist/webpack:/ex/Util/Observable.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","lib/excalibur/build/dist/webpack:/ex/Math/projection.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","lib/excalibur/build/dist/webpack:/ex/Math/ray.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Math/line.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","lib/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","lib/excalibur/build/dist/webpack:/ex/Actions/RotationType.ts","lib/excalibur/build/dist/webpack:/ex/Util/CullingBox.ts","lib/excalibur/build/dist/webpack:/ex/Traits/OffscreenCulling.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerComponent.ts","lib/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","lib/excalibur/build/dist/webpack:/ex/Actor.ts","lib/excalibur/build/dist/webpack:/ex/ScreenElement.ts","lib/excalibur/build/dist/webpack:/ex/Timer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/DebugGraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Camera.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/TileMap.ts","lib/excalibur/build/dist/webpack:/ex/Util/Actors.ts","lib/excalibur/build/dist/webpack:/ex/Trigger.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Util.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","lib/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/Solver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Particles.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawingSystem.ts","lib/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerSystem.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsSystem.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntityComponent.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntitySystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/OffscreenSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerScope.ts","lib/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","lib/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelDeltaMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/NativePointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerType.ts","lib/excalibur/build/dist/webpack:/ex/Scene.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ScreenShader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/color-blind-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","lib/excalibur/build/dist/webpack:/ex/Debug/Debug.ts","lib/excalibur/build/dist/webpack:/ex/Util/Browser.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","lib/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerAbstraction.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEventReceiver.ts","lib/excalibur/build/dist/webpack:/ex/Util/Fps.ts","lib/excalibur/build/dist/webpack:/ex/Util/Clock.ts","lib/excalibur/build/dist/webpack:/ex/Engine.ts","lib/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","lib/excalibur/build/dist/webpack:/ex/Label.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricMap.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","lib/excalibur/build/dist/webpack:/ex/Util/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Util/SortedList.ts","lib/excalibur/build/dist/webpack:/ex/Util/Pool.ts","lib/excalibur/build/dist/webpack:/ex/Promises.ts","lib/excalibur/build/dist/webpack:/ex/index.ts","node_modules/store/storages/localStorage.js","node_modules/store/src/util.js","node_modules/store/storages/oldFF-globalStorage.js","node_modules/store/storages/oldIE-userDataStorage.js","node_modules/store/storages/cookieStorage.js","node_modules/store/storages/sessionStorage.js","node_modules/store/storages/memoryStorage.js","node_modules/store/plugins/json2.js","node_modules/store/plugins/lib/json2.js","node_modules/@parcel/runtime-js/lib/runtime-8fb70e8253bfa18e.js","src/main.ts","node_modules/store/src/store-engine.js","node_modules/store/storages/all.js","node_modules/store/dist/store.legacy.js","src/preferences.ts","src/level.ts","src/config.ts","src/grid.ts","src/resources.ts","node_modules/@parcel/runtime-js/lib/runtime-77d541a110e6f92a.js","node_modules/@parcel/runtime-js/lib/runtime-2b8cef0c0fd8b581.js","node_modules/@parcel/runtime-js/lib/runtime-be5aed17ac865b7f.js","node_modules/@parcel/runtime-js/lib/runtime-b2a68bba2110d1d5.js","node_modules/@parcel/runtime-js/lib/runtime-03ac81f06ee2e936.js","src/enemy.ts","src/sandcastle.ts","src/enemyGenerator.ts","src/tower.ts","src/tower-placer.ts","src/sound-manager.ts","node_modules/classnames/index.js","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/universalModuleDefinition","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/picker-system.ts","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/node_modules/tweakpane/dist/tweakpane.js","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/external umd {\"commonjs\":\"excalibur\",\"commonjs2\":\"excalibur\",\"amd\":\"excalibur\",\"root\":\"ex\"}","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/bootstrap","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/runtime/compat get default export","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/runtime/define property getters","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/runtime/hasOwnProperty shorthand","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/webpack/runtime/make namespace object","node_modules/@excaliburjs/dev-tools/dist/webpack:/ex.DevTools/dev-tools.ts"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, function() {\nreturn ","require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar TypeError = global.TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar String = global.String;\nvar TypeError = global.TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar createProperty = require('../internals/create-property');\n\nvar Array = global.Array;\nvar max = Math.max;\n\nmodule.exports = function (O, start, end) {\n  var length = lengthOfArrayLike(O);\n  var k = toAbsoluteIndex(start, length);\n  var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n  var result = Array(max(fin - k, 0));\n  for (var n = 0; k < fin; k++, n++) createProperty(result, n, O[k]);\n  result.length = n;\n  return result;\n};\n","var arraySlice = require('../internals/array-slice-simple');\n\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    array,\n    mergeSort(arraySlice(array, 0, middle), comparefn),\n    mergeSort(arraySlice(array, middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (array, left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n\n  while (lindex < llength || rindex < rlength) {\n    array[lindex + rindex] = (lindex < llength && rindex < rlength)\n      ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n      : lindex < llength ? left[lindex++] : right[rindex++];\n  } return array;\n};\n\nmodule.exports = mergeSort;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n","var global = require('../internals/global');\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar Object = global.Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","'use strict';\nvar toPropertyKey = require('../internals/to-property-key');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPropertyKey(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar bind = FunctionPrototype.bind;\nvar call = FunctionPrototype.call;\nvar uncurryThis = NATIVE_BIND && bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? function (fn) {\n  return fn && uncurryThis(fn);\n} : function (fn) {\n  return fn && function () {\n    return call.apply(fn, arguments);\n  };\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar Object = global.Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split(it, '') : Object(it);\n} : Object;\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = uncurryThis(store.get);\n  var wmhas = uncurryThis(store.has);\n  var wmset = uncurryThis(store.set);\n  set = function (it, metadata) {\n    if (wmhas(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument == 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar Object = global.Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, Object(it));\n};\n","var toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var global = require('../internals/global');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar TypeError = global.TypeError;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar TypeError = global.TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","var global = require('../internals/global');\n\nvar TypeError = global.TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.21.0',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2014-2022 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- safe\n  return number !== number || number === 0 ? 0 : (number > 0 ? floor : ceil)(number);\n};\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var global = require('../internals/global');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar Object = global.Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TypeError = global.TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var global = require('../internals/global');\nvar classof = require('../internals/classof');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","var global = require('../internals/global');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype != 42;\n});\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar symbolFor = Symbol && Symbol['for'];\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    var description = 'Symbol.' + name;\n    if (NATIVE_SYMBOL && hasOwn(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else if (USE_SYMBOL_AS_UID && symbolFor) {\n      WellKnownSymbolsStore[name] = symbolFor(description);\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar un$Sort = uncurryThis(test.sort);\nvar push = uncurryThis(test.push);\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n    var items = [];\n    var arrayLength = lengthOfArrayLike(array);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) push(items, array[index]);\n    }\n\n    internalSort(items, getSortCompare(comparefn));\n\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n/**\n * Features in preview\n */\nexport enum Experiments {\n  WebGL = 'use-webgl'\n}\n\n/**\n * Legacy features that will go away\n */\nexport enum Legacy {\n  Canvas = 'use-canvas-context',\n  LegacyDrawing = 'use-legacy-drawing'\n}\n\n/**\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\n * after which they are frozen and are read-only.\n *\n * Flags are used to enable experimental or preview features in Excalibur.\n */\nexport class Flags {\n  private static _FROZEN = false;\n  private static _FLAGS: Record<string, boolean> = {};\n\n  /**\n   * Freeze all flag modifications making them readonly\n   */\n  public static freeze() {\n    Flags._FROZEN = true;\n  }\n\n  /**\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\n   *\n   * Calling this in your game is UNSUPPORTED\n   * @internal\n   */\n  public static _reset() {\n    Flags._FROZEN = false;\n    Flags._FLAGS = {};\n  }\n\n  /**\n   * Turn on webgl support\n   */\n  public static useWebGL() {\n    Flags.enable(Experiments.WebGL);\n  }\n\n  public static useCanvasGraphicsContext() {\n    Flags.enable(Legacy.Canvas);\n  }\n\n  /**\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\n   */\n  public static useLegacyDrawing() {\n    Flags.enable(Legacy.LegacyDrawing);\n  }\n\n  /**\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static enable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be enabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = true;\n  }\n\n  /**\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static disable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be disabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = false;\n  }\n\n  /**\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\n   * @param flagName\n   */\n  public static isEnabled(flagName: string): boolean {\n    return !!Flags._FLAGS[flagName];\n  }\n\n  /**\n   * Show a list of currently known flags\n   */\n  public static show(): string[] {\n    return Object.keys(Flags._FLAGS);\n  }\n}\n","/* eslint-disable no-console */\n/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[Appender]] to create your own logging appenders.\n */\nexport class Logger {\n  private static _INSTANCE: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._INSTANCE) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._INSTANCE = this;\n    // Default console appender\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._INSTANCE == null) {\n      Logger._INSTANCE = new Logger();\n    }\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Adds a new [[Appender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    // eslint-disable-next-line\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import 'core-js/es/array/sort';\nimport 'core-js/es/object/keys';\n\n/**\n * Polyfill adding function\n */\nexport function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function () {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function (callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function () {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    if ((<any>window).webkitAudioContext) {\n      const ctx = (<any>window).webkitAudioContext;\n      const replaceMe = ctx.prototype.decodeAudioData;\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\n        return new Promise((resolve, reject) => {\n          replaceMe.call(this, arrayBuffer, resolve, reject);\n        });\n      };\n    }\n\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n}\n","export type Id<T extends string> = {\n  type: T,\n  value: number\n};\n\n/**\n * Create a branded ID type from a number\n */\nexport function createId<T extends string>(type: T, value: number): Id<T> {\n  return { type, value };\n};\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = {\n    message: 'This feature will be removed in future versions of Excalibur.',\n    alternateMethod: null,\n    showStackTrace: false,\n    ...options\n  };\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Clonable } from '../Interfaces/Clonable';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A 2D vector on a plane.\n */\n\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  public static min(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\n  }\n\n  public static max(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(x: number, y: number) {\n    this._x = x;\n    this._y = y;\n  }\n\n  protected _x = 0;\n  /**\n   * Get the x component of the vector\n   */\n  public get x(): number {\n    return this._x;\n  }\n\n  /**\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set x(val: number) {\n    this._x = val;\n  }\n\n  protected _y = 0;\n  /**\n   * Get the y component of the vector\n   */\n  public get y(): number {\n    return this._y;\n  }\n\n  /**\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set y(val: number) {\n    this._y = val;\n  }\n\n  /**\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\n   *\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  setTo(x: number, y: number) {\n    (this.x as number) = x;\n    (this.y as number) = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param vector The other point to compare to\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  public squareDistance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\n   */\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * The size (magnitude) of the Vector\n   */\n  public get size(): number {\n    return this.distance();\n  }\n\n  /**\n   * Setting the size mutates the current vector\n   *\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  public set size(newLength: number) {\n    const v = this.normalize().scale(newLength);\n    this.setTo(v.x, v.y);\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public addEqual(v: Vector): Vector {\n    this.setTo(this.x + v.x, this.y + v.y);\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @param v The vector to subtract\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public subEqual(v: Vector): Vector {\n    this.setTo(this.x - v.x, this.y - v.y);\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public scaleEqual(size: number): Vector {\n    this.setTo(this.x * size, this.y * size);\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  static cross(num: number, vec: Vector): Vector {\n    return new Vector(-num * vec.y, num * vec.x);\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string representation of the vector.\n   */\n  public toString(fixed?: number): string {\n    if (fixed) {\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\n    }\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n *\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nexport function vec(x: number, y: number): Vector {\n  return new Vector(x, y);\n}\n","import { Vector } from '../Math/vector';\n\n/**\n * An enum that describes the sides of an axis aligned box for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n\nexport module Side {\n  /**\n   * Returns the opposite side from the current\n   */\n  export function getOpposite(side: Side): Side {\n    if (side === Side.Top) {\n      return Side.Bottom;\n    }\n    if (side === Side.Bottom) {\n      return Side.Top;\n    }\n    if (side === Side.Left) {\n      return Side.Right;\n    }\n    if (side === Side.Right) {\n      return Side.Left;\n    }\n\n    return Side.None;\n  }\n\n  /**\n   * Given a vector, return the Side most in that direction (via dot product)\n   */\n  export function fromDirection(direction: Vector): Side {\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n    let max = -Number.MAX_VALUE;\n    let maxIndex = -1;\n    for (let i = 0; i < directions.length; i++) {\n      if (directions[i].dot(direction) > max) {\n        max = directions[i].dot(direction);\n        maxIndex = i;\n      }\n    }\n    return directionEnum[maxIndex];\n  }\n}\n","import { obsolete } from './Util/Decorators';\n\n/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new instance of Color from a rgb string\n   *\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\n   */\n  public static fromRGBString(string: string): Color {\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\n    let match = null;\n    if ((match = string.match(rgbaRegEx))) {\n      const r = parseInt(match[1], 10);\n      const g = parseInt(match[2], 10);\n      const b = parseInt(match[3], 10);\n      let a = 1;\n      if (match[4]) {\n        a = parseFloat(match[4]);\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid rgb/a string: ' + string);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public multiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   * @param color\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\n  public mulitiply(color: Color): Color {\n    return this.multiply(color);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.multiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  public equal(color: Color): boolean {\n    return this.toString() === color.toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   */\n  public static get Vermilion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions',\n    alternateMethod: 'Vermilion'\n  })\n  public static get Vermillion(): Color {\n    return Color.Vermilion;\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n\n  /**\n   * ExcaliburBlue (#176BAA)\n   */\n  public static get ExcaliburBlue(): Color {\n    return Color.fromHex('#176BAA');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","import { vec, Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Returns a new instance of [[BoundingBox]] that is a copy of the current instance\n   */\n  public clone(): BoundingBox {\n    return new BoundingBox(this.left, this.top, this.right, this.bottom);\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Scale a bounding box by a scale factor, optionally provide a point\n   * @param scale\n   * @param point\n   */\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Transform the axis aligned bounding box by a [[Matrix]], producing a new axis aligned bounding box\n   * @param matrix\n   */\n  public transform(matrix: Matrix) {\n    const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\n    const xa = matFirstColumn.scale(this.left);\n    const xb = matFirstColumn.scale(this.right);\n\n    const matSecondColumn = vec(matrix.data[4], matrix.data[5]);\n    const ya = matSecondColumn.scale(this.top);\n    const yb = matSecondColumn.scale(this.bottom);\n\n    const matrixPos = matrix.getPosition();\n    const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\n    const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\n\n    return new BoundingBox({\n      left: topLeft.x,\n      top: topLeft.y,\n      right: bottomRight.x,\n      bottom: bottomRight.y\n    });\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Returns true if the bounding boxes overlap.\n   * @param other\n   */\n  public overlaps(other: BoundingBox): boolean {\n    const totalBoundingBox = this.combine(other);\n    return totalBoundingBox.width < other.width + this.width &&\n           totalBoundingBox.height < other.height + this.height;\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /**\n   *\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","/**\n * @module\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrence\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param array Array to pick elements out of\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param array Array to pick elements out of\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","import { Random } from './Random';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Returns the fractional part of a number\n * @param x\n */\nexport function frac(x: number): number {\n  if (x >= 0) {\n    return x - Math.floor(x);\n  } else {\n    return x - Math.ceil(x);\n  }\n}\n\n/**\n * Returns the sign of a number, if 0 returns 0\n */\nexport function sign(val: number): number {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\n\n/**\n * Convert an angle to be the equivalent in the range [0, 2PI]\n */\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\n/**\n * Convert radians to degrees\n */\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\n/**\n * Convert degrees to radians\n */\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\n/**\n * Generate a range of numbers\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\n * @param from inclusive\n * @param to inclusive\n */\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\n\n/**\n * Find a random floating point number in range\n */\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\n/**\n * Find a random integer in a range\n */\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}","import { Vector } from '../Math/vector';\nimport { Side } from '../Collision/Side';\nimport { Clock } from './Clock';\n\n// TODO remove in v0.26.0\n// Re-export hack to deprecate import site gently\nimport {\n  TwoPI as lTwoPI,\n  clamp as lclamp,\n  randomInRange as lrandomInRange,\n  randomIntInRange as lrandomIntInRange,\n  canonicalizeAngle as lcanonicalizeAngle,\n  toDegrees as ltoDegrees,\n  toRadians as ltoRadians,\n  range as lrange\n} from '../Math/util';\n\n/**\n * @deprecated ex.Util.TwoPI import site will be removed in v0.26.0, use ex.TwoPI\n */\nexport const TwoPI = lTwoPI;\n\n/**\n * @deprecated ex.Util.clamp import site will be removed in v0.26.0, use ex.clamp\n */\nexport const clamp = lclamp;\n\n/**\n * @deprecated ex.Util.randomInRange import site will be removed in v0.26.0, use ex.randomInRange\n */\nexport const randomInRange = lrandomInRange;\n\n/**\n * @deprecated ex.Util.randomIntInRange import site will be removed in v0.26.0, use ex.randomIntInRange\n */\nexport const randomIntInRange = lrandomIntInRange;\n\n/**\n * @deprecated ex.Util.canonicalizeAngle import site will be removed in v0.26.0, use ex.canonicalizeAngle\n */\nexport const canonicalizeAngle = lcanonicalizeAngle;\n\n/**\n * @deprecated ex.Util.toDegrees import site will be removed in v0.26.0, use ex.toDegrees\n */\nexport const toDegrees = ltoDegrees;\n\n/**\n * @deprecated ex.Util.toRadians import site will be removed in v0.26.0, use ex.toRadians\n */\nexport const toRadians = ltoRadians;\n\n/**\n * @deprecated ex.Util.range import site will be removed in v0.26.0, use ex.range\n */\nexport const range = lrange;\n\n// TODO END REMOVE in v0.26.0\n\n/**\n * Find the screen position of an HTML element\n */\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\n/**\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\n * @deprecated Will be removed in v0.26.0\n */\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Remove an item from an list\n * @deprecated Will be removed in v0.26.0\n */\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * See if an array contains something\n */\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get the opposite side\n * TODO: Move to Side type\n * @deprecated Will be removed in v0.26.0\n */\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n * @deprecated\n * TODO: Move to Side type\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n * @deprecated Will be removed v0.26.0\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n\n/**\n * Create a promise that resolves after a certain number of milliseconds\n *\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\n * excalibur clock which would be unaffected by stop/pause.\n * @param milliseconds\n * @param clock\n */\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\n  return new Promise<void>(resolve => {\n    schedule(() => {\n      resolve();\n    }, milliseconds);\n  });\n}\n","import { sign } from './util';\nimport { Vector, vec } from './vector';\nimport { canonicalizeAngle } from './util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Converts the current matrix into a DOMMatrix\n   *\n   * This is useful when working with the browser Canvas context\n   * @returns {DOMMatrix} DOMMatrix\n   */\n  public toDOMMatrix(): DOMMatrix {\n    return new DOMMatrix([...this.data]);\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Resets the current matrix to the identity matrix, mutating it\n   * @returns {Matrix} Current matrix as identity\n   */\n  public reset(): Matrix {\n    const mat = this;\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiply the current matrix by a vector producing a new vector\n   * @param vector\n   * @param dest\n   */\n  multiply(vector: Vector, dest?: Vector): Vector;\n  /**\n   * Multiply the current matrix by another matrix producing a new matrix\n   * @param matrix\n   * @param dest\n   */\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\n    if (vectorOrMatrix instanceof Vector) {\n      const result = (dest as Vector) || new Vector(0, 0);\n      const vector = vectorOrMatrix;\n      // these shenanigans are to allow dest and vector to be the same instance\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\n\n      result.x = resultX;\n      result.y = resultY;\n      return result;\n    } else {\n      const result = (dest as Matrix) || new Matrix();\n      const other = vectorOrMatrix;\n      const a11 = this.data[0];\n      const a21 = this.data[1];\n      const a31 = this.data[2];\n      const a41 = this.data[3];\n\n      const a12 = this.data[4];\n      const a22 = this.data[5];\n      const a32 = this.data[6];\n      const a42 = this.data[7];\n\n      const a13 = this.data[8];\n      const a23 = this.data[9];\n      const a33 = this.data[10];\n      const a43 = this.data[11];\n\n      const a14 = this.data[12];\n      const a24 = this.data[13];\n      const a34 = this.data[14];\n      const a44 = this.data[15];\n\n      const b11 = other.data[0];\n      const b21 = other.data[1];\n      const b31 = other.data[2];\n      const b41 = other.data[3];\n\n      const b12 = other.data[4];\n      const b22 = other.data[5];\n      const b32 = other.data[6];\n      const b42 = other.data[7];\n\n      const b13 = other.data[8];\n      const b23 = other.data[9];\n      const b33 = other.data[10];\n      const b43 = other.data[11];\n\n      const b14 = other.data[12];\n      const b24 = other.data[13];\n      const b34 = other.data[14];\n      const b44 = other.data[15];\n\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n      const s = this.getScale();\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\n\n      return result;\n    }\n  }\n\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  /**\n   * Return the affine inverse, optionally store it in a target matrix.\n   *\n   * It's recommended you call .reset() the target unless you know what you're doing\n   * @param target\n   */\n  public getAffineInverse(target?: Matrix): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = target || Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","\n/**\n * Describes the different image filtering modes\n */\nexport enum ImageFiltering {\n\n  /**\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\n   *\n   * Useful for Pixel art aesthetics.\n   */\n  Pixel = 'Pixel',\n\n  /**\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\n   */\n  Blended = 'Blended'\n}","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { Matrix } from '../../Math/matrix';\n\nexport class TransformStack {\n  private _transforms: Matrix[] = [];\n  private _currentTransform: Matrix = Matrix.identity();\n\n  public save(): void {\n    this._transforms.push(this._currentTransform);\n    this._currentTransform = this._currentTransform.clone();\n  }\n\n  public restore(): void {\n    this._currentTransform = this._transforms.pop();\n  }\n\n  public translate(x: number, y: number): Matrix {\n    return this._currentTransform.translate(x, y);\n  }\n\n  public rotate(angle: number): Matrix {\n    return this._currentTransform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): Matrix {\n    return this._currentTransform.scale(x, y);\n  }\n\n  public set current(matrix: Matrix) {\n    this._currentTransform = matrix;\n  }\n\n  public get current(): Matrix {\n    return this._currentTransform;\n  }\n}\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\n\nexport class StateStack {\n  private _states: ExcaliburGraphicsContextState[] = [];\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\n\n  private _getDefaultState() {\n    return {\n      opacity: 1\n    };\n  }\n\n  private _cloneState() {\n    return {\n      opacity: this._currentState.opacity\n    };\n  }\n\n  public save(): void {\n    this._states.push(this._currentState);\n    this._currentState = this._cloneState();\n  }\n\n  public restore(): void {\n    this._currentState = this._states.pop();\n  }\n\n  public get current(): ExcaliburGraphicsContextState {\n    return this._currentState;\n  }\n}\n","/**\n * Watch an object with a proxy, only fires if property value is different\n */\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        if ((obj as any)[prop] !== value) {\n          (obj as any)[prop] = value;\n          // Avoid watching private junk\n          if (typeof prop === 'string') {\n            if (prop[0] !== '_') {\n              change(obj);\n            }\n          }\n        }\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n\n/**\n * Watch an object with a proxy, fires change on any property value change\n */\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        (obj as any)[prop] = value;\n        // Avoid watching private junk\n        if (typeof prop === 'string') {\n          if (prop[0] !== '_') {\n            change(obj);\n          }\n        }\n\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { Matrix } from '..';\nimport { watch } from '../Util/Watch';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  public transform: Matrix = Matrix.identity();\n  private _transformStale = true;\n  public isStale() {\n    return this._transformStale;\n  }\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n\n  private _flipHorizontal = false;\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public get flipHorizontal(): boolean {\n    return this._flipHorizontal;\n  }\n\n  public set flipHorizontal(value: boolean) {\n    this._flipHorizontal = value;\n    this._transformStale = true;\n  }\n\n  private _flipVertical = false;\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public get flipVertical(): boolean {\n    return this._flipVertical;\n  }\n\n  public set flipVertical(value: boolean) {\n    this._flipVertical = value;\n    this._transformStale = true;\n  }\n\n  private _rotation = 0;\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public get rotation(): number {\n    return this._rotation;\n  }\n\n  public set rotation(value: number) {\n    this._rotation = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  private _scale = Vector.One;\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public get scale() {\n    return this._scale;\n  }\n\n  public set scale(value: Vector) {\n    this._scale = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  private _origin: Vector | null = null;\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public get origin(): Vector | null {\n    return this._origin;\n  }\n\n  public set origin(value: Vector | null) {\n    this._origin = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n    this._transformStale = true;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    if (this._transformStale) {\n      this.transform.reset();\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n      this._rotate(this.transform);\n      this._flip(this.transform);\n      this._transformStale = false;\n    }\n    ex.multiply(this.transform);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext | Matrix) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext | Matrix) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any additional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\n * Checks if the current number is a power of two\n */\nexport function isPowerOfTwo(x: number): boolean {\n  return (x & (x - 1)) === 0;\n}\n\n/**\n * Returns the next highest power of two\n */\nexport function nextHighestPowerOfTwo(x: number): number {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x = x | (x >> i);\n  }\n  return x + 1;\n}\n\n/**\n * Returns the input number if a power of two, otherwise the next highest power of two\n */\nexport function ensurePowerOfTwo(x: number): number {\n  if (!isPowerOfTwo(x)) {\n    return nextHighestPowerOfTwo(x);\n  }\n  return x;\n}\n\n/**\n * Return the size of the GlType in bytes\n * @param gl\n * @param type\n */\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.FLOAT:\n      return 4;\n    case gl.SHORT:\n      return 2;\n    case gl.UNSIGNED_SHORT:\n      return 2;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n\n/**\n * Based on the type return the number of attribute components\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n * @param gl\n * @param type\n */\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n      return 1;\n    case gl.FLOAT_VEC2:\n      return 2;\n    case gl.FLOAT_VEC3:\n      return 3;\n    case gl.FLOAT_VEC4:\n      return 4;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    case gl.UNSIGNED_SHORT:\n    case gl.SHORT:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n/**\n * Based on the attribute return the corresponding supported attrib pointer type\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n *\n * @param gl\n * @param type\n */\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n    case gl.FLOAT_VEC2:\n    case gl.FLOAT_VEC3:\n    case gl.FLOAT_VEC4:\n      return gl.FLOAT;\n    case gl.BYTE:\n      return gl.BYTE;\n    case gl.UNSIGNED_BYTE:\n      return gl.UNSIGNED_BYTE;\n    case gl.SHORT:\n      return gl.SHORT;\n    case gl.UNSIGNED_SHORT:\n      return gl.UNSIGNED_SHORT;\n    default:\n      return gl.FLOAT;\n  }\n}","import { Logger } from '../../Util/Log';\nimport { ImageFiltering } from '../Filtering';\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\n\n/**\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\n */\nexport class TextureLoader {\n  private static _LOGGER = Logger.getInstance();\n  /**\n   * Sets the default filtering for the Excalibur texture loader, default [[ImageFiltering.Blended]]\n   */\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\n  private static _POT_CANVAS = document.createElement('canvas');\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\n\n  private static _GL: WebGLRenderingContext;\n\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\n\n  private static _MAX_TEXTURE_SIZE: number  = 0;\n\n  public static register(context: WebGLRenderingContext): void {\n    TextureLoader._GL = context;\n    TextureLoader._MAX_TEXTURE_SIZE = context.getParameter(context.MAX_TEXTURE_SIZE);\n  }\n\n  /**\n   * Get the WebGL Texture from a source image\n   * @param image\n   */\n  public static get(image: HTMLImageSource): WebGLTexture {\n    return TextureLoader._TEXTURE_MAP.get(image);\n  }\n\n  /**\n   * Returns whether a source image has been loaded as a texture\n   * @param image\n   */\n  public static has(image: HTMLImageSource): boolean {\n    return TextureLoader._TEXTURE_MAP.has(image);\n  }\n\n  /**\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\n   * @param image Source graphic\n   * @param filtering {ImageFiltering} The ImageFiltering mode to apply to the loaded texture\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\n   */\n  public static load(image: HTMLImageSource, filtering?: ImageFiltering, forceUpdate = false): WebGLTexture {\n    // Ignore loading if webgl is not registered\n    const gl = TextureLoader._GL;\n    if (!gl) {\n      return null;\n    }\n\n    let tex: WebGLTexture = null;\n    // If reuse the texture if it's from the same source\n    if (TextureLoader.has(image)) {\n      tex = TextureLoader.get(image);\n    }\n\n    // Update existing webgl texture and return early\n    if (tex) {\n      if (forceUpdate) {\n        gl.bindTexture(gl.TEXTURE_2D, tex);\n        const source = TextureLoader.toPowerOfTwoImage(image);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n      }\n      return tex;\n    }\n\n    // No texture exists create a new one\n    tex = gl.createTexture();\n    const source = TextureLoader.toPowerOfTwoImage(image);\n\n    TextureLoader.checkImageSizeSupportedAndLog(image);\n\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    // NEAREST for pixel art, LINEAR for hi-res\n    const filterMode = filtering ?? TextureLoader.filtering;\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n\n    TextureLoader._TEXTURE_MAP.set(image, tex);\n    return tex;\n  }\n\n  /**\n   * Converts source images into power of two images, WebGL only supports POT images\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\n   * @param image\n   */\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\n    const potCanvas = TextureLoader._POT_CANVAS;\n    const potCtx = TextureLoader._POT_CTX;\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\n      // Scale up the texture to the next highest power of two dimensions.\n\n      potCanvas.width = ensurePowerOfTwo(image.width);\n      potCanvas.height = ensurePowerOfTwo(image.height);\n      potCtx.imageSmoothingEnabled = false;\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\n      image = potCanvas;\n    }\n    return image;\n  }\n\n  /**\n   * Takes an image and returns if it meets size criteria for hardware\n   * @param image\n   * @returns if the image will be supported at runtime\n   */\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\n      TextureLoader._LOGGER.error(\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of `+\n        `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image `\n        +`for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n`+\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n      return false;\n    } else if (image.width > 4096 || image.height > 4096) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\n      TextureLoader._LOGGER.warn(\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, `+\n        `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\n        `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n    }\n    return true;\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\nimport { ImageFiltering } from './Filtering';\n\n\nexport interface RasterOptions {\n  /**\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\n   */\n  smoothing?: boolean;\n\n  /**\n   * Optionally specify the color of the raster's bitmap context, by default [[Color.Black]]\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\n   */\n  strokeColor?: Color;\n\n  /**\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\n   */\n  lineWidth?: number;\n\n  /**\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\n   */\n  lineDash?: number[];\n\n  /**\n   * Optionally specify the padding to apply to the bitmap\n   */\n  padding?: number;\n\n  /**\n   * Optionally specify what image filtering mode should be used, [[ImageFiltering.Pixel]] for pixel art,\n   * [[ImageFiltering.Blended]] for hi-res art\n   *\n   * By default unset, rasters defer to the engine antialiasing setting\n   */\n  filtering?: ImageFiltering;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implement the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public filtering: ImageFiltering = null;\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n      this.filtering = options.filtering ?? this.filtering;\n    }\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return Math.abs(this._getTotalWidth() * this.scale.x);\n  }\n  public set width(value: number) {\n    value /= Math.abs(this.scale.x);\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return Math.abs(this._getTotalHeight() * this.scale.y);\n  }\n\n  public set height(value: number) {\n    value /= Math.abs(this.scale.y);\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    this.flagDirty();\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    this.flagDirty();\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperties(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, this.filtering, true);\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CanvasOptions {\n  draw?: (ctx: CanvasRenderingContext2D) => void;\n  cache?: boolean;\n}\n\n/**\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\n *\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\n *\n * **Low performance API**\n */\nexport class Canvas extends Raster {\n  /**\n   * Return the 2D graphics context of this canvas\n   */\n  public get ctx() {\n    return this._ctx;\n  }\n\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\n    super(_options);\n  }\n\n  public clone(): Canvas {\n    return new Canvas({\n      ...this._options,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._options?.draw) {\n      this._options?.draw(ctx);\n    }\n    if (!this._options.cache) {\n      this.flagDirty();\n    }\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    if (!event) {\n      event = new GameEvent();\n    }\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i](event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      this.off(eventName, handler);\n      handler(ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also receive events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Logger } from '../Util/Log';\nimport { EventDispatcher } from '../EventDispatcher';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n */\nexport class Resource<T> implements Loadable<T> {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n  public events: EventDispatcher = new EventDispatcher();\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {}\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<T> {\n    return new Promise((resolve, reject) => {\n      // Exit early if we already have data\n      if (this.data !== null) {\n        this.logger.debug('Already have data for resource', this.path);\n        this.events.emit('complete', this.data as any);\n        resolve(this.data);\n        return;\n      }\n\n      const request = new XMLHttpRequest();\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n      request.responseType = this.responseType;\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\n      request.addEventListener('load', () => {\n        // XHR on file:// success status is 0, such as with PhantomJS\n        if (request.status !== 0 && request.status !== 200) {\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n          this.events.emit('error', request.response);\n          reject(new Error(request.statusText));\n          return;\n        }\n\n        this.data = request.response;\n        this.events.emit('complete', this.data as any);\n        this.logger.debug('Completed loading resource', this.path);\n        resolve(this.data);\n      });\n      request.send();\n    });\n  }\n}\n","/**\n * @module\n * @deprecated\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n */\n\n/**\n * @typedoc\n */\n\nimport { obsolete } from '../Util/Decorators';\nimport { Color } from '../Color';\n\n/**\n * The interface that all sprite effects must implement\n * @deprecated SpriteEffect will be removed in v0.26.0\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n * @deprecated [[Grayscale]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Grayscale will be removed in v0.26.0'\n})\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n * @deprecated [[Invert]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Invert will be removed in v0.26.0'\n})\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n * @deprecated [[Opacity]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Opacity will be removed in v0.26.0'\n})\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n * @deprecated [[Colorize]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Colorize will be removed in v0.26.0'\n})\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n * @deprecated [[Lighten]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Lighten will be removed in v0.26.0'\n})\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n * @deprecated [[Darken]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Darken will be removed v0.26.0'\n})\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n * @deprecated [[Saturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Saturate will be removed in v0.26.0'\n})\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n * @deprecated [[Desaturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Desaturate will be removed in v0.26.0'\n})\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n * @deprecated [[Fill]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Fill will be removed in v0.26.0'\n})\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n * @deprecated\n */\nexport class Texture implements Loadable<HTMLImageElement> {\n  private _resource: Resource<Blob>;\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public data: HTMLImageElement;\n  public get image() {\n    return this.data;\n  }\n\n  private _loadedResolve: (image: HTMLImageElement) => any;\n  public loaded = new Promise<HTMLImageElement>(resolve => {\n    this._loadedResolve = resolve;\n  });\n\n  /**\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return !!this.data;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<HTMLImageElement> {\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      await image.decode();\n\n      // Set results\n      this.data = image;\n      this.width = this._sprite.width = image.naturalWidth;\n      this.height = this._sprite.height = image.naturalHeight;\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n    } catch {\n      await Promise.reject('Error loading texture');\n    }\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\n/**\n * Configurable helper extends base type and makes all properties available as option bag arguments\n * @internal\n * @param base\n */\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        // eslint-disable-next-line\n        if (typeof (<any>this)[k] !== 'function') {\n          // eslint-disable-next-line\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Texture } from './Texture';\nimport { Vector } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @hidden\n * @deprecated Use [[Sprite]]\n */\nexport class SpriteImpl implements Drawable {\n  public texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return Math.abs(this.width * this.scale.x);\n  }\n\n  public get drawHeight(): number {\n    return Math.abs(this.height * this.scale.y);\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = Vector.Half;\n  public offset: Vector = Vector.Zero;\n  public scale: Vector = Vector.One;\n  /**\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\n   */\n  public drawAroundAnchor = false;\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = true;\n\n  /**\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to construct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this.texture = image as Texture;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\n    this._initPixelsFromTexture();\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private async _initPixelsFromTexture() {\n    try {\n      const image = await this.texture.loaded;\n      this.width = this.width || image.naturalWidth;\n      this.height = this.height || image.naturalHeight;\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\n      this._loadPixels();\n      this._dirtyEffect = true;\n    } catch (e) {\n      this.logger.error('Error loading texture ', this.texture.path, e);\n    }\n  }\n\n  private _loadPixels() {\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this.texture.image.naturalWidth || 0;\n      const naturalHeight = this.texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._flushTexture();\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  private _flushTexture() {\n    const naturalWidth = this.texture.image.naturalWidth || 0;\n    const naturalHeight = this.texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this.texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n  }\n\n  private _opacity: number = 1;\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[SpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[SpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n    this._flushTexture();\n\n    if (this.effects.length > 0) {\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n      const len = this.effects.length;\n      for (let i = 0; i < len; i++) {\n        for (let y = 0; y < this.height; y++) {\n          for (let x = 0; x < this.width; x++) {\n            this.effects[i].updatePixel(x, y, this._pixelData);\n          }\n        }\n      }\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\n    }\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.width,\n      drawHeight: options.drawHeight ?? this.height,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n    // calculating current dimensions\n    const anchorX = drawWidth * anchor.x + offset.x;\n    const anchorY = drawHeight * anchor.y + offset.y;\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n\n    ctx.save();\n    // Move the draw point of origin\n    ctx.translate(x, y);\n\n    // Rotate and scale around anchor point\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n\n    if (this.drawAroundAnchor) {\n      // In the case where you want the anchor to match with the point of draw\n      // Otherwise sprites are always drawn from top-left\n      ctx.translate(-anchorX, -anchorY);\n    }\n\n    ctx.translate(anchorX, anchorY);\n    ctx.rotate(rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ctx.scale(scaleDirX, scaleDirY);\n    ctx.translate(-anchorX, -anchorY);\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    // Context is already rotated and scaled\n    ctx.drawImage(\n      this._spriteCanvas,\n      0,\n      0,\n      this.width,\n      this.height, // source\n      0,\n      0,\n      this.width,\n      this.height\n    ); // dest\n    ctx.globalAlpha = oldAlpha;\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\n    result.anchor = this.anchor.clone();\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * @deprecated Use [[Sprite]]\n */\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\n * @deprecated Use [[Sprite]]\n */\n@obsolete({\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\n  alternateMethod: 'Use Label.font.shadow'\n})\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ImageSource } from './ImageSource';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\nimport { Texture } from '../Drawing/Texture';\n\nexport type SourceView = { x: number; y: number; width: number; height: number };\nexport type DestinationSize = { width: number; height: number };\n\nexport interface SpriteOptions {\n  /**\n   * Image to create a sprite from\n   */\n  image: ImageSource;\n  /**\n   * By default the source is the entire dimension of the [[ImageSource]]\n   */\n  sourceView?: { x: number; y: number; width: number; height: number };\n  /**\n   * By default the size of the final sprite is the size of the [[ImageSource]]\n   */\n  destSize?: { width: number; height: number };\n}\n\nexport class Sprite extends Graphic {\n  public image: ImageSource;\n  public sourceView: SourceView;\n  public destSize: DestinationSize;\n  private _dirty = true;\n\n  public static from(image: ImageSource): Sprite {\n    return new Sprite({\n      image: image\n    });\n  }\n\n  constructor(options: GraphicOptions & SpriteOptions) {\n    super(options);\n    this.image = options.image;\n    const { width, height } = options;\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\n    this._updateSpriteDimensions();\n    this.image.ready.then(() => {\n      this._updateSpriteDimensions();\n    });\n  }\n\n  public override get width(): number {\n    return Math.abs(this.destSize.width * this.scale.x);\n  }\n\n  public override get height(): number {\n    return Math.abs(this.destSize.height * this.scale.y);\n  }\n\n  public override set width(newWidth: number) {\n    newWidth /= Math.abs(this.scale.x);\n    this.destSize.width = newWidth;\n    super.width = Math.ceil(this.destSize.width);\n  }\n\n  public override set height(newHeight: number) {\n    newHeight /= Math.abs(this.scale.y);\n    this.destSize.height = newHeight;\n    super.height = Math.ceil(this.destSize.height);\n  }\n\n  private _updateSpriteDimensions() {\n    const { width: nativeWidth, height: nativeHeight } = this.image;\n    // This code uses || to avoid 0's\n    // If the source is not specified, use the native dimension\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\n\n    // If the destination is not specified, use the source if specified, then native\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\n\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded() && this._dirty) {\n      this._dirty = false;\n      this._updateSpriteDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded()) {\n      ex.drawImage(\n        this.image.image,\n        this.sourceView.x,\n        this.sourceView.y,\n        this.sourceView.width,\n        this.sourceView.height,\n        x,\n        y,\n        this.destSize.width,\n        this.destSize.height\n      );\n    }\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param sprite\n   */\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\n    const tex = sprite.texture;\n    const image = ImageSource.fromLegacyTexture(tex);\n    return new Sprite({\n      image,\n      sourceView: {\n        x: sprite.x,\n        y: sprite.y,\n        width: sprite.width,\n        height: sprite.height\n      }\n    });\n  }\n\n  /**\n   * Converts a sprite to a Legacy sprite\n   * @deprecated\n   * @param sprite\n   * @returns LegacyDrawing.Sprite\n   */\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\n    const image = sprite.image;\n    const tex = new Texture(image.path);\n    tex.data = image.image;\n\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\n  }\n\n  public clone(): Sprite {\n    return new Sprite({\n      image: this.image,\n      sourceView: { ...this.sourceView },\n      destSize: { ...this.destSize },\n      ...this.cloneGraphicOptions()\n    });\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Texture } from '../Drawing/Texture';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\nimport { Logger } from '../Util/Log';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\nexport class ImageSource implements Loadable<HTMLImageElement> {\n  private _logger = Logger.getInstance();\n  private _resource: Resource<Blob>;\n  private _filtering: ImageFiltering;\n\n  /**\n   * The original size of the source image in pixels\n   */\n  public get width() {\n    return this.image.naturalWidth;\n  }\n\n  /**\n   * The original height of the source image in pixels\n   */\n  public get height() {\n    return this.image.naturalHeight;\n  }\n\n  private _src: string;\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    if (!this._src) {\n      // this boosts speed of access\n      this._src = this.data.src;\n    }\n    return !!this._src;\n  }\n\n  /**\n   * Access to the underlying html image element\n   */\n  public data: HTMLImageElement = new Image();\n  public get image(): HTMLImageElement {\n    return this.data;\n  }\n\n  /**\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\n   */\n  public ready: Promise<HTMLImageElement>;\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\n\n  /**\n   * The path to the image, can also be a data url like 'data:image/'\n   * @param path {string} Path to the image resource relative from the HTML document hosting the game, or absolute\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by [[EngineOptions.antialiasing]]\n   */\n  constructor(public readonly path: string, bustCache: boolean = false, filtering?: ImageFiltering) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._filtering = filtering;\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\n    }\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\n      this._loadedResolve = resolve;\n    });\n  }\n\n  /**\n   * Begins loading the image and returns a promise that resolves when the image is loaded\n   */\n  async load(): Promise<HTMLImageElement> {\n    if (this.isLoaded()) {\n      return this.data;\n    }\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      image.setAttribute('data-original-src', this.path);\n      await image.decode();\n\n      // Set results\n      this.data = image;\n    } catch (error) {\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\n    }\n    TextureLoader.load(this.data, this._filtering);\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  /**\n   * Build a sprite from this ImageSource\n   */\n  public toSprite(): Sprite {\n    return Sprite.from(this);\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param tex\n   */\n  public static fromLegacyTexture(tex: Texture): ImageSource {\n    const image = new ImageSource(tex.path);\n    if (tex.isLoaded()) {\n      image.data = tex.data;\n    } else {\n      tex.loaded.then(() => {\n        image.data = tex.data;\n      });\n    }\n    return image;\n  }\n\n  /**\n   * Unload images from memory\n   */\n  unload(): void {\n    this.data = new Image();\n  }\n}\n","import { Sprite } from './Sprite';\nimport * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { Engine } from '../Engine';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @deprecated Use [[HasTick]]\n */\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\n/**\n * @hidden\n * @deprecated Use [[Animation]]\n */\nexport class AnimationImpl implements Drawable, HasTick {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _timeLeftInFrame: number = 0;\n  private _idempotencyToken: number = -1;\n\n  public anchor: Vector = Vector.Zero;\n  public rotation: number = 0.0;\n  public scale: Vector = Vector.One;\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  private _opacity = 1;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engineOrConfig  Reference to the current game engine\n   * @param sprites  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n    this._timeLeftInFrame = this.speed;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[SpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[SpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick(elapsed: number, idempotencyToken?: number) {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    this._timeLeftInFrame -= elapsed;\n    if (this._timeLeftInFrame <= 0) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._timeLeftInFrame = this.speed;\n    }\n\n    this._updateValues();\n    const current = this.sprites[this.currentFrame];\n    if (current) {\n      this.width = current.width;\n      this.height = current.height;\n      this.drawWidth = current.drawWidth;\n      this.drawHeight = current.drawHeight;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  /**\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the animation with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const animOptions = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      currSprite.draw(animOptions);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(animOptions);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\n/**\n * @deprecated Use [[Animation]]\n */\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n * @deprecated Use [[Animation]]\n */\n@obsolete({\n  message: 'Animation will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Animation'\n})\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\n/**\n * Enum representing the text direction, useful for other languages, or writing text in reverse\n */\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\n/**\n * Font rendering option\n */\nexport interface FontOptions {\n  /**\n   * Optionally the size of the font in the specified [[FontUnit]] by default 10.\n   */\n  size?: number;\n  /**\n   * Optionally specify unit to measure fonts in, by default Pixels\n   */\n  unit?: FontUnit;\n  /**\n   * Optionally specify the font family, by default 'sans-serif'\n   */\n  family?: string;\n  /**\n   * Optionally specify the font style, by default Normal\n   */\n  style?: FontStyle;\n  /**\n   * Optionally set whether the font is bold, by default false\n   */\n  bold?: boolean;\n  /**\n   * Optionally specify the text align, by default Left\n   */\n  textAlign?: TextAlign;\n  /**\n   * Optionally specify the text base align, by default Alphabetic\n   */\n  baseAlign?: BaseAlign;\n  /**\n   * Optionally specify the text direction, by default LeftToRight\n   */\n  direction?: Direction;\n  /**\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\n   * Higher quality text has a higher memory impact\n   */\n  quality?: number;\n  /**\n   * Optionally specify a text shadow, by default none is specified\n   */\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\n/**\n * @internal\n */\nexport interface FontRenderer {\n  measureText(text: string): BoundingBox;\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\nimport { Logger } from '..';\n\n\n/**\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\n * and have space between them.\n */\nexport interface SpriteSheetSpacingDimensions {\n  /**\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\n   * Default is (0, 0)\n   */\n  originOffset?: { x?: number, y?: number };\n\n  /**\n   * The margin between sprites.\n   * Default is (0, 0)\n   */\n  margin?: {x?: number, y?: number};\n}\n\n/**\n * Sprite sheet options for slicing up images\n */\nexport interface SpriteSheetGridOptions {\n  /**\n   * Source image to use for each sprite\n   */\n  image: ImageSource;\n  /**\n   * Grid definition for the sprite sheet\n   */\n  grid: {\n    /**\n     * Number of rows in the sprite sheet\n     */\n    rows: number;\n    /**\n     * Number of columns in the sprite sheet\n     */\n    columns: number;\n    /**\n     * Width of each individual sprite\n     */\n    spriteWidth: number;\n    /**\n     * Height of each individual sprite\n     */\n    spriteHeight: number;\n  };\n  /**\n   * Optionally specify any spacing information between sprites\n   */\n  spacing?: SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetOptions {\n  /**\n   * Source sprites for the sprite sheet\n   */\n  sprites: Sprite[];\n  /**\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\n   */\n  rows?: number;\n  /**\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\n   */\n  columns?: number;\n}\n\n/**\n * Represents a collection of sprites from a source image with some organization in a grid\n */\nexport class SpriteSheet {\n  private _logger = Logger.getInstance();\n  public readonly sprites: Sprite[] = [];\n  public readonly rows: number;\n  public readonly columns: number;\n\n  /**\n   * Build a new sprite sheet from a list of sprites\n   *\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\n   * @param options\n   */\n  constructor(options: SpriteSheetOptions) {\n    const { sprites, rows, columns } = options;\n    this.sprites = sprites;\n    this.rows = rows ?? 1;\n    this.columns = columns ?? this.sprites.length;\n  }\n\n  /**\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\n   * @param x\n   * @param y\n   */\n  public getSprite(x: number, y: number): Sprite | null {\n    if (x >= this.columns || x < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\n      return null;\n    }\n    if (y >= this.rows || y < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\n      return null;\n    }\n    const spriteIndex = x + y * this.columns;\n    return this.sprites[spriteIndex];\n  }\n\n  /**\n   * To a graphics sprite sheet from a legacy sprite sheet\n   */\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\n    return new SpriteSheet({\n      sprites\n    });\n  }\n\n  /**\n   * @deprecated\n   * @param spriteSheet\n   */\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\n    return new LegacySpriteSheet(sprites);\n  }\n\n  /**\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\n   *\n   * Example:\n   * ```\n   * const spriteSheet = SpriteSheet.fromImageSource({\n   *   image: imageSource,\n   *   grid: {\n   *     rows: 5,\n   *     columns: 2,\n   *     spriteWidth: 32, // pixels\n   *     spriteHeight: 32 // pixels\n   *   },\n   *   // Optionally specify spacing\n   *   spacing: {\n   *     // pixels from the top left to start the sprite parsing\n   *     originOffset: {\n   *       x: 5,\n   *       y: 5\n   *     },\n   *     // pixels between each sprite while parsing\n   *     margin: {\n   *       x: 1,\n   *       y: 1\n   *     }\n   *   }\n   * })\n   * ```\n   *\n   * @param options\n   */\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\n    const sprites: Sprite[] = [];\n    options.spacing = options.spacing ?? {};\n    const {\n      image,\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\n      spacing: { originOffset, margin }\n    } = options;\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\n    const marginDefaults = { x: 0, y: 0, ...margin};\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        sprites[x + y * cols] = new Sprite({\n          image: image,\n          sourceView: {\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\n            width: spriteWidth,\n            height: spriteHeight\n          },\n          destSize: { height: spriteHeight, width: spriteWidth }\n        });\n      }\n    }\n    return new SpriteSheet({\n      sprites: sprites,\n      rows: rows,\n      columns: cols\n    });\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\nimport { BoundingBox, Color } from '..';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritesheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text: string = '';\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n  }\n\n  private _alreadyWarnedAlphabet = false;\n  private _alreadyWarnedSpriteSheet = false;\n  private _getCharacterSprites(text: string): Sprite[] {\n    const results: Sprite[] = [];\n    // handle case insensitive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        if (!this._alreadyWarnedAlphabet) {\n          this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedAlphabet = true;\n        }\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        if (!this._alreadyWarnedSpriteSheet) {\n          this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedSpriteSheet = true;\n        }\n      }\n    }\n    return results;\n  }\n\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const sprites = this._getCharacterSprites(maxWidthLine);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    return BoundingBox.fromDimension(width, height * lines.length, Vector.Zero);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let xCursor = 0;\n    let yCursor = 0;\n    let height = 0;\n    const lines = this._text.split('\\n');\n    for (const line of lines) {\n      for (const sprite of this._getCharacterSprites(line)) {\n        // draw it in the right spot and increase the cursor by sprite width\n        sprite.draw(ex, x + xCursor, y + yCursor);\n        xCursor += sprite.width + this.spacing;\n        height = Math.max(height, sprite.height);\n      }\n      xCursor = 0;\n      yCursor += height;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, _color: Color, x: number, y: number) {\n    // SpriteFont doesn't support _color, yet...\n    this._text = text;\n    const bounds = this.measureText(text);\n    this.width = bounds.width;\n    this.height = bounds.height;\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\nimport { Vector } from '../..';\nimport debugFont from './debug-font.png';\n\n/**\n * Internal debugtext helper\n */\nexport class DebugText {\n  constructor() {\n    this.load();\n  }\n\n  /**\n   * base64 font\n   */\n  public readonly fontSheet = debugFont;\n  public size: number = 16;\n  private _imageSource: ImageSource;\n  private _spriteSheet: SpriteSheet;\n  private _spriteFont: SpriteFont;\n  public load() {\n    this._imageSource = new ImageSource(this.fontSheet);\n    return this._imageSource.load().then(() => {\n      this._spriteSheet = SpriteSheet.fromImageSource({\n        image: this._imageSource,\n        grid: {\n          rows: 3,\n          columns: 16,\n          spriteWidth: 16,\n          spriteHeight: 16\n        }\n      });\n      this._spriteFont = new SpriteFont({\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\n        caseInsensitive: true,\n        spriteSheet: this._spriteSheet,\n        spacing: -6\n      });\n    });\n  }\n\n  /**\n   * Writes debug text using the built in sprint font\n   * @param ctx\n   * @param text\n   * @param pos\n   */\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\n    if (this._imageSource.isLoaded()) {\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\n    }\n  }\n}\n","export default \"data:image/png;base64,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\"","export class RenderSource {\n  constructor(\n    private _gl: WebGLRenderingContext,\n    private _texture: WebGLTexture) {}\n\n  public use() {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\n  }\n\n  public disable() {\n    const gl = this._gl;\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","import { RenderSource } from './render-source';\n\nexport class RenderTarget {\n  width: number;\n  height: number;\n  private _gl: WebGLRenderingContext;\n  constructor(options: {gl: WebGLRenderingContext, width: number, height: number}) {\n    this.width = options.width;\n    this.height = options.height;\n    this._gl = options.gl;\n    this._setupFramebuffer();\n  }\n\n  setResolution(width: number, height: number) {\n    const gl = this._gl;\n    this.width = width;\n    this.height = height;\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n  }\n\n  private _frameBuffer: WebGLFramebuffer;\n  public get frameBuffer() {\n    return this._frameBuffer;\n  }\n  private _frameTexture: WebGLTexture;\n  public get frameTexture() {\n    return this._frameTexture;\n  }\n  private _setupFramebuffer() {\n    // Allocates frame buffer\n    const gl = this._gl;\n    this._frameTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n    // set the filtering so we don't need mips\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\n    // attach the texture as the first color attachment\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\n\n    // After this bind all draw calls will draw to this framebuffer texture\n    this._frameBuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\n    // Reset after initialized\n    this.disable();\n  }\n\n  public toRenderSource() {\n    const source = new RenderSource(this._gl, this._frameTexture);\n    return source;\n  }\n\n  /**\n   * When called, all drawing gets redirected to this render target\n   */\n  public use() {\n    const gl = this._gl;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    // very important to set the viewport to the size of the framebuffer texture\n    gl.viewport(0, 0, this.width, this.height);\n  }\n\n  /**\n   * When called, all drawing is sent back to the canvas\n   */\n  public disable() {\n    const gl = this._gl;\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","\n/**\n * Must be accessed after Engine construction time to ensure the context has been created\n */\nexport class ExcaliburWebGLContextAccessor {\n  private static _GL: WebGLRenderingContext;\n  public static clear() {\n    ExcaliburWebGLContextAccessor._GL = null;\n  }\n  public static register(gl: WebGLRenderingContext) {\n    ExcaliburWebGLContextAccessor._GL = gl;\n  }\n  // current webgl context\n  public static get gl(): WebGLRenderingContext {\n    if (!ExcaliburWebGLContextAccessor._GL) {\n      throw Error('Attempted gl access before init');\n    }\n    return ExcaliburWebGLContextAccessor._GL;\n  }\n}","import { Vector } from '../..';\nimport { Matrix } from '../../Math/matrix';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\n\nexport type UniformTypeNames =\n  'uniform1f' |\n  'uniform1i' |\n  'uniform2f' |\n  'uniform2i' |\n  'uniform3f' |\n  'uniform3i' |\n  'uniform4f' |\n  'uniform4i' |\n  'uniform1fv' |\n  'uniform1iv' |\n  'uniform2fv' |\n  'uniform2iv' |\n  'uniform3fv' |\n  'uniform3iv' |\n  'uniform4fv' |\n  'uniform4iv' |\n  'uniformMatrix2fv' |\n  'uniformMatrix3fv' |\n  'uniformMatrix4fv';\n\ntype RemoveFirstFromTuple<T extends any[]> =\n  T['length'] extends 0 ? undefined :\n    (((...b: T) => void) extends (a: any, ...b: infer I) => void ? I : [])\n\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>\n\nexport interface UniformDefinition {\n  name: string;\n  glType: number;\n  location: WebGLUniformLocation;\n}\n\n\nexport interface VertexAttributeDefinition {\n  /**\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\n   */\n  name: string;\n  /**\n   * Number of components for a given attribute\n   * Must be 1, 2, 3, or 4\n   *\n   * For example a vec4 attribute would be `4` floats, so 4\n   */\n  size: number;\n  /**\n   * Supported types in webgl 1\n   * * gl.BYTE\n   * * gl.SHORT\n   * * gl.UNSIGNED_BYTE\n   * * gl.UNSIGNED_SHORT\n   * * gl.FLOAT\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n   */\n  glType: number;\n  /**\n   * Is the attribute normalized between (0-1)\n   */\n  normalized: boolean;\n  /**\n   * Location index in the shader program\n   */\n  location: number;\n}\n\nexport interface ShaderOptions {\n  vertexSource: string;\n  fragmentSource: string;\n}\n\nexport class Shader {\n  private static _ACTIVE_SHADER_INSTANCE: Shader = null;\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  public program: WebGLProgram;\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\n  private _compiled = false;\n  public readonly vertexSource: string;\n  public readonly fragmentSource: string;\n\n  public get compiled() {\n    return this._compiled;\n  }\n\n  /**\n   * Create a shader program in excalibur\n   * @param options specify shader vertex and fragment source\n   */\n  constructor(options?: ShaderOptions) {\n    const { vertexSource, fragmentSource } = options;\n    this.vertexSource = vertexSource;\n    this.fragmentSource = fragmentSource;\n  }\n\n  /**\n   * Binds the shader program\n   */\n  use() {\n    const gl = this._gl;\n    gl.useProgram(this.program);\n    Shader._ACTIVE_SHADER_INSTANCE = this;\n  }\n\n  isCurrentlyBound() {\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\n  }\n\n  /**\n   * Compile the current shader against a webgl context\n   */\n  compile(): WebGLProgram {\n    const gl = this._gl;\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\n\n    const attributes = this.getAttributes();\n    for (const attribute of attributes) {\n      this.attributes[attribute.name] = attribute;\n    }\n    const uniforms = this.getUniforms();\n    for (const uniform of uniforms) {\n      this.uniforms[uniform.name] = uniform;\n    }\n\n    this._compiled = true;\n    return this.program;\n  }\n\n  getUniforms(): UniformDefinition[] {\n    const gl = this._gl;\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n    const uniforms: UniformDefinition[] = [];\n    for (let i = 0; i < uniformCount; i++) {\n      const uniform = gl.getActiveUniform(this.program, i);\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\n      uniforms.push({\n        name: uniform.name,\n        glType: uniform.type,\n        location: uniformLocation\n      });\n    }\n    return uniforms;\n  }\n\n  getAttributes(): VertexAttributeDefinition[] {\n    const gl = this._gl;\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n    const attributes: VertexAttributeDefinition[] = [];\n    for (let i = 0; i < attributeCount; i++) {\n      const attribute = gl.getActiveAttrib(this.program, i);\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\n      attributes.push({\n        name: attribute.name,\n        glType: getAttributePointerType(gl, attribute.type),\n        size: getAttributeComponentSize(gl, attribute.type),\n        location: attributeLocation,\n        normalized: false\n      });\n    }\n    return attributes;\n  }\n\n  /**\n   * Set a texture in a gpu texture slot\n   * @param slotNumber\n   * @param texture\n   */\n  setTexture(slotNumber: number, texture: WebGLTexture) {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n  }\n\n  /**\n   * Set an integer uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformInt(name: string, value: number) {\n    this.setUniform('uniform1i', name, ~~value);\n  }\n\n  /**\n   * Set an integer array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformIntArray(name: string, value: number[]) {\n    this.setUniform('uniform1iv', name, value);\n  }\n\n  /**\n   * Set a boolean uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformBoolean(name: string, value: boolean) {\n    this.setUniform('uniform1i', name, value ? 1 : 0);\n  }\n\n  /**\n   * Set a float uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloat(name: string, value: number) {\n    this.setUniform('uniform1f', name, value);\n  }\n\n  /**\n   * Set a float array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatArray(name: string, value: number[]) {\n    this.setUniform('uniform1fv', name, value);\n  }\n\n  /**\n   * Set a [[Vector]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatVector(name: string, value: Vector) {\n    this.setUniform('uniform2f', name, value.x, value.y);\n  }\n\n  /**\n   * Set an [[Matrix]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformMatrix(name: string, value: Matrix) {\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\n  }\n\n  /**\n   * Set any available uniform type in webgl\n   *\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\n   */\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\n    if (!this._compiled) {\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\n    }\n    if (!this.isCurrentlyBound()) {\n      throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\n      ' must call `shader.use()` before setting uniforms');\n    }\n    const gl = this._gl;\n    const location = gl.getUniformLocation(this.program, name);\n    if (location) {\n      const args = [location, ...value];\n      this._gl[uniformType].apply(this._gl, args);\n    } else {\n      throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,`+\n      ' unused uniforms are optimized away by most browsers');\n    }\n  }\n\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n    const program = gl.createProgram();\n    if (program === null) {\n      throw Error('Could not create graphics shader program');\n    }\n\n    // attach the shaders.\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n\n    // link the program.\n    gl.linkProgram(program);\n\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (!success) {\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\n    }\n\n    return program;\n  }\n\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\n    const shader = gl.createShader(type);\n    if (shader === null) {\n      throw Error(`Could not build shader: [${source}]`);\n    }\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n    if (!success) {\n      const errorInfo = gl.getShaderInfoLog(shader);\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\n    }\n    return shader;\n  }\n\n  private _processSourceForError(source: string, errorInfo: string) {\n    const lines = source.split('\\n');\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\n    const [_, error2] = errorInfo.slice(errorLineStart, errorLineEnd).split(':').map(v => Number(v));\n    for (let i = 0; i < lines.length; i++) {\n      lines[i] = `${i+1}: ${lines[i]}${error2 === (i+1)? ' <----- ERROR!' : ''}`;\n    }\n\n    return '\\n\\nSource:\\n' + lines.join('\\n');\n  }\n}","import { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\nexport interface VertexBufferOptions {\n  /**\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\n   *\n   * Ignored if data is passed directly\n   */\n  size?: number;\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  type?: 'static' | 'dynamic';\n\n  /**\n   * Optionally pass pre-seeded data, size parameter is ignored\n   */\n  data?: Float32Array\n}\n\n/**\n * Helper around vertex buffer to simplify creating and uploading geometry\n *\n * Under the hood uses Float32Array\n */\nexport class VertexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n\n  /**\n   * Access to the webgl buffer handle\n   */\n  public readonly buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the vertex buffer\n   */\n  public readonly bufferData: Float32Array;\n\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  public type: 'static' | 'dynamic' = 'dynamic';\n\n  constructor(options: VertexBufferOptions) {\n    const { size, type, data } = options;\n    this.buffer = this._gl.createBuffer();\n    if (!data && !size) {\n      throw Error('Must either provide data or a size to the VertexBuffer');\n    }\n\n    if (!data) {\n      this.bufferData = new Float32Array(size);\n    } else {\n      this.bufferData = data;\n    }\n    this.type = type ?? this.type;\n  }\n\n  /**\n   * Bind this vertex buffer\n   */\n  bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n  }\n\n  /**\n   * Upload vertex buffer geometry to the GPU\n   */\n  upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\n  }\n}","import { Logger } from '../..';\nimport { Shader, VertexAttributeDefinition } from './shader';\nimport { VertexBuffer } from './vertex-buffer';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getGlTypeSizeBytes } from './webgl-util';\n\n\nexport interface VertexLayoutOptions {\n  /**\n   * Shader that this layout will be for\n   */\n  shader: Shader;\n  /**\n   * Vertex buffer to use for vertex data\n   */\n  vertexBuffer: VertexBuffer,\n  /**\n   * Specify the attributes that will exist in the vertex buffer\n   *\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\n   */\n  attributes: [name: string, numberOfComponents: number][]\n}\n\n/**\n * Helper around creating vertex attributes in a given [[VertexBuffer]], this is useful for describing\n * the memory layout for your vertices inside a particular buffer\n *\n * Note: This helper assumes interleaved attributes in one [[VertexBuffer]], not many.\n *\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\n */\nexport class VertexLayout {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger = Logger.getInstance();\n  private _shader: Shader;\n  private _layout: VertexAttributeDefinition[] = [];\n  private _attributes: [name: string, numberOfComponents: number][] = [];\n  private _vertexBuffer: VertexBuffer;\n  public get vertexBuffer() {\n    return this._vertexBuffer;\n  }\n\n  public get attributes(): readonly [name: string, numberOfComponents: number][] {\n    return this._attributes;\n  }\n\n  constructor(options: VertexLayoutOptions) {\n    const {shader, vertexBuffer, attributes} = options;\n    this._vertexBuffer = vertexBuffer;\n    this._attributes = attributes;\n    this._shader = shader;\n    this.initialize();\n  }\n\n  private _vertexTotalSizeBytes = 0;\n  /**\n   * Total number of bytes that the vertex will take up\n   */\n  public get totalVertexSizeBytes(): number {\n    return this._vertexTotalSizeBytes;\n  }\n\n  /**\n   * Layouts need shader locations and must be bound to a shader\n   */\n  initialize() {\n    if (!this._shader.compiled) {\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\n    }\n    this._layout.length = 0;\n    const shaderAttributes = this._shader.attributes;\n    for (const attribute of this._attributes) {\n      const attrib = shaderAttributes[attribute[0]];\n      if (!attrib) {\n        throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}`+\n        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\n      }\n      if (attrib.size !== attribute[1]) {\n        throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],`\n        +` doesnt match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\n      }\n      this._layout.push(attrib);\n    }\n\n    // calc size\n    let componentsPerVertex = 0;\n    for (const vertAttribute of this._layout) {\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\n      componentsPerVertex += vertAttribute.size;\n    }\n\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\n      this._logger.warn(`The vertex component size (${componentsPerVertex})  does divide evenly into the specified vertex buffer`\n      +` (${this._vertexBuffer.bufferData.length})`);\n    }\n  }\n\n  /**\n   * Bind this layout with it's associated vertex buffer\n   *\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\n   */\n  use(uploadBuffer = false) {\n    const gl = this._gl;\n    if (!this._shader.isCurrentlyBound()) {\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\n    }\n    this._vertexBuffer.bind();\n    if (uploadBuffer) {\n      this._vertexBuffer.upload();\n    }\n    let offset = 0;\n    // TODO switch to VAOs if the extension is\n    for (const vert of this._layout) {\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\n      gl.enableVertexAttribArray(vert.location);\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\n    }\n  }\n}","export class GraphicsDiagnostics {\n  public static DrawCallCount: number = 0;\n  public static DrawnImagesCount: number = 0;\n  public static clear(): void {\n    GraphicsDiagnostics.DrawCallCount = 0;\n    GraphicsDiagnostics.DrawnImagesCount = 0;\n  }\n}\n","import { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport lineVertexSource from './line-vertex.glsl';\nimport lineFragmentSource from './line-fragment.glsl';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class LineRenderer implements RendererPlugin {\n  public readonly type = 'ex.line';\n  public priority: number = 0;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _maxLines: number = 10922;\n  private _vertexBuffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _vertexIndex = 0;\n  private _lineCount = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: lineVertexSource,\n      fragmentSource: lineFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    this._vertexBuffer = new VertexBuffer({\n      size: 6 * 2 * this._maxLines,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      vertexBuffer: this._vertexBuffer,\n      shader: this._shader,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4]\n      ]\n    });\n  }\n\n  draw(start: Vector, end: Vector, color: Color): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._lineCount++;\n\n    const transform = this._context.getTransform();\n    const finalStart = transform.multiply(start);\n    const finalEnd = transform.multiply(end);\n\n\n    const vertexBuffer = this._vertexBuffer.bufferData;\n    // Start\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n\n    // End\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n  }\n\n  private _isFull() {\n    if (this._lineCount >= this._maxLines) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._lineCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._lineCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\n\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // reset\n    this._vertexIndex = 0;\n    this._lineCount = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\n\\nvarying lowp vec4 v_color;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Passthrough the color\\n   v_color = a_color;\\n}\";","export default \"precision mediump float;\\n\\n// Color\\nvarying lowp vec4 v_color;\\n\\n\\nvoid main() {\\n  gl_FragColor = v_color;\\n}\";","import pointVertexSource from './point-vertex.glsl';\nimport pointFragmentSource from './point-fragment.glsl';\nimport { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class PointRenderer implements RendererPlugin {\n  public readonly type = 'ex.point';\n  public priority: number = 0;\n  private _shader: Shader;\n  private _maxPoints: number = 10922;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _pointCount: number = 0;\n  private _vertexIndex: number = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: pointVertexSource,\n      fragmentSource: pointFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n    this._buffer = new VertexBuffer({\n      size: 7 * this._maxPoints,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4],\n        ['a_size', 1]\n      ]\n    });\n  }\n\n  draw(point: Vector, color: Color, size: number): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._pointCount++;\n\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const finalPoint = transform.multiply(point);\n\n    const vertexBuffer = this._buffer.bufferData;\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\n  }\n\n  private _isFull() {\n    if (this._pointCount >= this._maxPoints) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._pointCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._pointCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    this._pointCount = 0;\n    this._vertexIndex = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\nattribute float a_size;\\nvarying lowp vec4 v_color;\\nuniform mat4 u_matrix;\\n\\nvoid main() {\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n  gl_PointSize = a_size * 2.0;\\n  v_color = a_color;\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision mediump float;\\nvarying lowp vec4 v_color;\\n\\nvoid main() {\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\n  r = dot(cxy, cxy);\\n\\n#ifdef GL_OES_standard_derivatives\\n  delta = fwidth(r);\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\n#else\\n  if (r > 1.0) {\\n    discard;\\n  }\\n#endif\\n  // \\\"premultiply\\\" the color by alpha\\n  vec4 color = v_color;\\n  color.a = color.a * alpha;\\n  color.rgb = color.rgb * color.a;\\n  gl_FragColor = color;\\n}\";","\nimport screenVertex from './screen-vertex.glsl';\nimport screenFragment from './screen-fragment.glsl';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\n\n/**\n * This is responsible for painting the entire screen during the render passes\n */\nexport class ScreenPassPainter {\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(gl: WebGLRenderingContext) {\n    this._gl = gl;\n    this._shader = new Shader({\n      vertexSource: screenVertex,\n      fragmentSource: screenFragment\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\n    const gl = this._gl;\n    postprocessor.getShader().use();\n    postprocessor.getLayout().use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  renderToScreen(): void {\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}","export default \"attribute vec2 a_position;\\n\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\nvoid main() {\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\n\\n  // Pass the texcoord to the fragment shader.\\n  v_texcoord = a_texcoord;\\n}\";","export default \"precision mediump float;\\n\\n// Passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// The texture.\\nuniform sampler2D u_texture;\\n\\nvoid main() {\\n   gl_FragColor = texture2D(u_texture, v_texcoord);\\n}\";","import { Logger } from '../..';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\n/**\n * Helper that defines and index buffer for quad geometry\n *\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\n * it is almost always worth it in terms of performance to use an index buffer.\n */\nexport class QuadIndexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Access to the webgl buffer handle\n   */\n  public buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the index buffer\n   */\n  public bufferData: Uint16Array | Uint32Array;\n  /**\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\n   */\n  public bufferGlType: number;\n\n  /**\n   * @param numberOfQuads Specify the max number of quads you want to draw\n   * @param useUint16 Optionally force a uint16 buffer\n   */\n  constructor(numberOfQuads: number, useUint16?: boolean) {\n    const gl = this._gl;\n    this.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n\n    const totalVertices = numberOfQuads * 6;\n\n    const ext = gl.getExtension('OES_element_index_uint');\n    if (ext && !useUint16) {\n      this.bufferData = new Uint32Array(totalVertices);\n    } else {\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\n      const maxUint16 = 65_535;\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\n\n      this.bufferGlType = gl.UNSIGNED_SHORT;\n      this.bufferData = new Uint16Array(totalVertices);\n      // TODO Should we error if this happens?? maybe not might crash mid game\n      if (numberOfQuads > maxUint16Index) {\n        this._logger.warn(\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\n      }\n    }\n\n\n    let currentQuad = 0;\n    for (let i = 0; i < totalVertices; i += 6) {\n      // first triangle\n      this.bufferData[i + 0] = currentQuad + 0;\n      this.bufferData[i + 1] = currentQuad + 1;\n      this.bufferData[i + 2] = currentQuad + 2;\n      // second triangle\n      this.bufferData[i + 3] = currentQuad + 2;\n      this.bufferData[i + 4] = currentQuad + 1;\n      this.bufferData[i + 5] = currentQuad + 3;\n      currentQuad += 4;\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  public get size() {\n    return this.bufferData.length;\n  }\n\n  /**\n   * Upload data to the GPU\n   */\n  public upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  /**\n   * Bind this index buffer\n   */\n  public bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n  }\n}","import { vec } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { TextureLoader } from '../texture-loader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { ensurePowerOfTwo } from '../webgl-util';\nimport frag from './image-renderer.frag.glsl';\nimport vert from './image-renderer.vert.glsl';\n\nexport class ImageRenderer implements RendererPlugin {\n  public readonly type = 'ex.image';\n  public priority: number = 0;\n\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\n  private _maxTextures: number = 0;\n\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  // Per flush vars\n  private _imageCount: number = 0;\n  private _textures: WebGLTexture[] = [];\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    // Transform shader source\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\n    this._maxTextures = Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS), 125);\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\n    // Compile shader\n    this._shader = new Shader({\n      fragmentSource: transformedFrag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\n    this._shader.setUniformIntArray(\n      'u_textures',\n      [...Array(this._maxTextures)].map((_, i) => i)\n    );\n\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      size: 6 * 4 * this._maxImages, // 6 components * 4 verts\n      type: 'dynamic'\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_opacity', 1],\n        ['a_texcoord', 2],\n        ['a_textureIndex', 1]\n      ]\n    });\n\n    // Setup index buffer\n    this._quads = new QuadIndexBuffer(this._maxImages, true);\n  }\n\n  private _transformFragmentSource(source: string, maxTextures: number): string {\n    let newSource = source.replace('%%count%%', maxTextures.toString());\n    let texturePickerBuilder = '';\n    for (let i = 0; i < maxTextures; i++) {\n      if (i === 0) {\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\n      } else {\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\n      }\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\n      texturePickerBuilder += `   }\\n`;\n    }\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\n    return newSource;\n  }\n\n  private _addImageAsTexture(image: HTMLImageSource) {\n    const texture = TextureLoader.load(image);\n    if (this._textures.indexOf(texture) === -1) {\n      this._textures.push(texture);\n    }\n  }\n\n  private _bindTextures(gl: WebGLRenderingContext) {\n    // Bind textures in the correct order\n    for (let i = 0; i < this._maxTextures; i++) {\n      gl.activeTexture(gl.TEXTURE0 + i);\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\n    }\n  }\n\n  private _getTextureIdForImage(image: HTMLImageSource) {\n    if (image) {\n      return this._textures.indexOf(TextureLoader.get(image));\n    }\n    return -1;\n  }\n\n  private _isFull() {\n    if (this._imageCount >= this._maxImages) {\n      return true;\n    }\n    if (this._textures.length >= this._maxTextures) {\n      return true;\n    }\n    return false;\n  }\n\n\n  draw(image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number): void {\n\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._imageCount++;\n    this._addImageAsTexture(image);\n\n    let width = image?.width || swidth || 0;\n    let height = image?.height || sheight || 0;\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n    let dest = [sx ?? 1, sy ?? 1];\n    // If destination is specified, update view and dest\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n      dest = [dx, dy];\n      width = dwidth;\n      height = dheight;\n    }\n\n    sx = view[0];\n    sy = view[1];\n    const sw = view[2];\n    const sh = view[3];\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n    const snapToPixel = this._context.snapToPixel;\n\n    let topLeft = vec(dest[0], dest[1]);\n    let topRight = vec(dest[0] + width, dest[1]);\n    let bottomLeft = vec(dest[0], dest[1] + height);\n    let bottomRight = vec(dest[0] + width, dest[1] + height);\n\n    topLeft = transform.multiply(topLeft);\n    topRight = transform.multiply(topRight);\n    bottomLeft = transform.multiply(bottomLeft);\n    bottomRight = transform.multiply(bottomRight);\n\n    if (snapToPixel) {\n      topLeft.x = ~~topLeft.x;\n      topLeft.y = ~~topLeft.y;\n\n      topRight.x = ~~topRight.x;\n      topRight.y = ~~topRight.y;\n\n      bottomLeft.x = ~~bottomLeft.x;\n      bottomLeft.y = ~~bottomLeft.y;\n\n      bottomRight.x = ~~bottomRight.x;\n      bottomRight.y = ~~bottomRight.y;\n    }\n\n    const textureId = this._getTextureIdForImage(image);\n    const potWidth = ensurePowerOfTwo(image.width || width);\n    const potHeight = ensurePowerOfTwo(image.height || height);\n\n    const uvx0 = (sx) / potWidth;\n    const uvy0 = (sy) / potHeight;\n    const uvx1 = (sx + sw - 0.01) / potWidth;\n    const uvy1 = (sy + sh - 0.01) / potHeight;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._imageCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._imageCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind textures to\n    this._bindTextures(gl);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._imageCount = 0;\n    this._vertexIndex = 0;\n    this._textures.length = 0;\n  }\n}","export default \"precision mediump float;\\n\\n// UV coord\\nvarying vec2 v_texcoord;\\n\\n// Texture index\\nvarying lowp float v_textureIndex;\\n\\n// Textures in the current draw\\nuniform sampler2D u_textures[%%count%%];\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n   // In order to support the most efficient sprite batching, we have multiple\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\n   // that do not apply to a particular sprite.\\n\\n   vec4 color = vec4(1.0, 0, 0, 1.0);\\n\\n   // GLSL is templated out to pick the right texture and set the vec4 color\\n   %%texture_picker%%\\n\\n   color.rgb = color.rgb * v_opacity;\\n   color.a = color.a * v_opacity;\\n   gl_FragColor = color;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\n// UV coordinate\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\n// Texture number\\nattribute lowp float a_textureIndex;\\nvarying lowp float v_textureIndex;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the UV coord to the fragment shader\\n   v_texcoord = a_texcoord;\\n   // Pass through the texture number to the fragment shader\\n   v_textureIndex = a_textureIndex;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './rectangle-renderer.frag.glsl';\nimport vert from './rectangle-renderer.vert.glsl';\n\nexport class RectangleRenderer implements RendererPlugin {\n  public readonly type = 'ex.rectangle';\n  public priority: number = 0;\n\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n  private _rectangleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 16 * 4 * this._maxRectangles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_size', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n    this._quads = new QuadIndexBuffer(this._maxRectangles, true);\n  }\n\n  private _isFull() {\n    if (this._rectangleCount >= this._maxRectangles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(...args: any[]): void {\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\n      this.drawLine.apply(this, args);\n    } else {\n      this.drawRectangle.apply(this, args);\n    }\n  }\n\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\n\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const dir = end.sub(start);\n    const length = dir.size;\n    const normal = dir.normalize().perpendicular();\n    const halfThick = thickness / 2;\n\n    /**\n     *    +---------------------^----------------------+\n     *    |                     | (normal)             |\n     *   (startx, starty)------------------>(endx, endy)\n     *    |                                            |\n     *    + -------------------------------------------+\n     */\n    const startTop = transform.multiply(normal.scale(halfThick).add(start));\n    const startBottom = transform.multiply(normal.scale(-halfThick).add(start));\n    const endTop = transform.multiply(normal.scale(halfThick).add(end));\n    const endBottom = transform.multiply(normal.scale(-halfThick).add(end));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    const stroke = Color.Transparent;\n    const strokeThickness = 0;\n    const width = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = startTop.x;\n    vertexBuffer[this._vertexIndex++] = startTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = endTop.x;\n    vertexBuffer[this._vertexIndex++] = endTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n  }\n\n  drawRectangle(\n    pos: Vector,\n    width: number,\n    height: number,\n    color: Color,\n    stroke: Color = Color.Transparent,\n    strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n  }\n\n  hasPendingDraws(): boolean {\n    return this._rectangleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._rectangleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._rectangleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision mediump float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\nvarying vec2 v_size; // in pixels\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness; // in pixels\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\n    vec2 uv = v_uv;\\n    vec2 fragCoord = uv * v_size;\\n    float maxX = v_size.x - v_strokeThickness;\\n    float minX = v_strokeThickness;\\n    float maxY = v_size.y - v_strokeThickness;\\n    float minY = v_strokeThickness;\\n\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\n      gl_FragColor = v_color;\\n    } else {\\n      gl_FragColor = v_strokeColor;\\n    }\\n    gl_FragColor.a *= v_opacity;\\n    gl_FragColor.rgb *= gl_FragColor.a;\\n\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\n\\n    // float fHalfBorderDist      = 0.0;\\n    // float fHalfBorderThickness = 0.0;\\n\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else\\n    // {\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\n        \\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\n            \\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\n    // }\\n\\n    // vec4 v4FromColor = v_strokeColor;\\n    // v4FromColor.rgb *= v4FromColor.a;\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\n    // if (fHalfBorderDist < 0.0) {\\n    //     v4ToColor = v_color;\\n    //     v4ToColor.rgb *= v4ToColor.a;\\n    // }\\n\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\n\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\n    // gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\nattribute vec2 a_size;\\nvarying vec2 v_size;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through size\\n   v_size = a_size;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './circle-renderer.frag.glsl';\nimport vert from './circle-renderer.vert.glsl';\n\nexport class CircleRenderer implements RendererPlugin {\n  public readonly type = 'ex.circle';\n  public priority: number = 0;\n\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  private _circleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 14 * 4 * this._maxCircles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n\n    this._quads = new QuadIndexBuffer(this._maxCircles, true);\n  }\n\n  private _isFull() {\n    if (this._circleCount >= this._maxCircles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._circleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\n\n    // TODO UV could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._circleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._circleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._circleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision highp float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness;\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n  // make (0, 0) the center the uv \\n  vec2 uv = v_uv * 2.0 - 1.0;\\n\\n  vec4 color = v_color;\\n  vec4 strokeColor = v_strokeColor;\\n\\n  // circle border is at radius 1.0 \\n  // dist is > 0 when inside the circle \\n  float d = length(uv);\\n  float dist = 1.0 - length(uv);\\n\\n  // Fade based on fwidth\\n  float fade = fwidth(dot(uv, uv));\\n\\n  // if dist is greater than 0 step to 1;\\n  // when we cross this 0 threshold add a smooth fade\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\n\\n  // if dist is greater than the stroke thickness step to 1\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\n\\n  strokeColor.a *= fill * stroke;\\n  strokeColor.rgb *= strokeColor.a;\\n\\n  color.a *= fill * (1.0 - stroke);\\n  color.rgb *= color.a;\\n\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\n  finalColor.a = finalColor.a * v_opacity;\\n  gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  RectGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\n\nimport { Matrix } from '../../Math/matrix';\nimport { TransformStack } from './transform-stack';\nimport { Vector, vec } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { Logger } from '../../Util/Log';\nimport { Canvas } from '../Canvas';\nimport { DebugText } from './debug-text';\nimport { ScreenDimension } from '../../Screen';\nimport { RenderTarget } from './render-target';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { TextureLoader } from './texture-loader';\nimport { RendererPlugin } from './renderer';\n\n// renderers\nimport { LineRenderer } from './line-renderer/line-renderer';\nimport { PointRenderer } from './point-renderer/point-renderer';\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\nimport { ImageRenderer } from './image-renderer/image-renderer';\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\n\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\n\n  /**\n   * Draw a debugging rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\n  }\n\n  /**\n   * Draw a debugging line to the context\n   * @param start\n   * @param end\n   * @param lineOptions\n   */\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions.color);\n  }\n\n  /**\n   * Draw a debugging point to the context\n   * @param point\n   * @param pointOptions\n   */\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._webglCtx, text, pos);\n  }\n}\n\nexport interface WebGLGraphicsContextInfo {\n  transform: TransformStack;\n  state: StateStack;\n  ortho: Matrix;\n  context: ExcaliburGraphicsContextWebGL;\n}\n\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\n  private _logger = Logger.getInstance();\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\n  private _isDrawLifecycle = false;\n\n  // Main render target\n  private _renderTarget: RenderTarget;\n\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\n  private _postProcessTargets: RenderTarget[] = [];\n\n  private _screenRenderer: ScreenPassPainter;\n\n  private _postprocessors: PostProcessor[] = [];\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __gl: WebGLRenderingContext;\n\n  /**\n   * Holds the 2d context shim\n   */\n  private _canvas: Canvas; // Configure z for shim?\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n\n  private _transform = new TransformStack();\n  private _state = new StateStack();\n  private _ortho!: Matrix;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __lineRenderer: LineRenderer;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  // public __imageRenderer: ImageRenderer;\n\n  public snapToPixel: boolean = true;\n\n  public smoothing: boolean = false;\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public get width() {\n    return this.__gl.canvas.width;\n  }\n\n  public get height() {\n    return this.__gl.canvas.height;\n  }\n\n  public get ortho(): Matrix {\n    return this._ortho;\n  }\n\n  /**\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\n   * @param dim\n   */\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\n    let supported = true;\n    if (dim.width > 4096 || dim.height > 4096) {\n      supported = false;\n    }\n    return supported;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\n    this.__gl = canvasElement.getContext('webgl', {\n      antialias: smoothing ?? this.smoothing,\n      premultipliedAlpha: false,\n      alpha: enableTransparency ?? true,\n      depth: true,\n      powerPreference: 'high-performance'\n    });\n    ExcaliburWebGLContextAccessor.register(this.__gl);\n    TextureLoader.register(this.__gl);\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this._init();\n  }\n\n  private _init() {\n    const gl = this.__gl;\n    // Setup viewport and view matrix\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n    // Clear background\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    // Enable alpha blending\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\n    gl.enable(gl.BLEND);\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n    // Setup builtin renderers\n    this.register(new ImageRenderer());\n    this.register(new RectangleRenderer());\n    this.register(new CircleRenderer());\n    this.register(new PointRenderer());\n    this.register(new LineRenderer());\n\n    this._screenRenderer = new ScreenPassPainter(gl);\n\n    this._renderTarget = new RenderTarget({\n      gl,\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n\n\n    this._postProcessTargets = [\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      }),\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      })\n    ];\n\n    // 2D ctx shim\n    this._canvas = new Canvas({\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n    this.__ctx = this._canvas.ctx;\n  }\n\n  public register<T extends RendererPlugin>(renderer: T) {\n    this._renderers.set(renderer.type, renderer);\n    renderer.initialize(this.__gl, this);\n  }\n\n  public get(rendererName: string): RendererPlugin {\n    return this._renderers.get(rendererName);\n  }\n\n  private _currentRenderer: RendererPlugin;\n\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\n      return true;\n    }\n    return false;\n  }\n\n  public beginDrawLifecycle() {\n    this._isDrawLifecycle = true;\n  }\n\n  public endDrawLifecycle() {\n    this._isDrawLifecycle = false;\n  }\n\n  private _alreadyWarnedDrawLifecycle = false;\n\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\n    if (!this._isDrawLifecycle && !this._alreadyWarnedDrawLifecycle) {\n      this._logger.warn(\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\n        `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\n      this._alreadyWarnedDrawLifecycle = true;\n    }\n    // TODO does not handle priority yet...\n    //  in order to do this draw commands need to be captured and fed in priority order\n    const renderer = this._renderers.get(rendererName);\n    if (renderer) {\n      // Set the current renderer if not defined\n      if (!this._currentRenderer) {\n        this._currentRenderer = renderer;\n      }\n\n      if (!this._isCurrentRenderer(renderer)) {\n        // switching graphics means we must flush the previous\n        this._currentRenderer.flush();\n      }\n\n      // If we are still using the same renderer we can add to the current batch\n      renderer.draw(...args);\n\n      this._currentRenderer = renderer;\n    } else {\n      throw Error(`No renderer with name ${rendererName} has been registered`);\n    }\n  }\n\n  public resetTransform(): void {\n    this._transform.current = Matrix.identity();\n  }\n\n  public updateViewport(resolution: ScreenDimension): void {\n    const gl = this.__gl;\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\n\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\n\n    // 2D ctx shim\n    this._canvas.width = gl.canvas.width;\n    this._canvas.height = gl.canvas.height;\n  }\n\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    if (!image) {\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\n      // tslint:disable-next-line: no-console\n      if (console.trace) {\n        // tslint:disable-next-line: no-console\n        console.trace();\n      }\n      return;\n    }\n    this.draw<ImageRenderer>('ex.image', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\n  }\n\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\n\n  public save(): void {\n    this._transform.save();\n    this._state.save();\n  }\n\n  public restore(): void {\n    this._transform.restore();\n    this._state.restore();\n  }\n\n  public translate(x: number, y: number): void {\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  public rotate(angle: number): void {\n    this._transform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): void {\n    this._transform.scale(x, y);\n  }\n\n  public transform(matrix: Matrix) {\n    this._transform.current = matrix;\n  }\n\n  public getTransform(): Matrix {\n    return this._transform.current;\n  }\n\n  public multiply(m: Matrix) {\n    this._transform.current = this._transform.current.multiply(m);\n  }\n\n  public addPostProcessor(postprocessor: PostProcessor) {\n    this._postprocessors.push(postprocessor);\n    postprocessor.initialize(this.__gl);\n  }\n\n  public removePostProcessor(postprocessor: PostProcessor) {\n    const index = this._postprocessors.indexOf(postprocessor);\n    if (index !== -1) {\n      this._postprocessors.splice(index, 1);\n    }\n  }\n\n  public clearPostProcessors() {\n    this._postprocessors.length = 0;\n  }\n\n  clear() {\n    const gl = this.__gl;\n    this._renderTarget.use();\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    // Clear the context with the newly set color. This is\n    // the function call that actually does the drawing.\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  }\n\n  /**\n   * Flushes all batched rendering to the screen\n   */\n  flush() {\n    const gl = this.__gl;\n\n    // render target captures all draws and redirects to the render target\n    this._renderTarget.use();\n    // This is the final flush at the moment to draw any leftover pending draw\n    // TODO sort by priority and flush in order\n    for (const renderer of this._renderers.values()) {\n      if (renderer.hasPendingDraws()) {\n        renderer.flush();\n      }\n    }\n    this._renderTarget.disable();\n\n    // post process step\n    const source = this._renderTarget.toRenderSource();\n    source.use();\n\n    // flip flop render targets\n    for (let i = 0; i < this._postprocessors.length; i++) {\n      this._postProcessTargets[i % 2].use();\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\n      this._postProcessTargets[i % 2].toRenderSource().use();\n    }\n\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    this._screenRenderer.renderToScreen();\n  }\n}\n","import { Vector, vec } from './Math/vector';\nimport { Logger } from './Util/Log';\nimport { Camera } from './Camera';\nimport { BrowserEvents } from './Util/Browser';\nimport { BoundingBox } from './Collision/Index';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { getPosition } from './Util/Util';\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\n\n/**\n * Enum representing the different display modes available to Excalibur.\n */\nexport enum DisplayMode {\n  /**\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\n   */\n  Fixed = 'Fixed',\n\n  /**\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\n   *\n   * You may want to center your game here is an example\n   * ```html\n   * <!-- html -->\n   * <body>\n   * <main>\n   *   <canvas id=\"game\"></canvas>\n   * </main>\n   * </body>\n   * ```\n   *\n   * ```css\n   * // css\n   * main {\n   *   display: flex;\n   *   align-items: center;\n   *   justify-content: center;\n   *   height: 100%;\n   *   width: 100%;\n   * }\n   * ```\n   *\n   */\n  FitScreen = 'FitScreen',\n\n  /**\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\n   */\n  FillScreen = 'FillScreen',\n\n  /**\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\n   */\n  FitContainer = 'FitContainer',\n\n  /**\n   * Use the parent DOM container's css width/height for the game resolution dynamically\n   */\n  FillContainer = 'FillContainer',\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\n   */\n  Position = 'Position'\n}\n\n/**\n * Convenience class for quick resolutions\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\n */\nexport class Resolution {\n  /* istanbul ignore next */\n  public static get SVGA(): ScreenDimension {\n    return { width: 800, height: 600 };\n  }\n\n  /* istanbul ignore next */\n  public static get Standard(): ScreenDimension {\n    return { width: 1920, height: 1080 };\n  }\n\n  /* istanbul ignore next */\n  public static get Atari2600(): ScreenDimension {\n    return { width: 160, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoy(): ScreenDimension {\n    return { width: 160, height: 144 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoyAdvance(): ScreenDimension {\n    return { width: 240, height: 160 };\n  }\n\n  /* istanbul ignore next */\n  public static get NintendoDS(): ScreenDimension {\n    return { width: 256, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get NES(): ScreenDimension {\n    return { width: 256, height: 224 };\n  }\n\n  /* istanbul ignore next */\n  public static get SNES(): ScreenDimension {\n    return { width: 256, height: 244 };\n  }\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\nexport type CanvasPosition = string | AbsolutePosition;\n\nexport interface ScreenDimension {\n  width: number;\n  height: number;\n}\n\nexport interface ScreenOptions {\n  /**\n   * Canvas element to build a screen on\n   */\n  canvas: HTMLCanvasElement;\n\n  /**\n   * Graphics context for the screen\n   */\n  context: ExcaliburGraphicsContext;\n\n  /**\n   * Browser abstraction\n   */\n  browser: BrowserEvents;\n  /**\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\n   */\n  antialiasing?: boolean;\n  /**\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\n   */\n  pixelRatio?: number;\n  /**\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\n   * [[DisplayMode.FillScreen]].\n   */\n  resolution?: ScreenDimension;\n  /**\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\n   */\n  viewport: ScreenDimension;\n  /**\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\n   */\n  displayMode?: DisplayMode;\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: CanvasPosition;\n}\n\n/**\n * The Screen handles all aspects of interacting with the screen for Excalibur.\n */\nexport class Screen {\n  public graphicsContext: ExcaliburGraphicsContext;\n  private _canvas: HTMLCanvasElement;\n  private _antialiasing: boolean = true;\n  private _browser: BrowserEvents;\n  private _camera: Camera;\n  private _resolution: ScreenDimension;\n  private _resolutionStack: ScreenDimension[] = [];\n  private _viewport: ScreenDimension;\n  private _viewportStack: ScreenDimension[] = [];\n  private _pixelRatioOverride: number | null = null;\n  private _position: CanvasPosition;\n  private _displayMode: DisplayMode;\n  private _isFullScreen = false;\n  private _mediaQueryList: MediaQueryList;\n  private _isDisposed = false;\n  private _logger = Logger.getInstance();\n  private _resizeObserver: ResizeObserver;\n\n  constructor(options: ScreenOptions) {\n    this.viewport = options.viewport;\n    this.resolution = options.resolution ?? { ...this.viewport };\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\n    this._canvas = options.canvas;\n    this.graphicsContext = options.context;\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\n    this._browser = options.browser;\n    this._position = options.position;\n    this._pixelRatioOverride = options.pixelRatio;\n\n    this._applyDisplayMode();\n\n    this._listenForPixelRatio();\n\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    this.applyResolutionAndViewport();\n  }\n\n  private _listenForPixelRatio() {\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\n      // Safari <=13.1 workaround, remove any existing handlers\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n    }\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n\n    // Safari <=13.1 workaround\n    if (this._mediaQueryList.addEventListener) {\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\n    } else {\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\n    }\n  }\n\n  public dispose(): void {\n    if (!this._isDisposed) {\n      // Clean up handlers\n      this._isDisposed = true;\n      this._browser.window.off('resize', this._resizeHandler);\n      if (this._resizeObserver) {\n        this._resizeObserver.disconnect();\n      }\n      this.parent.removeEventListener('resize', this._resizeHandler);\n      // Safari <=13.1 workaround\n      if (this._mediaQueryList.removeEventListener) {\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\n      } else {\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n      }\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    }\n  }\n\n  private _fullscreenChangeHandler = () => {\n    this._isFullScreen = !this._isFullScreen;\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\n  };\n\n  private _pixelRatioChangeHandler = () => {\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\n    this._listenForPixelRatio();\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\n    this.applyResolutionAndViewport();\n  };\n\n  private _resizeHandler = () => {\n    const parent = this.parent;\n    this._logger.debug('View port resized');\n    this._setResolutionAndViewportByDisplayMode(parent);\n    this.applyResolutionAndViewport();\n  };\n\n  private _calculateDevicePixelRatio() {\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    return devicePixelRatio;\n  }\n\n  // Asking the window.devicePixelRatio is expensive we do it once\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\n\n  public get pixelRatio(): number {\n    if (this._pixelRatioOverride) {\n      return this._pixelRatioOverride;\n    }\n\n    return this._devicePixelRatio;\n  }\n\n  public get isHiDpi() {\n    return this.pixelRatio !== 1;\n  }\n\n  public get displayMode(): DisplayMode {\n    return this._displayMode;\n  }\n\n  public get canvas(): HTMLCanvasElement {\n    return this._canvas;\n  }\n\n  public get parent(): HTMLElement | Window {\n    return <HTMLElement | Window>(\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\n        ? this.canvas.parentElement || document.body\n        : window)\n    );\n  }\n\n  public get resolution(): ScreenDimension {\n    return this._resolution;\n  }\n\n  public set resolution(resolution: ScreenDimension) {\n    this._resolution = resolution;\n  }\n\n  public get viewport(): ScreenDimension {\n    if (this._viewport) {\n      return this._viewport;\n    }\n    return this._resolution;\n  }\n\n  public set viewport(viewport: ScreenDimension) {\n    this._viewport = viewport;\n  }\n\n  public get aspectRatio() {\n    return this._resolution.width / this._resolution.height;\n  }\n\n  public get scaledWidth() {\n    return this._resolution.width * this.pixelRatio;\n  }\n\n  public get scaledHeight() {\n    return this._resolution.height * this.pixelRatio;\n  }\n\n  public setCurrentCamera(camera: Camera) {\n    this._camera = camera;\n  }\n\n  public pushResolutionAndViewport() {\n    this._resolutionStack.push(this.resolution);\n    this._viewportStack.push(this.viewport);\n\n    this.resolution = { ...this.resolution };\n    this.viewport = { ...this.viewport };\n  }\n\n  public peekViewport(): ScreenDimension {\n    return this._viewportStack[this._viewportStack.length - 1];\n  }\n\n  public peekResolution(): ScreenDimension {\n    return this._resolutionStack[this._resolutionStack.length - 1];\n  }\n\n  public popResolutionAndViewport() {\n    this.resolution = this._resolutionStack.pop();\n    this.viewport = this._viewportStack.pop();\n  }\n\n  private _alreadyWarned = false;\n  public applyResolutionAndViewport() {\n    this._canvas.width = this.scaledWidth;\n    this._canvas.height = this.scaledHeight;\n\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      const supported = this.graphicsContext.checkIfResolutionSupported({\n        width: this.scaledWidth,\n        height: this.scaledHeight\n      });\n      if (!supported && !this._alreadyWarned) {\n        this._alreadyWarned = true; // warn once\n        this._logger.warn(\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\n      }\n    }\n\n    if (this._antialiasing) {\n      this._canvas.style.imageRendering = 'auto';\n    } else {\n      this._canvas.style.imageRendering = 'pixelated';\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n      if (this._canvas.style.imageRendering === '') {\n        this._canvas.style.imageRendering = 'crisp-edges';\n      }\n    }\n    this._canvas.style.width = this.viewport.width + 'px';\n    this._canvas.style.height = this.viewport.height + 'px';\n\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\n    this.graphicsContext.updateViewport(this.resolution);\n    this.graphicsContext.resetTransform();\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  public get antialiasing() {\n    return this._antialiasing;\n  }\n\n  public set antialiasing(isSmooth: boolean) {\n    this._antialiasing = isSmooth;\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  /**\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\n   */\n  public get isFullScreen() {\n    return this._isFullScreen;\n  }\n\n  /**\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\n   * For example, wire this to a user click handler.\n   */\n  public goFullScreen(): Promise<void> {\n    return this._canvas.requestFullscreen();\n  }\n\n  /**\n   * Requests to exit fullscreen using the browser fullscreen api\n   */\n  public exitFullScreen(): Promise<void> {\n    return document.exitFullscreen();\n  }\n\n  /**\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\n   * Excalibur screen space.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public pageToScreenCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    if (!this._isFullScreen) {\n      newX -= getPosition(this._canvas).x;\n      newY -= getPosition(this._canvas).y;\n    }\n\n    // if fullscreen api on it centers with black bars\n    // we need to adjust the screen to world coordinates in this case\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\n        newX = (newX / window.innerWidth) * this.viewport.width;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\n        newY = (newY / window.innerHeight) * this.viewport.height;\n      }\n    }\n\n    newX = (newX / this.viewport.width) * this.resolution.width;\n    newY = (newY / this.viewport.height) * this.resolution.height;\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\n   * this is where html elements might live if you want to position them relative to Excalibur.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public screenToPageCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    newX = (newX / this.resolution.width) * this.viewport.width;\n    newY = (newY / this.resolution.height) * this.viewport.height;\n\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\n        newX = (newX / this.viewport.width) * window.innerWidth;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\n        newY = (newY / this.viewport.height) * window.innerHeight;\n      }\n    }\n\n    if (!this._isFullScreen) {\n      newX += getPosition(this._canvas).x;\n      newY += getPosition(this._canvas).y;\n    }\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\n   *\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\n   * and extends infinitely out relative from the [[Camera]].\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    // the only difference between screen & world is the camera transform\n    if (this._camera) {\n      return this._camera.inverse.multiply(point);\n    }\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  /**\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\n   *\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    if (this._camera) {\n      return this._camera.transform.multiply(point);\n    }\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  public pageToWorldCoordinates(point: Vector): Vector {\n    const screen = this.pageToScreenCoordinates(point);\n    return this.screenToWorldCoordinates(screen);\n  }\n\n  public worldToPageCoordinates(point: Vector): Vector {\n    const screen = this.worldToScreenCoordinates(point);\n    return this.screenToPageCoordinates(screen);\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   *\n   * World bounds are in world coordinates, useful for culling objects offscreen\n   */\n  public getWorldBounds(): BoundingBox {\n    const topLeft = this.screenToWorldCoordinates(Vector.Zero);\n    const right = topLeft.x + this.drawWidth;\n    const bottom = topLeft.y + this.drawHeight;\n\n    return new BoundingBox(topLeft.x, topLeft.y, right, bottom);\n  }\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this._camera) {\n      return this.resolution.width / this._camera.zoom;\n    }\n    return this.resolution.width;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this._camera) {\n      return this.resolution.height / this._camera.zoom;\n    }\n    return this.resolution.height;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  /**\n   * Returns screen center coordinates including zoom and device pixel ratio.\n   */\n  public get center(): Vector {\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\n  }\n\n  private _computeFit() {\n    document.body.style.margin = '0px';\n    document.body.style.overflow = 'hidden';\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    if (window.innerWidth / aspect < window.innerHeight) {\n      adjustedWidth = window.innerWidth;\n      adjustedHeight = window.innerWidth / aspect;\n    } else {\n      adjustedWidth = window.innerHeight * aspect;\n      adjustedHeight = window.innerHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _computeFitContainer() {\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    const parent = this.canvas.parentElement;\n    if (parent.clientWidth / aspect < parent.clientHeight) {\n      adjustedWidth = parent.clientWidth;\n      adjustedHeight = parent.clientWidth / aspect;\n    } else {\n      adjustedWidth = parent.clientHeight * aspect;\n      adjustedHeight = parent.clientHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _applyDisplayMode() {\n    if (this.displayMode === DisplayMode.Position) {\n      this._initializeDisplayModePosition(this._position);\n    } else {\n      this._setResolutionAndViewportByDisplayMode(this.parent);\n\n      // watch resizing\n      if (this.parent instanceof Window) {\n        this._browser.window.on('resize', this._resizeHandler);\n      } else {\n        this._resizeObserver = new ResizeObserver(() => {\n          this._resizeHandler();\n        });\n        this._resizeObserver.observe(this.parent);\n      }\n      this.parent.addEventListener('resize', this._resizeHandler);\n    }\n  }\n\n  /**\n   * Sets the resolution and viewport based on the selected display mode.\n   */\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.FillContainer) {\n      this.resolution = {\n        width: (<HTMLElement>parent).clientWidth,\n        height: (<HTMLElement>parent).clientHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FillScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.resolution = {\n        width: (<Window>parent).innerWidth,\n        height: (<Window>parent).innerHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FitScreen) {\n      this._computeFit();\n    }\n\n    if (this.displayMode === DisplayMode.FitContainer) {\n      this._computeFitContainer();\n    }\n  }\n\n  private _initializeDisplayModePosition(position: CanvasPosition) {\n    if (!position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof position === 'string') {\n        const specifiedPosition = position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (position.top) {\n          typeof position.top === 'number'\n            ? (this.canvas.style.top = position.top.toString() + 'px')\n            : (this.canvas.style.top = position.top);\n        }\n        if (position.right) {\n          typeof position.right === 'number'\n            ? (this.canvas.style.right = position.right.toString() + 'px')\n            : (this.canvas.style.right = position.right);\n        }\n        if (position.bottom) {\n          typeof position.bottom === 'number'\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = position.bottom);\n        }\n        if (position.left) {\n          typeof position.left === 'number'\n            ? (this.canvas.style.left = position.left.toString() + 'px')\n            : (this.canvas.style.left = position.left);\n        }\n      }\n    }\n  }\n}","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve(false);\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve(true);\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","import { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher();\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: any) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: any) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n}\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.save();\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n  ctx.restore();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Color } from './Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\nimport { Canvas } from './Graphics/Canvas';\nimport { Vector } from './Math/vector';\nimport { delay } from './Util/Util';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { clamp } from './Math/util';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\n  public canvas: Canvas = new Canvas({\n    filtering: ImageFiltering.Blended,\n    smoothing: true,\n    draw: this.draw.bind(this)\n  });\n  private _resourceList: Loadable<any>[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  /**\n   * Positions the top left corner of the logo image\n   * If not set, the loader automatically positions the logo\n   */\n  public logoPosition: Vector | null;\n  /**\n   * Positions the top left corner of the play button.\n   * If not set, the loader automatically positions the play button\n   */\n  public playButtonPosition: Vector | null;\n  /**\n   * Positions the top left corner of the loading bar\n   * If not set, the loader automatically positions the loading bar\n   */\n  public loadingBarPosition: Vector | null;\n\n  /**\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\n   */\n  public loadingBarColor: Color = Color.White;\n\n  /**\n   * Gets or sets the background color of the loader as a hex string\n   */\n  public backgroundColor: string = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  public get playButtonRootElement(): HTMLElement | null {\n    return this._playButtonRootElement;\n  }\n  public get playButtonElement(): HTMLButtonElement | null {\n    return this._playButtonElement;\n  }\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    const existingRoot = document.getElementById('excalibur-play-root');\n    if (existingRoot) {\n      this._playButtonRootElement = existingRoot;\n    }\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.id = 'excalibur-play-root';\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\n    if (!buttonElement) {\n      buttonElement = document.createElement('button');\n    }\n\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable<any>[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n    this.canvas.width = this._engine.canvas.width;\n    this.canvas.height = this._engine.canvas.height;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable<any>) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable<any>[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public async showPlayButton(): Promise<void> {\n    if (this.suppressPlayButton) {\n      this.hidePlayButton();\n      // Delay is to give the logo a chance to show, otherwise don't delay\n      await delay(500, this._engine?.clock);\n    } else {\n      const resizeHandler = () => {\n        this._positionPlayButton();\n      };\n      if (this._engine?.browser) {\n        this._engine.browser.window.on('resize', resizeHandler);\n      }\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\n        if (evt.key === 'Enter') {\n          this._playButton.click();\n        }\n      });\n      this._positionPlayButton();\n      const playButtonClicked = new Promise<void>((resolve) => {\n        const startButtonHandler = (e: Event) => {\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\n          e.stopPropagation();\n          // Hide Button after click\n          this.hidePlayButton();\n          if (this._engine?.browser) {\n            this._engine.browser.window.off('resize', resizeHandler);\n          }\n          resolve();\n        };\n        this._playButton.addEventListener('click', startButtonHandler);\n        this._playButton.addEventListener('touchend', startButtonHandler);\n        this._playButton.addEventListener('pointerup', startButtonHandler);\n      });\n\n      return await playButtonClicked;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Clean up generated elements for the loader\n   */\n  public dispose() {\n    if (this._playButtonRootElement.parentElement) {\n      this._playButtonRootElement.removeChild(this._playButtonElement);\n      document.body.removeChild(this._playButtonRootElement);\n      document.head.removeChild(this._styleBlock);\n      this._playButtonRootElement = null;\n      this._playButtonElement = null;\n      this._styleBlock = null;\n    }\n  }\n\n  update(_engine: Engine, _delta: number): void {\n    // override me\n  }\n\n  data: Loadable<any>[];\n\n  private _isLoadedResolve: () => any;\n  private _isLoadedPromise = new Promise<void>(resolve => {\n    this._isLoadedResolve = resolve;\n  });\n  public areResourcesLoaded() {\n    return this._isLoadedPromise;\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete AND the user has clicked the \"Play button\"\n   */\n  public async load(): Promise<Loadable<any>[]> {\n    await this._image?.decode(); // decode logo if it exists\n\n    await Promise.all(\n      this._resourceList.map((r) =>\n        r.load().finally(() => {\n          // capture progress\n          this._numLoaded++;\n        })\n      )\n    );\n    this._isLoadedResolve();\n\n    // short delay in showing the button for aesthetics\n    await delay(200, this._engine?.clock);\n\n    await this.showPlayButton();\n    // Unlock browser AudioContext in after user gesture\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\n    await WebAudio.unlock();\n\n    return (this.data = this._resourceList);\n  }\n\n  public markResourceComplete(): void {\n    this._numLoaded++;\n  }\n\n  /**\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\n   */\n  public get progress(): number {\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\n  }\n\n  private _positionPlayButton() {\n    if (this._engine) {\n      const screenHeight = this._engine.screen.viewport.height;\n      const screenWidth = this._engine.screen.viewport.width;\n      if (this._playButtonRootElement) {\n        const left = this._engine.canvas.offsetLeft;\n        const top = this._engine.canvas.offsetTop;\n        const buttonWidth = this._playButton.clientWidth;\n        const buttonHeight = this._playButton.clientHeight;\n        if (this.playButtonPosition) {\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n        } else {\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\n        }\n      }\n    }\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    this._positionPlayButton();\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    let logoY = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    let logoX = canvasWidth / 2 - width / 2;\n\n    if (this.logoPosition) {\n      logoX = this.logoPosition.x;\n      logoY = this.logoPosition.y;\n    }\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    if (!this.logoPosition) {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n    } else {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n    }\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    let loadingX = logoX;\n    let loadingY = logoY;\n    if (this.loadingBarPosition) {\n      loadingX = this.loadingBarPosition.x;\n      loadingY = this.loadingBarPosition.y;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n    const progress = width * this.progress;\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(\n      ctx,\n      loadingX + margin,\n      loadingY + margin,\n      progressWidth > 10 ? progressWidth : 10,\n      height,\n      5,\n      null,\n      this.loadingBarColor\n    );\n    this._engine.setAntialiasing(oldAntialias);\n  }\n}\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=\"","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // (✓)\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // (✗)\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    // eslint-disable-next-line no-console\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","/**\n * An enum that describes the types of collisions bodies can participate in\n */\nexport enum CollisionType {\n  /**\n   * Bodies with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Bodies with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other bodies and do not influence or move other bodies.\n   * This is useful for use in trigger type behavior.\n   */\n  Passive = 'Passive',\n  /**\n   * Bodies with the `Active` setting raise collision events and participate\n   * in collisions with other bodies and will be push or moved by bodies sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Bodies with the `Fixed` setting raise collision events and participate in\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\n * like platformers or top down games.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Arcade = 'arcade',\n  Realistic = 'realistic'\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster.\n */\nexport enum BroadphaseStrategy {\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n  public static get gravity() {\n    return Physics.acc;\n  }\n  public static set gravity(v: Vector) {\n    Physics.acc = v;\n  }\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n\n  /**\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\n   */\n  public static useArcadePhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRealisticPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\n  }\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\n   */\n  public static dynamicTreeVelocityMultiplier = 2;\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\n  })\n  public static get dynamicTreeVelocityMultiplyer() {\n    return Physics.dynamicTreeVelocityMultiplier;\n  }\n\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\n    Physics.dynamicTreeVelocityMultiplier = value;\n  }\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Number of position iterations (overlap) to run in the solver\n   */\n  public static positionIterations = 3;\n\n  /**\n   * Number of velocity iteration (response) to run in the solver\n   */\n  public static velocityIterations = 8;\n\n  /**\n   * Amount of overlap to tolerate in pixels\n   */\n  public static slop = 1;\n\n  /**\n   * Amount of positional overlap correction to apply each position iteration of the solver\n   * O - meaning no correction, 1 - meaning correct all overlap\n   */\n  public static steeringFactor = 0.2;\n\n  /**\n   * Warm start set to true re-uses impulses from previous frames back in the solver\n   */\n  public static warmStart = true;\n\n  /**\n   * By default bodies do not sleep\n   */\n  public static bodiesCanSleepByDefault = false;\n\n  /**\n   * Surface epsilon is used to help deal with surface penetration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  public static sleepEpsilon = 0.07;\n\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\n\n  public static sleepBias = 0.9;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\nimport { VectorView } from '../../Math/vector-view';\nimport { Vector, vec } from '../../Math/vector';\nimport { Component } from '../Component';\nimport { Observable } from '../../Util/Observable';\nimport { watch } from '../../Util/Watch';\n\nexport interface Transform {\n  /**\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\n   */\n  coordPlane: CoordPlane;\n\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If the entity has a parent this position is relative to the parent entity.\n   */\n  pos: Vector;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  z: number;\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   *\n   * If the entity has a parent this rotation is relative to the parent.\n   */\n  rotation: number;\n\n  /**\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\n   */\n  scale: Vector;\n}\n\nconst createPosView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.data[MatrixLocations.X] = x;\n    },\n    setY: (y) => {\n      source.data[MatrixLocations.Y] = y;\n    },\n    getX: () => {\n      return source.data[MatrixLocations.X];\n    },\n    getY: () => {\n      return source.data[MatrixLocations.Y];\n    }\n  });\n};\n\nconst createScaleView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.setScaleX(x);\n    },\n    setY: (y) => {\n      source.setScaleY(y);\n    },\n    getX: () => {\n      return source.getScaleX();\n    },\n    getY: () => {\n      return source.getScaleY();\n    }\n  });\n};\n\n/**\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\n */\nexport enum CoordPlane {\n  /**\n   * The world coordinate plane (default) represents world space, any entities drawn with world\n   * space move when the camera moves.\n   */\n  World = 'world',\n  /**\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\n   * to screen coordinates ignoring the camera.\n   */\n  Screen = 'screen'\n}\n\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\n  public readonly type = 'ex.transform';\n\n  private _dirty = false;\n\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\n  private _position = watch(createPosView(this.matrix), (v) => {\n    this.posChanged$.notifyAll(v);\n  });\n  private _rotation = 0;\n  private _scale = createScaleView(this.matrix);\n\n  private _recalculate() {\n    this._rotation = this.matrix.getRotation();\n    this._dirty = false;\n  }\n\n  public getGlobalMatrix(): Matrix {\n    if (!this.parent) {\n      return this.matrix;\n    } else {\n      return this.parent.getGlobalMatrix().multiply(this.matrix);\n    }\n  }\n\n  public getGlobalTransform(): Transform {\n    return {\n      pos: this.globalPos,\n      scale: this.globalScale,\n      rotation: this.globalRotation,\n      z: this.z,\n      coordPlane: this.coordPlane\n    };\n  }\n\n  public get parent(): TransformComponent | null {\n    return this?.owner?.parent?.get(TransformComponent);\n  }\n\n  /**\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\n   */\n  public coordPlane = CoordPlane.World;\n\n  /**\n   * Observable that notifies when the position changes\n   */\n  public posChanged$ = new Observable<Vector>();\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If a parent entity exists coordinates are local to the parent.\n   */\n  public get pos(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._position;\n  }\n\n  public set pos(val: Vector) {\n    const oldPos = this.matrix.getPosition();\n    this.matrix.setPosition(val.x, val.y);\n    this._dirty = true;\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this._position);\n    }\n  }\n\n  // Dirty flag check up the chain\n  public get dirty(): boolean {\n    if (this?.owner?.parent) {\n      const parent = this.parent;\n      return parent.dirty || this._dirty;\n    }\n    return this._dirty;\n  }\n\n  /**\n   * The current world position calculated\n   */\n  public get globalPos(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.data[MatrixLocations.X],\n      getY: () => source.data[MatrixLocations.Y],\n      setX: (x) => {\n        const oldX = this.matrix.data[MatrixLocations.X];\n        if (this.parent) {\n          const { x: newX } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(x, source.data[MatrixLocations.Y]));\n          this.matrix.data[MatrixLocations.X] = newX;\n        } else {\n          this.matrix.data[MatrixLocations.X] = x;\n        }\n        if (oldX !== this.matrix.data[MatrixLocations.X]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      },\n      setY: (y) => {\n        const oldY = this.matrix.data[MatrixLocations.Y];\n        if (this.parent) {\n          const { y: newY } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(source.data[MatrixLocations.X], y));\n          this.matrix.data[MatrixLocations.Y] = newY;\n        } else {\n          this.matrix.data[MatrixLocations.Y] = y;\n        }\n        if (oldY !== this.matrix.data[MatrixLocations.Y]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      }\n    });\n  }\n\n  public set globalPos(val: Vector) {\n    const oldPos = this.pos;\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.pos = val;\n    } else {\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multiply(val);\n    }\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this.pos);\n    }\n  }\n\n  /**\n   * Observable that emits when the z index changes on this component\n   */\n  public zIndexChanged$ = new Observable<number>();\n  private _z = 0;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  public get z(): number {\n    return this._z;\n  }\n\n  public set z(val: number) {\n    const oldz = this._z;\n    this._z = val;\n    if (oldz !== val) {\n      this.zIndexChanged$.notifyAll(val);\n    }\n  }\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   */\n  public get rotation(): number {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._rotation;\n  }\n\n  public set rotation(val: number) {\n    this.matrix.setRotation(val);\n    this._dirty = true;\n  }\n\n  public get globalRotation(): number {\n    return this.getGlobalMatrix().getRotation();\n  }\n\n  public set globalRotation(val: number) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.rotation = val;\n    } else {\n      this.rotation = val - parentTransform.globalRotation;\n    }\n  }\n\n  /**\n   * The scale of the entity.\n   */\n  public get scale(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._scale;\n  }\n\n  public set scale(val: Vector) {\n    this.matrix.setScale(val);\n    this._dirty = true;\n  }\n\n  public get globalScale(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.getScaleX(),\n      getY: () => source.getScaleY(),\n      setX: (x) => {\n        if (this.parent) {\n          const globalScaleX = this.parent.globalScale.x;\n          this.matrix.setScaleX(x / globalScaleX);\n        } else {\n          this.matrix.setScaleX(x);\n        }\n      },\n      setY: (y) => {\n        if (this.parent) {\n          const globalScaleY = this.parent.globalScale.y;\n          this.matrix.setScaleY(y / globalScaleY);\n        } else {\n          this.matrix.setScaleY(y);\n        }\n      }\n    });\n  }\n\n  public set globalScale(val: Vector) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.scale = val;\n    } else {\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\n    }\n  }\n\n  /**\n   * Apply the transform to a point\n   * @param point\n   */\n  public apply(point: Vector): Vector {\n    return this.matrix.multiply(point);\n  }\n\n  /**\n   * Apply the inverse transform to a point\n   * @param point\n   */\n  public applyInverse(point: Vector): Vector {\n    return this.matrix.getAffineInverse().multiply(point);\n  }\n}\n","import { Vector } from './vector';\n\nexport interface VectorViewOptions {\n  getX: () => number;\n  getY: () => number;\n  setX: (x: number) => void;\n  setY: (y: number) => void;\n}\nexport class VectorView extends Vector {\n  private _getX: () => number;\n  private _getY: () => number;\n  private _setX: (x: number) => void;\n  private _setY: (y: number) => void;\n  constructor(options: VectorViewOptions) {\n    super(0, 0);\n    this._getX = options.getX;\n    this._getY = options.getY;\n    this._setX = options.setX;\n    this._setY = options.setY;\n  }\n  public get x() {\n    return (this._x = this._getX());\n  }\n\n  public set x(val) {\n    this._setX(val);\n    this._x = val;\n  }\n\n  public get y() {\n    return (this._y = this._getY());\n  }\n  public set y(val) {\n    this._setY(val);\n    this._y = val;\n  }\n}\n","import { Entity } from './Entity';\n\n/**\n * Component Contructor Types\n */\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\n\n/**\n * Type guard to check if a component implements clone\n * @param x\n */\nfunction hasClone(x: any): x is { clone(): any } {\n  return !!x?.clone;\n}\n\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * Plucks the string type out of a component type\n */\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\n\n/**\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\n *\n * Implementations of Component must have a zero-arg constructor to support dependencies\n *\n * ```typescript\n * class MyComponent extends ex.Component<'my'> {\n *   public readonly type = 'my';\n *   // zero arg support required if you want to use component dependencies\n *   constructor(public optionalPos?: ex.Vector) {}\n * }\n * ```\n */\nexport abstract class Component<TypeName extends string = string> {\n  /**\n   * Optionally list any component types this component depends on\n   * If the owner entity does not have these components, new components will be added to the entity\n   *\n   * Only components with zero-arg constructors are supported as automatic component dependencies\n   */\n  readonly dependencies?: ComponentCtor[];\n\n  // todo implement optional\n  readonly optional?: ComponentCtor[];\n\n  /**\n   * Type of this component, must be a unique type among component types in you game.\n   */\n  abstract readonly type: TypeName;\n\n  /**\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\n   */\n  owner?: Entity = null;\n\n  /**\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\n   */\n  clone(): this {\n    const newComponent = new (this.constructor as any)();\n    for (const prop in this) {\n      if (this.hasOwnProperty(prop)) {\n        const val = this[prop];\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\n          newComponent[prop] = val.clone();\n        } else {\n          newComponent[prop] = val;\n        }\n      }\n    }\n    return newComponent;\n  }\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onAdd?(owner: Entity): void;\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onRemove?(previousOwner: Entity): void;\n}\n\n/**\n * Tag components are a way of tagging a component with label and a simple value\n *\n * For example:\n *\n * ```typescript\n * const isOffscreen = new TagComponent('offscreen');\n * entity.addComponent(isOffscreen);\n * entity.tags.includes\n * ```\n */\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\nTypeName\n> {\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\n    super();\n  }\n}\n","/**\n * Defines a generic message that can contain any data\n * @template T is the typescript Type of the data\n */\nexport interface Message<T> {\n  type: string;\n  data: T;\n}\n\n/**\n * Defines an interface for an observer to receive a message via a notify() method\n */\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\n/**\n * Defines an interface for something that might be an observer if a notify() is present\n */\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n  public subscriptions: ((val: T) => any)[] = [];\n\n  /**\n   * Register an observer to listen to this observable\n   * @param observer\n   */\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Register a callback to listen to this observable\n   * @param func\n   */\n  subscribe(func: (val: T) => any) {\n    this.subscriptions.push(func);\n  }\n\n  /**\n   * Remove an observer from the observable\n   * @param observer\n   */\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  /**\n   * Remove a callback that is listening to this observable\n   * @param func\n   */\n  unsubscribe(func: (val: T) => any) {\n    const i = this.subscriptions.indexOf(func);\n    if (i !== -1) {\n      this.subscriptions.splice(i, 1);\n    }\n  }\n\n  /**\n   * Broadcasts a message to all observers and callbacks\n   * @param message\n   */\n  notifyAll(message: T) {\n    this.observers.forEach((o) => o.notify(message));\n    this.subscriptions.forEach(cb => cb(message));\n  }\n\n  /**\n   * Removes all observers and callbacks\n   */\n  clear() {\n    this.observers.length = 0;\n    this.subscriptions.length = 0;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n\n  /**\n   * Inverts the collision group. For example, if before the group specified \"players\",\n   * inverting would specify all groups except players\n   * @returns CollisionGroup\n   */\n  public invert(): CollisionGroup {\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\n  }\n\n  /**\n   * Combine collision groups with each other. The new group includes all of the previous groups.\n   *\n   * @param collisionGroups\n   */\n  public static combine(collisionGroups: CollisionGroup[]) {\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\n    const combinedMask = ~combinedCategory;\n\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\n  }\n\n  /**\n   * Creates a collision group that collides with the listed groups\n   * @param collisionGroups\n   */\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\n    return CollisionGroup.combine(collisionGroups).invert();\n  }\n}\n","import { CollisionContact } from './CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { BodyComponent } from '../BodyComponent';\nimport { Id } from '../../Id';\nimport { Collider } from '../Colliders/Collider';\n\n/**\n * Models a potential collision between 2 colliders\n */\nexport class Pair {\n  public id: string = null;\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\n   * @param colliderA\n   * @param colliderB\n   */\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    const bodyA = colliderA?.owner?.get(BodyComponent);\n    const bodyB = colliderB?.owner?.get(BodyComponent);\n\n    // Prevent self collision\n    if (colliderA.id === colliderB.id) {\n      return false;\n    }\n\n    // Colliders with the same owner do not collide (composite colliders)\n    if (colliderA.owner &&\n        colliderB.owner &&\n        colliderA.owner.id === colliderB.owner.id) {\n      return false;\n    }\n\n    // if the pair has a member with zero dimension don't collide\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\n      return false;\n    }\n\n    // Body's needed for collision in the current state\n    // TODO can we collide without a body?\n    if (!bodyA || !bodyB) {\n      return false;\n    }\n\n    // If both are in the same collision group short circuit\n    if (!bodyA.group.canCollide(bodyB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!bodyA.active || !bodyB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const colliderA = this.colliderA;\n    const colliderB = this.colliderB;\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Runs the collision intersection logic on the members of this pair\n   */\n  public collide(): CollisionContact[] {\n    return this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Check if the collider is part of the pair\n   * @param collider\n   */\n  public hasCollider(collider: Collider) {\n    return collider === this.colliderA || collider === this.colliderB;\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair (owning id)\n   */\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\n    if (idA.value < idB.value) {\n      return `#${idA.value}+${idB.value}`;\n    } else {\n      return `#${idB.value}+${idA.value}`;\n    }\n  }\n}\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\nimport { BoundingBox } from '../BoundingBox';\n\nimport { Ray } from '../../Math/ray';\nimport { Logger } from '../../Util/Log';\nimport { Id } from '../../Id';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { BodyComponent } from '../BodyComponent';\nimport { Color, ExcaliburGraphicsContext } from '../..';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode<T> {\n  public left: TreeNode<T>;\n  public right: TreeNode<T>;\n  public bounds: BoundingBox;\n  public height: number;\n  public data: T;\n  constructor(public parent?: TreeNode<T>) {\n    this.parent = parent || null;\n    this.data = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\nexport interface ColliderProxy<T> {\n  id: Id<'collider'>;\n  owner: T;\n  bounds: BoundingBox;\n}\n\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\n  public root: TreeNode<T>;\n  public nodes: { [key: number]: TreeNode<T> };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode<T>): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode<T>) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode<T>;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackCollider(collider: T) {\n    const node = new TreeNode<T>();\n    node.data = collider;\n    node.bounds = collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[collider.id.value] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return false;\n    }\n    const b = collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn(\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\n      );\n      this.untrackCollider(collider);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    // THIS IS CAUSING UNECESSARY CHECKS\n    if (collider.owner) {\n      const body = collider.owner?.get(BodyComponent);\n      if (body) {\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n\n        if (multdx < 0) {\n          b.left += multdx;\n        } else {\n          b.right += multdx;\n        }\n\n        if (multdy < 0) {\n          b.top += multdy;\n        } else {\n          b.bottom += multdy;\n        }\n      }\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[collider.id.value] = null;\n    delete this.nodes[collider.id.value];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode<T>) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(collider: T, callback: (other: T) => boolean): void {\n    const bounds = collider.bounds;\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\n          if (callback.call(collider, currentNode.data)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.data)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode<T>[] {\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode<T>) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          currentNode.bounds.draw(ex, Color.Green);\n        } else {\n          currentNode.bounds.draw(ex, Color.White);\n        }\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\nimport { CollisionProcessor } from './CollisionProcessor';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\n\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { FrameStats } from '../../Debug';\nimport { Logger } from '../../Util/Log';\nimport { CollisionType } from '../CollisionType';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BodyComponent } from '../BodyComponent';\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\nimport { ExcaliburGraphicsContext } from '../..';\n\n/**\n * Responsible for performing the collision broadphase (locating potential collisions) and\n * the narrowphase (actual collision contacts)\n */\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\n  private _pairs = new Set<string>();\n\n  private _collisionPairCache: Pair[] = [];\n  private _colliders: Collider[] = [];\n\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null collider');\n      return;\n    }\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        c.owner = target.owner;\n        this._colliders.push(c);\n        this._dynamicCollisionTree.trackCollider(c);\n      }\n    } else {\n      this._colliders.push(target);\n      this._dynamicCollisionTree.trackCollider(target);\n    }\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null collider');\n      return;\n    }\n\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        const index = this._colliders.indexOf(c);\n        if (index !== -1) {\n          this._colliders.splice(index, 1);\n        }\n        this._dynamicCollisionTree.untrackCollider(c);\n      }\n    } else {\n      const index = this._colliders.indexOf(target);\n      if (index !== -1) {\n        this._colliders.splice(index, 1);\n      }\n      this._dynamicCollisionTree.untrackCollider(target);\n    }\n  }\n\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\n    return this._pairs.has(hash);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\n   */\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets.filter((other) => {\n      const body = other.owner?.get(BodyComponent);\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\n    });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._pairs.clear();\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n          const pair = new Pair(collider, other);\n          this._pairs.add(pair.id);\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        const body = collider.owner.get(BodyComponent);\n        // Skip non-active objects. Does not make sense on other collision types\n        if (body.collisionType !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          body.vel.size * seconds + // velocity term\n          body.acc.size * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penetrating in the current position\n          const updateVec = body.pos.sub(body.oldPos);\n          const centerPoint = collider.center;\n          const furthestPoint = collider.getFurthestPoint(body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minCollider: Collider;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.size < minTranslate.size) {\n                  minTranslate = translate;\n                  minCollider = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minCollider && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minCollider);\n            if (!this._pairs.has(pair.id)) {\n              this._pairs.add(pair.id);\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\n            collider.update(body.transform);\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\n    let contacts: CollisionContact[] = [];\n    for (let i = 0; i < pairs.length; i++) {\n      const newContacts = pairs[i].collide();\n      contacts = contacts.concat(newContacts);\n      if (stats && newContacts.length > 0) {\n        for (const c of newContacts) {\n          stats.physics.contacts.set(c.id, c);\n        }\n      }\n    }\n    if (stats) {\n      stats.physics.collisions += contacts.length;\n    }\n    return contacts;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Collider[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    this._dynamicCollisionTree.debug(ex);\n  }\n}\n","import { Color } from '../../Color';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BoundingBox } from '../BoundingBox';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Clonable } from '../../Interfaces/Clonable';\nimport { Entity, Transform } from '../../EntityComponentSystem';\nimport { createId, Id } from '../../Id';\nimport { EventDispatcher } from '../../EventDispatcher';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\n/**\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\n * for the purposes of colliding 2 objects in excalibur.\n */\nexport abstract class Collider implements Clonable<Collider> {\n  private static _ID = 0;\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>();\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const contact = this.collide(other);\n\n    if (contact) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public owner: Entity;\n\n  /**\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\n   * on top of the collider.\n   */\n  offset: Vector;\n\n  /**\n   * Position of the collision collider in world coordinates\n   */\n  abstract get worldPos(): Vector;\n\n  /**\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\n   */\n  abstract get center(): Vector;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\n   */\n  abstract get bounds(): BoundingBox;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\n   */\n  abstract get localBounds(): BoundingBox;\n\n  /**\n   * Return the axes of this particular collider\n   */\n  abstract get axes(): Vector[];\n  /**\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\n   */\n  abstract getFurthestPoint(direction: Vector): Vector;\n\n  abstract getInertia(mass: number): number;\n\n  // All new CollisionShape need to do the following\n  // Create a new collision function in the CollisionJumpTable against all the primitives\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\n  abstract collide(collider: Collider): CollisionContact[];\n\n  /**\n   * Returns the closest line between the surfaces this collider and another\n   * @param collider\n   */\n  abstract getClosestLineBetween(collider: Collider): Line;\n\n  /**\n   * Return wether the collider contains a point inclusive to it's border\n   */\n  abstract contains(point: Vector): boolean;\n\n  /**\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\n   */\n  abstract rayCast(ray: Ray, max?: number): Vector;\n\n  /**\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\n   */\n  abstract project(axis: Vector): Projection;\n\n  /**\n   * Updates collider world space geometry\n   */\n  abstract update(transform: Transform): void;\n\n  /**\n   * Draw the collider\n   * @deprecated Will be removed in 0.26.0\n   * @param ctx\n   * @param color\n   */\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\n\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\n  /**\n   * Draw any debug information\n   * @deprecated Will be removed in 0.26.0\n   */\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\n\n  abstract clone(): Collider;\n}\n","import { Util } from '../..';\nimport { Pair } from '../Detection/Pair';\nimport { Color } from '../../Color';\nimport { Transform } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\nimport { Line } from '../../Math/line';\nimport { Projection } from '../../Math/projection';\nimport { Ray } from '../../Math/ray';\nimport { Vector } from '../../Math/vector';\nimport { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { DynamicTree } from '../Detection/DynamicTree';\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\nimport { Collider } from './Collider';\n\nexport class CompositeCollider extends Collider {\n  private _transform: Transform;\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\n  private _dynamicAABBTree = new DynamicTree();\n  private _colliders: Collider[] = [];\n\n  constructor(colliders: Collider[]) {\n    super();\n    for (const c of colliders) {\n      this.addCollider(c);\n    }\n  }\n\n  clearColliders() {\n    this._colliders = [];\n  }\n\n  addCollider(collider: Collider) {\n    this.events.wire(collider.events);\n    this._colliders.push(collider);\n    this._collisionProcessor.track(collider);\n    this._dynamicAABBTree.trackCollider(collider);\n  }\n\n  removeCollider(collider: Collider) {\n    this.events.unwire(collider.events);\n    Util.removeItemFromArray(collider, this._colliders);\n    this._collisionProcessor.untrack(collider);\n    this._dynamicAABBTree.untrackCollider(collider);\n  }\n\n  getColliders(): Collider[] {\n    return this._colliders;\n  }\n\n  get worldPos(): Vector {\n    // TODO transform component world pos\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get center(): Vector {\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get bounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce(\n      (acc, collider) => acc.combine(collider.bounds),\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\n    );\n\n    return results;\n  }\n\n  get localBounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\n\n    return results;\n  }\n\n  get axes(): Vector[] {\n    // TODO cache this\n    const colliders = this.getColliders();\n    let axes: Vector[] = [];\n    for (const collider of colliders) {\n      axes = axes.concat(collider.axes);\n    }\n    return axes;\n  }\n\n  getFurthestPoint(direction: Vector): Vector {\n    const colliders = this.getColliders();\n    const furthestPoints: Vector[] = [];\n    for (const collider of colliders) {\n      furthestPoints.push(collider.getFurthestPoint(direction));\n    }\n    // Pick best point from all colliders\n    let bestPoint = furthestPoints[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (const point of furthestPoints) {\n      const distance = point.dot(direction);\n      if (distance > maxDistance) {\n        bestPoint = point;\n        maxDistance = distance;\n      }\n    }\n    return bestPoint;\n  }\n\n  getInertia(mass: number): number {\n    const colliders = this.getColliders();\n    let totalInertia = 0;\n    for (const collider of colliders) {\n      totalInertia += collider.getInertia(mass);\n    }\n    return totalInertia;\n  }\n\n  collide(other: Collider): CollisionContact[] {\n    let otherColliders = [other];\n    if (other instanceof CompositeCollider) {\n      otherColliders = other.getColliders();\n    }\n\n    const pairs: Pair[] = [];\n    for (const c of otherColliders) {\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\n        pairs.push(new Pair(c, potentialCollider));\n        return false;\n      });\n    }\n\n    let contacts: CollisionContact[] = [];\n    for (const p of pairs) {\n      contacts = contacts.concat(p.collide());\n    }\n    return contacts;\n  }\n\n  getClosestLineBetween(other: Collider): Line {\n    const colliders = this.getColliders();\n    const lines: Line[] = [];\n    if (other instanceof CompositeCollider) {\n      const otherColliders = other.getColliders();\n      for (const colliderA of colliders) {\n        for (const colliderB of otherColliders) {\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\n          if (maybeLine) {\n            lines.push(maybeLine);\n          }\n        }\n      }\n    } else {\n      for (const collider of colliders) {\n        const maybeLine = other.getClosestLineBetween(collider);\n        if (maybeLine) {\n          lines.push(maybeLine);\n        }\n      }\n    }\n\n    if (lines.length) {\n      let minLength = lines[0].getLength();\n      let minLine = lines[0];\n      for (const line of lines) {\n        const length = line.getLength();\n        if (length < minLength) {\n          minLength = length;\n          minLine = line;\n        }\n      }\n      return minLine;\n    }\n    return null;\n  }\n  contains(point: Vector): boolean {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      if (collider.contains(point)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  rayCast(ray: Ray, max?: number): Vector {\n    const colliders = this.getColliders();\n    const points: Vector[] = [];\n    for (const collider of colliders) {\n      const vec = collider.rayCast(ray, max);\n      if (vec) {\n        points.push(vec);\n      }\n    }\n    if (points.length) {\n      let minPoint = points[0];\n      let minDistance = minPoint.dot(ray.dir);\n      for (const point of points) {\n        const distance = ray.dir.dot(point);\n        if (distance < minDistance) {\n          minPoint = point;\n          minDistance = distance;\n        }\n      }\n      return minPoint;\n    }\n    return null;\n  }\n  project(axis: Vector): Projection {\n    const colliders = this.getColliders();\n    const projs: Projection[] = [];\n    for (const collider of colliders) {\n      const proj = collider.project(axis);\n      if (proj) {\n        projs.push(proj);\n      }\n    }\n    // Merge all proj's on the same axis\n    if (projs.length) {\n      const newProjection = new Projection(projs[0].min, projs[0].max);\n      for (const proj of projs) {\n        newProjection.min = Math.min(proj.min, newProjection.min);\n        newProjection.max = Math.max(proj.max, newProjection.max);\n      }\n      return newProjection;\n    }\n    return null;\n  }\n\n  update(transform: Transform): void {\n    if (transform) {\n      const colliders = this.getColliders();\n      for (const collider of colliders) {\n        collider.owner = this.owner;\n        collider.update(transform);\n      }\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color, pos);\n    }\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.debug(ex, color);\n    }\n  }\n\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color);\n    }\n  }\n  clone(): Collider {\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\n  }\n}\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\n\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface CircleColliderOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n}\n\n/**\n * This is a circle collider for the excalibur rigid body physics simulation\n */\nexport class CircleCollider extends Collider {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0).\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  private _naturalRadius: number;\n  /**\n   * Get the radius of the circle\n   */\n  public get radius(): number {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    return this._naturalRadius * Math.min(scale.x, scale.y);\n  }\n\n  /**\n   * Set the radius of the circle\n   */\n  public set radius(val: number) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\n  }\n\n  private _transform: Transform;\n\n  constructor(options: CircleColliderOptions) {\n    super();\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): CircleCollider {\n    return new CircleCollider({\n      offset: this.offset.clone(),\n      radius: this.radius\n    });\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  /**\n   * Tests if a point is contained in this collider\n   */\n  public contains(point: Vector): boolean {\n    const pos = this._transform?.pos ?? this.offset;\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circle collider and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const positiveToi: number[] = [];\n        if (toi1 >= 0) {\n          positiveToi.push(toi1);\n        }\n\n        if (toi2 >= 0) {\n          positiveToi.push(toi2);\n        }\n\n        const mintoi = Math.min(...positiveToi);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Find the local point on the shape in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const dir = direction.normalize();\n    return dir.scale(this.radius);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    ).rotate(rotation).scale(scale).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return [];\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /* istanbul ignore next */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   * @param pos\n   */\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    ex.save();\n    ex.translate(pos.x, pos.y);\n    ex.rotate(rotation);\n    ex.scale(scale.x, scale.y);\n    ex.drawCircle((this.offset ?? Vector.Zero), this._naturalRadius, Color.Transparent, color, 2);\n    ex.restore();\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const transform = this._transform;\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\n    const rotation = transform ? transform.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perspective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perspective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { TransformComponent } from '../../EntityComponentSystem';\nimport { Pair } from '../Detection/Pair';\n\nexport const CollisionJumpTable = {\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    const combinedRadius = circleA.radius + circleB.radius;\n    const distance = circleAPos.distance(circleBPos);\n\n    if (distance > combinedRadius) {\n      return [];\n    }\n\n    // negative means overlap\n    const separation = combinedRadius - distance;\n\n    // Normal points from A -> B\n    const normal = circleBPos.sub(circleAPos).normalize();\n    const tangent = normal.perpendicular();\n    const mvt = normal.scale(separation);\n\n    const point = circleA.getFurthestPoint(normal);\n    const local = circleA.getFurthestLocalPoint(normal);\n\n    const info: SeparationInfo = {\n      collider: circleA,\n      separation,\n      axis: normal,\n      point: point\n    };\n\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\n  },\n\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\n    if (!minAxis) {\n      return [];\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const point = circle.getFurthestPoint(minAxis);\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\n    const local = xf.applyInverse(point);\n    const normal = minAxis.normalize();\n\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: -minAxis.size,\n      axis: normal,\n      point: point,\n      localPoint: local,\n      side: polygon.findSide(normal.negate()),\n      localSide: polygon.findLocalSide(normal.negate())\n    };\n\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\n  },\n\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\n    // TODO not sure this actually abides by local/world collisions\n    // Are edge.begin and edge.end local space or world space? I think they should be local\n\n    // center of the circle in world pos\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const edgeWorld = edge.asLine();\n    const e = edgeWorld.end.sub(edgeWorld.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edgeWorld.end.sub(cc));\n    const v = e.dot(cc.sub(edgeWorld.begin));\n    const side = edge.asLine();\n    const localSide = edge.asLocalLine();\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edgeWorld.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return []; // no collision\n      }\n\n      const normal = da.normalize();\n      const separation = circle.radius - Math.sqrt(dda);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.begin,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\n      ];\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edgeWorld.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return [];\n      }\n\n      const normal = db.normalize();\n      const separation = circle.radius - Math.sqrt(ddb);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.end,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\n      ];\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edgeWorld.begin\n      .scale(u)\n      .add(edgeWorld.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return []; // no collision\n    }\n\n    let normal = e.perpendicular();\n    // flip correct direction\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\n      normal.x = -normal.x;\n      normal.y = -normal.y;\n    }\n\n    normal = normal.normalize();\n    const separation = circle.radius - Math.sqrt(dd);\n\n    const mvt = normal.scale(separation);\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: separation,\n      axis: normal,\n      point: pointOnEdge,\n      side: side,\n      localSide: localSide\n    };\n\n    return [\n      new CollisionContact(\n        circle,\n        edge,\n        mvt,\n        normal.negate(),\n        normal.negate().perpendicular(),\n        [pointOnEdge],\n        [pointOnEdge.sub(edge.worldPos)],\n        info\n      )\n    ];\n  },\n\n  CollideEdgeEdge(): CollisionContact[] {\n    // Edge-edge collision doesn't make sense\n    return [];\n  },\n\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new PolygonCollider({\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\n      offset: edge.offset\n    });\n    linePoly.owner = edge.owner;\n    const tx = edge.owner?.get(TransformComponent);\n    if (tx) {\n      linePoly.update(edge.owner.get(TransformComponent));\n    }\n    // Gross hack but poly-poly works well\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\n    if (contact.length) {\n      // Fudge the contact back to edge\n      contact[0].colliderB = edge;\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\n      // contact[0].info.collider\n    }\n    return contact;\n  },\n\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\n    // Multi contact from SAT\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\n    // do a SAT test to find a min axis if it exists\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\n    // If there is no overlap from boxA's perspective we can end early\n    if (separationA.separation > 0) {\n      return [];\n    }\n\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\n    // If there is no overlap from boxB's perspective exit now\n    if (separationB.separation > 0) {\n      return [];\n    }\n\n    // Separations are both negative, we want to pick the least negative (minimal movement)\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\n\n    // The incident side is the most opposite from the axes of collision on the other collider\n    const other = separation.collider === polyA ? polyB : polyA;\n    const incident = other.findSide(separation.axis.negate()) as Line;\n\n    // Clip incident side by the perpendicular lines at each end of the reference side\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\n    const reference = separation.side;\n    const refDir = reference.dir().normalize();\n\n    // Find our contact points by clipping the incident by the collision side\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\n    let clipLeft: Line | null = null;\n    if (clipRight) {\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\n    }\n\n    // If there is no left there is no collision\n    if (clipLeft) {\n      // We only want clip points below the reference edge, discard the others\n      const points = clipLeft.getPoints().filter((p) => {\n        return reference.below(p);\n      });\n\n      let normal = separation.axis;\n      let tangent = normal.perpendicular();\n      // Point Contact A -> B\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\n        normal = normal.negate();\n        tangent = normal.perpendicular();\n      }\n      // Points are clipped from incident which is the other collider\n      // Store those as locals\n      let localPoints: Vector[] = [];\n      if (separation.collider === polyA) {\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      } else {\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      }\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\n    }\n    return [];\n  },\n\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\n    const shapeA = contact.colliderA;\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\n    const shapeB = contact.colliderB;\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\n\n    // both are circles\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\n      const combinedRadius = shapeA.radius + shapeB.radius;\n      const distance = txA.pos.distance(txB.pos);\n      const separation = combinedRadius - distance;\n      return -separation;\n    }\n\n    // both are polygons\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\n      if (contact.info.localSide) {\n        let side: Line;\n        let worldPoint: Vector;\n        if (contact.info.collider === shapeA) {\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\n          worldPoint = txB.apply(localPoint);\n        } else {\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\n          worldPoint = txA.apply(localPoint);\n        }\n\n        return side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v circle\n    if (\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\n    ) {\n      const worldPoint = txA.apply(localPoint);\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v edge\n    if (\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\n    ) {\n      let worldPoint: Vector;\n      if (contact.info.collider === shapeA) {\n        worldPoint = txB.apply(localPoint);\n      } else {\n        worldPoint = txA.apply(localPoint);\n      }\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // circle v edge\n    if (\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\n    ) {\n      // Local point is always on the edge which is always shapeB\n      const worldPoint = txB.apply(localPoint);\n\n      let circlePoint: Vector;\n      if (shapeA instanceof CircleCollider) {\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\n      }\n\n      const dist = worldPoint.distance(circlePoint);\n\n      if (contact.info.side) {\n        return dist > 0 ? -dist : 0;\n      }\n    }\n\n    return 0;\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface EdgeColliderOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally specify an offset\n   */\n  offset?: Vector;\n}\n\n/**\n * Edge is a single line collider to create collisions with a single line.\n */\nexport class EdgeCollider extends Collider {\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  private _transform: Transform;\n\n  constructor(options: EdgeColliderOptions) {\n    super();\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.offset = options.offset ?? Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): EdgeCollider {\n    return new EdgeCollider({\n      begin: this.begin.clone(),\n      end: this.end.clone()\n    });\n  }\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    return tx?.globalPos.add(this.offset) ?? this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns the closes line between this and another collider, from this -> collider\n   * @param shape\n   */\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: Collider): CollisionContact[] {\n    if (shape instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\n    // this causes problems for the collision system so we give them some padding\n    return new BoundingBox(\n      Math.min(begin.x, end.x) - padding,\n      Math.min(begin.y, end.y) - padding,\n      Math.max(begin.x, end.x) + padding,\n      Math.max(begin.y, end.y) + padding\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in local space\n   */\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Returns this edge represented as a line in world coordinates\n   */\n  public asLine(): Line {\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\n  }\n\n  /**\n   * Return this edge as a line in local line coordinates (relative to the position)\n   */\n  public asLocalLine(): Line {\n    return new Line(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ex.drawLine(begin, end, color, 2);\n    ex.drawCircle(begin, 2, color);\n    ex.drawCircle(end, 2, color);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Color } from '../../Color';\nimport { BoundingBox } from '../BoundingBox';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { Collider } from './Collider';\nimport { ExcaliburGraphicsContext, Logger, range } from '../..';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Shape } from './Shape';\n\nexport interface PolygonColliderOptions {\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   */\n  points: Vector[];\n}\n\n/**\n * Polygon collider for detecting collisions\n */\nexport class PolygonCollider extends Collider {\n  private _logger = Logger.getInstance();\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  public offset: Vector;\n\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   * Excalibur stores these in clockwise order\n   */\n  public points: Vector[];\n\n  private _transform: Transform;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n  private _localSides: Line[] = [];\n\n  constructor(options: PolygonColliderOptions) {\n    super();\n    this.offset = options.offset ?? Vector.Zero;\n    this.points = options.points ?? [];\n    const clockwise = this._isClockwiseWinding(this.points);\n    if (!clockwise) {\n      this.points.reverse();\n    }\n    if (!this.isConvex()) {\n      this._logger.warn(\n        'Excalibur only supports convex polygon colliders and will not behave properly.'+\n        'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles');\n    }\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  private _isClockwiseWinding(points: Vector[]): boolean {\n    // https://stackoverflow.com/a/1165943\n    let sum = 0;\n    for (let i = 0; i < points.length; i++) {\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\n    }\n    return sum < 0;\n  }\n\n  /**\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\n   * Call [[Polygon.triangulate]] to generate a [[CompositeCollider]] from this non-convex shape\n   */\n  public isConvex(): boolean {\n    // From SO: https://stackoverflow.com/a/45372025\n    if (this.points.length < 3) {\n      return false;\n    }\n    let oldPoint = this.points[this.points.length - 2];\n    let newPoint = this.points[this.points.length - 1];\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n    let oldDirection = 0;\n    let orientation = 0;\n    let angleSum = 0;\n    for (const [i, point] of this.points.entries()) {\n      oldPoint = newPoint;\n      oldDirection = direction;\n      newPoint =  point;\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n      if (oldPoint.equals(newPoint)) {\n        return false; // repeat point\n      }\n      let angle = direction - oldDirection;\n      if (angle <= -Math.PI){\n        angle += Math.PI * 2;\n      } else if (angle > Math.PI) {\n        angle -= Math.PI * 2;\n      }\n      if (i === 0) {\n        if (angle === 0.0) {\n          return false;\n        }\n        orientation = angle  > 0 ? 1 : -1;\n      } else {\n        if (orientation * angle <= 0) {\n          return false;\n        }\n      }\n      angleSum += angle;\n    }\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\n  }\n\n  /**\n   * Tessellates the polygon into a triangle fan as a [[CompositeCollider]] of triangle polygons\n   */\n  public tessellate(): CompositeCollider {\n    const polygons: Vector[][] = [];\n    for (let i = 1; i < this.points.length - 2; i++) {\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\n    }\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\n\n    return new CompositeCollider(polygons.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\n   * Returns a new [[CompositeCollider]] made up of smaller triangles.\n   */\n  public triangulate(): CompositeCollider {\n    // https://www.youtube.com/watch?v=hTJFcHutls8\n    if (this.points.length < 3) {\n      throw Error('Invalid polygon');\n    }\n\n    /**\n     * Helper to get a vertex in the list\n     */\n    function getItem<T>(index: number, list: T[]) {\n      if (index >= list.length) {\n        return list[index % list.length];\n      } else if (index < 0) {\n        return list[index % list.length + list.length];\n      } else {\n        return list[index];\n      }\n    }\n\n    /**\n     * Quick test for point in triangle\n     */\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\n      const ab = b.sub(a);\n      const bc = c.sub(b);\n      const ca = a.sub(c);\n\n      const ap = point.sub(a);\n      const bp = point.sub(b);\n      const cp = point.sub(c);\n\n      const cross1 = ab.cross(ap);\n      const cross2 = bc.cross(bp);\n      const cross3 = ca.cross(cp);\n\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\n        return false;\n      }\n      return true;\n    }\n\n    const triangles: Vector[][] = [];\n    const vertices = [...this.points];\n    const indices = range(0, this.points.length - 1);\n\n    // 1. Loop through vertices clockwise\n    //    if the vertex is convex (interior angle is < 180) (cross product positive)\n    //    if the polygon formed by it's edges doesn't contain the points\n    //         it's an ear add it to our list of triangles, and restart\n\n    while (indices.length > 3) {\n      for (let i = 0; i < indices.length; i++) {\n        const a = indices[i];\n        const b = getItem(i - 1, indices);\n        const c = getItem(i + 1, indices);\n\n        const va = vertices[a];\n        const vb = vertices[b];\n        const vc = vertices[c];\n\n        // Check convexity\n        const leftArm = vb.sub(va);\n        const rightArm = vc.sub(va);\n        const isConvex = rightArm.cross(leftArm) > 0; // positive cross means convex\n        if (!isConvex) {\n          continue;\n        }\n\n        let isEar = true;\n        // Check that if any vertices are in the triangle a, b, c\n        for (let j = 0; j < indices.length; j++) {\n          const vertIndex = indices[j];\n          // We can skip these\n          if (vertIndex === a || vertIndex === b || vertIndex === c) {\n            continue;\n          }\n\n          const point = vertices[vertIndex];\n          if (isPointInTriangle(point, vb, va, vc)) {\n            isEar = false;\n            break;\n          }\n        }\n\n        // Add ear to polygon list and remove from list\n        if (isEar) {\n          triangles.push([vb, va, vc]);\n          indices.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    triangles.push([vertices[indices[0]], vertices[indices[1]], vertices[indices[2]]]);\n\n    return new CompositeCollider(triangles.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): PolygonCollider {\n    return new PolygonCollider({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone())\n    });\n  }\n\n  /**\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\n   */\n  public get worldPos(): Vector {\n    if (this._transform) {\n      return this._transform.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const transform = this._transform as TransformComponent;\n\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\n    const angle = transform ? transform.globalRotation : 0;\n    const scale = transform ? transform.globalScale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    this._calculateTransformation();\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  /**\n   * Returns the local coordinate space sides\n   */\n  public getLocalSides(): Line[] {\n    if (this._localSides.length) {\n      return this._localSides;\n    }\n    const lines = [];\n    const points = this.points;\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._localSides = lines;\n    return this._localSides;\n  }\n\n  /**\n   * Given a direction vector find the world space side that is most in that direction\n   * @param direction\n   */\n  public findSide(direction: Vector): Line {\n    const sides = this.getSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Given a direction vector find the local space side that is most in that direction\n   * @param direction\n   */\n  public findLocalSide(direction: Vector): Line {\n    const sides = this.getLocalSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n    const axes = this.getSides().map((s) => s.normal());\n    this._axes = axes;\n    return this._axes;\n  }\n\n  public update(transform: Transform): void {\n    this._transform = transform;\n    this._sides.length = 0;\n    this._localSides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n    this.getLocalSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collider in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function (accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  public getClosestLineBetween(collider: Collider): Line {\n    if (collider instanceof CircleCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\n   * return null.\n   * @param collider\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Find the local point on the collider furthest in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const pts = this.points;\n    let furthestPoint = pts[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const effectiveOffset = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n\n    const firstPoint = this.points[0].add(effectiveOffset);\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    // Points are relative\n    this.points\n      .map((p) => p.add(effectiveOffset))\n      .forEach(function (point) {\n        ctx.lineTo(point.x, point.y);\n      });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const firstPoint = this.getTransformedPoints()[0];\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\n    for (let i = 0; i < points.length - 1; i++) {\n      ex.drawLine(points[i], points[i + 1], color, 2);\n      ex.drawCircle(points[i], 2, color);\n      ex.drawCircle(points[i + 1], 2, color);\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function (point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { PolygonCollider } from './PolygonCollider';\nimport { CircleCollider } from './CircleCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { BoundingBox } from '../BoundingBox';\nimport { vec, Vector } from '../../Math/vector';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Logger } from '../..';\n\n/**\n * Excalibur helper for defining colliders quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\n   *\n   * PolygonColliders are useful for creating convex polygon shapes\n   * @param points Points specified in counter clockwise\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: points,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[CircleCollider|circle]] collider\n   *\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\n   * @param radius Radius of the circle collider\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\n    return new CircleCollider({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[EdgeCollider|edge]] collider\n   *\n   * Edge colliders are useful for  floors, walls, and other barriers\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\n    return new EdgeCollider({\n      begin: begin,\n      end: end\n    });\n  }\n\n  /**\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\n   *\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\n   * player experience.\n   *\n   * @param width\n   * @param height\n   * @param offset Optional offset\n   */\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\n    const logger = Logger.getInstance();\n    if (width === height) {\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\n    }\n\n    const vertical = height >= width;\n\n    if (vertical) {\n      // height > width, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\n        Shape.Box(width, height - width, Vector.Half, offset),\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\n      ]);\n      return capsule;\n    } else {\n      // width > height, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\n        Shape.Box(width - height, height, Vector.Half, offset),\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\n      ]);\n      return capsule;\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport { Observable } from '../Util/Observable';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { CircleCollider } from './Colliders/CircleCollider';\nimport { Collider } from './Colliders/Collider';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { PolygonCollider } from './Colliders/PolygonCollider';\nimport { EdgeCollider } from './Colliders/EdgeCollider';\nimport { Shape } from './Colliders/Shape';\n\nexport class ColliderComponent extends Component<'ex.collider'> {\n  public readonly type = 'ex.collider';\n\n  public events = new EventDispatcher();\n  /**\n   * Observable that notifies when a collider is added to the body\n   */\n  public $colliderAdded = new Observable<Collider>();\n\n  /**\n   * Observable that notifies when a collider is removed from the body\n   */\n  public $colliderRemoved = new Observable<Collider>();\n\n  constructor(collider?: Collider) {\n    super();\n    this.set(collider);\n  }\n\n  private _collider: Collider;\n  /**\n   * Get the current collider geometry\n   */\n  public get() {\n    return this._collider;\n  }\n\n  /**\n   * Set the collider geometry\n   * @param collider\n   * @returns the collider you set\n   */\n  public set<T extends Collider>(collider: T): T {\n    this.clear();\n    if (collider) {\n      this._collider = collider;\n      this._collider.owner = this.owner;\n      this.events.wire(collider.events);\n      this.$colliderAdded.notifyAll(collider);\n      this.update();\n    }\n    return collider;\n  }\n\n  /**\n   * Remove collider geometry from collider component\n   */\n  public clear() {\n    if (this._collider) {\n      this.events.unwire(this._collider.events);\n      this.$colliderRemoved.notifyAll(this._collider);\n      this._collider.owner = null;\n      this._collider = null;\n    }\n  }\n\n  /**\n   * Return world space bounds\n   */\n  public get bounds() {\n    return this._collider?.bounds ?? new BoundingBox();\n  }\n\n  /**\n   * Return local space bounds\n   */\n  public get localBounds() {\n    return this._collider?.localBounds ?? new BoundingBox();\n  }\n\n  /**\n   * Update the collider's transformed geometry\n   */\n  public update() {\n    const tx = this.owner?.get(TransformComponent);\n    if (this._collider) {\n      this._collider.owner = this.owner;\n      if (tx) {\n        this._collider.update(tx);\n      }\n    }\n  }\n\n  /**\n   * Collide component with another\n   * @param other\n   */\n  collide(other: ColliderComponent): CollisionContact[] {\n    let colliderA = this._collider;\n    let colliderB = other._collider;\n    if (!colliderA || !colliderB) {\n      return [];\n    }\n\n    // If we have a composite lefthand side :(\n    // Might bite us, but to avoid updating all the handlers make composite always left side\n    let flipped = false;\n    if (colliderB instanceof CompositeCollider) {\n      colliderA = colliderB;\n      colliderB = this._collider;\n      flipped = true;\n    }\n\n    if (this._collider) {\n      const contacts = colliderA.collide(colliderB);\n      if (contacts) {\n        if (flipped) {\n          contacts.forEach((contact) => {\n            contact.mtv = contact.mtv.negate();\n            contact.normal = contact.normal.negate();\n            contact.tangent = contact.normal.perpendicular();\n            contact.colliderA = this._collider;\n            contact.colliderB = other._collider;\n          });\n        }\n        return contacts;\n      }\n      return [];\n    }\n    return [];\n  }\n\n  onAdd(entity: Entity) {\n    if (this._collider) {\n      this.update();\n    }\n    // Wire up the collider events to the owning entity\n    this.events.on('precollision', (evt: any) => {\n      const precollision = evt as PreCollisionEvent<Collider>;\n      entity.events.emit(\n        'precollision',\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\n      );\n    });\n    this.events.on('postcollision', (evt: any) => {\n      const postcollision = evt as PostCollisionEvent<Collider>;\n      entity.events.emit(\n        'postcollision',\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\n      );\n    });\n    this.events.on('collisionstart', (evt: any) => {\n      const start = evt as CollisionStartEvent<Collider>;\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\n    });\n    this.events.on('collisionend', (evt: any) => {\n      const end = evt as CollisionEndEvent<Collider>;\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\n    });\n  }\n\n  onRemove() {\n    this.events.clear();\n    this.$colliderRemoved.notifyAll(this._collider);\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\n    const collider = Shape.Box(width, height, anchor, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\n    const poly = Shape.Polygon(points, center);\n    return (this.set(poly));\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\n    const collider = Shape.Circle(radius, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\n    const collider = Shape.Edge(begin, end);\n    return (this.set(collider));\n  }\n\n  /**\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\n   * @param colliders\n   */\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\n    return (this.set(new CompositeCollider(colliders)));\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from './Physics';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { CollisionGroup } from './Group/CollisionGroup';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { createId, Id } from '../Id';\nimport { clamp } from '../Math/util';\nimport { ColliderComponent } from './ColliderComponent';\n\nexport interface BodyComponentOptions {\n  type?: CollisionType;\n  group?: CollisionGroup;\n  useGravity?: boolean;\n}\n\nexport enum DegreeOfFreedom {\n  Rotation = 'rotation',\n  X = 'x',\n  Y = 'y'\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\n * of physics simulation.\n */\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\n  public readonly type = 'ex.body';\n  public dependencies = [TransformComponent, MotionComponent];\n  public static _ID = 0;\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\n  public events = new EventDispatcher();\n\n  constructor(options?: BodyComponentOptions) {\n    super();\n    if (options) {\n      this.collisionType = options.type ?? this.collisionType;\n      this.group = options.group ?? this.group;\n      this.useGravity = options.useGravity ?? this.useGravity;\n    }\n  }\n\n  /**\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\n   */\n  public collisionType: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * The collision group for the body's colliders, by default body colliders collide with everything\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /**\n   * The amount of mass the body has\n   */\n  public mass: number = Physics.defaultMass;\n\n  /**\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseMass(): number {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\n  }\n\n  /**\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\n   */\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\n\n  /**\n   * Can this body sleep, by default bodies do not sleep\n   */\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\n\n  private _sleeping = false;\n  /**\n   * Whether this body is sleeping or not\n   */\n  public get sleeping(): boolean {\n    return this._sleeping;\n  }\n\n  /**\n   * Set the sleep state of the body\n   * @param sleeping\n   */\n  public setSleeping(sleeping: boolean) {\n    this._sleeping = sleeping;\n    if (!sleeping) {\n      // Give it a kick to keep it from falling asleep immediately\n      this.sleepMotion = Physics.sleepEpsilon * 5;\n    } else {\n      this.vel = Vector.Zero;\n      this.acc = Vector.Zero;\n      this.angularVelocity = 0;\n      this.sleepMotion = 0;\n    }\n  }\n\n  /**\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\n   */\n  public updateMotion() {\n    if (this._sleeping) {\n      this.setSleeping(true);\n    }\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\n    const bias = Physics.sleepBias;\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\n      this.setSleeping(true);\n    }\n  }\n\n  /**\n   * Get the moment of inertia from the [[ColliderComponent]]\n   */\n  public get inertia() {\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\n    const collider = this.owner.get(ColliderComponent);\n    if (collider?.get()) {\n      return collider.get().getInertia(this.mass);\n    }\n    return 0;\n  }\n\n  /**\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseInertia() {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\n  }\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\n   */\n  public useGravity: boolean = true;\n\n  /**\n   * Degrees of freedom to limit\n   */\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\n\n  /**\n   * Returns if the owner is active\n   */\n  public get active() {\n    return !!this.owner?.active;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  public get transform(): TransformComponent {\n    return this.owner?.get(TransformComponent);\n  }\n\n  public get motion(): MotionComponent {\n    return this.owner?.get(MotionComponent);\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public get pos(): Vector {\n    return this.transform.globalPos;\n  }\n\n  public set pos(val: Vector) {\n    this.transform.globalPos = val;\n  }\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this.motion.vel = val;\n  }\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  public set acc(val: Vector) {\n    this.motion.acc = val;\n  }\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public get torque(): number {\n    return this.motion.torque;\n  }\n\n  public set torque(val: number) {\n    this.motion.torque = val;\n  }\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the body in radians\n   */\n  public get rotation() {\n    return this.transform.globalRotation;\n  }\n\n  public set rotation(val: number) {\n    this.transform.globalRotation = val;\n  }\n\n  /**\n   * The scale vector of the actor\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\n   */\n  public get scale(): Vector {\n    return this.transform.globalScale;\n  }\n\n  public set scale(val: Vector) {\n    this.transform.globalScale = val;\n  }\n\n  /**\n   * The scale of the actor last frame\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sx(): number {\n    return this.motion.scaleFactor.x;\n  }\n\n  public set sx(xFactor: number) {\n    this.motion.scaleFactor.x = xFactor;\n  }\n\n  /**\n   * The y scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sy(): number {\n    return this.motion.scaleFactor.y;\n  }\n\n  public set sy(yFactor: number) {\n    this.motion.scaleFactor.y = yFactor;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public get rx(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public set rx(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Get the angular velocity in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Set the angular velocity in radians/second\n   */\n  public set angularVelocity(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Apply a specific impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel.addEqual(finalImpulse);\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Apply only linear impulse to the body\n   * @param impulse\n   */\n  public applyLinearImpulse(impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel = this.vel.add(finalImpulse);\n  }\n\n  /**\n   * Apply only angular impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Component, ComponentCtor, TagComponent } from './Component';\n\nimport { Observable, Message } from '../Util/Observable';\nimport { Class } from '../Class';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\nimport { Engine } from '../Engine';\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Util } from '..';\n\n/**\n * Interface holding an entity component pair\n */\nexport interface EntityComponent {\n  component: Component;\n  entity: Entity;\n}\n\n/**\n * AddedComponent message\n */\nexport class AddedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Added' = 'Component Added';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is f an Added Component\n */\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\n  return !!x && x.type === 'Component Added';\n}\n\n/**\n * RemovedComponent message\n */\nexport class RemovedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Removed' = 'Component Removed';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is for a Removed Component\n */\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\n  return !!x && x.type === 'Component Removed';\n}\n\n/**\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\n *\n * Entities can be strongly typed with the components they contain\n *\n * ```typescript\n * const entity = new Entity<ComponentA | ComponentB>();\n * entity.components.a; // Type ComponentA\n * entity.components.b; // Type ComponentB\n * ```\n */\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\n  private static _ID = 0;\n\n  constructor(components?: Component[], name?: string) {\n    super();\n    this._setName(name);\n    if (components) {\n      for (const component of components) {\n        this.addComponent(component);\n      }\n    }\n  }\n\n  /**\n   * The unique identifier for the entity\n   */\n  public id: number = Entity._ID++;\n\n  private _name: string = 'anonymous';\n  protected _setName(name: string) {\n    if (name) {\n      this._name = name;\n    }\n  }\n  public get name(): string {\n    return this._name;\n  }\n\n  public get events(): EventDispatcher {\n    return this.eventDispatcher;\n  }\n\n  /**\n   * Whether this entity is active, if set to false it will be reclaimed\n   */\n  public active: boolean = true;\n\n  /**\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\n   */\n  public kill() {\n    this.active = false;\n  }\n\n  public isKilled() {\n    return !this.active;\n  }\n\n  /**\n   * Specifically get the tags on the entity from [[TagComponent]]\n   */\n  public get tags(): readonly string[] {\n    return this._tagsMemo;\n  }\n\n  /**\n   * Check if a tag exists on the entity\n   * @param tag name to check for\n   */\n  public hasTag(tag: string): boolean {\n    return this.tags.includes(tag);\n  }\n\n  /**\n   * Adds a tag to an entity\n   * @param tag\n   * @returns Entity\n   */\n  public addTag(tag: string) {\n    return this.addComponent(new TagComponent(tag));\n  }\n\n  /**\n   * Removes a tag on the entity\n   *\n   * Removals are deferred until the end of update\n   * @param tag\n   * @param force Remove component immediately, no deferred\n   */\n  public removeTag(tag: string, force = false) {\n    return this.removeComponent(tag, force);\n  }\n\n  /**\n   * The types of the components on the Entity\n   */\n  public get types(): string[] {\n    return this._typesMemo;\n  }\n\n  /**\n   * Bucket to hold on to deferred removals\n   */\n  private _componentsToRemove: (Component | string)[] = [];\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\n  private _componentStringToInstance = new Map<string, Component>();\n\n  private _tagsMemo: string[] = [];\n  private _typesMemo: string[] = [];\n  private _rebuildMemos() {\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\n      .filter((c) => c instanceof TagComponent)\n      .map((c) => c.type);\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\n  }\n\n  public getComponents(): Component[] {\n    return Array.from(this._componentStringToInstance.values());\n  }\n\n  /**\n   * Observable that keeps track of component add or remove changes on the entity\n   */\n  public componentAdded$ = new Observable<AddedComponent>();\n  private _notifyAddComponent(component: Component) {\n    this._rebuildMemos();\n    const added = new AddedComponent({\n      component,\n      entity: this\n    });\n    this.componentAdded$.notifyAll(added);\n  }\n\n  public componentRemoved$ = new Observable<RemovedComponent>();\n  private _notifyRemoveComponent(component: Component) {\n    const removed = new RemovedComponent({\n      component,\n      entity: this\n    });\n    this.componentRemoved$.notifyAll(removed);\n    this._rebuildMemos();\n  }\n\n  private _parent: Entity = null;\n  public get parent(): Entity {\n    return this._parent;\n  }\n\n  public childrenAdded$ = new Observable<Entity>();\n  public childrenRemoved$ = new Observable<Entity>();\n\n  private _children: Entity[] = [];\n  /**\n   * Get the direct children of this entity\n   */\n  public get children(): readonly Entity[] {\n    return this._children;\n  }\n\n  /**\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\n   */\n  public unparent() {\n    if (this._parent) {\n      this._parent.removeChild(this);\n      this._parent = null;\n    }\n  }\n\n  /**\n   * Adds an entity to be a child of this entity\n   * @param entity\n   */\n  public addChild(entity: Entity): Entity {\n    if (entity.parent === null) {\n      if (this.getAncestors().includes(entity)) {\n        throw new Error('Cycle detected, cannot add entity');\n      }\n      this._children.push(entity);\n      entity._parent = this;\n      this.childrenAdded$.notifyAll(entity);\n    } else {\n      throw new Error('Entity already has a parent, cannot add without unparenting');\n    }\n    return this;\n  }\n\n  /**\n   * Remove an entity from children if it exists\n   * @param entity\n   */\n  public removeChild(entity: Entity): Entity {\n    if (entity.parent === this) {\n      Util.removeItemFromArray(entity, this._children);\n      entity._parent = null;\n      this.childrenRemoved$.notifyAll(entity);\n    }\n    return this;\n  }\n\n  /**\n   * Removes all children from this entity\n   */\n  public removeAllChildren(): Entity {\n    this.children.forEach((c) => {\n      this.removeChild(c);\n    });\n    return this;\n  }\n\n  /**\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\n   */\n  public getAncestors(): Entity[] {\n    const result: Entity[] = [this];\n    let current = this.parent;\n    while (current) {\n      result.push(current);\n      current = current.parent;\n    }\n    return result.reverse();\n  }\n\n  /**\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\n   */\n  public getDescendants(): Entity[] {\n    let result: Entity[] = [this];\n    let queue: Entity[] = [this];\n    while (queue.length > 0) {\n      const curr = queue.pop();\n      queue = queue.concat(curr.children);\n      result = result.concat(curr.children);\n    }\n    return result;\n  }\n\n  /**\n   * Creates a deep copy of the entity and a copy of all its components\n   */\n  public clone(): Entity {\n    const newEntity = new Entity();\n    for (const c of this.types) {\n      newEntity.addComponent(this.get(c).clone());\n    }\n    for (const child of this.children) {\n      newEntity.addChild(child.clone());\n    }\n    return newEntity;\n  }\n\n  /**\n   * Adds a copy of all the components from another template entity as a \"prefab\"\n   * @param templateEntity Entity to use as a template\n   * @param force Force component replacement if it already exists on the target entity\n   */\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\n    for (const c of templateEntity.getComponents()) {\n      this.addComponent(c.clone(), force);\n    }\n    for (const child of templateEntity.children) {\n      this.addChild(child.clone().addTemplate(child));\n    }\n    return this;\n  }\n\n  /**\n   * Adds a component to the entity\n   * @param component Component or Entity to add copy of components from\n   * @param force Optionally overwrite any existing components of the same type\n   */\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\n    // if component already exists, skip if not forced\n    if (this.has(component.type)) {\n      if (force) {\n        // Remove existing component type if exists when forced\n        this.removeComponent(component);\n      } else {\n        // early exit component exits\n        return this;\n      }\n    }\n\n    // TODO circular dependencies will be a problem\n    if (component.dependencies && component.dependencies.length) {\n      for (const ctor of component.dependencies) {\n        this.addComponent(new ctor());\n      }\n    }\n\n    component.owner = this;\n    const constuctorType = component.constructor as ComponentCtor<T>;\n    this._componentTypeToInstance.set(constuctorType, component);\n    this._componentStringToInstance.set(component.type, component);\n    if (component.onAdd) {\n      component.onAdd(this);\n    }\n    this._notifyAddComponent(component);\n\n    return this;\n  }\n\n  /**\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\n   *\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\n   * @param componentOrType\n   * @param force\n   */\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\n    if (force) {\n      if (typeof componentOrType === 'string') {\n        this._removeComponentByType(componentOrType);\n      } else if (componentOrType instanceof Component) {\n        this._removeComponentByType(componentOrType.type);\n      }\n    } else {\n      this._componentsToRemove.push(componentOrType);\n    }\n\n    return this as any;\n  }\n\n  private _removeComponentByType(type: string) {\n    if (this.has(type)) {\n      const component = this.get(type);\n      component.owner = null;\n      if (component.onRemove) {\n        component.onRemove(this);\n      }\n      const ctor = component.constructor as ComponentCtor;\n      this._componentTypeToInstance.delete(ctor);\n      this._componentStringToInstance.delete(component.type);\n      this._notifyRemoveComponent(component);\n    }\n  }\n\n  /**\n   * @hidden\n   * @internal\n   */\n  public processComponentRemoval() {\n    for (const componentOrType of this._componentsToRemove) {\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\n      this._removeComponentByType(type);\n    }\n    this._componentsToRemove.length = 0;\n  }\n\n  /**\n   * Check if a component type exists\n   * @param type\n   */\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\n  public has(type: string): boolean;\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.has(type);\n    } else {\n      return this._componentTypeToInstance.has(type);\n    }\n  }\n\n  /**\n   * Get a component by type with typecheck\n   *\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\n   * @param type\n   */\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\n  public get<T extends Component>(type: string): T | null;\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.get(type) as T;\n    } else {\n      return this._componentTypeToInstance.get(type) as T;\n    }\n  }\n\n  private _isInitialized = false;\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\n   * overridden.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an entity is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an entity is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   *\n   * Entity update lifecycle, called internally\n   *\n   * @internal\n   * @param engine\n   * @param delta\n   */\n  public update(engine: Engine, delta: number): void {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n    for (const child of this.children) {\n      child.update(engine, delta);\n    }\n    this._postupdate(engine, delta);\n  }\n}\n","import { Component } from '../EntityComponentSystem';\n\n/**\n * Shim to draw to the canvas when in LegacyDrawing mode\n * @deprecated\n */\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\n  public readonly type = 'ex.canvas';\n\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\n    super();\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    this.draw = this.draw ?? (() => {});\n  }\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Graphic } from './Graphic';\nimport { HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Logger } from '../Util/Log';\nimport { BoundingBox } from '../Collision/Index';\nimport { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\n * @param graphic\n */\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\n  return !!(graphic as unknown as HasTick).tick;\n}\nexport interface GraphicsShowOptions {\n  offset?: Vector;\n  anchor?: Vector;\n}\n\nexport interface GraphicsComponentOptions {\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n\n  /**\n   * Name of current graphic to use\n   */\n  current?: string;\n\n  /**\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\n   */\n  copyGraphics?: boolean;\n\n  /**\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\n   */\n  visible?: boolean;\n\n  /**\n   * Optional opacity\n   */\n  opacity?: number;\n\n  /**\n   * List of graphics\n   */\n  graphics?: { [graphicName: string]: Graphic };\n\n  /**\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\n   */\n  offset?: Vector;\n\n  /**\n   * Optional anchor\n   */\n  anchor?: Vector;\n}\n\nexport interface GraphicsLayerOptions {\n  /**\n   * Name of the layer required, for example 'background'\n   */\n  name: string;\n  /**\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\n   */\n  order: number;\n  /**\n   * Offset to shift the entire layer\n   */\n  offset?: Vector;\n}\nexport class GraphicsLayer {\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\n  public get name(): string {\n    return this._options.name;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in this layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in this layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    if (!nameOrGraphic) {\n      this.graphics.length = 0;\n    } else {\n      let gfx: Graphic = null;\n      if (nameOrGraphic instanceof Graphic) {\n        gfx = nameOrGraphic;\n      } else {\n        gfx = this._graphics.getGraphic(nameOrGraphic);\n      }\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\n      this._graphics.recalculateBounds();\n    }\n  }\n\n  /**\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\n   *\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\n   * @param nameOrGraphic\n   * @param options\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    let gfx: Graphic;\n    if (nameOrGraphic instanceof Graphic) {\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\n    } else {\n      gfx = this._graphics.getGraphic(nameOrGraphic);\n      if (!gfx) {\n        Logger.getInstance().error(\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\n          this._graphics.getNames()\n        );\n      }\n    }\n    if (gfx) {\n      this.graphics.push({ graphic: gfx, options });\n      this._graphics.recalculateBounds();\n      return gfx as T;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Use a specific graphic, swap out any current graphics being shown\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    this.hide();\n    return this.show<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public get order(): number {\n    return this._options.order;\n  }\n\n  /**\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public set order(order: number) {\n    this._options.order = order;\n  }\n\n  /**\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\n   */\n  public get offset(): Vector {\n    return this._options.offset ?? Vector.Zero;\n  }\n\n  public set offset(value: Vector) {\n    this._options.offset = value;\n  }\n\n  public get currentKeys(): string {\n    return this.name ?? 'anonymous';\n  }\n}\n\nexport class GraphicsLayers {\n  private _layers: GraphicsLayer[] = [];\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\n  public default: GraphicsLayer;\n  constructor(private _component: GraphicsComponent) {\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\n    this._maybeAddLayer(this.default);\n  }\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\n    const layer = new GraphicsLayer(options, this._component);\n    return this._maybeAddLayer(layer);\n  }\n\n  /**\n   * Retrieve a single layer by name\n   * @param name\n   */\n  public get(name: string): GraphicsLayer;\n  /**\n   * Retrieve all layers\n   */\n  public get(): readonly GraphicsLayer[];\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\n    if (name) {\n      return this._getLayer(name);\n    }\n    return this._layers;\n  }\n\n  public currentKeys() {\n    const graphicsLayerKeys = [];\n    for (const layer of this._layers) {\n      graphicsLayerKeys.push(layer.currentKeys);\n    }\n    return graphicsLayerKeys;\n  }\n\n  public has(name: string): boolean {\n    return name in this._layerMap;\n  }\n\n  private _maybeAddLayer(layer: GraphicsLayer) {\n    if (this._layerMap[layer.name]) {\n      // todo log warning\n      return this._layerMap[layer.name];\n    }\n    this._layerMap[layer.name] = layer;\n    this._layers.push(layer);\n    this._layers.sort((a, b) => a.order - b.order);\n    return layer;\n  }\n\n  private _getLayer(name: string): GraphicsLayer | undefined {\n    return this._layerMap[name];\n  }\n}\n\n/**\n * Component to manage drawings, using with the position component\n */\nexport class GraphicsComponent extends Component<'ex.graphics'> {\n  readonly type = 'ex.graphics';\n\n  private _graphics: { [graphicName: string]: Graphic } = {};\n\n  public layers: GraphicsLayers;\n\n  public getGraphic(name: string): Graphic | undefined {\n    return this._graphics[name];\n  }\n\n  /**\n   * Get registered graphics names\n   */\n  public getNames(): string[] {\n    return Object.keys(this._graphics);\n  }\n\n  /**\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\n   */\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\n   */\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Sets or gets wether any drawing should be visible in this component\n   */\n  public visible: boolean = true;\n\n  /**\n   * Sets or gets wither all drawings should have an opacity applied\n   */\n  public opacity: number = 1;\n\n  /**\n   * Offset to apply to graphics by default\n   */\n  public offset: Vector = Vector.Zero;\n\n  /**\n   * Anchor to apply to graphics by default\n   */\n  public anchor: Vector = Vector.Half;\n\n  /**\n   * If set to true graphics added to the component will be copied. This can affect performance\n   */\n  public copyGraphics: boolean = false;\n\n  constructor(options?: GraphicsComponentOptions) {\n    super();\n    // Defaults\n    options = {\n      visible: this.visible,\n      ...options\n    };\n\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\n\n    this._graphics = graphics || {};\n    this.offset = offset ?? this.offset;\n    this.opacity = opacity ?? this.opacity;\n    this.anchor = anchor ?? this.anchor;\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\n    this.visible = !!visible;\n\n    this.layers = new GraphicsLayers(this);\n    if (current && this._graphics[current]) {\n      this.show(this._graphics[current]);\n    }\n  }\n\n  /**\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\n   */\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\n    return this.layers.default.graphics;\n  }\n\n  /**\n   * Returns all graphics associated with this component\n   */\n  public get graphics(): { [graphicName: string]: Graphic } {\n    return this._graphics;\n  }\n\n  /**\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\n   * `show(\"default\")`\n   * @param graphic\n   */\n  public add(graphic: Graphic): Graphic;\n  public add(name: string, graphic: Graphic): Graphic;\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\n    let name = 'default';\n    let graphicToSet: Graphic = null;\n    if (typeof nameOrGraphic === 'string') {\n      name = nameOrGraphic;\n      graphicToSet = graphic;\n    } else {\n      graphicToSet = nameOrGraphic;\n    }\n\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\n    if (name === 'default') {\n      this.show('default');\n    }\n    return graphicToSet;\n  }\n\n  /**\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.show<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.use<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in the **default** layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    this.layers.default.hide(nameOrGraphic);\n  }\n\n  private _localBounds: BoundingBox = null;\n  public set localBounds(bounds: BoundingBox) {\n    this._localBounds = bounds;\n  }\n\n  public recalculateBounds() {\n    let bb = new BoundingBox();\n    for (const layer of this.layers.get()) {\n      for (const { graphic, options } of layer.graphics) {\n        let anchor = this.anchor;\n        let offset = this.offset;\n        if (options?.anchor) {\n          anchor = options.anchor;\n        }\n        if (options?.offset) {\n          offset = options.offset;\n        }\n        const bounds = graphic.localBounds;\n        const offsetX = -bounds.width *  anchor.x + offset.x;\n        const offsetY = -bounds.height *  anchor.y + offset.y;\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\n      }\n    }\n    this._localBounds = bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    if (!this._localBounds) {\n      this.recalculateBounds();\n    }\n    return this._localBounds;\n  }\n\n  /**\n   * Update underlying graphics if necesary, called internally\n   * @param elapsed\n   * @internal\n   */\n  public update(elapsed: number, idempotencyToken: number = 0) {\n    for (const layer of this.layers.get()) {\n      for (const { graphic } of layer.graphics) {\n        if (hasGraphicsTick(graphic)) {\n          graphic?.tick(elapsed, idempotencyToken);\n        }\n      }\n    }\n  }\n}\n","import { Raster, RasterOptions } from './Raster';\n\nexport interface RectangleOptions {\n  width: number;\n  height: number;\n}\n\n/**\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\n */\nexport class Rectangle extends Raster {\n  constructor(options: RasterOptions & RectangleOptions) {\n    super(options);\n    this.width = options.width;\n    this.height = options.height;\n    this.rasterize();\n  }\n\n  public clone(): Rectangle {\n    return new Rectangle({\n      width: this.width,\n      height: this.height,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.color) {\n      ctx.fillRect(0, 0, this.width, this.height);\n    }\n    if (this.strokeColor) {\n      ctx.strokeRect(0, 0, this.width, this.height);\n    }\n  }\n}\n","import { ImageFiltering } from '.';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CircleOptions {\n  radius: number;\n}\n\n/**\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\n *\n * Circles default to [[ImageFiltering.Blended]]\n */\nexport class Circle extends Raster {\n  private _radius: number = 0;\n  public get radius() {\n    return this._radius;\n  }\n  public set radius(value: number) {\n    this._radius = value;\n    this.width = this._radius * 2;\n    this.height = this._radius * 2;\n    this.flagDirty();\n  }\n  constructor(options: RasterOptions & CircleOptions) {\n    super(options);\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\n    this.radius = options.radius;\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Circle {\n    return new Circle({\n      radius: this.radius,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.radius > 0) {\n      ctx.beginPath();\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\n\n      if (this.color) {\n        ctx.fill();\n      }\n\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Add this component to optionally configure how the pointer\n * system detects pointer events.\n *\n * By default the collider shape is used and graphics bounds is not.\n *\n * If both collider shape and graphics bounds are enabled it will fire events if either or\n * are intersecting the pointer.\n */\nexport class PointerComponent extends Component<'ex.pointer'> {\n  public readonly type = 'ex.pointer';\n  /**\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\n   * user pointer events only to trigger on the same collision geometry used in the collider component\n   * for collision resolution. Default is `true`.\n   */\n  public useColliderShape = true;\n  /**\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\n   * bounds around the graphic to trigger pointer events. Default is `false`.\n   */\n  public useGraphicsBounds = false;\n}","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Entity } from '../EntityComponentSystem/Entity';\nimport { Action } from './Action';\n\n/**\n * Action Queues represent an ordered sequence of actions\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _entity: Entity;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  /**\n   * Add an action to the sequence\n   * @param action\n   */\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  /**\n   * Remove an action by reference from the sequence\n   * @param action\n   */\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  /**\n   * Removes all actions from this sequence\n   */\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  /**\n   *\n   * @returns The total list of actions in this sequence complete or not\n   */\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  /**\n   *\n   * @returns `true` if there are more actions to process in the sequence\n   */\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  /**\n   * @returns `true` if the current sequence of actions is done\n   */\n  public isComplete(): boolean {\n    return this._actions.length === 0;\n  }\n\n  /**\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\n   */\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  /**\n   * Update the queue which updates actions and handles completing actions\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(elapsedMs);\n\n      if (this._currentAction.isComplete(this._entity)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\nexport class Repeat implements Action {\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    this._repeatBuilder(this._repeatContext);\n    this._repeat--; // current execution is the first repeat\n  }\n\n  public update(delta: number): void {\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\n/**\n * RepeatForever Action implementation, it is recommended you use the fluent action\n * context API.\n *\n *\n */\nexport class RepeatForever implements Action {\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeatBuilder(this._repeatContext);\n  }\n\n  public update(delta: number): void {\n    if (this._stopped) {\n      return;\n    }\n\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class MoveBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _entity: Entity;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\n    this._entity = entity;\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    if (this.isComplete(this._entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    } else {\n      this._motion.vel = this._dir.scale(this._speed);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class MoveTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete(this.entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { vec } from '../../Math/vector';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\nimport { Entity } from '../../EntityComponentSystem/Entity';\n\nexport class ScaleTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._tx.scale.x;\n      this._startY = this._tx.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.x = this._speedX * directionX;\n    } else {\n      this._motion.scaleFactor.x = 0;\n    }\n\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.y = this._speedY * directionY;\n    } else {\n      this._motion.scaleFactor.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._tx.scale = vec(this._endX, this._endY);\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\n\nexport class ScaleBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._tx.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._tx.scale = this._endScale;\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class CallMethod implements Action {\n  private _method: () => any = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(method: () => any) {\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method();\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n","import { Entity} from '../../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Actor } from '../../Actor';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class EaseTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    entity: Entity,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    // Need to update lerp time first, otherwise the first update will always be zero\n    this._currentLerpTime += delta;\n    let newX = this._tx.pos.x;\n    let newY = this._tx.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      // Given the lerp position figure out the velocity in pixels per second\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\n    } else {\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n      this._motion.vel = Vector.Zero;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n}\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\n\nexport class Blink implements Action {\n  private _graphics: GraphicsComponent;\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n    if (!this._graphics) {\n      return;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\n      this._graphics.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._graphics.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._graphics.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    if (this._graphics) {\n      this._graphics.visible = true;\n    }\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class Fade implements Action {\n  private _graphics: GraphicsComponent;\n  public x: number;\n  public y: number;\n\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, endOpacity: number, speed: number) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._graphics) {\n      return;\n    }\n\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._graphics.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._graphics.opacity += (this._multiplier *\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._graphics.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class Delay implements Action {\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(delay: number) {\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionsComponent } from '../ActionsComponent';\n\nexport class Die implements Action {\n  private _entity: Entity;\n  private _stopped = false;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  public update(_delta: number): void {\n    this._entity.get(ActionsComponent).clearActions();\n    this._entity.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Follow implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _followTx: TransformComponent;\n  private _followMotion: MotionComponent;\n\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._followTx = entityToFollow.get(TransformComponent);\n    this._followMotion = entityToFollow.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._motion.vel = vec(m.x, m.y);\n    } else {\n      this._motion.vel = vec(0, 0);\n    }\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Meet implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _meetTx: TransformComponent;\n  private _meetMotion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\n    this._tx = actor.get(TransformComponent);\n    this._motion = actor.get(MotionComponent);\n    this._meetTx = actorToMeet.get(TransformComponent);\n    this._meetMotion = actorToMeet.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { RotationType } from './RotationType';\n\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { Repeat } from './Action/Repeat';\nimport { RepeatForever } from './Action/RepeatForever';\nimport { MoveBy } from './Action/MoveBy';\nimport { MoveTo } from './Action/MoveTo';\nimport { RotateTo } from './Action/RotateTo';\nimport { RotateBy } from './Action/RotateBy';\nimport { ScaleTo } from './Action/ScaleTo';\nimport { ScaleBy } from './Action/ScaleBy';\nimport { CallMethod } from './Action/CallMethod';\nimport { EaseTo } from './Action/EaseTo';\nimport { Blink } from './Action/Blink';\nimport { Fade } from './Action/Fade';\nimport { Delay } from './Action/Delay';\nimport { Die } from './Action/Die';\nimport { Follow } from './Action/Follow';\nimport { Meet } from './Action/Meet';\nimport { Vector } from '../Math/vector';\nimport { Entity } from '../EntityComponentSystem/Entity';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[Action]] interface.\n */\nexport class ActionContext {\n  private _entity: Entity;\n  private _queue: ActionQueue;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n    this._queue = new ActionQueue(entity);\n  }\n\n  public getQueue(): ActionQueue {\n    return this._queue;\n  }\n\n  public update(elapsedMs: number) {\n    this._queue.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._queue.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\n  public easeTo(...args: any[]): ActionContext {\n    let x = 0;\n    let y = 0;\n    let duration = 0;\n    let easingFcn = EasingFunctions.Linear;\n    if (args[0] instanceof Vector) {\n      x = args[0].x;\n      y = args[0].y;\n      duration = args[1];\n      easingFcn = args[2] ?? easingFcn;\n    } else {\n      x = args[0];\n      y = args[1];\n      duration = args[2];\n      easingFcn = args[3] ?? easingFcn;\n    }\n\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let x = 0;\n    let y = 0;\n    let speed = 0;\n    if (xOrPos instanceof Vector) {\n      x = xOrPos.x;\n      y = xOrPos.y;\n      speed = yOrSpeed;\n    } else {\n      x = xOrPos;\n      y = yOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let xOffset = 0;\n    let yOffset = 0;\n    let speed = 0;\n    if (xOffsetOrVector instanceof Vector) {\n      xOffset = xOffsetOrVector.x;\n      yOffset = xOffsetOrVector.y;\n      speed = yOffsetOrSpeed;\n    } else {\n      xOffset = xOffsetOrVector;\n      yOffset = yOffsetOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number | undefined,\n    speedYOrUndefined?: number | undefined): ActionContext {\n\n    let sizeX = 1;\n    let sizeY = 1;\n    let speedX = 0;\n    let speedY = 0;\n\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\n      sizeX = sizeXOrVector.x;\n      sizeY = sizeXOrVector.y;\n\n      speedX = sizeYOrSpeed.x;\n      speedY = sizeYOrSpeed.y;\n    }\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\n      sizeX = sizeXOrVector;\n      sizeY = sizeYOrSpeed;\n\n      speedX = speedXOrUndefined;\n      speedY = speedYOrUndefined;\n    }\n\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\n    let sizeOffsetX = 1;\n    let sizeOffsetY = 1;\n\n    if (sizeOffsetXOrVector instanceof Vector) {\n      sizeOffsetX = sizeOffsetXOrVector.x;\n      sizeOffsetY = sizeOffsetXOrVector.y;\n\n      speed = sizeOffsetYOrSpeed;\n    }\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\n      sizeOffsetX = sizeOffsetXOrVector;\n      sizeOffsetY = sizeOffsetYOrSpeed;\n    }\n\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    this._queue.add(new Fade(this._entity, opacity, time));\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    this._queue.add(new Delay(time));\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    this._queue.add(new Die(this._entity));\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    this._queue.add(new CallMethod(method));\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever(repeatBuilder);\n      return this;\n    }\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Entity, followDistance?: number): ActionContext {\n    if (followDistance === undefined) {\n      this._queue.add(new Follow(this._entity, entity));\n    } else {\n      this._queue.add(new Follow(this._entity, entity, followDistance));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Entity, speed?: number): ActionContext {\n    if (speed === undefined) {\n      this._queue.add(new Meet(this._entity, entity));\n    } else {\n      this._queue.add(new Meet(this._entity, entity, speed));\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    const temp = new Promise<void>((resolve) => {\n      this._queue.add(\n        new CallMethod(() => {\n          resolve();\n        })\n      );\n    });\n    return temp;\n  }\n}\n","import { ActionContext } from './ActionContext';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Actor } from '../Actor';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Vector } from '../Math/vector';\nimport { EasingFunction } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { RotationType } from './RotationType';\n\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\n\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\n  public readonly type = 'ex.actions';\n  dependencies = [TransformComponent, MotionComponent];\n  private _ctx: ActionContext;\n\n  onAdd(entity: Entity) {\n    this._ctx = new ActionContext(entity);\n  }\n\n  onRemove() {\n    this._ctx = null;\n  }\n\n  /**\n   * Returns the internal action queue\n   * @returns action queue\n   */\n  public getQueue(): ActionQueue {\n    return this._ctx?.getQueue();\n  }\n\n  /**\n   * Updates the internal action context, performing action and moving through the internal queue\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number): void {\n    return this._ctx?.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._ctx?.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\n  public easeTo(...args: any[]): ActionContext {\n    return this._ctx.easeTo.apply(this._ctx, args);\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param offset The (x, y) offset to apply to this actor\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(\n    sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number,\n    speedYOrUndefined?: number): ActionContext {\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    return this._ctx.fade(opacity, time);\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    return this._ctx.delay(time);\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    return this._ctx.die();\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    return this._ctx.callMethod(method);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    return this._ctx.repeat(repeatBuilder, times);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    return this._ctx.repeatForever(repeatBuilder);\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Actor, followDistance?: number): ActionContext {\n    return this._ctx.follow(entity, followDistance);\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Actor, speed?: number): ActionContext {\n    return this._ctx.meet(entity, speed);\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    return this._ctx.toPromise();\n  }\n}","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { RasterOptions } from './Raster';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\n/**\n * Represents a system or web font in Excalibur\n *\n * If no options specified, the system sans-serif 10 pixel is used\n *\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\n */\nexport class Font extends Graphic implements FontRenderer {\n  /**\n   * Set the font filtering mode, by default set to [[ImageFiltering.Blended]] regardless of the engine default smoothing\n   *\n   * If you have a pixel style font that may be a reason to switch this to [[ImageFiltering.Pixel]]\n   */\n  public filtering: ImageFiltering = ImageFiltering.Blended;\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\n    super(options); // <- Graphics properties\n\n    // Raster properties\n    this.smoothing = options?.smoothing ?? this.smoothing;\n    this.padding = options?.padding ?? this.padding;\n    this.color = options?.color ?? this.color;\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\n    this.lineDash = options?.lineDash ?? this.lineDash;\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\n    this.filtering = options?.filtering ?? this.filtering;\n\n    // Font specific properties\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 2)\n   */\n  public quality = 2;\n\n  // Raster properties for fonts\n  public padding = 2;\n  public smoothing = false;\n  public lineWidth = 1;\n  public lineDash: number[] = [];\n  public color: Color = Color.Black;\n  public strokeColor: Color;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _textBounds: BoundingBox = new BoundingBox();\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\n    // TODO weird vestigial drawimage\n  }\n\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n\n  /**\n   * Returns a BoundingBox that is the total size of the text including multiple lines\n   *\n   * Does not include any padding or adjustment\n   * @param text\n   * @returns BoundingBox\n   */\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const ctx = this._getTextBitmap(text);\n\n    this._applyFont(ctx); // font must be applied to the context to measure it\n    const metrics = ctx.measureText(maxWidthLine);\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n    // TODO lineheight makes the text bounds wonky\n    const lineAdjustedHeight = textHeight * lines.length;\n    textHeight = lineAdjustedHeight;\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n    const x = 0;\n    const y = 0;\n    return new BoundingBox({\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n      bottom: y + bottomBounds + this.padding,\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n    });\n  }\n\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\n\n    // Changing the width and height clears the context properties\n    // We double the bitmap width to account for all possible alignment\n    // We scale by \"quality\" so we render text without jaggies\n    bitmap.canvas.width = (textBounds.width + this.padding * 2) * 2 * this.quality;\n    bitmap.canvas.height = (textBounds.height + this.padding * 2) * 2 * this.quality;\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    ex.restore();\n  }\n\n  /**\n   * We need to identify bitmaps with more than just the text content\n   *\n   * Any properties that can change the rendering of the text\n   */\n  private _getRasterPropertiesHash(color?: Color): string {\n    const hash = '__hashcode__' +\n    this.fontString +\n    this.showDebug +\n    this.textAlign +\n    this.baseAlign +\n    this.direction +\n    JSON.stringify(this.shadow) +\n    (this.padding.toString() +\n    this.smoothing.toString() +\n    this.lineWidth.toString() +\n    this.lineDash.toString() +\n    this.strokeColor?.toString() +\n    ( color ? color.toString() : this.color?.toString()).toString());\n    return hash;\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D, color: Color) {\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = color ? color.toString() : this.color?.toString();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + ctx.canvas.width / 2, this.padding + ctx.canvas.height / 2);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  private _drawText(ctx: CanvasRenderingContext2D, text: string, colorOverride: Color, lineHeight: number): void {\n    const lines = text.split('\\n');\n    this._applyRasterProperties(ctx, colorOverride);\n    this._applyFont(ctx);\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      if (this.color) {\n        ctx.fillText(line, 0, i * lineHeight);\n      }\n\n      if (this.strokeColor) {\n        ctx.strokeText(line, 0, i * lineHeight);\n      }\n    }\n\n    if (this.showDebug) {\n      // Horizontal line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\n      // Vertical line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\n    }\n  }\n\n  private _textToBitmap = new Map<string, CanvasRenderingContext2D>();\n  private _bitmapUsage = new Map<CanvasRenderingContext2D, number>();\n  private _getTextBitmap(text: string, color?: Color): CanvasRenderingContext2D {\n    const textAndHash = text + this._getRasterPropertiesHash(color);\n    const bitmap = this._textToBitmap.get(textAndHash);\n    if (bitmap) {\n      return bitmap;\n    }\n\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    this._textToBitmap.set(textAndHash, ctx);\n    return ctx;\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number) {\n    if (this.showDebug) {\n      this.clearCache();\n    }\n    this.checkAndClearCache();\n    const bitmap = this._getTextBitmap(text, colorOverride);\n    const isNewBitmap = !this._bitmapUsage.get(bitmap);\n    this._textBounds = this.measureText(text);\n\n    if (isNewBitmap) {\n      this._setDimension(this._textBounds, bitmap);\n    }\n\n    this._preDraw(ex, x, y);\n\n    const lines = text.split('\\n');\n    const lineHeight = this._textBounds.height / lines.length;\n\n\n    const rasterWidth = bitmap.canvas.width;\n    const rasterHeight = bitmap.canvas.height;\n\n    if (isNewBitmap) {\n      // draws the text to the bitmap\n      this._drawText(bitmap, text, colorOverride, lineHeight);\n      // draws the bitmap to excalibur graphics context\n      TextureLoader.load(bitmap.canvas, this.filtering, true);\n    }\n\n    ex.drawImage(\n      bitmap.canvas,\n      0,\n      0,\n      rasterWidth,\n      rasterHeight,\n      x - rasterWidth / this.quality / 2,\n      y - rasterHeight / this.quality / 2,\n      rasterWidth / this.quality,\n      rasterHeight / this.quality\n    );\n\n    this._postDraw(ex);\n\n    // Cache the bitmap for certain amount of time\n    this._bitmapUsage.set(bitmap, performance.now());\n  }\n\n  /**\n   * Get the internal cache size of the font\n   * This is useful when debugging memory usage, these numbers indicate the number of cached in memory text bitmaps\n   */\n  public get cacheSize() {\n    return this._bitmapUsage.size;\n  }\n\n  /**\n   * Force clear all cached text bitmaps\n   */\n  public clearCache() {\n    this._bitmapUsage.clear();\n  }\n\n  /**\n   * Remove any expired cached text bitmaps\n   */\n  public checkAndClearCache() {\n    for (const [bitmap, time] of this._bitmapUsage.entries()) {\n      // if bitmap hasn't been used in 1 second clear it\n      if (time + 1000 < performance.now()) {\n        this._bitmapUsage.delete(bitmap);\n      }\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { SpriteFont } from './SpriteFont';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Color } from '../Color';\nimport { Font } from './Font';\n\nexport interface TextOptions {\n  /**\n   * Text to draw\n   */\n  text: string;\n\n  /**\n   * Optionally override the font color, currently unsupported by SpriteFont\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\n   */\n  font?: Font | SpriteFont;\n}\n\n/**\n * Represent Text graphics in excalibur\n *\n * Useful for in game labels, ui, or overlays\n */\nexport class Text extends Graphic {\n  public color?: Color;\n  constructor(options: TextOptions & GraphicOptions) {\n    super(options);\n    // This order is important font, color, then text\n    this.font = options.font ?? new Font();\n    this.color = options.color ?? this.color;\n    this.text = options.text;\n  }\n\n  public clone(): Text {\n    return new Text({\n      text: this.text.slice(),\n      color: this.color?.clone() ?? Color.Black,\n      font: this.font.clone()\n    });\n  }\n\n  private _text: string = '';\n  public get text() {\n    return this._text;\n  }\n\n  public set text(value: string) {\n    this._text = value;\n    const bounds = this.font.measureText(this._text);\n    this._textWidth = bounds.width;\n    this._textHeight = bounds.height;\n  }\n\n  private _font: Font | SpriteFont;\n  public get font(): Font | SpriteFont {\n    return this._font;\n  }\n  public set font(font: Font | SpriteFont) {\n    this._font = font;\n  }\n\n  private _textWidth: number = 0;\n\n  public get width() {\n    if (this._textWidth === 0) {\n      this._calculateDimension();\n    }\n    return this._textWidth * this.scale.x;\n  }\n\n  private _textHeight: number = 0;\n  public get height() {\n    if (this._textHeight === 0) {\n      this._calculateDimension();\n    }\n    return this._textHeight * this.scale.y;\n  }\n\n  private _calculateDimension() {\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n  }\n\n  public get localBounds(): BoundingBox {\n    return this.font.measureText(this._text).scale(this.scale);\n  }\n\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    let color = Color.Black;\n    if (this.font instanceof Font) {\n      color = this.color ?? this.font.color;\n    }\n\n    if (this.isStale() || this.font.isStale()) {\n      this.font.flipHorizontal = this.flipHorizontal;\n      this.font.flipVertical = this.flipVertical;\n      this.font.rotation = this.rotation;\n      this.font.origin = this.origin;\n      this.font.opacity = this.opacity;\n    }\n\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n\n    this.font.render(ex, this._text, color, x, y);\n    if (this.font.showDebug) {\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\n    }\n  }\n}\n","import { Texture } from './Drawing/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { Engine } from './Engine';\nimport { Color } from './Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Animation } from './Drawing/Animation';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { Vector, vec } from './Math/vector';\nimport { BodyComponent } from './Collision/BodyComponent';\nimport { Eventable } from './Interfaces/Evented';\nimport * as Traits from './Traits/Index';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\nimport { CollisionType } from './Collision/CollisionType';\n\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Rectangle } from './Graphics/Rectangle';\nimport { Flags, Legacy } from './Flags';\nimport { obsolete } from './Util/Decorators';\nimport { ColliderComponent } from './Collision/ColliderComponent';\nimport { Shape } from './Collision/Colliders/Shape';\nimport { watch } from './Util/Watch';\nimport { Collider, CollisionGroup } from './Collision/Index';\nimport { Circle } from './Graphics/Circle';\nimport { PointerEvent } from './Input/PointerEvent';\nimport { WheelEvent } from './Input/WheelEvent';\nimport { PointerComponent } from './Input/PointerComponent';\nimport { ActionsComponent } from './Actions/ActionsComponent';\nimport { Raster } from './Graphics/Raster';\nimport { Text } from './Graphics/Text';\n\n/**\n * Type guard for checking if something is an Actor\n * @param x\n */\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\n/**\n * Actor contructor options\n */\nexport interface ActorArgs {\n  /**\n   * Optionally set the name of the actor, default is 'anonymous'\n   */\n  name?: string;\n  /**\n   * Optionally set the x position of the actor, default is 0\n   */\n  x?: number;\n  /**\n   * Optionally set the y position of the actor, default is 0\n   */\n  y?: number;\n  /**\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\n   */\n  pos?: Vector;\n  /**\n   * Optionally set the coordinate plane of the actor, default is [[CoordPlane.World]] meaning actor is subject to camera positioning\n   */\n  coordPlane?: CoordPlane;\n  /**\n   * Optionally set the width of a box collider for the actor\n   */\n  width?: number;\n  /**\n   * Optionally set the height of a box collider for the actor\n   */\n  height?: number;\n  /**\n   * Optionally set the radius of the circle collider for the actor\n   */\n  radius?: number;\n  /**\n   * Optionally set the velocity of the actor in pixels/sec\n   */\n  vel?: Vector;\n  /**\n   * Optionally set the acceleration of the actor in pixels/sec^2\n   */\n  acc?: Vector;\n  /**\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\n   */\n  rotation?: number;\n  /**\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\n   */\n  angularVelocity?: number;\n  /**\n   * Optionally set the scale of the actor's transform\n   */\n  scale?: Vector;\n  /**\n   * Optionally set the z index of the actor, default is 0\n   */\n  z?: number;\n  /**\n   * Optionally set the color of an actor, only used if no graphics are present\n   * If a width/height or a radius was set a default graphic will be added\n   */\n  color?: Color;\n  /**\n   * Optionally set the visibility of the actor\n   */\n  visible?: boolean;\n  /**\n   * Optionally set the anchor for graphics in the actor\n   */\n  anchor?: Vector;\n  /**\n   * Optionally set the collision type\n   */\n  collisionType?: CollisionType;\n  /**\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\n   */\n  collider?: Collider;\n  /**\n   * Optionally suppy a [[CollisionGroup]]\n   */\n  collisionGroup?: CollisionGroup;\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n */\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Set defaults for all Actors\n   */\n  public static defaults = {\n    anchor: Vector.Half\n  };\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): BodyComponent {\n    return this.get(BodyComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[TransformComponent]]\n   */\n  public get transform(): TransformComponent {\n    return this.get(TransformComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[MotionComponent]]\n   */\n  public get motion(): MotionComponent {\n    return this.get(MotionComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[GraphicsComponent]]\n   */\n  public get graphics(): GraphicsComponent {\n    return this.get(GraphicsComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[ColliderComponent]]\n   */\n  public get collider(): ColliderComponent {\n    return this.get(ColliderComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[PointerComponent]] config\n   */\n  public get pointer(): PointerComponent {\n    return this.get(PointerComponent);\n  }\n\n  /**\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\n   *\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\n   * [[ActionContext|Action context]] of the actor.\n   */\n  public get actions(): ActionsComponent {\n    return this.get(ActionsComponent);\n  }\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.transform.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.transform.pos = thePos.clone();\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.motion.vel = theVel.clone();\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.motion.acc = theAcc.clone();\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.transform.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.transform.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set angularVelocity(angularVelocity: number) {\n    this.motion.angularVelocity = angularVelocity;\n  }\n\n  public get scale(): Vector {\n    return this.get(TransformComponent).scale;\n  }\n\n  public set scale(scale: Vector) {\n    this.get(TransformComponent).scale = scale;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\n  public get anchor(): Vector {\n    return this._anchor;\n  }\n\n  public set anchor(vec: Vector) {\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\n    this._handleAnchorChange(vec);\n  }\n\n  private _handleAnchorChange(v: Vector) {\n    if (this.graphics) {\n      this.graphics.anchor = v;\n    }\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public get isOffScreen(): boolean {\n    return this.hasTag('offscreen');\n  }\n  /**\n   * The visibility of an actor\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\n  public get visible(): boolean {\n    return this.graphics.visible;\n  }\n\n  public set visible(isVisible: boolean) {\n    this.graphics.visible = isVisible;\n  }\n\n  /**\n   * The opacity of an actor.\n   *\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\n   */\n  @obsolete({\n    message: 'Actor.opacity will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.opacity'\n  })\n  public get opacity(): number {\n    return this.graphics.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this.graphics.opacity = opacity;\n  }\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * @deprecated will be removed in v0.26.0\n   */\n  public frames: { [key: string]: Drawable } = {};\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   * @deprecated will be removed in v0.26.0\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Draggable helper\n   */\n  private _draggable: boolean = false;\n  private _dragging: boolean = false;\n\n  private _pointerDragStartHandler = () => {\n    this._dragging = true;\n  };\n\n  private _pointerDragEndHandler = () => {\n    this._dragging = false;\n  };\n\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  public get draggable(): boolean {\n    return this._draggable;\n  }\n\n  public set draggable(isDraggable: boolean) {\n    if (isDraggable) {\n      if (isDraggable && !this._draggable) {\n        this.on('pointerdragstart', this._pointerDragStartHandler);\n        this.on('pointerdragend', this._pointerDragEndHandler);\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\n      } else if (!isDraggable && this._draggable) {\n        this.off('pointerdragstart', this._pointerDragStartHandler);\n        this.off('pointerdragend', this._pointerDragEndHandler);\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\n      }\n\n      this._draggable = isDraggable;\n    }\n  }\n\n  /**\n   * Modify the current actor update pipeline.\n   * @deprecated will be removed in v0.26.0\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor's current graphic\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n    const defaultLayer = this.graphics.layers.default;\n    const currentGraphic = defaultLayer.graphics[0]?.graphic;\n    if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\n      currentGraphic.color = this._color;\n    }\n  }\n  private _color: Color;\n\n  // #endregion\n\n  /**\n   *\n   * @param config\n   */\n  constructor(config?: ActorArgs) {\n    super();\n\n    const {\n      name,\n      x,\n      y,\n      pos,\n      coordPlane,\n      scale,\n      width,\n      height,\n      radius,\n      collider,\n      vel,\n      acc,\n      rotation,\n      angularVelocity,\n      z,\n      color,\n      visible,\n      anchor,\n      collisionType,\n      collisionGroup\n    } = {\n      ...config\n    };\n\n    this._setName(name);\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\n    const tx = new TransformComponent();\n    this.addComponent(tx);\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.rotation = rotation ?? 0;\n    this.scale = scale ?? vec(1, 1);\n    this.z = z ?? 0;\n    tx.coordPlane = coordPlane ?? CoordPlane.World;\n\n    this.addComponent(new PointerComponent);\n\n    this.addComponent(new GraphicsComponent({\n      anchor: this.anchor\n    }));\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(new MotionComponent());\n    this.vel = vel ?? Vector.Zero;\n    this.acc = acc ?? Vector.Zero;\n    this.angularVelocity = angularVelocity ?? 0;\n\n    this.addComponent(new ActionsComponent());\n\n    this.addComponent(new BodyComponent());\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\n    if (collisionGroup) {\n      this.body.group = collisionGroup;\n    }\n\n    if (collider) {\n      this.addComponent(new ColliderComponent(collider));\n    } else if (radius) {\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\n    } else {\n      if (width > 0 && height > 0) {\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\n      } else {\n        this.addComponent(new ColliderComponent()); // no collider\n      }\n    }\n\n    this.graphics.visible = visible ?? true;\n\n    if (color) {\n      this.color = color;\n      if (width && height) {\n        this.graphics.add(\n          new Rectangle({\n            color: color,\n            width,\n            height\n          })\n        );\n      } else if (radius) {\n        this.graphics.add(\n          new Circle({\n            color: color,\n            radius\n          })\n        );\n      }\n    }\n\n    // Build default pipeline\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      // TODO remove offscreen trait after legacy drawing removed\n      this.traits.push(new Traits.OffscreenCulling());\n    }\n\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  // #region Events\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      super.kill();\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this.active = true;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return !this.active;\n  }\n\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: number): void;\n  @obsolete({\n    message: 'Actor.setDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\n  })\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\n      this.currentDrawing.tick(0);\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  @obsolete({\n    message: 'Actor.addDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.add()'\n  })\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   */\n  public get z(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.getZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public getZIndex(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newZ new z-index to assign\n   */\n  public set z(newZ: number) {\n    this.get(TransformComponent).z = newZ;\n  }\n\n  /**\n   * @param newIndex new z-index to assign\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.setZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public setZIndex(newIndex: number) {\n    this.get(TransformComponent).z = newIndex;\n  }\n\n  /**\n   * Get the center point of an actor (global position)\n   */\n  public get center(): Vector {\n    const globalPos = this.getGlobalPos();\n    return new Vector(\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\n      globalPos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  /**\n   * Get the local center point of an actor\n   */\n  public get localCenter(): Vector {\n    return new Vector(\n      this.pos.x + this.width / 2 - this.anchor.x * this.width,\n      this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this.collider.localBounds.width * this.getGlobalScale().x;\n  }\n\n  public get height() {\n    return this.collider.localBounds.height * this.getGlobalScale().y;\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getGlobalRotation(): number {\n    return this.get(TransformComponent).globalRotation;\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getGlobalPos(): Vector {\n    return this.get(TransformComponent).globalPos;\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    return this.get(TransformComponent).globalScale;\n  }\n\n  // #region Collision\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    const point = vec(x, y);\n    const collider = this.get(ColliderComponent);\n    collider.update();\n    const geom = collider.get();\n    if (!geom) {\n      return false;\n    }\n    const containment = geom.contains(point);\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    const collider = this.get(ColliderComponent);\n    const otherCollider = actor.get(ColliderComponent);\n    const me = collider.get();\n    const other = otherCollider.get();\n    if (me && other) {\n      return me.getClosestLineBetween(other).getLength() <= distance;\n    }\n    return false;\n  }\n\n  // #endregion\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @internal\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Tick animations\n    const drawing = this.currentDrawing;\n    if (drawing && drawing instanceof Animation) {\n      drawing.tick(delta, engine.stats.currFrame.id);\n    }\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    // translate canvas by anchor offset\n    ctx.save();\n\n    if (this.currentDrawing) {\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\n\n      this._predraw(ctx, delta);\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\n    } else {\n      this._predraw(ctx, delta);\n      if (this.color && this.collider) {\n        // update collider geometry based on transform\n        const collider = this.get(ColliderComponent);\n        collider.update();\n        if (collider && !collider.bounds.hasZeroDimensions()) {\n          // Colliders are already shifted by anchor, unshift\n          ctx.globalAlpha = this.graphics.opacity;\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\n        }\n      }\n    }\n    ctx.restore();\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   *\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated will be removed in v0.26.0\n   * @internal\n   */\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n  // #endregion\n}\n","import { Vector, vec } from './Math/vector';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(config?: ActorArgs);\n\n  constructor(config?: ActorArgs) {\n    super({ ...config });\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\n    this.anchor = vec(0, 0);\n    this.body.collisionType = CollisionType.PreventCollision;\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\nimport { obsolete } from './Util/Decorators';\nimport { Logger } from './Util/Log';\n\nexport interface TimerOptions {\n  repeats?: boolean;\n  numberOfRepeats?: number;\n  fcn?: () => void;\n  interval: number;\n}\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  private _logger = Logger.getInstance();\n  private static _MAX_ID: number = 0;\n  public id: number = 0;\n\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n\n  private _running = false;\n\n  private _numberOfTicks: number = 0;\n  private _callbacks: Array<() => void>;\n\n  public interval: number = 10;\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n\n  private _complete = false;\n  public get complete() {\n    return this._complete;\n  }\n  public scene: Scene = null;\n\n  /**\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   * @param fcn        The callback to be fired after the interval is complete.\n   */\n  constructor(options: TimerOptions);\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (typeof fcn !== 'function') {\n      const options = fcn;\n      fcn = options.fcn;\n      interval = options.interval;\n      repeats = options.repeats;\n      numberOfRepeats = options.numberOfRepeats;\n    }\n\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.id = Timer._MAX_ID++;\n    this.interval = interval || this.interval;\n    this.repeats = repeats || this.repeats;\n\n    this._callbacks = [];\n\n    if (fcn) {\n      this.on(fcn);\n    }\n  }\n\n  /**\n   * Adds a new callback to be fired after the interval is complete\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\n   */\n  public on(fcn: () => void) {\n    this._callbacks.push(fcn);\n  }\n\n  /**\n   * Removes a callback from the callback list to be fired after the interval is complete.\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\n   */\n  public off(fcn: () => void) {\n    const index = this._callbacks.indexOf(fcn);\n    this._callbacks.splice(index, 1);\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (this._running) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this._complete = true;\n        this._running = false;\n        this._elapsedTime = 0;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this._callbacks.forEach((c) => {\n          c.call(this);\n        });\n\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this._complete = true;\n          this._running = false;\n          this._elapsedTime = 0;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   *\n   * Warning** you may need to call `timer.start()` again if the timer had completed\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this._complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * @returns milliseconds until the next action callback, if complete will return 0\n   */\n  public get timeToNextAction() {\n    if (this.complete) {\n      return 0;\n    }\n    return this.interval - this._elapsedTime;\n  }\n\n  /**\n   * @returns milliseconds elapsed toward the next action\n   */\n  public get timeElapsedTowardNextAction() {\n    return this._elapsedTime;\n  }\n\n  public get isRunning() {\n    return this._running;\n  }\n\n  /**\n   * Pauses the timer, time will no longer increment towards the next call\n   */\n  public pause(): Timer {\n    this._running = false;\n    return this;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   * @deprecated Will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\n  public unpause() {\n    this._running = true;\n  }\n\n  /**\n   * Resumes the timer, time will now increment towards the next call.\n   */\n  public resume(): Timer {\n    this._running = true;\n    return this;\n  }\n\n  /**\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\n   */\n  public start(): Timer {\n    if (!this.scene) {\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\n    }\n\n    this._running = true;\n    if (this.complete) {\n      this._complete = false;\n      this._elapsedTime = 0;\n      this._numberOfTicks = 0;\n    }\n\n    return this;\n  }\n\n  /**\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\n   */\n  public stop(): Timer {\n    this._running = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n    return this;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    this.pause();\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from '.';\nimport { Component } from '../EntityComponentSystem/Component';\n\n\n/**\n * Provide arbitrary drawing for the purposes of debugging your game\n *\n * Will only show when the Engine is set to debug mode [[Engine.showDebug]] or [[Engine.toggleDebug]]\n *\n */\nexport class DebugGraphicsComponent extends Component<'ex.debuggraphics'> {\n  readonly type = 'ex.debuggraphics';\n  constructor(public draw: (ctx: ExcaliburGraphicsContext) => void, public useTransform = true) {\n    super();\n  }\n}","import { Engine } from './Engine';\nimport { Screen } from './Screen';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { Vector, vec } from './Math/vector';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { Logger } from './Util/Log';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { watchAny } from './Util/Watch';\nimport { Matrix } from './Math/matrix';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param actor Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param actor Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n\n  /**\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\n   * @param box The bounding box to limit the camera to.\n   */\n  public limitCameraBounds(box: BoundingBox) {\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = cam.vel.clone();\n\n    // Calculate the stretch vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.size;\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Prevent a camera from going beyond the given camera dimensions.\n */\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\n  /**\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\n   *\n   * Note that this strategy does not perform any movement by itself.\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\n   *\n   * Make sure that the camera bounds are at least as large as the viewport size.\n   *\n   * @param target The bounding box to limit the camera to\n   */\n\n  boundSizeChecked: boolean = false; // Check and warn only once\n\n  constructor(public target: BoundingBox) {}\n\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\n    const focus = cam.getFocus();\n\n    if (!this.boundSizeChecked) {\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\n      }\n      this.boundSizeChecked = true;\n    }\n\n    let focusX = focus.x;\n    let focusY = focus.y;\n    if (focus.x < target.left + _eng.halfDrawWidth) {\n      focusX = target.left + _eng.halfDrawWidth;\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\n      focusX = target.right - _eng.halfDrawWidth;\n    }\n\n    if (focus.y < target.top + _eng.halfDrawHeight) {\n      focusY = target.top + _eng.halfDrawHeight;\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\n      focusY = target.bottom - _eng.halfDrawHeight;\n    }\n\n    return vec(focusX, focusY);\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  public transform: Matrix = Matrix.identity();\n  public inverse: Matrix = Matrix.identity();\n\n\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  /**\n   * Get or set current zoom of the camera, defaults to 1\n   */\n  private _z = 1;\n  public get zoom(): number {\n    return this._z;\n  }\n\n  public set zoom(val: number) {\n    this._z = val;\n    if (this._engine) {\n      this._halfWidth = this._engine.halfDrawWidth;\n      this._halfHeight = this._engine.halfDrawHeight;\n    }\n  }\n  /**\n   * Get or set rate of change in zoom, defaults to 0\n   */\n  public dz: number = 0;\n  /**\n   * Get or set zoom acceleration\n   */\n  public az: number = 0;\n\n  /**\n   * Current rotation of the camera\n   */\n  public rotation: number = 0;\n\n  /**\n   * Current angular velocity\n   * @deprecated will be removed in v0.26.0, use angularVelocity\n   */\n  public rx: number = 0;\n\n  /**\n   * Get or set the camera's angular velocity\n   */\n  public get angularVelocity(): number {\n    return this.rx;\n  }\n\n  public set angularVelocity(value: number) {\n    this.rx = value;\n  }\n\n  /**\n   * Get or set the camera's position\n   */\n  private _posChanged = false;\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\n  public get pos(): Vector {\n    return this._pos;\n  }\n  public set pos(vec: Vector) {\n    this._pos = watchAny(vec, () => (this._posChanged = true));\n    this._posChanged = true;\n  }\n\n  /**\n   * Get or set the camera's velocity\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * Get or set the camera's acceleration\n   */\n  public acc: Vector = Vector.Zero;\n\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpResolve: (value: Vector) => void;\n  private _lerpPromise: Promise<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomResolve: (val: boolean) => void;\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  private _halfWidth: number = 0;\n  private _halfHeight: number = 0;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this.pos.x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(value, this.pos.y);\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this.pos.y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(this.pos.x, value);\n    }\n  }\n\n  /**\n   * Get or set the camera's x velocity\n   */\n  public get dx() {\n    return this.vel.x;\n  }\n\n  public set dx(value: number) {\n    this.vel = vec(value, this.vel.y);\n  }\n\n  /**\n   * Get or set the camera's y velocity\n   */\n  public get dy() {\n    return this.vel.y;\n  }\n\n  public set dy(value: number) {\n    this.vel = vec(this.vel.x, value);\n  }\n\n  /**\n   * Get or set the camera's x acceleration\n   */\n  public get ax() {\n    return this.acc.x;\n  }\n\n  public set ax(value: number) {\n    this.acc = vec(value, this.acc.y);\n  }\n\n  /**\n   * Get or set the camera's y acceleration\n   */\n  public get ay() {\n    return this.acc.y;\n  }\n\n  public set ay(value: number) {\n    this.acc = vec(this.acc.x, value);\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return this.pos;\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return Promise.reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpResolve) {\n      this._lerpResolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>((resolve) => {\n      this._lerpResolve = resolve;\n    });\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>((resolve) => {\n      this._zoomResolve = resolve;\n    });\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.zoom;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.zoom = scale;\n      return Promise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  private _viewport: BoundingBox = null;\n  /**\n   * Gets the bounding box of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._viewport) {\n      return this._viewport;\n    }\n\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _screen: Screen;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this._engine = _engine;\n      this._screen = _engine.screen;\n\n      const currentRes = this._screen.resolution;\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\n      if (!this._engine.loadingComplete) {\n        // If there was a loading screen, we peek the configured resolution\n        const res = this._screen.peekResolution();\n        if (res) {\n          center = vec(res.width / 2, res.height / 2);\n        }\n      }\n      this._halfWidth = center.x;\n      this._halfHeight = center.y;\n\n      // If the user has not set the camera pos, apply default center screen position\n      if (!this._posChanged) {\n        this.pos = center;\n      }\n      // First frame bootstrap\n\n      // Ensure camera tx is correct\n      // Run update twice to ensure properties are init'd\n      this.updateTransform();\n\n      // Run strategies for first frame\n      this.runStrategies(_engine, _engine.clock.elapsed());\n\n      // Setup the first frame viewport\n      this.updateViewport();\n\n      // It's important to update the camera after strategies\n      // This prevents jitter\n      this.updateTransform();\n\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public runStrategies(engine: Engine, delta: number) {\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, engine, delta);\n    }\n  }\n\n  public updateViewport() {\n    // recalc viewport\n    this._viewport = new BoundingBox(\n      this.x - this._halfWidth,\n      this.y - this._halfHeight,\n      this.x + this._halfWidth,\n      this.y + this._halfHeight\n    );\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\n    this.zoom += (this.dz * delta) / 1000;\n\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.angularVelocity * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.zoom = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.zoom = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomResolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this.pos = lerpPoint;\n\n        this._currentLerpTime += delta;\n      } else {\n        this.pos = this._lerpEnd;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpResolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    this.runStrategies(_engine, delta);\n\n    this.updateViewport();\n\n    // It's important to update the camera after strategies\n    // This prevents jitter\n    this.updateTransform();\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx Canvas context to apply transformations\n   */\n  public draw(ctx: CanvasRenderingContext2D): void;\n  public draw(ctx: ExcaliburGraphicsContext): void;\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\n    // Apply transform\n    if (ctx instanceof CanvasRenderingContext2D) {\n      // TODO This will be removed in v0.26.0\n      const focus = this.getFocus();\n\n      // center the camera\n      const newCanvasWidth = this._screen.resolution.width / this.zoom;\n      const newCanvasHeight = this._screen.resolution.height / this.zoom;\n      const cameraPos = vec(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n      ctx.scale(this.zoom, this.zoom);\n      ctx.translate(cameraPos.x, cameraPos.y);\n    } else {\n      ctx.multiply(this.transform);\n    }\n  }\n\n  public updateTransform() {\n    // center the camera\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\n    const cameraPos = vec(-this.x + newCanvasWidth / 2 + this._xShake, -this.y + newCanvasHeight / 2 + this._yShake);\n\n    // Calculate camera transform\n    this.transform.reset();\n    this.transform.scale(this.zoom, this.zoom);\n    this.transform.translate(cameraPos.x, cameraPos.y);\n    this.transform.getAffineInverse(this.inverse);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Engine } from '../Engine';\nimport { Vector, vec } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport * as Events from '../Events';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { BodyComponent } from '../Collision/BodyComponent';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { Shape } from '../Collision/Colliders/Shape';\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from '../Graphics';\nimport * as Graphics from '../Graphics';\nimport { CanvasDrawComponent, Sprite } from '../Drawing/Index';\nimport { Sprite as LegacySprite } from '../Drawing/Index';\nimport { removeItemFromArray } from '../Util/Util';\nimport { obsolete } from '../Util/Decorators';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\nimport { Color } from '../Color';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\nimport { Collider } from '../Collision/Colliders/Collider';\n\nexport interface TileMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Width of an individual tile in pixels\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\n *\n * TileMaps are useful for top down or side scrolling grid oriented games.\n */\nexport class TileMap extends Entity {\n  private _token = 0;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = Number.MAX_VALUE;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = Number.MAX_VALUE;\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\n\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\n  public logger: Logger = Logger.getInstance();\n  public readonly tiles: Tile[] = [];\n  private _rows: Tile[][] = [];\n  private _cols: Tile[][] = [];\n\n  public readonly tileWidth: number;\n  public readonly tileHeight: number;\n  public readonly height: number;\n  public readonly width: number;\n\n  private _collidersDirty = true;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n  private _transform: TransformComponent;\n  private _motion: MotionComponent;\n  private _collider: ColliderComponent;\n  private _composite: CompositeCollider;\n\n  public get x(): number {\n    return this._transform.pos.x ?? 0;\n  }\n\n  public set x(val: number) {\n    if (this._transform?.pos) {\n      this.get(TransformComponent).pos = vec(val, this.y);\n    }\n  }\n\n  public get y(): number {\n    return this._transform?.pos.y ?? 0;\n  }\n\n  public set y(val: number) {\n    if (this._transform?.pos) {\n      this._transform.pos = vec(this.x, val);\n    }\n  }\n\n  public get z(): number {\n    return this._transform.z ?? 0;\n  }\n\n  public set z(val: number) {\n    if (this._transform) {\n      this._transform.z = val;\n    }\n  }\n\n  public get rotation(): number {\n    return this._transform?.rotation ?? 0;\n  }\n\n  public set rotation(val: number) {\n    if (this._transform?.rotation) {\n      this._transform.rotation = val;\n    }\n  }\n\n  public get scale(): Vector {\n    return this._transform?.scale ?? Vector.One;\n  }\n\n  public set scale(val: Vector) {\n    if (this._transform?.scale) {\n      this._transform.scale = val;\n    }\n  }\n\n  public get pos(): Vector {\n    return this._transform.pos;\n  }\n\n  public set pos(val: Vector) {\n    this._transform.pos = val;\n  }\n\n  public get vel(): Vector {\n    return this._motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this._motion.vel = val;\n  }\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n\n  /**\n   * @param options\n   */\n  constructor(options: TileMapOptions) {\n    super(null, options.name);\n    this.addComponent(new TransformComponent());\n    this.addComponent(new MotionComponent());\n    this.addComponent(\n      new BodyComponent({\n        type: CollisionType.Fixed\n      })\n    );\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(\n      new GraphicsComponent({\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\n      })\n    );\n    this.addComponent(new DebugGraphicsComponent((ctx) => this.debug(ctx)));\n    this.addComponent(new ColliderComponent());\n    this._transform = this.get(TransformComponent);\n    this._motion = this.get(MotionComponent);\n    this._collider = this.get(ColliderComponent);\n    this._composite = this._collider.useCompositeCollider([]);\n\n    this._transform.pos = options.pos ?? Vector.Zero;\n    this._transform.posChanged$.subscribe(() => this.flagCollidersDirty());\n    this.tileWidth = options.tileWidth;\n    this.tileHeight = options.tileHeight;\n    this.height = options.height;\n    this.width = options.width;\n    this.tiles = new Array<Tile>(this.height * this.width);\n    this._rows = new Array(this.height);\n    this._cols = new Array(this.width);\n    let currentCol: Tile[] = [];\n    for (let i = 0; i < this.width; i++) {\n      for (let j = 0; j < this.height; j++) {\n        const cd = new Tile({\n          x: i,\n          y: j,\n          map: this\n        });\n        cd.map = this;\n        this.tiles[i + j * this.width] = cd;\n        currentCol.push(cd);\n        if (!this._rows[j]) {\n          this._rows[j] = [];\n        }\n        this._rows[j].push(cd);\n      }\n      this._cols[i] = currentCol;\n      currentCol = [];\n    }\n\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\n      left: 0,\n      top: 0,\n      right: this.width * this.tileWidth,\n      bottom: this.height * this.tileHeight\n    });\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  /**\n   *\n   * @param key\n   * @param spriteSheet\n   * @deprecated No longer used, will be removed in v0.26.0\n   */\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\n      this._spriteSheets[key] = spriteSheet;\n    } else {\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\n    }\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  /**\n   * Tiles colliders based on the solid tiles in the tilemap.\n   */\n  private _updateColliders(): void {\n    this._composite.clearColliders();\n    const colliders: BoundingBox[] = [];\n    this._composite = this._collider.useCompositeCollider([]);\n    let current: BoundingBox;\n    // Bad square tesselation algo\n    for (let i = 0; i < this.width; i++) {\n      // Scan column for colliders\n      for (let j = 0; j < this.height; j++) {\n        // Columns start with a new collider\n        if (j === 0) {\n          current = null;\n        }\n        const tile = this.tiles[i + j * this.width];\n        // Current tile in column is solid build up current collider\n        if (tile.solid) {\n          // Use custom collider otherwise bounding box\n          if (tile.getColliders().length > 0) {\n            for (const collider of tile.getColliders()) {\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n              collider.offset = vec(tile.x * this.tileWidth, tile.y * this.tileHeight).add(originalOffset);\n              collider.owner = this;\n              this._composite.addCollider(collider);\n            }\n            current = null;\n          } else {\n            if (!current) {\n              current = tile.bounds;\n            } else {\n              current = current.combine(tile.bounds);\n            }\n          }\n        } else {\n          // Not solid skip and cut off the current collider\n          if (current) {\n            colliders.push(current);\n          }\n          current = null;\n        }\n      }\n      // After a column is complete check to see if it can be merged into the last one\n      if (current) {\n        // if previous is the same combine it\n        const prev = colliders[colliders.length - 1];\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\n          colliders[colliders.length - 1] = prev.combine(current);\n        } else {\n          // else new collider\n          colliders.push(current);\n        }\n      }\n    }\n\n    for (const c of colliders) {\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\n      collider.owner = this;\n      this._composite.addCollider(collider);\n    }\n    this._collider.update();\n  }\n\n  /**\n   * Returns the [[Tile]] by index (row major order)\n   */\n  public getTileByIndex(index: number): Tile {\n    return this.tiles[index];\n  }\n  /**\n   * Returns the [[Tile]] by its x and y integer coordinates\n   */\n  public getTile(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n  /**\n   * Returns the [[Tile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): Tile {\n    const x = Math.floor((point.x - this.pos.x) / this.tileWidth);\n    const y = Math.floor((point.y - this.pos.y) / this.tileHeight);\n    const tile = this.getTile(x, y);\n    if (x >= 0 && y >= 0 && x < this.width && y < this.height && tile) {\n      return tile;\n    }\n    return null;\n  }\n\n  public getRows(): readonly Tile[][] {\n    return this._rows;\n  }\n\n  public getColumns(): readonly Tile[][] {\n    return this._cols;\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.onPreUpdate(engine, delta);\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n    if (this._collidersDirty) {\n      this._collidersDirty = false;\n      this._updateColliders();\n    }\n\n    this._token++;\n    const worldBounds = engine.getWorldBounds();\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.tileWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.tileHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.tileWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.tileHeight) + 2, 0);\n    this._transform.pos = vec(this.x, this.y);\n\n    this.onPostUpdate(engine, delta);\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.width);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.height);\n\n    let graphics: readonly Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        graphics = this.getTile(x, y).getGraphics();\n\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\n          // draw sprite, warning if sprite doesn't exist\n          const graphic = graphics[graphicsIndex];\n          if (graphic) {\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\n              if (hasGraphicsTick(graphic)) {\n                graphic?.tick(delta, this._token);\n              }\n              graphic.draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            } else if (graphic instanceof Graphics.Sprite) {\n              // TODO legacy drawing mode\n              if (!this._legacySpriteMap.has(graphic)) {\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\n              }\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            }\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\n  }\n\n  public debug(gfx: ExcaliburGraphicsContext) {\n    const width = this.tileWidth * this.width;\n    const height = this.tileHeight * this.height;\n    const pos = Vector.Zero;\n    for (let r = 0; r < this.height + 1; r++) {\n      const yOffset = vec(0, r * this.tileHeight);\n      gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), Color.Red, 2);\n    }\n\n    for (let c = 0; c < this.width + 1; c++) {\n      const xOffset = vec(c * this.tileWidth, 0);\n      gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), Color.Red, 2);\n    }\n\n    const colliders = this._composite.getColliders();\n    for (const collider of colliders) {\n      const grayish = Color.Gray;\n      grayish.a = 0.5;\n      const bounds = collider.localBounds;\n      const pos = collider.worldPos.sub(this.pos);\n      gfx.drawRectangle(pos, bounds.width, bounds.height, grayish);\n    }\n  }\n}\n\nexport interface TileOptions {\n  /**\n   * Integer tile x coordinate\n   */\n  x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  y: number;\n  map: TileMap;\n  solid?: boolean;\n  graphics?: Graphics.Graphic[];\n}\n\n/**\n * TileMap Tile\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Tile extends Entity {\n  private _bounds: BoundingBox;\n  private _pos: Vector;\n  private _posDirty = false;\n  private _transform: TransformComponent;\n\n  /**\n   * Return the world position of the top left corner of the tile\n   */\n  public get pos() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._pos;\n  }\n\n  /**\n   * Integer x coordinate of the tile\n   */\n  public readonly x: number;\n\n  /**\n   * Integer y coordinate of the tile\n   */\n  public readonly y: number;\n\n  /**\n   * Width of the tile in pixels\n   */\n  public readonly width: number;\n\n  /**\n   * Height of the tile in pixels\n   */\n  public readonly height: number;\n\n  /**\n   * Reference to the TileMap this tile is associated with\n   */\n  public map: TileMap;\n\n  private _solid = false;\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public get solid(): boolean {\n    return this._solid;\n  }\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public set solid(val: boolean) {\n    this.map?.flagCollidersDirty();\n    this._solid = val;\n  }\n\n  private _graphics: Graphics.Graphic[] = [];\n\n  /**\n   * Current list of graphics for this tile\n   */\n  public getGraphics(): readonly Graphics.Graphic[] {\n    return this._graphics;\n  }\n\n  /**\n   * Add another [[Graphic]] to this TileMap tile\n   * @param graphic\n   */\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    if (graphic instanceof LegacySprite) {\n      this._graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\n    } else {\n      this._graphics.push(graphic);\n    }\n  }\n\n  /**\n   * Remove an instance of a [[Graphic]] from this tile\n   */\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    removeItemFromArray(graphic, this._graphics);\n  }\n\n  /**\n   * Clear all graphics from this tile\n   */\n  public clearGraphics() {\n    this._graphics.length = 0;\n  }\n\n  /**\n   * Current list of colliders for this tile\n   */\n  private _colliders: Collider[] = [];\n\n  /**\n   * Returns the list of colliders\n   */\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a custom collider to the [[Tile]] to use instead of it's bounds\n   *\n   * If no collider is set but [[Tile.solid]] is set, the tile bounds are used as a collider.\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the [[Tile]]\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the [[Tile]]\n   */\n  public clearColliders() {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Arbitrary data storage per tile, useful for any game specific data\n   */\n  public data = new Map<string, any>();\n\n  constructor(options: TileOptions) {\n    super();\n    this.x = options.x;\n    this.y = options.y;\n    this.map = options.map;\n    this.width = options.map.tileWidth;\n    this.height = options.map.tileHeight;\n    this.solid = options.solid ?? this.solid;\n    this._graphics = options.graphics ?? [];\n    this._recalculate();\n    this._transform = options.map.get(TransformComponent);\n    this._transform.posChanged$.subscribe(() => {\n      this._posDirty = true;\n    });\n  }\n\n  private _recalculate() {\n    this._pos = this.map.pos.add(\n      vec(\n        this.x * this.map.tileWidth,\n        this.y * this.map.tileHeight));\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this.width, this._pos.y + this.height);\n  }\n\n  public get bounds() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this._pos.x + this.width / 2, this._pos.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[Sprite]] to this tile\n   * @deprecated Use addSprite, will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\n    this.addGraphic(sprite);\n  }\n}","import { Actor } from '../Actor';\nimport { ScreenElement } from '../ScreenElement';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\n/**\n * Type guard to detect if something is an actor\n * @deprecated Will be removed in v0.26.0\n * @param actor\n */\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\n/**\n * Type guard to detect a screen element\n * @todo move to ScreenElement\n */\nexport function isScreenElement(actor: Actor) {\n  return actor instanceof ScreenElement;\n}\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = {\n      ...triggerDefaults,\n      ...opts\n    };\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher();\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\nimport { Message, Observer } from '../Util/Observable';\nimport { Component } from './Component';\nimport { Scene } from '../Scene';\n\n/**\n * Enum that determines whether to run the system in the update or draw phase\n */\nexport enum SystemType {\n  Update = 'update',\n  Draw = 'draw'\n}\n\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * An Excalibur [[System]] that updates entities of certain types.\n * Systems are scene specific\n *\n * Excalibur Systems currently require at least 1 Component type to operated\n *\n * Multiple types are declared as a type union\n * For example:\n *\n * ```typescript\n * class MySystem extends System<ComponentA | ComponentB> {\n *   public readonly types = ['a', 'b'] as const;\n *   public readonly systemType = SystemType.Update;\n *   public update(entities: Entity<ComponentA | ComponentB>) {\n *      ...\n *   }\n * }\n * ```\n */\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\nimplements Observer<AddedEntity | RemovedEntity> {\n  /**\n   * The types of entities that this system operates on\n   * For example ['transform', 'motion']\n   */\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\n\n  /**\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\n   */\n  abstract readonly systemType: SystemType;\n\n  /**\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\n   */\n  public priority: number = 0;\n\n  /**\n   * Optionally specify a sort order for entities passed to the your system\n   * @param a The left entity\n   * @param b The right entity\n   */\n  sort?(a: Entity, b: Entity): number;\n\n  /**\n   * Optionally specify an initialize handler\n   * @param scene\n   */\n  initialize?(engine: ContextType): void;\n\n  /**\n   * Update all entities that match this system's types\n   * @param entities Entities to update that match this system's types\n   * @param delta Time in milliseconds\n   */\n  abstract update(entities: Entity[], delta: number): void;\n\n  /**\n   * Optionally run a preupdate before the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  preupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Optionally run a postupdate after the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  postupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Systems observe when entities match their types or no longer match their types, override\n   * @param _entityAddedOrRemoved\n   */\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\n    // Override me\n  }\n}\n\n/**\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\n */\nexport class AddedEntity implements Message<Entity> {\n  readonly type: 'Entity Added' = 'Entity Added';\n  constructor(public data: Entity) {}\n}\n\n/**\n * Type guard to check for AddedEntity messages\n * @param x\n */\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\n  return !!x && x.type === 'Entity Added';\n}\n\n/**\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\n */\nexport class RemovedEntity implements Message<Entity> {\n  readonly type: 'Entity Removed' = 'Entity Removed';\n  constructor(public data: Entity) {}\n}\n\n/**\n * type guard to check for the RemovedEntity message\n */\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\n  return !!x && x.type === 'Entity Removed';\n}\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\nimport { Observer } from '../Util/Observable';\nimport { World } from './World';\nimport { Util } from '..';\n\n// Add/Remove entities and components\n\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\n  public entities: Entity[] = [];\n  public _entityIndex: { [entityId: string]: Entity } = {};\n\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Runs the entity lifecycle\n   * @param _context\n   */\n  public updateEntities(_context: ContextType, elapsed: number) {\n    for (const entity of this.entities) {\n      // TODO is this right?\n      entity.update((_context as any).engine, elapsed);\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  public findEntitiesForRemoval() {\n    for (const entity of this.entities) {\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * EntityManager observes changes on entities\n   * @param message\n   */\n  public notify(message: RemovedComponent | AddedComponent): void {\n    if (isAddedComponent(message)) {\n      // we don't need the component, it's already on the entity\n      this._world.queryManager.addEntity(message.data.entity);\n    }\n\n    if (isRemovedComponent(message)) {\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\n    }\n  }\n\n  /**\n   * Adds an entity to be tracked by the EntityManager\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    entity.active = true;\n    if (entity && !this._entityIndex[entity.id]) {\n      this._entityIndex[entity.id] = entity;\n      this.entities.push(entity);\n      this._world.queryManager.addEntity(entity);\n      entity.componentAdded$.register(this);\n      entity.componentRemoved$.register(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.addEntity(c));\n      entity.childrenAdded$.register({\n        notify: (e) => {\n          this.addEntity(e);\n        }\n      });\n      entity.childrenRemoved$.register({\n        notify: (e) => {\n          this.removeEntity(e, false);\n        }\n      });\n    }\n  }\n\n  public removeEntity(entity: Entity, deferred?: boolean): void;\n  public removeEntity(id: number, deferred?: boolean): void;\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\n    let id = 0;\n    if (idOrEntity instanceof Entity) {\n      id = idOrEntity.id;\n    } else {\n      id = idOrEntity;\n    }\n    const entity = this._entityIndex[id];\n    if (entity && entity.active) {\n      entity.kill();\n    }\n\n    if (entity && deferred) {\n      this._entitiesToRemove.push(entity);\n      return;\n    }\n\n    delete this._entityIndex[id];\n    if (entity) {\n      Util.removeItemFromArray(entity, this.entities);\n      this._world.queryManager.removeEntity(entity);\n      entity.componentAdded$.unregister(this);\n      entity.componentRemoved$.unregister(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\n      entity.childrenAdded$.clear();\n      entity.childrenRemoved$.clear();\n\n      // stats\n      if ((this._world.context as any)?.engine) {\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\n      }\n    }\n  }\n\n  private _entitiesToRemove: Entity[] = [];\n  public processEntityRemovals(): void {\n    for (const entity of this._entitiesToRemove) {\n      if (entity.active) {\n        continue;\n      }\n      this.removeEntity(entity, false);\n    }\n  }\n\n  public processComponentRemovals(): void {\n    for (const entity of this.entities) {\n      entity.processComponentRemoval();\n    }\n  }\n\n  public getById(id: number): Entity {\n    return this._entityIndex[id];\n  }\n\n  public getByName(name: string): Entity[]{\n    return this.entities.filter(e => e.name === name);\n  }\n\n  public clear(): void {\n    for (const entity of this.entities) {\n      this.removeEntity(entity);\n    }\n  }\n}\n","export const buildTypeKey = (types: readonly string[]) => {\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\n  return key;\n};\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Observable } from '../Util/Observable';\nimport { Util, Component, ComponentCtor } from '..';\nimport { AddedEntity, RemovedEntity } from './System';\n\n/**\n * Represents query for entities that match a list of types that is cached and observable\n *\n * Queries can be strongly typed by supplying a type union in the optional type parameter\n * ```typescript\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\n * ```\n */\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\n  public types: readonly string[];\n  private _entities: Entity[] = [];\n  private _key: string;\n  public get key(): string {\n    if (this._key) {\n      return this._key;\n    }\n    return (this._key = buildTypeKey(this.types));\n  }\n\n  constructor(types: readonly string[]);\n  constructor(types: readonly ComponentCtor<T>[]);\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\n    super();\n    if (types[0] instanceof Function) {\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\n    } else {\n      this.types = types as string[];\n    }\n  }\n\n  /**\n   * Returns a list of entities that match the query\n   *\n   * @param sort Optional sorting function to sort entities returned from the query\n   */\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\n    if (sort) {\n      this._entities.sort(sort);\n    }\n    return this._entities;\n  }\n\n  /**\n   * Add an entity to the query, will only be added if the entity matches the query types\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\n      this._entities.push(entity);\n      this.notifyAll(new AddedEntity(entity));\n    }\n  }\n\n  /**\n   * If the entity is part of the query it will be removed regardless of types\n   * @param entity\n   */\n  public removeEntity(entity: Entity): void {\n    if (Util.removeItemFromArray(entity, this._entities)) {\n      this.notifyAll(new RemovedEntity(entity));\n    }\n  }\n\n  /**\n   * Removes all entities and observers from the query\n   */\n  public clear(): void {\n    this._entities.length = 0;\n    for (const observer of this.observers) {\n      this.unregister(observer);\n    }\n  }\n\n  /**\n   * Returns whether the entity's types match query\n   * @param entity\n   */\n  public matches(entity: Entity): boolean;\n\n  /**\n   * Returns whether the list of ComponentTypes have at least the same types as the query\n   * @param types\n   */\n  public matches(types: string[]): boolean;\n  public matches(typesOrEntity: string[] | Entity): boolean {\n    let types: string[] = [];\n    if (typesOrEntity instanceof Entity) {\n      types = typesOrEntity.types;\n    } else {\n      types = typesOrEntity;\n    }\n\n    let matches = true;\n    for (const type of this.types) {\n      matches = matches && types.indexOf(type) > -1;\n      if (!matches) {\n        return false;\n      }\n    }\n    return matches;\n  }\n\n  public contain(type: string) {\n    return this.types.indexOf(type) > -1;\n  }\n}\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Query } from './Query';\nimport { Component } from './Component';\nimport { World } from './World';\n\n/**\n * The query manager is responsible for updating all queries when entities/components change\n */\nexport class QueryManager {\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\n\n  constructor(private _world: World<any>) {}\n\n  /**\n   * Adds a query to the manager and populates with any entities that match\n   * @param query\n   */\n  private _addQuery(query: Query<any>) {\n    this._queries[buildTypeKey(query.types)] = query;\n    for (const entity of this._world.entityManager.entities) {\n      query.addEntity(entity);\n    }\n  }\n\n  /**\n   * Removes the query if there are no observers left\n   * @param query\n   */\n  public maybeRemoveQuery(query: Query): void {\n    if (query.observers.length === 0) {\n      query.clear();\n      delete this._queries[buildTypeKey(query.types)];\n    }\n  }\n\n  /**\n   * Adds the entity to any matching query in the query manage\n   * @param entity\n   */\n  public addEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      if (this._queries[queryType]) {\n        this._queries[queryType].addEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from queries if the removed component disqualifies it\n   * @param entity\n   * @param component\n   */\n  public removeComponent(entity: Entity, component: Component) {\n    for (const queryType in this._queries) {\n      // If the component being removed from an entity is a part of a query,\n      // it is now disqualified from that query, remove it\n      if (this._queries[queryType].contain(component.type)) {\n        this._queries[queryType].removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from all queries it is currently a part of\n   * @param entity\n   */\n  public removeEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      this._queries[queryType].removeEntity(entity);\n    }\n  }\n\n  /**\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\n   * @param types\n   */\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const maybeExistingQuery = this.getQuery<T>(types);\n    if (maybeExistingQuery) {\n      return maybeExistingQuery;\n    }\n    const query = new Query<T>(types);\n    this._addQuery(query);\n    return query;\n  }\n\n  /**\n   * Retrieves an existing query by types if it exists otherwise returns null\n   * @param types\n   */\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const key = buildTypeKey(types);\n    if (this._queries[key]) {\n      return this._queries[key] as Query<T>;\n    }\n    return null;\n  }\n}\n","import { System, SystemType } from './System';\nimport { Scene, Util } from '..';\nimport { World } from './World';\n\nexport interface SystemCtor<T extends System> {\n  new (): T;\n}\n\n/**\n * The SystemManager is responsible for keeping track of all systems in a scene.\n * Systems are scene specific\n */\nexport class SystemManager<ContextType> {\n  /**\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\n   */\n  public systems: System<any, ContextType>[] = [];\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\n  public initialized = false;\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Get a system registered in the manager by type\n   * @param systemType\n   */\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\n  }\n\n  /**\n   * Adds a system to the manager, it will now be updated every frame\n   * @param system\n   */\n  public addSystem(system: System<any, ContextType>): void {\n    // validate system has types\n    if (!system.types || system.types.length === 0) {\n      throw new Error(`Attempted to add a System without any types`);\n    }\n\n    const query = this._world.queryManager.createQuery(system.types);\n    this.systems.push(system);\n    this.systems.sort((a, b) => a.priority - b.priority);\n    query.register(system);\n    if (this.initialized && system.initialize) {\n      system.initialize(this._world.context);\n    }\n  }\n\n  /**\n   * Removes a system from the manager, it will no longer be updated\n   * @param system\n   */\n  public removeSystem(system: System<any, ContextType>) {\n    Util.removeItemFromArray(system, this.systems);\n    const query = this._world.queryManager.getQuery(system.types);\n    if (query) {\n      query.unregister(system);\n      this._world.queryManager.maybeRemoveQuery(query);\n    }\n  }\n\n  /**\n   * Initialize all systems in the manager\n   *\n   * Systems added after initialize() will be initialized on add\n   */\n  public initialize() {\n    if (!this.initialized) {\n      this.initialized = true;\n      for (const s of this.systems) {\n        if (s.initialize) {\n          s.initialize(this._world.context);\n        }\n      }\n    }\n  }\n\n  /**\n   * Updates all systems\n   * @param type whether this is an update or draw system\n   * @param context context reference\n   * @param delta time in milliseconds\n   */\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\n    const systems = this.systems.filter((s) => s.systemType === type);\n    for (const s of systems) {\n      if (s.preupdate) {\n        s.preupdate(context, delta);\n      }\n    }\n\n    for (const s of systems) {\n      // Get entities that match the system types, pre-sort\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\n      // Initialize entities if needed\n      if (context instanceof Scene) {\n        for (const entity of entities) {\n          entity._initialize(context?.engine);\n        }\n      }\n      s.update(entities, delta);\n    }\n\n    for (const s of systems) {\n      if (s.postupdate) {\n        s.postupdate(context, delta);\n      }\n    }\n  }\n\n  public clear(): void {\n    for (const system of this.systems) {\n      this.removeSystem(system);\n    }\n  }\n}\n","import { Entity } from './Entity';\nimport { EntityManager } from './EntityManager';\nimport { QueryManager } from './QueryManager';\nimport { System, SystemType } from './System';\nimport { SystemManager } from './SystemManager';\n\n/**\n * The World is a self-contained entity component system for a particular context.\n */\nexport class World<ContextType> {\n  public queryManager: QueryManager = new QueryManager(this);\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\n\n  /**\n   * The context type is passed to the system updates\n   * @param context\n   */\n  constructor(public context: ContextType) {}\n\n  /**\n   * Update systems by type and time elapsed in milliseconds\n   */\n  update(type: SystemType, delta: number) {\n    if (type === SystemType.Update) {\n      this.entityManager.updateEntities(this.context, delta);\n    }\n    this.systemManager.updateSystems(type, this.context, delta);\n    this.entityManager.findEntitiesForRemoval();\n    this.entityManager.processComponentRemovals();\n    this.entityManager.processEntityRemovals();\n  }\n\n  /**\n   * Add an entity to the ECS world\n   * @param entity\n   */\n  add(entity: Entity): void;\n  /**\n   * Add a system to the ECS world\n   * @param system\n   */\n  add(system: System<any, ContextType>): void;\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.addEntity(entityOrSystem);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.addSystem(entityOrSystem);\n    }\n  }\n\n  /**\n   * Remove an entity from the ECS world\n   * @param entity\n   */\n  remove(entity: Entity, deferred?: boolean): void;\n  /**\n   * Remove a system from the ECS world\n   * @param system\n   */\n  remove(system: System<any, ContextType>): void;\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.removeEntity(entityOrSystem, deferred);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.removeSystem(entityOrSystem);\n    }\n  }\n\n  clearEntities(): void {\n    this.entityManager.clear();\n  }\n\n  clearSystems(): void {\n    this.systemManager.clear();\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { Physics } from './Physics';\nimport { BodyComponent } from './BodyComponent';\nimport { CollisionType } from './CollisionType';\nimport { EulerIntegrator } from './Integrator';\n\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    let transform: TransformComponent;\n    let motion: MotionComponent;\n    for (const entity of _entities) {\n      transform = entity.get(TransformComponent);\n      motion = entity.get(MotionComponent);\n\n      const optionalBody = entity.get(BodyComponent);\n      if (optionalBody?.sleeping) {\n        continue;\n      }\n\n      const totalAcc = motion.acc.clone();\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\n        totalAcc.addEqual(Physics.gravity);\n      }\n      optionalBody?.captureOldTransform();\n\n      // Update transform and motion based on Euler linear algebra\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","import { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * A collision solver figures out how to position colliders such that they are no longer overlapping\n *\n * Solvers are executed in the order\n *\n * 1. preSolve\n * 2. solveVelocity\n * 3. solvePosition\n * 4. postSolve\n * @inheritdoc\n */\nexport abstract class CollisionSolver {\n  /**\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract preSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Post-solve is fired after all resolution is complete\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract postSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solveVelocity(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve position adjust the position of colliders so that they are not overlapping\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solvePosition(contacts: CollisionContact[]): void;\n\n  /**\n   * Solves overlapping contact in\n   *\n   * Solvers are executed in the order\n   * 1. preSolve\n   * 2. solveVelocity\n   * 3. solvePosition\n   * 4. postSolve\n   * @param contacts\n   */\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\n    // Events and init\n    this.preSolve(contacts);\n\n    // Remove any canceled contacts\n    contacts = contacts.filter(c => !c.isCanceled());\n\n    // Solve velocity first\n    this.solveVelocity(contacts);\n\n    // Solve position last because non-overlap is the most important\n    this.solvePosition(contacts);\n\n    // Events and any contact house-keeping the solver needs\n    this.postSolve(contacts);\n\n    return contacts;\n  }\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { Side } from '../Side';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\n * and negates velocity along the collision normal.\n *\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\n *\n */\nexport class ArcadeSolver extends CollisionSolver {\n  public preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n      }\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public solvePosition(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // if bounds no longer interesect skip to the next\n      // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\n      if (!contact.colliderA.bounds.intersect(contact.colliderB.bounds)) {\n        continue;\n      }\n      let mtv = contact.mtv;\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\n          // split overlaps if both are Active\n          mtv = mtv.scale(0.5);\n        }\n\n        // Resolve overlaps\n        if (bodyA.collisionType === CollisionType.Active) {\n          bodyA.pos.x -= mtv.x;\n          bodyA.pos.y -= mtv.y;\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          bodyB.pos.x += mtv.x;\n          bodyB.pos.y += mtv.y;\n        }\n      }\n    }\n  }\n\n  public solveVelocity(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        const normal = contact.normal;\n        const opposite = normal.negate();\n\n        // Cancel out velocity opposite direction of collision normal\n        if (bodyA.collisionType === CollisionType.Active) {\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\n          bodyA.vel = bodyA.vel.add(velAdj);\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\n          bodyB.vel = bodyB.vel.add(velAdj);\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity between bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { clamp } from '../../Math/util';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\nimport { Side } from '../Side';\nimport { Physics } from '../Physics';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\n\nexport class RealisticSolver extends CollisionSolver {\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\n\n  // map contact id to contact points\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\n\n  getContactConstraints(id: string) {\n    return this.idToContactConstraint.get(id) ?? [];\n  }\n\n  preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n\n      // Match awake state for sleeping\n      contact.matchAwake();\n    }\n\n    // Keep track of contacts that done\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\n    for (const contact of contacts) {\n      // Remove all current contacts that are not done\n      const index = finishedContactIds.indexOf(contact.id);\n      if (index > -1) {\n        finishedContactIds.splice(index, 1);\n      }\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n\n      let pointIndex = 0;\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n      if (bodyA && bodyB) {\n        for (const point of contact.points) {\n          const normal = contact.normal;\n          const tangent = contact.tangent;\n\n          const aToContact = point.sub(bodyA.pos);\n          const bToContact = point.sub(bodyB.pos);\n\n          const aToContactNormal = aToContact.cross(normal);\n          const bToContactNormal = bToContact.cross(normal);\n\n          const normalMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n          const aToContactTangent = aToContact.cross(tangent);\n          const bToContactTangent = bToContact.cross(tangent);\n\n          const tangentMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\n            contactPoints[pointIndex].point = point;\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\n          } else {\n            // new contact if it's not close or doesn't exist\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\n          }\n\n          // Update contact point calculations\n          contactPoints[pointIndex].aToContact = aToContact;\n          contactPoints[pointIndex].bToContact = bToContact;\n          contactPoints[pointIndex].normalMass = normalMass;\n          contactPoints[pointIndex].tangentMass = tangentMass;\n\n          pointIndex++;\n        }\n      }\n      this.idToContactConstraint.set(contact.id, contactPoints);\n    }\n\n    // Clean up any contacts that did not occur last frame\n    for (const id of finishedContactIds) {\n      this.idToContactConstraint.delete(id);\n    }\n\n    // Warm contacts with accumulated impulse\n    // Useful for tall stacks\n    if (Physics.warmStart) {\n      this.warmStart(contacts);\n    } else {\n      for (const contact of contacts) {\n        const contactPoints = this.getContactConstraints(contact.id);\n        for (const point of contactPoints) {\n          point.normalImpulse = 0;\n          point.tangentImpulse = 0;\n        }\n      }\n    }\n  }\n\n  postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n        // Skip post solve for active+passive collisions\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        // Update motion values for sleeping\n        bodyA.updateMotion();\n        bodyB.updateMotion();\n      }\n\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n    }\n\n    // Store contacts\n    this.lastFrameContacts.clear();\n    for (const c of contacts) {\n      this.lastFrameContacts.set(c.id, c);\n    }\n  }\n\n  /**\n   * Warm up body's based on previous frame contact points\n   * @param contacts\n   */\n  warmStart(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n        for (const point of contactPoints) {\n          if (Physics.warmStart) {\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\n            const impulse = normalImpulse.add(tangentImpulse);\n\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          } else {\n            point.normalImpulse = 0;\n            point.tangentImpulse = 0;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Iteratively solve the position overlap constraint\n   * @param contacts\n   */\n  solvePosition(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.positionIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n          for (const point of constraints) {\n            const normal = contact.normal;\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\n\n            const steeringConstant = Physics.steeringFactor; //0.2;\n            const maxCorrection = -5;\n            const slop = Physics.slop; //1;\n\n            // Clamp to avoid over-correction\n            // Remember that we are shooting for 0 overlap in the end\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\n            const impulse = normal.scale(-steeringForce / point.normalMass);\n\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\n            // We adjust position and rotation instead of doing the velocity\n            if (bodyA.collisionType === CollisionType.Active) {\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\n            }\n\n            if (bodyB.collisionType === CollisionType.Active) {\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  solveVelocity(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.velocityIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const restitution = bodyA.bounciness * bodyB.bounciness;\n          const friction = Math.min(bodyA.friction, bodyB.friction);\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n\n          for (const point of constraints) {\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Negate velocity in tangent direction to simulate friction\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\n            let impulseDelta = tangentVelocity / point.tangentMass;\n\n            // Clamping based in Erin Catto's GDC 2006 talk\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\n            // But deltas can vary\n            const maxFriction = friction * point.normalImpulse;\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\n            impulseDelta = newImpulse - point.tangentImpulse;\n            point.tangentImpulse = newImpulse;\n\n            const impulse = contact.tangent.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n\n          for (const point of constraints) {\n            // Need to recalc relative velocity because the previous step could have changed vel\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Compute impulse in normal direction\n            const normalVelocity = relativeVelocity.dot(contact.normal);\n            // See https://en.wikipedia.org/wiki/Collision_response\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\n\n            // Clamping based in Erin Catto's GDC 2014 talk\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\n            // But deltas can be negative\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\n            impulseDelta = newImpulse - point.normalImpulse;\n            point.normalImpulse = newImpulse;\n\n            const impulse = contact.normal.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n        }\n      }\n    }\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\nimport { CollisionResolutionStrategy, Physics } from './Physics';\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\nimport { Collider } from './Colliders/Collider';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\nimport { RealisticSolver } from './Solver/RealisticSolver';\nimport { CollisionSolver } from './Solver/Solver';\nimport { ColliderComponent } from './ColliderComponent';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\n\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _realisticSolver = new RealisticSolver();\n  private _arcadeSolver = new ArcadeSolver();\n  private _processor = new DynamicTreeCollisionProcessor();\n  private _lastFrameContacts = new Map<string, CollisionContact>();\n  private _currentFrameContacts = new Map<string, CollisionContact>();\n\n  private _trackCollider = (c: Collider) => this._processor.track(c);\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\n\n  notify(message: AddedEntity | RemovedEntity) {\n    if (isAddedSystemEntity(message)) {\n      const colliderComponent = message.data.get(ColliderComponent);\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\n      const collider = colliderComponent.get();\n      if (collider) {\n        this._processor.track(collider);\n      }\n    } else {\n      const colliderComponent = message.data.get(ColliderComponent);\n      const collider = colliderComponent.get();\n      if (colliderComponent && collider) {\n        this._processor.untrack(collider);\n      }\n    }\n  }\n\n  initialize(scene: Scene) {\n    this._engine = scene.engine;\n  }\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    if (!Physics.enabled) {\n      return;\n    }\n\n    // Collect up all the colliders\n    let colliders: Collider[] = [];\n    for (const entity of _entities) {\n      const colliderComp = entity.get(ColliderComponent);\n      const collider = colliderComp?.get();\n      if (colliderComp && colliderComp.owner?.active && collider) {\n        colliderComp.update();\n        if (collider instanceof CompositeCollider) {\n          colliders = colliders.concat(collider.getColliders());\n        } else {\n          colliders.push(collider);\n        }\n      }\n    }\n\n    // Update the spatial partitioning data structures\n    // TODO if collider invalid it will break the processor\n    // TODO rename \"update\" to something more specific\n    this._processor.update(colliders);\n\n    // Run broadphase on all colliders and locates potential collisions\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\n\n    this._currentFrameContacts.clear();\n\n    // Given possible pairs find actual contacts\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\n\n    const solver: CollisionSolver = this.getSolver();\n\n    // Solve, this resolves the position/velocity so entities aren't overlapping\n    contacts = solver.solve(contacts);\n\n    // Record contacts\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\n\n    // Emit contact start/end events\n    this.runContactStartEnd();\n\n    // reset the last frame cache\n    this._lastFrameContacts.clear();\n\n    // Keep track of collisions contacts that have started or ended\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\n  }\n\n  getSolver(): CollisionSolver {\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\n  }\n\n  debug(ex: ExcaliburGraphicsContext) {\n    this._processor.debug(ex);\n  }\n\n  public runContactStartEnd() {\n    for (const [id, c] of this._currentFrameContacts) {\n      // find all new contacts\n      if (!this._lastFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\n      }\n    }\n\n    // find all contacts taht have ceased\n    for (const [id, c] of this._lastFrameContacts) {\n      if (!this._currentFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\n      }\n    }\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { SpriteSheet } from './SpriteSheet';\nimport { Logger } from '../Util/Log';\nimport { Engine, LegacyDrawing } from '..';\nimport { Sprite } from '.';\nimport { clamp } from '../Math/util';\n\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\nexport enum AnimationDirection {\n  /**\n   * Animation is playing forwards\n   */\n  Forward = 'forward',\n  /**\n   * Animation is play backwards\n   */\n  Backward = 'backward'\n}\n\nexport enum AnimationStrategy {\n  /**\n   * Animation ends without displaying anything\n   */\n  End = 'end',\n  /**\n   * Animation loops to the first frame after the last frame\n   */\n  Loop = 'loop',\n  /**\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\n   */\n  PingPong = 'pingpong',\n  /**\n   * Animation ends stopping on the last frame\n   */\n  Freeze = 'freeze'\n}\n\n/**\n * Frame of animation\n */\nexport interface Frame {\n  /**\n   * Optionally specify a graphic to show, no graphic shows an empty frame\n   */\n  graphic?: Graphic;\n  /**\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\n   */\n  duration?: number;\n}\n\n/**\n * Animation options for building an animation via constructor.\n */\nexport interface AnimationOptions {\n  /**\n   * List of frames in the order you wish to play them\n   */\n  frames: Frame[];\n  /**\n   * Optionally reverse the direction of play\n   */\n  reverse?: boolean;\n  /**\n   * Optionally specify a default frame duration in ms (Default is 1000)\n   */\n  frameDuration?: number;\n  /**\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\n   */\n  totalDuration?: number;\n  /**\n   * Optionally specify the [[AnimationStrategy]] for the Animation\n   */\n  strategy?: AnimationStrategy;\n}\n\n// TODO wire up to new Emitter\nexport type AnimationEvents = {\n  frame: Frame;\n  loop: Animation;\n  ended: Animation;\n};\n\n/**\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\n *\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\n */\nexport class Animation extends Graphic implements HasTick {\n  private static _LOGGER = Logger.getInstance();\n  public events = new EventDispatcher<any>(); // TODO replace with new Emitter\n  public frames: Frame[] = [];\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\n  public frameDuration: number = 100;\n  public timeScale: number = 1;\n\n  private _idempotencyToken = -1;\n\n  private _firstTick = true;\n  private _currentFrame = 0;\n  private _timeLeftInFrame = 0;\n  private _direction = 1; // TODO only used in ping-pong\n  private _done = false;\n  private _playing = true;\n\n  constructor(options: GraphicOptions & AnimationOptions) {\n    super(options);\n    this.frames = options.frames;\n    this.strategy = options.strategy ?? this.strategy;\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\n    if (options.reverse) {\n      this.reverse();\n    }\n    this.goToFrame(0);\n  }\n\n  public clone(): Animation {\n    return new Animation({\n      frames: this.frames.map((f) => ({ ...f })),\n      frameDuration: this.frameDuration,\n      reverse: this._reversed,\n      strategy: this.strategy,\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  public override get width(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\n    }\n    return 0;\n  }\n\n  public override get height(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\n    }\n    return 0;\n  }\n\n\n  /**\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\n   * and optional [[AnimationStrategy]]\n   *\n   * Example:\n   * ```typescript\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\n   *\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\n   * ```\n   *\n   * @param spriteSheet\n   * @param frameIndices\n   * @param durationPerFrameMs\n   * @param strategy\n   */\n  public static fromSpriteSheet(\n    spriteSheet: SpriteSheet,\n    frameIndices: number[],\n    durationPerFrameMs: number,\n    strategy: AnimationStrategy = AnimationStrategy.Loop\n  ): Animation {\n    const maxIndex = spriteSheet.sprites.length - 1;\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\n    if (invalidIndices.length) {\n      Animation._LOGGER.warn(\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\n      );\n    }\n    return new Animation({\n      frames: spriteSheet.sprites\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\n        .map((f) => ({\n          graphic: f,\n          duration: durationPerFrameMs\n        })),\n      strategy: strategy\n    });\n  }\n\n  /**\n   * Converts an animation to a legacy animation\n   * @deprecated\n   * @param engine\n   * @param animation\n   * @returns LegacyDrawing.Animation\n   */\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\n    return new LegacyDrawing.Animation({\n      sprites: legacySprites,\n      loop: animation.strategy === AnimationStrategy.Loop,\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\n      speed: animation.frameDuration,\n      engine: engine\n    });\n  }\n\n  /**\n   * Returns the current Frame of the animation\n   */\n  public get currentFrame(): Frame | null {\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\n      return this.frames[this._currentFrame];\n    }\n    return null;\n  }\n\n  /**\n   * Returns the current frame index of the animation\n   */\n  public get currentFrameIndex(): number {\n    return this._currentFrame;\n  }\n\n  /**\n   * Returns `true` if the animation is playing\n   */\n  public get isPlaying(): boolean {\n    return this._playing;\n  }\n\n  private _reversed = false;\n  /**\n   * Reverses the play direction of the Animation, this preserves the current frame\n   */\n  public reverse(): void {\n    // Don't mutate with the original frame list, create a copy\n    this.frames = this.frames.slice().reverse();\n    this._reversed = !this._reversed;\n  }\n\n  /**\n   * Returns the current play direction of the animation\n   */\n  public get direction(): AnimationDirection {\n    // Keep logically consistent with ping-pong direction\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\n  }\n\n  /**\n   * Plays or resumes the animation from the current frame\n   */\n  public play(): void {\n    this._playing = true;\n  }\n\n  /**\n   * Pauses the animation on the current frame\n   */\n  public pause(): void {\n    this._playing = false;\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\n  }\n\n  /**\n   * Reset the animation back to the beginning, including if the animation were done\n   */\n  public reset(): void {\n    this._done = false;\n    this._firstTick = true;\n    this._currentFrame = 0;\n  }\n\n  /**\n   * Returns `true` if the animation can end\n   */\n  public get canFinish(): boolean {\n    switch (this.strategy) {\n      case AnimationStrategy.End:\n      case AnimationStrategy.Freeze: {\n        return true;\n      }\n      default: {\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Returns `true` if the animation is done, for looping type animations\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\n   *\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\n   */\n  public get done(): boolean {\n    return this._done;\n  }\n\n  /**\n   * Jump the animation immediately to a specific frame if it exists\n   * @param frameNumber\n   */\n  public goToFrame(frameNumber: number) {\n    this._currentFrame = frameNumber;\n    this._timeLeftInFrame = this.frameDuration;\n    const maybeFrame = this.frames[this._currentFrame];\n    if (maybeFrame && !this._done) {\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\n      this.events.emit('frame', maybeFrame as any);\n    }\n  }\n\n  private _nextFrame(): number {\n    const currentFrame = this._currentFrame;\n    if (this._done) {\n      return currentFrame;\n    }\n    let next = -1;\n\n    switch (this.strategy) {\n      case AnimationStrategy.Loop: {\n        next = (currentFrame + 1) % this.frames.length;\n        if (next === 0) {\n          this.events.emit('loop', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.End: {\n        next = currentFrame + 1;\n        if (next >= this.frames.length) {\n          this._done = true;\n          this._currentFrame = this.frames.length;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.Freeze: {\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\n        if (next >= this.frames.length - 1) {\n          this._done = true;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.PingPong: {\n        if (currentFrame + this._direction >= this.frames.length) {\n          this._direction = -1;\n          this.events.emit('loop', this as any);\n        }\n\n        if (currentFrame + this._direction < 0) {\n          this._direction = 1;\n          this.events.emit('loop', this as any);\n        }\n\n        next = currentFrame + (this._direction % this.frames.length);\n        break;\n      }\n    }\n    return next;\n  }\n\n  /**\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\n   * @param elapsedMilliseconds Milliseconds elapsed\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\n   */\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    if (!this._playing) {\n      return;\n    }\n\n    // if it's the first frame emit frame event\n    if (this._firstTick) {\n      this._firstTick = false;\n      this.events.emit('frame', this.currentFrame as any);\n    }\n\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\n    if (this._timeLeftInFrame <= 0) {\n      this.goToFrame(this._nextFrame());\n    }\n  }\n\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.currentFrame) {\n      this.currentFrame.graphic.draw(ctx, x, y);\n    }\n  }\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Color } from './Color';\nimport { Vector, vec } from './Math/vector';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/Index';\nimport { Sprite } from './Graphics/Sprite';\nimport { BoundingBox, LegacyDrawing } from '.';\nimport { clamp, randomInRange } from './Math/util';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl extends Entity {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: LegacyDrawing.Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  public visible = true;\n  public isOffscreen = false;\n\n  public transform: TransformComponent;\n  public graphics: GraphicsComponent;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super();\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = (position || this.position).add(this.emitter.pos);\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n\n    this.addComponent((this.transform = new TransformComponent()));\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\n    this.addComponent((this.graphics = new GraphicsComponent()));\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // TODO wut\n    if (this.particleSprite) {\n      this.graphics.opacity = this.opacity;\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\n    } else {\n      this.graphics.localBounds = BoundingBox.fromDimension(this.particleSize, this.particleSize, Vector.Half);\n      this.graphics.onPostDraw = (ctx) => {\n        ctx.save();\n        this.graphics.opacity = this.opacity;\n        const tmpColor = this._currentColor.clone();\n        tmpColor.a = 1;\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\n        ctx.restore();\n      };\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // todo wut\n    this.graphics.opacity = this.opacity;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.opacity(this.opacity);\n      this.particleSprite.draw(ctx, 0, 0);\n      return;\n    }\n\n    ctx.save();\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n    ctx.restore();\n  }\n}\n\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: LegacyDrawing.Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\nexport interface ParticleEmitterArgs {\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: LegacyDrawing.Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n */\nexport class ParticleEmitter extends Actor {\n  private _particlesToEmit: number = 0;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Particle[] = [];\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Particle[] = [];\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public get opacity(): number {\n    return super.graphics.opacity;\n  }\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public set opacity(opacity: number) {\n    super.graphics.opacity = opacity;\n  }\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = null;\n  /**\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /**\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  private _og: LegacyDrawing.Sprite = null;\n  private _sprite: Sprite = null;\n  /**\n   * Gets or sets the sprite that a particle should use\n   */\n  public get particleSprite(): LegacyDrawing.Sprite {\n    return this._og;\n  }\n\n  public set particleSprite(val: LegacyDrawing.Sprite) {\n    this._og = val;\n    if (val) {\n      this._sprite = Sprite.fromLegacySprite(val);\n    }\n  }\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param config particle emitter options bag\n   */\n  constructor(config: ParticleEmitterArgs) {\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\n\n    const {\n      x,\n      y,\n      pos,\n      isEmitting,\n      minVel,\n      maxVel,\n      acceleration,\n      minAngle,\n      maxAngle,\n      emitRate,\n      particleLife,\n      opacity,\n      fadeFlag,\n      focus,\n      focusAccel,\n      startSize,\n      endSize,\n      minSize,\n      maxSize,\n      beginColor,\n      endColor,\n      particleSprite,\n      emitterType,\n      radius,\n      particleRotationalVelocity,\n      randomRotation,\n      random\n    } = { ...config };\n\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.isEmitting = isEmitting ?? this.isEmitting;\n    this.minVel = minVel ?? this.minVel;\n    this.maxVel = maxVel ?? this.maxVel;\n    this.acceleration = acceleration ?? this.acceleration;\n    this.minAngle = minAngle ?? this.minAngle;\n    this.maxAngle = maxAngle ?? this.maxAngle;\n    this.emitRate = emitRate ?? this.emitRate;\n    this.particleLife = particleLife ?? this.particleLife;\n    this.opacity = opacity ?? this.opacity;\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\n    this.focus = focus ?? this.focus;\n    this.focusAccel = focusAccel ?? this.focusAccel;\n    this.startSize = startSize ?? this.startSize;\n    this.endSize = endSize ?? this.endSize;\n    this.minSize = minSize ?? this.minSize;\n    this.maxSize = maxSize ?? this.maxSize;\n    this.beginColor = beginColor ?? this.beginColor;\n    this.endColor = endColor ?? this.endColor;\n    this.particleSprite = particleSprite ?? this.particleSprite;\n    this.emitterType = emitterType ?? this.emitterType;\n    this.radius = radius ?? this.radius;\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\n    this.randomRotation = randomRotation ?? this.randomRotation;\n\n    this.body.collisionType = CollisionType.PreventCollision;\n\n    this.random = random ?? new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      const p = this._createParticle();\n      this.particles.push(p);\n      if (this?.scene?.world) {\n        this.scene.world.add(p);\n      }\n    }\n  }\n\n  public clearParticles() {\n    this.particles.length = 0;\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = randomInRange(0, this.width, this.random);\n      ranY = randomInRange(0, this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle);\n      ranY = radius * Math.sin(angle);\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n      p.graphics.opacity = this.opacity;\n      p.graphics.use(this._sprite);\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    // deferred removal\n    for (let i = 0; i < this.deadParticles.length; i++) {\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\n      if (this?.scene?.world) {\n        this.scene.world.remove(this.deadParticles[i], false);\n      }\n    }\n    this.deadParticles.length = 0;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Scene } from '../Scene';\nimport { GraphicsComponent } from './GraphicsComponent';\nimport { vec } from '../Math/vector';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Camera } from '../Camera';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem';\nimport { Engine } from '../Engine';\nimport { GraphicsGroup } from '.';\nimport { Particle } from '../Particles';\n\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 0;\n  private _token = 0;\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  private _sortedTransforms: TransformComponent[] = [];\n  public get sortedTransforms() {\n    return this._sortedTransforms;\n  }\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n  }\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return a.z - b.z;\n      });\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n      }\n    }\n  }\n\n  public update(_entities: Entity[], delta: number): void {\n    this._token++;\n    let graphics: GraphicsComponent;\n\n    // This is a performance enhancement, most things are in world space\n    // so if we can only do this once saves a ton of transform updates\n    this._graphicsContext.save();\n    if (this._camera) {\n      this._camera.draw(this._graphicsContext);\n    }\n    for (const transform of this._sortedTransforms) {\n      const entity = transform.owner as Entity;\n\n      // If the entity is offscreen skip\n      if (entity.hasTag('ex.offscreen')) {\n        continue;\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      // Exit if graphics set to not visible\n      if (!graphics.visible) {\n        continue;\n      }\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.restore();\n      }\n\n      this._graphicsContext.save();\n\n      // Tick any graphics state (but only once) for animations and graphics groups\n      graphics.update(delta, this._token);\n\n      // Position the entity\n      this._applyTransform(entity);\n\n      // Optionally run the onPreDraw graphics lifecycle draw\n      if (graphics.onPreDraw) {\n        graphics.onPreDraw(this._graphicsContext, delta);\n      }\n\n      // TODO remove this hack on the particle redo\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\n\n      // Draw the graphics component\n      this._drawGraphicsComponent(graphics);\n\n      // Optionally run the onPostDraw graphics lifecycle draw\n      if (graphics.onPostDraw) {\n        graphics.onPostDraw(this._graphicsContext, delta);\n      }\n\n      this._graphicsContext.restore();\n\n      // Reset the transform back to the original world space\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.save();\n        if (this._camera) {\n          this._camera.draw(this._graphicsContext);\n        }\n      }\n    }\n    this._graphicsContext.restore();\n  }\n\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\n    if (graphicsComponent.visible) {\n      // this should be moved to the graphics system\n      for (const layer of graphicsComponent.layers.get()) {\n        for (const { graphic, options } of layer.graphics) {\n          let anchor = graphicsComponent.anchor;\n          let offset = graphicsComponent.offset;\n          if (options?.anchor) {\n            anchor = options.anchor;\n          }\n          if (options?.offset) {\n            offset = options.offset;\n          }\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n          const offsetX = -graphic.width * anchor.x + offset.x;\n          const offsetY = -graphic.height * anchor.y + offset.y;\n\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\n\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\n            if (graphic instanceof GraphicsGroup) {\n              for (const g of graphic.members) {\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n              }\n            } else {\n              /* istanbul ignore next */\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Actor } from '../Actor';\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\n\n/**\n * Draws anything with a transform and a \"draw\" method\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\n */\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\n  public systemType = SystemType.Draw;\n  public priority = -1;\n\n  private _ctx: CanvasRenderingContext2D;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._ctx = scene.engine.ctx;\n    this._engine = scene.engine;\n    this._camera = scene.camera;\n  }\n\n  public sort(a: Entity, b: Entity) {\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\n  }\n\n  public update(entities: Entity[], delta: number) {\n    this._clearScreen();\n\n    let transform: TransformComponent;\n    let canvasdraw: CanvasDrawComponent;\n    const length = entities.length;\n    for (let i = 0; i < length; i++) {\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\n      const offscreen = (entities[i] as Actor).isOffScreen;\n      if (visible && !offscreen) {\n        transform = entities[i].get(TransformComponent);\n        canvasdraw = entities[i].get(CanvasDrawComponent);\n\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n\n        this._ctx.save();\n        this._applyTransform(entities[i]);\n        canvasdraw.draw(this._ctx, delta);\n        this._ctx.restore();\n\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n\n      if (this._engine.isDebug) {\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n        this._ctx.strokeStyle = 'yellow';\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n    }\n    if (this._engine.isDebug) {\n      this._ctx.save();\n      this._camera.draw(this._ctx);\n      this._camera.debugDraw(this._ctx);\n      this._ctx.restore();\n    }\n\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n  }\n\n  private _applyTransform(entity: Entity) {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._ctx.translate(transform.pos.x, transform.pos.y);\n        this._ctx.rotate(transform.rotation);\n        this._ctx.scale(transform.scale.x, transform.scale.y);\n      }\n    }\n  }\n\n  private _clearScreen(): void {\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n  }\n\n  private _pushCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera transform to place entity in world space\n      this._ctx.save();\n      if (this._camera) {\n        this._camera.draw(this._ctx);\n      }\n    }\n  }\n\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Restore back to screen space from world space if we were drawing an entity there\n      this._ctx.restore();\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { vec, Vector } from '../Math/vector';\nimport { toDegrees } from '../Math/util';\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle } from '..';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\n\nexport class DebugSystem extends System<TransformComponent> {\n  public readonly types = ['ex.transform'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 999; // lowest priority\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _collisionSystem: CollisionSystem;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\n  }\n\n  update(entities: Entity[], _delta: number): void {\n    if (!this._engine.isDebug) {\n      return;\n    }\n\n    const filterSettings = this._engine.debug.filter;\n\n    let id: number;\n    let name: string;\n    const entitySettings = this._engine.debug.entity;\n\n    let tx: TransformComponent;\n    const txSettings = this._engine.debug.transform;\n\n    let motion: MotionComponent;\n    const motionSettings = this._engine.debug.motion;\n\n    let colliderComp: ColliderComponent;\n    const colliderSettings = this._engine.debug.collider;\n\n    const physicsSettings = this._engine.debug.physics;\n\n    let graphics: GraphicsComponent;\n    const graphicsSettings = this._engine.debug.graphics;\n\n    let debugDraw: DebugGraphicsComponent;\n\n    let body: BodyComponent;\n    const bodySettings = this._engine.debug.body;\n\n    const cameraSettings = this._engine.debug.camera;\n    for (const entity of entities) {\n      if (entity.hasTag('offscreen')) {\n        // skip offscreen entities\n        continue;\n      }\n      if (entity instanceof Particle) {\n        // Particles crush the renderer :(\n        continue;\n      }\n      if (filterSettings.useFilter) {\n        const allIds = filterSettings.ids.length === 0;\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\n        if (!idMatch) {\n          continue;\n        }\n        const allNames = filterSettings.nameQuery === '';\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\n        if (!nameMatch) {\n          continue;\n        }\n      }\n\n      let cursor = Vector.Zero;\n      const lineHeight = vec(0, 16);\n      id = entity.id;\n      name = entity.name;\n      tx = entity.get(TransformComponent);\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      this._pushCameraTransform(tx);\n\n      this._graphicsContext.save();\n\n      this._applyTransform(entity);\n      if (tx) {\n        if (txSettings.showAll || txSettings.showPosition) {\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\n        }\n        if (txSettings.showAll || txSettings.showPositionLabel) {\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n        if (txSettings.showAll || txSettings.showZIndex) {\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showId) {\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showName) {\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showRotation) {\n          this._graphicsContext.drawLine(\n            Vector.Zero,\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\n            txSettings.rotationColor,\n            2\n          );\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showScale) {\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\n        }\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      if (graphics) {\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\n          const bounds = graphics.localBounds;\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\n        }\n      }\n\n      debugDraw = entity.get(DebugGraphicsComponent);\n      if (debugDraw) {\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.restore();\n        }\n        debugDraw.draw(this._graphicsContext);\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.save();\n          this._applyTransform(entity);\n        }\n      }\n\n      body = entity.get(BodyComponent);\n      if (body) {\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMass) {\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMotion) {\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showSleeping) {\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n      }\n\n      this._graphicsContext.restore();\n\n      motion = entity.get(MotionComponent);\n      if (motion) {\n        if (motionSettings.showAll || motionSettings.showVelocity) {\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\n        }\n      }\n\n      // Colliders live in world space already so after the restore()\n      colliderComp = entity.get(ColliderComponent);\n      if (colliderComp) {\n        const collider = colliderComp.get();\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\n        }\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\n          if (collider instanceof CompositeCollider) {\n            const colliders = collider.getColliders();\n            for (const collider of colliders) {\n              const bounds = collider.bounds;\n              const pos = vec(bounds.left, bounds.top);\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\n              }\n            }\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\n          } else if (collider) {\n            const bounds = colliderComp.bounds;\n            const pos = vec(bounds.left, bounds.top);\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\n            }\n          }\n        }\n      }\n\n      this._popCameraTransform(tx);\n    }\n\n    this._graphicsContext.save();\n    this._camera.draw(this._graphicsContext);\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\n      this._collisionSystem.debug(this._graphicsContext);\n    }\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\n          }\n        }\n\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\n              color: physicsSettings.collisionNormalColor\n            });\n          }\n        }\n      }\n    }\n    this._graphicsContext.restore();\n\n    if (cameraSettings) {\n      this._graphicsContext.save();\n      this._camera.draw(this._graphicsContext);\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\n      }\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\n      }\n      this._graphicsContext.restore();\n    }\n\n    this._graphicsContext.flush();\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n\n  /**\n   * Applies the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _pushCameraTransform(transform: TransformComponent) {\n    // Establish camera offset per entity\n    if (transform.coordPlane === CoordPlane.World) {\n      this._graphicsContext.save();\n      if (this._camera) {\n        this._camera.draw(this._graphicsContext);\n      }\n    }\n  }\n\n  /**\n   * Resets the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera world offset\n      this._graphicsContext.restore();\n    }\n  }\n}\n","import { ColliderComponent } from '../Collision/ColliderComponent';\nimport { Engine } from '../Engine';\nimport {\n  System,\n  TransformComponent,\n  SystemType,\n  Entity,\n  CoordPlane,\n  AddedEntity,\n  RemovedEntity,\n  isAddedSystemEntity\n} from '../EntityComponentSystem';\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\nimport { Scene } from '../Scene';\nimport { PointerComponent } from './PointerComponent';\nimport { PointerEventReceiver } from './PointerEventReceiver';\nimport { PointerEvent } from './PointerEvent';\n\n/**\n * The PointerSystem is responsible for dispatching pointer events to entities\n * that need them.\n *\n * The PointerSystem can be optionally configured by the [[PointerComponent]], by default Entities use\n * the [[Collider]]'s shape for pointer events.\n */\nexport class PointerSystem extends System<TransformComponent | PointerComponent> {\n  public readonly types = ['ex.transform', 'ex.pointer'] as const;\n  public readonly systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _receiver: PointerEventReceiver;\n\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseColliderShape = false;\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseGraphicsBounds = false;\n\n  public lastFrameEntityToPointers = new Map<number, number[]>();\n  public currentFrameEntityToPointers = new Map<number, number[]>();\n\n  public initialize(scene: Scene): void {\n    this._engine = scene.engine;\n    this._receiver = this._engine.input.pointers;\n  }\n\n  private _sortedTransforms: TransformComponent[] = [];\n  private _sortedEntities: Entity[] = [];\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return b.z - a.z;\n      });\n      this._sortedEntities = this._sortedTransforms.map(t => t.owner);\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      this._sortedEntities.push(tx.owner);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n        this._sortedEntities.splice(index, 1);\n      }\n    }\n  }\n\n  public entityCurrentlyUnderPointer(entity: Entity, pointerId: number) {\n    return this.currentFrameEntityToPointers.has(entity.id) &&\n           this.currentFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entityWasUnderPointer(entity: Entity, pointerId: number) {\n    return this.lastFrameEntityToPointers.has(entity.id) &&\n           this.lastFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entered(entity: Entity, pointerId: number) {\n    return this.entityCurrentlyUnderPointer(entity, pointerId) &&\n           !this.lastFrameEntityToPointers.has(entity.id);\n  }\n\n  public left(entity: Entity, pointerId: number) {\n    return !this.currentFrameEntityToPointers.has(entity.id) &&\n            this.entityWasUnderPointer(entity, pointerId);\n  }\n\n  public addPointerToEntity(entity: Entity, pointerId: number) {\n    if (!this.currentFrameEntityToPointers.has(entity.id)) {\n      this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\n      return;\n    }\n    const pointers = this.currentFrameEntityToPointers.get(entity.id);\n    this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\n  }\n\n  public update(_entities: Entity[]): void {\n    // Locate all the pointer/entity mappings\n    this._processPointerToEntity(this._sortedEntities);\n\n    // Dispatch pointer events on entities\n    this._dispatchEvents(this._sortedEntities);\n\n    // Clear last frame's events\n    this._receiver.update();\n    this.lastFrameEntityToPointers.clear();\n    this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\n    this.currentFrameEntityToPointers.clear();\n    this._receiver.clear();\n  }\n\n  private _processPointerToEntity(entities: Entity[]) {\n    let transform: TransformComponent;\n    let collider: ColliderComponent;\n    let graphics: GraphicsComponent;\n    let pointer: PointerComponent;\n\n    // TODO probably a spatial partition optimization here to quickly query bounds for pointer\n    // doesn't seem to cause issues tho for perf\n\n    // Pre-process find entities under pointers\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      pointer = entity.get(PointerComponent) ?? new PointerComponent;\n      // Check collider contains pointer\n      collider = entity.get(ColliderComponent);\n      if (collider && (pointer.useColliderShape || this.overrideUseColliderShape)) {\n        const geom = collider.get();\n        if (geom) {\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n            if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n              this.addPointerToEntity(entity, pointerId);\n            }\n          }\n        }\n      }\n\n      // Check graphics contains pointer\n      graphics = entity.get(GraphicsComponent);\n      if (graphics && (pointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\n        const graphicBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n        for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n          if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n            this.addPointerToEntity(entity, pointerId);\n          }\n        }\n      }\n    }\n  }\n\n  private _processDownAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastDownPerPointer = new Map<number, PointerEvent>();\n    // Loop through down and dispatch to entities\n    for (const event of this._receiver.currentFrameDown) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerdown', event as any);\n        if (this._receiver.isDragStart(event.pointerId)) {\n          entity.events.emit('pointerdragstart', event as any);\n        }\n      }\n      lastDownPerPointer.set(event.pointerId, event);\n    }\n    return lastDownPerPointer;\n  }\n\n  private _processUpAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastUpPerPointer = new Map<number, PointerEvent>();\n    // Loop through up and dispatch to entities\n    for (const event of this._receiver.currentFrameUp) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerup', event as any);\n        if (this._receiver.isDragEnd(event.pointerId)) {\n          entity.events.emit('pointerdragend', event as any);\n        }\n      }\n      lastUpPerPointer.set(event.pointerId, event);\n    }\n    return lastUpPerPointer;\n  }\n\n  private _processMoveAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastMovePerPointer = new Map<number, PointerEvent>();\n    // Loop through move and dispatch to entities\n    for (const event of this._receiver.currentFrameMove) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        // move\n        entity.events.emit('pointermove', event as any);\n\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragmove', event as any);\n        }\n      }\n      lastMovePerPointer.set(event.pointerId, event);\n    }\n    return lastMovePerPointer;\n  }\n\n  private _processEnterLeaveAndEmit(entity: Entity, lastUpDownMoveEvents: PointerEvent[]) {\n    // up, down, and move are considered for enter and leave\n    for (const event of lastUpDownMoveEvents) {\n      // enter\n      if (event.active && entity.active && this.entered(entity, event.pointerId)) {\n        entity.events.emit('pointerenter', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragenter', event as any);\n        }\n        break;\n      }\n      if (event.active && entity.active &&\n          // leave can happen on move\n          (this.left(entity, event.pointerId) ||\n          // or leave can happen on pointer up\n          (this.entityCurrentlyUnderPointer(entity, event.pointerId) && event.type === 'up'))) {\n        entity.events.emit('pointerleave', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragleave', event as any);\n        }\n        break;\n      }\n    }\n  }\n\n  private _processCancelAndEmit(entity: Entity) {\n    // cancel\n    for (const event of this._receiver.currentFrameCancel) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)){\n        entity.events.emit('pointercancel', event as any);\n      }\n    }\n  }\n\n  private _processWheelAndEmit(entity: Entity) {\n    // wheel\n    for (const event of this._receiver.currentFrameWheel) {\n      // Currently the wheel only fires under the primary pointer '0'\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, 0)) {\n        entity.events.emit('pointerwheel', event as any);\n      }\n    }\n  }\n\n  private _dispatchEvents(entities: Entity[]) {\n    const lastFrameEntities = new Set(this.lastFrameEntityToPointers.keys());\n    const currentFrameEntities = new Set(this.currentFrameEntityToPointers.keys());\n    // Filter preserves z order\n    const entitiesWithEvents = entities.filter(e => lastFrameEntities.has(e.id) || currentFrameEntities.has(e.id));\n    let lastMovePerPointer: Map<number, PointerEvent>;\n    let lastUpPerPointer: Map<number, PointerEvent>;\n    let lastDownPerPointer: Map<number, PointerEvent>;\n    // Dispatch events in entity z order\n    for (const entity of entitiesWithEvents) {\n      lastDownPerPointer = this._processDownAndEmit(entity);\n\n      lastUpPerPointer = this._processUpAndEmit(entity);\n\n      lastMovePerPointer = this._processMoveAndEmit(entity);\n\n      const lastUpDownMoveEvents = [\n        ...lastMovePerPointer.values(),\n        ...lastDownPerPointer.values(),\n        ...lastUpPerPointer.values()\n      ];\n      this._processEnterLeaveAndEmit(entity, lastUpDownMoveEvents);\n\n      this._processCancelAndEmit(entity);\n\n      this._processWheelAndEmit(entity);\n    }\n  }\n}","import { Entity } from '../EntityComponentSystem';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { ActionsComponent } from './ActionsComponent';\n\n\nexport class ActionsSystem extends System<ActionsComponent> {\n  public readonly types = ['ex.actions'] as const;\n  systemType = SystemType.Update;\n  priority = -1;\n\n  private _actions: ActionsComponent[] = [];\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      this._actions.push(action);\n    } else {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      const index = this._actions.indexOf(action);\n      if (index > -1) {\n        this._actions.splice(index, 1);\n      }\n    }\n  }\n\n  update(_entities: Entity[], delta: number): void {\n    for (const actions of this._actions) {\n      actions.update(delta);\n    }\n  }\n}","import { Component } from '../EntityComponentSystem/Component';\nimport { IsometricMap } from './IsometricMap';\n\nexport class IsometricEntityComponent extends Component<'ex.isometricentity'> {\n  public readonly type = 'ex.isometricentity';\n  /**\n   * Vertical \"height\" in the isometric world\n   */\n  public elevation: number = 0;\n\n  public map: IsometricMap;\n\n  /**\n   * Specify the isometric map to use to position this entity's z-index\n   * @param map\n   */\n  constructor(map: IsometricMap) {\n    super();\n    this.map = map;\n  }\n}","import { System, SystemType } from '../EntityComponentSystem/System';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\n\nexport class IsometricEntitySystem extends System<TransformComponent | IsometricEntityComponent> {\n  public readonly types = ['ex.transform', 'ex.isometricentity'] as const;\n  public readonly systemType = SystemType.Update;\n  priority: number = 99;\n  update(entities: Entity[], _delta: number): void {\n    let transform: TransformComponent;\n    let iso: IsometricEntityComponent;\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      iso = entity.get(IsometricEntityComponent);\n\n      const maxZindexPerElevation = Math.max(iso.map.width * iso.map.tileWidth, iso.map.height * iso.map.tileHeight);\n\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\n      transform.z = newZ;\n    }\n  }\n}","import { GraphicsComponent } from './GraphicsComponent';\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\nimport { Scene } from '../Scene';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent, CoordPlane } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Camera } from '../Camera';\nimport { System, SystemType } from '../EntityComponentSystem/System';\n\nexport class OffscreenSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public systemType = SystemType.Draw;\n  priority: number = -1;\n  private _camera: Camera;\n\n  public initialize(scene: Scene): void {\n    this._camera = scene.camera;\n  }\n\n  update(entities: Entity[]): void {\n    let transform: TransformComponent;\n    let graphics: GraphicsComponent;\n\n    for (const entity of entities) {\n      graphics = entity.get(GraphicsComponent);\n      transform = entity.get(TransformComponent);\n\n      // Figure out if entities are offscreen\n      const entityOffscreen = this._isOffscreen(transform, graphics);\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\n        entity.addTag('ex.offscreen');\n      }\n\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\n        entity.removeTag('ex.offscreen');\n      }\n    }\n  }\n\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      const transformedBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n      const graphicsOffscreen = !this._camera.viewport.overlaps(transformedBounds);\n      return graphicsOffscreen;\n    } else {\n      // TODO screen coordinates\n      return false;\n    }\n  }\n\n}","\n\nexport enum ColorBlindnessMode {\n  Protanope = 'Protanope',\n  Deuteranope = 'Deuteranope',\n  Tritanope = 'Tritanope'\n}\n","/**\n * Determines the scope of handling mouse/touch events.\n */\n\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n","import { Logger } from '../Util/Log';\nimport { Class } from '../Class';\nimport * as Events from '../Events';\n\n/**\n * Enum representing physical input key codes\n */\nexport enum Keys {\n  // NUMPAD\n  Num0 = 'Numpad0',\n  Num1 = 'Numpad1',\n  Num2 = 'Numpad2',\n  Num3 = 'Numpad3',\n  Num4 = 'Numpad4',\n  Num5 = 'Numpad5',\n  Num6 = 'Numpad6',\n  Num7 = 'Numpad7',\n  Num8 = 'Numpad8',\n  Num9 = 'Numpad9',\n  NumAdd = 'NumpadAdd',\n  NumSubtract = 'NumpadSubtract',\n  NumMultiply = 'NumpadMultiply',\n  NumDivide = 'NumpadDivide',\n  // NumComma = 'NumpadComma', // not x-browser\n  NumDecimal = 'NumpadDecimal',\n  Numpad0 = 'Numpad0',\n  Numpad1 = 'Numpad1',\n  Numpad2 = 'Numpad2',\n  Numpad3 = 'Numpad3',\n  Numpad4 = 'Numpad4',\n  Numpad5 = 'Numpad5',\n  Numpad6 = 'Numpad6',\n  Numpad7 = 'Numpad7',\n  Numpad8 = 'Numpad8',\n  Numpad9 = 'Numpad9',\n  NumpadAdd = 'NumpadAdd',\n  NumpadSubtract = 'NumpadSubtract',\n  NumpadMultiply = 'NumpadMultiply',\n  NumpadDivide = 'NumpadDivide',\n  // NumpadComma = 'NumpadComma', // not x-browser\n  NumpadDecimal = 'NumpadDecimal',\n\n  // MODIFIERS\n  NumLock = 'NumLock',\n  ShiftLeft = 'ShiftLeft',\n  ShiftRight = 'ShiftRight',\n  AltLeft = 'AltLeft',\n  AltRight = 'AltRight',\n  ControlLeft = 'ControlLeft',\n  ControlRight = 'ControlRight',\n  MetaLeft = 'MetaLeft',\n  MetaRight = 'MetaRight',\n\n  // NUMBERS\n  Key0 = 'Digit0',\n  Key1 = 'Digit1',\n  Key2 = 'Digit2',\n  Key3 = 'Digit3',\n  Key4 = 'Digit4',\n  Key5 = 'Digit5',\n  Key6 = 'Digit6',\n  Key7 = 'Digit7',\n  Key8 = 'Digit8',\n  Key9 = 'Digit9',\n  Digit0 = 'Digit0',\n  Digit1 = 'Digit1',\n  Digit2 = 'Digit2',\n  Digit3 = 'Digit3',\n  Digit4 = 'Digit4',\n  Digit5 = 'Digit5',\n  Digit6 = 'Digit6',\n  Digit7 = 'Digit7',\n  Digit8 = 'Digit8',\n  Digit9 = 'Digit9',\n\n  // FUNCTION KEYS\n  F1 = 'F1',\n  F2 = 'F2',\n  F3 = 'F3',\n  F4 = 'F4',\n  F5 = 'F5',\n  F6 = 'F6',\n  F7 = 'F7',\n  F8 = 'F8',\n  F9 = 'F9',\n  F10 = 'F10',\n  F11 = 'F11',\n  F12 = 'F12',\n\n  // LETTERS\n  A = 'KeyA',\n  B = 'KeyB',\n  C = 'KeyC',\n  D = 'KeyD',\n  E = 'KeyE',\n  F = 'KeyF',\n  G = 'KeyG',\n  H = 'KeyH',\n  I = 'KeyI',\n  J = 'KeyJ',\n  K = 'KeyK',\n  L = 'KeyL',\n  M = 'KeyM',\n  N = 'KeyN',\n  O = 'KeyO',\n  P = 'KeyP',\n  Q = 'KeyQ',\n  R = 'KeyR',\n  S = 'KeyS',\n  T = 'KeyT',\n  U = 'KeyU',\n  V = 'KeyV',\n  W = 'KeyW',\n  X = 'KeyX',\n  Y = 'KeyY',\n  Z = 'KeyZ',\n  KeyA = 'KeyA',\n  KeyB = 'KeyB',\n  KeyC = 'KeyC',\n  KeyD = 'KeyD',\n  KeyE = 'KeyE',\n  KeyF = 'KeyF',\n  KeyG = 'KeyG',\n  KeyH = 'KeyH',\n  KeyI = 'KeyI',\n  KeyJ = 'KeyJ',\n  KeyK = 'KeyK',\n  KeyL = 'KeyL',\n  KeyM = 'KeyM',\n  KeyN = 'KeyN',\n  KeyO = 'KeyO',\n  KeyP = 'KeyP',\n  KeyQ = 'KeyQ',\n  KeyR = 'KeyR',\n  KeyS = 'KeyS',\n  KeyT = 'KeyT',\n  KeyU = 'KeyU',\n  KeyV = 'KeyV',\n  KeyW = 'KeyW',\n  KeyX = 'KeyX',\n  KeyY = 'KeyY',\n  KeyZ = 'KeyZ',\n\n  // SYMBOLS\n  Semicolon = 'Semicolon',\n  Quote = 'Quote',\n  Comma = 'Comma',\n  Minus = 'Minus',\n  Period = 'Period',\n  Slash = 'Slash',\n  Equal = 'Equal',\n  BracketLeft = 'BracketLeft',\n  Backslash = 'Backslash',\n  BracketRight = 'BracketRight',\n  Backquote = 'Backquote',\n\n  // DIRECTIONS\n  Up = 'ArrowUp',\n  Down = 'ArrowDown',\n  Left = 'ArrowLeft',\n  Right = 'ArrowRight',\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n\n  // OTHER\n  Space = 'Space',\n  Backspace = 'Backspace',\n  Delete = 'Delete',\n  Esc = 'Escape',\n  Escape = 'Escape',\n  Enter = 'Enter',\n  NumpadEnter = 'NumpadEnter',\n  ContextMenu = 'ContextMenu'\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends Events.GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   * @param value The key's typed value the browser detected\n   * @param originalEvent The original keyboard event that Excalibur handled\n   */\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n */\nexport class Keyboard extends Class {\n  private _keys: Keys[] = [];\n  private _keysUp: Keys[] = [];\n  private _keysDown: Keys[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    if (!global) {\n      try {\n        // Try and listen to events on top window frame if within an iframe.\n        //\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\n        //\n        // Attempt to add an event listener, which triggers a DOMException on\n        // cross-origin iframes\n        const noop = () => {\n          return;\n        };\n        window.top.addEventListener('blur', noop);\n        window.top.removeEventListener('blur', noop);\n\n        // this will be the same as window if not embedded within an iframe\n        global = window.top;\n      } catch {\n        // fallback to current frame\n        global = window;\n\n        Logger.getInstance().warn(\n          'Failed to bind to keyboard events to top frame. ' +\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\n        );\n      }\n    }\n\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', this._handleKeyUp);\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', this._handleKeyDown);\n  }\n\n  private _handleKeyDown = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    if (this._keys.indexOf(code) === -1) {\n      this._keys.push(code);\n      this._keysDown.push(code);\n      const keyEvent = new KeyEvent(code, ev.key, ev);\n      this.eventDispatcher.emit('down', keyEvent);\n      this.eventDispatcher.emit('press', keyEvent);\n    }\n  };\n\n  private _handleKeyUp = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    const key = this._keys.indexOf(code);\n    this._keys.splice(key, 1);\n    this._keysUp.push(code);\n    const keyEvent = new KeyEvent(code, ev.key, ev);\n\n    // alias the old api, we may want to deprecate this in the future\n    this.eventDispatcher.emit('up', keyEvent);\n    this.eventDispatcher.emit('release', keyEvent);\n  };\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n\n  /**\n   * Trigger a manual key event\n   * @param type\n   * @param key\n   * @param character\n   */\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\n    if (type === 'down') {\n      this._handleKeyDown(new KeyboardEvent('keydown', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n    if (type === 'up') {\n      this._handleKeyUp(new KeyboardEvent('keyup', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n  }\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n","/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n","/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n","/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n","import { ScreenElement } from './ScreenElement';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { SystemType } from './EntityComponentSystem/System';\nimport { obsolete } from './Util/Decorators';\nimport { World } from './EntityComponentSystem/World';\nimport { MotionSystem } from './Collision/MotionSystem';\nimport { CollisionSystem } from './Collision/CollisionSystem';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\nimport { Flags, Legacy } from './Flags';\nimport { DebugSystem } from './Debug/DebugSystem';\nimport { PointerSystem } from './Input/PointerSystem';\nimport { ActionsSystem } from './Actions/ActionsSystem';\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera = new Camera();\n\n  /**\n   * The ECS world for the scene\n   */\n  public world = new World(this);\n\n  /**\n   * The actors in the current scene\n   */\n  public get actors(): Actor[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Actor;\n    }) as Actor[];\n  }\n\n  /**\n   * The entities in the current scene\n   */\n  public get entities(): Entity[] {\n    return this.world.entityManager.entities;\n  }\n\n  /**\n   * The triggers in the current scene\n   */\n  public get triggers(): Trigger[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Trigger;\n    }) as Trigger[];\n  }\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public get tileMaps(): TileMap[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof TileMap;\n    }) as TileMap[];\n  }\n\n  /**\n   * Access to the Excalibur engine\n   */\n  public engine: Engine;\n\n  /**\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\n   * @deprecated Use [[Scene.actors]]\n   */\n  @obsolete({\n    message: 'Will be removed in excalibur v0.26.0',\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\n  })\n  public get screenElements(): ScreenElement[] {\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n  }\n\n  private _isInitialized: boolean = false;\n  private _timers: Timer[] = [];\n  public get timers(): readonly Timer[] {\n    return this._timers;\n  }\n  private _cancelQueue: Timer[] = [];\n\n  constructor() {\n    super();\n    // Initialize systems\n    this.world.add(new ActionsSystem());\n    this.world.add(new MotionSystem());\n    this.world.add(new CollisionSystem());\n    this.world.add(new PointerSystem());\n    this.world.add(new IsometricEntitySystem());\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      this.world.add(new CanvasDrawingSystem());\n    } else {\n      this.world.add(new OffscreenSystem());\n      this.world.add(new GraphicsSystem());\n    }\n    this.world.add(new DebugSystem());\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overridden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.entities) {\n      child._initialize(this.engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.engine = engine;\n      // Initialize camera first\n      this.camera._initialize(engine);\n\n      this.world.systemManager.initialize();\n\n      // This order is important! we want to be sure any custom init that add actors\n      // fire before the actor init\n      this.onInitialize.call(this, engine);\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDeactivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n\n    // TODO differed entity removal for timers\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    this.world.update(SystemType.Update, delta);\n\n    // Camera last keeps renders smooth that are based on entity/actor\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n\n    this.world.update(SystemType.Draw, delta);\n\n    if (this.engine?.isDebug) {\n      this.debugDraw(ctx);\n    }\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   * @deprecated Signature will change in v0.26.0\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n    // pass\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the scene.\n   * @param screenElement  The ScreenElement to add to the current scene\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    this.emit('entityadded', { target: entity } as any);\n    this.world.add(entity);\n    entity.scene = this;\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  public remove(entity: Entity): void;\n\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the current scene\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.emit('entityremoved', { target: entity } as any);\n      this.world.remove(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `ScreenElement` only?\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addScreenElement(actor: Actor) {\n    this.add(actor);\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeScreenElement(actor: Actor) {\n    this.remove(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addTileMap(tileMap: TileMap) {\n    this.world.add(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeTileMap(tileMap: TileMap) {\n    this.world.remove(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  public isCurrentScene(): boolean {\n    if (this.engine) {\n      return this.engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n    for (const _ui of screenElements) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isScreenElement(child as Actor)) {\n          // TODO not true\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { Shader } from '../Context/shader';\nimport { VertexBuffer } from '../Context/vertex-buffer';\nimport { VertexLayout } from '../Context/vertex-layout';\n\n/**\n * Helper that defines a whole screen renderer, just provide a fragment source!\n *\n * Currently supports 1 varying\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\n */\nexport class ScreenShader {\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(fragmentSource: string) {\n    this._shader = new Shader({\n      vertexSource: `\n      attribute vec2 a_position;\n      attribute vec2 a_texcoord;\n      varying vec2 v_texcoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_texcoord;\n      }`,\n      fragmentSource: fragmentSource\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  public getShader() {\n    return this._shader;\n  }\n  public getLayout() {\n    return this._layout;\n  }\n}","import colorBlindCorrectSource from './color-blind-fragment.glsl';\nimport { PostProcessor } from './PostProcessor';\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\nimport { Shader } from '../Context/shader';\nimport { VertexLayout } from '../Context/vertex-layout';\nimport { ScreenShader } from './ScreenShader';\n\nexport class ColorBlindnessPostProcessor implements PostProcessor {\n  private _shader: ScreenShader;\n  private _simulate = false;\n  constructor(private _colorBlindnessMode: ColorBlindnessMode, simulate = false) {\n    this._simulate = simulate;\n  }\n\n  initialize(_gl: WebGLRenderingContext): void {\n    this._shader = new ScreenShader(colorBlindCorrectSource);\n    this.simulate = this._simulate;\n    this.colorBlindnessMode = this._colorBlindnessMode;\n  }\n\n  getShader(): Shader {\n    return this._shader.getShader();\n  }\n\n  getLayout(): VertexLayout {\n    return this._shader.getLayout();\n  }\n\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\n    this._colorBlindnessMode = colorBlindMode;\n    if (this._shader) {\n      const shader = this._shader.getShader();\n      shader.use();\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\n        shader.setUniformInt('u_type', 0);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\n        shader.setUniformInt('u_type', 1);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\n        shader.setUniformInt('u_type', 2);\n      }\n    }\n  }\n\n  get colorBlindnessMode(): ColorBlindnessMode {\n    return this._colorBlindnessMode;\n  }\n\n  set simulate(value: boolean) {\n    this._simulate = value;\n    if (this._shader) {\n\n      const shader = this._shader.getShader();\n      shader.use();\n      shader.setUniformBoolean('u_simulate', value);\n    }\n  }\n\n  get simulate(): boolean {\n    return this._simulate;\n  }\n}\n","export default \"precision mediump float;\\n// our texture\\nuniform sampler2D u_image;\\n// the texCoords passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// color blind type\\nuniform int u_type;\\n\\n// simulation?\\nuniform bool u_simulate;\\n\\nvoid main() {\\n  vec4 o =  texture2D(u_image, v_texcoord);\\n  // RGB to LMS matrix conversion\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\n  // Simulate color blindness\\n  float l;\\n  float m;\\n  float s;\\n  //MODE CODE//\\n  if (u_type == 0) {\\n    // Protanope\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\n  } else if (u_type == 1) {\\n    // Deuteranope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\n  } else if (u_type == 2) {\\n    // Tritanope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\n  }\\n\\n  // LMS to RGB matrix conversion\\n  vec4 error; // simulate the colors\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\n  error.a = 1.0;\\n  vec4 diff = o - error;\\n  vec4 correction; // correct the colors\\n  correction.r = 0.0;\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\n  correction = o + correction;\\n  correction.a = o.a;\\n  //SIMULATE//\\n\\n  // sim \\n  if (u_simulate) {\\n    gl_FragColor = error.rgba;\\n  } else {\\n    gl_FragColor = correction.rgba;\\n  }\\n}\";","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\nimport { Engine } from '../Engine';\nimport { ExcaliburGraphicsContextWebGL } from '..';\n\nexport interface DebugFlags {\n  colorBlindMode: ColorBlindFlags;\n}\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n  }\n\n  /**\n   * Correct colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public correct(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = false;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Simulate colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public simulate(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = true;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Remove color blindness post processor\n   */\n  public clear() {\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n  }\n}\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\nimport { StandardClock, TestClock } from '..';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n\n  /**\n   * Graphics statistics\n   */\n  graphics: GraphicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisions\n   */\n  collisions: number;\n\n  /**\n   * Copy of the current frame contacts (only updated if debug is toggled on)\n   */\n  contacts: Map<string, CollisionContact>;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\nexport interface GraphicsStatistics {\n  drawCalls: number;\n  drawnImages: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  private _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[TestClock]] and return\n   * it in the same running state.\n   *\n   * This is useful when you need to debug frame by frame.\n   */\n  public useTestClock(): TestClock {\n    const clock = this._engine.clock;\n    const wasRunning = clock.isRunning();\n    clock.stop();\n\n    const testClock = clock.toTestClock();\n    if (wasRunning) {\n      testClock.start();\n    }\n    this._engine.clock = testClock;\n    return testClock;\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[StandardClock]] and\n   * return it in the same running state.\n   *\n   * This is useful when you need to switch back to normal mode after\n   * debugging.\n   */\n  public useStandardClock(): StandardClock {\n    const currentClock = this._engine.clock;\n    const wasRunning = currentClock.isRunning();\n    currentClock.stop();\n\n    const standardClock = currentClock.toStandardClock();\n    if (wasRunning) {\n      standardClock.start();\n    }\n    this._engine.clock = standardClock;\n    return standardClock;\n  }\n\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n\n  /**\n   * Correct or simulate color blindness using [[ColorBlindnessPostProcessor]].\n   * @warning Will reduce FPS.\n   */\n  public colorBlindMode: ColorBlindFlags;\n\n  /**\n   * Filter debug context to named entities or entity ids\n   */\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\n    /**\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\n     */\n    useFilter: false,\n    /**\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\n     */\n    nameQuery: '',\n    /**\n     * Query for Entity ids, if the id matches it will be included\n     */\n    ids: []\n  };\n\n  /**\n   * Entity debug settings\n   */\n  public entity = {\n    showAll: false,\n    showId: true,\n    showName: false\n  };\n\n  /**\n   * Transform component debug settings\n   */\n  public transform = {\n    showAll: false,\n\n    showPosition: false,\n    showPositionLabel: false,\n    positionColor: Color.Yellow,\n\n    showZIndex: false,\n\n    showScale: false,\n    scaleColor: Color.Green,\n\n    showRotation: false,\n    rotationColor: Color.Blue\n  };\n\n  /**\n   * Graphics component debug settings\n   */\n  public graphics = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Yellow\n  };\n\n  /**\n   * Collider component debug settings\n   */\n  public collider = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Blue,\n\n    showOwner: false,\n\n    showGeometry: true,\n    geometryColor: Color.Green\n  };\n\n  /**\n   * Physics simulation debug settings\n   */\n  public physics = {\n    showAll: false,\n\n    showBroadphaseSpacePartitionDebug: false,\n\n    showCollisionNormals: false,\n    collisionNormalColor: Color.Cyan,\n\n    showCollisionContacts: true,\n    collisionContactColor: Color.Red\n  };\n\n  /**\n   * Motion component debug settings\n   */\n  public motion = {\n    showAll: false,\n\n    showVelocity: false,\n    velocityColor: Color.Yellow,\n\n    showAcceleration: false,\n    accelerationColor: Color.Red\n  };\n\n  /**\n   * Body component debug settings\n   */\n  public body = {\n    showAll: false,\n\n    showCollisionGroup: false,\n    showCollisionType: false,\n    showSleeping: false,\n    showMotion: false,\n    showMass: false\n  };\n\n  /**\n   * Camera debug settings\n   */\n  public camera = {\n    showAll: false,\n\n    showFocus: false,\n    focusColor: Color.Red,\n\n    showZoom: false\n  };\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining() {\n      return this.alive - this.killed;\n    },\n    get total() {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total() {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  private _graphicsStats: GraphicsStatistics = {\n    drawCalls: 0,\n    drawnImages: 0\n  };\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n\n  /**\n   * Gets the frame's graphics statistics\n   */\n  public get graphics() {\n    return this._graphicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _contacts: Map<string, CollisionContact> = new Map();\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.contacts = otherStats.contacts;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.contacts.clear();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get contacts(): Map<string, CollisionContact> {\n    return this._contacts;\n  }\n\n  public set contacts(contacts: Map<string, CollisionContact>) {\n    this._contacts = contacts;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","export interface NativeEventable {\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\n}\n\nexport class BrowserComponent<T extends NativeEventable> {\n  private _paused = false;\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\n\n  on(eventName: string, handler: (evt: any) => void): void {\n    if (this._nativeHandlers[eventName]) {\n      this.off(eventName, this._nativeHandlers[eventName]);\n    }\n    this._nativeHandlers[eventName] = this._decorate(handler);\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n  }\n  off(eventName: string, handler?: (event: any) => void): void {\n    if (!handler) {\n      handler = this._nativeHandlers[eventName];\n    }\n    this.nativeComponent.removeEventListener(eventName, handler);\n    this._nativeHandlers[eventName] = null;\n  }\n\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\n    return (evt: any) => {\n      if (!this._paused) {\n        handler(evt);\n      }\n    };\n  }\n\n  public pause() {\n    this._paused = true;\n  }\n\n  public resume() {\n    this._paused = false;\n  }\n\n  public clear() {\n    for (const event in this._nativeHandlers) {\n      this.off(event);\n    }\n  }\n\n  constructor(public nativeComponent: T) {}\n}\n\nexport class BrowserEvents {\n  private _windowComponent: BrowserComponent<Window>;\n  private _documentComponent: BrowserComponent<Document>;\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\n  }\n\n  public get window(): BrowserComponent<Window> {\n    return this._windowComponent;\n  }\n\n  public get document(): BrowserComponent<Document> {\n    return this._documentComponent;\n  }\n\n  public pause() {\n    this.window.pause();\n    this.document.pause();\n  }\n\n  public resume() {\n    this.window.resume();\n    this.document.resume();\n  }\n\n  public clear() {\n    this.window.clear();\n    this.document.clear();\n  }\n}\n","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\nimport { Vector } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\nimport { DebugText } from './debug-text';\nimport { Matrix } from '../../Math/matrix';\nimport { ScreenDimension } from '../../Screen';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\n\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\n  /**\n   * Draw a debug rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.strokeStyle = 'red';\n    this._ex.__ctx.strokeRect(\n      this._ex.snapToPixel ? ~~x : x,\n      this._ex.snapToPixel ? ~~y : y,\n      this._ex.snapToPixel ? ~~width : width,\n      this._ex.snapToPixel ? ~~height : height\n    );\n    this._ex.__ctx.restore();\n  }\n\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\n    this._ex.__ctx.lineWidth = 2;\n    this._ex.__ctx.stroke();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\n    this._ex.__ctx.arc(\n      this._ex.snapToPixel ? ~~point.x : point.x,\n      this._ex.snapToPixel ? ~~point.y : point.y,\n      pointOptions.size,\n      0,\n      Math.PI * 2\n    );\n    this._ex.__ctx.fill();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._ex, text, pos);\n  }\n}\n\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n  public get width() {\n    return this.__ctx.canvas.width;\n  }\n\n  public get height() {\n    return this.__ctx.canvas.height;\n  }\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  private _state = new StateStack();\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public snapToPixel: boolean = true;\n\n  public get smoothing(): boolean {\n    return this.__ctx.imageSmoothingEnabled;\n  }\n\n  public set smoothing(value: boolean) {\n    this.__ctx.imageSmoothingEnabled = value;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\n    this.__ctx = canvasElement.getContext('2d', {\n      alpha: enableTransparency ?? true\n    });\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n  }\n\n  public resetTransform(): void {\n    this.__ctx.resetTransform();\n  }\n\n  public updateViewport(_resolution: ScreenDimension): void {\n    // pass\n  }\n\n  /**\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\n   */\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    this.__ctx.globalAlpha = this.opacity;\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\n      .filter((a) => a !== undefined)\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\n    this.__ctx.drawImage.apply(this.__ctx, args);\n    GraphicsDiagnostics.DrawCallCount++;\n    GraphicsDiagnostics.DrawnImagesCount = 1;\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    this.__ctx.strokeStyle = color.toString();\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\n    this.__ctx.lineWidth = thickness;\n    this.__ctx.stroke();\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\n    this.__ctx.save();\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.fillRect(\n      this.snapToPixel ? ~~pos.x : pos.x,\n      this.snapToPixel ? ~~pos.y : pos.y,\n      this.snapToPixel ? ~~width : width,\n      this.snapToPixel ? ~~height : height\n    );\n    this.__ctx.restore();\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    if (stroke) {\n      this.__ctx.strokeStyle = stroke.toString();\n    }\n    if (thickness) {\n      this.__ctx.lineWidth = thickness;\n    }\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\n    this.__ctx.fill();\n    if (stroke) {\n      this.__ctx.stroke();\n    }\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\n\n  /**\n   * Save the current state of the canvas to the stack (transforms and opacity)\n   */\n  save(): void {\n    this.__ctx.save();\n  }\n\n  /**\n   * Restore the state of the canvas from the stack\n   */\n  restore(): void {\n    this.__ctx.restore();\n  }\n\n  /**\n   * Translate the origin of the context by an x and y\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number): void {\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  /**\n   * Rotate the context about the current origin\n   */\n  rotate(angle: number): void {\n    this.__ctx.rotate(angle);\n  }\n\n  /**\n   * Scale the context by an x and y factor\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number): void {\n    this.__ctx.scale(x, y);\n  }\n\n  public getTransform(): Matrix {\n    throw new Error('Not implemented');\n  }\n\n  public multiply(_m: Matrix): void {\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\n  }\n\n  public addPostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public removePostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public clearPostProcessors() {\n    throw Error('Not implemented');\n  }\n\n  public beginDrawLifecycle() {\n    // pass\n  }\n\n  public endDrawLifecycle() {\n    // pass\n  }\n\n  clear(): void {\n    // Clear frame\n    this.__ctx.clearRect(0, 0, this.width, this.height);\n    this.__ctx.fillStyle = this.backgroundColor.toString();\n    this.__ctx.fillRect(0, 0, this.width, this.height);\n    GraphicsDiagnostics.clear();\n  }\n\n  /**\n   * Flushes the batched draw calls to the screen\n   */\n  flush(): void {\n    // pass\n  }\n}\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { GlobalCoordinates } from '../Math/global-coordinates';\nimport { Vector } from '../Math/vector';\nimport { PointerButton } from './PointerButton';\nimport { PointerType } from './PointerType';\n\nexport class PointerEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n\n  get pagePos(): Vector {\n    return this.coordinates.pagePos;\n  }\n\n  get screenPos(): Vector {\n    return this.coordinates.screenPos;\n  }\n\n  get worldPos(): Vector {\n    return this.coordinates.worldPos;\n  }\n\n  constructor(\n    public type: 'down' | 'up' | 'move' | 'cancel',\n    public pointerId: number,\n    public button: PointerButton,\n    public pointerType: PointerType,\n    public coordinates: GlobalCoordinates,\n    public nativeEvent: Event) { };\n}\n","import { WheelDeltaMode } from './WheelDeltaMode';\n\n\nexport class WheelEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: Event\n  ) { }\n}\n","import { Class } from '../Class';\nimport { Vector } from '../Math/vector';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerEvent } from './PointerEvent';\n\nexport class PointerAbstraction extends Class {\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = Vector.Zero;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = Vector.Zero;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = Vector.Zero;\n\n  constructor() {\n    super();\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  private _onPointerMove = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n\n  private _onPointerDown = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { GlobalCoordinates } from '../Math/global-coordinates';\nimport { vec, Vector } from '../Math/vector';\nimport { PointerEvent } from './PointerEvent';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerAbstraction } from './PointerAbstraction';\n\nimport { WheelDeltaMode } from './WheelDeltaMode';\nimport { PointerSystem } from './PointerSystem';\nimport { NativePointerButton } from './NativePointerButton';\nimport { PointerButton } from './PointerButton';\nimport { Util } from '..';\nimport { PointerType } from './PointerType';\n\n\nexport type NativePointerEvent = globalThis.PointerEvent;\nexport type NativeMouseEvent = globalThis.MouseEvent;\nexport type NativeTouchEvent = globalThis.TouchEvent;\nexport type NativeWheelEvent = globalThis.WheelEvent;\n\n/**\n * Is this event a native touch event?\n */\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\n}\n\n/**\n * Is this event a native pointer event\n */\nfunction isPointerEvent(value: any): value is NativePointerEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\n}\n\n/**\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\n */\nexport class PointerEventReceiver extends Class {\n  public primary: PointerAbstraction = new PointerAbstraction();\n\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\n\n  public currentFramePointerDown = new Map<number, boolean>();\n  public lastFramePointerDown = new Map<number, boolean>();\n\n  public currentFrameDown: PointerEvent[] = [];\n  public currentFrameUp: PointerEvent[] = [];\n  public currentFrameMove: PointerEvent[] = [];\n  public currentFrameCancel: PointerEvent[] = [];\n  public currentFrameWheel: WheelEvent[] = [];\n\n  constructor(public readonly target: GlobalEventHandlers & EventTarget, public engine: Engine) {\n    super();\n  }\n\n  private _pointers: PointerAbstraction[] = [this.primary];\n  /**\n   * Locates a specific pointer by id, creates it if it doesn't exist\n   * @param index\n   */\n  public at(index: number): PointerAbstraction {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new PointerAbstraction());\n      }\n    }\n    return this._pointers[index];\n  }\n\n  /**\n   * The number of pointers currently being tracked by excalibur\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  /**\n   * Is the specified pointer id down this frame\n   * @param pointerId\n   */\n  public isDown(pointerId: number) {\n    return this.currentFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Was the specified pointer id down last frame\n   * @param pointerId\n   */\n  public wasDown(pointerId: number) {\n    return this.lastFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public isDragging(pointerId: number): boolean {\n    return this.isDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public isDragStart(pointerId: number): boolean {\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public isDragEnd(pointerId: number): boolean {\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Called internally by excalibur\n   *\n   * Updates the current frame pointer info and emits raw pointer events\n   *\n   * This does not emit events to entities, see PointerSystem\n   */\n  public update() {\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\n\n    for (const event of this.currentFrameDown) {\n      this.emit('down', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('down', event);\n      this.primary.emit('pointerdown', event);\n    }\n\n    for (const event of this.currentFrameUp) {\n      this.emit('up', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('up', event);\n    }\n\n    for (const event of this.currentFrameMove) {\n      this.emit('move', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('move', event);\n    }\n\n    for (const event of this.currentFrameCancel) {\n      this.emit('cancel', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('cancel', event);\n    }\n\n    for (const event of this.currentFrameWheel) {\n      this.emit('wheel', event);\n      this.primary.emit('pointerwheel', event);\n    }\n  }\n\n  /**\n   * Clears the current frame event and pointer data\n   */\n  public clear() {\n    for (const event of this.currentFrameUp) {\n      this.currentFramePointerCoords.delete(event.pointerId);\n      const ids = this._activeNativePointerIdsToNormalized.entries();\n      for (const [native, normalized] of ids) {\n        if (normalized === event.pointerId) {\n          this._activeNativePointerIdsToNormalized.delete(native);\n        }\n      }\n    }\n    this.currentFrameDown.length = 0;\n    this.currentFrameUp.length = 0;\n    this.currentFrameMove.length = 0;\n    this.currentFrameCancel.length = 0;\n    this.currentFrameWheel.length = 0;\n  }\n\n  private _boundHandle = this._handle.bind(this);\n  private _boundWheel = this._handleWheel.bind(this);\n  /**\n   * Initializes the pointer event receiver so that it can start listening to native\n   * browser events.\n   */\n  public init() {\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\n    // It is important on mobile to have touch action 'none'\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\n    if (this.target === this.engine.canvas) {\n      this.engine.canvas.style.touchAction = 'none';\n    } else {\n      document.body.style.touchAction = 'none';\n    }\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.addEventListener('pointerdown', this._boundHandle);\n      this.target.addEventListener('pointerup', this._boundHandle);\n      this.target.addEventListener('pointermove', this._boundHandle);\n      this.target.addEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.addEventListener('touchstart', this._boundHandle);\n      this.target.addEventListener('touchend', this._boundHandle);\n      this.target.addEventListener('touchmove', this._boundHandle);\n      this.target.addEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.addEventListener('mousedown', this._boundHandle);\n      this.target.addEventListener('mouseup', this._boundHandle);\n      this.target.addEventListener('mousemove', this._boundHandle);\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\n    }\n  }\n\n  public detach() {\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.removeEventListener('pointerdown', this._boundHandle);\n      this.target.removeEventListener('pointerup', this._boundHandle);\n      this.target.removeEventListener('pointermove', this._boundHandle);\n      this.target.removeEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.removeEventListener('touchstart', this._boundHandle);\n      this.target.removeEventListener('touchend', this._boundHandle);\n      this.target.removeEventListener('touchmove', this._boundHandle);\n      this.target.removeEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.removeEventListener('mousedown', this._boundHandle);\n      this.target.removeEventListener('mouseup', this._boundHandle);\n      this.target.removeEventListener('mousemove', this._boundHandle);\n    }\n\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.removeEventListener('wheel', this._boundWheel);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\n    }\n  }\n\n  /**\n   * Take native pointer id and map it to index in active pointers\n   * @param nativePointerId\n   */\n  private _normalizePointerId(nativePointerId: number) {\n    // Add to the the native pointer set id\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\n\n    // Native pointer ids in ascending order\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\n\n    // The index into sorted ids will be the new id, will always have an id\n    const id = currentPointerIds.findIndex(p => p === nativePointerId);\n\n    // Save the mapping so we can reverse it later\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\n\n    // ignore pointer because game isn't watching\n    return id;\n  }\n\n  /**\n   * Responsible for handling and parsing pointer events\n   */\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\n    ev.preventDefault();\n    const eventCoords = new Map<number, GlobalCoordinates>();\n    let button: PointerButton;\n    let pointerType: PointerType;\n    if (isTouchEvent(ev)) {\n      button = PointerButton.Unknown;\n      pointerType = PointerType.Touch;\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\n      for (let i = 0; i < ev.changedTouches.length; i++) {\n        const touch = ev.changedTouches[i];\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\n        const nativePointerId = i + 1;\n        const pointerId = this._normalizePointerId(nativePointerId);\n        this.currentFramePointerCoords.set(pointerId, coordinates);\n        eventCoords.set(pointerId, coordinates);\n      }\n    } else {\n      button = this._nativeButtonToPointerButton(ev.button);\n      pointerType = PointerType.Mouse;\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\n      let nativePointerId = 1;\n      if (isPointerEvent(ev)) {\n        nativePointerId = ev.pointerId;\n        pointerType = this._stringToPointerType(ev.pointerType);\n      }\n      const pointerId = this._normalizePointerId(nativePointerId);\n      this.currentFramePointerCoords.set(pointerId, coordinates);\n      eventCoords.set(pointerId, coordinates);\n    }\n\n    for (const [pointerId, coord] of eventCoords.entries()) {\n      switch (ev.type) {\n        case 'mousedown':\n        case 'pointerdown':\n        case 'touchstart':\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, true);\n          break;\n        case 'mouseup':\n        case 'pointerup':\n        case 'touchend':\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, false);\n          break;\n        case 'mousemove':\n        case 'pointermove':\n        case 'touchmove':\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\n          break;\n        case 'touchcancel':\n        case 'pointercancel':\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\n          break;\n      }\n    }\n  }\n\n  private _handleWheel(ev: NativeWheelEvent) {\n    // Should we prevent page scroll because of this event\n    if (\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\n    ) {\n      ev.preventDefault();\n    }\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\n\n    /**\n     * A constant used to normalize wheel events across different browsers\n     *\n     * This normalization factor is pulled from\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n     */\n    const ScrollWheelNormalizationFactor = -1 / 40;\n\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n    const deltaY =\n        ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\n    const deltaZ = ev.deltaZ || 0;\n    let deltaMode = WheelDeltaMode.Pixel;\n\n    if (ev.deltaMode) {\n      if (ev.deltaMode === 1) {\n        deltaMode = WheelDeltaMode.Line;\n      } else if (ev.deltaMode === 2) {\n        deltaMode = WheelDeltaMode.Page;\n      }\n    }\n\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\n    this.currentFrameWheel.push(we);\n  }\n\n  /**\n   * Triggers an excalibur pointer event in a world space pos\n   *\n   * Useful for testing pointers in excalibur\n   * @param type\n   * @param pos\n   */\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\n    const page = this.engine.screen.worldToPageCoordinates(pos);\n    // Send an event to the event receiver\n    if (window.PointerEvent) {\n      this._handle(new window.PointerEvent('pointer' + type, {\n        pointerId: 0,\n        clientX: page.x,\n        clientY: page.y\n      }));\n    } else {\n      // Safari hack\n      this._handle(new window.MouseEvent('mouse' + type, {\n        clientX: page.x,\n        clientY: page.y\n      }));\n    }\n\n    // Force update pointer system\n    const pointerSystem = this.engine.currentScene.world.systemManager.get(PointerSystem);\n    const transformEntities = this.engine.currentScene.world.queryManager.createQuery(pointerSystem.types);\n    pointerSystem.update(transformEntities.getEntities());\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}","export interface FpsSamplerOptions {\n  /**\n   * Specify the sampling period in milliseconds (default 100)\n   */\n  samplePeriod?: number;\n  /**\n   * Specify the initial FPS\n   */\n  initialFps: number;\n\n  /**\n   * Specify the function used to return the current time (in milliseconds)\n   */\n  nowFn: () => number;\n}\n\nexport class FpsSampler {\n  private _fps: number;\n  private _samplePeriod: number = 100;\n  private _currentFrameTime: number = 0;\n  private _frames: number = 0;\n  private _previousSampleTime: number = 0;\n  private _beginFrameTime: number = 0;\n  private _nowFn: () => number;\n\n  constructor(options: FpsSamplerOptions) {\n    this._fps = options.initialFps;\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\n    this._currentFrameTime = 1000/options.initialFps;\n    this._nowFn = options.nowFn;\n    this._previousSampleTime = this._nowFn();\n  }\n\n  /**\n   * Start of code block to sample FPS for\n   */\n  start() {\n    this._beginFrameTime = this._nowFn();\n  }\n\n  /**\n   * End of code block to sample FPS for\n   */\n  end() {\n    this._frames++;\n    const time = this._nowFn();\n\n    this._currentFrameTime = time - this._beginFrameTime;\n\n    if (time >= this._previousSampleTime + this._samplePeriod) {\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\n      this._previousSampleTime = time;\n      this._frames = 0;\n    }\n  }\n\n  /**\n   * Return the currently sampled fps over the last sample period, by default every 100ms\n   */\n  get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\n   */\n  get instant() {\n    return 1000 / this._currentFrameTime;\n  }\n}","import { Logger } from '..';\nimport { FpsSampler } from './Fps';\n\nexport interface ClockOptions {\n  /**\n   * Define the function you'd like the clock to tick when it is started\n   */\n  tick: (elapsedMs: number) => any;\n  /**\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\n   */\n  onFatalException?: (e: unknown) => any;\n  /**\n   * Optionally limit the maximum FPS of the clock\n   */\n  maxFps?: number;\n}\n\n\n/**\n * Abstract Clock is the base type of all Clocks\n *\n * It has a few opinions\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\n * 2. The default timing api is implemented in now()\n *\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\n * method is unique to your clock implementation.\n */\nexport abstract class Clock {\n  protected tick: (elapsedMs: number) => any;\n  private _onFatalException: (e: unknown) => any = () => { /* default nothing */ };\n  private _maxFps: number = Infinity;\n  private _lastTime: number = 0;\n  public fpsSampler: FpsSampler;\n  private _options: ClockOptions;\n  private _elapsed: number = 1;\n  private _scheduledCbs: [cb: () => any, scheduledTime: number][] = [];\n  private _totalElapsed: number = 0;\n  constructor(options: ClockOptions) {\n    this._options = options;\n    this.tick = options.tick;\n    this._lastTime = this.now() ?? 0;\n    this._maxFps = options.maxFps ?? this._maxFps;\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\n    this.fpsSampler = new FpsSampler({\n      initialFps: 60,\n      nowFn: () => this.now()\n    });\n  }\n\n  /**\n   * Get the elapsed time for the last completed frame\n   */\n  public elapsed(): number {\n    return this._elapsed;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public now(): number {\n    return performance.now();\n  }\n\n  public toTestClock() {\n    const testClock = new TestClock({\n      ...this._options,\n      defaultUpdateMs: 16.6\n    });\n    return testClock;\n  }\n\n  public toStandardClock() {\n    const clock = new StandardClock({\n      ...this._options\n    });\n    return clock;\n  }\n\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\n    this._onFatalException = handler;\n  }\n\n  /**\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur [[Clock]]\n   *\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\n   * stopped or paused.\n   *\n   * @param cb callback to fire\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\n   */\n  public schedule(cb: () => any, timeoutMs: number = 0) {\n    const scheduledTime = this.now() + timeoutMs;\n    this._scheduledCbs.push([cb, scheduledTime]);\n  }\n\n  private _runScheduledCbs() {\n    // walk backwards to delete items as we loop\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\n      if (this._scheduledCbs[i][1] <= this._totalElapsed) {\n        this._scheduledCbs[i][0]();\n        this._scheduledCbs.splice(i, 1);\n      }\n    }\n  }\n\n  protected update(overrideUpdateMs?: number): void {\n    try {\n      this.fpsSampler.start();\n      // Get the time to calculate time-elapsed\n      const now = this.now();\n      let elapsed = now - this._lastTime || 1; // first frame\n\n      // Constrain fps\n      const fpsInterval = (1000 / this._maxFps);\n\n      // only run frame if enough time has elapsed\n      if (elapsed >= fpsInterval) {\n        let leftover = 0;\n        if (fpsInterval !== 0) {\n          leftover = (elapsed % fpsInterval);\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n\n        // tick the mainloop and run scheduled callbacks\n        this._elapsed = overrideUpdateMs || elapsed;\n        this._totalElapsed += this._elapsed;\n        this._runScheduledCbs();\n        this.tick(overrideUpdateMs || elapsed);\n\n        if (fpsInterval !== 0) {\n          this._lastTime = now - leftover;\n        } else {\n          this._lastTime = now;\n        }\n        this.fpsSampler.end();\n      }\n    } catch (e) {\n      this._onFatalException(e);\n      this.stop();\n    }\n  }\n\n  /**\n   * Returns if the clock is currently running\n   */\n  public abstract isRunning(): boolean;\n\n  /**\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\n   */\n  public abstract start(): void;\n\n  /**\n   * Stop the clock, tick() is no longer called\n   */\n  public abstract stop(): void;\n}\n\n\n/**\n * The [[StandardClock]] implements the requestAnimationFrame browser api to run the tick()\n */\nexport class StandardClock extends Clock {\n\n  private _running = false;\n  private _requestId: number;\n  constructor(options: ClockOptions) {\n    super(options);\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n\n  public start(): void {\n    if (this._running) {\n      return;\n    }\n    this._running = true;\n    const mainloop = () => {\n      // stop the loop\n      if (!this._running) {\n        return;\n      }\n      try {\n        // request next loop\n        this._requestId = window.requestAnimationFrame(mainloop);\n        this.update();\n      } catch (e) {\n        window.cancelAnimationFrame(this._requestId);\n        throw e;\n      }\n    };\n\n    // begin the first frame\n    mainloop();\n  }\n\n  public stop(): void {\n    this._running = false;\n  }\n}\n\nexport interface TestClockOptions {\n  /**\n   * Specify the update milliseconds to use for each manual step()\n   */\n  defaultUpdateMs: number;\n}\n\n/**\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\n */\nexport class TestClock extends Clock {\n  private _logger = Logger.getInstance();\n  private _updateMs: number;\n  private _running: boolean = false;\n  private _currentTime = 0;\n  constructor(options: ClockOptions & TestClockOptions) {\n    super({\n      ...options\n    });\n    this._updateMs = options.defaultUpdateMs;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public override now() {\n    return this._currentTime ?? 0;\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n  public start(): void {\n    this._running = true;\n  }\n  public stop(): void {\n    this._running = false;\n  }\n\n  /**\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\n   * @param overrideUpdateMs\n   */\n  step(overrideUpdateMs?: number): void {\n    const time = overrideUpdateMs ?? this._updateMs;\n\n    if (this._running) {\n      // to be comparable to RAF this needs to be a full blown Task\n      // For example, images cannot decode synchronously in a single step\n      this.update(time);\n      this._currentTime += time;\n    } else {\n      this._logger.warn('The clock is not running, no step will be performed');\n    }\n  }\n\n  /**\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\n   * @param numberOfSteps\n   * @param overrideUpdateMs\n   */\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\n    for (let i = 0; i < numberOfSteps; i++) {\n      this.step(overrideUpdateMs ?? this._updateMs);\n    }\n  }\n}","import { EX_VERSION } from './';\nimport { Flags, Legacy } from './Flags';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Vector } from './Math/vector';\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\nimport { ScreenElement } from './ScreenElement';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Color';\nimport { Scene } from './Scene';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { Debug, DebugStats } from './Debug/Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Events from './Events';\nimport { BrowserEvents } from './Util/Browser';\nimport { obsolete } from './Util/Decorators';\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL, TextureLoader } from './Graphics';\nimport { PointerEventReceiver } from './Input/PointerEventReceiver';\nimport { FpsSampler } from './Util/Fps';\nimport { Clock, StandardClock } from './Util/Clock';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the width of the viewport in css pixels\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the height of the viewport in css pixels\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the width & height of the viewport in css pixels.\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\n   */\n  viewport?: ScreenDimension;\n\n  /**\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\n   * See [[Resolution]] for common presets.\n   */\n  resolution?: ScreenDimension;\n\n  /**\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\n   *\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\n   * with [[ImageFiltering.Blended]]\n   *\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\n   * with [[ImageFiltering.Pixel]]\n   */\n  antialiasing?: boolean;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * Optionally specify the target canvas DOM element directly\n   */\n  canvasElement?: HTMLCanvasElement;\n\n  /**\n   * Optionally snap drawings to nearest pixel\n   */\n  snapToPixel?: boolean;\n\n  /**\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\n   * Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  maxFps?: number;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   * Excalibur browser events abstraction used for wiring to native browser events safely\n   */\n  public browser: BrowserEvents;\n\n  /**\n   * Screen abstraction\n   */\n  public screen: Screen;\n\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   * @deprecated Will be removed in v0.26.0, use Engine.graphicsContext\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\n   */\n  public graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  public maxFps: number = Number.POSITIVE_INFINITY;\n\n  /**\n   * Direct access to the excalibur clock\n   */\n  public clock: Clock;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.screen.canvasWidth;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.screen.halfCanvasWidth;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.screen.canvasHeight;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.screen.halfCanvasHeight;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    return this.screen.drawWidth;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.screen.halfDrawWidth;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    return this.screen.drawHeight;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.screen.halfDrawHeight;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.screen.isHiDpi;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   *\n   * Useful when you want to debug different aspects of built in engine features like\n   *   * Transform\n   *   * Graphics\n   *   * Colliders\n   */\n  public debug: Debug;\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public readonly rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public readonly scenes: { [key: string]: Scene } = {};\n\n  /**\n   * @hidden\n   * @deprecated will be removed in v0.26.0\n   */\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public get isFullscreen(): boolean {\n    return this.screen.isFullScreen;\n  }\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public get displayMode(): DisplayMode {\n    return this.screen.displayMode;\n  }\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    return this.screen.pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   * @deprecated will be removed in v0.26.0\n   */\n  public position: string | AbsolutePosition;\n\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  private _isDebug: boolean = false;\n  public get isDebug(): boolean {\n    return this._isDebug;\n  }\n\n  /**\n   * No longer used\n   * @deprecated will be removed in v0.26.0\n   */\n  public debugColor: Color = new Color(255, 255, 255);\n\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * Hints the graphics context to truncate fractional world space coordinates\n   */\n  public get snapToPixel(): boolean {\n    return this.graphicsContext.snapToPixel;\n  };\n\n  public set snapToPixel(shouldSnapToPixel: boolean) {\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\n  };\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: Loader;\n\n  private _isInitialized: boolean = false;\n\n  private _deferredGoTo: string = null;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    canvasElement: undefined,\n    snapToPixel: false,\n    pointerScope: Input.PointerScope.Canvas,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\n\n    Flags.freeze();\n\n    // Initialize browser events facade\n    this.browser = new BrowserEvents(window, document);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function (test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    // eslint-disable-next-line no-console\n    if (console.log && !options.suppressConsoleBootMessage) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      // eslint-disable-next-line no-console\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      // eslint-disable-next-line no-console\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else if (options.canvasElement) {\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\n      this.canvas = options.canvasElement;\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\n    if ((options.width && options.height) || options.viewport) {\n      if (options.displayMode === undefined) {\n        displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fit');\n      displayMode = DisplayMode.FitScreen;\n    }\n\n    if (Flags.isEnabled(Legacy.Canvas)) {\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = ex2dCtx;\n      this.ctx = ex2dCtx.__ctx;\n    } else {\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = exWebglCtx;\n      this.ctx = exWebglCtx.__ctx;\n    }\n\n    this.screen = new Screen({\n      canvas: this.canvas,\n      context: this.graphicsContext,\n      antialiasing: options.antialiasing ?? true,\n      browser: this.browser,\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\n      resolution: options.resolution,\n      displayMode,\n      position: options.position,\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\n    });\n\n    TextureLoader.filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.maxFps = options.maxFps ?? this.maxFps;\n\n    this.clock = new StandardClock({\n      maxFps: this.maxFps,\n      tick: this._mainloop.bind(this),\n      onFatalException: (e) => this.onFatalException(e)\n    });\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n    this._loader.wireEngine(this);\n    this.debug = new Debug(this);\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene();\n\n    this.addScene('root', this.rootScene);\n    (window as any).___EXCALIBUR_DEVTOOL = this;\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    return this.screen.getWorldBounds();\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   * @deprecated\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\n   * ScreenElements do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n      return;\n    }\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\n      this.scenes[this._deferredGoTo].add(entity);\n    } else {\n      this.currentScene.add(entity);\n    }\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.currentScene.remove(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string): void {\n    // if not yet initialized defer goToScene\n    if (!this.isInitialized) {\n      this._deferredGoTo = key;\n      return;\n    }\n\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n      this.screen.setCurrentCamera(newScene.camera);\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    return this.screen.screenToWorldCoordinates(point);\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    return this.screen.worldToScreenCoordinates(point);\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // initialize inputs\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new PointerEventReceiver(pointerTarget, this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init();\n    this.input.gamepads.init();\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    this.browser.document.on(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    if (!this.canvasElementId && !options.canvasElement) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this.screen.antialiasing = isSmooth;\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    return this.screen.antialiasing;\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n      if (this._deferredGoTo) {\n        this.goToScene(this._deferredGoTo);\n      } else {\n        this.goToScene('root');\n      }\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (!this.ready) {\n      // suspend updates until loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.gamepads.update();\n      return;\n    }\n\n\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    // TODO remove\n    this._animations = this._animations.filter(function (a) {\n      return !a.animation.isDone();\n    });\n\n    // Publish update event\n    this._postupdate(delta);\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.gamepads.update();\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this.graphicsContext.beginDrawLifecycle();\n    this.graphicsContext.clear();\n    this._predraw(ctx, delta);\n\n    // Drawing nothing else while loading\n    if (!this._isReady) {\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\n      this.graphicsContext.flush();\n      return;\n    }\n\n    // TODO move to graphics systems?\n    this.graphicsContext.backgroundColor = this.backgroundColor;\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    // TODO don't access ctx directly\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    this._postdraw(ctx, delta);\n\n    // Flush any pending drawings\n    this.graphicsContext.flush();\n    this.graphicsContext.endDrawLifecycle();\n\n    this._checkForScreenShots();\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Enable or disable Excalibur debugging functionality.\n   * @param toggle a value that debug drawing will be changed to\n   */\n  public showDebug(toggle: boolean): void {\n    this._isDebug = toggle;\n  }\n\n  /**\n   * Toggle Excalibur debugging functionality.\n   */\n  public toggleDebug(): boolean {\n    this._isDebug = !this._isDebug;\n    return this._isDebug;\n  }\n\n  private _loadingComplete: boolean = false;\n\n  /**\n   * Returns true when loading is totally complete and the player has clicked start\n   */\n  public get loadingComplete() {\n    return this._loadingComplete;\n  }\n\n  private _isReady = false;\n  public get ready() {\n    return this._isReady;\n  }\n  private _isReadyResolve: () => any;\n  private _isReadyPromise = new Promise<void>(resolve => {\n    this._isReadyResolve = resolve;\n  });\n  public isReady(): Promise<void> {\n    return this._isReadyPromise;\n  }\n\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   *\n   * Note: start() only resolves AFTER the user has clicked the play button\n   */\n  public async start(loader?: Loader): Promise<void> {\n    if (!this._compatible) {\n      throw new Error('Excalibur is incompatible with your browser');\n    }\n\n    // Wire loader if we have it\n    if (loader) {\n      // Push the current user entered resolution/viewport\n      this.screen.pushResolutionAndViewport();\n\n      // Configure resolution for loader, it expects resolution === viewport\n      this.screen.resolution = this.screen.viewport;\n      this.screen.applyResolutionAndViewport();\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n    }\n\n    // Start the excalibur clock which drives the mainloop\n    // has started is a slight misnomer, it's really mainloop started\n    this._logger.debug('Starting game clock...');\n    this.browser.resume();\n    this.clock.start();\n    this._logger.debug('Game clock started');\n\n    if (loader) {\n      await this.load(this._loader);\n      this._loadingComplete = true;\n\n      // reset back to previous user resolution/viewport\n      this.screen.popResolutionAndViewport();\n      this.screen.applyResolutionAndViewport();\n    }\n\n    this._loadingComplete = true;\n\n    // Initialize before ready\n    this._overrideInitialize(this);\n\n    this._isReady = true;\n\n    this._isReadyResolve();\n    this.emit('start', new GameStartEvent(this));\n    return this._isReadyPromise;\n  }\n\n  private _mainloop(elapsed: number) {\n    this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\n    const delta = elapsed * this.timescale;\n\n    // reset frame stats (reuse existing instances)\n    const frameId = this.stats.prevFrame.id + 1;\n    this.stats.currFrame.reset();\n    this.stats.currFrame.id = frameId;\n    this.stats.currFrame.delta = delta;\n    this.stats.currFrame.fps = this.clock.fpsSampler.fps;\n    GraphicsDiagnostics.clear();\n\n    const beforeUpdate = this.clock.now();\n    this._update(delta);\n    const afterUpdate = this.clock.now();\n    this._draw(delta);\n    const afterDraw = this.clock.now();\n\n    this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n    this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n    this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n\n    this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\n    this.stats.prevFrame.reset(this.stats.currFrame);\n  }\n\n  /**\n   *\n   * @param game\n   * @param raf\n   * @param nowFn\n   * @deprecated Use [[Clock]] to run the mainloop, will be removed in v0.26.0\n   */\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n    const fpsSampler = new FpsSampler({\n      nowFn,\n      initialFps: game.maxFps === Infinity ? 60 : game.maxFps\n    });\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        fpsSampler.start();\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = now - lastTime || 1; // first frame\n\n        // Constrain fps\n        const fpsInterval = game.maxFps === Number.POSITIVE_INFINITY ? 0 : 1000 / game.maxFps;\n        if (elapsed <= fpsInterval) {\n          return; // too fast 😎 skip this frame\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = fpsSampler.fps;\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        // if fps interval is not a multiple\n        if (fpsInterval > 0) {\n          lastTime = now - (elapsed % fpsInterval);\n        } else {\n          lastTime = now;\n        }\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n        fpsSampler.end();\n        game.stats.prevFrame.reset(game.stats.currFrame);\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this.clock.isRunning()) {\n      this.emit('stop', new GameStopEvent(this));\n      this.browser.pause();\n      this.clock.stop();\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   * @deprecated will be removed in v0.26.0, use isRunning()\n   */\n  public isPaused(): boolean {\n    return !this.clock.isRunning();\n  }\n\n  /**\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\n   */\n  public isRunning() {\n    return this.clock.isRunning();\n  }\n\n\n  private _screenShotRequests: { preserveHiDPIResolution: boolean, resolve: (image: HTMLImageElement) => void }[] = [];\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\n   */\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\n      this._screenShotRequests.push({preserveHiDPIResolution, resolve});\n    });\n    return screenShotPromise;\n  }\n\n  private _checkForScreenShots() {\n    // We must grab the draw buffer before we yield to the browser\n    // the draw buffer is cleared after compositing\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\n    for (const request of this._screenShotRequests) {\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\n      const screenshot = document.createElement('canvas');\n      screenshot.width = finalWidth;\n      screenshot.height = finalHeight;\n      const ctx = screenshot.getContext('2d');\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\n\n      const result = new Image();\n      const raw = screenshot.toDataURL('image/png');\n      result.src = raw;\n      request.resolve(result);\n    }\n    // Reset state\n    this._screenShotRequests.length = 0;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public async load(loader: Loadable<any>): Promise<void> {\n    try {\n      await loader.load();\n    } catch {\n      await Promise.resolve();\n    }\n  }\n}\n\n/**\n * @internal\n * @deprecated\n */\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: WebAudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n\nexport class NativeSoundProcessedEvent extends MediaEvent {\n  public data: string | AudioBuffer;\n\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\n    super(target, 'NativeSoundProcessedEvent');\n\n    this.data = this._processedData;\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Color';\nimport { vec, Vector } from './Math/vector';\nimport { Text } from './Graphics/Text';\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\nimport { obsolete } from './Util/Decorators';\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\nimport { Font } from './Graphics/Font';\nimport { Actor } from './Actor';\nimport { ActorArgs } from '.';\n\n/**\n * Option for creating a label\n */\nexport interface LabelOptions {\n  /**\n   * Specify the label text\n   */\n  text?: string;\n  /**\n   * Specify the color of the text (does not apply to SpriteFonts)\n   */\n  color?: Color;\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  /**\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\n   */\n  spriteFont?: SpriteFont | LegacySpriteFont;\n  /**\n   * Specify a custom font\n   */\n  font?: Font\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n */\nexport class Label extends Actor {\n  private _font: Font = new Font();\n  private _text: Text = new Text({ text: '', font: this._font });\n\n  public get font(): Font {\n    return this._font;\n  }\n\n  public set font(newFont: Font) {\n    this._font = newFont;\n    this._text.font = newFont;\n  }\n\n  /**\n   * The text to draw.\n   */\n  public get text(): string {\n    return this._text.text;\n  }\n\n  public set text(text: string) {\n    this._text.text = text;\n  }\n\n  public override get color(): Color {\n    return this._text.color;\n  }\n\n  public override set color(color: Color) {\n    if (this._text) {\n      this._text.color = color;\n    }\n  }\n\n  public get opacity(): number {\n    return this._text.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this._text.opacity = opacity;\n  }\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   * @deprecated Use [[Font.bold|Label.font.bold]]\n   */\n  @obsolete({\n    message: 'Label.bold will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.bold'\n  })\n  public get bold(): boolean {\n    return this.font.bold;\n  }\n\n  public set bold(isBold: boolean) {\n    this.font.bold = isBold;\n  }\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   * @deprecated Use [[Font.family|Label.font.family]]\n   */\n  @obsolete({\n    message: 'Label.fontFamily will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.family'\n  })\n  public get fontFamily(): string {\n    return this.font.family;\n  }\n\n  public set fontFamily(family: string) {\n    this.font.family = family;\n  }\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   * @deprecated Use [[Font.size|Label.font.size]]\n   */\n  @obsolete({\n    message: 'Label.fontSize will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.size'\n  })\n  public get fontSize(): number {\n    return this.font.size;\n  }\n\n  public set fontSize(sizeInUnit: number) {\n    this.font.size = sizeInUnit;\n  }\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   * @deprecated Use [[Font.style|Label.font.style]]\n   */\n  @obsolete({\n    message: 'Label.fontStyle will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.style'\n  })\n  public get fontStyle(): FontStyle {\n    return this.font.style;\n  }\n\n  public set fontStyle(style: FontStyle) {\n    this.font.style = style;\n  }\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   * @deprecated Use [[Font.unit|Label.font.unit]]\n   */\n  @obsolete({\n    message: 'Label.fontUnit will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.unit'\n  })\n  public get fontUnit(): FontUnit {\n    return this.font.unit;\n  }\n\n  public set fontUnit(unit: FontUnit) {\n    this.font.unit = unit;\n  }\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\n   */\n  @obsolete({\n    message: 'Label.textAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.textAlign'\n  })\n  public get textAlign(): TextAlign {\n    return this.font.textAlign;\n  }\n\n  public set textAlign(align: TextAlign) {\n    this.font.textAlign = align;\n  }\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\n   */\n  @obsolete({\n    message: 'Label.baseAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.baseAlign'\n  })\n  public get baseAlign(): BaseAlign {\n    return this.font.baseAlign;\n  }\n\n  public set baseAlign(align: BaseAlign) {\n    this.font.baseAlign = align;\n  }\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   * @deprecated The maxWidth constraint is gone\n   */\n  public maxWidth: number;\n\n  private _legacySpriteFont: LegacySpriteFont;\n  private _spriteFont: SpriteFont;\n  /**\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   * @deprecated Use [[SpriteFont]]\n   */\n  public get spriteFont(): LegacySpriteFont {\n    return this._legacySpriteFont;\n  }\n\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\n    if (sf) {\n      if (sf instanceof LegacySpriteFont) {\n        this._legacySpriteFont = sf;\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\n        this._text.font = this._spriteFont;\n        return;\n      }\n      this._spriteFont = sf;\n      this._text.font = this._spriteFont;\n    }\n  }\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   * @deprecated Use [[SpriteFont.spacing]]\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   * @deprecated Use Graphics.SpriteFont.caseInsensitive\n   */\n  public caseInsensitive: boolean = true;\n\n  private _graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Build a new label\n   * @param options\n   */\n  constructor(options?: LabelOptions & ActorArgs) {\n    super(options);\n    const {text, pos, x, y, spriteFont, font, color} = options;\n\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\n    this.text = text ?? this.text;\n    this.font = font ?? this.font;\n    this.spriteFont = spriteFont ?? this.spriteFont;\n    this._text.color = color ?? this.color;\n    const gfx = this.get(GraphicsComponent);\n    gfx.anchor = Vector.Zero;\n    gfx.use(this._text);\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    this._graphicsContext = engine.graphicsContext;\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   */\n  public getTextWidth(): number {\n    return this._text.width;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.setTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.useTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public useTextShadow(on: boolean) {\n    if (this.spriteFont) {\n      this.spriteFont.useTextShadow(on);\n    }\n  }\n\n  /**\n   * Clears the current text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public clearTextShadow() {\n    this.font.shadow = null;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   * @param _delta\n   */\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    const exctx = this._graphicsContext;\n    this._text.draw(exctx, 0, 0);\n  }\n}\n","import { BodyComponent, BoundingBox, Collider, ColliderComponent, CollisionType, Color, CompositeCollider, vec, Vector } from '..';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\nexport class IsometricTile extends Entity {\n  /**\n   * Indicates whether this tile is solid\n   */\n  public solid: boolean = false;\n\n  private _gfx: GraphicsComponent;\n  private _tileBounds = new BoundingBox();\n  private _graphics: Graphic[] = [];\n  public getGraphics(): readonly Graphic[] {\n    return this._graphics;\n  }\n  /**\n   * Tile graphics\n   */\n  public addGraphic(graphic: Graphic) {\n    this._graphics.push(graphic);\n    this._gfx.visible = true;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  private _recalculateBounds(): BoundingBox {\n    let bounds = this._tileBounds.clone();\n    for (const graphic of this._graphics) {\n      const offset = vec(\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\n    }\n    return bounds;\n  }\n\n  public removeGraphic(graphic: Graphic) {\n    const index = this._graphics.indexOf(graphic);\n    if (index > -1) {\n      this._graphics.splice(index, 1);\n    }\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  public clearGraphics() {\n    this._graphics.length = 0;\n    this._gfx.visible = false;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  /**\n   * Tile colliders\n   */\n  private _colliders: Collider[] = [];\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a collider to the IsometricTile\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the IsometricTile\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the IsometricTile\n   */\n  public clearColliders(): void {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Integer tile x coordinate\n   */\n  public readonly x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  public readonly y: number;\n  /**\n   * Reference to the [[IsometricMap]] this tile is part of\n   */\n  public readonly map: IsometricMap;\n\n  private _transform: TransformComponent;\n  private _isometricEntityComponent: IsometricEntityComponent;\n\n  /**\n   * Returns the top left corner of the [[IsometricTile]] in world space\n   */\n  public get pos(): Vector {\n    return this.map.tileToWorld(vec(this.x, this.y));\n  }\n\n  /**\n   * Returns the center of the [[IsometricTile]]\n   */\n  public get center(): Vector {\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\n  }\n\n  /**\n   * Construct a new IsometricTile\n   * @param x tile coordinate in x (not world position)\n   * @param y tile coordinate in y (not world position)\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\n   * @param map reference to owning IsometricMap\n   */\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\n    super([\n      new TransformComponent(),\n      new GraphicsComponent({\n        offset: graphicsOffset ?? Vector.Zero,\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\n      }),\n      new IsometricEntityComponent(map)\n    ]);\n    this.x = x;\n    this.y = y;\n    this.map = map;\n    this._transform = this.get(TransformComponent);\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\n\n    const halfTileWidth = this.map.tileWidth / 2;\n    const halfTileHeight = this.map.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    // The x position shifts left with every y step\n    const xPos = (this.x - this.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (this.x + this.y) * halfTileHeight;\n    this._transform.pos = vec(xPos, yPos);\n    this._isometricEntityComponent.elevation = 0;\n\n    this._gfx = this.get(GraphicsComponent);\n    this._gfx.visible = false; // start not visible\n    const totalWidth = this.map.tileWidth;\n    const totalHeight = this.map.tileHeight;\n\n    // initial guess at gfx bounds based on the tile\n    const offset = vec(0, (this.map.renderFromTopOfGraphic ? totalHeight : 0));\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\n      left: -totalWidth / 2,\n      top: -totalHeight,\n      right: totalWidth / 2,\n      bottom: totalHeight\n    }).translate(offset);\n  }\n\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\n    const halfTileWidth = this.map.tileWidth / 2;\n    gfx.save();\n    // shift left origin to corner of map, not the left corner of the first sprite\n    gfx.translate(-halfTileWidth, 0);\n    for (const graphic of this._graphics) {\n      graphic.draw(\n        gfx,\n        this.map.graphicsOffset.x,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n    }\n    gfx.restore();\n  }\n}\n\nexport interface IsometricMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\n   */\n  renderFromTopOfGraphic?: boolean;\n  /**\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\n   */\n  graphicsOffset?: Vector;\n  /**\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\n *\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\n *\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\n * your art assets.\n */\nexport class IsometricMap extends Entity {\n  /**\n   * Width of individual tile in pixels\n   */\n  public readonly tileWidth: number;\n  /**\n   * Height of individual tile in pixels\n   */\n  public readonly tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  public readonly width: number;\n  /**\n   * Number of tiles high\n   */\n  public readonly height: number;\n  /**\n   * List containing all of the tiles in IsometricMap\n   */\n  public readonly tiles: IsometricTile[];\n\n  /**\n   * Render the tile graphic from the top instead of the bottom\n   *\n   * default is `false` meaning rendering from the bottom\n   */\n  public renderFromTopOfGraphic: boolean = false;\n  public graphicsOffset: Vector = vec(0, 0);\n\n  /**\n   * Isometric map [[TransformComponent]]\n   */\n  public transform: TransformComponent;\n\n  /**\n   * Isometric map [[ColliderComponent]]\n   */\n  public collider: ColliderComponent;\n\n  private _composite: CompositeCollider;\n\n  constructor(options: IsometricMapOptions) {\n    super([\n      new TransformComponent(),\n      new BodyComponent({\n        type: CollisionType.Fixed\n      }),\n      new ColliderComponent(),\n      new DebugGraphicsComponent((ctx) => this.debug(ctx), false)\n    ], options.name);\n    const { pos, tileWidth, tileHeight, width, height, renderFromTopOfGraphic, graphicsOffset } = options;\n\n    this.transform = this.get(TransformComponent);\n    if (pos) {\n      this.transform.pos = pos;\n    }\n\n    this.collider = this.get(ColliderComponent);\n    if (this.collider) {\n      this.collider.set(this._composite = new CompositeCollider([]));\n    }\n\n\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\n\n    this.tileWidth = tileWidth;\n    this.tileHeight = tileHeight;\n    this.width = width;\n    this.height = height;\n\n    this.tiles = new Array(width * height);\n\n    // build up tile representation\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\n        this.tiles[x + y * width] = tile;\n        this.addChild(tile);\n        // TODO row/columns helpers\n      }\n    }\n  }\n\n  public update(): void {\n    if (this._collidersDirty) {\n      this.updateColliders();\n      this._collidersDirty = false;\n    }\n  }\n\n  private _collidersDirty = false;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  public updateColliders() {\n    this._composite.clearColliders();\n    for (const tile of this.tiles) {\n      if (tile.solid) {\n        for (const collider of tile.getColliders()) {\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\n            .add(originalOffset)\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\n          collider.owner = this;\n          this._composite.addCollider(collider);\n        }\n      }\n    }\n    this.collider.update();\n  }\n\n  /**\n   * Convert world space coordinates to the tile x, y coordinate\n   * @param worldCoordinate\n   */\n  public worldToTile(worldCoordinate: Vector): Vector {\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\n\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    return vec(\n      ~~((worldCoordinate.x / halfTileWidth + (worldCoordinate.y / halfTileHeight)) / 2),\n      ~~((worldCoordinate.y / halfTileHeight - (worldCoordinate.x / halfTileWidth)) / 2));\n  }\n\n  /**\n   * Given a tile coordinate, return the top left corner in world space\n   * @param tileCoordinate\n   */\n  public tileToWorld(tileCoordinate: Vector): Vector {\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // The x position shifts left with every y step\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\n    return vec(xPos, yPos).add(this.transform.pos);\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by its x and y coordinates\n   */\n  public getTile(x: number, y: number): IsometricTile | null {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): IsometricTile | null {\n    const tileCoord = this.worldToTile(point);\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\n    return tile;\n  }\n\n  /**\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\n   * @param gfx\n   */\n  public debug(gfx: ExcaliburGraphicsContext) {\n\n    for (let y = 0; y < this.height + 1; y++) {\n      const left = this.tileToWorld(vec(0, y));\n      const right = this.tileToWorld(vec(this.width, y));\n      gfx.drawLine(left, right, Color.Red, 2);\n    }\n\n    for (let x = 0; x < this.width + 1; x++) {\n      const top = this.tileToWorld(vec(x, 0));\n      const bottom = this.tileToWorld(vec(x, this.height));\n      gfx.drawLine(top, bottom, Color.Red, 2);\n    }\n\n    for (const tile of this.tiles) {\n      gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), 3, Color.Yellow);\n    }\n  }\n}","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @deprecated Use [[Polygon]]\n * @warning Use sparingly as Polygons are performance intensive\n */\n@obsolete({\n  message: 'Polygon will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Polygon'\n})\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = Vector.Zero;\n  public offset = Vector.Zero;\n  public rotation: number = 0;\n  public scale = Vector.One;\n  public opacity: number = 1;\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\n    };\n\n    const xpoint = drawWidth * anchor.x + offset.x + x;\n    const ypoint = drawHeight * anchor.y + offset.y + y;\n\n    ctx.save();\n    ctx.translate(xpoint, ypoint);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    ctx.stroke();\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n}\n","import { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Engine } from './../Engine';\nimport * as Events from './../Events';\nimport { Scene } from '../Scene';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _initialize {\n  _initialize(engine: Engine): void;\n}\n\n/**\n * Type guard checking for internal initialize method\n * @internal\n * @param a\n */\nexport function has_initialize(a: any): a is _initialize {\n  return !!a._initialize;\n}\n\nexport interface OnInitialize {\n  onInitialize(engine: Engine): void;\n}\n\n/**\n *\n */\nexport function hasOnInitialize(a: any): a is OnInitialize {\n  return !!a.onInitialize;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _preupdate {\n  _preupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_preupdate(a: any): a is _preupdate {\n  return !!a._preupdate;\n}\n\nexport interface OnPreUpdate {\n  onPreUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\n  return !!a.onPreUpdate;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _postupdate {\n  _postupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_postupdate(a: any): a is _postupdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface OnPostUpdate {\n  onPostUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface CanInitialize {\n  /**\n   * Overridable implementation\n   */\n  onInitialize(_engine: Engine): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\n}\n\nexport interface CanActivate {\n  /**\n   * Overridable implementation\n   */\n  onActivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\n}\n\nexport interface CanDeactivate {\n  /**\n   * Overridable implementation\n   */\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\n}\n\nexport interface CanUpdate {\n  /**\n   * Overridable implementation\n   */\n  onPreUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\n}\n\nexport interface OnPreDraw {\n  /**\n   * Overridable implementation\n   */\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n}\n\nexport interface OnPostDraw {\n  /**\n   * Overridable implementation\n   */\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\n/**\n *\n */\nexport function hasPreDraw(a: any): a is OnPreDraw {\n  return !!a.onPreDraw;\n}\n\n/**\n *\n */\nexport function hasPostDraw(a: any): a is OnPostDraw {\n  return !!a.onPostDraw;\n}\n\nexport interface CanBeKilled {\n  /**\n   * Overridable implementation\n   */\n  onPreKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport { clamp } from '../../Math/util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\nexport class WebAudioInstance implements Audio {\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n\n  private _playingPromise: Promise<boolean>;\n  private _playingResolve: (value: boolean) => void;\n\n  private _loop = false;\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    value = clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant transition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public set duration(value: number | undefined) {\n    this._duration = value;\n  }\n\n  /**\n   * Duration of the sound, in seconds.\n   */\n  public get duration() {\n    return this._duration;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  private _isPlaying = false;\n  private _isPaused = false;\n  private _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(private _src: AudioBuffer) {\n    this._createNewBufferSource();\n  }\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public play(playStarted: () => any = () => {}) {\n    if (this._isPaused) {\n      this._resumePlayBack();\n      playStarted();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n      playStarted();\n    }\n\n    return this._playingPromise;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  private _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>((resolve) => {\n      this._playingResolve = resolve;\n    });\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._wireUpOnEnded();\n  }\n\n  private _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  private _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  private _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingResolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { WebAudioInstance } from './WebAudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\nimport { canPlayFile } from '../../Util/Sound';\nimport { Loadable } from '../../Interfaces/Index';\nimport { Logger } from '../../Util/Log';\nimport { Class } from '../../Class';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n */\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\n  public logger: Logger = Logger.getInstance();\n  public data: AudioBuffer;\n  private _resource: Resource<ArrayBuffer>;\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public get duration(): number | undefined {\n    return this._duration;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): Audio[] {\n    return this._tracks;\n  }\n\n  public get path() {\n    return this._resource.path;\n  }\n\n  public set path(val: string) {\n    this._resource.path = val;\n  }\n\n  private _loop = false;\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n  private _isStopped = false;\n  private _isPaused = false;\n  private _tracks: Audio[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super();\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\n    /**\n     * Chrome : MP3, WAV, Ogg\n     * Firefox : WAV, Ogg,\n     * IE : MP3, WAV coming soon\n     * Safari MP3, WAV, Ogg\n     */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  public async load(): Promise<AudioBuffer> {\n    if (this.data) {\n      return this.data;\n    }\n    const arraybuffer = await this._resource.load();\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\n    return this.data = audiobuffer;\n  }\n\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\n    try {\n      return await this._audioContext.decodeAudioData(data.slice(0));\n    } catch (e) {\n      this.logger.error(\n        'Unable to decode ' +\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\n          'if this is an mp3 try removing id3 tags and album art from the file.'\n      );\n      return await Promise.reject();\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n\n      this._engine.on('start', () => {\n        this._isStopped = false;\n      });\n\n      this._engine.on('stop', () => {\n        this.stop();\n        this._isStopped = true;\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    if (this._isStopped) {\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n      return Promise.resolve(false);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n   */\n  public stop() {\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[Audio]] which Id is to be given\n   */\n  public getTrackId(track: Audio): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private async _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed: Promise<boolean>[] = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      await Promise.all(resumed);\n    }\n    return true;\n  }\n\n  /**\n   * Starts playback, returns a promise that resolves when playback is complete\n   */\n  private async _startPlayback(): Promise<boolean> {\n    const track = await this._getTrackInstance(this.data);\n\n    const complete = await track.play(() => {\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    // when done, remove track\n    this.emit('playbackend', new NativeSoundEvent(this, track));\n    this._tracks.splice(this.getTrackId(track), 1);\n\n    return complete;\n  }\n\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\n    const newTrack = new WebAudioInstance(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n    newTrack.duration = this.duration;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n}\n","import { Resource } from './Resource';\nimport { Sprite } from '../Graphics/Sprite';\nimport { Color } from '../Color';\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\nimport { Animation } from '../Graphics/Animation';\nimport { Engine } from '../Engine';\nimport { Loadable } from '../Interfaces/Index';\nimport { ImageSource } from '../Graphics/ImageSource';\nimport { LegacyDrawing } from '..';\nimport { range } from '../Math/util';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n */\nexport class Gif implements Loadable<ImageSource[]> {\n  private _resource: Resource<ArrayBuffer>;\n\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _textures: ImageSource[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n\n  public data: ImageSource[];\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<ImageSource[]> {\n    const arraybuffer = await this._resource.load();\n    this._stream = new Stream(arraybuffer);\n    this._gif = new ParseGif(this._stream, this._transparentColor);\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\n\n    // Load all textures\n    await Promise.all(images.map(t => t.load()));\n    return this.data = this._textures = images;\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  /**\n   * Return a frame of the gif as a legacy sprite by index\n   * @deprecated\n   */\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\n    return Sprite.toLegacySprite(this.toSprite(id));\n  }\n\n  /**\n   * Return the gif as a legacy spritesheet\n   * @deprecated\n   */\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\n  }\n\n  /**\n   * Return the gif as a legacy animation\n   * @deprecated\n   * @param engine\n   * @param speed\n   */\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\n  }\n\n  /**\n   * Return a frame of the gif as a sprite by id\n   * @param id\n   */\n  public toSprite(id: number = 0): Sprite {\n    const sprite = this._textures[id].toSprite();\n    return sprite;\n  }\n\n  /**\n   * Return the gif as a spritesheet\n   */\n  public toSpriteSheet(): SpriteSheet {\n    const sprites: Sprite[] = this._textures.map((image) => {\n      return image.toSprite();\n    });\n    return new SpriteSheet({ sprites });\n  }\n\n  /**\n   * Transform the GIF into an animation with duration per frame\n   */\n  public toAnimation(durationPerFrameMs: number): Animation {\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\n    const length = spriteSheet.sprites.length;\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface GifFrame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function (s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function (minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function (size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function () {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: GifFrame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: GifFrame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","import { ImageFiltering } from '.';\nimport { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n *\n * Polygons default to [[ImageFiltering.Blended]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.filtering = ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\n\n/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\nexport class SortedList<T> {\n  private _getComparable: (item: T) => number;\n  private _root: BinaryTreeNode<T>;\n\n  constructor(getComparable: (item: T) => number) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: T): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: T): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\n    if (node != null) {\n      if (this._getComparable(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: T): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (element.getKey() < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<T>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach((element) => {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\nexport class BinaryTreeNode<T> {\n  private _key: number;\n  private _data: Array<T>;\n  private _left: BinaryTreeNode<T>;\n  private _right: BinaryTreeNode<T>;\n\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): T[] {\n    return this._data;\n  }\n\n  public setData(data: T[]) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode<T> {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode<T>) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode<T> {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode<T>) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n * @deprecated Will be removed in v0.26.0\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","import { Logger } from '..';\nexport class Pool<Type> {\n  public totalAllocations = 0;\n  public index = 0;\n  public objects: Type[] = [];\n  private _logger = Logger.getInstance();\n\n  constructor(\n    public builder: (...args: any[]) => Type,\n    public recycler: (instance: Type, ...args: any[]) => Type,\n    public maxObjects: number = 100\n  ) {}\n\n  /**\n   * Use many instances out of the in the context and return all to the pool.\n   *\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\n   * @param context\n   */\n  using(context: (pool: Pool<Type>) => Type[] | void) {\n    const result = context(this);\n    if (result) {\n      return this.done(...result);\n    }\n    return this.done();\n  }\n\n  /**\n   * Use a single instance out of th pool and immediately return it to the pool\n   * @param context\n   */\n  borrow(context: (object: Type) => void) {\n    const object = this.get();\n    context(object);\n    this.index--;\n  }\n\n  /**\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\n   * @param args\n   */\n  get(...args: any[]): Type {\n    if (this.index === this.maxObjects) {\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\n      this.maxObjects = this.maxObjects * 2;\n    }\n\n    if (this.objects[this.index]) {\n      // Pool has an available object already constructed\n      return this.recycler(this.objects[this.index++], ...args);\n    } else {\n      // New allocation\n      this.totalAllocations++;\n      const object = (this.objects[this.index++] = this.builder(...args));\n      return object;\n    }\n  }\n\n  /**\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\n   *\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\n   * to be passed to consumers\n   * @param objects A list of object to separate from the pool\n   */\n  done(...objects: Type[]): Type[];\n  done(): void;\n  done(...objects: Type[]): Type[] | void {\n    // All objects in pool now considered \"free\"\n    this.index = 0;\n    for (const object of objects) {\n      const poolIndex = this.objects.indexOf(object);\n      // Build a new object to take the pool place\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\n      this.totalAllocations++;\n    }\n    return objects;\n  }\n}\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Valid states for a promise to be in\n * @deprecated Will be removed in v0.26.0\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\n/**\n * @deprecated Will be removed in v0.26.0\n */\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\n  alternateMethod: 'Use browser native promises'\n})\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   * @deprecated Use browser native promises\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   * @deprecated Use browser native promises\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   * @deprecated Use browser native promises\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resolved call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   * @deprecated Use browser native promises\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   * @deprecated Use browser native promises\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   * @deprecated Use browser native promises\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   * @deprecated Use browser native promises\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport const EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\nexport * from './Flags';\nexport * from './Id';\nexport * from './Engine';\nexport * from './Screen';\nexport { Actor, ActorArgs } from './Actor';\nexport * from './Math/Index';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug/index';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport * from './Label';\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Collision/Physics';\nexport * from './Scene';\n\nexport * from './TileMap/index';\n\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './ScreenElement';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\n\n// ex.LegacyDrawing namespace\nimport * as legacyDrawing from './Drawing/Index';\nexport { legacyDrawing as LegacyDrawing };\nexport * from './Interfaces/Index';\nexport * from './Resources/Index';\n\nexport * from './EntityComponentSystem/index';\n\nexport * from './Color';\n\nexport * from './Graphics/index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\nexport { PointerComponent } from './Input/Index';\nexport { PointerSystem } from './Input/PointerSystem';\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Browser';\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Observable';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\nexport * from './Util/Pool';\nexport * from './Util/Fps';\nexport * from './Util/Clock';\nexport * from './Util/WebAudio';\n\n// ex.Deprecated\nexport * from './Promises';\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n","var util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'localStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nfunction localStorage() {\n\treturn Global.localStorage\n}\n\nfunction read(key) {\n\treturn localStorage().getItem(key)\n}\n\nfunction write(key, data) {\n\treturn localStorage().setItem(key, data)\n}\n\nfunction each(fn) {\n\tfor (var i = localStorage().length - 1; i >= 0; i--) {\n\t\tvar key = localStorage().key(i)\n\t\tfn(read(key), key)\n\t}\n}\n\nfunction remove(key) {\n\treturn localStorage().removeItem(key)\n}\n\nfunction clearAll() {\n\treturn localStorage().clear()\n}\n","var assign = make_assign()\nvar create = make_create()\nvar trim = make_trim()\nvar Global = (typeof window !== 'undefined' ? window : global)\n\nmodule.exports = {\n\tassign: assign,\n\tcreate: create,\n\ttrim: trim,\n\tbind: bind,\n\tslice: slice,\n\teach: each,\n\tmap: map,\n\tpluck: pluck,\n\tisList: isList,\n\tisFunction: isFunction,\n\tisObject: isObject,\n\tGlobal: Global\n}\n\nfunction make_assign() {\n\tif (Object.assign) {\n\t\treturn Object.assign\n\t} else {\n\t\treturn function shimAssign(obj, props1, props2, etc) {\n\t\t\tfor (var i = 1; i < arguments.length; i++) {\n\t\t\t\teach(Object(arguments[i]), function(val, key) {\n\t\t\t\t\tobj[key] = val\n\t\t\t\t})\n\t\t\t}\t\t\t\n\t\t\treturn obj\n\t\t}\n\t}\n}\n\nfunction make_create() {\n\tif (Object.create) {\n\t\treturn function create(obj, assignProps1, assignProps2, etc) {\n\t\t\tvar assignArgsList = slice(arguments, 1)\n\t\t\treturn assign.apply(this, [Object.create(obj)].concat(assignArgsList))\n\t\t}\n\t} else {\n\t\tfunction F() {} // eslint-disable-line no-inner-declarations\n\t\treturn function create(obj, assignProps1, assignProps2, etc) {\n\t\t\tvar assignArgsList = slice(arguments, 1)\n\t\t\tF.prototype = obj\n\t\t\treturn assign.apply(this, [new F()].concat(assignArgsList))\n\t\t}\n\t}\n}\n\nfunction make_trim() {\n\tif (String.prototype.trim) {\n\t\treturn function trim(str) {\n\t\t\treturn String.prototype.trim.call(str)\n\t\t}\n\t} else {\n\t\treturn function trim(str) {\n\t\t\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n\t\t}\n\t}\n}\n\nfunction bind(obj, fn) {\n\treturn function() {\n\t\treturn fn.apply(obj, Array.prototype.slice.call(arguments, 0))\n\t}\n}\n\nfunction slice(arr, index) {\n\treturn Array.prototype.slice.call(arr, index || 0)\n}\n\nfunction each(obj, fn) {\n\tpluck(obj, function(val, key) {\n\t\tfn(val, key)\n\t\treturn false\n\t})\n}\n\nfunction map(obj, fn) {\n\tvar res = (isList(obj) ? [] : {})\n\tpluck(obj, function(v, k) {\n\t\tres[k] = fn(v, k)\n\t\treturn false\n\t})\n\treturn res\n}\n\nfunction pluck(obj, fn) {\n\tif (isList(obj)) {\n\t\tfor (var i=0; i<obj.length; i++) {\n\t\t\tif (fn(obj[i], i)) {\n\t\t\t\treturn obj[i]\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var key in obj) {\n\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\tif (fn(obj[key], key)) {\n\t\t\t\t\treturn obj[key]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction isList(val) {\n\treturn (val != null && typeof val != 'function' && typeof val.length == 'number')\n}\n\nfunction isFunction(val) {\n\treturn val && {}.toString.call(val) === '[object Function]'\n}\n\nfunction isObject(val) {\n\treturn val && {}.toString.call(val) === '[object Object]'\n}\n","// oldFF-globalStorage provides storage for Firefox\n// versions 6 and 7, where no localStorage, etc\n// is available.\n\nvar util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'oldFF-globalStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar globalStorage = Global.globalStorage\n\nfunction read(key) {\n\treturn globalStorage[key]\n}\n\nfunction write(key, data) {\n\tglobalStorage[key] = data\n}\n\nfunction each(fn) {\n\tfor (var i = globalStorage.length - 1; i >= 0; i--) {\n\t\tvar key = globalStorage.key(i)\n\t\tfn(globalStorage[key], key)\n\t}\n}\n\nfunction remove(key) {\n\treturn globalStorage.removeItem(key)\n}\n\nfunction clearAll() {\n\teach(function(key, _) {\n\t\tdelete globalStorage[key]\n\t})\n}\n","// oldIE-userDataStorage provides storage for Internet Explorer\n// versions 6 and 7, where no localStorage, sessionStorage, etc\n// is available.\n\nvar util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'oldIE-userDataStorage',\n\twrite: write,\n\tread: read,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar storageName = 'storejs'\nvar doc = Global.document\nvar _withStorageEl = _makeIEStorageElFunction()\nvar disable = (Global.navigator ? Global.navigator.userAgent : '').match(/ (MSIE 8|MSIE 9|MSIE 10)\\./) // MSIE 9.x, MSIE 10.x\n\nfunction write(unfixedKey, data) {\n\tif (disable) { return }\n\tvar fixedKey = fixKey(unfixedKey)\n\t_withStorageEl(function(storageEl) {\n\t\tstorageEl.setAttribute(fixedKey, data)\n\t\tstorageEl.save(storageName)\n\t})\n}\n\nfunction read(unfixedKey) {\n\tif (disable) { return }\n\tvar fixedKey = fixKey(unfixedKey)\n\tvar res = null\n\t_withStorageEl(function(storageEl) {\n\t\tres = storageEl.getAttribute(fixedKey)\n\t})\n\treturn res\n}\n\nfunction each(callback) {\n\t_withStorageEl(function(storageEl) {\n\t\tvar attributes = storageEl.XMLDocument.documentElement.attributes\n\t\tfor (var i=attributes.length-1; i>=0; i--) {\n\t\t\tvar attr = attributes[i]\n\t\t\tcallback(storageEl.getAttribute(attr.name), attr.name)\n\t\t}\n\t})\n}\n\nfunction remove(unfixedKey) {\n\tvar fixedKey = fixKey(unfixedKey)\n\t_withStorageEl(function(storageEl) {\n\t\tstorageEl.removeAttribute(fixedKey)\n\t\tstorageEl.save(storageName)\n\t})\n}\n\nfunction clearAll() {\n\t_withStorageEl(function(storageEl) {\n\t\tvar attributes = storageEl.XMLDocument.documentElement.attributes\n\t\tstorageEl.load(storageName)\n\t\tfor (var i=attributes.length-1; i>=0; i--) {\n\t\t\tstorageEl.removeAttribute(attributes[i].name)\n\t\t}\n\t\tstorageEl.save(storageName)\n\t})\n}\n\n// Helpers\n//////////\n\n// In IE7, keys cannot start with a digit or contain certain chars.\n// See https://github.com/marcuswestin/store.js/issues/40\n// See https://github.com/marcuswestin/store.js/issues/83\nvar forbiddenCharsRegex = new RegExp(\"[!\\\"#$%&'()*+,/\\\\\\\\:;<=>?@[\\\\]^`{|}~]\", \"g\")\nfunction fixKey(key) {\n\treturn key.replace(/^\\d/, '___$&').replace(forbiddenCharsRegex, '___')\n}\n\nfunction _makeIEStorageElFunction() {\n\tif (!doc || !doc.documentElement || !doc.documentElement.addBehavior) {\n\t\treturn null\n\t}\n\tvar scriptTag = 'script',\n\t\tstorageOwner,\n\t\tstorageContainer,\n\t\tstorageEl\n\n\t// Since #userData storage applies only to specific paths, we need to\n\t// somehow link our data to a specific path.  We choose /favicon.ico\n\t// as a pretty safe option, since all browsers already make a request to\n\t// this URL anyway and being a 404 will not hurt us here.  We wrap an\n\t// iframe pointing to the favicon in an ActiveXObject(htmlfile) object\n\t// (see: http://msdn.microsoft.com/en-us/library/aa752574(v=VS.85).aspx)\n\t// since the iframe access rules appear to allow direct access and\n\t// manipulation of the document element, even for a 404 page.  This\n\t// document can be used instead of the current document (which would\n\t// have been limited to the current path) to perform #userData storage.\n\ttry {\n\t\t/* global ActiveXObject */\n\t\tstorageContainer = new ActiveXObject('htmlfile')\n\t\tstorageContainer.open()\n\t\tstorageContainer.write('<'+scriptTag+'>document.w=window</'+scriptTag+'><iframe src=\"/favicon.ico\"></iframe>')\n\t\tstorageContainer.close()\n\t\tstorageOwner = storageContainer.w.frames[0].document\n\t\tstorageEl = storageOwner.createElement('div')\n\t} catch(e) {\n\t\t// somehow ActiveXObject instantiation failed (perhaps some special\n\t\t// security settings or otherwse), fall back to per-path storage\n\t\tstorageEl = doc.createElement('div')\n\t\tstorageOwner = doc.body\n\t}\n\n\treturn function(storeFunction) {\n\t\tvar args = [].slice.call(arguments, 0)\n\t\targs.unshift(storageEl)\n\t\t// See http://msdn.microsoft.com/en-us/library/ms531081(v=VS.85).aspx\n\t\t// and http://msdn.microsoft.com/en-us/library/ms531424(v=VS.85).aspx\n\t\tstorageOwner.appendChild(storageEl)\n\t\tstorageEl.addBehavior('#default#userData')\n\t\tstorageEl.load(storageName)\n\t\tstoreFunction.apply(this, args)\n\t\tstorageOwner.removeChild(storageEl)\n\t\treturn\n\t}\n}\n","// cookieStorage is useful Safari private browser mode, where localStorage\n// doesn't work but cookies do. This implementation is adopted from\n// https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage\n\nvar util = require('../src/util')\nvar Global = util.Global\nvar trim = util.trim\n\nmodule.exports = {\n\tname: 'cookieStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar doc = Global.document\n\nfunction read(key) {\n\tif (!key || !_has(key)) { return null }\n\tvar regexpStr = \"(?:^|.*;\\\\s*)\" +\n\t\tescape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") +\n\t\t\"\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*\"\n\treturn unescape(doc.cookie.replace(new RegExp(regexpStr), \"$1\"))\n}\n\nfunction each(callback) {\n\tvar cookies = doc.cookie.split(/; ?/g)\n\tfor (var i = cookies.length - 1; i >= 0; i--) {\n\t\tif (!trim(cookies[i])) {\n\t\t\tcontinue\n\t\t}\n\t\tvar kvp = cookies[i].split('=')\n\t\tvar key = unescape(kvp[0])\n\t\tvar val = unescape(kvp[1])\n\t\tcallback(val, key)\n\t}\n}\n\nfunction write(key, data) {\n\tif(!key) { return }\n\tdoc.cookie = escape(key) + \"=\" + escape(data) + \"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/\"\n}\n\nfunction remove(key) {\n\tif (!key || !_has(key)) {\n\t\treturn\n\t}\n\tdoc.cookie = escape(key) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/\"\n}\n\nfunction clearAll() {\n\teach(function(_, key) {\n\t\tremove(key)\n\t})\n}\n\nfunction _has(key) {\n\treturn (new RegExp(\"(?:^|;\\\\s*)\" + escape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\")).test(doc.cookie)\n}\n","var util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'sessionStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll\n}\n\nfunction sessionStorage() {\n\treturn Global.sessionStorage\n}\n\nfunction read(key) {\n\treturn sessionStorage().getItem(key)\n}\n\nfunction write(key, data) {\n\treturn sessionStorage().setItem(key, data)\n}\n\nfunction each(fn) {\n\tfor (var i = sessionStorage().length - 1; i >= 0; i--) {\n\t\tvar key = sessionStorage().key(i)\n\t\tfn(read(key), key)\n\t}\n}\n\nfunction remove(key) {\n\treturn sessionStorage().removeItem(key)\n}\n\nfunction clearAll() {\n\treturn sessionStorage().clear()\n}\n","// memoryStorage is a useful last fallback to ensure that the store\n// is functions (meaning store.get(), store.set(), etc will all function).\n// However, stored values will not persist when the browser navigates to\n// a new page or reloads the current page.\n\nmodule.exports = {\n\tname: 'memoryStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar memoryStorage = {}\n\nfunction read(key) {\n\treturn memoryStorage[key]\n}\n\nfunction write(key, data) {\n\tmemoryStorage[key] = data\n}\n\nfunction each(callback) {\n\tfor (var key in memoryStorage) {\n\t\tif (memoryStorage.hasOwnProperty(key)) {\n\t\t\tcallback(memoryStorage[key], key)\n\t\t}\n\t}\n}\n\nfunction remove(key) {\n\tdelete memoryStorage[key]\n}\n\nfunction clearAll(key) {\n\tmemoryStorage = {}\n}\n","module.exports = json2Plugin\n\nfunction json2Plugin() {\n\trequire('./lib/json2')\n\treturn {}\n}\n","/* eslint-disable */\n\n//  json2.js\n//  2016-10-28\n//  Public Domain.\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n//  See http://www.JSON.org/js.html\n//  This code should be minified before deployment.\n//  See http://javascript.crockford.com/jsmin.html\n\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n//  NOT CONTROL.\n\n//  This file creates a global JSON object containing two methods: stringify\n//  and parse. This file provides the ES5 JSON capability to ES3 systems.\n//  If a project might run on IE8 or earlier, then this file should be included.\n//  This file does nothing on ES5 systems.\n\n//      JSON.stringify(value, replacer, space)\n//          value       any JavaScript value, usually an object or array.\n//          replacer    an optional parameter that determines how object\n//                      values are stringified for objects. It can be a\n//                      function or an array of strings.\n//          space       an optional parameter that specifies the indentation\n//                      of nested structures. If it is omitted, the text will\n//                      be packed without extra whitespace. If it is a number,\n//                      it will specify the number of spaces to indent at each\n//                      level. If it is a string (such as \"\\t\" or \"&nbsp;\"),\n//                      it contains the characters used to indent at each level.\n//          This method produces a JSON text from a JavaScript value.\n//          When an object value is found, if the object contains a toJSON\n//          method, its toJSON method will be called and the result will be\n//          stringified. A toJSON method does not serialize: it returns the\n//          value represented by the name/value pair that should be serialized,\n//          or undefined if nothing should be serialized. The toJSON method\n//          will be passed the key associated with the value, and this will be\n//          bound to the value.\n\n//          For example, this would serialize Dates as ISO strings.\n\n//              Date.prototype.toJSON = function (key) {\n//                  function f(n) {\n//                      // Format integers to have at least two digits.\n//                      return (n < 10)\n//                          ? \"0\" + n\n//                          : n;\n//                  }\n//                  return this.getUTCFullYear()   + \"-\" +\n//                       f(this.getUTCMonth() + 1) + \"-\" +\n//                       f(this.getUTCDate())      + \"T\" +\n//                       f(this.getUTCHours())     + \":\" +\n//                       f(this.getUTCMinutes())   + \":\" +\n//                       f(this.getUTCSeconds())   + \"Z\";\n//              };\n\n//          You can provide an optional replacer method. It will be passed the\n//          key and value of each member, with this bound to the containing\n//          object. The value that is returned from your method will be\n//          serialized. If your method returns undefined, then the member will\n//          be excluded from the serialization.\n\n//          If the replacer parameter is an array of strings, then it will be\n//          used to select the members to be serialized. It filters the results\n//          such that only members with keys listed in the replacer array are\n//          stringified.\n\n//          Values that do not have JSON representations, such as undefined or\n//          functions, will not be serialized. Such values in objects will be\n//          dropped; in arrays they will be replaced with null. You can use\n//          a replacer function to replace those with JSON values.\n\n//          JSON.stringify(undefined) returns undefined.\n\n//          The optional space parameter produces a stringification of the\n//          value that is filled with line breaks and indentation to make it\n//          easier to read.\n\n//          If the space parameter is a non-empty string, then that string will\n//          be used for indentation. If the space parameter is a number, then\n//          the indentation will be that many spaces.\n\n//          Example:\n\n//          text = JSON.stringify([\"e\", {pluribus: \"unum\"}]);\n//          // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n//          text = JSON.stringify([\"e\", {pluribus: \"unum\"}], null, \"\\t\");\n//          // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n//          text = JSON.stringify([new Date()], function (key, value) {\n//              return this[key] instanceof Date\n//                  ? \"Date(\" + this[key] + \")\"\n//                  : value;\n//          });\n//          // text is '[\"Date(---current time---)\"]'\n\n//      JSON.parse(text, reviver)\n//          This method parses a JSON text to produce an object or array.\n//          It can throw a SyntaxError exception.\n\n//          The optional reviver parameter is a function that can filter and\n//          transform the results. It receives each of the keys and values,\n//          and its return value is used instead of the original value.\n//          If it returns what it received, then the structure is not modified.\n//          If it returns undefined then the member is deleted.\n\n//          Example:\n\n//          // Parse the text. Values that look like ISO date strings will\n//          // be converted to Date objects.\n\n//          myData = JSON.parse(text, function (key, value) {\n//              var a;\n//              if (typeof value === \"string\") {\n//                  a =\n//   /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n//                  if (a) {\n//                      return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n//                          +a[5], +a[6]));\n//                  }\n//              }\n//              return value;\n//          });\n\n//          myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n//              var d;\n//              if (typeof value === \"string\" &&\n//                      value.slice(0, 5) === \"Date(\" &&\n//                      value.slice(-1) === \")\") {\n//                  d = new Date(value.slice(5, -1));\n//                  if (d) {\n//                      return d;\n//                  }\n//              }\n//              return value;\n//          });\n\n//  This is a reference implementation. You are free to copy, modify, or\n//  redistribute.\n\n/*jslint\n    eval, for, this\n*/\n\n/*property\n    JSON, apply, call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n    test, toJSON, toString, valueOf\n*/\n\n\n// Create a JSON object only if one does not already exist. We create the\n// methods in a closure to avoid creating global variables.\n\nif (typeof JSON !== \"object\") {\n    JSON = {};\n}\n\n(function () {\n    \"use strict\";\n\n    var rx_one = /^[\\],:{}\\s]*$/;\n    var rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\n    var rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\n    var rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\n    var rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n    var rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\n    function f(n) {\n        // Format integers to have at least two digits.\n        return n < 10\n            ? \"0\" + n\n            : n;\n    }\n\n    function this_value() {\n        return this.valueOf();\n    }\n\n    if (typeof Date.prototype.toJSON !== \"function\") {\n\n        Date.prototype.toJSON = function () {\n\n            return isFinite(this.valueOf())\n                ? this.getUTCFullYear() + \"-\" +\n                        f(this.getUTCMonth() + 1) + \"-\" +\n                        f(this.getUTCDate()) + \"T\" +\n                        f(this.getUTCHours()) + \":\" +\n                        f(this.getUTCMinutes()) + \":\" +\n                        f(this.getUTCSeconds()) + \"Z\"\n                : null;\n        };\n\n        Boolean.prototype.toJSON = this_value;\n        Number.prototype.toJSON = this_value;\n        String.prototype.toJSON = this_value;\n    }\n\n    var gap;\n    var indent;\n    var meta;\n    var rep;\n\n\n    function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n        rx_escapable.lastIndex = 0;\n        return rx_escapable.test(string)\n            ? \"\\\"\" + string.replace(rx_escapable, function (a) {\n                var c = meta[a];\n                return typeof c === \"string\"\n                    ? c\n                    : \"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + \"\\\"\"\n            : \"\\\"\" + string + \"\\\"\";\n    }\n\n\n    function str(key, holder) {\n\n// Produce a string from holder[key].\n\n        var i;          // The loop counter.\n        var k;          // The member key.\n        var v;          // The member value.\n        var length;\n        var mind = gap;\n        var partial;\n        var value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n        if (value && typeof value === \"object\" &&\n                typeof value.toJSON === \"function\") {\n            value = value.toJSON(key);\n        }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n        if (typeof rep === \"function\") {\n            value = rep.call(holder, key, value);\n        }\n\n// What happens next depends on the value's type.\n\n        switch (typeof value) {\n        case \"string\":\n            return quote(value);\n\n        case \"number\":\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n            return isFinite(value)\n                ? String(value)\n                : \"null\";\n\n        case \"boolean\":\n        case \"null\":\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce \"null\". The case is included here in\n// the remote chance that this gets fixed someday.\n\n            return String(value);\n\n// If the type is \"object\", we might be dealing with an object or an array or\n// null.\n\n        case \"object\":\n\n// Due to a specification blunder in ECMAScript, typeof null is \"object\",\n// so watch out for that case.\n\n            if (!value) {\n                return \"null\";\n            }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n            gap += indent;\n            partial = [];\n\n// Is the value an array?\n\n            if (Object.prototype.toString.apply(value) === \"[object Array]\") {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                length = value.length;\n                for (i = 0; i < length; i += 1) {\n                    partial[i] = str(i, value) || \"null\";\n                }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                v = partial.length === 0\n                    ? \"[]\"\n                    : gap\n                        ? \"[\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"]\"\n                        : \"[\" + partial.join(\",\") + \"]\";\n                gap = mind;\n                return v;\n            }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n            if (rep && typeof rep === \"object\") {\n                length = rep.length;\n                for (i = 0; i < length; i += 1) {\n                    if (typeof rep[i] === \"string\") {\n                        k = rep[i];\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (\n                                gap\n                                    ? \": \"\n                                    : \":\"\n                            ) + v);\n                        }\n                    }\n                }\n            } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                for (k in value) {\n                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (\n                                gap\n                                    ? \": \"\n                                    : \":\"\n                            ) + v);\n                        }\n                    }\n                }\n            }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n            v = partial.length === 0\n                ? \"{}\"\n                : gap\n                    ? \"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\"\n                    : \"{\" + partial.join(\",\") + \"}\";\n            gap = mind;\n            return v;\n        }\n    }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n    if (typeof JSON.stringify !== \"function\") {\n        meta = {    // table of character substitutions\n            \"\\b\": \"\\\\b\",\n            \"\\t\": \"\\\\t\",\n            \"\\n\": \"\\\\n\",\n            \"\\f\": \"\\\\f\",\n            \"\\r\": \"\\\\r\",\n            \"\\\"\": \"\\\\\\\"\",\n            \"\\\\\": \"\\\\\\\\\"\n        };\n        JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n            var i;\n            gap = \"\";\n            indent = \"\";\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n            if (typeof space === \"number\") {\n                for (i = 0; i < space; i += 1) {\n                    indent += \" \";\n                }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n            } else if (typeof space === \"string\") {\n                indent = space;\n            }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n            rep = replacer;\n            if (replacer && typeof replacer !== \"function\" &&\n                    (typeof replacer !== \"object\" ||\n                    typeof replacer.length !== \"number\")) {\n                throw new Error(\"JSON.stringify\");\n            }\n\n// Make a fake root object containing our value under the key of \"\".\n// Return the result of stringifying the value.\n\n            return str(\"\", {\"\": value});\n        };\n    }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n    if (typeof JSON.parse !== \"function\") {\n        JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k;\n                var v;\n                var value = holder[key];\n                if (value && typeof value === \"object\") {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            rx_dangerous.lastIndex = 0;\n            if (rx_dangerous.test(text)) {\n                text = text.replace(rx_dangerous, function (a) {\n                    return \"\\\\u\" +\n                            (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\n// because they can cause invocation, and \"=\" because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\n// replace all simple value tokens with \"]\" characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or \"]\" or\n// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\n\n            if (\n                rx_one.test(\n                    text\n                        .replace(rx_two, \"@\")\n                        .replace(rx_three, \"]\")\n                        .replace(rx_four, \"\")\n                )\n            ) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval(\"(\" + text + \")\");\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return (typeof reviver === \"function\")\n                    ? walk({\"\": j}, \"\")\n                    : j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError(\"JSON.parse\");\n        };\n    }\n}());","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"aT88m\\\":\\\"index.bd463fc0.js\\\",\\\"93Bqc\\\":\\\"sword.a45e8cc8.png\\\",\\\"1OAey\\\":\\\"sand-placeholder.566f05a5.png\\\",\\\"5rmOr\\\":\\\"sandcastle-placeholder.53b9737d.png\\\",\\\"9fEnB\\\":\\\"tower-placeholder.7eee11a2.png\\\",\\\"lxy2T\\\":\\\"clank.3e05cde9.wav\\\"}\"));","import { DisplayMode, Engine, Loader, Input, Logger } from \"excalibur\";\nimport { loadPreferences } from \"./preferences\";\nimport { Level } from \"./level\";\nimport { Resources } from \"./resources\";\nimport { SoundManager } from \"./sound-manager\";\nimport { DevTool } from \"@excaliburjs/dev-tools\";\nimport config from \"./config\";\n\nloadPreferences();\nSoundManager.init();\nexport class Game extends Engine {\n    showDevTool: boolean = config.ShowDevTool;\n    devTool!: DevTool;\n    constructor() {\n        super({\n            canvasElementId: 'game',\n            displayMode: DisplayMode.FitScreen,\n            antialiasing: false,\n            // .5 tile of padding for now\n            resolution: { width: config.tileWidth * (config.gridWidth + config.gridPadding), height: config.tileHeight * (config.gridHeight + config.gridPadding) }\n        });\n    }\n\n    init() {\n        this.startLevel();\n        const loader = new Loader();\n        for (const resource of Object.values(Resources)) {\n            loader.addResource(resource);\n        }\n        this.start(loader).then(() => {\n            // game start stuff\n           this.setupDevTool();\n        });\n\n    }\n\n    startLevel = () => {\n        const level = new Level();\n        this.addScene(\"main\", level);\n        this.goToScene(\"main\");\n    }\n\n    setupDevTool = () => {\n        if (this.showDevTool) {\n            this.devTool = new DevTool(this);\n            let configTab = this.devTool.pane.addTab({\n                pages: [{\n                    title: \"Config\"\n                }]\n            })\n            let configPage = configTab.pages[0];\n            for (let key in config) {\n                configPage.addInput(config, key as any, {\n                    disabled: true // config not editable yet\n                })\n            }\n        }\n    }\n}\n\nexport const game = new Game();\n\n// debugging hotkeys\n// pressing 'p' will toggle pause/resume of the game\n// pressing ';' will toggle debug (will not update unless game is resuming)\ngame.input.keyboard.on('release', (event) => {\n    switch(event.key) {\n        case Input.Keys.P : \n            if (game.isRunning()) {\n                game.stop();\n                Logger.getInstance().info('game paused');\n            } else {\n                game.start();\n                Logger.getInstance().info('game resumed');\n            }\n            break;\n        case Input.Keys.Semicolon :\n            game.toggleDebug();\n            break;\n    }\n});\n\ngame.init();","var util = require('./util')\nvar slice = util.slice\nvar pluck = util.pluck\nvar each = util.each\nvar bind = util.bind\nvar create = util.create\nvar isList = util.isList\nvar isFunction = util.isFunction\nvar isObject = util.isObject\n\nmodule.exports = {\n\tcreateStore: createStore\n}\n\nvar storeAPI = {\n\tversion: '2.0.12',\n\tenabled: false,\n\t\n\t// get returns the value of the given key. If that value\n\t// is undefined, it returns optionalDefaultValue instead.\n\tget: function(key, optionalDefaultValue) {\n\t\tvar data = this.storage.read(this._namespacePrefix + key)\n\t\treturn this._deserialize(data, optionalDefaultValue)\n\t},\n\n\t// set will store the given value at key and returns value.\n\t// Calling set with value === undefined is equivalent to calling remove.\n\tset: function(key, value) {\n\t\tif (value === undefined) {\n\t\t\treturn this.remove(key)\n\t\t}\n\t\tthis.storage.write(this._namespacePrefix + key, this._serialize(value))\n\t\treturn value\n\t},\n\n\t// remove deletes the key and value stored at the given key.\n\tremove: function(key) {\n\t\tthis.storage.remove(this._namespacePrefix + key)\n\t},\n\n\t// each will call the given callback once for each key-value pair\n\t// in this store.\n\teach: function(callback) {\n\t\tvar self = this\n\t\tthis.storage.each(function(val, namespacedKey) {\n\t\t\tcallback.call(self, self._deserialize(val), (namespacedKey || '').replace(self._namespaceRegexp, ''))\n\t\t})\n\t},\n\n\t// clearAll will remove all the stored key-value pairs in this store.\n\tclearAll: function() {\n\t\tthis.storage.clearAll()\n\t},\n\n\t// additional functionality that can't live in plugins\n\t// ---------------------------------------------------\n\n\t// hasNamespace returns true if this store instance has the given namespace.\n\thasNamespace: function(namespace) {\n\t\treturn (this._namespacePrefix == '__storejs_'+namespace+'_')\n\t},\n\n\t// createStore creates a store.js instance with the first\n\t// functioning storage in the list of storage candidates,\n\t// and applies the the given mixins to the instance.\n\tcreateStore: function() {\n\t\treturn createStore.apply(this, arguments)\n\t},\n\t\n\taddPlugin: function(plugin) {\n\t\tthis._addPlugin(plugin)\n\t},\n\t\n\tnamespace: function(namespace) {\n\t\treturn createStore(this.storage, this.plugins, namespace)\n\t}\n}\n\nfunction _warn() {\n\tvar _console = (typeof console == 'undefined' ? null : console)\n\tif (!_console) { return }\n\tvar fn = (_console.warn ? _console.warn : _console.log)\n\tfn.apply(_console, arguments)\n}\n\nfunction createStore(storages, plugins, namespace) {\n\tif (!namespace) {\n\t\tnamespace = ''\n\t}\n\tif (storages && !isList(storages)) {\n\t\tstorages = [storages]\n\t}\n\tif (plugins && !isList(plugins)) {\n\t\tplugins = [plugins]\n\t}\n\n\tvar namespacePrefix = (namespace ? '__storejs_'+namespace+'_' : '')\n\tvar namespaceRegexp = (namespace ? new RegExp('^'+namespacePrefix) : null)\n\tvar legalNamespaces = /^[a-zA-Z0-9_\\-]*$/ // alpha-numeric + underscore and dash\n\tif (!legalNamespaces.test(namespace)) {\n\t\tthrow new Error('store.js namespaces can only have alphanumerics + underscores and dashes')\n\t}\n\t\n\tvar _privateStoreProps = {\n\t\t_namespacePrefix: namespacePrefix,\n\t\t_namespaceRegexp: namespaceRegexp,\n\n\t\t_testStorage: function(storage) {\n\t\t\ttry {\n\t\t\t\tvar testStr = '__storejs__test__'\n\t\t\t\tstorage.write(testStr, testStr)\n\t\t\t\tvar ok = (storage.read(testStr) === testStr)\n\t\t\t\tstorage.remove(testStr)\n\t\t\t\treturn ok\n\t\t\t} catch(e) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t},\n\n\t\t_assignPluginFnProp: function(pluginFnProp, propName) {\n\t\t\tvar oldFn = this[propName]\n\t\t\tthis[propName] = function pluginFn() {\n\t\t\t\tvar args = slice(arguments, 0)\n\t\t\t\tvar self = this\n\n\t\t\t\t// super_fn calls the old function which was overwritten by\n\t\t\t\t// this mixin.\n\t\t\t\tfunction super_fn() {\n\t\t\t\t\tif (!oldFn) { return }\n\t\t\t\t\teach(arguments, function(arg, i) {\n\t\t\t\t\t\targs[i] = arg\n\t\t\t\t\t})\n\t\t\t\t\treturn oldFn.apply(self, args)\n\t\t\t\t}\n\n\t\t\t\t// Give mixing function access to super_fn by prefixing all mixin function\n\t\t\t\t// arguments with super_fn.\n\t\t\t\tvar newFnArgs = [super_fn].concat(args)\n\n\t\t\t\treturn pluginFnProp.apply(self, newFnArgs)\n\t\t\t}\n\t\t},\n\n\t\t_serialize: function(obj) {\n\t\t\treturn JSON.stringify(obj)\n\t\t},\n\n\t\t_deserialize: function(strVal, defaultVal) {\n\t\t\tif (!strVal) { return defaultVal }\n\t\t\t// It is possible that a raw string value has been previously stored\n\t\t\t// in a storage without using store.js, meaning it will be a raw\n\t\t\t// string value instead of a JSON serialized string. By defaulting\n\t\t\t// to the raw string value in case of a JSON parse error, we allow\n\t\t\t// for past stored values to be forwards-compatible with store.js\n\t\t\tvar val = ''\n\t\t\ttry { val = JSON.parse(strVal) }\n\t\t\tcatch(e) { val = strVal }\n\n\t\t\treturn (val !== undefined ? val : defaultVal)\n\t\t},\n\t\t\n\t\t_addStorage: function(storage) {\n\t\t\tif (this.enabled) { return }\n\t\t\tif (this._testStorage(storage)) {\n\t\t\t\tthis.storage = storage\n\t\t\t\tthis.enabled = true\n\t\t\t}\n\t\t},\n\n\t\t_addPlugin: function(plugin) {\n\t\t\tvar self = this\n\n\t\t\t// If the plugin is an array, then add all plugins in the array.\n\t\t\t// This allows for a plugin to depend on other plugins.\n\t\t\tif (isList(plugin)) {\n\t\t\t\teach(plugin, function(plugin) {\n\t\t\t\t\tself._addPlugin(plugin)\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Keep track of all plugins we've seen so far, so that we\n\t\t\t// don't add any of them twice.\n\t\t\tvar seenPlugin = pluck(this.plugins, function(seenPlugin) {\n\t\t\t\treturn (plugin === seenPlugin)\n\t\t\t})\n\t\t\tif (seenPlugin) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.plugins.push(plugin)\n\n\t\t\t// Check that the plugin is properly formed\n\t\t\tif (!isFunction(plugin)) {\n\t\t\t\tthrow new Error('Plugins must be function values that return objects')\n\t\t\t}\n\n\t\t\tvar pluginProperties = plugin.call(this)\n\t\t\tif (!isObject(pluginProperties)) {\n\t\t\t\tthrow new Error('Plugins must return an object of function properties')\n\t\t\t}\n\n\t\t\t// Add the plugin function properties to this store instance.\n\t\t\teach(pluginProperties, function(pluginFnProp, propName) {\n\t\t\t\tif (!isFunction(pluginFnProp)) {\n\t\t\t\t\tthrow new Error('Bad plugin property: '+propName+' from plugin '+plugin.name+'. Plugins should only return functions.')\n\t\t\t\t}\n\t\t\t\tself._assignPluginFnProp(pluginFnProp, propName)\n\t\t\t})\n\t\t},\n\t\t\n\t\t// Put deprecated properties in the private API, so as to not expose it to accidential\n\t\t// discovery through inspection of the store object.\n\t\t\n\t\t// Deprecated: addStorage\n\t\taddStorage: function(storage) {\n\t\t\t_warn('store.addStorage(storage) is deprecated. Use createStore([storages])')\n\t\t\tthis._addStorage(storage)\n\t\t}\n\t}\n\n\tvar store = create(_privateStoreProps, storeAPI, {\n\t\tplugins: []\n\t})\n\tstore.raw = {}\n\teach(store, function(prop, propName) {\n\t\tif (isFunction(prop)) {\n\t\t\tstore.raw[propName] = bind(store, prop)\t\t\t\n\t\t}\n\t})\n\teach(storages, function(storage) {\n\t\tstore._addStorage(storage)\n\t})\n\teach(plugins, function(plugin) {\n\t\tstore._addPlugin(plugin)\n\t})\n\treturn store\n}\n","module.exports = [\n\t// Listed in order of usage preference\n\trequire('./localStorage'),\n\trequire('./oldFF-globalStorage'),\n\trequire('./oldIE-userDataStorage'),\n\trequire('./cookieStorage'),\n\trequire('./sessionStorage'),\n\trequire('./memoryStorage')\n]\n","var engine = require('../src/store-engine')\n\nvar storages = require('../storages/all')\nvar plugins = [require('../plugins/json2')]\n\nmodule.exports = engine.createStore(storages, plugins)\n","import store from \"store\";\n\nexport let Preferences = {\n  muteBackgroundMusic: false,\n  muteAll: false,\n};\n\nlet _origPreferences = { ...Preferences };\n\nexport function resetPreferences() {\n  Preferences = { ..._origPreferences };\n}\n\nexport function savePreferences() {\n  store.set(\"pref\", Preferences);\n}\n\nexport function loadPreferences() {\n  // overwrite but allow new properties\n  Preferences = { ...Preferences, ...store.get(\"pref\") };\n}","import { Actor, Engine, Random, Scene, vec } from \"excalibur\";\nimport { Resources } from \"./resources\";\nimport config from \"./config\";\nimport { Grid } from \"./grid\";\nimport { SandCastle } from \"./sandcastle\";\nimport { EnemyGenerator } from \"./enemyGenerator\";\nimport { Enemy, EnemyType } from \"./enemy\";\nimport { Tower } from \"./tower\";\nimport { TowerPlacer } from \"./tower-placer\";\n\nexport class Level extends Scene {\n    random = new Random(config.Seed);\n    grid!: Grid;\n    sandCastles: SandCastle[] = [];\n    enemyGenerator: EnemyGenerator | undefined;\n    towerPlacer!: TowerPlacer;\n\n    onInitialize(engine: Engine): void {\n        // Sand grid\n        this.grid = new Grid(vec(config.tileWidth/2, config.tileHeight/2), config.gridHeight, config.gridWidth, config.tileWidth, config.tileHeight);\n        this.add(this.grid.tileMap);\n\n        this.enemyGenerator = new EnemyGenerator(this);\n\n        // Sandcastle(s)\n        for (let y = 0; y < config.gridHeight; y++) {\n            const sandcastle = new SandCastle(this.grid, y);\n            this.sandCastles.push(sandcastle);\n            this.add(sandcastle);\n        }\n\n        // Tower Test\n        const tower = new Tower(this.grid, 5, 3);\n        this.grid.tileMap.getTile(5, 3).data.set(\"tower\", tower);\n        this.add(tower);\n\n        // Tower placement\n        this.towerPlacer = new TowerPlacer(this.grid, engine)\n\n        // enemy spawn test\n        this.enemyGenerator.spawnEnemy(EnemyType.Crab, config.gridWidth - 1, 0);\n        this.enemyGenerator.spawnEnemy(EnemyType.Crab, config.gridWidth - 1, 1);\n        this.enemyGenerator.spawnEnemy(EnemyType.Turtle, config.gridWidth - 1, 2);\n        this.enemyGenerator.spawnEnemy(EnemyType.Crab, config.gridWidth - 1, 3);\n        this.enemyGenerator.spawnEnemy(EnemyType.Turtle, config.gridWidth - 1, 4);\n\n        // random enemy spawn test\n        // this.enemyGenerator.spawnEnemyAtRandomTile(EnemyType.Crab);\n        // this.enemyGenerator.spawnEnemyAtRandomTile(EnemyType.Crab);\n        // this.enemyGenerator.spawnEnemyAtRandomTile(EnemyType.Crab);\n    }\n\n}","import { Color } from \"excalibur\";\n\nexport default {\n    ShowDevTool: true,\n    SoundVolume: 0.3,\n    Seed: 1337,\n\n    // Grid\n    tileWidth: 64,\n    tileHeight: 64,\n    gridWidth: 9,\n    gridHeight: 5,\n    gridPadding: 1,\n\n    // Sandcastle\n    maxHealth: 10,\n    healthBarWidthPixels: 64 - 10,\n\n    // Tower\n    bulletSpeedPixelsPerSecond: 100,\n    bulletRadius: 10,\n    baseTowerFireRateMs: 5000,\n\n    // Enemies\n    enemy: {\n        crab: {\n            width: 50,\n            height: 50,\n            health: 3,\n            damage: 2, // how much damage this enemy does to the castle\n            speed: 15, // (pixels/second)\n            color: Color.Red // the color of the actor when it doesn't have any art applied\n            // TODO art and animations?\n        },\n        turtle: {\n            width: 50,\n            height: 50,\n            health: 5,\n            damage: 1,\n            speed: 8,\n            color: Color.Green,\n            // TODO art and animations?\n        }\n    }\n\n}","import { TileMap, Vector } from \"excalibur\";\nimport { Resources } from \"./resources\";\n\nexport class Grid {\n    public tileMap: TileMap\n    constructor(pos: Vector, height: number, width: number, tileWidth: number, tileHeight: number) {\n        this.tileMap = new TileMap({\n            name: \"Sand Grid\",\n            pos,\n            width,\n            height,\n            tileWidth,\n            tileHeight\n        });\n        \n        const sandSprite = Resources.Sand.toSprite();\n        for (let tile of this.tileMap.tiles) {\n            tile.addGraphic(sandSprite);\n        }\n    }\n}","import { ImageSource, Sound, ImageFiltering } from \"excalibur\";\n\n// Images\nimport swordUrl from \"./images/sword.png\";\nimport sandUrl from \"./images/sand-placeholder.png\";\nimport sandCastleUrl from \"./images/sandcastle-placeholder.png\";\nimport towerUrl from \"./images/tower-placeholder.png\";\n\n// Sounds\nimport clankUrl from \"./sounds/clank.wav\";\n\nexport const Resources = {\n    // Images\n    Sword: new ImageSource(swordUrl),\n    Sand: new ImageSource(sandUrl, false, ImageFiltering.Pixel),\n    SandCastle: new ImageSource(sandCastleUrl, false, ImageFiltering.Pixel),\n    BaseTower: new ImageSource(towerUrl, false, ImageFiltering.Pixel),\n\n    // Sounds\n    Clank: new Sound(clankUrl)\n}","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"93Bqc\")).toString();","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"1OAey\")).toString();","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"5rmOr\")).toString();","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"9fEnB\")).toString();","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"lxy2T\")).toString();","import config from \"./config\";\nimport { Actor, Color, Vector, CollisionGroupManager, CollisionType } from \"excalibur\";\n\nexport class Enemy extends Actor {\n    public static CollisionGroup = CollisionGroupManager.create(\"enemy\");\n\n    public health: number;\n    public damage: number;\n    type: EnemyType;\n\n    constructor(type: EnemyType, x: number, y: number) {\n        const configValues = config.enemy[type];\n        super({\n            name: \"Enemy\",\n            x, y, \n            width: configValues.width, \n            height: configValues.height, \n            color: configValues.color, \n            collisionType: CollisionType.Active,\n            collisionGroup: Enemy.CollisionGroup,\n            vel: new Vector(-1 * configValues.speed, 0), // moves horizontally, right to left\n        });\n        this.type = type;\n        this.health = configValues.health;\n        this.damage = configValues.damage;\n    }\n\n    takeDamage() {\n        this.health--;\n        if (this.health <= 0) {\n            this.kill();\n        }\n    }\n}\n\nexport enum EnemyType {\n    Crab = 'crab',\n    Turtle = 'turtle',\n    // others?\n}\n","import { Grid } from \"./grid\";\nimport config from \"./config\";\nimport { Actor, CollisionGroup, CollisionType, Color, vec, PostCollisionEvent } from \"excalibur\";\nimport { Resources } from \"./resources\";\nimport { Enemy } from \"./enemy\";\n\nexport class SandCastle extends Actor {\n    maxHp: number = config.maxHealth;\n    currentHp: number = this.maxHp;\n    healthBar: Actor;\n    constructor(grid: Grid, row: number) {\n        super({\n            name: 'Sand Castle',\n            pos: grid.tileMap.pos.add(vec(0, row * config.tileHeight + config.tileHeight/2)),\n            width: config.tileWidth,\n            height: config.tileHeight,\n            collisionType: CollisionType.Fixed,\n            collisionGroup: CollisionGroup.collidesWith([Enemy.CollisionGroup])\n        });\n        this.on('postcollision', evt => this.onPostCollision(evt));\n\n        const sandcastle = Resources.SandCastle.toSprite();\n        this.graphics.use(sandcastle);\n\n        // draw health bar\n        this.healthBar = new Actor({\n            name: 'Healthbar',\n            width: config.healthBarWidthPixels,\n            height: 5,\n            color: Color.Green,\n            collisionType: CollisionType.PreventCollision\n        });\n        this.addChild(this.healthBar);\n    }\n\n    onPostCollision(evt: PostCollisionEvent) {\n        this.takeDamage();\n        evt.other.kill();\n    }\n\n    takeDamage() {\n        this.currentHp -= 1;\n        const pixelsPerHp = config.healthBarWidthPixels / config.maxHealth;\n        const graphic = this.healthBar.graphics.current[0].graphic;\n        graphic.width = this.currentHp * pixelsPerHp;\n        if (this.currentHp <= 0) {\n            this.kill();\n        }\n    }\n}","import config from \"./config\";\nimport { Timer, Tile, randomIntInRange } from \"excalibur\";\nimport { Level } from \"./level\";\nimport { Enemy, EnemyType } from \"./enemy\";\nimport { Util } from \"../lib/excalibur/src/engine\";\n\nexport class EnemyGenerator {\n\n    possibleSpawnTiles: Tile[] = [];\n\n    constructor(private level: Level) {\n        // Currently, this only picks the tiles from the furthest right column of the grid.\n        for (let i = 0; i < config.gridHeight; i++) {\n            this.possibleSpawnTiles.push(this.level.grid.tileMap.getTile(config.gridWidth - 1, i));\n        }\n    }\n\n    public spawnEnemy(type: EnemyType, gridX: number, gridY: number) {\n        // const enemySpawnTile = this.level.grid.tileMap.getTile(config.gridWidth - 1, 2);\n        const enemySpawnTile = this.level.grid.tileMap.getTile(gridX, gridY);\n        console.log({enemySpawnTile});\n        const enemy = new Enemy(type, enemySpawnTile.pos.x + config.tileWidth / 2, enemySpawnTile.pos.y + config.tileHeight / 2);\n        this.level.add(enemy);\n    }\n\n    /**\n     * Spawns an enemy at a random tile from the available possible spawn tiles\n     */\n    public spawnEnemyAtRandomTile(type: EnemyType) {\n        const randomYIndex = randomIntInRange(0, this.possibleSpawnTiles.length - 1);\n        this.spawnEnemy(type, config.gridWidth - 1, randomYIndex);\n    }\n\n}","import config from \"./config\";\nimport { Actor, CollisionGroup, CollisionType, Color, Engine, vec, Vector } from \"excalibur\";\nimport { Resources } from \"./resources\";\nimport { Grid } from \"./grid\";\nimport { Enemy } from \"./enemy\";\n\nexport class Tower extends Actor {\n    private _engine!: Engine;\n    constructor(grid: Grid, x: number, y: number) {\n        super({\n            name: \"Base Tower\",\n            pos: grid.tileMap.getTile(x, y).pos.add(vec(config.tileWidth/2, config.tileHeight/2)),\n            width: config.tileWidth,\n            height: config.tileHeight,\n            collisionType: CollisionType.Fixed,\n            collisionGroup: CollisionGroup.collidesWith([Enemy.CollisionGroup]),\n        });\n\n        const towerSprite = Resources.BaseTower.toSprite()\n\n        this.graphics.use(towerSprite);\n    }\n\n    onInitialize(engine: Engine) {\n        this._engine = engine;\n    }\n\n    private _currentFireTimer = 0;\n    onPostUpdate(_engine: Engine, updateMs: number) {\n        this._currentFireTimer += updateMs;\n        if (this._currentFireTimer > config.baseTowerFireRateMs) {\n            this.fire();\n            this._currentFireTimer = 0;\n        }\n    }\n\n    fire = () => {\n        // Fire bullet and add to engine\n        const bullet = new Actor({\n            name: \"Tower Bullet\",\n            pos: this.pos,\n            vel: vec(config.bulletSpeedPixelsPerSecond, 0),\n            radius: config.bulletRadius,\n            color: Color.Black,\n            collisionGroup: CollisionGroup.collidesWith([Enemy.CollisionGroup]),\n            collisionType: CollisionType.Passive\n        })\n\n        bullet.on('precollision', (evt) => {\n            const enemy = evt.other as Enemy;\n            enemy.takeDamage();\n            bullet.kill();\n        })\n\n        bullet.on('exitviewport', () => {\n            bullet.kill();\n        });\n\n        this._engine.add(bullet);\n    }\n\n    takeDamage() {\n        this.kill();\n    }\n}","import { Engine, Input, Tile, Actor, Color, Rectangle, vec } from \"excalibur\";\nimport { Tower } from \"./tower\";\nimport { Grid } from \"./grid\";\nimport config from \"./config\";\n\n\nexport class TowerPlacer {\n    private _grid: Grid;\n    private _engine: Engine;\n    private _highlightedTile: Tile | null = null;\n    private _highlight: Actor;\n    constructor(grid: Grid, engine: Engine) {\n        this._grid = grid;\n        this._engine = engine;\n        engine.input.pointers.primary.on('move', (evt) => this.onPointerMove(evt));\n        engine.input.pointers.primary.on('down', () => this.onConfirm());\n        this._highlight = new Actor({\n            pos: vec(-100, -100) // default offscreen\n        })\n        const rect = new Rectangle({\n            width: config.tileWidth,\n            height: config.tileHeight,\n            color: Color.Transparent,\n            strokeColor: Color.Green,\n            lineWidth: 3,\n            lineDash: [3, 3]\n        })\n        this._highlight.graphics.use(rect);\n        engine.add(this._highlight);\n    }\n\n    onPointerMove(evt: Input.PointerEvent) {\n        // TODO add tile highlight\n        const maybeTile = this._grid.tileMap.getTileByPoint(evt.worldPos);\n\n        if (maybeTile) {\n            this._highlightedTile = maybeTile;\n            this._highlight.pos = this._highlightedTile.pos.add(vec(config.tileWidth/2, config.tileHeight/2));\n        }\n    }\n\n    onConfirm() {\n        if (this._highlightedTile) {\n            if (!this._highlightedTile.data.has(\"tower\")) {\n                const tower = new Tower(this._grid, this._highlightedTile.x, this._highlightedTile.y);\n                this._highlightedTile.data.set(\"tower\", tower);\n                this._engine.add(tower);\n            } else {\n                console.log(\"Tower already there!\")\n            }\n        }\n        this._highlightedTile = null;\n    }\n}","import { Sound } from \"excalibur\";\nimport classNames from 'classnames';\nimport { Resources } from \"./resources\";\nimport { Preferences, savePreferences } from \"./preferences\";\nimport Config from \"./config\";\n\n\nexport class SoundManager {\n    static setSoundSpecificVolume() {\n      Resources.Clank.volume = 0.5;\n    }\n  \n    static init() {\n      SoundManager.setSoundSpecificVolume();\n      if (Preferences.muteBackgroundMusic) {\n        SoundManager.muteBackgroundMusic();\n      }\n      if (Preferences.muteAll) {\n        SoundManager.muteAll();\n      }\n  \n      $(\"#mute-music\").on(\"click\", () => {\n        if (Preferences.muteBackgroundMusic) {\n          SoundManager.unmuteBackgroundMusic();\n        } else {\n          SoundManager.muteBackgroundMusic();\n        }\n        savePreferences();\n        return false;\n      });\n  \n      $(\"#mute-all\").on(\"click\", () => {\n        if (Preferences.muteAll) {\n          SoundManager.unmuteAll();\n        } else {\n          SoundManager.muteAll();\n        }\n        savePreferences();\n        return false;\n      });\n    }\n  \n    static muteAll() {\n      Preferences.muteAll = true;\n      Preferences.muteBackgroundMusic = true;\n  \n      for (let r in Resources) {\n        let snd = (Resources as any)[r];\n        if (snd instanceof Sound) {\n          snd.volume = 0;\n        }\n      }\n      SoundManager.muteBackgroundMusic();\n      SoundManager._updateMuteAllButton();\n    }\n  \n    static unmuteAll() {\n      Preferences.muteAll = false;\n      Preferences.muteBackgroundMusic = false;\n  \n      for (var r in Resources) {\n        let snd = (Resources as any)[r];\n        if (snd instanceof Sound) {\n          snd.volume = Config.SoundVolume;\n        }\n      }\n      SoundManager.setSoundSpecificVolume();\n      SoundManager.unmuteBackgroundMusic();\n      SoundManager._updateMuteAllButton();\n    }\n  \n    static startBackgroundMusic() {\n      // start bg music\n      // Resources.BackgroundMusic.volume = Preferences.muteBackgroundMusic\n      //   ? 0\n      //   : Config.BackgroundVolume;\n      // Resources.BackgroundMusic.loop = true;\n      // if (!Resources.BackgroundMusic.isPlaying())\n      //   Resources.BackgroundMusic.play();\n    }\n  \n    static stopBackgroundMusic() {\n      // stop bg music\n      // Resources.BackgroundMusic.loop = false;\n    }\n  \n    static muteBackgroundMusic() {\n      Preferences.muteBackgroundMusic = true;\n  \n      // mute bg music\n      // Resources.BackgroundMusic.volume = 0;\n      SoundManager._updateMusicButton();\n    }\n  \n    static unmuteBackgroundMusic() {\n      Preferences.muteBackgroundMusic = false;\n  \n      // unmute bg music\n      // Resources.BackgroundMusic.volume = Config.BackgroundVolume;\n  \n      SoundManager._updateMusicButton();\n    }\n  \n  \n    private static _updateMusicButton() {\n      $(\"#mute-music i\").get(0).className = classNames(\"fa\", {\n        \"fa-music\": !Preferences.muteBackgroundMusic,\n        \"fa-play\": Preferences.muteBackgroundMusic,\n      });\n    }\n  \n    private static _updateMuteAllButton() {\n      $(\"#mute-all i\").get(0).className = classNames(\"fa\", {\n        \"fa-volume-up\": !Preferences.muteAll,\n        \"fa-volume-off\": Preferences.muteAll,\n      });\n    }\n  }","/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"excalibur\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"excalibur\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory(require(\"excalibur\"));\n\telse\n\t\troot[\"ex\"] = root[\"ex\"] || {}, root[\"ex\"][\"DevTools\"] = factory(root[\"ex\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE_excalibur__) {\nreturn ","import { Engine, System, SystemType, TransformComponent, Input, Scene, Entity, ColliderComponent, GraphicsComponent, CoordPlane, BoundingBox, Particle, ParticleEmitter } from \"excalibur\";\r\n\r\nexport class PickerSystem extends System<TransformComponent> {\r\n    public readonly types = ['ex.transform'] as const;\r\n    public readonly systemType = SystemType.Update;\r\n    public priority = 99;\r\n  \r\n    public lastFrameEntityToPointers = new Map<number, number[]>();\r\n    public currentFrameEntityToPointers = new Map<number, number[]>();\r\n    private _engine: Engine;\r\n    private _receiver: Input.PointerEventReceiver;\r\n  \r\n    public initialize(scene: Scene): void {\r\n      this._engine = scene.engine;\r\n      this._receiver = this._engine.input.pointers;\r\n    }\r\n  \r\n    public addPointerToEntity(entity: Entity, pointerId: number) {\r\n      if (!this.currentFrameEntityToPointers.has(entity.id)) {\r\n        this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\r\n        return;\r\n      }\r\n      const pointers = this.currentFrameEntityToPointers.get(entity.id);\r\n      this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\r\n    }\r\n  \r\n    private _processPointerToEntity(entities: Entity[]) {\r\n      let transform: TransformComponent;\r\n      let maybeCollider: ColliderComponent;\r\n      let maybeGraphics: GraphicsComponent;\r\n  \r\n      // TODO probably a spatial partition optimization here to quickly query bounds for pointer\r\n      // doesn't seem to cause issues tho for perf\r\n  \r\n      // Pre-process find entities under pointers\r\n      for (const entity of entities) {\r\n        // skip particles\r\n        if (entity instanceof Particle) {\r\n            continue;\r\n        }\r\n        transform = entity.get(TransformComponent);\r\n        // Check collider contains pointer\r\n        maybeCollider = entity.get(ColliderComponent);\r\n        if (maybeCollider) {\r\n          const geom = maybeCollider.get();\r\n          if (geom) {\r\n            for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n              if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n                this.addPointerToEntity(entity, pointerId);\r\n              }\r\n            }\r\n          }\r\n        }\r\n  \r\n        // Check graphics contains pointer\r\n        maybeGraphics = entity.get(GraphicsComponent);\r\n        if (maybeGraphics) {\r\n          const graphicBounds = maybeGraphics.localBounds.transform(transform.getGlobalMatrix());\r\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n            if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n              this.addPointerToEntity(entity, pointerId);\r\n            }\r\n          }\r\n        }\r\n  \r\n        // Synthetic geometry to help with the picking when no graphics or collider exist\r\n        if (!(maybeGraphics?.current?.length) && !(maybeCollider?.get()) || entity instanceof ParticleEmitter) {\r\n          const bounds = BoundingBox.fromDimension(100, 100).transform(transform.getGlobalMatrix());\r\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n            if (bounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n              this.addPointerToEntity(entity, pointerId);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  \r\n    update(entities: Entity[], _delta: number): void {\r\n      this._processPointerToEntity(entities);\r\n      this.lastFrameEntityToPointers.clear();\r\n      this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\r\n      this.currentFrameEntityToPointers.clear();\r\n    }\r\n  }","/*! Tweakpane 3.0.7 (c) 2016 cocopon, licensed under the MIT license. */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.Tweakpane = {}));\n})(this, (function (exports) { 'use strict';\n\n    /***\n     * A simple semantic versioning perser.\n     */\n    class Semver {\n        /**\n         * @hidden\n         */\n        constructor(text) {\n            const [core, prerelease] = text.split('-');\n            const coreComps = core.split('.');\n            this.major = parseInt(coreComps[0], 10);\n            this.minor = parseInt(coreComps[1], 10);\n            this.patch = parseInt(coreComps[2], 10);\n            this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n        }\n        toString() {\n            const core = [this.major, this.minor, this.patch].join('.');\n            return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n        }\n    }\n\n    class BladeApi {\n        constructor(controller) {\n            this.controller_ = controller;\n        }\n        get disabled() {\n            return this.controller_.viewProps.get('disabled');\n        }\n        set disabled(disabled) {\n            this.controller_.viewProps.set('disabled', disabled);\n        }\n        get hidden() {\n            return this.controller_.viewProps.get('hidden');\n        }\n        set hidden(hidden) {\n            this.controller_.viewProps.set('hidden', hidden);\n        }\n        dispose() {\n            this.controller_.viewProps.set('disposed', true);\n        }\n    }\n\n    class TpEvent {\n        constructor(target) {\n            this.target = target;\n        }\n    }\n    class TpChangeEvent extends TpEvent {\n        constructor(target, value, presetKey, last) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n            this.last = last !== null && last !== void 0 ? last : true;\n        }\n    }\n    class TpUpdateEvent extends TpEvent {\n        constructor(target, value, presetKey) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n        }\n    }\n    class TpFoldEvent extends TpEvent {\n        constructor(target, expanded) {\n            super(target);\n            this.expanded = expanded;\n        }\n    }\n\n    function forceCast(v) {\n        return v;\n    }\n    function isEmpty(value) {\n        return value === null || value === undefined;\n    }\n    function deepEqualsArray(a1, a2) {\n        if (a1.length !== a2.length) {\n            return false;\n        }\n        for (let i = 0; i < a1.length; i++) {\n            if (a1[i] !== a2[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    const CREATE_MESSAGE_MAP = {\n        alreadydisposed: () => 'View has been already disposed',\n        invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n        nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n        nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n        notbindable: () => `Value is not bindable`,\n        propertynotfound: (context) => `Property '${context.name}' not found`,\n        shouldneverhappen: () => 'This error should never happen',\n    };\n    class TpError {\n        constructor(config) {\n            var _a;\n            this.message =\n                (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n            this.name = this.constructor.name;\n            this.stack = new Error(this.message).stack;\n            this.type = config.type;\n        }\n        static alreadyDisposed() {\n            return new TpError({ type: 'alreadydisposed' });\n        }\n        static notBindable() {\n            return new TpError({\n                type: 'notbindable',\n            });\n        }\n        static propertyNotFound(name) {\n            return new TpError({\n                type: 'propertynotfound',\n                context: {\n                    name: name,\n                },\n            });\n        }\n        static shouldNeverHappen() {\n            return new TpError({ type: 'shouldneverhappen' });\n        }\n    }\n\n    class BindingTarget {\n        constructor(obj, key, opt_id) {\n            this.obj_ = obj;\n            this.key_ = key;\n            this.presetKey_ = opt_id !== null && opt_id !== void 0 ? opt_id : key;\n        }\n        static isBindable(obj) {\n            if (obj === null) {\n                return false;\n            }\n            if (typeof obj !== 'object') {\n                return false;\n            }\n            return true;\n        }\n        get key() {\n            return this.key_;\n        }\n        get presetKey() {\n            return this.presetKey_;\n        }\n        read() {\n            return this.obj_[this.key_];\n        }\n        write(value) {\n            this.obj_[this.key_] = value;\n        }\n        writeProperty(name, value) {\n            const valueObj = this.read();\n            if (!BindingTarget.isBindable(valueObj)) {\n                throw TpError.notBindable();\n            }\n            if (!(name in valueObj)) {\n                throw TpError.propertyNotFound(name);\n            }\n            valueObj[name] = value;\n        }\n    }\n\n    class ButtonApi extends BladeApi {\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.valueController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.valueController.props.set('title', title);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            const emitter = this.controller_.valueController.emitter;\n            emitter.on(eventName, () => {\n                bh(new TpEvent(this));\n            });\n            return this;\n        }\n    }\n\n    class Emitter {\n        constructor() {\n            this.observers_ = {};\n        }\n        on(eventName, handler) {\n            let observers = this.observers_[eventName];\n            if (!observers) {\n                observers = this.observers_[eventName] = [];\n            }\n            observers.push({\n                handler: handler,\n            });\n            return this;\n        }\n        off(eventName, handler) {\n            const observers = this.observers_[eventName];\n            if (observers) {\n                this.observers_[eventName] = observers.filter((observer) => {\n                    return observer.handler !== handler;\n                });\n            }\n            return this;\n        }\n        emit(eventName, event) {\n            const observers = this.observers_[eventName];\n            if (!observers) {\n                return;\n            }\n            observers.forEach((observer) => {\n                observer.handler(event);\n            });\n        }\n    }\n\n    const PREFIX = 'tp';\n    function ClassName(viewName) {\n        const fn = (opt_elementName, opt_modifier) => {\n            return [\n                PREFIX,\n                '-',\n                viewName,\n                'v',\n                opt_elementName ? `_${opt_elementName}` : '',\n                opt_modifier ? `-${opt_modifier}` : '',\n            ].join('');\n        };\n        return fn;\n    }\n\n    function compose(h1, h2) {\n        return (input) => h2(h1(input));\n    }\n    function extractValue(ev) {\n        return ev.rawValue;\n    }\n    function bindValue(value, applyValue) {\n        value.emitter.on('change', compose(extractValue, applyValue));\n        applyValue(value.rawValue);\n    }\n    function bindValueMap(valueMap, key, applyValue) {\n        bindValue(valueMap.value(key), applyValue);\n    }\n\n    function applyClass(elem, className, active) {\n        if (active) {\n            elem.classList.add(className);\n        }\n        else {\n            elem.classList.remove(className);\n        }\n    }\n    function valueToClassName(elem, className) {\n        return (value) => {\n            applyClass(elem, className, value);\n        };\n    }\n    function bindValueToTextContent(value, elem) {\n        bindValue(value, (text) => {\n            elem.textContent = text !== null && text !== void 0 ? text : '';\n        });\n    }\n\n    const className$q = ClassName('btn');\n    class ButtonView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$q());\n            config.viewProps.bindClassModifiers(this.element);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$q('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$q('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n        }\n    }\n\n    class ButtonController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new ButtonView(doc, {\n                props: this.props,\n                viewProps: this.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class BoundValue {\n        constructor(initialValue, config) {\n            var _a;\n            this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n            this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n            this.emitter = new Emitter();\n            this.rawValue_ = initialValue;\n        }\n        get constraint() {\n            return this.constraint_;\n        }\n        get rawValue() {\n            return this.rawValue_;\n        }\n        set rawValue(rawValue) {\n            this.setRawValue(rawValue, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(rawValue, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const constrainedValue = this.constraint_\n                ? this.constraint_.constrain(rawValue)\n                : rawValue;\n            const changed = !this.equals_(this.rawValue_, constrainedValue);\n            if (!changed && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.rawValue_ = constrainedValue;\n            this.emitter.emit('change', {\n                options: opts,\n                rawValue: constrainedValue,\n                sender: this,\n            });\n        }\n    }\n\n    class PrimitiveValue {\n        constructor(initialValue) {\n            this.emitter = new Emitter();\n            this.value_ = initialValue;\n        }\n        get rawValue() {\n            return this.value_;\n        }\n        set rawValue(value) {\n            this.setRawValue(value, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(value, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            if (this.value_ === value && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.value_ = value;\n            this.emitter.emit('change', {\n                options: opts,\n                rawValue: this.value_,\n                sender: this,\n            });\n        }\n    }\n\n    function createValue(initialValue, config) {\n        const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n        const equals = config === null || config === void 0 ? void 0 : config.equals;\n        if (!constraint && !equals) {\n            return new PrimitiveValue(initialValue);\n        }\n        return new BoundValue(initialValue, config);\n    }\n\n    class ValueMap {\n        constructor(valueMap) {\n            this.emitter = new Emitter();\n            this.valMap_ = valueMap;\n            for (const key in this.valMap_) {\n                const v = this.valMap_[key];\n                v.emitter.on('change', () => {\n                    this.emitter.emit('change', {\n                        key: key,\n                        sender: this,\n                    });\n                });\n            }\n        }\n        static createCore(initialValue) {\n            const keys = Object.keys(initialValue);\n            return keys.reduce((o, key) => {\n                return Object.assign(o, {\n                    [key]: createValue(initialValue[key]),\n                });\n            }, {});\n        }\n        static fromObject(initialValue) {\n            const core = this.createCore(initialValue);\n            return new ValueMap(core);\n        }\n        get(key) {\n            return this.valMap_[key].rawValue;\n        }\n        set(key, value) {\n            this.valMap_[key].rawValue = value;\n        }\n        value(key) {\n            return this.valMap_[key];\n        }\n    }\n\n    function parseObject(value, keyToParserMap) {\n        const keys = Object.keys(keyToParserMap);\n        const result = keys.reduce((tmp, key) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const parser = keyToParserMap[key];\n            const result = parser(value[key]);\n            return result.succeeded\n                ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n        }, {});\n        return forceCast(result);\n    }\n    function parseArray(value, parseItem) {\n        return value.reduce((tmp, item) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const result = parseItem(item);\n            if (!result.succeeded || result.value === undefined) {\n                return undefined;\n            }\n            return [...tmp, result.value];\n        }, []);\n    }\n    function isObject(value) {\n        if (value === null) {\n            return false;\n        }\n        return typeof value === 'object';\n    }\n    function createParamsParserBuilder(parse) {\n        return (optional) => (v) => {\n            if (!optional && v === undefined) {\n                return {\n                    succeeded: false,\n                    value: undefined,\n                };\n            }\n            if (optional && v === undefined) {\n                return {\n                    succeeded: true,\n                    value: undefined,\n                };\n            }\n            const result = parse(v);\n            return result !== undefined\n                ? {\n                    succeeded: true,\n                    value: result,\n                }\n                : {\n                    succeeded: false,\n                    value: undefined,\n                };\n        };\n    }\n    function createParamsParserBuilders(optional) {\n        return {\n            custom: (parse) => createParamsParserBuilder(parse)(optional),\n            boolean: createParamsParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n            number: createParamsParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n            string: createParamsParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n            function: createParamsParserBuilder((v) =>\n            typeof v === 'function' ? v : undefined)(optional),\n            constant: (value) => createParamsParserBuilder((v) => (v === value ? value : undefined))(optional),\n            raw: createParamsParserBuilder((v) => v)(optional),\n            object: (keyToParserMap) => createParamsParserBuilder((v) => {\n                if (!isObject(v)) {\n                    return undefined;\n                }\n                return parseObject(v, keyToParserMap);\n            })(optional),\n            array: (itemParser) => createParamsParserBuilder((v) => {\n                if (!Array.isArray(v)) {\n                    return undefined;\n                }\n                return parseArray(v, itemParser);\n            })(optional),\n        };\n    }\n    const ParamsParsers = {\n        optional: createParamsParserBuilders(true),\n        required: createParamsParserBuilders(false),\n    };\n    function parseParams(value, keyToParserMap) {\n        const result = ParamsParsers.required.object(keyToParserMap)(value);\n        return result.succeeded ? result.value : undefined;\n    }\n\n    function disposeElement(elem) {\n        if (elem && elem.parentElement) {\n            elem.parentElement.removeChild(elem);\n        }\n        return null;\n    }\n\n    function getAllBladePositions() {\n        return ['veryfirst', 'first', 'last', 'verylast'];\n    }\n\n    const className$p = ClassName('');\n    const POS_TO_CLASS_NAME_MAP = {\n        veryfirst: 'vfst',\n        first: 'fst',\n        last: 'lst',\n        verylast: 'vlst',\n    };\n    class BladeController {\n        constructor(config) {\n            this.parent_ = null;\n            this.blade = config.blade;\n            this.view = config.view;\n            this.viewProps = config.viewProps;\n            const elem = this.view.element;\n            this.blade.value('positions').emitter.on('change', () => {\n                getAllBladePositions().forEach((pos) => {\n                    elem.classList.remove(className$p(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n                this.blade.get('positions').forEach((pos) => {\n                    elem.classList.add(className$p(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n            });\n            this.viewProps.handleDispose(() => {\n                disposeElement(elem);\n            });\n        }\n        get parent() {\n            return this.parent_;\n        }\n    }\n\n    const SVG_NS = 'http://www.w3.org/2000/svg';\n    function forceReflow(element) {\n        element.offsetHeight;\n    }\n    function disableTransitionTemporarily(element, callback) {\n        const t = element.style.transition;\n        element.style.transition = 'none';\n        callback();\n        element.style.transition = t;\n    }\n    function supportsTouch(doc) {\n        return doc.ontouchstart !== undefined;\n    }\n    function getGlobalObject() {\n        return new Function('return this')();\n    }\n    function getWindowDocument() {\n        const globalObj = forceCast(getGlobalObject());\n        return globalObj.document;\n    }\n    function getCanvasContext(canvasElement) {\n        const win = canvasElement.ownerDocument.defaultView;\n        if (!win) {\n            return null;\n        }\n        const isBrowser = 'document' in win;\n        return isBrowser ? canvasElement.getContext('2d') : null;\n    }\n    const ICON_ID_TO_INNER_HTML_MAP = {\n        check: '<path d=\"M2 8l4 4l8 -8\"/>',\n        dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n        p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n    };\n    function createSvgIconElement(document, iconId) {\n        const elem = document.createElementNS(SVG_NS, 'svg');\n        elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n        return elem;\n    }\n    function insertElementAt(parentElement, element, index) {\n        parentElement.insertBefore(element, parentElement.children[index]);\n    }\n    function removeElement(element) {\n        if (element.parentElement) {\n            element.parentElement.removeChild(element);\n        }\n    }\n    function removeChildElements(element) {\n        while (element.children.length > 0) {\n            element.removeChild(element.children[0]);\n        }\n    }\n    function removeChildNodes(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[0]);\n        }\n    }\n    function findNextTarget(ev) {\n        if (ev.relatedTarget) {\n            return forceCast(ev.relatedTarget);\n        }\n        if ('explicitOriginalTarget' in ev) {\n            return ev.explicitOriginalTarget;\n        }\n        return null;\n    }\n\n    const className$o = ClassName('lbl');\n    function createLabelNode(doc, label) {\n        const frag = doc.createDocumentFragment();\n        const lineNodes = label.split('\\n').map((line) => {\n            return doc.createTextNode(line);\n        });\n        lineNodes.forEach((lineNode, index) => {\n            if (index > 0) {\n                frag.appendChild(doc.createElement('br'));\n            }\n            frag.appendChild(lineNode);\n        });\n        return frag;\n    }\n    class LabelView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$o());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('div');\n            labelElem.classList.add(className$o('l'));\n            bindValueMap(config.props, 'label', (value) => {\n                if (isEmpty(value)) {\n                    this.element.classList.add(className$o(undefined, 'nol'));\n                }\n                else {\n                    this.element.classList.remove(className$o(undefined, 'nol'));\n                    removeChildNodes(labelElem);\n                    labelElem.appendChild(createLabelNode(doc, value));\n                }\n            });\n            this.element.appendChild(labelElem);\n            this.labelElement = labelElem;\n            const valueElem = doc.createElement('div');\n            valueElem.classList.add(className$o('v'));\n            this.element.appendChild(valueElem);\n            this.valueElement = valueElem;\n        }\n    }\n\n    class LabelController extends BladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    const ButtonBladePlugin = {\n        id: 'button',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('button'),\n                label: p.optional.string,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new LabelController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: new ButtonController(args.document, {\n                    props: ValueMap.fromObject({\n                        title: args.params.title,\n                    }),\n                    viewProps: args.viewProps,\n                }),\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabelController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ButtonController)) {\n                return null;\n            }\n            return new ButtonApi(args.controller);\n        },\n    };\n\n    class ValueBladeController extends BladeController {\n        constructor(config) {\n            super(config);\n            this.value = config.value;\n        }\n    }\n\n    function createBlade() {\n        return new ValueMap({\n            positions: createValue([], {\n                equals: deepEqualsArray,\n            }),\n        });\n    }\n\n    class Foldable extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(expanded) {\n            const coreObj = {\n                completed: true,\n                expanded: expanded,\n                expandedHeight: null,\n                shouldFixHeight: false,\n                temporaryExpanded: null,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new Foldable(core);\n        }\n        get styleExpanded() {\n            var _a;\n            return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n        }\n        get styleHeight() {\n            if (!this.styleExpanded) {\n                return '0';\n            }\n            const exHeight = this.get('expandedHeight');\n            if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n                return `${exHeight}px`;\n            }\n            return 'auto';\n        }\n        bindExpandedClass(elem, expandedClassName) {\n            bindValueMap(this, 'expanded', () => {\n                const expanded = this.styleExpanded;\n                if (expanded) {\n                    elem.classList.add(expandedClassName);\n                }\n                else {\n                    elem.classList.remove(expandedClassName);\n                }\n            });\n        }\n    }\n    function computeExpandedFolderHeight(folder, containerElement) {\n        let height = 0;\n        disableTransitionTemporarily(containerElement, () => {\n            folder.set('expandedHeight', null);\n            folder.set('temporaryExpanded', true);\n            forceReflow(containerElement);\n            height = containerElement.clientHeight;\n            folder.set('temporaryExpanded', null);\n            forceReflow(containerElement);\n        });\n        return height;\n    }\n    function applyHeight(foldable, elem) {\n        elem.style.height = foldable.styleHeight;\n    }\n    function bindFoldable(foldable, elem) {\n        foldable.value('expanded').emitter.on('beforechange', () => {\n            foldable.set('completed', false);\n            if (isEmpty(foldable.get('expandedHeight'))) {\n                foldable.set('expandedHeight', computeExpandedFolderHeight(foldable, elem));\n            }\n            foldable.set('shouldFixHeight', true);\n            forceReflow(elem);\n        });\n        foldable.emitter.on('change', () => {\n            applyHeight(foldable, elem);\n        });\n        applyHeight(foldable, elem);\n        elem.addEventListener('transitionend', (ev) => {\n            if (ev.propertyName !== 'height') {\n                return;\n            }\n            foldable.set('shouldFixHeight', false);\n            foldable.set('expandedHeight', null);\n            foldable.set('completed', true);\n        });\n    }\n\n    class RackLikeApi extends BladeApi {\n        constructor(controller, rackApi) {\n            super(controller);\n            this.rackApi_ = rackApi;\n        }\n    }\n\n    function addButtonAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n    }\n    function addFolderAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n    }\n    function addSeparatorAsBlade(api, opt_params) {\n        const params = opt_params || {};\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'separator' }));\n    }\n    function addTabAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n    }\n\n    class NestedOrderedSet {\n        constructor(extract) {\n            this.emitter = new Emitter();\n            this.items_ = [];\n            this.cache_ = new Set();\n            this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n            this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n            this.extract_ = extract;\n        }\n        get items() {\n            return this.items_;\n        }\n        allItems() {\n            return Array.from(this.cache_);\n        }\n        find(callback) {\n            for (const item of this.allItems()) {\n                if (callback(item)) {\n                    return item;\n                }\n            }\n            return null;\n        }\n        includes(item) {\n            return this.cache_.has(item);\n        }\n        add(item, opt_index) {\n            if (this.includes(item)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const index = opt_index !== undefined ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            this.cache_.add(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.on('add', this.onSubListAdd_);\n                subList.emitter.on('remove', this.onSubListRemove_);\n                subList.allItems().forEach((item) => {\n                    this.cache_.add(item);\n                });\n            }\n            this.emitter.emit('add', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            this.cache_.delete(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.off('add', this.onSubListAdd_);\n                subList.emitter.off('remove', this.onSubListRemove_);\n            }\n            this.emitter.emit('remove', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        onSubListAdd_(ev) {\n            this.cache_.add(ev.item);\n            this.emitter.emit('add', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n        onSubListRemove_(ev) {\n            this.cache_.delete(ev.item);\n            this.emitter.emit('remove', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n    }\n\n    class InputBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingChange_ = this.onBindingChange_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('change', this.onBindingChange_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingChange_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('change', {\n                event: new TpChangeEvent(this, forceCast(value), this.controller_.binding.target.presetKey, ev.options.last),\n            });\n        }\n    }\n\n    class InputBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n        }\n    }\n\n    class MonitorBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingUpdate_ = this.onBindingUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('update', this.onBindingUpdate_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingUpdate_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(this, forceCast(value), this.controller_.binding.target.presetKey),\n            });\n        }\n    }\n\n    class MonitorBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n            this.viewProps.bindDisabled(this.binding.ticker);\n            this.viewProps.handleDispose(() => {\n                this.binding.dispose();\n            });\n        }\n    }\n\n    function findSubBladeApiSet(api) {\n        if (api instanceof RackApi) {\n            return api['apiSet_'];\n        }\n        if (api instanceof RackLikeApi) {\n            return api['rackApi_']['apiSet_'];\n        }\n        return null;\n    }\n    function getApiByController(apiSet, controller) {\n        const api = apiSet.find((api) => api.controller_ === controller);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return api;\n    }\n    function createBindingTarget(obj, key, opt_id) {\n        if (!BindingTarget.isBindable(obj)) {\n            throw TpError.notBindable();\n        }\n        return new BindingTarget(obj, key, opt_id);\n    }\n    class RackApi extends BladeApi {\n        constructor(controller, pool) {\n            super(controller);\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            this.onRackInputChange_ = this.onRackInputChange_.bind(this);\n            this.onRackMonitorUpdate_ = this.onRackMonitorUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.apiSet_ = new NestedOrderedSet(findSubBladeApiSet);\n            this.pool_ = pool;\n            const rack = this.controller_.rack;\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            rack.emitter.on('inputchange', this.onRackInputChange_);\n            rack.emitter.on('monitorupdate', this.onRackMonitorUpdate_);\n            rack.children.forEach((bc) => {\n                this.setUpApi_(bc);\n            });\n        }\n        get children() {\n            return this.controller_.rack.children.map((bc) => getApiByController(this.apiSet_, bc));\n        }\n        addInput(object, key, opt_params) {\n            const params = opt_params || {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createInput(doc, createBindingTarget(object, key, params.presetKey), params);\n            const api = new InputBindingApi(bc);\n            return this.add(api, params.index);\n        }\n        addMonitor(object, key, opt_params) {\n            const params = opt_params || {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createMonitor(doc, createBindingTarget(object, key), params);\n            const api = new MonitorBindingApi(bc);\n            return forceCast(this.add(api, params.index));\n        }\n        addFolder(params) {\n            return addFolderAsBlade(this, params);\n        }\n        addButton(params) {\n            return addButtonAsBlade(this, params);\n        }\n        addSeparator(opt_params) {\n            return addSeparatorAsBlade(this, opt_params);\n        }\n        addTab(params) {\n            return addTabAsBlade(this, params);\n        }\n        add(api, opt_index) {\n            this.controller_.rack.add(api.controller_, opt_index);\n            const gapi = this.apiSet_.find((a) => a.controller_ === api.controller_);\n            if (gapi) {\n                this.apiSet_.remove(gapi);\n            }\n            this.apiSet_.add(api);\n            return api;\n        }\n        remove(api) {\n            this.controller_.rack.remove(api.controller_);\n        }\n        addBlade(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createBlade(doc, params);\n            const api = this.pool_.createBladeApi(bc);\n            return this.add(api, params.index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpApi_(bc) {\n            const api = this.apiSet_.find((api) => api.controller_ === bc);\n            if (!api) {\n                this.apiSet_.add(this.pool_.createBladeApi(bc));\n            }\n        }\n        onRackAdd_(ev) {\n            this.setUpApi_(ev.bladeController);\n        }\n        onRackRemove_(ev) {\n            if (ev.isRoot) {\n                const api = getApiByController(this.apiSet_, ev.bladeController);\n                this.apiSet_.remove(api);\n            }\n        }\n        onRackInputChange_(ev) {\n            const bc = ev.bladeController;\n            if (bc instanceof InputBindingController) {\n                const api = getApiByController(this.apiSet_, bc);\n                const binding = bc.binding;\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, forceCast(binding.target.read()), binding.target.presetKey, ev.options.last),\n                });\n            }\n            else if (bc instanceof ValueBladeController) {\n                const api = getApiByController(this.apiSet_, bc);\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, bc.value.rawValue, undefined, ev.options.last),\n                });\n            }\n        }\n        onRackMonitorUpdate_(ev) {\n            if (!(ev.bladeController instanceof MonitorBindingController)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = getApiByController(this.apiSet_, ev.bladeController);\n            const binding = ev.bladeController.binding;\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(api, forceCast(binding.target.read()), binding.target.presetKey),\n            });\n        }\n    }\n\n    class FolderApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.emitter_ = new Emitter();\n            this.controller_.foldable\n                .value('expanded')\n                .emitter.on('change', (ev) => {\n                this.emitter_.emit('fold', {\n                    event: new TpFoldEvent(this, ev.sender.rawValue),\n                });\n            });\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n        }\n        get expanded() {\n            return this.controller_.foldable.get('expanded');\n        }\n        set expanded(expanded) {\n            this.controller_.foldable.set('expanded', expanded);\n        }\n        get title() {\n            return this.controller_.props.get('title');\n        }\n        set title(title) {\n            this.controller_.props.set('title', title);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            return this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class RackLikeController extends BladeController {\n        constructor(config) {\n            super({\n                blade: config.blade,\n                view: config.view,\n                viewProps: config.rackController.viewProps,\n            });\n            this.rackController = config.rackController;\n        }\n    }\n\n    class PlainView {\n        constructor(doc, config) {\n            const className = ClassName(config.viewName);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n        }\n    }\n\n    function findInputBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof InputBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findMonitorBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof MonitorBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findValueBladeController(bcs, v) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof ValueBladeController && bc.value === v) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findSubRack(bc) {\n        if (bc instanceof RackController) {\n            return bc.rack;\n        }\n        if (bc instanceof RackLikeController) {\n            return bc.rackController.rack;\n        }\n        return null;\n    }\n    function findSubBladeControllerSet(bc) {\n        const rack = findSubRack(bc);\n        return rack ? rack['bcSet_'] : null;\n    }\n    class BladeRack {\n        constructor(blade) {\n            var _a;\n            this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n            this.onSetAdd_ = this.onSetAdd_.bind(this);\n            this.onSetRemove_ = this.onSetRemove_.bind(this);\n            this.onChildDispose_ = this.onChildDispose_.bind(this);\n            this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n            this.onChildInputChange_ = this.onChildInputChange_.bind(this);\n            this.onChildMonitorUpdate_ = this.onChildMonitorUpdate_.bind(this);\n            this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n            this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n            this.onDescendantLayout_ = this.onDescendantLayout_.bind(this);\n            this.onDescendantInputChange_ = this.onDescendantInputChange_.bind(this);\n            this.onDescendantMonitorUpdate_ =\n                this.onDescendantMonitorUpdate_.bind(this);\n            this.emitter = new Emitter();\n            this.blade_ = blade !== null && blade !== void 0 ? blade : null;\n            (_a = this.blade_) === null || _a === void 0 ? void 0 : _a.value('positions').emitter.on('change', this.onBladePositionsChange_);\n            this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n            this.bcSet_.emitter.on('add', this.onSetAdd_);\n            this.bcSet_.emitter.on('remove', this.onSetRemove_);\n        }\n        get children() {\n            return this.bcSet_.items;\n        }\n        add(bc, opt_index) {\n            if (bc.parent) {\n                bc.parent.remove(bc);\n            }\n            bc['parent_'] = this;\n            this.bcSet_.add(bc, opt_index);\n        }\n        remove(bc) {\n            bc['parent_'] = null;\n            this.bcSet_.remove(bc);\n        }\n        find(controllerClass) {\n            return forceCast(this.bcSet_.allItems().filter((bc) => {\n                return bc instanceof controllerClass;\n            }));\n        }\n        onSetAdd_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('add', {\n                bladeController: ev.item,\n                index: ev.index,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n            bc.blade\n                .value('positions')\n                .emitter.on('change', this.onChildPositionsChange_);\n            bc.viewProps.handleDispose(this.onChildDispose_);\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.on('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.on('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.on('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.on('layout', this.onDescendantLayout_);\n                    emitter.on('inputchange', this.onDescendantInputChange_);\n                    emitter.on('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        onSetRemove_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('remove', {\n                bladeController: ev.item,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.off('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.off('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.off('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.off('layout', this.onDescendantLayout_);\n                    emitter.off('inputchange', this.onDescendantInputChange_);\n                    emitter.off('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        updatePositions_() {\n            const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n            const firstVisibleItem = visibleItems[0];\n            const lastVisibleItem = visibleItems[visibleItems.length - 1];\n            this.bcSet_.items.forEach((bc) => {\n                const ps = [];\n                if (bc === firstVisibleItem) {\n                    ps.push('first');\n                    if (!this.blade_ ||\n                        this.blade_.get('positions').includes('veryfirst')) {\n                        ps.push('veryfirst');\n                    }\n                }\n                if (bc === lastVisibleItem) {\n                    ps.push('last');\n                    if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                        ps.push('verylast');\n                    }\n                }\n                bc.blade.set('positions', ps);\n            });\n        }\n        onChildPositionsChange_() {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildViewPropsChange_(_ev) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildDispose_() {\n            const disposedUcs = this.bcSet_.items.filter((bc) => {\n                return bc.viewProps.get('disposed');\n            });\n            disposedUcs.forEach((bc) => {\n                this.bcSet_.remove(bc);\n            });\n        }\n        onChildInputChange_(ev) {\n            const bc = findInputBindingController(this.find(InputBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onChildMonitorUpdate_(ev) {\n            const bc = findMonitorBindingController(this.find(MonitorBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('monitorupdate', {\n                bladeController: bc,\n                sender: this,\n            });\n        }\n        onChildValueChange_(ev) {\n            const bc = findValueBladeController(this.find(ValueBladeController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantLayout_(_) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onDescendantInputChange_(ev) {\n            this.emitter.emit('inputchange', {\n                bladeController: ev.bladeController,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantMonitorUpdate_(ev) {\n            this.emitter.emit('monitorupdate', {\n                bladeController: ev.bladeController,\n                sender: this,\n            });\n        }\n        onBladePositionsChange_() {\n            this.updatePositions_();\n        }\n    }\n\n    class RackController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new PlainView(doc, {\n                    viewName: 'brk',\n                    viewProps: config.viewProps,\n                }) }));\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            const rack = new BladeRack(config.root ? undefined : config.blade);\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            this.rack = rack;\n            this.viewProps.handleDispose(() => {\n                for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                    const bc = this.rack.children[i];\n                    bc.viewProps.set('disposed', true);\n                }\n            });\n        }\n        onRackAdd_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            insertElementAt(this.view.element, ev.bladeController.view.element, ev.index);\n        }\n        onRackRemove_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            removeElement(ev.bladeController.view.element);\n        }\n    }\n\n    const bladeContainerClassName = ClassName('cnt');\n\n    class FolderView {\n        constructor(doc, config) {\n            this.className_ = ClassName(config.viewName || 'fld');\n            this.element = doc.createElement('div');\n            this.element.classList.add(this.className_(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            this.foldable_ = config.foldable;\n            this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n            bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(this.className_('b'));\n            bindValueMap(config.props, 'title', (title) => {\n                if (isEmpty(title)) {\n                    this.element.classList.add(this.className_(undefined, 'not'));\n                }\n                else {\n                    this.element.classList.remove(this.className_(undefined, 'not'));\n                }\n            });\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(this.className_('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(this.className_('m'));\n            this.buttonElement.appendChild(markElem);\n            const containerElem = config.containerElement;\n            containerElem.classList.add(this.className_('c'));\n            this.element.appendChild(containerElem);\n            this.containerElement = containerElem;\n        }\n    }\n\n    class FolderController extends RackLikeController {\n        constructor(doc, config) {\n            var _a;\n            const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n            const rc = new RackController(doc, {\n                blade: config.blade,\n                root: config.root,\n                viewProps: config.viewProps,\n            });\n            super(Object.assign(Object.assign({}, config), { rackController: rc, view: new FolderView(doc, {\n                    containerElement: rc.view.element,\n                    foldable: foldable,\n                    props: config.props,\n                    viewName: config.root ? 'rot' : undefined,\n                    viewProps: config.viewProps,\n                }) }));\n            this.onTitleClick_ = this.onTitleClick_.bind(this);\n            this.props = config.props;\n            this.foldable = foldable;\n            bindFoldable(this.foldable, this.view.containerElement);\n            this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n        }\n        get document() {\n            return this.view.element.ownerDocument;\n        }\n        onTitleClick_() {\n            this.foldable.set('expanded', !this.foldable.get('expanded'));\n        }\n    }\n\n    const FolderBladePlugin = {\n        id: 'folder',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('folder'),\n                expanded: p.optional.boolean,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new FolderController(args.document, {\n                blade: args.blade,\n                expanded: args.params.expanded,\n                props: ValueMap.fromObject({\n                    title: args.params.title,\n                }),\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof FolderController)) {\n                return null;\n            }\n            return new FolderApi(args.controller, args.pool);\n        },\n    };\n\n    class LabeledValueController extends ValueBladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { value: config.valueController.value, view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    class SeparatorApi extends BladeApi {\n    }\n\n    const className$n = ClassName('spr');\n    class SeparatorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$n());\n            config.viewProps.bindClassModifiers(this.element);\n            const hrElem = doc.createElement('hr');\n            hrElem.classList.add(className$n('r'));\n            this.element.appendChild(hrElem);\n        }\n    }\n\n    class SeparatorController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                    viewProps: config.viewProps,\n                }) }));\n        }\n    }\n\n    const SeparatorBladePlugin = {\n        id: 'separator',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                view: p.required.constant('separator'),\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new SeparatorController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof SeparatorController)) {\n                return null;\n            }\n            return new SeparatorApi(args.controller);\n        },\n    };\n\n    const className$m = ClassName('');\n    function valueToModifier(elem, modifier) {\n        return valueToClassName(elem, className$m(undefined, modifier));\n    }\n    class ViewProps extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(opt_initialValue) {\n            var _a, _b;\n            const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n            const coreObj = {\n                disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n                disposed: false,\n                hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new ViewProps(core);\n        }\n        bindClassModifiers(elem) {\n            bindValueMap(this, 'disabled', valueToModifier(elem, 'disabled'));\n            bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n        }\n        bindDisabled(target) {\n            bindValueMap(this, 'disabled', (disabled) => {\n                target.disabled = disabled;\n            });\n        }\n        bindTabIndex(elem) {\n            bindValueMap(this, 'disabled', (disabled) => {\n                elem.tabIndex = disabled ? -1 : 0;\n            });\n        }\n        handleDispose(callback) {\n            this.value('disposed').emitter.on('change', (disposed) => {\n                if (disposed) {\n                    callback();\n                }\n            });\n        }\n    }\n\n    const className$l = ClassName('tbi');\n    class TabItemView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$l());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValueMap(config.props, 'selected', (selected) => {\n                if (selected) {\n                    this.element.classList.add(className$l(undefined, 'sel'));\n                }\n                else {\n                    this.element.classList.remove(className$l(undefined, 'sel'));\n                }\n            });\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$l('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$l('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n        }\n    }\n\n    class TabItemController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new TabItemView(doc, {\n                props: config.props,\n                viewProps: config.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class TabPageController {\n        constructor(doc, config) {\n            this.onItemClick_ = this.onItemClick_.bind(this);\n            this.ic_ = new TabItemController(doc, {\n                props: config.itemProps,\n                viewProps: ViewProps.create(),\n            });\n            this.ic_.emitter.on('click', this.onItemClick_);\n            this.cc_ = new RackController(doc, {\n                blade: createBlade(),\n                viewProps: ViewProps.create(),\n            });\n            this.props = config.props;\n            bindValueMap(this.props, 'selected', (selected) => {\n                this.itemController.props.set('selected', selected);\n                this.contentController.viewProps.set('hidden', !selected);\n            });\n        }\n        get itemController() {\n            return this.ic_;\n        }\n        get contentController() {\n            return this.cc_;\n        }\n        onItemClick_() {\n            this.props.set('selected', true);\n        }\n    }\n\n    class TabPageApi {\n        constructor(controller, contentRackApi) {\n            this.controller_ = controller;\n            this.rackApi_ = contentRackApi;\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.itemController.props.set('title', title);\n        }\n        get selected() {\n            return this.controller_.props.get('selected');\n        }\n        set selected(selected) {\n            this.controller_.props.set('selected', selected);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n    }\n\n    class TabApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.emitter_ = new Emitter();\n            this.pageApiMap_ = new Map();\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n            this.controller_.pageSet.emitter.on('add', this.onPageAdd_);\n            this.controller_.pageSet.emitter.on('remove', this.onPageRemove_);\n            this.controller_.pageSet.items.forEach((pc) => {\n                this.setUpPageApi_(pc);\n            });\n        }\n        get pages() {\n            return this.controller_.pageSet.items.map((pc) => {\n                const api = this.pageApiMap_.get(pc);\n                if (!api) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return api;\n            });\n        }\n        addPage(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const pc = new TabPageController(doc, {\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: params.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n            });\n            this.controller_.add(pc, params.index);\n            const api = this.pageApiMap_.get(pc);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n        removePage(index) {\n            this.controller_.remove(index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpPageApi_(pc) {\n            const rackApi = this.rackApi_['apiSet_'].find((api) => api.controller_ === pc.contentController);\n            if (!rackApi) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = new TabPageApi(pc, rackApi);\n            this.pageApiMap_.set(pc, api);\n        }\n        onPageAdd_(ev) {\n            this.setUpPageApi_(ev.item);\n        }\n        onPageRemove_(ev) {\n            const api = this.pageApiMap_.get(ev.item);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.pageApiMap_.delete(ev.item);\n        }\n    }\n\n    const className$k = ClassName('tab');\n    class TabView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$k(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.empty, valueToClassName(this.element, className$k(undefined, 'nop')));\n            const itemsElem = doc.createElement('div');\n            itemsElem.classList.add(className$k('i'));\n            this.element.appendChild(itemsElem);\n            this.itemsElement = itemsElem;\n            const contentsElem = config.contentsElement;\n            contentsElem.classList.add(className$k('c'));\n            this.element.appendChild(contentsElem);\n            this.contentsElement = contentsElem;\n        }\n    }\n\n    class TabController extends RackLikeController {\n        constructor(doc, config) {\n            const cr = new RackController(doc, {\n                blade: config.blade,\n                viewProps: config.viewProps,\n            });\n            const empty = createValue(true);\n            super({\n                blade: config.blade,\n                rackController: cr,\n                view: new TabView(doc, {\n                    contentsElement: cr.view.element,\n                    empty: empty,\n                    viewProps: config.viewProps,\n                }),\n            });\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.onPageSelectedChange_ = this.onPageSelectedChange_.bind(this);\n            this.pageSet_ = new NestedOrderedSet(() => null);\n            this.pageSet_.emitter.on('add', this.onPageAdd_);\n            this.pageSet_.emitter.on('remove', this.onPageRemove_);\n            this.empty_ = empty;\n            this.applyPages_();\n        }\n        get pageSet() {\n            return this.pageSet_;\n        }\n        add(pc, opt_index) {\n            this.pageSet_.add(pc, opt_index !== null && opt_index !== void 0 ? opt_index : this.pageSet_.items.length);\n        }\n        remove(index) {\n            this.pageSet_.remove(this.pageSet_.items[index]);\n        }\n        applyPages_() {\n            this.keepSelection_();\n            this.empty_.rawValue = this.pageSet_.items.length === 0;\n        }\n        onPageAdd_(ev) {\n            const pc = ev.item;\n            insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n            this.rackController.rack.add(pc.contentController, ev.index);\n            pc.props.value('selected').emitter.on('change', this.onPageSelectedChange_);\n            this.applyPages_();\n        }\n        onPageRemove_(ev) {\n            const pc = ev.item;\n            removeElement(pc.itemController.view.element);\n            this.rackController.rack.remove(pc.contentController);\n            pc.props\n                .value('selected')\n                .emitter.off('change', this.onPageSelectedChange_);\n            this.applyPages_();\n        }\n        keepSelection_() {\n            if (this.pageSet_.items.length === 0) {\n                return;\n            }\n            const firstSelIndex = this.pageSet_.items.findIndex((pc) => pc.props.get('selected'));\n            if (firstSelIndex < 0) {\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === 0);\n                });\n            }\n            else {\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === firstSelIndex);\n                });\n            }\n        }\n        onPageSelectedChange_(ev) {\n            if (ev.rawValue) {\n                const index = this.pageSet_.items.findIndex((pc) => pc.props.value('selected') === ev.sender);\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === index);\n                });\n            }\n            else {\n                this.keepSelection_();\n            }\n        }\n    }\n\n    const TabBladePlugin = {\n        id: 'tab',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                pages: p.required.array(p.required.object({ title: p.required.string })),\n                view: p.required.constant('tab'),\n            });\n            if (!result || result.pages.length === 0) {\n                return null;\n            }\n            return { params: result };\n        },\n        controller(args) {\n            const c = new TabController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n            args.params.pages.forEach((p) => {\n                const pc = new TabPageController(args.document, {\n                    itemProps: ValueMap.fromObject({\n                        selected: false,\n                        title: p.title,\n                    }),\n                    props: ValueMap.fromObject({\n                        selected: false,\n                    }),\n                });\n                c.add(pc);\n            });\n            return c;\n        },\n        api(args) {\n            if (!(args.controller instanceof TabController)) {\n                return null;\n            }\n            return new TabApi(args.controller, args.pool);\n        },\n    };\n\n    function createBladeController(plugin, args) {\n        const ac = plugin.accept(args.params);\n        if (!ac) {\n            return null;\n        }\n        const disabled = ParamsParsers.optional.boolean(args.params['disabled']).value;\n        const hidden = ParamsParsers.optional.boolean(args.params['hidden']).value;\n        return plugin.controller({\n            blade: createBlade(),\n            document: args.document,\n            params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: disabled, hidden: hidden })),\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n    }\n\n    class ManualTicker {\n        constructor() {\n            this.disabled = false;\n            this.emitter = new Emitter();\n        }\n        dispose() { }\n        tick() {\n            if (this.disabled) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class IntervalTicker {\n        constructor(doc, interval) {\n            this.disabled_ = false;\n            this.timerId_ = null;\n            this.onTick_ = this.onTick_.bind(this);\n            this.doc_ = doc;\n            this.emitter = new Emitter();\n            this.interval_ = interval;\n            this.setTimer_();\n        }\n        get disabled() {\n            return this.disabled_;\n        }\n        set disabled(inactive) {\n            this.disabled_ = inactive;\n            if (this.disabled_) {\n                this.clearTimer_();\n            }\n            else {\n                this.setTimer_();\n            }\n        }\n        dispose() {\n            this.clearTimer_();\n        }\n        clearTimer_() {\n            if (this.timerId_ === null) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                win.clearInterval(this.timerId_);\n            }\n            this.timerId_ = null;\n        }\n        setTimer_() {\n            this.clearTimer_();\n            if (this.interval_ <= 0) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n            }\n        }\n        onTick_() {\n            if (this.disabled_) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class CompositeConstraint {\n        constructor(constraints) {\n            this.constraints = constraints;\n        }\n        constrain(value) {\n            return this.constraints.reduce((result, c) => {\n                return c.constrain(result);\n            }, value);\n        }\n    }\n    function findConstraint(c, constraintClass) {\n        if (c instanceof constraintClass) {\n            return c;\n        }\n        if (c instanceof CompositeConstraint) {\n            const result = c.constraints.reduce((tmpResult, sc) => {\n                if (tmpResult) {\n                    return tmpResult;\n                }\n                return sc instanceof constraintClass ? sc : null;\n            }, null);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    }\n\n    class ListConstraint {\n        constructor(options) {\n            this.options = options;\n        }\n        constrain(value) {\n            const opts = this.options;\n            if (opts.length === 0) {\n                return value;\n            }\n            const matched = opts.filter((item) => {\n                return item.value === value;\n            }).length > 0;\n            return matched ? value : opts[0].value;\n        }\n    }\n\n    class RangeConstraint {\n        constructor(config) {\n            this.maxValue = config.max;\n            this.minValue = config.min;\n        }\n        constrain(value) {\n            let result = value;\n            if (!isEmpty(this.minValue)) {\n                result = Math.max(result, this.minValue);\n            }\n            if (!isEmpty(this.maxValue)) {\n                result = Math.min(result, this.maxValue);\n            }\n            return result;\n        }\n    }\n\n    class StepConstraint {\n        constructor(step) {\n            this.step = step;\n        }\n        constrain(value) {\n            const r = value < 0\n                ? -Math.round(-value / this.step)\n                : Math.round(value / this.step);\n            return r * this.step;\n        }\n    }\n\n    const className$j = ClassName('lst');\n    class ListView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.props_ = config.props;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$j());\n            config.viewProps.bindClassModifiers(this.element);\n            const selectElem = doc.createElement('select');\n            selectElem.classList.add(className$j('s'));\n            bindValueMap(this.props_, 'options', (opts) => {\n                removeChildElements(selectElem);\n                opts.forEach((item, index) => {\n                    const optionElem = doc.createElement('option');\n                    optionElem.dataset.index = String(index);\n                    optionElem.textContent = item.text;\n                    optionElem.value = String(item.value);\n                    selectElem.appendChild(optionElem);\n                });\n            });\n            config.viewProps.bindDisabled(selectElem);\n            this.element.appendChild(selectElem);\n            this.selectElement = selectElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(className$j('m'));\n            markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            this.element.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value_ = config.value;\n            this.update_();\n        }\n        update_() {\n            this.selectElement.value = String(this.value_.rawValue);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ListController {\n        constructor(doc, config) {\n            this.onSelectChange_ = this.onSelectChange_.bind(this);\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ListView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.selectElement.addEventListener('change', this.onSelectChange_);\n        }\n        onSelectChange_(e) {\n            const selectElem = forceCast(e.currentTarget);\n            const optElem = selectElem.selectedOptions.item(0);\n            if (!optElem) {\n                return;\n            }\n            const itemIndex = Number(optElem.dataset.index);\n            this.value.rawValue = this.props.get('options')[itemIndex].value;\n        }\n    }\n\n    const className$i = ClassName('pop');\n    class PopupView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$i());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.shows, valueToClassName(this.element, className$i(undefined, 'v')));\n        }\n    }\n\n    class PopupController {\n        constructor(doc, config) {\n            this.shows = createValue(false);\n            this.viewProps = config.viewProps;\n            this.view = new PopupView(doc, {\n                shows: this.shows,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$h = ClassName('txt');\n    class TextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$h());\n            config.viewProps.bindClassModifiers(this.element);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$h('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value_ = config.value;\n            this.refresh();\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value_.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class TextController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new TextView(doc, {\n                props: config.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n    }\n\n    function boolToString(value) {\n        return String(value);\n    }\n    function boolFromUnknown(value) {\n        if (value === 'false') {\n            return false;\n        }\n        return !!value;\n    }\n    function BooleanFormatter(value) {\n        return boolToString(value);\n    }\n\n    class NumberLiteralNode {\n        constructor(text) {\n            this.text = text;\n        }\n        evaluate() {\n            return Number(this.text);\n        }\n        toString() {\n            return this.text;\n        }\n    }\n    const BINARY_OPERATION_MAP = {\n        '**': (v1, v2) => Math.pow(v1, v2),\n        '*': (v1, v2) => v1 * v2,\n        '/': (v1, v2) => v1 / v2,\n        '%': (v1, v2) => v1 % v2,\n        '+': (v1, v2) => v1 + v2,\n        '-': (v1, v2) => v1 - v2,\n        '<<': (v1, v2) => v1 << v2,\n        '>>': (v1, v2) => v1 >> v2,\n        '>>>': (v1, v2) => v1 >>> v2,\n        '&': (v1, v2) => v1 & v2,\n        '^': (v1, v2) => v1 ^ v2,\n        '|': (v1, v2) => v1 | v2,\n    };\n    class BinaryOperationNode {\n        constructor(operator, left, right) {\n            this.left = left;\n            this.operator = operator;\n            this.right = right;\n        }\n        evaluate() {\n            const op = BINARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected binary operator: '${this.operator}`);\n            }\n            return op(this.left.evaluate(), this.right.evaluate());\n        }\n        toString() {\n            return [\n                'b(',\n                this.left.toString(),\n                this.operator,\n                this.right.toString(),\n                ')',\n            ].join(' ');\n        }\n    }\n    const UNARY_OPERATION_MAP = {\n        '+': (v) => v,\n        '-': (v) => -v,\n        '~': (v) => ~v,\n    };\n    class UnaryOperationNode {\n        constructor(operator, expr) {\n            this.operator = operator;\n            this.expression = expr;\n        }\n        evaluate() {\n            const op = UNARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected unary operator: '${this.operator}`);\n            }\n            return op(this.expression.evaluate());\n        }\n        toString() {\n            return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n        }\n    }\n\n    function combineReader(parsers) {\n        return (text, cursor) => {\n            for (let i = 0; i < parsers.length; i++) {\n                const result = parsers[i](text, cursor);\n                if (result !== '') {\n                    return result;\n                }\n            }\n            return '';\n        };\n    }\n    function readWhitespace(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^\\s+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readNonZeroDigit(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        return ch.match(/^[1-9]$/) ? ch : '';\n    }\n    function readDecimalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readSignedInteger(text, cursor) {\n        const ds = readDecimalDigits(text, cursor);\n        if (ds !== '') {\n            return ds;\n        }\n        const sign = text.substr(cursor, 1);\n        cursor += 1;\n        if (sign !== '-' && sign !== '+') {\n            return '';\n        }\n        const sds = readDecimalDigits(text, cursor);\n        if (sds === '') {\n            return '';\n        }\n        return sign + sds;\n    }\n    function readExponentPart(text, cursor) {\n        const e = text.substr(cursor, 1);\n        cursor += 1;\n        if (e.toLowerCase() !== 'e') {\n            return '';\n        }\n        const si = readSignedInteger(text, cursor);\n        if (si === '') {\n            return '';\n        }\n        return e + si;\n    }\n    function readDecimalIntegerLiteral(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        if (ch === '0') {\n            return ch;\n        }\n        const nzd = readNonZeroDigit(text, cursor);\n        cursor += nzd.length;\n        if (nzd === '') {\n            return '';\n        }\n        return nzd + readDecimalDigits(text, cursor);\n    }\n    function readDecimalLiteral1(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        return dil + dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral2(text, cursor) {\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        if (dds === '') {\n            return '';\n        }\n        return dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral3(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        return dil + readExponentPart(text, cursor);\n    }\n    const readDecimalLiteral = combineReader([\n        readDecimalLiteral1,\n        readDecimalLiteral2,\n        readDecimalLiteral3,\n    ]);\n    function parseBinaryDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[01]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readBinaryIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0b') {\n            return '';\n        }\n        const bds = parseBinaryDigits(text, cursor);\n        if (bds === '') {\n            return '';\n        }\n        return prefix + bds;\n    }\n    function readOctalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-7]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readOctalIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0o') {\n            return '';\n        }\n        const ods = readOctalDigits(text, cursor);\n        if (ods === '') {\n            return '';\n        }\n        return prefix + ods;\n    }\n    function readHexDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readHexIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0x') {\n            return '';\n        }\n        const hds = readHexDigits(text, cursor);\n        if (hds === '') {\n            return '';\n        }\n        return prefix + hds;\n    }\n    const readNonDecimalIntegerLiteral = combineReader([\n        readBinaryIntegerLiteral,\n        readOctalIntegerLiteral,\n        readHexIntegerLiteral,\n    ]);\n    const readNumericLiteral = combineReader([\n        readNonDecimalIntegerLiteral,\n        readDecimalLiteral,\n    ]);\n\n    function parseLiteral(text, cursor) {\n        const num = readNumericLiteral(text, cursor);\n        cursor += num.length;\n        if (num === '') {\n            return null;\n        }\n        return {\n            evaluable: new NumberLiteralNode(num),\n            cursor: cursor,\n        };\n    }\n    function parseParenthesizedExpression(text, cursor) {\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '(') {\n            return null;\n        }\n        const expr = parseExpression(text, cursor);\n        if (!expr) {\n            return null;\n        }\n        cursor = expr.cursor;\n        cursor += readWhitespace(text, cursor).length;\n        const cl = text.substr(cursor, 1);\n        cursor += cl.length;\n        if (cl !== ')') {\n            return null;\n        }\n        return {\n            evaluable: expr.evaluable,\n            cursor: cursor,\n        };\n    }\n    function parsePrimaryExpression(text, cursor) {\n        return (parseLiteral(text, cursor) || parseParenthesizedExpression(text, cursor));\n    }\n    function parseUnaryExpression(text, cursor) {\n        const expr = parsePrimaryExpression(text, cursor);\n        if (expr) {\n            return expr;\n        }\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '+' && op !== '-' && op !== '~') {\n            return null;\n        }\n        const num = parseUnaryExpression(text, cursor);\n        if (!num) {\n            return null;\n        }\n        cursor = num.cursor;\n        return {\n            cursor: cursor,\n            evaluable: new UnaryOperationNode(op, num.evaluable),\n        };\n    }\n    function readBinaryOperator(ops, text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n        if (!op) {\n            return null;\n        }\n        cursor += op.length;\n        cursor += readWhitespace(text, cursor).length;\n        return {\n            cursor: cursor,\n            operator: op,\n        };\n    }\n    function createBinaryOperationExpressionParser(exprParser, ops) {\n        return (text, cursor) => {\n            const firstExpr = exprParser(text, cursor);\n            if (!firstExpr) {\n                return null;\n            }\n            cursor = firstExpr.cursor;\n            let expr = firstExpr.evaluable;\n            for (;;) {\n                const op = readBinaryOperator(ops, text, cursor);\n                if (!op) {\n                    break;\n                }\n                cursor = op.cursor;\n                const nextExpr = exprParser(text, cursor);\n                if (!nextExpr) {\n                    return null;\n                }\n                cursor = nextExpr.cursor;\n                expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n            }\n            return expr\n                ? {\n                    cursor: cursor,\n                    evaluable: expr,\n                }\n                : null;\n        };\n    }\n    const parseBinaryOperationExpression = [\n        ['**'],\n        ['*', '/', '%'],\n        ['+', '-'],\n        ['<<', '>>>', '>>'],\n        ['&'],\n        ['^'],\n        ['|'],\n    ].reduce((parser, ops) => {\n        return createBinaryOperationExpressionParser(parser, ops);\n    }, parseUnaryExpression);\n    function parseExpression(text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        return parseBinaryOperationExpression(text, cursor);\n    }\n    function parseEcmaNumberExpression(text) {\n        const expr = parseExpression(text, 0);\n        if (!expr) {\n            return null;\n        }\n        const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n        if (cursor !== text.length) {\n            return null;\n        }\n        return expr.evaluable;\n    }\n\n    function parseNumber(text) {\n        var _a;\n        const r = parseEcmaNumberExpression(text);\n        return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n    }\n    function numberFromUnknown(value) {\n        if (typeof value === 'number') {\n            return value;\n        }\n        if (typeof value === 'string') {\n            const pv = parseNumber(value);\n            if (!isEmpty(pv)) {\n                return pv;\n            }\n        }\n        return 0;\n    }\n    function numberToString(value) {\n        return String(value);\n    }\n    function createNumberFormatter(digits) {\n        return (value) => {\n            return value.toFixed(Math.max(Math.min(digits, 20), 0));\n        };\n    }\n\n    const innerFormatter = createNumberFormatter(0);\n    function formatPercentage(value) {\n        return innerFormatter(value) + '%';\n    }\n\n    function stringFromUnknown(value) {\n        return String(value);\n    }\n    function formatString(value) {\n        return value;\n    }\n\n    function fillBuffer(buffer, bufferSize) {\n        while (buffer.length < bufferSize) {\n            buffer.push(undefined);\n        }\n    }\n    function initializeBuffer(bufferSize) {\n        const buffer = [];\n        fillBuffer(buffer, bufferSize);\n        return createValue(buffer);\n    }\n    function createTrimmedBuffer(buffer) {\n        const index = buffer.indexOf(undefined);\n        return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n    }\n    function createPushedBuffer(buffer, newValue) {\n        const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n        if (newBuffer.length > buffer.length) {\n            newBuffer.splice(0, newBuffer.length - buffer.length);\n        }\n        else {\n            fillBuffer(newBuffer, buffer.length);\n        }\n        return newBuffer;\n    }\n\n    function connectValues({ primary, secondary, forward, backward, }) {\n        let changing = false;\n        function preventFeedback(callback) {\n            if (changing) {\n                return;\n            }\n            changing = true;\n            callback();\n            changing = false;\n        }\n        primary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        secondary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                primary.setRawValue(backward(primary, secondary), ev.options);\n            });\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary, secondary), {\n                forceEmit: false,\n                last: true,\n            });\n        });\n    }\n\n    function getStepForKey(baseStep, keys) {\n        const step = baseStep * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n        if (keys.upKey) {\n            return +step;\n        }\n        else if (keys.downKey) {\n            return -step;\n        }\n        return 0;\n    }\n    function getVerticalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowDown',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowUp',\n        };\n    }\n    function getHorizontalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowLeft',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowRight',\n        };\n    }\n    function isVerticalArrowKey(key) {\n        return key === 'ArrowUp' || key === 'ArrowDown';\n    }\n    function isArrowKey(key) {\n        return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n    }\n\n    function computeOffset$1(ev, elem) {\n        const win = elem.ownerDocument.defaultView;\n        const rect = elem.getBoundingClientRect();\n        return {\n            x: ev.pageX - (((win && win.scrollX) || 0) + rect.left),\n            y: ev.pageY - (((win && win.scrollY) || 0) + rect.top),\n        };\n    }\n    class PointerHandler {\n        constructor(element) {\n            this.lastTouch_ = null;\n            this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n            this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n            this.onMouseDown_ = this.onMouseDown_.bind(this);\n            this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n            this.onTouchMove_ = this.onTouchMove_.bind(this);\n            this.onTouchStart_ = this.onTouchStart_.bind(this);\n            this.elem_ = element;\n            this.emitter = new Emitter();\n            element.addEventListener('touchstart', this.onTouchStart_, {\n                passive: false,\n            });\n            element.addEventListener('touchmove', this.onTouchMove_, {\n                passive: true,\n            });\n            element.addEventListener('touchend', this.onTouchEnd_);\n            element.addEventListener('mousedown', this.onMouseDown_);\n        }\n        computePosition_(offset) {\n            const rect = this.elem_.getBoundingClientRect();\n            return {\n                bounds: {\n                    width: rect.width,\n                    height: rect.height,\n                },\n                point: offset\n                    ? {\n                        x: offset.x,\n                        y: offset.y,\n                    }\n                    : null,\n            };\n        }\n        onMouseDown_(ev) {\n            var _a;\n            ev.preventDefault();\n            (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n            const doc = this.elem_.ownerDocument;\n            doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseMove_(ev) {\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseUp_(ev) {\n            const doc = this.elem_.ownerDocument;\n            doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onTouchStart_(ev) {\n            ev.preventDefault();\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchMove_(ev) {\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchEnd_(ev) {\n            var _a;\n            const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n    }\n\n    function mapRange(value, start1, end1, start2, end2) {\n        const p = (value - start1) / (end1 - start1);\n        return start2 + p * (end2 - start2);\n    }\n    function getDecimalDigits(value) {\n        const text = String(value.toFixed(10));\n        const frac = text.split('.')[1];\n        return frac.replace(/0+$/, '').length;\n    }\n    function constrainRange(value, min, max) {\n        return Math.min(Math.max(value, min), max);\n    }\n    function loopRange(value, max) {\n        return ((value % max) + max) % max;\n    }\n\n    const className$g = ClassName('txt');\n    class NumberTextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$g(), className$g(undefined, 'num'));\n            if (config.arrayPosition) {\n                this.element.classList.add(className$g(undefined, config.arrayPosition));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$g('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n            this.dragging_ = config.dragging;\n            this.dragging_.emitter.on('change', this.onDraggingChange_);\n            this.element.classList.add(className$g());\n            this.inputElement.classList.add(className$g('i'));\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$g('k'));\n            this.element.appendChild(knobElem);\n            this.knobElement = knobElem;\n            const guideElem = doc.createElementNS(SVG_NS, 'svg');\n            guideElem.classList.add(className$g('g'));\n            this.knobElement.appendChild(guideElem);\n            const bodyElem = doc.createElementNS(SVG_NS, 'path');\n            bodyElem.classList.add(className$g('gb'));\n            guideElem.appendChild(bodyElem);\n            this.guideBodyElem_ = bodyElem;\n            const headElem = doc.createElementNS(SVG_NS, 'path');\n            headElem.classList.add(className$g('gh'));\n            guideElem.appendChild(headElem);\n            this.guideHeadElem_ = headElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(ClassName('tt')());\n            this.knobElement.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.refresh();\n        }\n        onDraggingChange_(ev) {\n            if (ev.rawValue === null) {\n                this.element.classList.remove(className$g(undefined, 'drg'));\n                return;\n            }\n            this.element.classList.add(className$g(undefined, 'drg'));\n            const x = ev.rawValue / this.props_.get('draggingScale');\n            const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n            const adx = constrainRange(-aox, -4, +4);\n            this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n            this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n            const formatter = this.props_.get('formatter');\n            this.tooltipElem_.textContent = formatter(this.value.rawValue);\n            this.tooltipElem_.style.left = `${x}px`;\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class NumberTextController {\n        constructor(doc, config) {\n            this.originRawValue_ = 0;\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n            this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.dragging_ = createValue(null);\n            this.view = new NumberTextView(doc, {\n                arrayPosition: config.arrayPosition,\n                dragging: this.dragging_,\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n            this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n            this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n            const ph = new PointerHandler(this.view.knobElement);\n            ph.emitter.on('down', this.onPointerDown_);\n            ph.emitter.on('move', this.onPointerMove_);\n            ph.emitter.on('up', this.onPointerUp_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n        onInputKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onInputKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPointerDown_() {\n            this.originRawValue_ = this.value.rawValue;\n            this.dragging_.rawValue = 0;\n        }\n        computeDraggingValue_(data) {\n            if (!data.point) {\n                return null;\n            }\n            const dx = data.point.x - data.bounds.width / 2;\n            return this.originRawValue_ + dx * this.props.get('draggingScale');\n        }\n        onPointerMove_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: false,\n                last: false,\n            });\n            this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n        }\n        onPointerUp_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: true,\n                last: true,\n            });\n            this.dragging_.rawValue = null;\n        }\n    }\n\n    const className$f = ClassName('sld');\n    class SliderView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$f());\n            config.viewProps.bindClassModifiers(this.element);\n            const trackElem = doc.createElement('div');\n            trackElem.classList.add(className$f('t'));\n            config.viewProps.bindTabIndex(trackElem);\n            this.element.appendChild(trackElem);\n            this.trackElement = trackElem;\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$f('k'));\n            this.trackElement.appendChild(knobElem);\n            this.knobElement = knobElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('minValue'), this.props_.get('maxValue'), 0, 100), 0, 100);\n            this.knobElement.style.width = `${p}%`;\n        }\n        onChange_() {\n            this.update_();\n        }\n    }\n\n    class SliderController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.props = config.props;\n            this.view = new SliderView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.trackElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n            this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('minValue'), this.props.get('maxValue')), opts);\n        }\n        onPointerDownOrMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$e = ClassName('sldtxt');\n    class SliderTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$e());\n            const sliderElem = doc.createElement('div');\n            sliderElem.classList.add(className$e('s'));\n            this.sliderView_ = config.sliderView;\n            sliderElem.appendChild(this.sliderView_.element);\n            this.element.appendChild(sliderElem);\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$e('t'));\n            this.textView_ = config.textView;\n            textElem.appendChild(this.textView_.element);\n            this.element.appendChild(textElem);\n        }\n    }\n\n    class SliderTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.sliderC_ = new SliderController(doc, {\n                baseStep: config.baseStep,\n                props: config.sliderProps,\n                value: config.value,\n                viewProps: this.viewProps,\n            });\n            this.textC_ = new NumberTextController(doc, {\n                baseStep: config.baseStep,\n                parser: config.parser,\n                props: config.textProps,\n                value: config.value,\n                viewProps: config.viewProps,\n            });\n            this.view = new SliderTextView(doc, {\n                sliderView: this.sliderC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get sliderController() {\n            return this.sliderC_;\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    function writePrimitive(target, value) {\n        target.write(value);\n    }\n\n    function parseListOptions(value) {\n        const p = ParamsParsers;\n        if (Array.isArray(value)) {\n            return p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            }))(value).value;\n        }\n        if (typeof value === 'object') {\n            return p.required.raw(value)\n                .value;\n        }\n        return undefined;\n    }\n    function parsePickerLayout(value) {\n        if (value === 'inline' || value === 'popup') {\n            return value;\n        }\n        return undefined;\n    }\n    function parsePointDimensionParams(value) {\n        const p = ParamsParsers;\n        return p.required.object({\n            max: p.optional.number,\n            min: p.optional.number,\n            step: p.optional.number,\n        })(value).value;\n    }\n    function normalizeListOptions(options) {\n        if (Array.isArray(options)) {\n            return options;\n        }\n        const items = [];\n        Object.keys(options).forEach((text) => {\n            items.push({ text: text, value: options[text] });\n        });\n        return items;\n    }\n    function createListConstraint(options) {\n        return !isEmpty(options)\n            ? new ListConstraint(normalizeListOptions(forceCast(options)))\n            : null;\n    }\n    function findListItems(constraint) {\n        const c = constraint\n            ? findConstraint(constraint, ListConstraint)\n            : null;\n        if (!c) {\n            return null;\n        }\n        return c.options;\n    }\n    function findStep(constraint) {\n        const c = constraint ? findConstraint(constraint, StepConstraint) : null;\n        if (!c) {\n            return null;\n        }\n        return c.step;\n    }\n    function getSuitableDecimalDigits(constraint, rawValue) {\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        if (sc) {\n            return getDecimalDigits(sc.step);\n        }\n        return Math.max(getDecimalDigits(rawValue), 2);\n    }\n    function getBaseStep(constraint) {\n        const step = findStep(constraint);\n        return step !== null && step !== void 0 ? step : 1;\n    }\n    function getSuitableDraggingScale(constraint, rawValue) {\n        var _a;\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        const base = Math.abs((_a = sc === null || sc === void 0 ? void 0 : sc.step) !== null && _a !== void 0 ? _a : rawValue);\n        return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n    }\n\n    const className$d = ClassName('ckb');\n    class CheckboxView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$d());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('label');\n            labelElem.classList.add(className$d('l'));\n            this.element.appendChild(labelElem);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$d('i'));\n            inputElem.type = 'checkbox';\n            labelElem.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.viewProps.bindDisabled(this.inputElement);\n            const wrapperElem = doc.createElement('div');\n            wrapperElem.classList.add(className$d('w'));\n            labelElem.appendChild(wrapperElem);\n            const markElem = createSvgIconElement(doc, 'check');\n            wrapperElem.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            this.inputElement.checked = this.value.rawValue;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class CheckboxController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new CheckboxView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            this.value.rawValue = inputElem.checked;\n        }\n    }\n\n    function createConstraint$5(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const BooleanInputPlugin = {\n        id: 'input-bool',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n            constraint: (args) => createConstraint$5(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(doc, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new CheckboxController(doc, {\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className$c = ClassName('col');\n    class ColorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$c());\n            config.foldable.bindExpandedClass(this.element, className$c(undefined, 'expanded'));\n            bindValueMap(config.foldable, 'completed', valueToClassName(this.element, className$c(undefined, 'cpl')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$c('h'));\n            this.element.appendChild(headElem);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$c('s'));\n            headElem.appendChild(swatchElem);\n            this.swatchElement = swatchElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$c('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$c('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    function rgbToHsl(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const c = cmax - cmin;\n        let h = 0;\n        let s = 0;\n        const l = (cmin + cmax) / 2;\n        if (c !== 0) {\n            s = c / (1 - Math.abs(cmax + cmin - 1));\n            if (rp === cmax) {\n                h = (gp - bp) / c;\n            }\n            else if (gp === cmax) {\n                h = 2 + (bp - rp) / c;\n            }\n            else {\n                h = 4 + (rp - gp) / c;\n            }\n            h = h / 6 + (h < 0 ? 1 : 0);\n        }\n        return [h * 360, s * 100, l * 100];\n    }\n    function hslToRgb(h, s, l) {\n        const hp = ((h % 360) + 360) % 360;\n        const sp = constrainRange(s / 100, 0, 1);\n        const lp = constrainRange(l / 100, 0, 1);\n        const c = (1 - Math.abs(2 * lp - 1)) * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = lp - c / 2;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function rgbToHsv(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const d = cmax - cmin;\n        let h;\n        if (d === 0) {\n            h = 0;\n        }\n        else if (cmax === rp) {\n            h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n        }\n        else if (cmax === gp) {\n            h = 60 * ((bp - rp) / d + 2);\n        }\n        else {\n            h = 60 * ((rp - gp) / d + 4);\n        }\n        const s = cmax === 0 ? 0 : d / cmax;\n        const v = cmax;\n        return [h, s * 100, v * 100];\n    }\n    function hsvToRgb(h, s, v) {\n        const hp = loopRange(h, 360);\n        const sp = constrainRange(s / 100, 0, 1);\n        const vp = constrainRange(v / 100, 0, 1);\n        const c = vp * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = vp - c;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function hslToHsv(h, s, l) {\n        const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n        return [\n            h,\n            sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n            l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n        ];\n    }\n    function hsvToHsl(h, s, v) {\n        const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n        return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n    }\n    function removeAlphaComponent(comps) {\n        return [comps[0], comps[1], comps[2]];\n    }\n    function appendAlphaComponent(comps, alpha) {\n        return [comps[0], comps[1], comps[2], alpha];\n    }\n    const MODE_CONVERTER_MAP = {\n        hsl: {\n            hsl: (h, s, l) => [h, s, l],\n            hsv: hslToHsv,\n            rgb: hslToRgb,\n        },\n        hsv: {\n            hsl: hsvToHsl,\n            hsv: (h, s, v) => [h, s, v],\n            rgb: hsvToRgb,\n        },\n        rgb: {\n            hsl: rgbToHsl,\n            hsv: rgbToHsv,\n            rgb: (r, g, b) => [r, g, b],\n        },\n    };\n    function convertColorMode(components, fromMode, toMode) {\n        return MODE_CONVERTER_MAP[fromMode][toMode](...components);\n    }\n\n    const CONSTRAINT_MAP = {\n        hsl: (comps) => {\n            var _a;\n            return [\n                loopRange(comps[0], 360),\n                constrainRange(comps[1], 0, 100),\n                constrainRange(comps[2], 0, 100),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n        hsv: (comps) => {\n            var _a;\n            return [\n                loopRange(comps[0], 360),\n                constrainRange(comps[1], 0, 100),\n                constrainRange(comps[2], 0, 100),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n        rgb: (comps) => {\n            var _a;\n            return [\n                constrainRange(comps[0], 0, 255),\n                constrainRange(comps[1], 0, 255),\n                constrainRange(comps[2], 0, 255),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n    };\n    function isRgbColorComponent(obj, key) {\n        if (typeof obj !== 'object' || isEmpty(obj)) {\n            return false;\n        }\n        return key in obj && typeof obj[key] === 'number';\n    }\n    class Color {\n        constructor(comps, mode) {\n            this.mode_ = mode;\n            this.comps_ = CONSTRAINT_MAP[mode](comps);\n        }\n        static black() {\n            return new Color([0, 0, 0], 'rgb');\n        }\n        static fromObject(obj) {\n            const comps = 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n            return new Color(comps, 'rgb');\n        }\n        static toRgbaObject(color) {\n            return color.toRgbaObject();\n        }\n        static isRgbColorObject(obj) {\n            return (isRgbColorComponent(obj, 'r') &&\n                isRgbColorComponent(obj, 'g') &&\n                isRgbColorComponent(obj, 'b'));\n        }\n        static isRgbaColorObject(obj) {\n            return this.isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n        }\n        static isColorObject(obj) {\n            return this.isRgbColorObject(obj);\n        }\n        static equals(v1, v2) {\n            if (v1.mode_ !== v2.mode_) {\n                return false;\n            }\n            const comps1 = v1.comps_;\n            const comps2 = v2.comps_;\n            for (let i = 0; i < comps1.length; i++) {\n                if (comps1[i] !== comps2[i]) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        get mode() {\n            return this.mode_;\n        }\n        getComponents(opt_mode) {\n            return appendAlphaComponent(convertColorMode(removeAlphaComponent(this.comps_), this.mode_, opt_mode || this.mode_), this.comps_[3]);\n        }\n        toRgbaObject() {\n            const rgbComps = this.getComponents('rgb');\n            return {\n                r: rgbComps[0],\n                g: rgbComps[1],\n                b: rgbComps[2],\n                a: rgbComps[3],\n            };\n        }\n    }\n\n    const className$b = ClassName('colp');\n    class ColorPickerView {\n        constructor(doc, config) {\n            this.alphaViews_ = null;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$b());\n            const hsvElem = doc.createElement('div');\n            hsvElem.classList.add(className$b('hsv'));\n            const svElem = doc.createElement('div');\n            svElem.classList.add(className$b('sv'));\n            this.svPaletteView_ = config.svPaletteView;\n            svElem.appendChild(this.svPaletteView_.element);\n            hsvElem.appendChild(svElem);\n            const hElem = doc.createElement('div');\n            hElem.classList.add(className$b('h'));\n            this.hPaletteView_ = config.hPaletteView;\n            hElem.appendChild(this.hPaletteView_.element);\n            hsvElem.appendChild(hElem);\n            this.element.appendChild(hsvElem);\n            const rgbElem = doc.createElement('div');\n            rgbElem.classList.add(className$b('rgb'));\n            this.textView_ = config.textView;\n            rgbElem.appendChild(this.textView_.element);\n            this.element.appendChild(rgbElem);\n            if (config.alphaViews) {\n                this.alphaViews_ = {\n                    palette: config.alphaViews.palette,\n                    text: config.alphaViews.text,\n                };\n                const aElem = doc.createElement('div');\n                aElem.classList.add(className$b('a'));\n                const apElem = doc.createElement('div');\n                apElem.classList.add(className$b('ap'));\n                apElem.appendChild(this.alphaViews_.palette.element);\n                aElem.appendChild(apElem);\n                const atElem = doc.createElement('div');\n                atElem.classList.add(className$b('at'));\n                atElem.appendChild(this.alphaViews_.text.element);\n                aElem.appendChild(atElem);\n                this.element.appendChild(aElem);\n            }\n        }\n        get allFocusableElements() {\n            const elems = [\n                this.svPaletteView_.element,\n                this.hPaletteView_.element,\n                this.textView_.modeSelectElement,\n                ...this.textView_.textViews.map((v) => v.inputElement),\n            ];\n            if (this.alphaViews_) {\n                elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n            }\n            return elems;\n        }\n    }\n\n    function parseColorInputParams(params) {\n        const p = ParamsParsers;\n        return parseParams(params, {\n            alpha: p.optional.boolean,\n            expanded: p.optional.boolean,\n            picker: p.optional.custom(parsePickerLayout),\n        });\n    }\n    function getBaseStepForColor(forAlpha) {\n        return forAlpha ? 0.1 : 1;\n    }\n\n    function parseCssNumberOrPercentage(text, maxValue) {\n        const m = text.match(/^(.+)%$/);\n        if (!m) {\n            return Math.min(parseFloat(text), maxValue);\n        }\n        return Math.min(parseFloat(m[1]) * 0.01 * maxValue, maxValue);\n    }\n    const ANGLE_TO_DEG_MAP = {\n        deg: (angle) => angle,\n        grad: (angle) => (angle * 360) / 400,\n        rad: (angle) => (angle * 360) / (2 * Math.PI),\n        turn: (angle) => angle * 360,\n    };\n    function parseCssNumberOrAngle(text) {\n        const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n        if (!m) {\n            return parseFloat(text);\n        }\n        const angle = parseFloat(m[1]);\n        const unit = m[2];\n        return ANGLE_TO_DEG_MAP[unit](angle);\n    }\n    const NOTATION_TO_PARSER_MAP = {\n        'func.rgb': (text) => {\n            const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrPercentage(m[1], 255),\n                parseCssNumberOrPercentage(m[2], 255),\n                parseCssNumberOrPercentage(m[3], 255),\n            ];\n            if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n                return null;\n            }\n            return new Color(comps, 'rgb');\n        },\n        'func.rgba': (text) => {\n            const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrPercentage(m[1], 255),\n                parseCssNumberOrPercentage(m[2], 255),\n                parseCssNumberOrPercentage(m[3], 255),\n                parseCssNumberOrPercentage(m[4], 1),\n            ];\n            if (isNaN(comps[0]) ||\n                isNaN(comps[1]) ||\n                isNaN(comps[2]) ||\n                isNaN(comps[3])) {\n                return null;\n            }\n            return new Color(comps, 'rgb');\n        },\n        'func.hsl': (text) => {\n            const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrAngle(m[1]),\n                parseCssNumberOrPercentage(m[2], 100),\n                parseCssNumberOrPercentage(m[3], 100),\n            ];\n            if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n                return null;\n            }\n            return new Color(comps, 'hsl');\n        },\n        'func.hsla': (text) => {\n            const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrAngle(m[1]),\n                parseCssNumberOrPercentage(m[2], 100),\n                parseCssNumberOrPercentage(m[3], 100),\n                parseCssNumberOrPercentage(m[4], 1),\n            ];\n            if (isNaN(comps[0]) ||\n                isNaN(comps[1]) ||\n                isNaN(comps[2]) ||\n                isNaN(comps[3])) {\n                return null;\n            }\n            return new Color(comps, 'hsl');\n        },\n        'hex.rgb': (text) => {\n            const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n            if (mRgb) {\n                return new Color([\n                    parseInt(mRgb[1] + mRgb[1], 16),\n                    parseInt(mRgb[2] + mRgb[2], 16),\n                    parseInt(mRgb[3] + mRgb[3], 16),\n                ], 'rgb');\n            }\n            const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n            if (mRrggbb) {\n                return new Color([\n                    parseInt(mRrggbb[1], 16),\n                    parseInt(mRrggbb[2], 16),\n                    parseInt(mRrggbb[3], 16),\n                ], 'rgb');\n            }\n            return null;\n        },\n        'hex.rgba': (text) => {\n            const mRgb = text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n            if (mRgb) {\n                return new Color([\n                    parseInt(mRgb[1] + mRgb[1], 16),\n                    parseInt(mRgb[2] + mRgb[2], 16),\n                    parseInt(mRgb[3] + mRgb[3], 16),\n                    mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n                ], 'rgb');\n            }\n            const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n            if (mRrggbb) {\n                return new Color([\n                    parseInt(mRrggbb[1], 16),\n                    parseInt(mRrggbb[2], 16),\n                    parseInt(mRrggbb[3], 16),\n                    mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n                ], 'rgb');\n            }\n            return null;\n        },\n    };\n    function getColorNotation(text) {\n        const notations = Object.keys(NOTATION_TO_PARSER_MAP);\n        return notations.reduce((result, notation) => {\n            if (result) {\n                return result;\n            }\n            const subparser = NOTATION_TO_PARSER_MAP[notation];\n            return subparser(text) ? notation : null;\n        }, null);\n    }\n    const CompositeColorParser = (text) => {\n        const notation = getColorNotation(text);\n        return notation ? NOTATION_TO_PARSER_MAP[notation](text) : null;\n    };\n    function hasAlphaComponent(notation) {\n        return (notation === 'func.hsla' ||\n            notation === 'func.rgba' ||\n            notation === 'hex.rgba');\n    }\n    function colorFromString(value) {\n        if (typeof value === 'string') {\n            const cv = CompositeColorParser(value);\n            if (cv) {\n                return cv;\n            }\n        }\n        return Color.black();\n    }\n    function zerofill(comp) {\n        const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n        return hex.length === 1 ? `0${hex}` : hex;\n    }\n    function colorToHexRgbString(value, prefix = '#') {\n        const hexes = removeAlphaComponent(value.getComponents('rgb'))\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToHexRgbaString(value, prefix = '#') {\n        const rgbaComps = value.getComponents('rgb');\n        const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToFunctionalRgbString(value) {\n        const formatter = createNumberFormatter(0);\n        const comps = removeAlphaComponent(value.getComponents('rgb')).map((comp) => formatter(comp));\n        return `rgb(${comps.join(', ')})`;\n    }\n    function colorToFunctionalRgbaString(value) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(0);\n        const comps = value.getComponents('rgb').map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return formatter(comp);\n        });\n        return `rgba(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n        ];\n        const comps = removeAlphaComponent(value.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n        return `hsl(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslaString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n            createNumberFormatter(2),\n        ];\n        const comps = value\n            .getComponents('hsl')\n            .map((comp, index) => formatters[index](comp));\n        return `hsla(${comps.join(', ')})`;\n    }\n    const NOTATION_TO_STRINGIFIER_MAP = {\n        'func.hsl': colorToFunctionalHslString,\n        'func.hsla': colorToFunctionalHslaString,\n        'func.rgb': colorToFunctionalRgbString,\n        'func.rgba': colorToFunctionalRgbaString,\n        'hex.rgb': colorToHexRgbString,\n        'hex.rgba': colorToHexRgbaString,\n    };\n    function getColorStringifier(notation) {\n        return NOTATION_TO_STRINGIFIER_MAP[notation];\n    }\n\n    const className$a = ClassName('apl');\n    class APaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$a());\n            config.viewProps.bindTabIndex(this.element);\n            const barElem = doc.createElement('div');\n            barElem.classList.add(className$a('b'));\n            this.element.appendChild(barElem);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$a('c'));\n            barElem.appendChild(colorElem);\n            this.colorElem_ = colorElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$a('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            const previewElem = doc.createElement('div');\n            previewElem.classList.add(className$a('p'));\n            this.markerElem_.appendChild(previewElem);\n            this.previewElem_ = previewElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const rgbaComps = c.getComponents('rgb');\n            const leftColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n            const rightColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n            const gradientComps = [\n                'to right',\n                colorToFunctionalRgbaString(leftColor),\n                colorToFunctionalRgbaString(rightColor),\n            ];\n            this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n            this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n            const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class APaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new APaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const alpha = d.point.x / d.bounds.width;\n            const c = this.value.rawValue;\n            const [h, s, v] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, alpha], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, a + step], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$9 = ClassName('coltxt');\n    function createModeSelectElement(doc) {\n        const selectElem = doc.createElement('select');\n        const items = [\n            { text: 'RGB', value: 'rgb' },\n            { text: 'HSL', value: 'hsl' },\n            { text: 'HSV', value: 'hsv' },\n        ];\n        selectElem.appendChild(items.reduce((frag, item) => {\n            const optElem = doc.createElement('option');\n            optElem.textContent = item.text;\n            optElem.value = item.value;\n            frag.appendChild(optElem);\n            return frag;\n        }, doc.createDocumentFragment()));\n        return selectElem;\n    }\n    class ColorTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$9());\n            const modeElem = doc.createElement('div');\n            modeElem.classList.add(className$9('m'));\n            this.modeElem_ = createModeSelectElement(doc);\n            this.modeElem_.classList.add(className$9('ms'));\n            modeElem.appendChild(this.modeSelectElement);\n            const modeMarkerElem = doc.createElement('div');\n            modeMarkerElem.classList.add(className$9('mm'));\n            modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            modeElem.appendChild(modeMarkerElem);\n            this.element.appendChild(modeElem);\n            const textsElem = doc.createElement('div');\n            textsElem.classList.add(className$9('w'));\n            this.element.appendChild(textsElem);\n            this.textsElem_ = textsElem;\n            this.textViews_ = config.textViews;\n            this.applyTextViews_();\n            bindValue(config.colorMode, (mode) => {\n                this.modeElem_.value = mode;\n            });\n        }\n        get modeSelectElement() {\n            return this.modeElem_;\n        }\n        get textViews() {\n            return this.textViews_;\n        }\n        set textViews(textViews) {\n            this.textViews_ = textViews;\n            this.applyTextViews_();\n        }\n        applyTextViews_() {\n            removeChildElements(this.textsElem_);\n            const doc = this.element.ownerDocument;\n            this.textViews_.forEach((v) => {\n                const compElem = doc.createElement('div');\n                compElem.classList.add(className$9('c'));\n                compElem.appendChild(v.element);\n                this.textsElem_.appendChild(compElem);\n            });\n        }\n    }\n\n    const FORMATTER = createNumberFormatter(0);\n    const MODE_TO_CONSTRAINT_MAP = {\n        rgb: () => {\n            return new RangeConstraint({ min: 0, max: 255 });\n        },\n        hsl: (index) => {\n            return index === 0\n                ? new RangeConstraint({ min: 0, max: 360 })\n                : new RangeConstraint({ min: 0, max: 100 });\n        },\n        hsv: (index) => {\n            return index === 0\n                ? new RangeConstraint({ min: 0, max: 360 })\n                : new RangeConstraint({ min: 0, max: 100 });\n        },\n    };\n    function createComponentController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n            baseStep: getBaseStepForColor(false),\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                draggingScale: 1,\n                formatter: FORMATTER,\n            }),\n            value: createValue(0, {\n                constraint: MODE_TO_CONSTRAINT_MAP[config.colorMode](index),\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class ColorTextController {\n        constructor(doc, config) {\n            this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n            this.parser_ = config.parser;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.colorMode = createValue(this.value.rawValue.mode);\n            this.ccs_ = this.createComponentControllers_(doc);\n            this.view = new ColorTextView(doc, {\n                colorMode: this.colorMode,\n                textViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n            });\n            this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n        }\n        createComponentControllers_(doc) {\n            const cc = {\n                colorMode: this.colorMode.rawValue,\n                parser: this.parser_,\n                viewProps: this.viewProps,\n            };\n            const ccs = [\n                createComponentController(doc, cc, 0),\n                createComponentController(doc, cc, 1),\n                createComponentController(doc, cc, 2),\n            ];\n            ccs.forEach((cs, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: cs.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents(this.colorMode.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const pickedMode = this.colorMode.rawValue;\n                        const comps = p.rawValue.getComponents(pickedMode);\n                        comps[index] = s.rawValue;\n                        return new Color(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode);\n                    },\n                });\n            });\n            return ccs;\n        }\n        onModeSelectChange_(ev) {\n            const selectElem = ev.currentTarget;\n            this.colorMode.rawValue = selectElem.value;\n            this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n            this.view.textViews = [\n                this.ccs_[0].view,\n                this.ccs_[1].view,\n                this.ccs_[2].view,\n            ];\n        }\n    }\n\n    const className$8 = ClassName('hpl');\n    class HPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$8());\n            config.viewProps.bindTabIndex(this.element);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$8('c'));\n            this.element.appendChild(colorElem);\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$8('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const [h] = c.getComponents('hsv');\n            this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new Color([h, 100, 100], 'hsv'));\n            const left = mapRange(h, 0, 360, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class HPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new HPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const hue = mapRange(d.point.x, 0, d.bounds.width, 0, 360);\n            const c = this.value.rawValue;\n            const [, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([hue, s, v, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h + step, s, v, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$7 = ClassName('svp');\n    const CANVAS_RESOL = 64;\n    class SvPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$7());\n            config.viewProps.bindTabIndex(this.element);\n            const canvasElem = doc.createElement('canvas');\n            canvasElem.height = CANVAS_RESOL;\n            canvasElem.width = CANVAS_RESOL;\n            canvasElem.classList.add(className$7('c'));\n            this.element.appendChild(canvasElem);\n            this.canvasElement = canvasElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$7('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const ctx = getCanvasContext(this.canvasElement);\n            if (!ctx) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const hsvComps = c.getComponents('hsv');\n            const width = this.canvasElement.width;\n            const height = this.canvasElement.height;\n            const imgData = ctx.getImageData(0, 0, width, height);\n            const data = imgData.data;\n            for (let iy = 0; iy < height; iy++) {\n                for (let ix = 0; ix < width; ix++) {\n                    const s = mapRange(ix, 0, width, 0, 100);\n                    const v = mapRange(iy, 0, height, 100, 0);\n                    const rgbComps = hsvToRgb(hsvComps[0], s, v);\n                    const i = (iy * width + ix) * 4;\n                    data[i] = rgbComps[0];\n                    data[i + 1] = rgbComps[1];\n                    data[i + 2] = rgbComps[2];\n                    data[i + 3] = 255;\n                }\n            }\n            ctx.putImageData(imgData, 0, 0);\n            const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n            const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n            this.markerElem_.style.top = `${top}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class SvPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SvPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n            const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n            const [h, , , a] = this.value.rawValue.getComponents('hsv');\n            this.value.setRawValue(new Color([h, saturation, value, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(new Color([h, s + ds, v + dv, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class ColorPickerController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.hPaletteC_ = new HPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.svPaletteC_ = new SvPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.alphaIcs_ = config.supportsAlpha\n                ? {\n                    palette: new APaletteController(doc, {\n                        value: this.value,\n                        viewProps: this.viewProps,\n                    }),\n                    text: new NumberTextController(doc, {\n                        parser: parseNumber,\n                        baseStep: 0.1,\n                        props: ValueMap.fromObject({\n                            draggingScale: 0.01,\n                            formatter: createNumberFormatter(2),\n                        }),\n                        value: createValue(0, {\n                            constraint: new RangeConstraint({ min: 0, max: 1 }),\n                        }),\n                        viewProps: this.viewProps,\n                    }),\n                }\n                : null;\n            if (this.alphaIcs_) {\n                connectValues({\n                    primary: this.value,\n                    secondary: this.alphaIcs_.text.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents()[3];\n                    },\n                    backward: (p, s) => {\n                        const comps = p.rawValue.getComponents();\n                        comps[3] = s.rawValue;\n                        return new Color(comps, p.rawValue.mode);\n                    },\n                });\n            }\n            this.textC_ = new ColorTextController(doc, {\n                parser: parseNumber,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorPickerView(doc, {\n                alphaViews: this.alphaIcs_\n                    ? {\n                        palette: this.alphaIcs_.palette.view,\n                        text: this.alphaIcs_.text.view,\n                    }\n                    : null,\n                hPaletteView: this.hPaletteC_.view,\n                supportsAlpha: config.supportsAlpha,\n                svPaletteView: this.svPaletteC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    const className$6 = ClassName('colsw');\n    class ColorSwatchView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$6());\n            config.viewProps.bindClassModifiers(this.element);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$6('sw'));\n            this.element.appendChild(swatchElem);\n            this.swatchElem_ = swatchElem;\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$6('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            this.update_();\n        }\n        update_() {\n            const value = this.value.rawValue;\n            this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ColorSwatchController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ColorSwatchView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    class ColorController {\n        constructor(doc, config) {\n            this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n            this.onButtonClick_ = this.onButtonClick_.bind(this);\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.swatchC_ = new ColorSwatchController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            const buttonElem = this.swatchC_.view.buttonElement;\n            buttonElem.addEventListener('blur', this.onButtonBlur_);\n            buttonElem.addEventListener('click', this.onButtonClick_);\n            this.textC_ = new TextController(doc, {\n                parser: config.parser,\n                props: ValueMap.fromObject({\n                    formatter: config.formatter,\n                }),\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorView(doc, {\n                foldable: this.foldable_,\n                pickerLayout: config.pickerLayout,\n            });\n            this.view.swatchElement.appendChild(this.swatchC_.view.element);\n            this.view.textElement.appendChild(this.textC_.view.element);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const pickerC = new ColorPickerController(doc, {\n                supportsAlpha: config.supportsAlpha,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            pickerC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = pickerC;\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(pickerC.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        get textController() {\n            return this.textC_;\n        }\n        onButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.swatchC_.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.swatchC_.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function colorFromObject(value) {\n        if (Color.isColorObject(value)) {\n            return Color.fromObject(value);\n        }\n        return Color.black();\n    }\n    function colorToRgbNumber(value) {\n        return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n            return (result << 8) | (Math.floor(comp) & 0xff);\n        }, 0);\n    }\n    function colorToRgbaNumber(value) {\n        return (value.getComponents('rgb').reduce((result, comp, index) => {\n            const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n            return (result << 8) | hex;\n        }, 0) >>> 0);\n    }\n    function numberToRgbColor(num) {\n        return new Color([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n    }\n    function numberToRgbaColor(num) {\n        return new Color([\n            (num >> 24) & 0xff,\n            (num >> 16) & 0xff,\n            (num >> 8) & 0xff,\n            mapRange(num & 0xff, 0, 255, 0, 1),\n        ], 'rgb');\n    }\n    function colorFromRgbNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbColor(value);\n    }\n    function colorFromRgbaNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbaColor(value);\n    }\n\n    function createColorStringWriter(notation) {\n        const stringify = getColorStringifier(notation);\n        return (target, value) => {\n            writePrimitive(target, stringify(value));\n        };\n    }\n    function createColorNumberWriter(supportsAlpha) {\n        const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n        return (target, value) => {\n            writePrimitive(target, colorToNumber(value));\n        };\n    }\n    function writeRgbaColorObject(target, value) {\n        const obj = value.toRgbaObject();\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n        target.writeProperty('a', obj.a);\n    }\n    function writeRgbColorObject(target, value) {\n        const obj = value.toRgbaObject();\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n    }\n    function createColorObjectWriter(supportsAlpha) {\n        return supportsAlpha ? writeRgbaColorObject : writeRgbColorObject;\n    }\n\n    function shouldSupportAlpha$1(inputParams) {\n        return 'alpha' in inputParams && inputParams.alpha === true;\n    }\n    function createFormatter$1(supportsAlpha) {\n        return supportsAlpha\n            ? (v) => colorToHexRgbaString(v, '0x')\n            : (v) => colorToHexRgbString(v, '0x');\n    }\n    const NumberColorInputPlugin = {\n        id: 'input-color-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            if (!('view' in params)) {\n                return null;\n            }\n            if (params.view !== 'color') {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => {\n                return shouldSupportAlpha$1(args.params)\n                    ? colorFromRgbaNumber\n                    : colorFromRgbNumber;\n            },\n            equals: Color.equals,\n            writer: (args) => {\n                return createColorNumberWriter(shouldSupportAlpha$1(args.params));\n            },\n        },\n        controller: (args) => {\n            const supportsAlpha = shouldSupportAlpha$1(args.params);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createFormatter$1(supportsAlpha),\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function shouldSupportAlpha(initialValue) {\n        return Color.isRgbaColorObject(initialValue);\n    }\n    const ObjectColorInputPlugin = {\n        id: 'input-color-object',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Color.isColorObject(value)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => colorFromObject,\n            equals: Color.equals,\n            writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue)),\n        },\n        controller: (args) => {\n            const supportsAlpha = Color.isRgbaColorObject(args.initialValue);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            const formatter = supportsAlpha\n                ? colorToHexRgbaString\n                : colorToHexRgbString;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: formatter,\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const StringColorInputPlugin = {\n        id: 'input-color-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            if ('view' in params && params.view === 'text') {\n                return null;\n            }\n            const notation = getColorNotation(value);\n            if (!notation) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => colorFromString,\n            equals: Color.equals,\n            writer: (args) => {\n                const notation = getColorNotation(args.initialValue);\n                if (!notation) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return createColorStringWriter(notation);\n            },\n        },\n        controller: (args) => {\n            const notation = getColorNotation(args.initialValue);\n            if (!notation) {\n                throw TpError.shouldNeverHappen();\n            }\n            const stringifier = getColorStringifier(notation);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: stringifier,\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: hasAlphaComponent(notation),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class PointNdConstraint {\n        constructor(config) {\n            this.components = config.components;\n            this.asm_ = config.assembly;\n        }\n        constrain(value) {\n            const comps = this.asm_\n                .toComponents(value)\n                .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n            return this.asm_.fromComponents(comps);\n        }\n    }\n\n    const className$5 = ClassName('pndtxt');\n    class PointNdTextView {\n        constructor(doc, config) {\n            this.textViews = config.textViews;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$5());\n            this.textViews.forEach((v) => {\n                const axisElem = doc.createElement('div');\n                axisElem.classList.add(className$5('a'));\n                axisElem.appendChild(v.element);\n                this.element.appendChild(axisElem);\n            });\n        }\n    }\n\n    function createAxisController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n            baseStep: config.axes[index].baseStep,\n            parser: config.parser,\n            props: config.axes[index].textProps,\n            value: createValue(0, {\n                constraint: config.axes[index].constraint,\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class PointNdTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n            this.acs_.forEach((c, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: c.value,\n                    forward: (p) => {\n                        return config.assembly.toComponents(p.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const comps = config.assembly.toComponents(p.rawValue);\n                        comps[index] = s.rawValue;\n                        return config.assembly.fromComponents(comps);\n                    },\n                });\n            });\n            this.view = new PointNdTextView(doc, {\n                textViews: this.acs_.map((ac) => ac.view),\n            });\n        }\n    }\n\n    function createStepConstraint(params) {\n        if ('step' in params && !isEmpty(params.step)) {\n            return new StepConstraint(params.step);\n        }\n        return null;\n    }\n    function createRangeConstraint(params) {\n        if (('max' in params && !isEmpty(params.max)) ||\n            ('min' in params && !isEmpty(params.min))) {\n            return new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        return null;\n    }\n    function createConstraint$4(params) {\n        const constraints = [];\n        const sc = createStepConstraint(params);\n        if (sc) {\n            constraints.push(sc);\n        }\n        const rc = createRangeConstraint(params);\n        if (rc) {\n            constraints.push(rc);\n        }\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function findRange(constraint) {\n        const c = constraint ? findConstraint(constraint, RangeConstraint) : null;\n        if (!c) {\n            return [undefined, undefined];\n        }\n        return [c.minValue, c.maxValue];\n    }\n    function estimateSuitableRange(constraint) {\n        const [min, max] = findRange(constraint);\n        return [min !== null && min !== void 0 ? min : 0, max !== null && max !== void 0 ? max : 100];\n    }\n    const NumberInputPlugin = {\n        id: 'input-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                max: p.optional.number,\n                min: p.optional.number,\n                options: p.optional.custom(parseListOptions),\n                step: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => numberFromUnknown,\n            constraint: (args) => createConstraint$4(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a, _b;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(args.document, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            const formatter = (_b = ('format' in args.params ? args.params.format : undefined)) !== null && _b !== void 0 ? _b : createNumberFormatter(getSuitableDecimalDigits(c, value.rawValue));\n            if (c && findConstraint(c, RangeConstraint)) {\n                const [min, max] = estimateSuitableRange(c);\n                return new SliderTextController(args.document, {\n                    baseStep: getBaseStep(c),\n                    parser: parseNumber,\n                    sliderProps: ValueMap.fromObject({\n                        maxValue: max,\n                        minValue: min,\n                    }),\n                    textProps: ValueMap.fromObject({\n                        draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                        formatter: formatter,\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new NumberTextController(args.document, {\n                baseStep: getBaseStep(c),\n                parser: parseNumber,\n                props: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                    formatter: formatter,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point2d {\n        constructor(x = 0, y = 0) {\n            this.x = x;\n            this.y = y;\n        }\n        getComponents() {\n            return [this.x, this.y];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            if (typeof x !== 'number' || typeof y !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n            };\n        }\n    }\n    const Point2dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point2d(...comps),\n    };\n\n    const className$4 = ClassName('p2d');\n    class Point2dView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$4());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.expanded, valueToClassName(this.element, className$4(undefined, 'expanded')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$4('h'));\n            this.element.appendChild(headElem);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$4('b'));\n            buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n            config.viewProps.bindDisabled(buttonElem);\n            headElem.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$4('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$4('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    const className$3 = ClassName('p2dp');\n    class Point2dPickerView {\n        constructor(doc, config) {\n            this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.invertsY_ = config.invertsY;\n            this.maxValue_ = config.maxValue;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$3());\n            if (config.layout === 'popup') {\n                this.element.classList.add(className$3(undefined, 'p'));\n            }\n            const padElem = doc.createElement('div');\n            padElem.classList.add(className$3('p'));\n            config.viewProps.bindTabIndex(padElem);\n            this.element.appendChild(padElem);\n            this.padElement = padElem;\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className$3('g'));\n            this.padElement.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n            xAxisElem.classList.add(className$3('ax'));\n            xAxisElem.setAttributeNS(null, 'x1', '0');\n            xAxisElem.setAttributeNS(null, 'y1', '50%');\n            xAxisElem.setAttributeNS(null, 'x2', '100%');\n            xAxisElem.setAttributeNS(null, 'y2', '50%');\n            this.svgElem_.appendChild(xAxisElem);\n            const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n            yAxisElem.classList.add(className$3('ax'));\n            yAxisElem.setAttributeNS(null, 'x1', '50%');\n            yAxisElem.setAttributeNS(null, 'y1', '0');\n            yAxisElem.setAttributeNS(null, 'x2', '50%');\n            yAxisElem.setAttributeNS(null, 'y2', '100%');\n            this.svgElem_.appendChild(yAxisElem);\n            const lineElem = doc.createElementNS(SVG_NS, 'line');\n            lineElem.classList.add(className$3('l'));\n            lineElem.setAttributeNS(null, 'x1', '50%');\n            lineElem.setAttributeNS(null, 'y1', '50%');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$3('m'));\n            this.padElement.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        get allFocusableElements() {\n            return [this.padElement];\n        }\n        update_() {\n            const [x, y] = this.value.rawValue.getComponents();\n            const max = this.maxValue_;\n            const px = mapRange(x, -max, +max, 0, 100);\n            const py = mapRange(y, -max, +max, 0, 100);\n            const ipy = this.invertsY_ ? 100 - py : py;\n            this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n            this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n            this.markerElem_.style.left = `${px}%`;\n            this.markerElem_.style.top = `${ipy}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n        onFoldableChange_() {\n            this.update_();\n        }\n    }\n\n    function computeOffset(ev, baseSteps, invertsY) {\n        return [\n            getStepForKey(baseSteps[0], getHorizontalStepKeys(ev)),\n            getStepForKey(baseSteps[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n        ];\n    }\n    class Point2dPickerController {\n        constructor(doc, config) {\n            this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n            this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.baseSteps_ = config.baseSteps;\n            this.maxValue_ = config.maxValue;\n            this.invertsY_ = config.invertsY;\n            this.view = new Point2dPickerView(doc, {\n                invertsY: this.invertsY_,\n                layout: config.layout,\n                maxValue: this.maxValue_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.padElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n            this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const max = this.maxValue_;\n            const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n            const py = mapRange(this.invertsY_ ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n            this.value.setRawValue(new Point2d(px, py), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPadKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPadKeyUp_(ev) {\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class Point2dController {\n        constructor(doc, config) {\n            var _a, _b;\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n            this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const padC = new Point2dPickerController(doc, {\n                baseSteps: [config.axes[0].baseStep, config.axes[1].baseStep],\n                invertsY: config.invertsY,\n                layout: config.pickerLayout,\n                maxValue: config.maxValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            padC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = padC;\n            this.textC_ = new PointNdTextController(doc, {\n                assembly: Point2dAssembly,\n                axes: config.axes,\n                parser: config.parser,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new Point2dView(doc, {\n                expanded: this.foldable_.value('expanded'),\n                pickerLayout: config.pickerLayout,\n                viewProps: this.viewProps,\n            });\n            this.view.textElement.appendChild(this.textC_.view.element);\n            (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n            (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(this.pickerC_.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        onPadButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onPadButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function point2dFromUnknown(value) {\n        return Point2d.isObject(value)\n            ? new Point2d(value.x, value.y)\n            : new Point2d();\n    }\n    function writePoint2d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n    }\n\n    function createDimensionConstraint$2(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$3(params) {\n        return new PointNdConstraint({\n            assembly: Point2dAssembly,\n            components: [\n                createDimensionConstraint$2('x' in params ? params.x : undefined),\n                createDimensionConstraint$2('y' in params ? params.y : undefined),\n            ],\n        });\n    }\n    function getSuitableMaxDimensionValue(constraint, rawValue) {\n        const rc = constraint && findConstraint(constraint, RangeConstraint);\n        if (rc) {\n            return Math.max(Math.abs(rc.minValue || 0), Math.abs(rc.maxValue || 0));\n        }\n        const step = getBaseStep(constraint);\n        return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n    }\n    function getSuitableMaxValue(initialValue, constraint) {\n        const xc = constraint instanceof PointNdConstraint\n            ? constraint.components[0]\n            : undefined;\n        const yc = constraint instanceof PointNdConstraint\n            ? constraint.components[1]\n            : undefined;\n        const xr = getSuitableMaxDimensionValue(xc, initialValue.x);\n        const yr = getSuitableMaxDimensionValue(yc, initialValue.y);\n        return Math.max(xr, yr);\n    }\n    function createAxis$2(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    function shouldInvertY(params) {\n        if (!('y' in params)) {\n            return false;\n        }\n        const yParams = params.y;\n        if (!yParams) {\n            return false;\n        }\n        return 'inverted' in yParams ? !!yParams.inverted : false;\n    }\n    const Point2dInputPlugin = {\n        id: 'input-point2d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point2d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                expanded: p.optional.boolean,\n                picker: p.optional.custom(parsePickerLayout),\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.object({\n                    inverted: p.optional.boolean,\n                    max: p.optional.number,\n                    min: p.optional.number,\n                    step: p.optional.number,\n                }),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point2dFromUnknown,\n            constraint: (args) => createConstraint$3(args.params),\n            equals: Point2d.equals,\n            writer: (_args) => writePoint2d,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new Point2dController(doc, {\n                axes: [\n                    createAxis$2(value.rawValue.x, c.components[0]),\n                    createAxis$2(value.rawValue.y, c.components[1]),\n                ],\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                invertsY: shouldInvertY(args.params),\n                maxValue: getSuitableMaxValue(value.rawValue, c),\n                parser: parseNumber,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point3d {\n        constructor(x = 0, y = 0, z = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n            };\n        }\n    }\n    const Point3dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point3d(...comps),\n    };\n\n    function point3dFromUnknown(value) {\n        return Point3d.isObject(value)\n            ? new Point3d(value.x, value.y, value.z)\n            : new Point3d();\n    }\n    function writePoint3d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n    }\n\n    function createDimensionConstraint$1(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$2(params) {\n        return new PointNdConstraint({\n            assembly: Point3dAssembly,\n            components: [\n                createDimensionConstraint$1('x' in params ? params.x : undefined),\n                createDimensionConstraint$1('y' in params ? params.y : undefined),\n                createDimensionConstraint$1('z' in params ? params.z : undefined),\n            ],\n        });\n    }\n    function createAxis$1(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point3dInputPlugin = {\n        id: 'input-point3d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point3d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point3dFromUnknown,\n            constraint: (args) => createConstraint$2(args.params),\n            equals: Point3d.equals,\n            writer: (_args) => writePoint3d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point3dAssembly,\n                axes: [\n                    createAxis$1(value.rawValue.x, c.components[0]),\n                    createAxis$1(value.rawValue.y, c.components[1]),\n                    createAxis$1(value.rawValue.z, c.components[2]),\n                ],\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point4d {\n        constructor(x = 0, y = 0, z = 0, w = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n            this.w = w;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z, this.w];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            const w = obj.w;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number' ||\n                typeof w !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n                w: this.w,\n            };\n        }\n    }\n    const Point4dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point4d(...comps),\n    };\n\n    function point4dFromUnknown(value) {\n        return Point4d.isObject(value)\n            ? new Point4d(value.x, value.y, value.z, value.w)\n            : new Point4d();\n    }\n    function writePoint4d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n        target.writeProperty('w', value.w);\n    }\n\n    function createDimensionConstraint(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$1(params) {\n        return new PointNdConstraint({\n            assembly: Point4dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined),\n                createDimensionConstraint('y' in params ? params.y : undefined),\n                createDimensionConstraint('z' in params ? params.z : undefined),\n                createDimensionConstraint('w' in params ? params.w : undefined),\n            ],\n        });\n    }\n    function createAxis(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point4dInputPlugin = {\n        id: 'input-point4d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point4d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n                w: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point4dFromUnknown,\n            constraint: (args) => createConstraint$1(args.params),\n            equals: Point4d.equals,\n            writer: (_args) => writePoint4d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point4dAssembly,\n                axes: value.rawValue\n                    .getComponents()\n                    .map((comp, index) => createAxis(comp, c.components[index])),\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createConstraint(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const StringInputPlugin = {\n        id: 'input-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n            constraint: (args) => createConstraint(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(doc, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new TextController(doc, {\n                parser: (v) => v,\n                props: ValueMap.fromObject({\n                    formatter: formatString,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const Constants = {\n        monitor: {\n            defaultInterval: 200,\n            defaultLineCount: 3,\n        },\n    };\n\n    const className$2 = ClassName('mll');\n    class MultiLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$2());\n            config.viewProps.bindClassModifiers(this.element);\n            const textareaElem = doc.createElement('textarea');\n            textareaElem.classList.add(className$2('i'));\n            textareaElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            textareaElem.readOnly = true;\n            config.viewProps.bindDisabled(textareaElem);\n            this.element.appendChild(textareaElem);\n            this.textareaElem_ = textareaElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const elem = this.textareaElem_;\n            const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n            const lines = [];\n            this.value.rawValue.forEach((value) => {\n                if (value !== undefined) {\n                    lines.push(this.formatter_(value));\n                }\n            });\n            elem.textContent = lines.join('\\n');\n            if (shouldScroll) {\n                elem.scrollTop = elem.scrollHeight;\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class MultiLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new MultiLogView(doc, {\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$1 = ClassName('sgl');\n    class SingleLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$1());\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$1('i'));\n            inputElem.readOnly = true;\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const values = this.value.rawValue;\n            const lastValue = values[values.length - 1];\n            this.inputElement.value =\n                lastValue !== undefined ? this.formatter_(lastValue) : '';\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class SingleLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SingleLogView(doc, {\n                formatter: config.formatter,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const BooleanMonitorPlugin = {\n        id: 'monitor-bool',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            if (args.value.rawValue.length === 1) {\n                return new SingleLogController(args.document, {\n                    formatter: BooleanFormatter,\n                    value: args.value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new MultiLogController(args.document, {\n                formatter: BooleanFormatter,\n                lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class GraphCursor {\n        constructor() {\n            this.emitter = new Emitter();\n            this.index_ = -1;\n        }\n        get index() {\n            return this.index_;\n        }\n        set index(index) {\n            const changed = this.index_ !== index;\n            if (changed) {\n                this.index_ = index;\n                this.emitter.emit('change', {\n                    index: index,\n                    sender: this,\n                });\n            }\n        }\n    }\n\n    const className = ClassName('grl');\n    class GraphLogView {\n        constructor(doc, config) {\n            this.onCursorChange_ = this.onCursorChange_.bind(this);\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n            this.formatter_ = config.formatter;\n            this.minValue_ = config.minValue;\n            this.maxValue_ = config.maxValue;\n            this.cursor_ = config.cursor;\n            this.cursor_.emitter.on('change', this.onCursorChange_);\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className('g'));\n            svgElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            this.element.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(className('t'), ClassName('tt')());\n            this.element.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        get graphElement() {\n            return this.svgElem_;\n        }\n        update_() {\n            const bounds = this.svgElem_.getBoundingClientRect();\n            const maxIndex = this.value.rawValue.length - 1;\n            const min = this.minValue_;\n            const max = this.maxValue_;\n            const points = [];\n            this.value.rawValue.forEach((v, index) => {\n                if (v === undefined) {\n                    return;\n                }\n                const x = mapRange(index, 0, maxIndex, 0, bounds.width);\n                const y = mapRange(v, min, max, bounds.height, 0);\n                points.push([x, y].join(','));\n            });\n            this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n            const tooltipElem = this.tooltipElem_;\n            const value = this.value.rawValue[this.cursor_.index];\n            if (value === undefined) {\n                tooltipElem.classList.remove(className('t', 'a'));\n                return;\n            }\n            const tx = mapRange(this.cursor_.index, 0, maxIndex, 0, bounds.width);\n            const ty = mapRange(value, min, max, bounds.height, 0);\n            tooltipElem.style.left = `${tx}px`;\n            tooltipElem.style.top = `${ty}px`;\n            tooltipElem.textContent = `${this.formatter_(value)}`;\n            if (!tooltipElem.classList.contains(className('t', 'a'))) {\n                tooltipElem.classList.add(className('t', 'a'), className('t', 'in'));\n                forceReflow(tooltipElem);\n                tooltipElem.classList.remove(className('t', 'in'));\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n        onCursorChange_() {\n            this.update_();\n        }\n    }\n\n    class GraphLogController {\n        constructor(doc, config) {\n            this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n            this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n            this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n            this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n            this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.cursor_ = new GraphCursor();\n            this.view = new GraphLogView(doc, {\n                cursor: this.cursor_,\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                maxValue: config.maxValue,\n                minValue: config.minValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            if (!supportsTouch(doc)) {\n                this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n                this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n            }\n            else {\n                const ph = new PointerHandler(this.view.element);\n                ph.emitter.on('down', this.onGraphPointerDown_);\n                ph.emitter.on('move', this.onGraphPointerMove_);\n                ph.emitter.on('up', this.onGraphPointerUp_);\n            }\n        }\n        onGraphMouseLeave_() {\n            this.cursor_.index = -1;\n        }\n        onGraphMouseMove_(ev) {\n            const bounds = this.view.element.getBoundingClientRect();\n            this.cursor_.index = Math.floor(mapRange(ev.offsetX, 0, bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerDown_(ev) {\n            this.onGraphPointerMove_(ev);\n        }\n        onGraphPointerMove_(ev) {\n            if (!ev.data.point) {\n                this.cursor_.index = -1;\n                return;\n            }\n            this.cursor_.index = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerUp_() {\n            this.cursor_.index = -1;\n        }\n    }\n\n    function createFormatter(params) {\n        return 'format' in params && !isEmpty(params.format)\n            ? params.format\n            : createNumberFormatter(2);\n    }\n    function createTextMonitor(args) {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: createFormatter(args.params),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function createGraphMonitor(args) {\n        var _a, _b, _c;\n        return new GraphLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            maxValue: (_b = ('max' in args.params ? args.params.max : null)) !== null && _b !== void 0 ? _b : 100,\n            minValue: (_c = ('min' in args.params ? args.params.min : null)) !== null && _c !== void 0 ? _c : 0,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function shouldShowGraph(params) {\n        return 'view' in params && params.view === 'graph';\n    }\n    const NumberMonitorPlugin = {\n        id: 'monitor-number',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                lineCount: p.optional.number,\n                max: p.optional.number,\n                min: p.optional.number,\n                view: p.optional.string,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n            reader: (_args) => numberFromUnknown,\n        },\n        controller: (args) => {\n            if (shouldShowGraph(args.params)) {\n                return createGraphMonitor(args);\n            }\n            return createTextMonitor(args);\n        },\n    };\n\n    const StringMonitorPlugin = {\n        id: 'monitor-string',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n                multiline: p.optional.boolean,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const multiline = value.rawValue.length > 1 ||\n                ('multiline' in args.params && args.params.multiline);\n            if (multiline) {\n                return new MultiLogController(args.document, {\n                    formatter: formatString,\n                    lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new SingleLogController(args.document, {\n                formatter: formatString,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class InputBinding {\n        constructor(config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.reader = config.reader;\n            this.writer = config.writer;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.target = config.target;\n            this.read();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue !== undefined) {\n                this.value.rawValue = this.reader(targetValue);\n            }\n        }\n        write_(rawValue) {\n            this.writer(this.target, rawValue);\n        }\n        onValueChange_(ev) {\n            this.write_(ev.rawValue);\n            this.emitter.emit('change', {\n                options: ev.options,\n                rawValue: ev.rawValue,\n                sender: this,\n            });\n        }\n    }\n\n    function createInputBindingController(plugin, args) {\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const p = ParamsParsers;\n        const valueArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(valueArgs);\n        const constraint = plugin.binding.constraint\n            ? plugin.binding.constraint(valueArgs)\n            : undefined;\n        const value = createValue(reader(result.initialValue), {\n            constraint: constraint,\n            equals: plugin.binding.equals,\n        });\n        const binding = new InputBinding({\n            reader: reader,\n            target: args.target,\n            value: value,\n            writer: plugin.binding.writer(valueArgs),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            constraint: constraint,\n            document: args.document,\n            initialValue: result.initialValue,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        const label = p.optional.string(args.params.label).value;\n        return new InputBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: label || args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class MonitorBinding {\n        constructor(config) {\n            this.onTick_ = this.onTick_.bind(this);\n            this.reader_ = config.reader;\n            this.target = config.target;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.ticker = config.ticker;\n            this.ticker.emitter.on('tick', this.onTick_);\n            this.read();\n        }\n        dispose() {\n            this.ticker.dispose();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue === undefined) {\n                return;\n            }\n            const buffer = this.value.rawValue;\n            const newValue = this.reader_(targetValue);\n            this.value.rawValue = createPushedBuffer(buffer, newValue);\n            this.emitter.emit('update', {\n                rawValue: newValue,\n                sender: this,\n            });\n        }\n        onTick_(_) {\n            this.read();\n        }\n    }\n\n    function createTicker(document, interval) {\n        return interval === 0\n            ? new ManualTicker()\n            : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n    }\n    function createMonitorBindingController(plugin, args) {\n        var _a, _b, _c;\n        const P = ParamsParsers;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const bindingArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(bindingArgs);\n        const bufferSize = (_b = (_a = P.optional.number(args.params.bufferSize).value) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n            plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n        const interval = P.optional.number(args.params.interval).value;\n        const binding = new MonitorBinding({\n            reader: reader,\n            target: args.target,\n            ticker: createTicker(args.document, interval),\n            value: initializeBuffer(bufferSize),\n        });\n        const disabled = P.optional.boolean(args.params.disabled).value;\n        const hidden = P.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            document: args.document,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        const label = (_c = P.optional.string(args.params.label).value) !== null && _c !== void 0 ? _c : args.target.key;\n        return new MonitorBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: label,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class PluginPool {\n        constructor() {\n            this.pluginsMap_ = {\n                blades: [],\n                inputs: [],\n                monitors: [],\n            };\n        }\n        getAll() {\n            return [\n                ...this.pluginsMap_.blades,\n                ...this.pluginsMap_.inputs,\n                ...this.pluginsMap_.monitors,\n            ];\n        }\n        register(r) {\n            if (r.type === 'blade') {\n                this.pluginsMap_.blades.unshift(r);\n            }\n            else if (r.type === 'input') {\n                this.pluginsMap_.inputs.unshift(r);\n            }\n            else if (r.type === 'monitor') {\n                this.pluginsMap_.monitors.unshift(r);\n            }\n        }\n        createInput(document, target, params) {\n            const initialValue = target.read();\n            if (isEmpty(initialValue)) {\n                throw new TpError({\n                    context: {\n                        key: target.key,\n                    },\n                    type: 'nomatchingcontroller',\n                });\n            }\n            const bc = this.pluginsMap_.inputs.reduce((result, plugin) => result ||\n                createInputBindingController(plugin, {\n                    document: document,\n                    target: target,\n                    params: params,\n                }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createMonitor(document, target, params) {\n            const bc = this.pluginsMap_.monitors.reduce((result, plugin) => result ||\n                createMonitorBindingController(plugin, {\n                    document: document,\n                    params: params,\n                    target: target,\n                }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createBlade(document, params) {\n            const bc = this.pluginsMap_.blades.reduce((result, plugin) => result ||\n                createBladeController(plugin, {\n                    document: document,\n                    params: params,\n                }), null);\n            if (!bc) {\n                throw new TpError({\n                    type: 'nomatchingview',\n                    context: {\n                        params: params,\n                    },\n                });\n            }\n            return bc;\n        }\n        createBladeApi(bc) {\n            if (bc instanceof InputBindingController) {\n                return new InputBindingApi(bc);\n            }\n            if (bc instanceof MonitorBindingController) {\n                return new MonitorBindingApi(bc);\n            }\n            if (bc instanceof RackController) {\n                return new RackApi(bc, this);\n            }\n            const api = this.pluginsMap_.blades.reduce((result, plugin) => result ||\n                plugin.api({\n                    controller: bc,\n                    pool: this,\n                }), null);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n    }\n\n    function createDefaultPluginPool() {\n        const pool = new PluginPool();\n        [\n            Point2dInputPlugin,\n            Point3dInputPlugin,\n            Point4dInputPlugin,\n            StringInputPlugin,\n            NumberInputPlugin,\n            StringColorInputPlugin,\n            ObjectColorInputPlugin,\n            NumberColorInputPlugin,\n            BooleanInputPlugin,\n            BooleanMonitorPlugin,\n            StringMonitorPlugin,\n            NumberMonitorPlugin,\n            ButtonBladePlugin,\n            FolderBladePlugin,\n            SeparatorBladePlugin,\n            TabBladePlugin,\n        ].forEach((p) => {\n            pool.register(p);\n        });\n        return pool;\n    }\n\n    class ListApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get options() {\n            return this.controller_.valueController.props.get('options');\n        }\n        set options(options) {\n            this.controller_.valueController.props.set('options', options);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class SliderApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get maxValue() {\n            return this.controller_.valueController.sliderController.props.get('maxValue');\n        }\n        set maxValue(maxValue) {\n            this.controller_.valueController.sliderController.props.set('maxValue', maxValue);\n        }\n        get minValue() {\n            return this.controller_.valueController.sliderController.props.get('minValue');\n        }\n        set minValue(minValue) {\n            this.controller_.valueController.sliderController.props.set('minValue', minValue);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class TextApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get formatter() {\n            return this.controller_.valueController.props.get('formatter');\n        }\n        set formatter(formatter) {\n            this.controller_.valueController.props.set('formatter', formatter);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    const ListBladePlugin = (function () {\n        return {\n            id: 'list',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    options: p.required.custom(parseListOptions),\n                    value: p.required.raw,\n                    view: p.required.constant('list'),\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                const ic = new ListController(args.document, {\n                    props: ValueMap.fromObject({\n                        options: normalizeListOptions(args.params.options),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof ListController)) {\n                    return null;\n                }\n                return new ListApi(args.controller);\n            },\n        };\n    })();\n\n    /**\n     * @hidden\n     */\n    function exportPresetJson(targets) {\n        return targets.reduce((result, target) => {\n            return Object.assign(result, {\n                [target.presetKey]: target.read(),\n            });\n        }, {});\n    }\n    /**\n     * @hidden\n     */\n    function importPresetJson(targets, preset) {\n        targets.forEach((target) => {\n            const value = preset[target.presetKey];\n            if (value !== undefined) {\n                target.write(value);\n            }\n        });\n    }\n\n    class RootApi extends FolderApi {\n        /**\n         * @hidden\n         */\n        constructor(controller, pool) {\n            super(controller, pool);\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        /**\n         * Imports a preset of all inputs.\n         * @param preset The preset object to import.\n         */\n        importPreset(preset) {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            importPresetJson(targets, preset);\n            this.refresh();\n        }\n        /**\n         * Exports a preset of all inputs.\n         * @return An exported preset object.\n         */\n        exportPreset() {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            return exportPresetJson(targets);\n        }\n        /**\n         * Refreshes all bindings of the pane.\n         */\n        refresh() {\n            // Force-read all input bindings\n            this.controller_.rackController.rack\n                .find(InputBindingController)\n                .forEach((ibc) => {\n                ibc.binding.read();\n            });\n            // Force-read all monitor bindings\n            this.controller_.rackController.rack\n                .find(MonitorBindingController)\n                .forEach((mbc) => {\n                mbc.binding.read();\n            });\n        }\n    }\n\n    class RootController extends FolderController {\n        constructor(doc, config) {\n            super(doc, {\n                expanded: config.expanded,\n                blade: config.blade,\n                props: config.props,\n                root: true,\n                viewProps: config.viewProps,\n            });\n        }\n    }\n\n    const SliderBladePlugin = {\n        id: 'slider',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                max: p.required.number,\n                min: p.required.number,\n                view: p.required.constant('slider'),\n                format: p.optional.function,\n                label: p.optional.string,\n                value: p.optional.number,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a, _b;\n            const v = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n            const vc = new SliderTextController(args.document, {\n                baseStep: 1,\n                parser: parseNumber,\n                sliderProps: ValueMap.fromObject({\n                    maxValue: args.params.max,\n                    minValue: args.params.min,\n                }),\n                textProps: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(undefined, v),\n                    formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n                }),\n                value: createValue(v),\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: vc,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof SliderTextController)) {\n                return null;\n            }\n            return new SliderApi(args.controller);\n        },\n    };\n\n    const TextBladePlugin = (function () {\n        return {\n            id: 'text',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    parse: p.required.function,\n                    value: p.required.raw,\n                    view: p.required.constant('text'),\n                    format: p.optional.function,\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                var _a;\n                const ic = new TextController(args.document, {\n                    parser: args.params.parse,\n                    props: ValueMap.fromObject({\n                        formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof TextController)) {\n                    return null;\n                }\n                return new TextApi(args.controller);\n            },\n        };\n    })();\n\n    function createDefaultWrapperElement(doc) {\n        const elem = doc.createElement('div');\n        elem.classList.add(ClassName('dfw')());\n        if (doc.body) {\n            doc.body.appendChild(elem);\n        }\n        return elem;\n    }\n    function embedStyle(doc, id, css) {\n        if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n            return;\n        }\n        const styleElem = doc.createElement('style');\n        styleElem.dataset.tpStyle = id;\n        styleElem.textContent = css;\n        doc.head.appendChild(styleElem);\n    }\n    /**\n     * The root pane of Tweakpane.\n     */\n    class Pane extends RootApi {\n        constructor(opt_config) {\n            var _a;\n            const config = opt_config || {};\n            const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n            const pool = createDefaultPluginPool();\n            const rootController = new RootController(doc, {\n                expanded: config.expanded,\n                blade: createBlade(),\n                props: ValueMap.fromObject({\n                    title: config.title,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            super(rootController, pool);\n            this.pool_ = pool;\n            this.containerElem_ = config.container || createDefaultWrapperElement(doc);\n            this.containerElem_.appendChild(this.element);\n            this.doc_ = doc;\n            this.usesDefaultWrapper_ = !config.container;\n            this.setUpDefaultPlugins_();\n        }\n        get document() {\n            if (!this.doc_) {\n                throw TpError.alreadyDisposed();\n            }\n            return this.doc_;\n        }\n        dispose() {\n            const containerElem = this.containerElem_;\n            if (!containerElem) {\n                throw TpError.alreadyDisposed();\n            }\n            if (this.usesDefaultWrapper_) {\n                const parentElem = containerElem.parentElement;\n                if (parentElem) {\n                    parentElem.removeChild(containerElem);\n                }\n            }\n            this.containerElem_ = null;\n            this.doc_ = null;\n            super.dispose();\n        }\n        registerPlugin(bundle) {\n            const plugins = 'plugin' in bundle\n                ? [bundle.plugin]\n                : 'plugins' in bundle\n                    ? bundle.plugins\n                    : [];\n            plugins.forEach((p) => {\n                this.pool_.register(p);\n                this.embedPluginStyle_(p);\n            });\n        }\n        embedPluginStyle_(plugin) {\n            if (plugin.css) {\n                embedStyle(this.document, `plugin-${plugin.id}`, plugin.css);\n            }\n        }\n        setUpDefaultPlugins_() {\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            embedStyle(this.document, 'default', '.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187,188,196,0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187,188,196,0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187,188,196,0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187,188,196,0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\\'\\';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:\\'\\';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:\\'\\';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:\\'\\';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\\'\\';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:\\'\\';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:\\'\\';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:\\'\\';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\\'\\';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:\\'\\';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}');\n            this.pool_.getAll().forEach((plugin) => {\n                this.embedPluginStyle_(plugin);\n            });\n            this.registerPlugin({\n                plugins: [\n                    SliderBladePlugin,\n                    ListBladePlugin,\n                    TabBladePlugin,\n                    TextBladePlugin,\n                ],\n            });\n        }\n    }\n\n    const VERSION = new Semver('3.0.7');\n\n    exports.BladeApi = BladeApi;\n    exports.ButtonApi = ButtonApi;\n    exports.FolderApi = FolderApi;\n    exports.InputBindingApi = InputBindingApi;\n    exports.ListApi = ListApi;\n    exports.MonitorBindingApi = MonitorBindingApi;\n    exports.Pane = Pane;\n    exports.SeparatorApi = SeparatorApi;\n    exports.SliderApi = SliderApi;\n    exports.TabApi = TabApi;\n    exports.TabPageApi = TabPageApi;\n    exports.TextApi = TextApi;\n    exports.TpChangeEvent = TpChangeEvent;\n    exports.VERSION = VERSION;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","module.exports = __WEBPACK_EXTERNAL_MODULE_excalibur__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import * as ex from \"excalibur\";\r\nimport { BladeApi, FolderApi, ListApi, Pane, SliderApi, TabApi, TabPageApi } from \"tweakpane\";\r\nimport { PickerSystem } from './picker-system'\r\n\r\nexport class DevTool {\r\n    public pane: Pane\r\n    public tabs: TabApi;\r\n    public pickerSystem: PickerSystem;\r\n    pointerPos: { x: number, y: number } = { x: 0, y: 0 };\r\n    highlightedEntities: number[] = [-1];\r\n    selectedEntity: ex.Actor | null = null;\r\n    selectedEntityId: number = -1;\r\n    currentResolution: ex.ScreenDimension;\r\n    currentViewport: ex.ScreenDimension;\r\n    resolutionText: BladeApi<any>;\r\n    viewportText: BladeApi<any>;\r\n    screenFolder: FolderApi;\r\n\r\n    // tabs\r\n    selectedEntityTab: TabPageApi;\r\n    selectedEntityFolder: FolderApi;\r\n    screenTab: TabPageApi;\r\n    cameraTab: TabPageApi;\r\n    timerTab: TabPageApi;\r\n    clockTab: TabPageApi;\r\n    physicsTab: TabPageApi;\r\n    debugTab: TabPageApi;\r\n    pointerPosInput: any;\r\n\r\n    constructor(public engine: ex.Engine) {\r\n        this.pane = new Pane({\r\n            title: 'Excalibur Dev Tools',\r\n            expanded: true\r\n        });\r\n        const style = document.createElement('style');\r\n        style.innerText = \".excalibur-tweakpane-custom { width: 405px; }\";\r\n        document.head.appendChild(style);\r\n        this.pane.element.parentElement.classList.add(\"excalibur-tweakpane-custom\");\r\n\r\n        this._buildMain();\r\n\r\n        this.tabs = this.pane.addTab({\r\n            pages: [\r\n                { title: 'Entity' },\r\n                { title: 'Screen' },\r\n                { title: 'Camera' },\r\n                { title: 'Clock' },\r\n                { title: 'Timers' },\r\n                { title: 'Physics' },\r\n                { title: 'Settings' }\r\n            ]\r\n        });\r\n\r\n        this.selectedEntityTab = this.tabs.pages[0];\r\n        this.screenTab = this.tabs.pages[1];\r\n        this.cameraTab = this.tabs.pages[2];\r\n        this.clockTab = this.tabs.pages[3];\r\n        this.timerTab = this.tabs.pages[4];\r\n        this.physicsTab = this.tabs.pages[5];\r\n        this.debugTab = this.tabs.pages[6];\r\n\r\n        this._installPickerSystemIfNeeded(engine.currentScene);\r\n\r\n        engine.debug.transform.showPosition = true;\r\n        engine.debug.entity.showName = true;\r\n        this.selectedEntityFolder = this.selectedEntityTab.addFolder({\r\n            title: 'Selected',\r\n        });\r\n\r\n\r\n        this._buildScreenTab();\r\n        this._buildCameraTab();\r\n        this._buildClockTab();\r\n        this._buildTimersTab();\r\n        this._buildPhysicsTab();\r\n        this._buildDebugSettingsTab();\r\n\r\n        setInterval(() => {\r\n            this.update(this)\r\n        }, 30)\r\n\r\n        this.addListeners();\r\n    }\r\n\r\n    /**\r\n     * Add any event listeners relevant to the devtool\r\n     */\r\n    public addListeners() {\r\n        const game = this.engine;\r\n        game.canvas.addEventListener('click', () => {\r\n            if (this.highlightedEntities[0] !== -1) {\r\n                this.selectEntityById(this.highlightedEntities[0]);\r\n            }\r\n        });\r\n    }\r\n\r\n    public selectEntityById(id: number) {\r\n        const game = this.engine;\r\n        this.selectedEntityId = id;\r\n        this.selectedEntity = game.currentScene.world.entityManager.getById(id) as ex.Actor;\r\n        this._buildEntityUI(this.selectedEntity);\r\n\r\n        const transformComponent = this.selectedEntity.get(ex.TransformComponent)\r\n        this._buildTransformUI(transformComponent);\r\n\r\n        const motionComponent = this.selectedEntity.get(ex.MotionComponent);\r\n        this._buildMotionUI(motionComponent);\r\n\r\n        if (this.selectedEntity instanceof ex.ParticleEmitter) {\r\n            // build particle emitter UI\r\n            this._buildParticleEmitterUI(this.selectedEntity);\r\n        } else {\r\n            const graphicsComponent = this.selectedEntity.get(ex.GraphicsComponent);\r\n            this._buildGraphicsUI(graphicsComponent);\r\n            \r\n            const colliderComponent = this.selectedEntity.get(ex.ColliderComponent);\r\n            const bodyComponent = this.selectedEntity.get(ex.BodyComponent);\r\n            this._buildColliderUI(colliderComponent, bodyComponent);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * `update()` is called periodically over time\r\n     * @param devtool \r\n     */\r\n    public update(devtool: DevTool) {\r\n        const game = devtool.engine;\r\n        // Current pointer pos\r\n        const pointerPos = game.input.pointers.primary.lastWorldPos;\r\n        this.pointerPos.x = pointerPos.x;\r\n        this.pointerPos.y = pointerPos.y;\r\n        this.pointerPosInput.refresh();\r\n\r\n        // Updated Selection\r\n        const entityIds = [...this.pickerSystem.lastFrameEntityToPointers.keys(), ...this.pickerSystem.currentFrameEntityToPointers.keys()];\r\n        if (entityIds.length === 0) {\r\n            entityIds.push(-1); // nothing selected\r\n            entityIds.push(this.selectedEntityId);\r\n        }\r\n        this.highlightedEntities = entityIds;\r\n        game.debug.filter.useFilter = true;\r\n        game.debug.filter.ids = entityIds;\r\n\r\n        // Update Screen if needed\r\n        if (this.currentResolution.width !== game.screen.resolution.width ||\r\n            this.currentResolution.height !== game.screen.resolution.height ||\r\n            this.currentViewport.width !== game.screen.viewport.width ||\r\n            this.currentViewport.height !== game.screen.viewport.height) {\r\n\r\n            this.resolutionText.dispose();\r\n            this.viewportText.dispose();\r\n            this.resolutionText = this.screenFolder.addBlade({\r\n                view: 'text',\r\n                label: 'resolution',\r\n                value: `(${game.screen.resolution.width}x${game.screen.resolution.height})`,\r\n                parse: v => String(v),\r\n                index: 0\r\n            });\r\n            this.viewportText = this.screenFolder.addBlade({\r\n                view: 'text',\r\n                label: 'viewport',\r\n                value: `(${game.screen.viewport.width.toFixed(0)}x${game.screen.viewport.height.toFixed(0)})`,\r\n                parse: v => String(v),\r\n                index: 1\r\n            });\r\n        }\r\n        // Update timers\r\n        this._buildTimersTab();\r\n    }\r\n\r\n\r\n\r\n    private _installPickerSystemIfNeeded(scene: ex.Scene) {\r\n        this.pickerSystem = scene.world.systemManager.get(PickerSystem);\r\n        if (!this.pickerSystem) {\r\n            this.pickerSystem = new PickerSystem()\r\n            scene.world.systemManager.addSystem(this.pickerSystem)\r\n        }\r\n    }\r\n\r\n    private _buildMain() {\r\n        this.pane.addInput({ debug: false }, 'debug').on('change', () => {\r\n            this.engine.toggleDebug();\r\n        });\r\n\r\n        this.pane.addMonitor(this.engine.clock.fpsSampler, 'fps', {\r\n            view: 'graph',\r\n            label: 'fps (0 - 120)',\r\n            min: 0,\r\n            max: 120\r\n        });\r\n\r\n        let currentSceneName = '';\r\n        let scenes: { text: string, value: string }[] = []\r\n        for (let key in this.engine.scenes) {\r\n            if (this.engine.currentScene === this.engine.scenes[key]) {\r\n                currentSceneName = key;\r\n            }\r\n            scenes.push({ text: key, value: key })\r\n        }\r\n\r\n        let numberEntitiesBlade: BladeApi<any>;\r\n        const scenePicker = this.pane.addBlade({\r\n            view: 'list',\r\n            label: 'current scene',\r\n            options: scenes,\r\n            value: currentSceneName\r\n        }) as ListApi<string>;\r\n\r\n        scenePicker.on('change', ev => {\r\n            this.engine.goToScene(ev.value);\r\n            this._installPickerSystemIfNeeded(this.engine.currentScene);\r\n            numberEntitiesBlade.dispose();\r\n            numberEntitiesBlade = this.pane.addBlade({\r\n                view: 'text',\r\n                label: 'number of entities',\r\n                value: this.engine.currentScene.world.entityManager.entities.length,\r\n                parse: v => String(v),\r\n                index: 3\r\n            });\r\n        });\r\n\r\n        numberEntitiesBlade = this.pane.addBlade({\r\n            view: 'text',\r\n            label: 'number of entities',\r\n            value: this.engine.currentScene.world.entityManager.entities.length,\r\n            parse: v => String(v),\r\n            index: 3\r\n        });\r\n        this.pointerPos = { x: 10, y: 10 };\r\n        this.pointerPosInput = this.pane.addInput(this, \"pointerPos\", {\r\n            label: 'pointer pos (world)'\r\n        });\r\n\r\n        this.pane.addInput(this, \"selectedEntityId\", {\r\n            \"label\": \"Select By Id\"\r\n        }).on(\"change\", ev => this.selectEntityById(ev.value));\r\n\r\n    }\r\n\r\n    private _buildEntityUI(entity: ex.Entity) {\r\n        if (this.selectedEntityFolder) {\r\n            this.selectedEntityFolder.dispose();\r\n            this.selectedEntityFolder = this.selectedEntityTab.addFolder({\r\n                title: 'Selected'\r\n            });\r\n        }\r\n        this.selectedEntityFolder.addBlade({ view: 'text', label: 'id', value: entity.id.toString(), parse: v => String(v) });\r\n        this.selectedEntityFolder.addInput(this.selectedEntity, 'name');\r\n\r\n        this.selectedEntityFolder.addBlade({\r\n            view: 'text',\r\n            label: 'tags',\r\n            value: entity.tags.join(',') || 'none',\r\n            parse: v => String(v)\r\n        });\r\n\r\n        if (entity instanceof ex.Actor && entity.color) {\r\n            this.selectedEntityFolder.addInput(this.selectedEntity as ex.Actor, 'color').on(\"change\", ev => {\r\n                entity.color = new ex.Color(ev.value.r, ev.value.g, ev.value.b, ev.value.a);\r\n            });\r\n        }\r\n        this.selectedEntityFolder.addBlade({\r\n            view: 'text',\r\n            label: 'parent',\r\n            value: entity.parent ? `(${entity.parent?.id}) ${entity.parent?.name}` : 'none',\r\n            parse: (v) => String(v)\r\n        });\r\n        this.selectedEntityFolder.addBlade({\r\n            view: 'list',\r\n            label: 'children',\r\n            options: entity.children.map(c => ({ text: `(${c.id}) ${c.name}`, value: c.id })),\r\n            value: entity.children.length ? entity.children[0].id : 'none',\r\n        });\r\n        this.selectedEntityFolder.addButton({\r\n            title: 'Kill Entity'\r\n        }).on(\"click\", ev => {\r\n            this.selectedEntity.kill();\r\n            // clear entity tab\r\n            this.selectedEntityFolder.dispose();\r\n            this.selectedEntityFolder = this.selectedEntityTab.addFolder({\r\n                title: 'Selected'\r\n            });\r\n        });\r\n\r\n    }\r\n\r\n    private _buildColliderUI(colliderComponent: ex.ColliderComponent, bodyComponent: ex.BodyComponent) {\r\n        if (colliderComponent) {\r\n\r\n            const collider = this.selectedEntityFolder.addFolder({\r\n                title: 'Collider & Body'\r\n            });\r\n            collider.addBlade({\r\n                view: 'text',\r\n                label: 'type',\r\n                value: (colliderComponent.get() as any)?.constructor.name ?? 'none',\r\n                parse: (v) => String(v)\r\n            });\r\n            if (bodyComponent) {\r\n\r\n                const collisionTypes = collider.addBlade({\r\n                    view: 'list',\r\n                    label: 'collisionType',\r\n                    options: [ex.CollisionType.Active, ex.CollisionType.Fixed, ex.CollisionType.Passive, ex.CollisionType.PreventCollision].map(\r\n                        c => ({\r\n                            text: c,\r\n                            value: c\r\n                        })),\r\n                    value: bodyComponent.collisionType\r\n                }) as ListApi<ex.CollisionType>;\r\n                collisionTypes.on(\"change\", ev => {\r\n                    bodyComponent.collisionType = ev.value;\r\n                });\r\n\r\n                const collisionGroups = collider.addBlade({\r\n                    view: 'list',\r\n                    label: 'collisionGroup',\r\n                    options: [ex.CollisionGroup.All, ...ex.CollisionGroupManager.groups].map(c => ({\r\n                        text: c.name,\r\n                        value: c\r\n                    })),\r\n                    value: bodyComponent.group\r\n                }) as ListApi<any>;\r\n                collisionGroups.on(\"change\", ev => {\r\n                    bodyComponent.group = ev.value;\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private _buildParticleEmitterUI(particles: ex.ParticleEmitter) {\r\n        const particlesFolder = this.selectedEntityFolder.addFolder({\r\n            title: 'Particles'\r\n        });\r\n\r\n        particlesFolder.addInput(particles, \"isEmitting\");\r\n        particlesFolder.addInput(particles, \"emitRate\");\r\n        particlesFolder.addInput(particles, \"fadeFlag\");\r\n        particlesFolder.addInput(particles, \"particleLife\", {\r\n            min: 100,\r\n            max: 10000,\r\n            step: 100\r\n        });\r\n        particlesFolder.addInput(particles, \"width\");\r\n        particlesFolder.addInput(particles, \"height\");\r\n        particlesFolder.addInput(particles, \"minVel\");\r\n        particlesFolder.addInput(particles, \"maxVel\");\r\n        particlesFolder.addInput(particles, \"minAngle\", {\r\n            min: 0,\r\n            max: Math.PI * 2,\r\n            step: .1\r\n        });\r\n        particlesFolder.addInput(particles, \"maxAngle\",  {\r\n            min: 0,\r\n            max: Math.PI * 2,\r\n            step: .1\r\n        });\r\n        particlesFolder.addInput(particles, \"minSize\");\r\n        particlesFolder.addInput(particles, \"maxSize\");\r\n        particlesFolder.addInput(particles, \"beginColor\");\r\n        particlesFolder.addInput(particles, \"endColor\");\r\n        particlesFolder.addInput(particles, \"opacity\", {\r\n            min: 0,\r\n            max: 1,\r\n            step: .01\r\n        });\r\n        particlesFolder.addInput(particles, \"randomRotation\");\r\n        particlesFolder.addInput(particles, \"particleRotationalVelocity\");\r\n    }\r\n\r\n    private _buildGraphicsUI(graphicsComponent: ex.GraphicsComponent) {\r\n        if (graphicsComponent) {\r\n\r\n            const graphics = this.selectedEntityFolder.addFolder({\r\n                title: 'Graphics'\r\n            });\r\n\r\n            graphics.addInput(graphicsComponent, \"anchor\");\r\n            graphics.addInput(graphicsComponent, \"opacity\", {\r\n                min: 0,\r\n                max: 1,\r\n                step: 0.05\r\n            });\r\n            graphics.addInput(graphicsComponent, \"visible\");\r\n\r\n            // woof a lot of effort to do this\r\n            const dropdown: { text: string; value: number; }[] = [];\r\n            const allGraphics: ex.Graphic[] = [];\r\n            const currentGfx = graphicsComponent.current.map(c => c.graphic);\r\n            const namedGfx: ex.Graphic[] = [];\r\n            let gfxIndex = 0;\r\n            for (let key in graphicsComponent.graphics) {\r\n                dropdown.push({ text: key, value: gfxIndex++ });\r\n                allGraphics.push(graphicsComponent.graphics[key]);\r\n\r\n                namedGfx.push(graphicsComponent.graphics[key]);\r\n            }\r\n            let anonIndex = 0;\r\n            for (let graphic of currentGfx) {\r\n                if (namedGfx.indexOf(graphic) === -1) {\r\n                    dropdown.push({ text: `anonymous${anonIndex++}`, value: gfxIndex });\r\n                    allGraphics.push(graphic);\r\n                }\r\n            }\r\n\r\n            const graphicsList = graphics.addBlade({\r\n                view: 'list',\r\n                label: 'graphics',\r\n                options: dropdown,\r\n                value: allGraphics.indexOf(graphicsComponent.current[0]?.graphic)\r\n            }) as ListApi<number>;\r\n            graphicsList.on('change', ev => {\r\n                graphicsComponent.use(allGraphics[ev.value]);\r\n            });\r\n        }\r\n    }\r\n\r\n    private _buildMotionUI(motionComponent: ex.MotionComponent) {\r\n        if (motionComponent) {\r\n            const motion = this.selectedEntityFolder.addFolder({\r\n                title: 'Motion'\r\n            });\r\n            motion.addInput(motionComponent, \"vel\");\r\n            motion.addInput(motionComponent, \"acc\");\r\n            motion.addInput(motionComponent, \"angularVelocity\", {\r\n                step: .1\r\n            });\r\n            motion.addInput(motionComponent, \"scaleFactor\");\r\n            motion.addInput(motionComponent, \"inertia\");\r\n        }\r\n    }\r\n\r\n    private _buildTransformUI(transformComponent: ex.TransformComponent) {\r\n        if (transformComponent) {\r\n            const transform = this.selectedEntityFolder.addFolder({\r\n                title: 'Transform'\r\n            });\r\n            const coordPlane = transform.addBlade({\r\n                view: 'list',\r\n                label: 'coord plane',\r\n                options: [ex.CoordPlane.World, ex.CoordPlane.Screen].map(c => ({ text: c, value: c })),\r\n                value: transformComponent.coordPlane\r\n            }) as ListApi<ex.CoordPlane>;\r\n            coordPlane.on(\"change\", ev => transformComponent.coordPlane = ev.value);\r\n\r\n            const tx = transform.addInput(transformComponent, \"pos\");\r\n            const rot = transform.addInput(transformComponent, \"rotation\", {\r\n                min: 0,\r\n                max: 2 * Math.PI,\r\n            });\r\n            const scale = transform.addInput(transformComponent, 'scale');\r\n            transform.addSeparator();\r\n\r\n            const globalTx = transform.addInput(transformComponent, \"globalPos\", { label: \"global pos\" });\r\n            const globalRot = transform.addInput(transformComponent, \"globalRotation\", {\r\n                label: \"global rot\",\r\n                min: 0,\r\n                max: 2 * Math.PI,\r\n            });\r\n            const globalScale = transform.addInput(transformComponent, 'globalScale', { label: \"global pos\" });\r\n\r\n            globalTx.on(\"change\", () => tx.refresh());\r\n            tx.on(\"change\", () => globalTx.refresh());\r\n\r\n            globalRot.on(\"change\", () => rot.refresh());\r\n            rot.on(\"change\", () => globalRot.refresh());\r\n\r\n            globalScale.on(\"change\", () => scale.refresh());\r\n            scale.on(\"change\", () => globalScale.refresh());\r\n\r\n            transform.addInput(transformComponent, \"z\", {label : \"z-index\"});\r\n        }\r\n    }\r\n\r\n    private _buildScreenTab() {\r\n        this.screenFolder = this.screenTab.addFolder({\r\n            title: 'Screen'\r\n        });\r\n        this.currentResolution = this.engine.screen.resolution;\r\n        this.currentViewport = this.engine.screen.viewport;\r\n        this.resolutionText = this.screenFolder.addBlade({\r\n            view: 'text',\r\n            label: 'resolution',\r\n            value: `(${this.engine.screen.resolution.width}x${this.engine.screen.resolution.height})`,\r\n            parse: v => String(v),\r\n            index: 0\r\n        });\r\n        this.viewportText = this.screenFolder.addBlade({\r\n            view: 'text',\r\n            label: 'viewport',\r\n            value: `(${this.engine.screen.viewport.width.toFixed(0)}x${this.engine.screen.viewport.height.toFixed(0)})`,\r\n            parse: v => String(v),\r\n            index: 1\r\n        });\r\n\r\n        let fullscreen = this.screenFolder.addButton({\r\n            title: 'Fullscreen',\r\n        });\r\n        fullscreen.on('click', () => {\r\n            this.engine.screen.goFullScreen();\r\n        });\r\n\r\n        this.screenFolder.addSeparator();\r\n\r\n        const colorBlindness = this.screenFolder.addBlade({\r\n            view: 'list',\r\n            label: 'Color Blindness Mode',\r\n            options: [ex.ColorBlindnessMode.Deuteranope, ex.ColorBlindnessMode.Protanope, ex.ColorBlindnessMode.Tritanope].map(c => ({ text: c, value: c })),\r\n            value: ex.ColorBlindnessMode.Deuteranope\r\n        }) as ListApi<ex.ColorBlindnessMode>;\r\n\r\n        const shouldSimulate = {\"simulate\": false};\r\n        const simulate = this.screenFolder.addInput(shouldSimulate, \"simulate\");\r\n\r\n        this.screenFolder.addButton({\r\n            title: 'Apply'\r\n        }).on(\"click\", () => {\r\n            if (shouldSimulate.simulate) {\r\n                this.engine.debug.colorBlindMode.simulate(colorBlindness.value);\r\n            } else {\r\n                this.engine.debug.colorBlindMode.correct(colorBlindness.value);\r\n            }\r\n        });\r\n        this.screenFolder.addButton({\r\n            title: 'Clear'\r\n        }).on('click', () => {\r\n            this.engine.debug.colorBlindMode.clear();\r\n        });\r\n    }\r\n\r\n    private _buildCameraTab() {\r\n        const cameraFolder = this.cameraTab.addFolder({\r\n            title: 'Camera',\r\n        });\r\n\r\n        cameraFolder.addInput(this.engine.currentScene.camera, \"zoom\", {\r\n            min: .01,\r\n            max: 10,\r\n            step: .1\r\n        });\r\n        cameraFolder.addInput(this.engine.currentScene.camera, \"pos\");\r\n    }\r\n\r\n    private _buildClockTab() {\r\n        const clock = this.clockTab.addFolder({\r\n            title: 'Clock'\r\n        });\r\n\r\n        let usingTestClock = this.engine.clock instanceof ex.TestClock;\r\n        let stepMs = 16;\r\n        const step = clock.addButton({\r\n            title: 'step',\r\n            disabled: !usingTestClock,\r\n            index: 2\r\n        }).on('click', () => (this.engine.clock as ex.TestClock).step(stepMs));\r\n        const stepSlider = clock.addBlade({\r\n            view: 'slider',\r\n            label: 'step (ms)',\r\n            min: 1,\r\n            max: 100,\r\n            step: 16,\r\n            value: stepMs\r\n        }) as SliderApi;\r\n        stepSlider.on('change', ev => stepMs = ev.value)\r\n\r\n        const useTestClock = clock.addButton({\r\n            title: 'Use Test Clock',\r\n            index: 0,\r\n        });\r\n        useTestClock.on('click', () => {\r\n            this.engine.debug.useTestClock();\r\n            usingTestClock = true;\r\n            step.disabled = false;\r\n        });\r\n\r\n        const useStandardClock = clock.addButton({\r\n            title: 'Use Standard Clock',\r\n            index: 1\r\n        });\r\n        useStandardClock.on('click', () => {\r\n            this.engine.debug.useStandardClock();\r\n            usingTestClock = false;\r\n            step.disabled = true;\r\n        });\r\n\r\n        this.pane.addSeparator();\r\n\r\n        const stopGameButton = clock.addButton({\r\n            title: 'Stop',\r\n            disabled: false\r\n        });\r\n        const startGameButton = clock.addButton({\r\n            title: 'Start',\r\n            disabled: true\r\n        });\r\n        stopGameButton.on('click', () => {\r\n            this.engine.clock.stop();\r\n            startGameButton.disabled = false;\r\n            stopGameButton.disabled = true;\r\n        });\r\n        startGameButton.on('click', () => {\r\n            this.engine.clock.start();\r\n            stopGameButton.disabled = false;\r\n            startGameButton.disabled = true;\r\n        });\r\n\r\n    }\r\n\r\n    private _timersFolder: FolderApi;\r\n    private _buildTimersTab() {\r\n        const timers = this.timerTab;\r\n\r\n        if (this._timersFolder) {\r\n            this._timersFolder.dispose();\r\n        }\r\n        this._timersFolder = this.timerTab.addFolder({\r\n            title: \"Timers\"\r\n        });\r\n\r\n\r\n        for (let timer of this.engine.currentScene.timers) {\r\n            let status = (timer.repeats && timer.maxNumberOfRepeats === -1) ? 'repeats': ((timer as any)._numberOfTicks + 1) + ' of ' + (timer.maxNumberOfRepeats === -1 ? 1 : timer.maxNumberOfRepeats);\r\n            if (!timer.isRunning) {\r\n                status = \"stopped\";\r\n            }\r\n            if (timer.complete) {\r\n                status = \"complete\";\r\n            }\r\n            this._timersFolder.addBlade({\r\n                view: 'text',\r\n                label: `timer(${timer.id})`,\r\n                value:`${status} next(${timer.timeToNextAction.toFixed(0)}ms)`,\r\n                parse: v => String(v)\r\n            });\r\n        }\r\n    }\r\n\r\n    private _buildPhysicsTab() {\r\n        const physics = this.physicsTab;\r\n\r\n        const physicsSettings: typeof ex.Physics = {} as any\r\n\r\n        for (let key in ex.Physics) {\r\n            physicsSettings[key] = ex.Physics[key];\r\n        }\r\n        physics.addInput(physicsSettings, \"enabled\").on('change', ev => ex.Physics.enabled = ev.value);\r\n        physics.addInput(physicsSettings, \"acc\");\r\n        const solverInput = physics.addInput(physicsSettings, \"collisionResolutionStrategy\");\r\n        physics.addButton({\r\n            title: 'Use Arcade'\r\n        }).on('click', () => {\r\n            ex.Physics.useArcadePhysics();\r\n            physicsSettings.collisionResolutionStrategy = ex.Physics.collisionResolutionStrategy;\r\n            solverInput.refresh();\r\n        });\r\n        physics.addButton({\r\n            title: 'Use Realistic'\r\n        }).on('click', () => {\r\n            ex.Physics.useRealisticPhysics();\r\n            physicsSettings.collisionResolutionStrategy = ex.Physics.collisionResolutionStrategy;\r\n            solverInput.refresh();\r\n        });\r\n\r\n        physics.addInput(physicsSettings, 'bodiesCanSleepByDefault').on(\"change\", ev => ex.Physics.bodiesCanSleepByDefault = ev.value);\r\n        physics.addInput(physicsSettings, 'warmStart').on(\"change\", ev => ex.Physics.warmStart = ev.value);\r\n        physics.addInput(physicsSettings, 'sleepEpsilon', { min: 0.01, max: 2, step: .05}).on(\"change\", ev => ex.Physics.sleepEpsilon = ev.value);\r\n        physics.addInput(physicsSettings, 'wakeThreshold', { min: 0.01, max: 2, step: .05}).on(\"change\", ev => ex.Physics.wakeThreshold = ev.value);\r\n        physics.addInput(physicsSettings, \"positionIterations\", {\r\n            min: 1,\r\n            max: 30,\r\n            step: 1\r\n        }).on(\"change\", ev => ex.Physics.positionIterations = ev.value);\r\n        physics.addInput(physicsSettings, \"velocityIterations\", {\r\n            min: 1,\r\n            max: 30,\r\n            step: 1\r\n        }).on('change', ev => ex.Physics.velocityIterations = ev.value);\r\n        // physics.addInput(Physics, \"acc\");\r\n        physics.addInput(physicsSettings, \"checkForFastBodies\").on(\"change\", ev => ex.Physics.checkForFastBodies = ev.value);\r\n    }\r\n\r\n    private _buildDebugSettingsTab() {\r\n        const debug = this.debugTab;\r\n\r\n        var supportedKeys = ['entity', 'transform', 'motion', 'body', 'collider', 'physics', 'graphics', 'camera'];\r\n        for (let key of supportedKeys) {\r\n            let folder = debug.addFolder({ title: key });\r\n            if (this.engine.debug[key]) {\r\n                for (let option in this.engine.debug[key]) {\r\n                    if (option) {\r\n                        if (option.toLocaleLowerCase().includes('color')) {\r\n                            folder.addInput(this.engine.debug[key], option);\r\n                        } else {\r\n                            if (Array.isArray(this.engine.debug[key][option])) {\r\n                                continue;\r\n                            }\r\n                            folder.addInput(this.engine.debug[key], option);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}"],"names":["$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","factory","self","__webpack_require__","entryUnbind","module","exports","path","global","isCallable","tryToString","TypeError","argument","isObject","String","toIndexedObject","toAbsoluteIndex","lengthOfArrayLike","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","index","includes","indexOf","fails","METHOD_NAME","method","call","createProperty","Array","max","Math","start","end","k","fin","undefined","result","n","arraySlice","floor","mergeSort","array","comparefn","middle","insertionSort","merge","element","j","left","right","llength","rlength","lindex","rindex","uncurryThis","toString","stringSlice","slice","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","arguments","tag","key","error","tryGet","callee","hasOwn","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","exceptions","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","toPropertyKey","propertyKey","get","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","bind","hasOwnProperty","NATIVE_BIND","Function","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","fn","aFunction","namespace","aCallable","V","P","func","check","globalThis","window","g","this","toObject","a","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","has","NATIVE_WEAK_MAP","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","isPrototypeOf","USE_SYMBOL_AS_UID","$Symbol","toLength","obj","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","V8_PROTOTYPE_DEFINE_BUG","anObject","$defineProperty","$getOwnPropertyDescriptor","ENUMERABLE","WRITABLE","Attributes","current","propertyIsEnumerableModule","internalObjectKeys","concat","getOwnPropertyNames","push","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","uid","SHARED","IS_PURE","mode","copyright","license","toIntegerOrInfinity","min","integer","IndexedObject","requireObjectCoercible","ceil","number","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","symbolFor","createWellKnownSymbol","withoutSetter","description","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","un$Sort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","v","b","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","sources","mappings","sourcesContent","sourceRoot","__WEBPACK_DEFAULT_EXPORT__","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","__webpack_module_cache__","__webpack_require__1","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","definition","o","e","prop","r","toStringTag","Experiments1","Legacy1","Legacy","LogLevel1","LogLevel","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","createId","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","args","len","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","body","appendChild","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","property","SyntaxError","DecoratedClass","super","Vector","_x","_y","Zero","One","Half","Up","Down","Left","Right","angle","cos","sin","vec","isNaN","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","__decorate","Side1","Side","Color","parseInt","parseFloat","hex","h","s","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","c","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","Color_decorate","p","q","t","hue2rgb","getOpposite","side","Top","Bottom","None","fromDirection","direction","directions","directionEnum","Number","MAX_VALUE","maxIndex","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","matFirstColumn","xa","xb","matSecondColumn","ya","yb","matrixPos","getPosition","topLeft","bottomRight","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","contains","combine","other","dimensions","overlaps","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","sign","clamp","canonicalizeAngle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","randomInRange","randomIntInRange","round","Util_TwoPI","Util_clamp","Util_randomInRange","Util_randomIntInRange","Util_canonicalizeAngle","Util_toDegrees","Util_toRadians","Util_range","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","forEach","fail","delay1","milliseconds","clock","schedule","setTimeout","MatrixLocations1","MatrixLocations","ImageFiltering1","ImageFiltering","EventTypes1","EventTypes","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","toDOMMatrix","DOMMatrix","reset","identity","sx","sy","angleRadians","vectorOrMatrix","dest","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","save","restore","StateStack","_states","_currentState","_getDefaultState","_cloneState","watch","change","__isProxy","Proxy","watchAny","Graphic","_ID","_transformStale","showDebug","_flipHorizontal","_flipVertical","_rotation","_scale","_origin","_width","_height","origin","flipHorizontal","flipVertical","rotation","_d","_e","isStale","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","isPowerOfTwo","nextHighestPowerOfTwo","ensurePowerOfTwo","getGlTypeSizeBytes","gl","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","UNSIGNED_BYTE","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","getAttributePointerType","TextureLoader","context","_GL","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","image","_TEXTURE_MAP","filtering","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","Pixel","NEAREST","LINEAR","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","originalSrc","dataset","_LOGGER","Blended","Map","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","_g","bitmapHeight","_h","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","load","setLineDash","getLineDash","_options","cache","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","emit","eventName","event","on","off","eventHandlers","once","ev","wire","eventDispatcher","unwire","Resource","responseType","bustCache","logger","events","isLoaded","_cacheBust","uri","request","XMLHttpRequest","open","addEventListener","status","response","statusText","send","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","SpriteEffects_decorate","Invert","Opacity","Colorize","Lighten","fromRGB","Darken","Saturate","Desaturate","Fill","Texture","_sprite","loaded","_loadedResolve","_resource","Sprite_Sprite","async","url","blob","URL","createObjectURL","Image","src","decode","naturalWidth","naturalHeight","asSprite","Configurable","base","assign","props","filter","SpriteImpl","imageOrConfig","offset","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","texture","_initPixelsFromTexture","drawWidth","drawHeight","_loadPixels","_flushTexture","grayscale","addEffect","fill","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","xpoint","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","_j","anchorX","anchorY","oldAlpha","globalAlpha","Sprite_decorate","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","_logger","_filtering","endsWith","_src","setAttribute","toSprite","unload","AnimationImpl","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","Engine","config","_engine","_setAnchor","_setRotation","_setScale","isDone","tick","elapsed","idempotencyToken","_updateValues","skip","frames","animOptions","currSprite","play","playAnimation","Animation_Animation","images","FontUnit1","FontUnit","TextAlign1","TextAlign","BaseAlign1","BaseAlign","FontStyle1","FontStyle","Direction1","Direction","Animation_decorate","SpriteSheet_SpriteSheet","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteFont","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","setTextShadow","offsetX","offsetY","shadowColor","character","useTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet_decorate","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","SpriteFont_SpriteFont","_text","shadow","_alreadyWarnedAlphabet","_alreadyWarnedSpriteSheet","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","measureText","lines","maxWidthLine","reduce","xCursor","yCursor","line","render","bounds","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","RenderSource","_gl","_texture","use","activeTexture","TEXTURE0","disable","RenderTarget","_setupFramebuffer","setResolution","_frameTexture","frameBuffer","_frameBuffer","frameTexture","attachmentPoint","COLOR_ATTACHMENT0","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","toRenderSource","viewport","ExcaliburWebGLContextAccessor","Shader","uniforms","attributes","_compiled","vertexSource","fragmentSource","compiled","useProgram","program","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","setUniformIntArray","setUniformBoolean","setUniformFloat","setUniformFloatArray","setUniformFloatVector","setUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","upload","STATIC_DRAW","DYNAMIC_DRAW","VertexLayout","_layout","_attributes","_vertexTotalSizeBytes","vertexBuffer","_vertexBuffer","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","uploadBuffer","vert","vertexAttribPointer","enableVertexAttribArray","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_context","ortho","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","finalPoint","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","getExtension","Uint32Array","maxUint16","maxUint16Index","bufferGlType","Uint16Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","MAX_TEXTURE_IMAGE_UNITS","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","_bindTextures","_getTextureIdForImage","swidth","sheight","dx","dy","dwidth","dheight","view","sw","sh","snapToPixel","topRight","bottomLeft","textureId","potWidth","potHeight","uvx0","uvy0","uvx1","uvy1","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","drawPoint","pointOptions","drawText","ExcaliburGraphicsContextWebGL","_renderers","_isDrawLifecycle","_postProcessTargets","_postprocessors","_transform","_state","backgroundColor","_alreadyWarnedDrawLifecycle","canvasElement","enableTransparency","__gl","antialias","premultipliedAlpha","alpha","depth","powerPreference","register","_init","canvas","_ortho","checkIfResolutionSupported","dim","supported","clearColor","COLOR_BUFFER_BIT","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","_screenRenderer","_renderTarget","__ctx","renderer","rendererName","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","resetTransform","updateViewport","resolution","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","values","DisplayMode1","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","_displayMode","displayMode","Fixed","graphicsContext","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","dispose","_resizeObserver","disconnect","removeEventListener","isHiDpi","FillContainer","FitContainer","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","imageRendering","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","inverse","worldToScreenCoordinates","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","halfDrawWidth","halfDrawHeight","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","Position","_initializeDisplayModePosition","Window","ResizeObserver","observe","FillScreen","FitScreen","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line1","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","point1","arc","vector1","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle1","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","Loader_0","Z","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","_isLoadedPromise","_isLoadedResolve","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","addResource","loadable","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","_a1","removeChild","update","_delta","areResourcesLoaded","all","finally","showPlayButton","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType1","CollisionType","CollisionResolutionStrategy1","CollisionResolutionStrategy","BroadphaseStrategy1","BroadphaseStrategy","Integrator1","Integrator","CoordPlane1","CoordPlane","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","Physics_decorate","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","Component","owner","newComponent","TagComponent","Observable","observers","subscriptions","observer","subscribe","unregister","unsubscribe","notifyAll","notify","cb","TransformComponent","X","Y","createPosView","posChanged$","createScaleView","coordPlane","World","zIndexChanged$","_z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","z","oldPos","oldX","oldY","parentTransform","oldz","globalScaleX","globalScaleY","applyInverse","MotionComponent","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_name","_category","_mask","canCollide","collisionGroups","combinedName","combinedCategory","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","group","collisionType","PreventCollision","active","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","worldBounds","root","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","u","getLength","intersectPoint","time","getPoint","DynamicTreeCollisionProcessor","_dynamicCollisionTree","_pairs","Set","_collisionPairCache","_colliders","getColliders","track","CompositeCollider","colliders","untrack","_pairExists","hash","broadphase","targets","seconds","potentialColliders","pair","physics","collider1","Active","updateDistance","minDimension","fastBodies","updateVec","centerPoint","furthestPoint","getFurthestPoint","minCollider","minTranslate","hitPoint","isValid","shift","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","touching","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","maxDistance","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","minPoint","minDistance","project","projs","proj","newProjection","Line","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","PolygonCircleClosestLine","circle","circlex","circley","CircleCircleClosestLine","circleA","circleB","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","CircleCollider","_naturalRadius","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","newPos","CollisionContact","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","SeparatingAxis","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","circleAPos","circleBPos","combinedRadius","mvt","local","findCirclePolygonSeparation","samedir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clipLeft","xf","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","_isClockwiseWinding","reverse","isConvex","_calculateTransformation","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","entries","tessellate","polygons","Shape","Polygon","triangulate","getItem","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","triangles","vertices","va","vb","vc","leftArm","isEar","vertIndex","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Circle","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom1","DegreeOfFreedom","RotationType1","RotationType","dependencies","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","inverseInertia","motion","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","OffscreenCulling","cullingBox","actorBoundsOffscreen","currentScene","isOffScreen","removeComponent","addComponent","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","Entity","components","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","component","kill","isKilled","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","getComponents","_notifyAddComponent","added","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","child","addTemplate","templateEntity","ctor","constuctorType","componentOrType","_removeComponentByType","delete","processComponentRemoval","isInitialized","_initialize","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","hasGraphicsTick","graphic","GraphicsLayer","_graphics","graphics","hide","nameOrGraphic","gfx","getGraphic","recalculateBounds","show","copyGraphics","getNames","order","currentKeys","GraphicsLayers","_component","_layers","_layerMap","default","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_localBounds","onPreDraw","onPostDraw","layers","graphicToSet","Rectangle","_radius","PointerComponent","useColliderShape","useGraphicsBounds","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","EasingFunctions_decorate","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","isComplete","elapsedMs","Repeat","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","MoveTo","destx","desty","RotateTo","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_method","_hasBeenCalled","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","Fade","endOpacity","_multiplier","_endOpacity","Delay","delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","_queue","easeTo","xOrPos","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","toPromise","Font","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textToBitmap","_bitmapUsage","_o","_p","_q","_r","blur","fontString","_ex","_getTextBitmap","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","_setDimension","textBounds","_getRasterPropertiesHash","textBaseline","font","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","colorOverride","lineHeight","strokeText","textAndHash","clearCache","checkAndClearCache","isNewBitmap","rasterWidth","rasterHeight","performance","cacheSize","Text","_textWidth","_textHeight","_font","_calculateDimension","Actor","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","_pointerDragLeaveHandler","traits","collisionGroup","defaults","Passive","pointer","actions","thePos","theVel","theAcc","theAngle","isVisible","draggable","isDraggable","currentGraphic","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","Actor_decorate","ScreenElement_ScreenElement","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","_MAX_ID","_callbacks","complete","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Timer_decorate","DebugGraphicsComponent","useTransform","Axis1","Axis","TileMap","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","tiles","_cols","_collidersDirty","_originalOffsets","_composite","flagCollidersDirty","tileWidth","tileHeight","currentCol","cd","Tile","registerSpriteSheet","fromLegacySpriteSheet","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","tile","solid","prev","getTileByIndex","getTile","getTileByPoint","getRows","getColumns","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","getGraphics","grayish","TileMap_decorate","_posDirty","_solid","_pos","addGraphic","removeGraphic","clearGraphics","_bounds","pushSprite","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","target1","_cam","_eng","target2","cam","currentFocus","getFocus","target3","focus","cameraVel","stretch","target4","target5","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","dz","az","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","res","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","cameraPos","isScreenElement","triggerDefaults","Trigger_Trigger","opts","_dispatchAction","_target","wp","SystemType1","SystemType","System","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","EntityManager","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","removeEntity","findEntitiesForRemoval","queryManager","addEntity","idOrEntity","deferred","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","buildTypeKey","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","QueryManager","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","maybeExistingQuery","getQuery","SystemManager","systems","initialized","systemType","find","addSystem","system","removeSystem","updateSystems","s3","preupdate","s1","Scene","s2","postupdate","systemManager","Update","entityOrSystem","clearEntities","clearSystems","EulerIntegrator","totalAcc","MotionSystem","optionalBody","integrate","CollisionSolver","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contact1","contactPoints","pointIndex","contact2","constraints","maxCorrection","steeringForce","restitution","impulseDelta","maxFriction","newImpulse","point2","CollisionSystem","_realisticSolver","_arcadeSolver","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","colliderComponent","colliderComp","getSolver","runContactStartEnd","id1","c1","AnimationDirection1","AnimationDirection","AnimationStrategy1","AnimationStrategy","EmitterType1","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","maybeFrame","frameIndices","durationPerFrameMs","invalidIndices","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","done","frameNumber","_nextFrame","PingPong","elapsedMilliseconds","GraphicsGroup","members","_updateDimensions","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","isOffscreen","ParticleEmitter","tmpColor","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","emitParticles","particleCount","_createParticle","world","clearParticles","ranX","ranY","GraphicsSystem","Draw","_sortedTransforms","_zHasChanged","_zIndexUpdate","sortedTransforms","_graphicsContext","entityAddedOrRemoved","_applyTransform","particleOpacity","_drawGraphicsComponent","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","CanvasDrawingSystem","canvasdraw","_clearScreen","offscreen","_pushCameraTransform","_popCameraTransform","drawnImages","drawCalls","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","showAll","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","collider2","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","point3","collisionNormalColor","showFocus","focusColor","showZoom","PointerSystem","overrideUseColliderShape","overrideUseGraphicsBounds","lastFrameEntityToPointers","currentFrameEntityToPointers","_sortedEntities","_receiver","pointers","entityCurrentlyUnderPointer","pointerId","entityWasUnderPointer","entered","addPointerToEntity","_processPointerToEntity","_dispatchEvents","currentFramePointerCoords","screenPos","graphicBounds","_processDownAndEmit","lastDownPerPointer","currentFrameDown","isDragStart","_processUpAndEmit","lastUpPerPointer","currentFrameUp","isDragEnd","_processMoveAndEmit","lastMovePerPointer","currentFrameMove","isDragging","_processEnterLeaveAndEmit","lastUpDownMoveEvents","_processCancelAndEmit","currentFrameCancel","_processWheelAndEmit","currentFrameWheel","lastFrameEntities","currentFrameEntities","entitiesWithEvents","ActionsSystem","IsometricEntityComponent","elevation","IsometricEntitySystem","iso","OffscreenSystem","entityOffscreen","_isOffscreen","transformedBounds","ColorBlindnessMode1","ColorBlindnessMode","PointerScope1","PointerScope","Keys1","Keys","Buttons1","Buttons","Axes1","Axes","WheelDeltaMode1","WheelDeltaMode","NativePointerButton1","NativePointerButton","PointerButton1","PointerButton","PointerType1","PointerType","_timers","_cancelQueue","triggers","tileMaps","screenElements","timers","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","addTimer","addScreenElement","removeScreenElement","addTileMap","tileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","ui","alive","Scene_decorate","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","FrameStats","prevFrame","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","otherStats","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_handleKeyDown","keyEvent","_handleKeyUp","init","noop","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","KeyboardEvent","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","at","timestamp","bi","ai","navigatorGamepad","getButton","pressed","updateButton","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","i1","isButtonPressed","buttonIndex","axesIndex","BrowserComponent","_paused","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","ExcaliburGraphicsContext2DCanvasDebug","ExcaliburGraphicsContext2DCanvas","setTransform","_postprocessor","GlobalCoordinates","pagePos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","pointerType","coordinates","nativeEvent","WheelEvent","screenX","screenY","deltaX","deltaY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","isDown","wasDown","event1","event2","event3","event4","native","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode1","onmousewheel","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","TouchEvent","Unknown","Touch","changedTouches","touch","fromPagePosition","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","transformEntities","NoButton","Pen","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","scheduledTime","_runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","step","run","numberOfSteps","ScrollPreventionMode","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","_timescale","_deferredGoTo","_loadingComplete","_isReady","_isReadyPromise","_isReadyResolve","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","freeze","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","ex2dCtx","exWebglCtx","suppressHiDPIScaling","_mainloop","_loader","rootScene","addScene","___EXCALIBUR_DEVTOOL","isFullscreen","shouldSnapToPixel","timescale","AnimationNode","removeScene","goToScene","scrollPreventionMode","pointerTarget","pointerScope","Document","hidden","visibilityChange","keyboard","_overrideInitialize","_update","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","loader","frameId","beforeUpdate","afterUpdate","afterDraw","game","raf","lastTime","isPaused","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Engine_decorate","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","Label_Label","newFont","isBold","fontFamily","sizeInUnit","fontStyle","fontUnit","align","_legacySpriteFont","sf","fromLegacySpriteFont","getTextWidth","clearTextShadow","exctx","Label_decorate","IsometricTile","graphicsOffset","_tileBounds","_isometricEntityComponent","halfTileWidth","halfTileHeight","xPos","yPos","_gfx","totalWidth","totalHeight","renderFromTopOfGraphic","_recalculateBounds","tileToWorld","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","CollisionGroupManager","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","filled","_points","fillColor","lineColor","Polygon_decorate","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","any","json","WebAudioInstance","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","Sound","paths","_isStopped","_tracks","_wasPlayingOnHidden","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","resumed","_getTrackInstance","newTrack","Gif","_stream","_gif","_animation","_transparentColor","Stream","ParseGif","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","readUnsigned","Uint8Array","stream","_st","_handler","globalColorTable","parseColorTable","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block1","parseGCExt","block","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","block2","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","charCodeAt","output","clearCode","eoiCode","codeSize","dict","code1","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","fromRow1","pass","toRow1","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","Polygon_Polygon","SortedList","getComparable","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","SortedList_decorate","_data","_left","_right","MockedElement","getTheKey","Pool","builder","recycler","maxObjects","totalAllocations","objects","using","borrow","poolIndex","PromiseState1","PromiseState","Promises_Promise","Promise_1","Pending","_successCallbacks","_rejectCallback","promises","isArray","_i","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback","Promises_decorate","$55b3c5c261aa2a00$var$Global","$b63e377f8a561b77$exports","Global","$55b3c5c261aa2a00$var$localStorage","localStorage","$55b3c5c261aa2a00$var$read","setItem","each","removeItem","clearAll","$b63e377f8a561b77$var$assign","$b63e377f8a561b77$var$make_assign","$b63e377f8a561b77$var$create","$b63e377f8a561b77$var$make_create","$b63e377f8a561b77$var$trim","$b63e377f8a561b77$var$make_trim","$b63e377f8a561b77$var$Global","$parcel$global","props1","props2","etc","$b63e377f8a561b77$var$each","assignProps1","assignProps2","assignArgsList","$b63e377f8a561b77$var$slice","F","trim","str","$b63e377f8a561b77$var$bind","$b63e377f8a561b77$var$pluck","$b63e377f8a561b77$var$map","$b63e377f8a561b77$var$isList","$b63e377f8a561b77$var$isFunction","$b63e377f8a561b77$var$isObject","pluck","isList","isFunction","$9a27346c17ebc997$var$Global","$9a27346c17ebc997$var$globalStorage","$9a27346c17ebc997$var$each","globalStorage","$aa4a0f0382525b09$var$Global","unfixedKey","$aa4a0f0382525b09$var$disable","fixedKey","$aa4a0f0382525b09$var$fixKey","$aa4a0f0382525b09$var$_withStorageEl","storageEl","$aa4a0f0382525b09$var$storageName","getAttribute","XMLDocument","documentElement","attr","removeAttribute","$aa4a0f0382525b09$var$doc","addBehavior","storageOwner","storageContainer","ActiveXObject","close","w","storeFunction","$aa4a0f0382525b09$var$_makeIEStorageElFunction","$aa4a0f0382525b09$var$forbiddenCharsRegex","RegExp","$ca53a254bb96ef40$var$Global","$ca53a254bb96ef40$var$trim","$ca53a254bb96ef40$var$_has","regexpStr","escape","$ca53a254bb96ef40$var$doc","cookie","$ca53a254bb96ef40$var$each","$ca53a254bb96ef40$var$remove","cookies","kvp","$46abab686a422357$var$Global","$46abab686a422357$var$sessionStorage","sessionStorage","$46abab686a422357$var$read","$d3df9a3b32b1c1df$var$memoryStorage","parcelRequire","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","this_value","quote","lastIndex","holder","partial","mind","toJSON","isFinite","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","replacer","space","parse","reviver","walk","eval","$jgD1p","$b56da5de5b72d494$var$slice","$b56da5de5b72d494$var$pluck","$b56da5de5b72d494$var$each","$b56da5de5b72d494$var$bind","$b56da5de5b72d494$var$create","$b56da5de5b72d494$var$isList","$b56da5de5b72d494$var$isFunction","$b56da5de5b72d494$var$isObject","$b56da5de5b72d494$exports","createStore","$b56da5de5b72d494$var$createStore","$b56da5de5b72d494$var$storeAPI","optionalDefaultValue","storage","_namespacePrefix","_deserialize","_serialize","namespacedKey","_namespaceRegexp","hasNamespace","addPlugin","plugin","_addPlugin","plugins","$b56da5de5b72d494$var$_warn","_console","storages","namespacePrefix","namespaceRegexp","_privateStoreProps","_testStorage","testStr","ok","_assignPluginFnProp","pluginFnProp","propName","oldFn","super_fn","arg","newFnArgs","strVal","defaultVal","_addStorage","plugin1","seenPlugin","pluginProperties","addStorage","$f590d80a5de1f4a7$exports","$1b5031d44df7baeb$var$plugins","$1b5031d44df7baeb$exports","$3d149cbfd3136500$export$6b7b6cff4ccb438b","muteBackgroundMusic","muteAll","$3d149cbfd3136500$var$_origPreferences","$3d149cbfd3136500$export$de31a87075fdbfcc","$3d149cbfd3136500$export$f1786e2fa4419c16","$parcel$interopDefault","$3d149cbfd3136500$export$add4fa36ca2fc569","$9d936a2aecb96285$export$2e2bcd8739ae039","ShowDevTool","SoundVolume","Seed","gridWidth","gridHeight","gridPadding","maxHealth","healthBarWidthPixels","bulletSpeedPixelsPerSecond","bulletRadius","baseTowerFireRateMs","enemy","crab","health","damage","turtle","$73991847afc42666$exports","import","$2d79280c69f571b0$exports","$e9408ce807de14d6$exports","$6144180d050a7b4e$exports","$b6db5538437aa8f6$exports","$7c4c300842bd4cf2$export$e9a269813a6315a4","Sword","Sand","SandCastle","BaseTower","Clank","$1b9c19121388f259$export$ef2184bd89960b14","sandSprite","$1536b058750c3eeb$export$eefe978c73a9a6","configValues","takeDamage","$1536b058750c3eeb$export$1a91c501cca01afe","$202a856f300cb394$export$6d3bb735c0cfe084","maxHp","currentHp","collidesWith","onPostCollision","sandcastle","healthBar","pixelsPerHp","$de8be84271b58ead$export$be9b8cc71a71c056","possibleSpawnTiles","spawnEnemy","gridX","gridY","enemySpawnTile","spawnEnemyAtRandomTile","randomYIndex","$383a203830abe9d2$export$eba177f38926edac","towerSprite","_currentFireTimer","updateMs","fire","bullet","$26db8c8762619bb5$export$d97afb273a2ed2b9","_highlightedTile","_grid","onPointerMove","onConfirm","_highlight","maybeTile","tower","$84ab826914df134a$export$ca664994d1d54bff","sandCastles","enemyGenerator","towerPlacer","Crab","Turtle","classNames","classes","argType","inner","$60313e3b9e75c852$exports","define","amd","$613a632b39062363$export$a62869ddf53aa3e3","setSoundSpecificVolume","unmuteBackgroundMusic","unmuteAll","snd","_updateMuteAllButton","_updateMusicButton","className","__WEBPACK_EXTERNAL_MODULE_excalibur__","require","e1","t2","e2","n2","PickerSystem","maybeCollider","maybeGraphics","BladeApi","controller","controller_","disabled","viewProps","TpEvent","TpChangeEvent","presetKey","TpUpdateEvent","TpFoldEvent","expanded","isEmpty","deepEqualsArray","a1","a2","CREATE_MESSAGE_MAP","alreadydisposed","invalidparams","nomatchingcontroller","nomatchingview","params","notbindable","propertynotfound","shouldneverhappen","TpError","stack","BindingTarget","opt_id","obj_","key_","presetKey_","writeProperty","valueObj","isBindable","notBindable","propertyNotFound","ButtonApi","title","valueController","bh","Emitter","observers_","PREFIX","ClassName","viewName","opt_elementName","opt_modifier","extractValue","rawValue","bindValue","applyValue","h1","h2","bindValueMap","valueMap","valueToClassName","classList","bindValueToTextContent","className$q","ButtonView","doc","bindClassModifiers","buttonElem","bindDisabled","titleElem","ButtonController","onClick_","sender","BoundValue","initialValue","constraint_","constraint","equals_","v1","v2","rawValue_","setRawValue","forceEmit","constrainedValue","constrain","PrimitiveValue","value_","createValue","ValueMap","valMap_","core","createCore","createParamsParserBuilder","optional","succeeded","createParamsParserBuilders","custom","boolean","function","constant","keyToParserMap","tmp","parser","itemParser","parseItem","ParamsParsers","required","parseParams","className$p","POS_TO_CLASS_NAME_MAP","veryfirst","first","verylast","BladeController","parent_","blade","handleDispose","SVG_NS","forceReflow","offsetHeight","supportsTouch","ontouchstart","getWindowDocument","ICON_ID_TO_INNER_HTML_MAP","dropdown","p2dpad","createSvgIconElement","iconId","createElementNS","innerHTML","insertElementAt","insertBefore","removeChildElements","findNextTarget","relatedTarget","explicitOriginalTarget","className$o","LabelView","labelElem","childNodes","frag","createDocumentFragment","createTextNode","lineNode","labelElement","valueElem","valueElement","LabelController","ButtonBladePlugin","accept","fromObject","api","ValueBladeController","createBlade","positions","Foldable","coreObj","completed","expandedHeight","shouldFixHeight","temporaryExpanded","styleExpanded","styleHeight","exHeight","bindExpandedClass","expandedClassName","applyHeight","foldable","bindFoldable","folder","containerElement","transition","propertyName","RackLikeApi","rackApi","rackApi_","NestedOrderedSet","extract","items_","cache_","onSubListAdd_","onSubListRemove_","extract_","allItems","opt_index","shouldNeverHappen","subList","InputBindingApi","onBindingChange_","emitter_","binding","refresh","InputBindingController","MonitorBindingApi","onBindingUpdate_","MonitorBindingController","ticker","findSubBladeApiSet","RackApi","apiSet_","getApiByController","apiSet","createBindingTarget","pool","onRackAdd_","onRackRemove_","onRackInputChange_","onRackMonitorUpdate_","pool_","rack","setUpApi_","addInput","opt_params","ownerDocument","createInput","addMonitor","createMonitor","addFolder","addBlade","addButton","addSeparator","addTab","gapi","createBladeApi","bladeController","isRoot","FolderApi","rackController","RackLikeController","PlainView","findSubRack","RackController","findSubBladeControllerSet","bcSet_","BladeRack","onBladePositionsChange_","onSetAdd_","onSetRemove_","onChildDispose_","onChildPositionsChange_","onChildInputChange_","onChildMonitorUpdate_","onChildValueChange_","onChildViewPropsChange_","onDescendantLayout_","onDescendantInputChange_","onDescendantMonitorUpdate_","blade_","controllerClass","updatePositions_","visibleItems","firstVisibleItem","lastVisibleItem","_ev","bcs","bladeContainerClassName","FolderView","className_","foldable_","titleElement","markElem","containerElem","FolderController","rc","onTitleClick_","FolderBladePlugin","LabeledValueController","SeparatorApi","className$n","SeparatorView","hrElem","SeparatorController","SeparatorBladePlugin","className$m","valueToModifier","modifier","ViewProps","opt_initialValue","disposed","bindTabIndex","tabIndex","className$l","TabItemView","selected","TabItemController","TabPageController","onItemClick_","ic_","itemProps","cc_","itemController","contentController","TabPageApi","contentRackApi","TabApi","onPageAdd_","onPageRemove_","pageApiMap_","pageSet","setUpPageApi_","pages","addPage","removePage","className$k","TabView","empty","itemsElem","itemsElement","contentsElem","contentsElement","TabController","cr","onPageSelectedChange_","pageSet_","empty_","applyPages_","keepSelection_","firstSelIndex","TabBladePlugin","ManualTicker","IntervalTicker","disabled_","timerId_","onTick_","doc_","interval_","setTimer_","inactive","clearTimer_","win","defaultView","clearInterval","CompositeConstraint","findConstraint","constraintClass","tmpResult","sc","ListConstraint","RangeConstraint","maxValue","minValue","StepConstraint","className$j","ListView","onValueChange_","props_","selectElem","optionElem","selectElement","update_","ListController","onSelectChange_","optElem","currentTarget","selectedOptions","itemIndex","className$i","PopupView","shows","PopupController","className$h","TextView","onChange_","inputElem","inputElement","formatter","TextController","onInputChange_","parser_","parsedValue","boolFromUnknown","BooleanFormatter","NumberLiteralNode","evaluate","BINARY_OPERATION_MAP","BinaryOperationNode","operator","op","UNARY_OPERATION_MAP","UnaryOperationNode","expr","expression","combineReader","parsers","readWhitespace","substr","readDecimalDigits","readExponentPart","si","ds","sds","readDecimalIntegerLiteral","ch","nzd","readDecimalLiteral","dil","dds","readNonDecimalIntegerLiteral","prefix","bds","ods","hds","readNumericLiteral","parsePrimaryExpression","evaluable","parseExpression","cl","readBinaryOperator","ops","startsWith","parseBinaryOperationExpression","exprParser","firstExpr","nextExpr","parseUnaryExpression","parseNumber","numberFromUnknown","pv","numberToString","createNumberFormatter","digits","innerFormatter","formatPercentage","stringFromUnknown","formatString","fillBuffer","bufferSize","initializeBuffer","createTrimmedBuffer","connectValues","secondary","forward","backward","changing","preventFeedback","getStepForKey","baseStep","altKey","shiftKey","upKey","downKey","getVerticalStepKeys","getHorizontalStepKeys","isArrowKey","computeOffset$1","getBoundingClientRect","scrollX","scrollY","PointerHandler","lastTouch_","onDocumentMouseMove_","onDocumentMouseUp_","onMouseDown_","onTouchEnd_","onTouchMove_","onTouchStart_","elem_","computePosition_","targetTouches","mapRange","start1","end1","start2","end2","getDecimalDigits","constrainRange","loopRange","className$g","NumberTextView","arrayPosition","onDraggingChange_","dragging_","dragging","knobElem","knobElement","guideElem","bodyElem","guideBodyElem_","headElem","guideHeadElem_","tooltipElem","tooltipElem_","aox","adx","setAttributeNS","NumberTextController","originRawValue_","onInputKeyDown_","onInputKeyUp_","onPointerDown_","onPointerMove_","onPointerUp_","baseStep_","ph","computeDraggingValue_","className$f","SliderView","trackElem","trackElement","SliderController","onKeyDown_","onKeyUp_","onPointerDownOrMove_","ptHandler_","handlePointerEvent_","className$e","SliderTextView","sliderElem","sliderView_","sliderView","textElem","textView_","textView","SliderTextController","sliderC_","sliderProps","textC_","textProps","sliderController","textController","writePrimitive","parseListOptions","parsePickerLayout","parsePointDimensionParams","normalizeListOptions","createListConstraint","findListItems","getSuitableDecimalDigits","getBaseStep","getSuitableDraggingScale","log10","className$d","CheckboxView","wrapperElem","checked","CheckboxController","BooleanInputPlugin","reader","_args","lc","writer","className$c","ColorView","swatchElem","swatchElement","textElement","pickerLayout","pickerElem","pickerElement","hsvToRgb","hp","sp","vp","rp","gp","removeAlphaComponent","comps","appendAlphaComponent","MODE_CONVERTER_MAP","hsl","hsv","sd","rgb","lp","cmax","cmin","CONSTRAINT_MAP","isRgbColorComponent","mode_","comps_","toRgbaObject","isRgbColorObject","comps1","comps2","opt_mode","fromMode","toMode","rgbComps","className$b","ColorPickerView","alphaViews_","hsvElem","svElem","svPaletteView_","svPaletteView","hElem","hPaletteView_","hPaletteView","rgbElem","alphaViews","palette","aElem","apElem","atElem","allFocusableElements","elems","modeSelectElement","textViews","parseColorInputParams","picker","getBaseStepForColor","forAlpha","parseCssNumberOrPercentage","ANGLE_TO_DEG_MAP","deg","grad","rad","turn","parseCssNumberOrAngle","NOTATION_TO_PARSER_MAP","mRgb","mRrggbb","getColorNotation","notation","subparser","CompositeColorParser","hasAlphaComponent","colorFromString","cv","black","zerofill","comp","colorToHexRgbString","colorToHexRgbaString","rgbaComps","colorToFunctionalRgbString","colorToFunctionalRgbaString","aFormatter","rgbFormatter","NOTATION_TO_STRINGIFIER_MAP","formatters","getColorStringifier","className$a","APaletteView","barElem","colorElem","colorElem_","markerElem","markerElem_","previewElem","previewElem_","leftColor","rightColor","gradientComps","background","APaletteController","className$9","ColorTextView","modeElem","modeElem_","modeMarkerElem","textsElem","textsElem_","textViews_","applyTextViews_","colorMode","compElem","FORMATTER","MODE_TO_CONSTRAINT_MAP","createComponentController","draggingScale","ColorTextController","onModeSelectChange_","ccs_","createComponentControllers_","ccs","cs","pickedMode","className$8","HPaletteView","HPaletteController","hue","className$7","SvPaletteView","canvasElem","hsvComps","imgData","iy","ix","SvPaletteController","saturation","dv","ColorPickerController","hPaletteC_","svPaletteC_","alphaIcs_","supportsAlpha","className$6","ColorSwatchView","swatchElem_","ColorSwatchController","ColorController","onButtonBlur_","onButtonClick_","onPopupChildBlur_","onPopupChildKeydown_","swatchC_","popC_","pickerC","pickerC_","nextTarget","colorFromObject","isColorObject","colorToRgbNumber","colorToRgbaNumber","colorFromRgbNumber","colorFromRgbaNumber","writeRgbaColorObject","writeRgbColorObject","shouldSupportAlpha$1","inputParams","createFormatter$1","NumberColorInputPlugin","colorToNumber","ObjectColorInputPlugin","createColorObjectWriter","isRgbaColorObject","StringColorInputPlugin","stringifier","PointNdConstraint","asm_","assembly","toComponents","fromComponents","className$5","PointNdTextView","axisElem","PointNdTextController","acs_","ac","createConstraint$4","estimateSuitableRange","NumberInputPlugin","Point2d","Point2dAssembly","className$4","Point2dView","className$3","Point2dPickerView","onFoldableChange_","invertsY_","invertsY","maxValue_","layout","padElem","padElement","svgElem","svgElem_","xAxisElem","yAxisElem","lineElem","lineElem_","px","py","ipy","computeOffset","baseSteps","Point2dPickerController","onPadKeyDown_","onPadKeyUp_","baseSteps_","Point2dController","onPadButtonBlur_","onPadButtonClick_","padC","point2dFromUnknown","writePoint2d","createDimensionConstraint$2","getSuitableMaxDimensionValue","getSuitableMaxValue","xc","yc","xr","yr","createAxis$2","shouldInvertY","yParams","inverted","Point2dInputPlugin","createConstraint$3","Point3d","Point3dAssembly","point3dFromUnknown","writePoint3d","createDimensionConstraint$1","createAxis$1","Point3dInputPlugin","createConstraint$2","Point4d","Point4dAssembly","point4dFromUnknown","writePoint4d","createDimensionConstraint","Point4dInputPlugin","createConstraint$1","createAxis","StringInputPlugin","Constants","defaultInterval","defaultLineCount","className$2","MultiLogView","onValueUpdate_","formatter_","textareaElem","lineCount","readOnly","textareaElem_","shouldScroll","scrollTop","scrollHeight","MultiLogController","className$1","SingleLogView","lastValue","SingleLogController","BooleanMonitorPlugin","GraphCursor","index_","GraphLogView","onCursorChange_","minValue_","cursor_","graphElement","GraphLogController","onGraphMouseMove_","onGraphMouseLeave_","onGraphPointerDown_","onGraphPointerMove_","onGraphPointerUp_","createFormatter","shouldShowGraph","NumberMonitorPlugin","defaultBufferSize","StringMonitorPlugin","multiline","InputBinding","targetValue","write_","MonitorBinding","reader_","newValue","newBuffer","createTicker","PluginPool","pluginsMap_","blades","inputs","monitors","getAll","valueArgs","bindingArgs","ListApi","SliderApi","TextApi","ListBladePlugin","ic","RootApi","importPreset","preset","ibc","exportPreset","mbc","RootController","SliderBladePlugin","TextBladePlugin","embedStyle","css","querySelector","styleElem","tpStyle","VERSION","prerelease","coreComps","major","minor","patch","Pane","opt_config","containerElem_","container","usesDefaultWrapper_","setUpDefaultPlugins_","alreadyDisposed","parentElem","registerPlugin","bundle","embedPluginStyle_","DevTool","o3","t105","e52","n23","pointerPos","highlightedEntities","selectedEntity","selectedEntityId","pane","_buildMain","tabs","selectedEntityTab","screenTab","cameraTab","clockTab","timerTab","physicsTab","debugTab","_installPickerSystemIfNeeded","selectedEntityFolder","_buildScreenTab","_buildCameraTab","_buildClockTab","_buildTimersTab","_buildPhysicsTab","_buildDebugSettingsTab","addListeners","selectEntityById","_buildEntityUI","transformComponent","_buildTransformUI","motionComponent","_buildMotionUI","_buildParticleEmitterUI","_buildGraphicsUI","bodyComponent","_buildColliderUI","devtool","pointerPosInput","entityIds","pickerSystem","currentResolution","currentViewport","resolutionText","viewportText","screenFolder","numberEntitiesBlade","currentSceneName","n24","particlesFolder","allGraphics","currentGfx","namedGfx","gfxIndex","anonIndex","e55","rot","globalTx","globalRot","shouldSimulate","cameraFolder","usingTestClock","stepMs","stopGameButton","startGameButton","_timersFolder","solverInput","useArcadePhysics","useRealisticPhysics","option","$ad2bcec7a0192558$export$985739bfa5723e08","showDevTool","startLevel","resource","setupDevTool","devTool","$d82f9d57af76c42b$exports","configPage","$ad2bcec7a0192558$export$119d2a93e2780362","Input","Semicolon"],"version":3,"file":"index.bd463fc0.js.map"}