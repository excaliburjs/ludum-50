{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/store/storages/localStorage.js","node_modules/store/src/util.js","node_modules/store/storages/oldFF-globalStorage.js","node_modules/store/storages/oldIE-userDataStorage.js","node_modules/store/storages/cookieStorage.js","node_modules/store/storages/sessionStorage.js","node_modules/store/storages/memoryStorage.js","node_modules/store/plugins/json2.js","node_modules/store/plugins/lib/json2.js","node_modules/@parcel/runtime-js/lib/runtime-7701ff95490eb075.js","lib/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","lib/excalibur/build/dist/node_modules/core-js/es/array/sort.js","lib/excalibur/build/dist/node_modules/core-js/es/object/keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/a-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/an-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-includes.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-method-is-strict.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-slice-simple.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-sort.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof-raw.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof.js","lib/excalibur/build/dist/node_modules/core-js/internals/copy-constructor-properties.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-non-enumerable-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/descriptors.js","lib/excalibur/build/dist/node_modules/core-js/internals/document-create-element.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-ff-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-is-ie-or-edge.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-user-agent.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-v8-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-webkit-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/entry-unbind.js","lib/excalibur/build/dist/node_modules/core-js/internals/enum-bug-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/export.js","lib/excalibur/build/dist/node_modules/core-js/internals/fails.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-bind-native.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-call.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-name.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-uncurry-this.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-built-in.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-method.js","lib/excalibur/build/dist/node_modules/core-js/internals/global.js","lib/excalibur/build/dist/node_modules/core-js/internals/has-own-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/hidden-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/ie8-dom-define.js","lib/excalibur/build/dist/node_modules/core-js/internals/indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/inspect-source.js","lib/excalibur/build/dist/node_modules/core-js/internals/internal-state.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-forced.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-pure.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/length-of-array-like.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-weak-map.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-define-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-names.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-symbols.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-is-prototype-of.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys-internal.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-property-is-enumerable.js","lib/excalibur/build/dist/node_modules/core-js/internals/ordinary-to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/own-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/path.js","lib/excalibur/build/dist/node_modules/core-js/internals/redefine.js","lib/excalibur/build/dist/node_modules/core-js/internals/require-object-coercible.js","lib/excalibur/build/dist/node_modules/core-js/internals/set-global.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-store.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-absolute-index.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-integer-or-infinity.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-length.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-property-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string-tag-support.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/try-to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/use-symbol-as-uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/v8-prototype-define-bug.js","lib/excalibur/build/dist/node_modules/core-js/internals/well-known-symbol.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.array.sort.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.object.keys.js","lib/excalibur/build/dist/webpack:/ex/Loader.css","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/api.js","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/sourceMaps.js","lib/excalibur/build/dist/webpack:/ex/webpack/bootstrap","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/global","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","lib/excalibur/build/dist/webpack:/ex/Flags.ts","lib/excalibur/build/dist/webpack:/ex/Util/Log.ts","lib/excalibur/build/dist/webpack:/ex/Polyfill.ts","lib/excalibur/build/dist/webpack:/ex/Id.ts","lib/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Side.ts","lib/excalibur/build/dist/webpack:/ex/Color.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","lib/excalibur/build/dist/webpack:/ex/Math/Random.ts","lib/excalibur/build/dist/webpack:/ex/Math/util.ts","lib/excalibur/build/dist/webpack:/ex/Util/Util.ts","lib/excalibur/build/dist/webpack:/ex/Math/matrix.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Filtering.ts","lib/excalibur/build/dist/webpack:/ex/Events.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","lib/excalibur/build/dist/webpack:/ex/Util/Watch.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","lib/excalibur/build/dist/webpack:/ex/EventDispatcher.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteEffects.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Texture.ts","lib/excalibur/build/dist/webpack:/ex/Configurable.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-source.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-target.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-adapter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-layout.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/quad-index-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","lib/excalibur/build/dist/webpack:/ex/Screen.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","lib/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","lib/excalibur/build/dist/webpack:/ex/Class.ts","lib/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","lib/excalibur/build/dist/webpack:/ex/Loader.ts","lib/excalibur/build/dist/webpack:/ex/Loader.logo.png","lib/excalibur/build/dist/webpack:/ex/Util/Detector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Physics.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","lib/excalibur/build/dist/webpack:/ex/Util/Observable.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","lib/excalibur/build/dist/webpack:/ex/Math/projection.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","lib/excalibur/build/dist/webpack:/ex/Math/ray.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Math/line.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","lib/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","lib/excalibur/build/dist/webpack:/ex/Actions/RotationType.ts","lib/excalibur/build/dist/webpack:/ex/Util/CullingBox.ts","lib/excalibur/build/dist/webpack:/ex/Traits/OffscreenCulling.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerComponent.ts","lib/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","lib/excalibur/build/dist/webpack:/ex/Actor.ts","lib/excalibur/build/dist/webpack:/ex/ScreenElement.ts","lib/excalibur/build/dist/webpack:/ex/Timer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/DebugGraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Camera.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/TileMap.ts","lib/excalibur/build/dist/webpack:/ex/Util/Actors.ts","lib/excalibur/build/dist/webpack:/ex/Trigger.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Util.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","lib/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/Solver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Particles.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawingSystem.ts","lib/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerSystem.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsSystem.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntityComponent.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntitySystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/OffscreenSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerScope.ts","lib/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","lib/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelDeltaMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/NativePointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerType.ts","lib/excalibur/build/dist/webpack:/ex/Scene.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ScreenShader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/color-blind-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","lib/excalibur/build/dist/webpack:/ex/Debug/Debug.ts","lib/excalibur/build/dist/webpack:/ex/Util/Browser.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","lib/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerAbstraction.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEventReceiver.ts","lib/excalibur/build/dist/webpack:/ex/Util/Fps.ts","lib/excalibur/build/dist/webpack:/ex/Util/Clock.ts","lib/excalibur/build/dist/webpack:/ex/Engine.ts","lib/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","lib/excalibur/build/dist/webpack:/ex/Label.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricMap.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","lib/excalibur/build/dist/webpack:/ex/Util/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Util/SortedList.ts","lib/excalibur/build/dist/webpack:/ex/Util/Pool.ts","lib/excalibur/build/dist/webpack:/ex/Promises.ts","lib/excalibur/build/dist/webpack:/ex/index.ts","node_modules/store/src/store-engine.js","node_modules/store/storages/all.js","node_modules/store/dist/store.legacy.js","src/preferences.ts","node_modules/@parcel/runtime-js/lib/runtime-77d541a110e6f92a.js","node_modules/@parcel/runtime-js/lib/runtime-03ac81f06ee2e936.js","src/resources.ts","src/config.ts","src/level.ts","node_modules/classnames/index.js","src/sound-manager.ts","src/main.ts"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","var util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'localStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nfunction localStorage() {\n\treturn Global.localStorage\n}\n\nfunction read(key) {\n\treturn localStorage().getItem(key)\n}\n\nfunction write(key, data) {\n\treturn localStorage().setItem(key, data)\n}\n\nfunction each(fn) {\n\tfor (var i = localStorage().length - 1; i >= 0; i--) {\n\t\tvar key = localStorage().key(i)\n\t\tfn(read(key), key)\n\t}\n}\n\nfunction remove(key) {\n\treturn localStorage().removeItem(key)\n}\n\nfunction clearAll() {\n\treturn localStorage().clear()\n}\n","var assign = make_assign()\nvar create = make_create()\nvar trim = make_trim()\nvar Global = (typeof window !== 'undefined' ? window : global)\n\nmodule.exports = {\n\tassign: assign,\n\tcreate: create,\n\ttrim: trim,\n\tbind: bind,\n\tslice: slice,\n\teach: each,\n\tmap: map,\n\tpluck: pluck,\n\tisList: isList,\n\tisFunction: isFunction,\n\tisObject: isObject,\n\tGlobal: Global\n}\n\nfunction make_assign() {\n\tif (Object.assign) {\n\t\treturn Object.assign\n\t} else {\n\t\treturn function shimAssign(obj, props1, props2, etc) {\n\t\t\tfor (var i = 1; i < arguments.length; i++) {\n\t\t\t\teach(Object(arguments[i]), function(val, key) {\n\t\t\t\t\tobj[key] = val\n\t\t\t\t})\n\t\t\t}\t\t\t\n\t\t\treturn obj\n\t\t}\n\t}\n}\n\nfunction make_create() {\n\tif (Object.create) {\n\t\treturn function create(obj, assignProps1, assignProps2, etc) {\n\t\t\tvar assignArgsList = slice(arguments, 1)\n\t\t\treturn assign.apply(this, [Object.create(obj)].concat(assignArgsList))\n\t\t}\n\t} else {\n\t\tfunction F() {} // eslint-disable-line no-inner-declarations\n\t\treturn function create(obj, assignProps1, assignProps2, etc) {\n\t\t\tvar assignArgsList = slice(arguments, 1)\n\t\t\tF.prototype = obj\n\t\t\treturn assign.apply(this, [new F()].concat(assignArgsList))\n\t\t}\n\t}\n}\n\nfunction make_trim() {\n\tif (String.prototype.trim) {\n\t\treturn function trim(str) {\n\t\t\treturn String.prototype.trim.call(str)\n\t\t}\n\t} else {\n\t\treturn function trim(str) {\n\t\t\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n\t\t}\n\t}\n}\n\nfunction bind(obj, fn) {\n\treturn function() {\n\t\treturn fn.apply(obj, Array.prototype.slice.call(arguments, 0))\n\t}\n}\n\nfunction slice(arr, index) {\n\treturn Array.prototype.slice.call(arr, index || 0)\n}\n\nfunction each(obj, fn) {\n\tpluck(obj, function(val, key) {\n\t\tfn(val, key)\n\t\treturn false\n\t})\n}\n\nfunction map(obj, fn) {\n\tvar res = (isList(obj) ? [] : {})\n\tpluck(obj, function(v, k) {\n\t\tres[k] = fn(v, k)\n\t\treturn false\n\t})\n\treturn res\n}\n\nfunction pluck(obj, fn) {\n\tif (isList(obj)) {\n\t\tfor (var i=0; i<obj.length; i++) {\n\t\t\tif (fn(obj[i], i)) {\n\t\t\t\treturn obj[i]\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var key in obj) {\n\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\tif (fn(obj[key], key)) {\n\t\t\t\t\treturn obj[key]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction isList(val) {\n\treturn (val != null && typeof val != 'function' && typeof val.length == 'number')\n}\n\nfunction isFunction(val) {\n\treturn val && {}.toString.call(val) === '[object Function]'\n}\n\nfunction isObject(val) {\n\treturn val && {}.toString.call(val) === '[object Object]'\n}\n","// oldFF-globalStorage provides storage for Firefox\n// versions 6 and 7, where no localStorage, etc\n// is available.\n\nvar util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'oldFF-globalStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar globalStorage = Global.globalStorage\n\nfunction read(key) {\n\treturn globalStorage[key]\n}\n\nfunction write(key, data) {\n\tglobalStorage[key] = data\n}\n\nfunction each(fn) {\n\tfor (var i = globalStorage.length - 1; i >= 0; i--) {\n\t\tvar key = globalStorage.key(i)\n\t\tfn(globalStorage[key], key)\n\t}\n}\n\nfunction remove(key) {\n\treturn globalStorage.removeItem(key)\n}\n\nfunction clearAll() {\n\teach(function(key, _) {\n\t\tdelete globalStorage[key]\n\t})\n}\n","// oldIE-userDataStorage provides storage for Internet Explorer\n// versions 6 and 7, where no localStorage, sessionStorage, etc\n// is available.\n\nvar util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'oldIE-userDataStorage',\n\twrite: write,\n\tread: read,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar storageName = 'storejs'\nvar doc = Global.document\nvar _withStorageEl = _makeIEStorageElFunction()\nvar disable = (Global.navigator ? Global.navigator.userAgent : '').match(/ (MSIE 8|MSIE 9|MSIE 10)\\./) // MSIE 9.x, MSIE 10.x\n\nfunction write(unfixedKey, data) {\n\tif (disable) { return }\n\tvar fixedKey = fixKey(unfixedKey)\n\t_withStorageEl(function(storageEl) {\n\t\tstorageEl.setAttribute(fixedKey, data)\n\t\tstorageEl.save(storageName)\n\t})\n}\n\nfunction read(unfixedKey) {\n\tif (disable) { return }\n\tvar fixedKey = fixKey(unfixedKey)\n\tvar res = null\n\t_withStorageEl(function(storageEl) {\n\t\tres = storageEl.getAttribute(fixedKey)\n\t})\n\treturn res\n}\n\nfunction each(callback) {\n\t_withStorageEl(function(storageEl) {\n\t\tvar attributes = storageEl.XMLDocument.documentElement.attributes\n\t\tfor (var i=attributes.length-1; i>=0; i--) {\n\t\t\tvar attr = attributes[i]\n\t\t\tcallback(storageEl.getAttribute(attr.name), attr.name)\n\t\t}\n\t})\n}\n\nfunction remove(unfixedKey) {\n\tvar fixedKey = fixKey(unfixedKey)\n\t_withStorageEl(function(storageEl) {\n\t\tstorageEl.removeAttribute(fixedKey)\n\t\tstorageEl.save(storageName)\n\t})\n}\n\nfunction clearAll() {\n\t_withStorageEl(function(storageEl) {\n\t\tvar attributes = storageEl.XMLDocument.documentElement.attributes\n\t\tstorageEl.load(storageName)\n\t\tfor (var i=attributes.length-1; i>=0; i--) {\n\t\t\tstorageEl.removeAttribute(attributes[i].name)\n\t\t}\n\t\tstorageEl.save(storageName)\n\t})\n}\n\n// Helpers\n//////////\n\n// In IE7, keys cannot start with a digit or contain certain chars.\n// See https://github.com/marcuswestin/store.js/issues/40\n// See https://github.com/marcuswestin/store.js/issues/83\nvar forbiddenCharsRegex = new RegExp(\"[!\\\"#$%&'()*+,/\\\\\\\\:;<=>?@[\\\\]^`{|}~]\", \"g\")\nfunction fixKey(key) {\n\treturn key.replace(/^\\d/, '___$&').replace(forbiddenCharsRegex, '___')\n}\n\nfunction _makeIEStorageElFunction() {\n\tif (!doc || !doc.documentElement || !doc.documentElement.addBehavior) {\n\t\treturn null\n\t}\n\tvar scriptTag = 'script',\n\t\tstorageOwner,\n\t\tstorageContainer,\n\t\tstorageEl\n\n\t// Since #userData storage applies only to specific paths, we need to\n\t// somehow link our data to a specific path.  We choose /favicon.ico\n\t// as a pretty safe option, since all browsers already make a request to\n\t// this URL anyway and being a 404 will not hurt us here.  We wrap an\n\t// iframe pointing to the favicon in an ActiveXObject(htmlfile) object\n\t// (see: http://msdn.microsoft.com/en-us/library/aa752574(v=VS.85).aspx)\n\t// since the iframe access rules appear to allow direct access and\n\t// manipulation of the document element, even for a 404 page.  This\n\t// document can be used instead of the current document (which would\n\t// have been limited to the current path) to perform #userData storage.\n\ttry {\n\t\t/* global ActiveXObject */\n\t\tstorageContainer = new ActiveXObject('htmlfile')\n\t\tstorageContainer.open()\n\t\tstorageContainer.write('<'+scriptTag+'>document.w=window</'+scriptTag+'><iframe src=\"/favicon.ico\"></iframe>')\n\t\tstorageContainer.close()\n\t\tstorageOwner = storageContainer.w.frames[0].document\n\t\tstorageEl = storageOwner.createElement('div')\n\t} catch(e) {\n\t\t// somehow ActiveXObject instantiation failed (perhaps some special\n\t\t// security settings or otherwse), fall back to per-path storage\n\t\tstorageEl = doc.createElement('div')\n\t\tstorageOwner = doc.body\n\t}\n\n\treturn function(storeFunction) {\n\t\tvar args = [].slice.call(arguments, 0)\n\t\targs.unshift(storageEl)\n\t\t// See http://msdn.microsoft.com/en-us/library/ms531081(v=VS.85).aspx\n\t\t// and http://msdn.microsoft.com/en-us/library/ms531424(v=VS.85).aspx\n\t\tstorageOwner.appendChild(storageEl)\n\t\tstorageEl.addBehavior('#default#userData')\n\t\tstorageEl.load(storageName)\n\t\tstoreFunction.apply(this, args)\n\t\tstorageOwner.removeChild(storageEl)\n\t\treturn\n\t}\n}\n","// cookieStorage is useful Safari private browser mode, where localStorage\n// doesn't work but cookies do. This implementation is adopted from\n// https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage\n\nvar util = require('../src/util')\nvar Global = util.Global\nvar trim = util.trim\n\nmodule.exports = {\n\tname: 'cookieStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar doc = Global.document\n\nfunction read(key) {\n\tif (!key || !_has(key)) { return null }\n\tvar regexpStr = \"(?:^|.*;\\\\s*)\" +\n\t\tescape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") +\n\t\t\"\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*\"\n\treturn unescape(doc.cookie.replace(new RegExp(regexpStr), \"$1\"))\n}\n\nfunction each(callback) {\n\tvar cookies = doc.cookie.split(/; ?/g)\n\tfor (var i = cookies.length - 1; i >= 0; i--) {\n\t\tif (!trim(cookies[i])) {\n\t\t\tcontinue\n\t\t}\n\t\tvar kvp = cookies[i].split('=')\n\t\tvar key = unescape(kvp[0])\n\t\tvar val = unescape(kvp[1])\n\t\tcallback(val, key)\n\t}\n}\n\nfunction write(key, data) {\n\tif(!key) { return }\n\tdoc.cookie = escape(key) + \"=\" + escape(data) + \"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/\"\n}\n\nfunction remove(key) {\n\tif (!key || !_has(key)) {\n\t\treturn\n\t}\n\tdoc.cookie = escape(key) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/\"\n}\n\nfunction clearAll() {\n\teach(function(_, key) {\n\t\tremove(key)\n\t})\n}\n\nfunction _has(key) {\n\treturn (new RegExp(\"(?:^|;\\\\s*)\" + escape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\")).test(doc.cookie)\n}\n","var util = require('../src/util')\nvar Global = util.Global\n\nmodule.exports = {\n\tname: 'sessionStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll\n}\n\nfunction sessionStorage() {\n\treturn Global.sessionStorage\n}\n\nfunction read(key) {\n\treturn sessionStorage().getItem(key)\n}\n\nfunction write(key, data) {\n\treturn sessionStorage().setItem(key, data)\n}\n\nfunction each(fn) {\n\tfor (var i = sessionStorage().length - 1; i >= 0; i--) {\n\t\tvar key = sessionStorage().key(i)\n\t\tfn(read(key), key)\n\t}\n}\n\nfunction remove(key) {\n\treturn sessionStorage().removeItem(key)\n}\n\nfunction clearAll() {\n\treturn sessionStorage().clear()\n}\n","// memoryStorage is a useful last fallback to ensure that the store\n// is functions (meaning store.get(), store.set(), etc will all function).\n// However, stored values will not persist when the browser navigates to\n// a new page or reloads the current page.\n\nmodule.exports = {\n\tname: 'memoryStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar memoryStorage = {}\n\nfunction read(key) {\n\treturn memoryStorage[key]\n}\n\nfunction write(key, data) {\n\tmemoryStorage[key] = data\n}\n\nfunction each(callback) {\n\tfor (var key in memoryStorage) {\n\t\tif (memoryStorage.hasOwnProperty(key)) {\n\t\t\tcallback(memoryStorage[key], key)\n\t\t}\n\t}\n}\n\nfunction remove(key) {\n\tdelete memoryStorage[key]\n}\n\nfunction clearAll(key) {\n\tmemoryStorage = {}\n}\n","module.exports = json2Plugin\n\nfunction json2Plugin() {\n\trequire('./lib/json2')\n\treturn {}\n}\n","/* eslint-disable */\n\n//  json2.js\n//  2016-10-28\n//  Public Domain.\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n//  See http://www.JSON.org/js.html\n//  This code should be minified before deployment.\n//  See http://javascript.crockford.com/jsmin.html\n\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n//  NOT CONTROL.\n\n//  This file creates a global JSON object containing two methods: stringify\n//  and parse. This file provides the ES5 JSON capability to ES3 systems.\n//  If a project might run on IE8 or earlier, then this file should be included.\n//  This file does nothing on ES5 systems.\n\n//      JSON.stringify(value, replacer, space)\n//          value       any JavaScript value, usually an object or array.\n//          replacer    an optional parameter that determines how object\n//                      values are stringified for objects. It can be a\n//                      function or an array of strings.\n//          space       an optional parameter that specifies the indentation\n//                      of nested structures. If it is omitted, the text will\n//                      be packed without extra whitespace. If it is a number,\n//                      it will specify the number of spaces to indent at each\n//                      level. If it is a string (such as \"\\t\" or \"&nbsp;\"),\n//                      it contains the characters used to indent at each level.\n//          This method produces a JSON text from a JavaScript value.\n//          When an object value is found, if the object contains a toJSON\n//          method, its toJSON method will be called and the result will be\n//          stringified. A toJSON method does not serialize: it returns the\n//          value represented by the name/value pair that should be serialized,\n//          or undefined if nothing should be serialized. The toJSON method\n//          will be passed the key associated with the value, and this will be\n//          bound to the value.\n\n//          For example, this would serialize Dates as ISO strings.\n\n//              Date.prototype.toJSON = function (key) {\n//                  function f(n) {\n//                      // Format integers to have at least two digits.\n//                      return (n < 10)\n//                          ? \"0\" + n\n//                          : n;\n//                  }\n//                  return this.getUTCFullYear()   + \"-\" +\n//                       f(this.getUTCMonth() + 1) + \"-\" +\n//                       f(this.getUTCDate())      + \"T\" +\n//                       f(this.getUTCHours())     + \":\" +\n//                       f(this.getUTCMinutes())   + \":\" +\n//                       f(this.getUTCSeconds())   + \"Z\";\n//              };\n\n//          You can provide an optional replacer method. It will be passed the\n//          key and value of each member, with this bound to the containing\n//          object. The value that is returned from your method will be\n//          serialized. If your method returns undefined, then the member will\n//          be excluded from the serialization.\n\n//          If the replacer parameter is an array of strings, then it will be\n//          used to select the members to be serialized. It filters the results\n//          such that only members with keys listed in the replacer array are\n//          stringified.\n\n//          Values that do not have JSON representations, such as undefined or\n//          functions, will not be serialized. Such values in objects will be\n//          dropped; in arrays they will be replaced with null. You can use\n//          a replacer function to replace those with JSON values.\n\n//          JSON.stringify(undefined) returns undefined.\n\n//          The optional space parameter produces a stringification of the\n//          value that is filled with line breaks and indentation to make it\n//          easier to read.\n\n//          If the space parameter is a non-empty string, then that string will\n//          be used for indentation. If the space parameter is a number, then\n//          the indentation will be that many spaces.\n\n//          Example:\n\n//          text = JSON.stringify([\"e\", {pluribus: \"unum\"}]);\n//          // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n//          text = JSON.stringify([\"e\", {pluribus: \"unum\"}], null, \"\\t\");\n//          // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n//          text = JSON.stringify([new Date()], function (key, value) {\n//              return this[key] instanceof Date\n//                  ? \"Date(\" + this[key] + \")\"\n//                  : value;\n//          });\n//          // text is '[\"Date(---current time---)\"]'\n\n//      JSON.parse(text, reviver)\n//          This method parses a JSON text to produce an object or array.\n//          It can throw a SyntaxError exception.\n\n//          The optional reviver parameter is a function that can filter and\n//          transform the results. It receives each of the keys and values,\n//          and its return value is used instead of the original value.\n//          If it returns what it received, then the structure is not modified.\n//          If it returns undefined then the member is deleted.\n\n//          Example:\n\n//          // Parse the text. Values that look like ISO date strings will\n//          // be converted to Date objects.\n\n//          myData = JSON.parse(text, function (key, value) {\n//              var a;\n//              if (typeof value === \"string\") {\n//                  a =\n//   /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n//                  if (a) {\n//                      return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n//                          +a[5], +a[6]));\n//                  }\n//              }\n//              return value;\n//          });\n\n//          myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n//              var d;\n//              if (typeof value === \"string\" &&\n//                      value.slice(0, 5) === \"Date(\" &&\n//                      value.slice(-1) === \")\") {\n//                  d = new Date(value.slice(5, -1));\n//                  if (d) {\n//                      return d;\n//                  }\n//              }\n//              return value;\n//          });\n\n//  This is a reference implementation. You are free to copy, modify, or\n//  redistribute.\n\n/*jslint\n    eval, for, this\n*/\n\n/*property\n    JSON, apply, call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n    test, toJSON, toString, valueOf\n*/\n\n\n// Create a JSON object only if one does not already exist. We create the\n// methods in a closure to avoid creating global variables.\n\nif (typeof JSON !== \"object\") {\n    JSON = {};\n}\n\n(function () {\n    \"use strict\";\n\n    var rx_one = /^[\\],:{}\\s]*$/;\n    var rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\n    var rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\n    var rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\n    var rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n    var rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\n    function f(n) {\n        // Format integers to have at least two digits.\n        return n < 10\n            ? \"0\" + n\n            : n;\n    }\n\n    function this_value() {\n        return this.valueOf();\n    }\n\n    if (typeof Date.prototype.toJSON !== \"function\") {\n\n        Date.prototype.toJSON = function () {\n\n            return isFinite(this.valueOf())\n                ? this.getUTCFullYear() + \"-\" +\n                        f(this.getUTCMonth() + 1) + \"-\" +\n                        f(this.getUTCDate()) + \"T\" +\n                        f(this.getUTCHours()) + \":\" +\n                        f(this.getUTCMinutes()) + \":\" +\n                        f(this.getUTCSeconds()) + \"Z\"\n                : null;\n        };\n\n        Boolean.prototype.toJSON = this_value;\n        Number.prototype.toJSON = this_value;\n        String.prototype.toJSON = this_value;\n    }\n\n    var gap;\n    var indent;\n    var meta;\n    var rep;\n\n\n    function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n        rx_escapable.lastIndex = 0;\n        return rx_escapable.test(string)\n            ? \"\\\"\" + string.replace(rx_escapable, function (a) {\n                var c = meta[a];\n                return typeof c === \"string\"\n                    ? c\n                    : \"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n            }) + \"\\\"\"\n            : \"\\\"\" + string + \"\\\"\";\n    }\n\n\n    function str(key, holder) {\n\n// Produce a string from holder[key].\n\n        var i;          // The loop counter.\n        var k;          // The member key.\n        var v;          // The member value.\n        var length;\n        var mind = gap;\n        var partial;\n        var value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n        if (value && typeof value === \"object\" &&\n                typeof value.toJSON === \"function\") {\n            value = value.toJSON(key);\n        }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n        if (typeof rep === \"function\") {\n            value = rep.call(holder, key, value);\n        }\n\n// What happens next depends on the value's type.\n\n        switch (typeof value) {\n        case \"string\":\n            return quote(value);\n\n        case \"number\":\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n            return isFinite(value)\n                ? String(value)\n                : \"null\";\n\n        case \"boolean\":\n        case \"null\":\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce \"null\". The case is included here in\n// the remote chance that this gets fixed someday.\n\n            return String(value);\n\n// If the type is \"object\", we might be dealing with an object or an array or\n// null.\n\n        case \"object\":\n\n// Due to a specification blunder in ECMAScript, typeof null is \"object\",\n// so watch out for that case.\n\n            if (!value) {\n                return \"null\";\n            }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n            gap += indent;\n            partial = [];\n\n// Is the value an array?\n\n            if (Object.prototype.toString.apply(value) === \"[object Array]\") {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                length = value.length;\n                for (i = 0; i < length; i += 1) {\n                    partial[i] = str(i, value) || \"null\";\n                }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                v = partial.length === 0\n                    ? \"[]\"\n                    : gap\n                        ? \"[\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"]\"\n                        : \"[\" + partial.join(\",\") + \"]\";\n                gap = mind;\n                return v;\n            }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n            if (rep && typeof rep === \"object\") {\n                length = rep.length;\n                for (i = 0; i < length; i += 1) {\n                    if (typeof rep[i] === \"string\") {\n                        k = rep[i];\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (\n                                gap\n                                    ? \": \"\n                                    : \":\"\n                            ) + v);\n                        }\n                    }\n                }\n            } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                for (k in value) {\n                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (\n                                gap\n                                    ? \": \"\n                                    : \":\"\n                            ) + v);\n                        }\n                    }\n                }\n            }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n            v = partial.length === 0\n                ? \"{}\"\n                : gap\n                    ? \"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\"\n                    : \"{\" + partial.join(\",\") + \"}\";\n            gap = mind;\n            return v;\n        }\n    }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n    if (typeof JSON.stringify !== \"function\") {\n        meta = {    // table of character substitutions\n            \"\\b\": \"\\\\b\",\n            \"\\t\": \"\\\\t\",\n            \"\\n\": \"\\\\n\",\n            \"\\f\": \"\\\\f\",\n            \"\\r\": \"\\\\r\",\n            \"\\\"\": \"\\\\\\\"\",\n            \"\\\\\": \"\\\\\\\\\"\n        };\n        JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n            var i;\n            gap = \"\";\n            indent = \"\";\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n            if (typeof space === \"number\") {\n                for (i = 0; i < space; i += 1) {\n                    indent += \" \";\n                }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n            } else if (typeof space === \"string\") {\n                indent = space;\n            }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n            rep = replacer;\n            if (replacer && typeof replacer !== \"function\" &&\n                    (typeof replacer !== \"object\" ||\n                    typeof replacer.length !== \"number\")) {\n                throw new Error(\"JSON.stringify\");\n            }\n\n// Make a fake root object containing our value under the key of \"\".\n// Return the result of stringifying the value.\n\n            return str(\"\", {\"\": value});\n        };\n    }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n    if (typeof JSON.parse !== \"function\") {\n        JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k;\n                var v;\n                var value = holder[key];\n                if (value && typeof value === \"object\") {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            rx_dangerous.lastIndex = 0;\n            if (rx_dangerous.test(text)) {\n                text = text.replace(rx_dangerous, function (a) {\n                    return \"\\\\u\" +\n                            (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\n// because they can cause invocation, and \"=\" because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\n// replace all simple value tokens with \"]\" characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or \"]\" or\n// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\n\n            if (\n                rx_one.test(\n                    text\n                        .replace(rx_two, \"@\")\n                        .replace(rx_three, \"]\")\n                        .replace(rx_four, \"\")\n                )\n            ) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval(\"(\" + text + \")\");\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return (typeof reviver === \"function\")\n                    ? walk({\"\": j}, \"\")\n                    : j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError(\"JSON.parse\");\n        };\n    }\n}());","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"aT88m\\\":\\\"index.9328a0da.js\\\",\\\"93Bqc\\\":\\\"sword.a45e8cc8.png\\\",\\\"lxy2T\\\":\\\"clank.3e05cde9.wav\\\"}\"));","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, function() {\nreturn ","require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar TypeError = global.TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar String = global.String;\nvar TypeError = global.TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar createProperty = require('../internals/create-property');\n\nvar Array = global.Array;\nvar max = Math.max;\n\nmodule.exports = function (O, start, end) {\n  var length = lengthOfArrayLike(O);\n  var k = toAbsoluteIndex(start, length);\n  var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n  var result = Array(max(fin - k, 0));\n  for (var n = 0; k < fin; k++, n++) createProperty(result, n, O[k]);\n  result.length = n;\n  return result;\n};\n","var arraySlice = require('../internals/array-slice-simple');\n\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    array,\n    mergeSort(arraySlice(array, 0, middle), comparefn),\n    mergeSort(arraySlice(array, middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (array, left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n\n  while (lindex < llength || rindex < rlength) {\n    array[lindex + rindex] = (lindex < llength && rindex < rlength)\n      ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n      : lindex < llength ? left[lindex++] : right[rindex++];\n  } return array;\n};\n\nmodule.exports = mergeSort;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n","var global = require('../internals/global');\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar Object = global.Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","'use strict';\nvar toPropertyKey = require('../internals/to-property-key');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPropertyKey(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar bind = FunctionPrototype.bind;\nvar call = FunctionPrototype.call;\nvar uncurryThis = NATIVE_BIND && bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? function (fn) {\n  return fn && uncurryThis(fn);\n} : function (fn) {\n  return fn && function () {\n    return call.apply(fn, arguments);\n  };\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar Object = global.Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split(it, '') : Object(it);\n} : Object;\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = uncurryThis(store.get);\n  var wmhas = uncurryThis(store.has);\n  var wmset = uncurryThis(store.set);\n  set = function (it, metadata) {\n    if (wmhas(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument == 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar Object = global.Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, Object(it));\n};\n","var toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var global = require('../internals/global');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar TypeError = global.TypeError;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar TypeError = global.TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","var global = require('../internals/global');\n\nvar TypeError = global.TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.21.0',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2014-2022 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- safe\n  return number !== number || number === 0 ? 0 : (number > 0 ? floor : ceil)(number);\n};\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var global = require('../internals/global');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar Object = global.Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TypeError = global.TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var global = require('../internals/global');\nvar classof = require('../internals/classof');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","var global = require('../internals/global');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype != 42;\n});\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar symbolFor = Symbol && Symbol['for'];\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    var description = 'Symbol.' + name;\n    if (NATIVE_SYMBOL && hasOwn(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else if (USE_SYMBOL_AS_UID && symbolFor) {\n      WellKnownSymbolsStore[name] = symbolFor(description);\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar un$Sort = uncurryThis(test.sort);\nvar push = uncurryThis(test.push);\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n    var items = [];\n    var arrayLength = lengthOfArrayLike(array);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) push(items, array[index]);\n    }\n\n    internalSort(items, getSortCompare(comparefn));\n\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n/**\n * Features in preview\n */\nexport enum Experiments {\n  WebGL = 'use-webgl'\n}\n\n/**\n * Legacy features that will go away\n */\nexport enum Legacy {\n  Canvas = 'use-canvas-context',\n  LegacyDrawing = 'use-legacy-drawing'\n}\n\n/**\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\n * after which they are frozen and are read-only.\n *\n * Flags are used to enable experimental or preview features in Excalibur.\n */\nexport class Flags {\n  private static _FROZEN = false;\n  private static _FLAGS: Record<string, boolean> = {};\n\n  /**\n   * Freeze all flag modifications making them readonly\n   */\n  public static freeze() {\n    Flags._FROZEN = true;\n  }\n\n  /**\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\n   *\n   * Calling this in your game is UNSUPPORTED\n   * @internal\n   */\n  public static _reset() {\n    Flags._FROZEN = false;\n    Flags._FLAGS = {};\n  }\n\n  /**\n   * Turn on webgl support\n   */\n  public static useWebGL() {\n    Flags.enable(Experiments.WebGL);\n  }\n\n  public static useCanvasGraphicsContext() {\n    Flags.enable(Legacy.Canvas);\n  }\n\n  /**\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\n   */\n  public static useLegacyDrawing() {\n    Flags.enable(Legacy.LegacyDrawing);\n  }\n\n  /**\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static enable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be enabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = true;\n  }\n\n  /**\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static disable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be disabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = false;\n  }\n\n  /**\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\n   * @param flagName\n   */\n  public static isEnabled(flagName: string): boolean {\n    return !!Flags._FLAGS[flagName];\n  }\n\n  /**\n   * Show a list of currently known flags\n   */\n  public static show(): string[] {\n    return Object.keys(Flags._FLAGS);\n  }\n}\n","/* eslint-disable no-console */\n/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[Appender]] to create your own logging appenders.\n */\nexport class Logger {\n  private static _INSTANCE: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._INSTANCE) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._INSTANCE = this;\n    // Default console appender\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._INSTANCE == null) {\n      Logger._INSTANCE = new Logger();\n    }\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Adds a new [[Appender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    // eslint-disable-next-line\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import 'core-js/es/array/sort';\nimport 'core-js/es/object/keys';\n\n/**\n * Polyfill adding function\n */\nexport function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function () {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function (callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function () {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    if ((<any>window).webkitAudioContext) {\n      const ctx = (<any>window).webkitAudioContext;\n      const replaceMe = ctx.prototype.decodeAudioData;\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\n        return new Promise((resolve, reject) => {\n          replaceMe.call(this, arrayBuffer, resolve, reject);\n        });\n      };\n    }\n\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n}\n","export type Id<T extends string> = {\n  type: T,\n  value: number\n};\n\n/**\n * Create a branded ID type from a number\n */\nexport function createId<T extends string>(type: T, value: number): Id<T> {\n  return { type, value };\n};\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = {\n    message: 'This feature will be removed in future versions of Excalibur.',\n    alternateMethod: null,\n    showStackTrace: false,\n    ...options\n  };\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Clonable } from '../Interfaces/Clonable';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A 2D vector on a plane.\n */\n\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  public static min(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\n  }\n\n  public static max(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(x: number, y: number) {\n    this._x = x;\n    this._y = y;\n  }\n\n  protected _x = 0;\n  /**\n   * Get the x component of the vector\n   */\n  public get x(): number {\n    return this._x;\n  }\n\n  /**\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set x(val: number) {\n    this._x = val;\n  }\n\n  protected _y = 0;\n  /**\n   * Get the y component of the vector\n   */\n  public get y(): number {\n    return this._y;\n  }\n\n  /**\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set y(val: number) {\n    this._y = val;\n  }\n\n  /**\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\n   *\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  setTo(x: number, y: number) {\n    (this.x as number) = x;\n    (this.y as number) = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param vector The other point to compare to\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  public squareDistance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\n   */\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * The size (magnitude) of the Vector\n   */\n  public get size(): number {\n    return this.distance();\n  }\n\n  /**\n   * Setting the size mutates the current vector\n   *\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  public set size(newLength: number) {\n    const v = this.normalize().scale(newLength);\n    this.setTo(v.x, v.y);\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public addEqual(v: Vector): Vector {\n    this.setTo(this.x + v.x, this.y + v.y);\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @param v The vector to subtract\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public subEqual(v: Vector): Vector {\n    this.setTo(this.x - v.x, this.y - v.y);\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public scaleEqual(size: number): Vector {\n    this.setTo(this.x * size, this.y * size);\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  static cross(num: number, vec: Vector): Vector {\n    return new Vector(-num * vec.y, num * vec.x);\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string representation of the vector.\n   */\n  public toString(fixed?: number): string {\n    if (fixed) {\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\n    }\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n *\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nexport function vec(x: number, y: number): Vector {\n  return new Vector(x, y);\n}\n","import { Vector } from '../Math/vector';\n\n/**\n * An enum that describes the sides of an axis aligned box for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n\nexport module Side {\n  /**\n   * Returns the opposite side from the current\n   */\n  export function getOpposite(side: Side): Side {\n    if (side === Side.Top) {\n      return Side.Bottom;\n    }\n    if (side === Side.Bottom) {\n      return Side.Top;\n    }\n    if (side === Side.Left) {\n      return Side.Right;\n    }\n    if (side === Side.Right) {\n      return Side.Left;\n    }\n\n    return Side.None;\n  }\n\n  /**\n   * Given a vector, return the Side most in that direction (via dot product)\n   */\n  export function fromDirection(direction: Vector): Side {\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n    let max = -Number.MAX_VALUE;\n    let maxIndex = -1;\n    for (let i = 0; i < directions.length; i++) {\n      if (directions[i].dot(direction) > max) {\n        max = directions[i].dot(direction);\n        maxIndex = i;\n      }\n    }\n    return directionEnum[maxIndex];\n  }\n}\n","import { obsolete } from './Util/Decorators';\n\n/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new instance of Color from a rgb string\n   *\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\n   */\n  public static fromRGBString(string: string): Color {\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\n    let match = null;\n    if ((match = string.match(rgbaRegEx))) {\n      const r = parseInt(match[1], 10);\n      const g = parseInt(match[2], 10);\n      const b = parseInt(match[3], 10);\n      let a = 1;\n      if (match[4]) {\n        a = parseFloat(match[4]);\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid rgb/a string: ' + string);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public multiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   * @param color\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\n  public mulitiply(color: Color): Color {\n    return this.multiply(color);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.multiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  public equal(color: Color): boolean {\n    return this.toString() === color.toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   */\n  public static get Vermilion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions',\n    alternateMethod: 'Vermilion'\n  })\n  public static get Vermillion(): Color {\n    return Color.Vermilion;\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n\n  /**\n   * ExcaliburBlue (#176BAA)\n   */\n  public static get ExcaliburBlue(): Color {\n    return Color.fromHex('#176BAA');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","import { vec, Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Returns a new instance of [[BoundingBox]] that is a copy of the current instance\n   */\n  public clone(): BoundingBox {\n    return new BoundingBox(this.left, this.top, this.right, this.bottom);\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Scale a bounding box by a scale factor, optionally provide a point\n   * @param scale\n   * @param point\n   */\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Transform the axis aligned bounding box by a [[Matrix]], producing a new axis aligned bounding box\n   * @param matrix\n   */\n  public transform(matrix: Matrix) {\n    const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\n    const xa = matFirstColumn.scale(this.left);\n    const xb = matFirstColumn.scale(this.right);\n\n    const matSecondColumn = vec(matrix.data[4], matrix.data[5]);\n    const ya = matSecondColumn.scale(this.top);\n    const yb = matSecondColumn.scale(this.bottom);\n\n    const matrixPos = matrix.getPosition();\n    const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\n    const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\n\n    return new BoundingBox({\n      left: topLeft.x,\n      top: topLeft.y,\n      right: bottomRight.x,\n      bottom: bottomRight.y\n    });\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Returns true if the bounding boxes overlap.\n   * @param other\n   */\n  public overlaps(other: BoundingBox): boolean {\n    const totalBoundingBox = this.combine(other);\n    return totalBoundingBox.width < other.width + this.width &&\n           totalBoundingBox.height < other.height + this.height;\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /**\n   *\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","/**\n * @module\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrence\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param array Array to pick elements out of\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param array Array to pick elements out of\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","import { Random } from './Random';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Returns the fractional part of a number\n * @param x\n */\nexport function frac(x: number): number {\n  if (x >= 0) {\n    return x - Math.floor(x);\n  } else {\n    return x - Math.ceil(x);\n  }\n}\n\n/**\n * Returns the sign of a number, if 0 returns 0\n */\nexport function sign(val: number): number {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\n\n/**\n * Convert an angle to be the equivalent in the range [0, 2PI]\n */\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\n/**\n * Convert radians to degrees\n */\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\n/**\n * Convert degrees to radians\n */\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\n/**\n * Generate a range of numbers\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\n * @param from inclusive\n * @param to inclusive\n */\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\n\n/**\n * Find a random floating point number in range\n */\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\n/**\n * Find a random integer in a range\n */\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}","import { Vector } from '../Math/vector';\nimport { Side } from '../Collision/Side';\nimport { Clock } from './Clock';\n\n// TODO remove in v0.26.0\n// Re-export hack to deprecate import site gently\nimport {\n  TwoPI as lTwoPI,\n  clamp as lclamp,\n  randomInRange as lrandomInRange,\n  randomIntInRange as lrandomIntInRange,\n  canonicalizeAngle as lcanonicalizeAngle,\n  toDegrees as ltoDegrees,\n  toRadians as ltoRadians,\n  range as lrange\n} from '../Math/util';\n\n/**\n * @deprecated ex.Util.TwoPI import site will be removed in v0.26.0, use ex.TwoPI\n */\nexport const TwoPI = lTwoPI;\n\n/**\n * @deprecated ex.Util.clamp import site will be removed in v0.26.0, use ex.clamp\n */\nexport const clamp = lclamp;\n\n/**\n * @deprecated ex.Util.randomInRange import site will be removed in v0.26.0, use ex.randomInRange\n */\nexport const randomInRange = lrandomInRange;\n\n/**\n * @deprecated ex.Util.randomIntInRange import site will be removed in v0.26.0, use ex.randomIntInRange\n */\nexport const randomIntInRange = lrandomIntInRange;\n\n/**\n * @deprecated ex.Util.canonicalizeAngle import site will be removed in v0.26.0, use ex.canonicalizeAngle\n */\nexport const canonicalizeAngle = lcanonicalizeAngle;\n\n/**\n * @deprecated ex.Util.toDegrees import site will be removed in v0.26.0, use ex.toDegrees\n */\nexport const toDegrees = ltoDegrees;\n\n/**\n * @deprecated ex.Util.toRadians import site will be removed in v0.26.0, use ex.toRadians\n */\nexport const toRadians = ltoRadians;\n\n/**\n * @deprecated ex.Util.range import site will be removed in v0.26.0, use ex.range\n */\nexport const range = lrange;\n\n// TODO END REMOVE in v0.26.0\n\n/**\n * Find the screen position of an HTML element\n */\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\n/**\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\n * @deprecated Will be removed in v0.26.0\n */\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Remove an item from an list\n * @deprecated Will be removed in v0.26.0\n */\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * See if an array contains something\n */\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get the opposite side\n * TODO: Move to Side type\n * @deprecated Will be removed in v0.26.0\n */\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n * @deprecated\n * TODO: Move to Side type\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n * @deprecated Will be removed v0.26.0\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n\n/**\n * Create a promise that resolves after a certain number of milliseconds\n *\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\n * excalibur clock which would be unaffected by stop/pause.\n * @param milliseconds\n * @param clock\n */\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\n  return new Promise<void>(resolve => {\n    schedule(() => {\n      resolve();\n    }, milliseconds);\n  });\n}\n","import { sign } from './util';\nimport { Vector, vec } from './vector';\nimport { canonicalizeAngle } from './util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Converts the current matrix into a DOMMatrix\n   *\n   * This is useful when working with the browser Canvas context\n   * @returns {DOMMatrix} DOMMatrix\n   */\n  public toDOMMatrix(): DOMMatrix {\n    return new DOMMatrix([...this.data]);\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Resets the current matrix to the identity matrix, mutating it\n   * @returns {Matrix} Current matrix as identity\n   */\n  public reset(): Matrix {\n    const mat = this;\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiply the current matrix by a vector producing a new vector\n   * @param vector\n   * @param dest\n   */\n  multiply(vector: Vector, dest?: Vector): Vector;\n  /**\n   * Multiply the current matrix by another matrix producing a new matrix\n   * @param matrix\n   * @param dest\n   */\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\n    if (vectorOrMatrix instanceof Vector) {\n      const result = (dest as Vector) || new Vector(0, 0);\n      const vector = vectorOrMatrix;\n      // these shenanigans are to allow dest and vector to be the same instance\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\n\n      result.x = resultX;\n      result.y = resultY;\n      return result;\n    } else {\n      const result = (dest as Matrix) || new Matrix();\n      const other = vectorOrMatrix;\n      const a11 = this.data[0];\n      const a21 = this.data[1];\n      const a31 = this.data[2];\n      const a41 = this.data[3];\n\n      const a12 = this.data[4];\n      const a22 = this.data[5];\n      const a32 = this.data[6];\n      const a42 = this.data[7];\n\n      const a13 = this.data[8];\n      const a23 = this.data[9];\n      const a33 = this.data[10];\n      const a43 = this.data[11];\n\n      const a14 = this.data[12];\n      const a24 = this.data[13];\n      const a34 = this.data[14];\n      const a44 = this.data[15];\n\n      const b11 = other.data[0];\n      const b21 = other.data[1];\n      const b31 = other.data[2];\n      const b41 = other.data[3];\n\n      const b12 = other.data[4];\n      const b22 = other.data[5];\n      const b32 = other.data[6];\n      const b42 = other.data[7];\n\n      const b13 = other.data[8];\n      const b23 = other.data[9];\n      const b33 = other.data[10];\n      const b43 = other.data[11];\n\n      const b14 = other.data[12];\n      const b24 = other.data[13];\n      const b34 = other.data[14];\n      const b44 = other.data[15];\n\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n      const s = this.getScale();\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\n\n      return result;\n    }\n  }\n\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  /**\n   * Return the affine inverse, optionally store it in a target matrix.\n   *\n   * It's recommended you call .reset() the target unless you know what you're doing\n   * @param target\n   */\n  public getAffineInverse(target?: Matrix): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = target || Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","\n/**\n * Describes the different image filtering modes\n */\nexport enum ImageFiltering {\n\n  /**\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\n   *\n   * Useful for Pixel art aesthetics.\n   */\n  Pixel = 'Pixel',\n\n  /**\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\n   */\n  Blended = 'Blended'\n}","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { Matrix } from '../../Math/matrix';\n\nexport class TransformStack {\n  private _transforms: Matrix[] = [];\n  private _currentTransform: Matrix = Matrix.identity();\n\n  public save(): void {\n    this._transforms.push(this._currentTransform);\n    this._currentTransform = this._currentTransform.clone();\n  }\n\n  public restore(): void {\n    this._currentTransform = this._transforms.pop();\n  }\n\n  public translate(x: number, y: number): Matrix {\n    return this._currentTransform.translate(x, y);\n  }\n\n  public rotate(angle: number): Matrix {\n    return this._currentTransform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): Matrix {\n    return this._currentTransform.scale(x, y);\n  }\n\n  public set current(matrix: Matrix) {\n    this._currentTransform = matrix;\n  }\n\n  public get current(): Matrix {\n    return this._currentTransform;\n  }\n}\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\n\nexport class StateStack {\n  private _states: ExcaliburGraphicsContextState[] = [];\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\n\n  private _getDefaultState() {\n    return {\n      opacity: 1\n    };\n  }\n\n  private _cloneState() {\n    return {\n      opacity: this._currentState.opacity\n    };\n  }\n\n  public save(): void {\n    this._states.push(this._currentState);\n    this._currentState = this._cloneState();\n  }\n\n  public restore(): void {\n    this._currentState = this._states.pop();\n  }\n\n  public get current(): ExcaliburGraphicsContextState {\n    return this._currentState;\n  }\n}\n","/**\n * Watch an object with a proxy, only fires if property value is different\n */\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        if ((obj as any)[prop] !== value) {\n          (obj as any)[prop] = value;\n          // Avoid watching private junk\n          if (typeof prop === 'string') {\n            if (prop[0] !== '_') {\n              change(obj);\n            }\n          }\n        }\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n\n/**\n * Watch an object with a proxy, fires change on any property value change\n */\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        (obj as any)[prop] = value;\n        // Avoid watching private junk\n        if (typeof prop === 'string') {\n          if (prop[0] !== '_') {\n            change(obj);\n          }\n        }\n\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { Matrix } from '..';\nimport { watch } from '../Util/Watch';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  public transform: Matrix = Matrix.identity();\n  private _transformStale = true;\n  public isStale() {\n    return this._transformStale;\n  }\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n\n  private _flipHorizontal = false;\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public get flipHorizontal(): boolean {\n    return this._flipHorizontal;\n  }\n\n  public set flipHorizontal(value: boolean) {\n    this._flipHorizontal = value;\n    this._transformStale = true;\n  }\n\n  private _flipVertical = false;\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public get flipVertical(): boolean {\n    return this._flipVertical;\n  }\n\n  public set flipVertical(value: boolean) {\n    this._flipVertical = value;\n    this._transformStale = true;\n  }\n\n  private _rotation = 0;\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public get rotation(): number {\n    return this._rotation;\n  }\n\n  public set rotation(value: number) {\n    this._rotation = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  private _scale = Vector.One;\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public get scale() {\n    return this._scale;\n  }\n\n  public set scale(value: Vector) {\n    this._scale = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  private _origin: Vector | null = null;\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public get origin(): Vector | null {\n    return this._origin;\n  }\n\n  public set origin(value: Vector | null) {\n    this._origin = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n    this._transformStale = true;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    if (this._transformStale) {\n      this.transform.reset();\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n      this._rotate(this.transform);\n      this._flip(this.transform);\n      this._transformStale = false;\n    }\n    ex.multiply(this.transform);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext | Matrix) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext | Matrix) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any additional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\n * Checks if the current number is a power of two\n */\nexport function isPowerOfTwo(x: number): boolean {\n  return (x & (x - 1)) === 0;\n}\n\n/**\n * Returns the next highest power of two\n */\nexport function nextHighestPowerOfTwo(x: number): number {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x = x | (x >> i);\n  }\n  return x + 1;\n}\n\n/**\n * Returns the input number if a power of two, otherwise the next highest power of two\n */\nexport function ensurePowerOfTwo(x: number): number {\n  if (!isPowerOfTwo(x)) {\n    return nextHighestPowerOfTwo(x);\n  }\n  return x;\n}\n\n/**\n * Return the size of the GlType in bytes\n * @param gl\n * @param type\n */\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.FLOAT:\n      return 4;\n    case gl.SHORT:\n      return 2;\n    case gl.UNSIGNED_SHORT:\n      return 2;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n\n/**\n * Based on the type return the number of attribute components\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n * @param gl\n * @param type\n */\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n      return 1;\n    case gl.FLOAT_VEC2:\n      return 2;\n    case gl.FLOAT_VEC3:\n      return 3;\n    case gl.FLOAT_VEC4:\n      return 4;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    case gl.UNSIGNED_SHORT:\n    case gl.SHORT:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n/**\n * Based on the attribute return the corresponding supported attrib pointer type\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n *\n * @param gl\n * @param type\n */\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n    case gl.FLOAT_VEC2:\n    case gl.FLOAT_VEC3:\n    case gl.FLOAT_VEC4:\n      return gl.FLOAT;\n    case gl.BYTE:\n      return gl.BYTE;\n    case gl.UNSIGNED_BYTE:\n      return gl.UNSIGNED_BYTE;\n    case gl.SHORT:\n      return gl.SHORT;\n    case gl.UNSIGNED_SHORT:\n      return gl.UNSIGNED_SHORT;\n    default:\n      return gl.FLOAT;\n  }\n}","import { Logger } from '../../Util/Log';\nimport { ImageFiltering } from '../Filtering';\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\n\n/**\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\n */\nexport class TextureLoader {\n  private static _LOGGER = Logger.getInstance();\n  /**\n   * Sets the default filtering for the Excalibur texture loader, default [[ImageFiltering.Blended]]\n   */\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\n  private static _POT_CANVAS = document.createElement('canvas');\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\n\n  private static _GL: WebGLRenderingContext;\n\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\n\n  private static _MAX_TEXTURE_SIZE: number  = 0;\n\n  public static register(context: WebGLRenderingContext): void {\n    TextureLoader._GL = context;\n    TextureLoader._MAX_TEXTURE_SIZE = context.getParameter(context.MAX_TEXTURE_SIZE);\n  }\n\n  /**\n   * Get the WebGL Texture from a source image\n   * @param image\n   */\n  public static get(image: HTMLImageSource): WebGLTexture {\n    return TextureLoader._TEXTURE_MAP.get(image);\n  }\n\n  /**\n   * Returns whether a source image has been loaded as a texture\n   * @param image\n   */\n  public static has(image: HTMLImageSource): boolean {\n    return TextureLoader._TEXTURE_MAP.has(image);\n  }\n\n  /**\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\n   * @param image Source graphic\n   * @param filtering {ImageFiltering} The ImageFiltering mode to apply to the loaded texture\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\n   */\n  public static load(image: HTMLImageSource, filtering?: ImageFiltering, forceUpdate = false): WebGLTexture {\n    // Ignore loading if webgl is not registered\n    const gl = TextureLoader._GL;\n    if (!gl) {\n      return null;\n    }\n\n    let tex: WebGLTexture = null;\n    // If reuse the texture if it's from the same source\n    if (TextureLoader.has(image)) {\n      tex = TextureLoader.get(image);\n    }\n\n    // Update existing webgl texture and return early\n    if (tex) {\n      if (forceUpdate) {\n        gl.bindTexture(gl.TEXTURE_2D, tex);\n        const source = TextureLoader.toPowerOfTwoImage(image);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n      }\n      return tex;\n    }\n\n    // No texture exists create a new one\n    tex = gl.createTexture();\n    const source = TextureLoader.toPowerOfTwoImage(image);\n\n    TextureLoader.checkImageSizeSupportedAndLog(image);\n\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    // NEAREST for pixel art, LINEAR for hi-res\n    const filterMode = filtering ?? TextureLoader.filtering;\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n\n    TextureLoader._TEXTURE_MAP.set(image, tex);\n    return tex;\n  }\n\n  /**\n   * Converts source images into power of two images, WebGL only supports POT images\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\n   * @param image\n   */\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\n    const potCanvas = TextureLoader._POT_CANVAS;\n    const potCtx = TextureLoader._POT_CTX;\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\n      // Scale up the texture to the next highest power of two dimensions.\n\n      potCanvas.width = ensurePowerOfTwo(image.width);\n      potCanvas.height = ensurePowerOfTwo(image.height);\n      potCtx.imageSmoothingEnabled = false;\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\n      image = potCanvas;\n    }\n    return image;\n  }\n\n  /**\n   * Takes an image and returns if it meets size criteria for hardware\n   * @param image\n   * @returns if the image will be supported at runtime\n   */\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\n      TextureLoader._LOGGER.error(\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of `+\n        `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image `\n        +`for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n`+\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n      return false;\n    } else if (image.width > 4096 || image.height > 4096) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\n      TextureLoader._LOGGER.warn(\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, `+\n        `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\n        `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n    }\n    return true;\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\nimport { ImageFiltering } from './Filtering';\n\n\nexport interface RasterOptions {\n  /**\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\n   */\n  smoothing?: boolean;\n\n  /**\n   * Optionally specify the color of the raster's bitmap context, by default [[Color.Black]]\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\n   */\n  strokeColor?: Color;\n\n  /**\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\n   */\n  lineWidth?: number;\n\n  /**\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\n   */\n  lineDash?: number[];\n\n  /**\n   * Optionally specify the padding to apply to the bitmap\n   */\n  padding?: number;\n\n  /**\n   * Optionally specify what image filtering mode should be used, [[ImageFiltering.Pixel]] for pixel art,\n   * [[ImageFiltering.Blended]] for hi-res art\n   *\n   * By default unset, rasters defer to the engine antialiasing setting\n   */\n  filtering?: ImageFiltering;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implement the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public filtering: ImageFiltering = null;\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n      this.filtering = options.filtering ?? this.filtering;\n    }\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return Math.abs(this._getTotalWidth() * this.scale.x);\n  }\n  public set width(value: number) {\n    value /= Math.abs(this.scale.x);\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return Math.abs(this._getTotalHeight() * this.scale.y);\n  }\n\n  public set height(value: number) {\n    value /= Math.abs(this.scale.y);\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    this.flagDirty();\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    this.flagDirty();\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperties(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, this.filtering, true);\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CanvasOptions {\n  draw?: (ctx: CanvasRenderingContext2D) => void;\n  cache?: boolean;\n}\n\n/**\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\n *\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\n *\n * **Low performance API**\n */\nexport class Canvas extends Raster {\n  /**\n   * Return the 2D graphics context of this canvas\n   */\n  public get ctx() {\n    return this._ctx;\n  }\n\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\n    super(_options);\n  }\n\n  public clone(): Canvas {\n    return new Canvas({\n      ...this._options,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._options?.draw) {\n      this._options?.draw(ctx);\n    }\n    if (!this._options.cache) {\n      this.flagDirty();\n    }\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    if (!event) {\n      event = new GameEvent();\n    }\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i](event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      this.off(eventName, handler);\n      handler(ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also receive events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Logger } from '../Util/Log';\nimport { EventDispatcher } from '../EventDispatcher';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n */\nexport class Resource<T> implements Loadable<T> {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n  public events: EventDispatcher = new EventDispatcher();\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {}\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<T> {\n    return new Promise((resolve, reject) => {\n      // Exit early if we already have data\n      if (this.data !== null) {\n        this.logger.debug('Already have data for resource', this.path);\n        this.events.emit('complete', this.data as any);\n        resolve(this.data);\n        return;\n      }\n\n      const request = new XMLHttpRequest();\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n      request.responseType = this.responseType;\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\n      request.addEventListener('load', () => {\n        // XHR on file:// success status is 0, such as with PhantomJS\n        if (request.status !== 0 && request.status !== 200) {\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n          this.events.emit('error', request.response);\n          reject(new Error(request.statusText));\n          return;\n        }\n\n        this.data = request.response;\n        this.events.emit('complete', this.data as any);\n        this.logger.debug('Completed loading resource', this.path);\n        resolve(this.data);\n      });\n      request.send();\n    });\n  }\n}\n","/**\n * @module\n * @deprecated\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n */\n\n/**\n * @typedoc\n */\n\nimport { obsolete } from '../Util/Decorators';\nimport { Color } from '../Color';\n\n/**\n * The interface that all sprite effects must implement\n * @deprecated SpriteEffect will be removed in v0.26.0\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n * @deprecated [[Grayscale]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Grayscale will be removed in v0.26.0'\n})\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n * @deprecated [[Invert]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Invert will be removed in v0.26.0'\n})\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n * @deprecated [[Opacity]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Opacity will be removed in v0.26.0'\n})\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n * @deprecated [[Colorize]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Colorize will be removed in v0.26.0'\n})\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n * @deprecated [[Lighten]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Lighten will be removed in v0.26.0'\n})\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n * @deprecated [[Darken]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Darken will be removed v0.26.0'\n})\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n * @deprecated [[Saturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Saturate will be removed in v0.26.0'\n})\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n * @deprecated [[Desaturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Desaturate will be removed in v0.26.0'\n})\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n * @deprecated [[Fill]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Fill will be removed in v0.26.0'\n})\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n * @deprecated\n */\nexport class Texture implements Loadable<HTMLImageElement> {\n  private _resource: Resource<Blob>;\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public data: HTMLImageElement;\n  public get image() {\n    return this.data;\n  }\n\n  private _loadedResolve: (image: HTMLImageElement) => any;\n  public loaded = new Promise<HTMLImageElement>(resolve => {\n    this._loadedResolve = resolve;\n  });\n\n  /**\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return !!this.data;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<HTMLImageElement> {\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      await image.decode();\n\n      // Set results\n      this.data = image;\n      this.width = this._sprite.width = image.naturalWidth;\n      this.height = this._sprite.height = image.naturalHeight;\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n    } catch {\n      await Promise.reject('Error loading texture');\n    }\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\n/**\n * Configurable helper extends base type and makes all properties available as option bag arguments\n * @internal\n * @param base\n */\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        // eslint-disable-next-line\n        if (typeof (<any>this)[k] !== 'function') {\n          // eslint-disable-next-line\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Texture } from './Texture';\nimport { Vector } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @hidden\n * @deprecated Use [[Sprite]]\n */\nexport class SpriteImpl implements Drawable {\n  public texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return Math.abs(this.width * this.scale.x);\n  }\n\n  public get drawHeight(): number {\n    return Math.abs(this.height * this.scale.y);\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = Vector.Half;\n  public offset: Vector = Vector.Zero;\n  public scale: Vector = Vector.One;\n  /**\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\n   */\n  public drawAroundAnchor = false;\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = true;\n\n  /**\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to construct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this.texture = image as Texture;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\n    this._initPixelsFromTexture();\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private async _initPixelsFromTexture() {\n    try {\n      const image = await this.texture.loaded;\n      this.width = this.width || image.naturalWidth;\n      this.height = this.height || image.naturalHeight;\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\n      this._loadPixels();\n      this._dirtyEffect = true;\n    } catch (e) {\n      this.logger.error('Error loading texture ', this.texture.path, e);\n    }\n  }\n\n  private _loadPixels() {\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this.texture.image.naturalWidth || 0;\n      const naturalHeight = this.texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._flushTexture();\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  private _flushTexture() {\n    const naturalWidth = this.texture.image.naturalWidth || 0;\n    const naturalHeight = this.texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this.texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n  }\n\n  private _opacity: number = 1;\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[SpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[SpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n    this._flushTexture();\n\n    if (this.effects.length > 0) {\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n      const len = this.effects.length;\n      for (let i = 0; i < len; i++) {\n        for (let y = 0; y < this.height; y++) {\n          for (let x = 0; x < this.width; x++) {\n            this.effects[i].updatePixel(x, y, this._pixelData);\n          }\n        }\n      }\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\n    }\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.width,\n      drawHeight: options.drawHeight ?? this.height,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n    // calculating current dimensions\n    const anchorX = drawWidth * anchor.x + offset.x;\n    const anchorY = drawHeight * anchor.y + offset.y;\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n\n    ctx.save();\n    // Move the draw point of origin\n    ctx.translate(x, y);\n\n    // Rotate and scale around anchor point\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n\n    if (this.drawAroundAnchor) {\n      // In the case where you want the anchor to match with the point of draw\n      // Otherwise sprites are always drawn from top-left\n      ctx.translate(-anchorX, -anchorY);\n    }\n\n    ctx.translate(anchorX, anchorY);\n    ctx.rotate(rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ctx.scale(scaleDirX, scaleDirY);\n    ctx.translate(-anchorX, -anchorY);\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    // Context is already rotated and scaled\n    ctx.drawImage(\n      this._spriteCanvas,\n      0,\n      0,\n      this.width,\n      this.height, // source\n      0,\n      0,\n      this.width,\n      this.height\n    ); // dest\n    ctx.globalAlpha = oldAlpha;\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\n    result.anchor = this.anchor.clone();\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * @deprecated Use [[Sprite]]\n */\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\n * @deprecated Use [[Sprite]]\n */\n@obsolete({\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\n  alternateMethod: 'Use Label.font.shadow'\n})\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ImageSource } from './ImageSource';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\nimport { Texture } from '../Drawing/Texture';\n\nexport type SourceView = { x: number; y: number; width: number; height: number };\nexport type DestinationSize = { width: number; height: number };\n\nexport interface SpriteOptions {\n  /**\n   * Image to create a sprite from\n   */\n  image: ImageSource;\n  /**\n   * By default the source is the entire dimension of the [[ImageSource]]\n   */\n  sourceView?: { x: number; y: number; width: number; height: number };\n  /**\n   * By default the size of the final sprite is the size of the [[ImageSource]]\n   */\n  destSize?: { width: number; height: number };\n}\n\nexport class Sprite extends Graphic {\n  public image: ImageSource;\n  public sourceView: SourceView;\n  public destSize: DestinationSize;\n  private _dirty = true;\n\n  public static from(image: ImageSource): Sprite {\n    return new Sprite({\n      image: image\n    });\n  }\n\n  constructor(options: GraphicOptions & SpriteOptions) {\n    super(options);\n    this.image = options.image;\n    const { width, height } = options;\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\n    this._updateSpriteDimensions();\n    this.image.ready.then(() => {\n      this._updateSpriteDimensions();\n    });\n  }\n\n  public override get width(): number {\n    return Math.abs(this.destSize.width * this.scale.x);\n  }\n\n  public override get height(): number {\n    return Math.abs(this.destSize.height * this.scale.y);\n  }\n\n  public override set width(newWidth: number) {\n    newWidth /= Math.abs(this.scale.x);\n    this.destSize.width = newWidth;\n    super.width = Math.ceil(this.destSize.width);\n  }\n\n  public override set height(newHeight: number) {\n    newHeight /= Math.abs(this.scale.y);\n    this.destSize.height = newHeight;\n    super.height = Math.ceil(this.destSize.height);\n  }\n\n  private _updateSpriteDimensions() {\n    const { width: nativeWidth, height: nativeHeight } = this.image;\n    // This code uses || to avoid 0's\n    // If the source is not specified, use the native dimension\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\n\n    // If the destination is not specified, use the source if specified, then native\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\n\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded() && this._dirty) {\n      this._dirty = false;\n      this._updateSpriteDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded()) {\n      ex.drawImage(\n        this.image.image,\n        this.sourceView.x,\n        this.sourceView.y,\n        this.sourceView.width,\n        this.sourceView.height,\n        x,\n        y,\n        this.destSize.width,\n        this.destSize.height\n      );\n    }\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param sprite\n   */\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\n    const tex = sprite.texture;\n    const image = ImageSource.fromLegacyTexture(tex);\n    return new Sprite({\n      image,\n      sourceView: {\n        x: sprite.x,\n        y: sprite.y,\n        width: sprite.width,\n        height: sprite.height\n      }\n    });\n  }\n\n  /**\n   * Converts a sprite to a Legacy sprite\n   * @deprecated\n   * @param sprite\n   * @returns LegacyDrawing.Sprite\n   */\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\n    const image = sprite.image;\n    const tex = new Texture(image.path);\n    tex.data = image.image;\n\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\n  }\n\n  public clone(): Sprite {\n    return new Sprite({\n      image: this.image,\n      sourceView: { ...this.sourceView },\n      destSize: { ...this.destSize },\n      ...this.cloneGraphicOptions()\n    });\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Texture } from '../Drawing/Texture';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\nimport { Logger } from '../Util/Log';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\nexport class ImageSource implements Loadable<HTMLImageElement> {\n  private _logger = Logger.getInstance();\n  private _resource: Resource<Blob>;\n  private _filtering: ImageFiltering;\n\n  /**\n   * The original size of the source image in pixels\n   */\n  public get width() {\n    return this.image.naturalWidth;\n  }\n\n  /**\n   * The original height of the source image in pixels\n   */\n  public get height() {\n    return this.image.naturalHeight;\n  }\n\n  private _src: string;\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    if (!this._src) {\n      // this boosts speed of access\n      this._src = this.data.src;\n    }\n    return !!this._src;\n  }\n\n  /**\n   * Access to the underlying html image element\n   */\n  public data: HTMLImageElement = new Image();\n  public get image(): HTMLImageElement {\n    return this.data;\n  }\n\n  /**\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\n   */\n  public ready: Promise<HTMLImageElement>;\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\n\n  /**\n   * The path to the image, can also be a data url like 'data:image/'\n   * @param path {string} Path to the image resource relative from the HTML document hosting the game, or absolute\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by [[EngineOptions.antialiasing]]\n   */\n  constructor(public readonly path: string, bustCache: boolean = false, filtering?: ImageFiltering) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._filtering = filtering;\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\n    }\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\n      this._loadedResolve = resolve;\n    });\n  }\n\n  /**\n   * Begins loading the image and returns a promise that resolves when the image is loaded\n   */\n  async load(): Promise<HTMLImageElement> {\n    if (this.isLoaded()) {\n      return this.data;\n    }\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      image.setAttribute('data-original-src', this.path);\n      await image.decode();\n\n      // Set results\n      this.data = image;\n    } catch (error) {\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\n    }\n    TextureLoader.load(this.data, this._filtering);\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  /**\n   * Build a sprite from this ImageSource\n   */\n  public toSprite(): Sprite {\n    return Sprite.from(this);\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param tex\n   */\n  public static fromLegacyTexture(tex: Texture): ImageSource {\n    const image = new ImageSource(tex.path);\n    if (tex.isLoaded()) {\n      image.data = tex.data;\n    } else {\n      tex.loaded.then(() => {\n        image.data = tex.data;\n      });\n    }\n    return image;\n  }\n\n  /**\n   * Unload images from memory\n   */\n  unload(): void {\n    this.data = new Image();\n  }\n}\n","import { Sprite } from './Sprite';\nimport * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { Engine } from '../Engine';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @deprecated Use [[HasTick]]\n */\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\n/**\n * @hidden\n * @deprecated Use [[Animation]]\n */\nexport class AnimationImpl implements Drawable, HasTick {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _timeLeftInFrame: number = 0;\n  private _idempotencyToken: number = -1;\n\n  public anchor: Vector = Vector.Zero;\n  public rotation: number = 0.0;\n  public scale: Vector = Vector.One;\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  private _opacity = 1;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engineOrConfig  Reference to the current game engine\n   * @param sprites  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n    this._timeLeftInFrame = this.speed;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[SpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[SpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick(elapsed: number, idempotencyToken?: number) {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    this._timeLeftInFrame -= elapsed;\n    if (this._timeLeftInFrame <= 0) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._timeLeftInFrame = this.speed;\n    }\n\n    this._updateValues();\n    const current = this.sprites[this.currentFrame];\n    if (current) {\n      this.width = current.width;\n      this.height = current.height;\n      this.drawWidth = current.drawWidth;\n      this.drawHeight = current.drawHeight;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  /**\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the animation with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const animOptions = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      currSprite.draw(animOptions);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(animOptions);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\n/**\n * @deprecated Use [[Animation]]\n */\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n * @deprecated Use [[Animation]]\n */\n@obsolete({\n  message: 'Animation will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Animation'\n})\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\n/**\n * Enum representing the text direction, useful for other languages, or writing text in reverse\n */\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\n/**\n * Font rendering option\n */\nexport interface FontOptions {\n  /**\n   * Optionally the size of the font in the specified [[FontUnit]] by default 10.\n   */\n  size?: number;\n  /**\n   * Optionally specify unit to measure fonts in, by default Pixels\n   */\n  unit?: FontUnit;\n  /**\n   * Optionally specify the font family, by default 'sans-serif'\n   */\n  family?: string;\n  /**\n   * Optionally specify the font style, by default Normal\n   */\n  style?: FontStyle;\n  /**\n   * Optionally set whether the font is bold, by default false\n   */\n  bold?: boolean;\n  /**\n   * Optionally specify the text align, by default Left\n   */\n  textAlign?: TextAlign;\n  /**\n   * Optionally specify the text base align, by default Alphabetic\n   */\n  baseAlign?: BaseAlign;\n  /**\n   * Optionally specify the text direction, by default LeftToRight\n   */\n  direction?: Direction;\n  /**\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\n   * Higher quality text has a higher memory impact\n   */\n  quality?: number;\n  /**\n   * Optionally specify a text shadow, by default none is specified\n   */\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\n/**\n * @internal\n */\nexport interface FontRenderer {\n  measureText(text: string): BoundingBox;\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\nimport { Logger } from '..';\n\n\n/**\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\n * and have space between them.\n */\nexport interface SpriteSheetSpacingDimensions {\n  /**\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\n   * Default is (0, 0)\n   */\n  originOffset?: { x?: number, y?: number };\n\n  /**\n   * The margin between sprites.\n   * Default is (0, 0)\n   */\n  margin?: {x?: number, y?: number};\n}\n\n/**\n * Sprite sheet options for slicing up images\n */\nexport interface SpriteSheetGridOptions {\n  /**\n   * Source image to use for each sprite\n   */\n  image: ImageSource;\n  /**\n   * Grid definition for the sprite sheet\n   */\n  grid: {\n    /**\n     * Number of rows in the sprite sheet\n     */\n    rows: number;\n    /**\n     * Number of columns in the sprite sheet\n     */\n    columns: number;\n    /**\n     * Width of each individual sprite\n     */\n    spriteWidth: number;\n    /**\n     * Height of each individual sprite\n     */\n    spriteHeight: number;\n  };\n  /**\n   * Optionally specify any spacing information between sprites\n   */\n  spacing?: SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetOptions {\n  /**\n   * Source sprites for the sprite sheet\n   */\n  sprites: Sprite[];\n  /**\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\n   */\n  rows?: number;\n  /**\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\n   */\n  columns?: number;\n}\n\n/**\n * Represents a collection of sprites from a source image with some organization in a grid\n */\nexport class SpriteSheet {\n  private _logger = Logger.getInstance();\n  public readonly sprites: Sprite[] = [];\n  public readonly rows: number;\n  public readonly columns: number;\n\n  /**\n   * Build a new sprite sheet from a list of sprites\n   *\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\n   * @param options\n   */\n  constructor(options: SpriteSheetOptions) {\n    const { sprites, rows, columns } = options;\n    this.sprites = sprites;\n    this.rows = rows ?? 1;\n    this.columns = columns ?? this.sprites.length;\n  }\n\n  /**\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\n   * @param x\n   * @param y\n   */\n  public getSprite(x: number, y: number): Sprite | null {\n    if (x >= this.columns || x < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\n      return null;\n    }\n    if (y >= this.rows || y < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\n      return null;\n    }\n    const spriteIndex = x + y * this.columns;\n    return this.sprites[spriteIndex];\n  }\n\n  /**\n   * To a graphics sprite sheet from a legacy sprite sheet\n   */\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\n    return new SpriteSheet({\n      sprites\n    });\n  }\n\n  /**\n   * @deprecated\n   * @param spriteSheet\n   */\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\n    return new LegacySpriteSheet(sprites);\n  }\n\n  /**\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\n   *\n   * Example:\n   * ```\n   * const spriteSheet = SpriteSheet.fromImageSource({\n   *   image: imageSource,\n   *   grid: {\n   *     rows: 5,\n   *     columns: 2,\n   *     spriteWidth: 32, // pixels\n   *     spriteHeight: 32 // pixels\n   *   },\n   *   // Optionally specify spacing\n   *   spacing: {\n   *     // pixels from the top left to start the sprite parsing\n   *     originOffset: {\n   *       x: 5,\n   *       y: 5\n   *     },\n   *     // pixels between each sprite while parsing\n   *     margin: {\n   *       x: 1,\n   *       y: 1\n   *     }\n   *   }\n   * })\n   * ```\n   *\n   * @param options\n   */\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\n    const sprites: Sprite[] = [];\n    options.spacing = options.spacing ?? {};\n    const {\n      image,\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\n      spacing: { originOffset, margin }\n    } = options;\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\n    const marginDefaults = { x: 0, y: 0, ...margin};\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        sprites[x + y * cols] = new Sprite({\n          image: image,\n          sourceView: {\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\n            width: spriteWidth,\n            height: spriteHeight\n          },\n          destSize: { height: spriteHeight, width: spriteWidth }\n        });\n      }\n    }\n    return new SpriteSheet({\n      sprites: sprites,\n      rows: rows,\n      columns: cols\n    });\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\nimport { BoundingBox, Color } from '..';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritesheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text: string = '';\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n  }\n\n  private _alreadyWarnedAlphabet = false;\n  private _alreadyWarnedSpriteSheet = false;\n  private _getCharacterSprites(text: string): Sprite[] {\n    const results: Sprite[] = [];\n    // handle case insensitive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        if (!this._alreadyWarnedAlphabet) {\n          this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedAlphabet = true;\n        }\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        if (!this._alreadyWarnedSpriteSheet) {\n          this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedSpriteSheet = true;\n        }\n      }\n    }\n    return results;\n  }\n\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const sprites = this._getCharacterSprites(maxWidthLine);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    return BoundingBox.fromDimension(width, height * lines.length, Vector.Zero);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let xCursor = 0;\n    let yCursor = 0;\n    let height = 0;\n    const lines = this._text.split('\\n');\n    for (const line of lines) {\n      for (const sprite of this._getCharacterSprites(line)) {\n        // draw it in the right spot and increase the cursor by sprite width\n        sprite.draw(ex, x + xCursor, y + yCursor);\n        xCursor += sprite.width + this.spacing;\n        height = Math.max(height, sprite.height);\n      }\n      xCursor = 0;\n      yCursor += height;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, _color: Color, x: number, y: number) {\n    // SpriteFont doesn't support _color, yet...\n    this._text = text;\n    const bounds = this.measureText(text);\n    this.width = bounds.width;\n    this.height = bounds.height;\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\nimport { Vector } from '../..';\nimport debugFont from './debug-font.png';\n\n/**\n * Internal debugtext helper\n */\nexport class DebugText {\n  constructor() {\n    this.load();\n  }\n\n  /**\n   * base64 font\n   */\n  public readonly fontSheet = debugFont;\n  public size: number = 16;\n  private _imageSource: ImageSource;\n  private _spriteSheet: SpriteSheet;\n  private _spriteFont: SpriteFont;\n  public load() {\n    this._imageSource = new ImageSource(this.fontSheet);\n    return this._imageSource.load().then(() => {\n      this._spriteSheet = SpriteSheet.fromImageSource({\n        image: this._imageSource,\n        grid: {\n          rows: 3,\n          columns: 16,\n          spriteWidth: 16,\n          spriteHeight: 16\n        }\n      });\n      this._spriteFont = new SpriteFont({\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\n        caseInsensitive: true,\n        spriteSheet: this._spriteSheet,\n        spacing: -6\n      });\n    });\n  }\n\n  /**\n   * Writes debug text using the built in sprint font\n   * @param ctx\n   * @param text\n   * @param pos\n   */\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\n    if (this._imageSource.isLoaded()) {\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\n    }\n  }\n}\n","export default \"data:image/png;base64,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\"","export class RenderSource {\n  constructor(\n    private _gl: WebGLRenderingContext,\n    private _texture: WebGLTexture) {}\n\n  public use() {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\n  }\n\n  public disable() {\n    const gl = this._gl;\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","import { RenderSource } from './render-source';\n\nexport class RenderTarget {\n  width: number;\n  height: number;\n  private _gl: WebGLRenderingContext;\n  constructor(options: {gl: WebGLRenderingContext, width: number, height: number}) {\n    this.width = options.width;\n    this.height = options.height;\n    this._gl = options.gl;\n    this._setupFramebuffer();\n  }\n\n  setResolution(width: number, height: number) {\n    const gl = this._gl;\n    this.width = width;\n    this.height = height;\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n  }\n\n  private _frameBuffer: WebGLFramebuffer;\n  public get frameBuffer() {\n    return this._frameBuffer;\n  }\n  private _frameTexture: WebGLTexture;\n  public get frameTexture() {\n    return this._frameTexture;\n  }\n  private _setupFramebuffer() {\n    // Allocates frame buffer\n    const gl = this._gl;\n    this._frameTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n    // set the filtering so we don't need mips\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\n    // attach the texture as the first color attachment\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\n\n    // After this bind all draw calls will draw to this framebuffer texture\n    this._frameBuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\n    // Reset after initialized\n    this.disable();\n  }\n\n  public toRenderSource() {\n    const source = new RenderSource(this._gl, this._frameTexture);\n    return source;\n  }\n\n  /**\n   * When called, all drawing gets redirected to this render target\n   */\n  public use() {\n    const gl = this._gl;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    // very important to set the viewport to the size of the framebuffer texture\n    gl.viewport(0, 0, this.width, this.height);\n  }\n\n  /**\n   * When called, all drawing is sent back to the canvas\n   */\n  public disable() {\n    const gl = this._gl;\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","\n/**\n * Must be accessed after Engine construction time to ensure the context has been created\n */\nexport class ExcaliburWebGLContextAccessor {\n  private static _GL: WebGLRenderingContext;\n  public static clear() {\n    ExcaliburWebGLContextAccessor._GL = null;\n  }\n  public static register(gl: WebGLRenderingContext) {\n    ExcaliburWebGLContextAccessor._GL = gl;\n  }\n  // current webgl context\n  public static get gl(): WebGLRenderingContext {\n    if (!ExcaliburWebGLContextAccessor._GL) {\n      throw Error('Attempted gl access before init');\n    }\n    return ExcaliburWebGLContextAccessor._GL;\n  }\n}","import { Vector } from '../..';\nimport { Matrix } from '../../Math/matrix';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\n\nexport type UniformTypeNames =\n  'uniform1f' |\n  'uniform1i' |\n  'uniform2f' |\n  'uniform2i' |\n  'uniform3f' |\n  'uniform3i' |\n  'uniform4f' |\n  'uniform4i' |\n  'uniform1fv' |\n  'uniform1iv' |\n  'uniform2fv' |\n  'uniform2iv' |\n  'uniform3fv' |\n  'uniform3iv' |\n  'uniform4fv' |\n  'uniform4iv' |\n  'uniformMatrix2fv' |\n  'uniformMatrix3fv' |\n  'uniformMatrix4fv';\n\ntype RemoveFirstFromTuple<T extends any[]> =\n  T['length'] extends 0 ? undefined :\n    (((...b: T) => void) extends (a: any, ...b: infer I) => void ? I : [])\n\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>\n\nexport interface UniformDefinition {\n  name: string;\n  glType: number;\n  location: WebGLUniformLocation;\n}\n\n\nexport interface VertexAttributeDefinition {\n  /**\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\n   */\n  name: string;\n  /**\n   * Number of components for a given attribute\n   * Must be 1, 2, 3, or 4\n   *\n   * For example a vec4 attribute would be `4` floats, so 4\n   */\n  size: number;\n  /**\n   * Supported types in webgl 1\n   * * gl.BYTE\n   * * gl.SHORT\n   * * gl.UNSIGNED_BYTE\n   * * gl.UNSIGNED_SHORT\n   * * gl.FLOAT\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n   */\n  glType: number;\n  /**\n   * Is the attribute normalized between (0-1)\n   */\n  normalized: boolean;\n  /**\n   * Location index in the shader program\n   */\n  location: number;\n}\n\nexport interface ShaderOptions {\n  vertexSource: string;\n  fragmentSource: string;\n}\n\nexport class Shader {\n  private static _ACTIVE_SHADER_INSTANCE: Shader = null;\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  public program: WebGLProgram;\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\n  private _compiled = false;\n  public readonly vertexSource: string;\n  public readonly fragmentSource: string;\n\n  public get compiled() {\n    return this._compiled;\n  }\n\n  /**\n   * Create a shader program in excalibur\n   * @param options specify shader vertex and fragment source\n   */\n  constructor(options?: ShaderOptions) {\n    const { vertexSource, fragmentSource } = options;\n    this.vertexSource = vertexSource;\n    this.fragmentSource = fragmentSource;\n  }\n\n  /**\n   * Binds the shader program\n   */\n  use() {\n    const gl = this._gl;\n    gl.useProgram(this.program);\n    Shader._ACTIVE_SHADER_INSTANCE = this;\n  }\n\n  isCurrentlyBound() {\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\n  }\n\n  /**\n   * Compile the current shader against a webgl context\n   */\n  compile(): WebGLProgram {\n    const gl = this._gl;\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\n\n    const attributes = this.getAttributes();\n    for (const attribute of attributes) {\n      this.attributes[attribute.name] = attribute;\n    }\n    const uniforms = this.getUniforms();\n    for (const uniform of uniforms) {\n      this.uniforms[uniform.name] = uniform;\n    }\n\n    this._compiled = true;\n    return this.program;\n  }\n\n  getUniforms(): UniformDefinition[] {\n    const gl = this._gl;\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n    const uniforms: UniformDefinition[] = [];\n    for (let i = 0; i < uniformCount; i++) {\n      const uniform = gl.getActiveUniform(this.program, i);\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\n      uniforms.push({\n        name: uniform.name,\n        glType: uniform.type,\n        location: uniformLocation\n      });\n    }\n    return uniforms;\n  }\n\n  getAttributes(): VertexAttributeDefinition[] {\n    const gl = this._gl;\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n    const attributes: VertexAttributeDefinition[] = [];\n    for (let i = 0; i < attributeCount; i++) {\n      const attribute = gl.getActiveAttrib(this.program, i);\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\n      attributes.push({\n        name: attribute.name,\n        glType: getAttributePointerType(gl, attribute.type),\n        size: getAttributeComponentSize(gl, attribute.type),\n        location: attributeLocation,\n        normalized: false\n      });\n    }\n    return attributes;\n  }\n\n  /**\n   * Set a texture in a gpu texture slot\n   * @param slotNumber\n   * @param texture\n   */\n  setTexture(slotNumber: number, texture: WebGLTexture) {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n  }\n\n  /**\n   * Set an integer uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformInt(name: string, value: number) {\n    this.setUniform('uniform1i', name, ~~value);\n  }\n\n  /**\n   * Set an integer array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformIntArray(name: string, value: number[]) {\n    this.setUniform('uniform1iv', name, value);\n  }\n\n  /**\n   * Set a boolean uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformBoolean(name: string, value: boolean) {\n    this.setUniform('uniform1i', name, value ? 1 : 0);\n  }\n\n  /**\n   * Set a float uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloat(name: string, value: number) {\n    this.setUniform('uniform1f', name, value);\n  }\n\n  /**\n   * Set a float array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatArray(name: string, value: number[]) {\n    this.setUniform('uniform1fv', name, value);\n  }\n\n  /**\n   * Set a [[Vector]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatVector(name: string, value: Vector) {\n    this.setUniform('uniform2f', name, value.x, value.y);\n  }\n\n  /**\n   * Set an [[Matrix]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformMatrix(name: string, value: Matrix) {\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\n  }\n\n  /**\n   * Set any available uniform type in webgl\n   *\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\n   */\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\n    if (!this._compiled) {\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\n    }\n    if (!this.isCurrentlyBound()) {\n      throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\n      ' must call `shader.use()` before setting uniforms');\n    }\n    const gl = this._gl;\n    const location = gl.getUniformLocation(this.program, name);\n    if (location) {\n      const args = [location, ...value];\n      this._gl[uniformType].apply(this._gl, args);\n    } else {\n      throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,`+\n      ' unused uniforms are optimized away by most browsers');\n    }\n  }\n\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n    const program = gl.createProgram();\n    if (program === null) {\n      throw Error('Could not create graphics shader program');\n    }\n\n    // attach the shaders.\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n\n    // link the program.\n    gl.linkProgram(program);\n\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (!success) {\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\n    }\n\n    return program;\n  }\n\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\n    const shader = gl.createShader(type);\n    if (shader === null) {\n      throw Error(`Could not build shader: [${source}]`);\n    }\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n    if (!success) {\n      const errorInfo = gl.getShaderInfoLog(shader);\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\n    }\n    return shader;\n  }\n\n  private _processSourceForError(source: string, errorInfo: string) {\n    const lines = source.split('\\n');\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\n    const [_, error2] = errorInfo.slice(errorLineStart, errorLineEnd).split(':').map(v => Number(v));\n    for (let i = 0; i < lines.length; i++) {\n      lines[i] = `${i+1}: ${lines[i]}${error2 === (i+1)? ' <----- ERROR!' : ''}`;\n    }\n\n    return '\\n\\nSource:\\n' + lines.join('\\n');\n  }\n}","import { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\nexport interface VertexBufferOptions {\n  /**\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\n   *\n   * Ignored if data is passed directly\n   */\n  size?: number;\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  type?: 'static' | 'dynamic';\n\n  /**\n   * Optionally pass pre-seeded data, size parameter is ignored\n   */\n  data?: Float32Array\n}\n\n/**\n * Helper around vertex buffer to simplify creating and uploading geometry\n *\n * Under the hood uses Float32Array\n */\nexport class VertexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n\n  /**\n   * Access to the webgl buffer handle\n   */\n  public readonly buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the vertex buffer\n   */\n  public readonly bufferData: Float32Array;\n\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  public type: 'static' | 'dynamic' = 'dynamic';\n\n  constructor(options: VertexBufferOptions) {\n    const { size, type, data } = options;\n    this.buffer = this._gl.createBuffer();\n    if (!data && !size) {\n      throw Error('Must either provide data or a size to the VertexBuffer');\n    }\n\n    if (!data) {\n      this.bufferData = new Float32Array(size);\n    } else {\n      this.bufferData = data;\n    }\n    this.type = type ?? this.type;\n  }\n\n  /**\n   * Bind this vertex buffer\n   */\n  bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n  }\n\n  /**\n   * Upload vertex buffer geometry to the GPU\n   */\n  upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\n  }\n}","import { Logger } from '../..';\nimport { Shader, VertexAttributeDefinition } from './shader';\nimport { VertexBuffer } from './vertex-buffer';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getGlTypeSizeBytes } from './webgl-util';\n\n\nexport interface VertexLayoutOptions {\n  /**\n   * Shader that this layout will be for\n   */\n  shader: Shader;\n  /**\n   * Vertex buffer to use for vertex data\n   */\n  vertexBuffer: VertexBuffer,\n  /**\n   * Specify the attributes that will exist in the vertex buffer\n   *\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\n   */\n  attributes: [name: string, numberOfComponents: number][]\n}\n\n/**\n * Helper around creating vertex attributes in a given [[VertexBuffer]], this is useful for describing\n * the memory layout for your vertices inside a particular buffer\n *\n * Note: This helper assumes interleaved attributes in one [[VertexBuffer]], not many.\n *\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\n */\nexport class VertexLayout {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger = Logger.getInstance();\n  private _shader: Shader;\n  private _layout: VertexAttributeDefinition[] = [];\n  private _attributes: [name: string, numberOfComponents: number][] = [];\n  private _vertexBuffer: VertexBuffer;\n  public get vertexBuffer() {\n    return this._vertexBuffer;\n  }\n\n  public get attributes(): readonly [name: string, numberOfComponents: number][] {\n    return this._attributes;\n  }\n\n  constructor(options: VertexLayoutOptions) {\n    const {shader, vertexBuffer, attributes} = options;\n    this._vertexBuffer = vertexBuffer;\n    this._attributes = attributes;\n    this._shader = shader;\n    this.initialize();\n  }\n\n  private _vertexTotalSizeBytes = 0;\n  /**\n   * Total number of bytes that the vertex will take up\n   */\n  public get totalVertexSizeBytes(): number {\n    return this._vertexTotalSizeBytes;\n  }\n\n  /**\n   * Layouts need shader locations and must be bound to a shader\n   */\n  initialize() {\n    if (!this._shader.compiled) {\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\n    }\n    this._layout.length = 0;\n    const shaderAttributes = this._shader.attributes;\n    for (const attribute of this._attributes) {\n      const attrib = shaderAttributes[attribute[0]];\n      if (!attrib) {\n        throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}`+\n        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\n      }\n      if (attrib.size !== attribute[1]) {\n        throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],`\n        +` doesnt match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\n      }\n      this._layout.push(attrib);\n    }\n\n    // calc size\n    let componentsPerVertex = 0;\n    for (const vertAttribute of this._layout) {\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\n      componentsPerVertex += vertAttribute.size;\n    }\n\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\n      this._logger.warn(`The vertex component size (${componentsPerVertex})  does divide evenly into the specified vertex buffer`\n      +` (${this._vertexBuffer.bufferData.length})`);\n    }\n  }\n\n  /**\n   * Bind this layout with it's associated vertex buffer\n   *\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\n   */\n  use(uploadBuffer = false) {\n    const gl = this._gl;\n    if (!this._shader.isCurrentlyBound()) {\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\n    }\n    this._vertexBuffer.bind();\n    if (uploadBuffer) {\n      this._vertexBuffer.upload();\n    }\n    let offset = 0;\n    // TODO switch to VAOs if the extension is\n    for (const vert of this._layout) {\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\n      gl.enableVertexAttribArray(vert.location);\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\n    }\n  }\n}","export class GraphicsDiagnostics {\n  public static DrawCallCount: number = 0;\n  public static DrawnImagesCount: number = 0;\n  public static clear(): void {\n    GraphicsDiagnostics.DrawCallCount = 0;\n    GraphicsDiagnostics.DrawnImagesCount = 0;\n  }\n}\n","import { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport lineVertexSource from './line-vertex.glsl';\nimport lineFragmentSource from './line-fragment.glsl';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class LineRenderer implements RendererPlugin {\n  public readonly type = 'ex.line';\n  public priority: number = 0;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _maxLines: number = 10922;\n  private _vertexBuffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _vertexIndex = 0;\n  private _lineCount = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: lineVertexSource,\n      fragmentSource: lineFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    this._vertexBuffer = new VertexBuffer({\n      size: 6 * 2 * this._maxLines,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      vertexBuffer: this._vertexBuffer,\n      shader: this._shader,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4]\n      ]\n    });\n  }\n\n  draw(start: Vector, end: Vector, color: Color): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._lineCount++;\n\n    const transform = this._context.getTransform();\n    const finalStart = transform.multiply(start);\n    const finalEnd = transform.multiply(end);\n\n\n    const vertexBuffer = this._vertexBuffer.bufferData;\n    // Start\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n\n    // End\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n  }\n\n  private _isFull() {\n    if (this._lineCount >= this._maxLines) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._lineCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._lineCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\n\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // reset\n    this._vertexIndex = 0;\n    this._lineCount = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\n\\nvarying lowp vec4 v_color;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Passthrough the color\\n   v_color = a_color;\\n}\";","export default \"precision mediump float;\\n\\n// Color\\nvarying lowp vec4 v_color;\\n\\n\\nvoid main() {\\n  gl_FragColor = v_color;\\n}\";","import pointVertexSource from './point-vertex.glsl';\nimport pointFragmentSource from './point-fragment.glsl';\nimport { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class PointRenderer implements RendererPlugin {\n  public readonly type = 'ex.point';\n  public priority: number = 0;\n  private _shader: Shader;\n  private _maxPoints: number = 10922;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _pointCount: number = 0;\n  private _vertexIndex: number = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: pointVertexSource,\n      fragmentSource: pointFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n    this._buffer = new VertexBuffer({\n      size: 7 * this._maxPoints,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4],\n        ['a_size', 1]\n      ]\n    });\n  }\n\n  draw(point: Vector, color: Color, size: number): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._pointCount++;\n\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const finalPoint = transform.multiply(point);\n\n    const vertexBuffer = this._buffer.bufferData;\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\n  }\n\n  private _isFull() {\n    if (this._pointCount >= this._maxPoints) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._pointCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._pointCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    this._pointCount = 0;\n    this._vertexIndex = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\nattribute float a_size;\\nvarying lowp vec4 v_color;\\nuniform mat4 u_matrix;\\n\\nvoid main() {\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n  gl_PointSize = a_size * 2.0;\\n  v_color = a_color;\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision mediump float;\\nvarying lowp vec4 v_color;\\n\\nvoid main() {\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\n  r = dot(cxy, cxy);\\n\\n#ifdef GL_OES_standard_derivatives\\n  delta = fwidth(r);\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\n#else\\n  if (r > 1.0) {\\n    discard;\\n  }\\n#endif\\n  // \\\"premultiply\\\" the color by alpha\\n  vec4 color = v_color;\\n  color.a = color.a * alpha;\\n  color.rgb = color.rgb * color.a;\\n  gl_FragColor = color;\\n}\";","\nimport screenVertex from './screen-vertex.glsl';\nimport screenFragment from './screen-fragment.glsl';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\n\n/**\n * This is responsible for painting the entire screen during the render passes\n */\nexport class ScreenPassPainter {\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(gl: WebGLRenderingContext) {\n    this._gl = gl;\n    this._shader = new Shader({\n      vertexSource: screenVertex,\n      fragmentSource: screenFragment\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\n    const gl = this._gl;\n    postprocessor.getShader().use();\n    postprocessor.getLayout().use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  renderToScreen(): void {\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}","export default \"attribute vec2 a_position;\\n\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\nvoid main() {\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\n\\n  // Pass the texcoord to the fragment shader.\\n  v_texcoord = a_texcoord;\\n}\";","export default \"precision mediump float;\\n\\n// Passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// The texture.\\nuniform sampler2D u_texture;\\n\\nvoid main() {\\n   gl_FragColor = texture2D(u_texture, v_texcoord);\\n}\";","import { Logger } from '../..';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\n/**\n * Helper that defines and index buffer for quad geometry\n *\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\n * it is almost always worth it in terms of performance to use an index buffer.\n */\nexport class QuadIndexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Access to the webgl buffer handle\n   */\n  public buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the index buffer\n   */\n  public bufferData: Uint16Array | Uint32Array;\n  /**\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\n   */\n  public bufferGlType: number;\n\n  /**\n   * @param numberOfQuads Specify the max number of quads you want to draw\n   * @param useUint16 Optionally force a uint16 buffer\n   */\n  constructor(numberOfQuads: number, useUint16?: boolean) {\n    const gl = this._gl;\n    this.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n\n    const totalVertices = numberOfQuads * 6;\n\n    const ext = gl.getExtension('OES_element_index_uint');\n    if (ext && !useUint16) {\n      this.bufferData = new Uint32Array(totalVertices);\n    } else {\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\n      const maxUint16 = 65_535;\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\n\n      this.bufferGlType = gl.UNSIGNED_SHORT;\n      this.bufferData = new Uint16Array(totalVertices);\n      // TODO Should we error if this happens?? maybe not might crash mid game\n      if (numberOfQuads > maxUint16Index) {\n        this._logger.warn(\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\n      }\n    }\n\n\n    let currentQuad = 0;\n    for (let i = 0; i < totalVertices; i += 6) {\n      // first triangle\n      this.bufferData[i + 0] = currentQuad + 0;\n      this.bufferData[i + 1] = currentQuad + 1;\n      this.bufferData[i + 2] = currentQuad + 2;\n      // second triangle\n      this.bufferData[i + 3] = currentQuad + 2;\n      this.bufferData[i + 4] = currentQuad + 1;\n      this.bufferData[i + 5] = currentQuad + 3;\n      currentQuad += 4;\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  public get size() {\n    return this.bufferData.length;\n  }\n\n  /**\n   * Upload data to the GPU\n   */\n  public upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  /**\n   * Bind this index buffer\n   */\n  public bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n  }\n}","import { vec } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { TextureLoader } from '../texture-loader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { ensurePowerOfTwo } from '../webgl-util';\nimport frag from './image-renderer.frag.glsl';\nimport vert from './image-renderer.vert.glsl';\n\nexport class ImageRenderer implements RendererPlugin {\n  public readonly type = 'ex.image';\n  public priority: number = 0;\n\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\n  private _maxTextures: number = 0;\n\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  // Per flush vars\n  private _imageCount: number = 0;\n  private _textures: WebGLTexture[] = [];\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    // Transform shader source\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\n    this._maxTextures = Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS), 125);\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\n    // Compile shader\n    this._shader = new Shader({\n      fragmentSource: transformedFrag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\n    this._shader.setUniformIntArray(\n      'u_textures',\n      [...Array(this._maxTextures)].map((_, i) => i)\n    );\n\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      size: 6 * 4 * this._maxImages, // 6 components * 4 verts\n      type: 'dynamic'\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_opacity', 1],\n        ['a_texcoord', 2],\n        ['a_textureIndex', 1]\n      ]\n    });\n\n    // Setup index buffer\n    this._quads = new QuadIndexBuffer(this._maxImages, true);\n  }\n\n  private _transformFragmentSource(source: string, maxTextures: number): string {\n    let newSource = source.replace('%%count%%', maxTextures.toString());\n    let texturePickerBuilder = '';\n    for (let i = 0; i < maxTextures; i++) {\n      if (i === 0) {\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\n      } else {\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\n      }\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\n      texturePickerBuilder += `   }\\n`;\n    }\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\n    return newSource;\n  }\n\n  private _addImageAsTexture(image: HTMLImageSource) {\n    const texture = TextureLoader.load(image);\n    if (this._textures.indexOf(texture) === -1) {\n      this._textures.push(texture);\n    }\n  }\n\n  private _bindTextures(gl: WebGLRenderingContext) {\n    // Bind textures in the correct order\n    for (let i = 0; i < this._maxTextures; i++) {\n      gl.activeTexture(gl.TEXTURE0 + i);\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\n    }\n  }\n\n  private _getTextureIdForImage(image: HTMLImageSource) {\n    if (image) {\n      return this._textures.indexOf(TextureLoader.get(image));\n    }\n    return -1;\n  }\n\n  private _isFull() {\n    if (this._imageCount >= this._maxImages) {\n      return true;\n    }\n    if (this._textures.length >= this._maxTextures) {\n      return true;\n    }\n    return false;\n  }\n\n\n  draw(image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number): void {\n\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._imageCount++;\n    this._addImageAsTexture(image);\n\n    let width = image?.width || swidth || 0;\n    let height = image?.height || sheight || 0;\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n    let dest = [sx ?? 1, sy ?? 1];\n    // If destination is specified, update view and dest\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n      dest = [dx, dy];\n      width = dwidth;\n      height = dheight;\n    }\n\n    sx = view[0];\n    sy = view[1];\n    const sw = view[2];\n    const sh = view[3];\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n    const snapToPixel = this._context.snapToPixel;\n\n    let topLeft = vec(dest[0], dest[1]);\n    let topRight = vec(dest[0] + width, dest[1]);\n    let bottomLeft = vec(dest[0], dest[1] + height);\n    let bottomRight = vec(dest[0] + width, dest[1] + height);\n\n    topLeft = transform.multiply(topLeft);\n    topRight = transform.multiply(topRight);\n    bottomLeft = transform.multiply(bottomLeft);\n    bottomRight = transform.multiply(bottomRight);\n\n    if (snapToPixel) {\n      topLeft.x = ~~topLeft.x;\n      topLeft.y = ~~topLeft.y;\n\n      topRight.x = ~~topRight.x;\n      topRight.y = ~~topRight.y;\n\n      bottomLeft.x = ~~bottomLeft.x;\n      bottomLeft.y = ~~bottomLeft.y;\n\n      bottomRight.x = ~~bottomRight.x;\n      bottomRight.y = ~~bottomRight.y;\n    }\n\n    const textureId = this._getTextureIdForImage(image);\n    const potWidth = ensurePowerOfTwo(image.width || width);\n    const potHeight = ensurePowerOfTwo(image.height || height);\n\n    const uvx0 = (sx) / potWidth;\n    const uvy0 = (sy) / potHeight;\n    const uvx1 = (sx + sw - 0.01) / potWidth;\n    const uvy1 = (sy + sh - 0.01) / potHeight;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._imageCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._imageCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind textures to\n    this._bindTextures(gl);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._imageCount = 0;\n    this._vertexIndex = 0;\n    this._textures.length = 0;\n  }\n}","export default \"precision mediump float;\\n\\n// UV coord\\nvarying vec2 v_texcoord;\\n\\n// Texture index\\nvarying lowp float v_textureIndex;\\n\\n// Textures in the current draw\\nuniform sampler2D u_textures[%%count%%];\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n   // In order to support the most efficient sprite batching, we have multiple\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\n   // that do not apply to a particular sprite.\\n\\n   vec4 color = vec4(1.0, 0, 0, 1.0);\\n\\n   // GLSL is templated out to pick the right texture and set the vec4 color\\n   %%texture_picker%%\\n\\n   color.rgb = color.rgb * v_opacity;\\n   color.a = color.a * v_opacity;\\n   gl_FragColor = color;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\n// UV coordinate\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\n// Texture number\\nattribute lowp float a_textureIndex;\\nvarying lowp float v_textureIndex;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the UV coord to the fragment shader\\n   v_texcoord = a_texcoord;\\n   // Pass through the texture number to the fragment shader\\n   v_textureIndex = a_textureIndex;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './rectangle-renderer.frag.glsl';\nimport vert from './rectangle-renderer.vert.glsl';\n\nexport class RectangleRenderer implements RendererPlugin {\n  public readonly type = 'ex.rectangle';\n  public priority: number = 0;\n\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n  private _rectangleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 16 * 4 * this._maxRectangles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_size', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n    this._quads = new QuadIndexBuffer(this._maxRectangles, true);\n  }\n\n  private _isFull() {\n    if (this._rectangleCount >= this._maxRectangles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(...args: any[]): void {\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\n      this.drawLine.apply(this, args);\n    } else {\n      this.drawRectangle.apply(this, args);\n    }\n  }\n\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\n\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const dir = end.sub(start);\n    const length = dir.size;\n    const normal = dir.normalize().perpendicular();\n    const halfThick = thickness / 2;\n\n    /**\n     *    +---------------------^----------------------+\n     *    |                     | (normal)             |\n     *   (startx, starty)------------------>(endx, endy)\n     *    |                                            |\n     *    + -------------------------------------------+\n     */\n    const startTop = transform.multiply(normal.scale(halfThick).add(start));\n    const startBottom = transform.multiply(normal.scale(-halfThick).add(start));\n    const endTop = transform.multiply(normal.scale(halfThick).add(end));\n    const endBottom = transform.multiply(normal.scale(-halfThick).add(end));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    const stroke = Color.Transparent;\n    const strokeThickness = 0;\n    const width = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = startTop.x;\n    vertexBuffer[this._vertexIndex++] = startTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = endTop.x;\n    vertexBuffer[this._vertexIndex++] = endTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n  }\n\n  drawRectangle(\n    pos: Vector,\n    width: number,\n    height: number,\n    color: Color,\n    stroke: Color = Color.Transparent,\n    strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n  }\n\n  hasPendingDraws(): boolean {\n    return this._rectangleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._rectangleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._rectangleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision mediump float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\nvarying vec2 v_size; // in pixels\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness; // in pixels\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\n    vec2 uv = v_uv;\\n    vec2 fragCoord = uv * v_size;\\n    float maxX = v_size.x - v_strokeThickness;\\n    float minX = v_strokeThickness;\\n    float maxY = v_size.y - v_strokeThickness;\\n    float minY = v_strokeThickness;\\n\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\n      gl_FragColor = v_color;\\n    } else {\\n      gl_FragColor = v_strokeColor;\\n    }\\n    gl_FragColor.a *= v_opacity;\\n    gl_FragColor.rgb *= gl_FragColor.a;\\n\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\n\\n    // float fHalfBorderDist      = 0.0;\\n    // float fHalfBorderThickness = 0.0;\\n\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else\\n    // {\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\n        \\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\n            \\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\n    // }\\n\\n    // vec4 v4FromColor = v_strokeColor;\\n    // v4FromColor.rgb *= v4FromColor.a;\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\n    // if (fHalfBorderDist < 0.0) {\\n    //     v4ToColor = v_color;\\n    //     v4ToColor.rgb *= v4ToColor.a;\\n    // }\\n\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\n\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\n    // gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\nattribute vec2 a_size;\\nvarying vec2 v_size;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through size\\n   v_size = a_size;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './circle-renderer.frag.glsl';\nimport vert from './circle-renderer.vert.glsl';\n\nexport class CircleRenderer implements RendererPlugin {\n  public readonly type = 'ex.circle';\n  public priority: number = 0;\n\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  private _circleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 14 * 4 * this._maxCircles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n\n    this._quads = new QuadIndexBuffer(this._maxCircles, true);\n  }\n\n  private _isFull() {\n    if (this._circleCount >= this._maxCircles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._circleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\n\n    // TODO UV could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._circleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._circleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._circleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision highp float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness;\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n  // make (0, 0) the center the uv \\n  vec2 uv = v_uv * 2.0 - 1.0;\\n\\n  vec4 color = v_color;\\n  vec4 strokeColor = v_strokeColor;\\n\\n  // circle border is at radius 1.0 \\n  // dist is > 0 when inside the circle \\n  float d = length(uv);\\n  float dist = 1.0 - length(uv);\\n\\n  // Fade based on fwidth\\n  float fade = fwidth(dot(uv, uv));\\n\\n  // if dist is greater than 0 step to 1;\\n  // when we cross this 0 threshold add a smooth fade\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\n\\n  // if dist is greater than the stroke thickness step to 1\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\n\\n  strokeColor.a *= fill * stroke;\\n  strokeColor.rgb *= strokeColor.a;\\n\\n  color.a *= fill * (1.0 - stroke);\\n  color.rgb *= color.a;\\n\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\n  finalColor.a = finalColor.a * v_opacity;\\n  gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  RectGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\n\nimport { Matrix } from '../../Math/matrix';\nimport { TransformStack } from './transform-stack';\nimport { Vector, vec } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { Logger } from '../../Util/Log';\nimport { Canvas } from '../Canvas';\nimport { DebugText } from './debug-text';\nimport { ScreenDimension } from '../../Screen';\nimport { RenderTarget } from './render-target';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { TextureLoader } from './texture-loader';\nimport { RendererPlugin } from './renderer';\n\n// renderers\nimport { LineRenderer } from './line-renderer/line-renderer';\nimport { PointRenderer } from './point-renderer/point-renderer';\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\nimport { ImageRenderer } from './image-renderer/image-renderer';\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\n\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\n\n  /**\n   * Draw a debugging rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\n  }\n\n  /**\n   * Draw a debugging line to the context\n   * @param start\n   * @param end\n   * @param lineOptions\n   */\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions.color);\n  }\n\n  /**\n   * Draw a debugging point to the context\n   * @param point\n   * @param pointOptions\n   */\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._webglCtx, text, pos);\n  }\n}\n\nexport interface WebGLGraphicsContextInfo {\n  transform: TransformStack;\n  state: StateStack;\n  ortho: Matrix;\n  context: ExcaliburGraphicsContextWebGL;\n}\n\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\n  private _logger = Logger.getInstance();\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\n  private _isDrawLifecycle = false;\n\n  // Main render target\n  private _renderTarget: RenderTarget;\n\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\n  private _postProcessTargets: RenderTarget[] = [];\n\n  private _screenRenderer: ScreenPassPainter;\n\n  private _postprocessors: PostProcessor[] = [];\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __gl: WebGLRenderingContext;\n\n  /**\n   * Holds the 2d context shim\n   */\n  private _canvas: Canvas; // Configure z for shim?\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n\n  private _transform = new TransformStack();\n  private _state = new StateStack();\n  private _ortho!: Matrix;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __lineRenderer: LineRenderer;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  // public __imageRenderer: ImageRenderer;\n\n  public snapToPixel: boolean = true;\n\n  public smoothing: boolean = false;\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public get width() {\n    return this.__gl.canvas.width;\n  }\n\n  public get height() {\n    return this.__gl.canvas.height;\n  }\n\n  public get ortho(): Matrix {\n    return this._ortho;\n  }\n\n  /**\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\n   * @param dim\n   */\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\n    let supported = true;\n    if (dim.width > 4096 || dim.height > 4096) {\n      supported = false;\n    }\n    return supported;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\n    this.__gl = canvasElement.getContext('webgl', {\n      antialias: smoothing ?? this.smoothing,\n      premultipliedAlpha: false,\n      alpha: enableTransparency ?? true,\n      depth: true,\n      powerPreference: 'high-performance'\n    });\n    ExcaliburWebGLContextAccessor.register(this.__gl);\n    TextureLoader.register(this.__gl);\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this._init();\n  }\n\n  private _init() {\n    const gl = this.__gl;\n    // Setup viewport and view matrix\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n    // Clear background\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    // Enable alpha blending\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\n    gl.enable(gl.BLEND);\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n    // Setup builtin renderers\n    this.register(new ImageRenderer());\n    this.register(new RectangleRenderer());\n    this.register(new CircleRenderer());\n    this.register(new PointRenderer());\n    this.register(new LineRenderer());\n\n    this._screenRenderer = new ScreenPassPainter(gl);\n\n    this._renderTarget = new RenderTarget({\n      gl,\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n\n\n    this._postProcessTargets = [\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      }),\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      })\n    ];\n\n    // 2D ctx shim\n    this._canvas = new Canvas({\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n    this.__ctx = this._canvas.ctx;\n  }\n\n  public register<T extends RendererPlugin>(renderer: T) {\n    this._renderers.set(renderer.type, renderer);\n    renderer.initialize(this.__gl, this);\n  }\n\n  public get(rendererName: string): RendererPlugin {\n    return this._renderers.get(rendererName);\n  }\n\n  private _currentRenderer: RendererPlugin;\n\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\n      return true;\n    }\n    return false;\n  }\n\n  public beginDrawLifecycle() {\n    this._isDrawLifecycle = true;\n  }\n\n  public endDrawLifecycle() {\n    this._isDrawLifecycle = false;\n  }\n\n  private _alreadyWarnedDrawLifecycle = false;\n\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\n    if (!this._isDrawLifecycle && !this._alreadyWarnedDrawLifecycle) {\n      this._logger.warn(\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\n        `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\n      this._alreadyWarnedDrawLifecycle = true;\n    }\n    // TODO does not handle priority yet...\n    //  in order to do this draw commands need to be captured and fed in priority order\n    const renderer = this._renderers.get(rendererName);\n    if (renderer) {\n      // Set the current renderer if not defined\n      if (!this._currentRenderer) {\n        this._currentRenderer = renderer;\n      }\n\n      if (!this._isCurrentRenderer(renderer)) {\n        // switching graphics means we must flush the previous\n        this._currentRenderer.flush();\n      }\n\n      // If we are still using the same renderer we can add to the current batch\n      renderer.draw(...args);\n\n      this._currentRenderer = renderer;\n    } else {\n      throw Error(`No renderer with name ${rendererName} has been registered`);\n    }\n  }\n\n  public resetTransform(): void {\n    this._transform.current = Matrix.identity();\n  }\n\n  public updateViewport(resolution: ScreenDimension): void {\n    const gl = this.__gl;\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\n\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\n\n    // 2D ctx shim\n    this._canvas.width = gl.canvas.width;\n    this._canvas.height = gl.canvas.height;\n  }\n\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    if (!image) {\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\n      // tslint:disable-next-line: no-console\n      if (console.trace) {\n        // tslint:disable-next-line: no-console\n        console.trace();\n      }\n      return;\n    }\n    this.draw<ImageRenderer>('ex.image', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\n  }\n\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\n\n  public save(): void {\n    this._transform.save();\n    this._state.save();\n  }\n\n  public restore(): void {\n    this._transform.restore();\n    this._state.restore();\n  }\n\n  public translate(x: number, y: number): void {\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  public rotate(angle: number): void {\n    this._transform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): void {\n    this._transform.scale(x, y);\n  }\n\n  public transform(matrix: Matrix) {\n    this._transform.current = matrix;\n  }\n\n  public getTransform(): Matrix {\n    return this._transform.current;\n  }\n\n  public multiply(m: Matrix) {\n    this._transform.current = this._transform.current.multiply(m);\n  }\n\n  public addPostProcessor(postprocessor: PostProcessor) {\n    this._postprocessors.push(postprocessor);\n    postprocessor.initialize(this.__gl);\n  }\n\n  public removePostProcessor(postprocessor: PostProcessor) {\n    const index = this._postprocessors.indexOf(postprocessor);\n    if (index !== -1) {\n      this._postprocessors.splice(index, 1);\n    }\n  }\n\n  public clearPostProcessors() {\n    this._postprocessors.length = 0;\n  }\n\n  clear() {\n    const gl = this.__gl;\n    this._renderTarget.use();\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    // Clear the context with the newly set color. This is\n    // the function call that actually does the drawing.\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  }\n\n  /**\n   * Flushes all batched rendering to the screen\n   */\n  flush() {\n    const gl = this.__gl;\n\n    // render target captures all draws and redirects to the render target\n    this._renderTarget.use();\n    // This is the final flush at the moment to draw any leftover pending draw\n    // TODO sort by priority and flush in order\n    for (const renderer of this._renderers.values()) {\n      if (renderer.hasPendingDraws()) {\n        renderer.flush();\n      }\n    }\n    this._renderTarget.disable();\n\n    // post process step\n    const source = this._renderTarget.toRenderSource();\n    source.use();\n\n    // flip flop render targets\n    for (let i = 0; i < this._postprocessors.length; i++) {\n      this._postProcessTargets[i % 2].use();\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\n      this._postProcessTargets[i % 2].toRenderSource().use();\n    }\n\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    this._screenRenderer.renderToScreen();\n  }\n}\n","import { Vector, vec } from './Math/vector';\nimport { Logger } from './Util/Log';\nimport { Camera } from './Camera';\nimport { BrowserEvents } from './Util/Browser';\nimport { BoundingBox } from './Collision/Index';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { getPosition } from './Util/Util';\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\n\n/**\n * Enum representing the different display modes available to Excalibur.\n */\nexport enum DisplayMode {\n  /**\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\n   */\n  Fixed = 'Fixed',\n\n  /**\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\n   *\n   * You may want to center your game here is an example\n   * ```html\n   * <!-- html -->\n   * <body>\n   * <main>\n   *   <canvas id=\"game\"></canvas>\n   * </main>\n   * </body>\n   * ```\n   *\n   * ```css\n   * // css\n   * main {\n   *   display: flex;\n   *   align-items: center;\n   *   justify-content: center;\n   *   height: 100%;\n   *   width: 100%;\n   * }\n   * ```\n   *\n   */\n  FitScreen = 'FitScreen',\n\n  /**\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\n   */\n  FillScreen = 'FillScreen',\n\n  /**\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\n   */\n  FitContainer = 'FitContainer',\n\n  /**\n   * Use the parent DOM container's css width/height for the game resolution dynamically\n   */\n  FillContainer = 'FillContainer',\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\n   */\n  Position = 'Position'\n}\n\n/**\n * Convenience class for quick resolutions\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\n */\nexport class Resolution {\n  /* istanbul ignore next */\n  public static get SVGA(): ScreenDimension {\n    return { width: 800, height: 600 };\n  }\n\n  /* istanbul ignore next */\n  public static get Standard(): ScreenDimension {\n    return { width: 1920, height: 1080 };\n  }\n\n  /* istanbul ignore next */\n  public static get Atari2600(): ScreenDimension {\n    return { width: 160, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoy(): ScreenDimension {\n    return { width: 160, height: 144 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoyAdvance(): ScreenDimension {\n    return { width: 240, height: 160 };\n  }\n\n  /* istanbul ignore next */\n  public static get NintendoDS(): ScreenDimension {\n    return { width: 256, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get NES(): ScreenDimension {\n    return { width: 256, height: 224 };\n  }\n\n  /* istanbul ignore next */\n  public static get SNES(): ScreenDimension {\n    return { width: 256, height: 244 };\n  }\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\nexport type CanvasPosition = string | AbsolutePosition;\n\nexport interface ScreenDimension {\n  width: number;\n  height: number;\n}\n\nexport interface ScreenOptions {\n  /**\n   * Canvas element to build a screen on\n   */\n  canvas: HTMLCanvasElement;\n\n  /**\n   * Graphics context for the screen\n   */\n  context: ExcaliburGraphicsContext;\n\n  /**\n   * Browser abstraction\n   */\n  browser: BrowserEvents;\n  /**\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\n   */\n  antialiasing?: boolean;\n  /**\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\n   */\n  pixelRatio?: number;\n  /**\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\n   * [[DisplayMode.FillScreen]].\n   */\n  resolution?: ScreenDimension;\n  /**\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\n   */\n  viewport: ScreenDimension;\n  /**\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\n   */\n  displayMode?: DisplayMode;\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: CanvasPosition;\n}\n\n/**\n * The Screen handles all aspects of interacting with the screen for Excalibur.\n */\nexport class Screen {\n  public graphicsContext: ExcaliburGraphicsContext;\n  private _canvas: HTMLCanvasElement;\n  private _antialiasing: boolean = true;\n  private _browser: BrowserEvents;\n  private _camera: Camera;\n  private _resolution: ScreenDimension;\n  private _resolutionStack: ScreenDimension[] = [];\n  private _viewport: ScreenDimension;\n  private _viewportStack: ScreenDimension[] = [];\n  private _pixelRatioOverride: number | null = null;\n  private _position: CanvasPosition;\n  private _displayMode: DisplayMode;\n  private _isFullScreen = false;\n  private _mediaQueryList: MediaQueryList;\n  private _isDisposed = false;\n  private _logger = Logger.getInstance();\n  private _resizeObserver: ResizeObserver;\n\n  constructor(options: ScreenOptions) {\n    this.viewport = options.viewport;\n    this.resolution = options.resolution ?? { ...this.viewport };\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\n    this._canvas = options.canvas;\n    this.graphicsContext = options.context;\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\n    this._browser = options.browser;\n    this._position = options.position;\n    this._pixelRatioOverride = options.pixelRatio;\n\n    this._applyDisplayMode();\n\n    this._listenForPixelRatio();\n\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    this.applyResolutionAndViewport();\n  }\n\n  private _listenForPixelRatio() {\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\n      // Safari <=13.1 workaround, remove any existing handlers\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n    }\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n\n    // Safari <=13.1 workaround\n    if (this._mediaQueryList.addEventListener) {\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\n    } else {\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\n    }\n  }\n\n  public dispose(): void {\n    if (!this._isDisposed) {\n      // Clean up handlers\n      this._isDisposed = true;\n      this._browser.window.off('resize', this._resizeHandler);\n      if (this._resizeObserver) {\n        this._resizeObserver.disconnect();\n      }\n      this.parent.removeEventListener('resize', this._resizeHandler);\n      // Safari <=13.1 workaround\n      if (this._mediaQueryList.removeEventListener) {\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\n      } else {\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n      }\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    }\n  }\n\n  private _fullscreenChangeHandler = () => {\n    this._isFullScreen = !this._isFullScreen;\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\n  };\n\n  private _pixelRatioChangeHandler = () => {\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\n    this._listenForPixelRatio();\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\n    this.applyResolutionAndViewport();\n  };\n\n  private _resizeHandler = () => {\n    const parent = this.parent;\n    this._logger.debug('View port resized');\n    this._setResolutionAndViewportByDisplayMode(parent);\n    this.applyResolutionAndViewport();\n  };\n\n  private _calculateDevicePixelRatio() {\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    return devicePixelRatio;\n  }\n\n  // Asking the window.devicePixelRatio is expensive we do it once\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\n\n  public get pixelRatio(): number {\n    if (this._pixelRatioOverride) {\n      return this._pixelRatioOverride;\n    }\n\n    return this._devicePixelRatio;\n  }\n\n  public get isHiDpi() {\n    return this.pixelRatio !== 1;\n  }\n\n  public get displayMode(): DisplayMode {\n    return this._displayMode;\n  }\n\n  public get canvas(): HTMLCanvasElement {\n    return this._canvas;\n  }\n\n  public get parent(): HTMLElement | Window {\n    return <HTMLElement | Window>(\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\n        ? this.canvas.parentElement || document.body\n        : window)\n    );\n  }\n\n  public get resolution(): ScreenDimension {\n    return this._resolution;\n  }\n\n  public set resolution(resolution: ScreenDimension) {\n    this._resolution = resolution;\n  }\n\n  public get viewport(): ScreenDimension {\n    if (this._viewport) {\n      return this._viewport;\n    }\n    return this._resolution;\n  }\n\n  public set viewport(viewport: ScreenDimension) {\n    this._viewport = viewport;\n  }\n\n  public get aspectRatio() {\n    return this._resolution.width / this._resolution.height;\n  }\n\n  public get scaledWidth() {\n    return this._resolution.width * this.pixelRatio;\n  }\n\n  public get scaledHeight() {\n    return this._resolution.height * this.pixelRatio;\n  }\n\n  public setCurrentCamera(camera: Camera) {\n    this._camera = camera;\n  }\n\n  public pushResolutionAndViewport() {\n    this._resolutionStack.push(this.resolution);\n    this._viewportStack.push(this.viewport);\n\n    this.resolution = { ...this.resolution };\n    this.viewport = { ...this.viewport };\n  }\n\n  public peekViewport(): ScreenDimension {\n    return this._viewportStack[this._viewportStack.length - 1];\n  }\n\n  public peekResolution(): ScreenDimension {\n    return this._resolutionStack[this._resolutionStack.length - 1];\n  }\n\n  public popResolutionAndViewport() {\n    this.resolution = this._resolutionStack.pop();\n    this.viewport = this._viewportStack.pop();\n  }\n\n  private _alreadyWarned = false;\n  public applyResolutionAndViewport() {\n    this._canvas.width = this.scaledWidth;\n    this._canvas.height = this.scaledHeight;\n\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      const supported = this.graphicsContext.checkIfResolutionSupported({\n        width: this.scaledWidth,\n        height: this.scaledHeight\n      });\n      if (!supported && !this._alreadyWarned) {\n        this._alreadyWarned = true; // warn once\n        this._logger.warn(\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\n      }\n    }\n\n    if (this._antialiasing) {\n      this._canvas.style.imageRendering = 'auto';\n    } else {\n      this._canvas.style.imageRendering = 'pixelated';\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n      if (this._canvas.style.imageRendering === '') {\n        this._canvas.style.imageRendering = 'crisp-edges';\n      }\n    }\n    this._canvas.style.width = this.viewport.width + 'px';\n    this._canvas.style.height = this.viewport.height + 'px';\n\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\n    this.graphicsContext.updateViewport(this.resolution);\n    this.graphicsContext.resetTransform();\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  public get antialiasing() {\n    return this._antialiasing;\n  }\n\n  public set antialiasing(isSmooth: boolean) {\n    this._antialiasing = isSmooth;\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  /**\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\n   */\n  public get isFullScreen() {\n    return this._isFullScreen;\n  }\n\n  /**\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\n   * For example, wire this to a user click handler.\n   */\n  public goFullScreen(): Promise<void> {\n    return this._canvas.requestFullscreen();\n  }\n\n  /**\n   * Requests to exit fullscreen using the browser fullscreen api\n   */\n  public exitFullScreen(): Promise<void> {\n    return document.exitFullscreen();\n  }\n\n  /**\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\n   * Excalibur screen space.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public pageToScreenCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    if (!this._isFullScreen) {\n      newX -= getPosition(this._canvas).x;\n      newY -= getPosition(this._canvas).y;\n    }\n\n    // if fullscreen api on it centers with black bars\n    // we need to adjust the screen to world coordinates in this case\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\n        newX = (newX / window.innerWidth) * this.viewport.width;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\n        newY = (newY / window.innerHeight) * this.viewport.height;\n      }\n    }\n\n    newX = (newX / this.viewport.width) * this.resolution.width;\n    newY = (newY / this.viewport.height) * this.resolution.height;\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\n   * this is where html elements might live if you want to position them relative to Excalibur.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public screenToPageCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    newX = (newX / this.resolution.width) * this.viewport.width;\n    newY = (newY / this.resolution.height) * this.viewport.height;\n\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\n        newX = (newX / this.viewport.width) * window.innerWidth;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\n        newY = (newY / this.viewport.height) * window.innerHeight;\n      }\n    }\n\n    if (!this._isFullScreen) {\n      newX += getPosition(this._canvas).x;\n      newY += getPosition(this._canvas).y;\n    }\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\n   *\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\n   * and extends infinitely out relative from the [[Camera]].\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    // the only difference between screen & world is the camera transform\n    if (this._camera) {\n      return this._camera.inverse.multiply(point);\n    }\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  /**\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\n   *\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    if (this._camera) {\n      return this._camera.transform.multiply(point);\n    }\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  public pageToWorldCoordinates(point: Vector): Vector {\n    const screen = this.pageToScreenCoordinates(point);\n    return this.screenToWorldCoordinates(screen);\n  }\n\n  public worldToPageCoordinates(point: Vector): Vector {\n    const screen = this.worldToScreenCoordinates(point);\n    return this.screenToPageCoordinates(screen);\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   *\n   * World bounds are in world coordinates, useful for culling objects offscreen\n   */\n  public getWorldBounds(): BoundingBox {\n    const topLeft = this.screenToWorldCoordinates(Vector.Zero);\n    const right = topLeft.x + this.drawWidth;\n    const bottom = topLeft.y + this.drawHeight;\n\n    return new BoundingBox(topLeft.x, topLeft.y, right, bottom);\n  }\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this._camera) {\n      return this.resolution.width / this._camera.zoom;\n    }\n    return this.resolution.width;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this._camera) {\n      return this.resolution.height / this._camera.zoom;\n    }\n    return this.resolution.height;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  /**\n   * Returns screen center coordinates including zoom and device pixel ratio.\n   */\n  public get center(): Vector {\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\n  }\n\n  private _computeFit() {\n    document.body.style.margin = '0px';\n    document.body.style.overflow = 'hidden';\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    if (window.innerWidth / aspect < window.innerHeight) {\n      adjustedWidth = window.innerWidth;\n      adjustedHeight = window.innerWidth / aspect;\n    } else {\n      adjustedWidth = window.innerHeight * aspect;\n      adjustedHeight = window.innerHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _computeFitContainer() {\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    const parent = this.canvas.parentElement;\n    if (parent.clientWidth / aspect < parent.clientHeight) {\n      adjustedWidth = parent.clientWidth;\n      adjustedHeight = parent.clientWidth / aspect;\n    } else {\n      adjustedWidth = parent.clientHeight * aspect;\n      adjustedHeight = parent.clientHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _applyDisplayMode() {\n    if (this.displayMode === DisplayMode.Position) {\n      this._initializeDisplayModePosition(this._position);\n    } else {\n      this._setResolutionAndViewportByDisplayMode(this.parent);\n\n      // watch resizing\n      if (this.parent instanceof Window) {\n        this._browser.window.on('resize', this._resizeHandler);\n      } else {\n        this._resizeObserver = new ResizeObserver(() => {\n          this._resizeHandler();\n        });\n        this._resizeObserver.observe(this.parent);\n      }\n      this.parent.addEventListener('resize', this._resizeHandler);\n    }\n  }\n\n  /**\n   * Sets the resolution and viewport based on the selected display mode.\n   */\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.FillContainer) {\n      this.resolution = {\n        width: (<HTMLElement>parent).clientWidth,\n        height: (<HTMLElement>parent).clientHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FillScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.resolution = {\n        width: (<Window>parent).innerWidth,\n        height: (<Window>parent).innerHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FitScreen) {\n      this._computeFit();\n    }\n\n    if (this.displayMode === DisplayMode.FitContainer) {\n      this._computeFitContainer();\n    }\n  }\n\n  private _initializeDisplayModePosition(position: CanvasPosition) {\n    if (!position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof position === 'string') {\n        const specifiedPosition = position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (position.top) {\n          typeof position.top === 'number'\n            ? (this.canvas.style.top = position.top.toString() + 'px')\n            : (this.canvas.style.top = position.top);\n        }\n        if (position.right) {\n          typeof position.right === 'number'\n            ? (this.canvas.style.right = position.right.toString() + 'px')\n            : (this.canvas.style.right = position.right);\n        }\n        if (position.bottom) {\n          typeof position.bottom === 'number'\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = position.bottom);\n        }\n        if (position.left) {\n          typeof position.left === 'number'\n            ? (this.canvas.style.left = position.left.toString() + 'px')\n            : (this.canvas.style.left = position.left);\n        }\n      }\n    }\n  }\n}","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve(false);\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve(true);\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","import { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher();\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: any) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: any) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n}\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.save();\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n  ctx.restore();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Color } from './Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\nimport { Canvas } from './Graphics/Canvas';\nimport { Vector } from './Math/vector';\nimport { delay } from './Util/Util';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { clamp } from './Math/util';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\n  public canvas: Canvas = new Canvas({\n    filtering: ImageFiltering.Blended,\n    smoothing: true,\n    draw: this.draw.bind(this)\n  });\n  private _resourceList: Loadable<any>[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  /**\n   * Positions the top left corner of the logo image\n   * If not set, the loader automatically positions the logo\n   */\n  public logoPosition: Vector | null;\n  /**\n   * Positions the top left corner of the play button.\n   * If not set, the loader automatically positions the play button\n   */\n  public playButtonPosition: Vector | null;\n  /**\n   * Positions the top left corner of the loading bar\n   * If not set, the loader automatically positions the loading bar\n   */\n  public loadingBarPosition: Vector | null;\n\n  /**\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\n   */\n  public loadingBarColor: Color = Color.White;\n\n  /**\n   * Gets or sets the background color of the loader as a hex string\n   */\n  public backgroundColor: string = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  public get playButtonRootElement(): HTMLElement | null {\n    return this._playButtonRootElement;\n  }\n  public get playButtonElement(): HTMLButtonElement | null {\n    return this._playButtonElement;\n  }\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    const existingRoot = document.getElementById('excalibur-play-root');\n    if (existingRoot) {\n      this._playButtonRootElement = existingRoot;\n    }\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.id = 'excalibur-play-root';\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\n    if (!buttonElement) {\n      buttonElement = document.createElement('button');\n    }\n\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable<any>[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n    this.canvas.width = this._engine.canvas.width;\n    this.canvas.height = this._engine.canvas.height;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable<any>) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable<any>[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public async showPlayButton(): Promise<void> {\n    if (this.suppressPlayButton) {\n      this.hidePlayButton();\n      // Delay is to give the logo a chance to show, otherwise don't delay\n      await delay(500, this._engine?.clock);\n    } else {\n      const resizeHandler = () => {\n        this._positionPlayButton();\n      };\n      if (this._engine?.browser) {\n        this._engine.browser.window.on('resize', resizeHandler);\n      }\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\n        if (evt.key === 'Enter') {\n          this._playButton.click();\n        }\n      });\n      this._positionPlayButton();\n      const playButtonClicked = new Promise<void>((resolve) => {\n        const startButtonHandler = (e: Event) => {\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\n          e.stopPropagation();\n          // Hide Button after click\n          this.hidePlayButton();\n          if (this._engine?.browser) {\n            this._engine.browser.window.off('resize', resizeHandler);\n          }\n          resolve();\n        };\n        this._playButton.addEventListener('click', startButtonHandler);\n        this._playButton.addEventListener('touchend', startButtonHandler);\n        this._playButton.addEventListener('pointerup', startButtonHandler);\n      });\n\n      return await playButtonClicked;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Clean up generated elements for the loader\n   */\n  public dispose() {\n    if (this._playButtonRootElement.parentElement) {\n      this._playButtonRootElement.removeChild(this._playButtonElement);\n      document.body.removeChild(this._playButtonRootElement);\n      document.head.removeChild(this._styleBlock);\n      this._playButtonRootElement = null;\n      this._playButtonElement = null;\n      this._styleBlock = null;\n    }\n  }\n\n  update(_engine: Engine, _delta: number): void {\n    // override me\n  }\n\n  data: Loadable<any>[];\n\n  private _isLoadedResolve: () => any;\n  private _isLoadedPromise = new Promise<void>(resolve => {\n    this._isLoadedResolve = resolve;\n  });\n  public areResourcesLoaded() {\n    return this._isLoadedPromise;\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete AND the user has clicked the \"Play button\"\n   */\n  public async load(): Promise<Loadable<any>[]> {\n    await this._image?.decode(); // decode logo if it exists\n\n    await Promise.all(\n      this._resourceList.map((r) =>\n        r.load().finally(() => {\n          // capture progress\n          this._numLoaded++;\n        })\n      )\n    );\n    this._isLoadedResolve();\n\n    // short delay in showing the button for aesthetics\n    await delay(200, this._engine?.clock);\n\n    await this.showPlayButton();\n    // Unlock browser AudioContext in after user gesture\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\n    await WebAudio.unlock();\n\n    return (this.data = this._resourceList);\n  }\n\n  public markResourceComplete(): void {\n    this._numLoaded++;\n  }\n\n  /**\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\n   */\n  public get progress(): number {\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\n  }\n\n  private _positionPlayButton() {\n    if (this._engine) {\n      const screenHeight = this._engine.screen.viewport.height;\n      const screenWidth = this._engine.screen.viewport.width;\n      if (this._playButtonRootElement) {\n        const left = this._engine.canvas.offsetLeft;\n        const top = this._engine.canvas.offsetTop;\n        const buttonWidth = this._playButton.clientWidth;\n        const buttonHeight = this._playButton.clientHeight;\n        if (this.playButtonPosition) {\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n        } else {\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\n        }\n      }\n    }\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    this._positionPlayButton();\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    let logoY = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    let logoX = canvasWidth / 2 - width / 2;\n\n    if (this.logoPosition) {\n      logoX = this.logoPosition.x;\n      logoY = this.logoPosition.y;\n    }\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    if (!this.logoPosition) {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n    } else {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n    }\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    let loadingX = logoX;\n    let loadingY = logoY;\n    if (this.loadingBarPosition) {\n      loadingX = this.loadingBarPosition.x;\n      loadingY = this.loadingBarPosition.y;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n    const progress = width * this.progress;\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(\n      ctx,\n      loadingX + margin,\n      loadingY + margin,\n      progressWidth > 10 ? progressWidth : 10,\n      height,\n      5,\n      null,\n      this.loadingBarColor\n    );\n    this._engine.setAntialiasing(oldAntialias);\n  }\n}\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // (✓)\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // (✗)\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    // eslint-disable-next-line no-console\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","/**\n * An enum that describes the types of collisions bodies can participate in\n */\nexport enum CollisionType {\n  /**\n   * Bodies with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Bodies with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other bodies and do not influence or move other bodies.\n   * This is useful for use in trigger type behavior.\n   */\n  Passive = 'Passive',\n  /**\n   * Bodies with the `Active` setting raise collision events and participate\n   * in collisions with other bodies and will be push or moved by bodies sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Bodies with the `Fixed` setting raise collision events and participate in\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\n * like platformers or top down games.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Arcade = 'arcade',\n  Realistic = 'realistic'\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster.\n */\nexport enum BroadphaseStrategy {\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n  public static get gravity() {\n    return Physics.acc;\n  }\n  public static set gravity(v: Vector) {\n    Physics.acc = v;\n  }\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n\n  /**\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\n   */\n  public static useArcadePhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRealisticPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\n  }\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\n   */\n  public static dynamicTreeVelocityMultiplier = 2;\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\n  })\n  public static get dynamicTreeVelocityMultiplyer() {\n    return Physics.dynamicTreeVelocityMultiplier;\n  }\n\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\n    Physics.dynamicTreeVelocityMultiplier = value;\n  }\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Number of position iterations (overlap) to run in the solver\n   */\n  public static positionIterations = 3;\n\n  /**\n   * Number of velocity iteration (response) to run in the solver\n   */\n  public static velocityIterations = 8;\n\n  /**\n   * Amount of overlap to tolerate in pixels\n   */\n  public static slop = 1;\n\n  /**\n   * Amount of positional overlap correction to apply each position iteration of the solver\n   * O - meaning no correction, 1 - meaning correct all overlap\n   */\n  public static steeringFactor = 0.2;\n\n  /**\n   * Warm start set to true re-uses impulses from previous frames back in the solver\n   */\n  public static warmStart = true;\n\n  /**\n   * By default bodies do not sleep\n   */\n  public static bodiesCanSleepByDefault = false;\n\n  /**\n   * Surface epsilon is used to help deal with surface penetration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  public static sleepEpsilon = 0.07;\n\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\n\n  public static sleepBias = 0.9;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\nimport { VectorView } from '../../Math/vector-view';\nimport { Vector, vec } from '../../Math/vector';\nimport { Component } from '../Component';\nimport { Observable } from '../../Util/Observable';\nimport { watch } from '../../Util/Watch';\n\nexport interface Transform {\n  /**\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\n   */\n  coordPlane: CoordPlane;\n\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If the entity has a parent this position is relative to the parent entity.\n   */\n  pos: Vector;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  z: number;\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   *\n   * If the entity has a parent this rotation is relative to the parent.\n   */\n  rotation: number;\n\n  /**\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\n   */\n  scale: Vector;\n}\n\nconst createPosView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.data[MatrixLocations.X] = x;\n    },\n    setY: (y) => {\n      source.data[MatrixLocations.Y] = y;\n    },\n    getX: () => {\n      return source.data[MatrixLocations.X];\n    },\n    getY: () => {\n      return source.data[MatrixLocations.Y];\n    }\n  });\n};\n\nconst createScaleView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.setScaleX(x);\n    },\n    setY: (y) => {\n      source.setScaleY(y);\n    },\n    getX: () => {\n      return source.getScaleX();\n    },\n    getY: () => {\n      return source.getScaleY();\n    }\n  });\n};\n\n/**\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\n */\nexport enum CoordPlane {\n  /**\n   * The world coordinate plane (default) represents world space, any entities drawn with world\n   * space move when the camera moves.\n   */\n  World = 'world',\n  /**\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\n   * to screen coordinates ignoring the camera.\n   */\n  Screen = 'screen'\n}\n\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\n  public readonly type = 'ex.transform';\n\n  private _dirty = false;\n\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\n  private _position = watch(createPosView(this.matrix), (v) => {\n    this.posChanged$.notifyAll(v);\n  });\n  private _rotation = 0;\n  private _scale = createScaleView(this.matrix);\n\n  private _recalculate() {\n    this._rotation = this.matrix.getRotation();\n    this._dirty = false;\n  }\n\n  public getGlobalMatrix(): Matrix {\n    if (!this.parent) {\n      return this.matrix;\n    } else {\n      return this.parent.getGlobalMatrix().multiply(this.matrix);\n    }\n  }\n\n  public getGlobalTransform(): Transform {\n    return {\n      pos: this.globalPos,\n      scale: this.globalScale,\n      rotation: this.globalRotation,\n      z: this.z,\n      coordPlane: this.coordPlane\n    };\n  }\n\n  public get parent(): TransformComponent | null {\n    return this?.owner?.parent?.get(TransformComponent);\n  }\n\n  /**\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\n   */\n  public coordPlane = CoordPlane.World;\n\n  /**\n   * Observable that notifies when the position changes\n   */\n  public posChanged$ = new Observable<Vector>();\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If a parent entity exists coordinates are local to the parent.\n   */\n  public get pos(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._position;\n  }\n\n  public set pos(val: Vector) {\n    const oldPos = this.matrix.getPosition();\n    this.matrix.setPosition(val.x, val.y);\n    this._dirty = true;\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this._position);\n    }\n  }\n\n  // Dirty flag check up the chain\n  public get dirty(): boolean {\n    if (this?.owner?.parent) {\n      const parent = this.parent;\n      return parent.dirty || this._dirty;\n    }\n    return this._dirty;\n  }\n\n  /**\n   * The current world position calculated\n   */\n  public get globalPos(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.data[MatrixLocations.X],\n      getY: () => source.data[MatrixLocations.Y],\n      setX: (x) => {\n        const oldX = this.matrix.data[MatrixLocations.X];\n        if (this.parent) {\n          const { x: newX } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(x, source.data[MatrixLocations.Y]));\n          this.matrix.data[MatrixLocations.X] = newX;\n        } else {\n          this.matrix.data[MatrixLocations.X] = x;\n        }\n        if (oldX !== this.matrix.data[MatrixLocations.X]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      },\n      setY: (y) => {\n        const oldY = this.matrix.data[MatrixLocations.Y];\n        if (this.parent) {\n          const { y: newY } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(source.data[MatrixLocations.X], y));\n          this.matrix.data[MatrixLocations.Y] = newY;\n        } else {\n          this.matrix.data[MatrixLocations.Y] = y;\n        }\n        if (oldY !== this.matrix.data[MatrixLocations.Y]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      }\n    });\n  }\n\n  public set globalPos(val: Vector) {\n    const oldPos = this.pos;\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.pos = val;\n    } else {\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multiply(val);\n    }\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this.pos);\n    }\n  }\n\n  /**\n   * Observable that emits when the z index changes on this component\n   */\n  public zIndexChanged$ = new Observable<number>();\n  private _z = 0;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  public get z(): number {\n    return this._z;\n  }\n\n  public set z(val: number) {\n    const oldz = this._z;\n    this._z = val;\n    if (oldz !== val) {\n      this.zIndexChanged$.notifyAll(val);\n    }\n  }\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   */\n  public get rotation(): number {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._rotation;\n  }\n\n  public set rotation(val: number) {\n    this.matrix.setRotation(val);\n    this._dirty = true;\n  }\n\n  public get globalRotation(): number {\n    return this.getGlobalMatrix().getRotation();\n  }\n\n  public set globalRotation(val: number) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.rotation = val;\n    } else {\n      this.rotation = val - parentTransform.globalRotation;\n    }\n  }\n\n  /**\n   * The scale of the entity.\n   */\n  public get scale(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._scale;\n  }\n\n  public set scale(val: Vector) {\n    this.matrix.setScale(val);\n    this._dirty = true;\n  }\n\n  public get globalScale(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.getScaleX(),\n      getY: () => source.getScaleY(),\n      setX: (x) => {\n        if (this.parent) {\n          const globalScaleX = this.parent.globalScale.x;\n          this.matrix.setScaleX(x / globalScaleX);\n        } else {\n          this.matrix.setScaleX(x);\n        }\n      },\n      setY: (y) => {\n        if (this.parent) {\n          const globalScaleY = this.parent.globalScale.y;\n          this.matrix.setScaleY(y / globalScaleY);\n        } else {\n          this.matrix.setScaleY(y);\n        }\n      }\n    });\n  }\n\n  public set globalScale(val: Vector) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.scale = val;\n    } else {\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\n    }\n  }\n\n  /**\n   * Apply the transform to a point\n   * @param point\n   */\n  public apply(point: Vector): Vector {\n    return this.matrix.multiply(point);\n  }\n\n  /**\n   * Apply the inverse transform to a point\n   * @param point\n   */\n  public applyInverse(point: Vector): Vector {\n    return this.matrix.getAffineInverse().multiply(point);\n  }\n}\n","import { Vector } from './vector';\n\nexport interface VectorViewOptions {\n  getX: () => number;\n  getY: () => number;\n  setX: (x: number) => void;\n  setY: (y: number) => void;\n}\nexport class VectorView extends Vector {\n  private _getX: () => number;\n  private _getY: () => number;\n  private _setX: (x: number) => void;\n  private _setY: (y: number) => void;\n  constructor(options: VectorViewOptions) {\n    super(0, 0);\n    this._getX = options.getX;\n    this._getY = options.getY;\n    this._setX = options.setX;\n    this._setY = options.setY;\n  }\n  public get x() {\n    return (this._x = this._getX());\n  }\n\n  public set x(val) {\n    this._setX(val);\n    this._x = val;\n  }\n\n  public get y() {\n    return (this._y = this._getY());\n  }\n  public set y(val) {\n    this._setY(val);\n    this._y = val;\n  }\n}\n","import { Entity } from './Entity';\n\n/**\n * Component Contructor Types\n */\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\n\n/**\n * Type guard to check if a component implements clone\n * @param x\n */\nfunction hasClone(x: any): x is { clone(): any } {\n  return !!x?.clone;\n}\n\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * Plucks the string type out of a component type\n */\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\n\n/**\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\n *\n * Implementations of Component must have a zero-arg constructor to support dependencies\n *\n * ```typescript\n * class MyComponent extends ex.Component<'my'> {\n *   public readonly type = 'my';\n *   // zero arg support required if you want to use component dependencies\n *   constructor(public optionalPos?: ex.Vector) {}\n * }\n * ```\n */\nexport abstract class Component<TypeName extends string = string> {\n  /**\n   * Optionally list any component types this component depends on\n   * If the owner entity does not have these components, new components will be added to the entity\n   *\n   * Only components with zero-arg constructors are supported as automatic component dependencies\n   */\n  readonly dependencies?: ComponentCtor[];\n\n  // todo implement optional\n  readonly optional?: ComponentCtor[];\n\n  /**\n   * Type of this component, must be a unique type among component types in you game.\n   */\n  abstract readonly type: TypeName;\n\n  /**\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\n   */\n  owner?: Entity = null;\n\n  /**\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\n   */\n  clone(): this {\n    const newComponent = new (this.constructor as any)();\n    for (const prop in this) {\n      if (this.hasOwnProperty(prop)) {\n        const val = this[prop];\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\n          newComponent[prop] = val.clone();\n        } else {\n          newComponent[prop] = val;\n        }\n      }\n    }\n    return newComponent;\n  }\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onAdd?(owner: Entity): void;\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onRemove?(previousOwner: Entity): void;\n}\n\n/**\n * Tag components are a way of tagging a component with label and a simple value\n *\n * For example:\n *\n * ```typescript\n * const isOffscreen = new TagComponent('offscreen');\n * entity.addComponent(isOffscreen);\n * entity.tags.includes\n * ```\n */\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\nTypeName\n> {\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\n    super();\n  }\n}\n","/**\n * Defines a generic message that can contain any data\n * @template T is the typescript Type of the data\n */\nexport interface Message<T> {\n  type: string;\n  data: T;\n}\n\n/**\n * Defines an interface for an observer to receive a message via a notify() method\n */\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\n/**\n * Defines an interface for something that might be an observer if a notify() is present\n */\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n  public subscriptions: ((val: T) => any)[] = [];\n\n  /**\n   * Register an observer to listen to this observable\n   * @param observer\n   */\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Register a callback to listen to this observable\n   * @param func\n   */\n  subscribe(func: (val: T) => any) {\n    this.subscriptions.push(func);\n  }\n\n  /**\n   * Remove an observer from the observable\n   * @param observer\n   */\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  /**\n   * Remove a callback that is listening to this observable\n   * @param func\n   */\n  unsubscribe(func: (val: T) => any) {\n    const i = this.subscriptions.indexOf(func);\n    if (i !== -1) {\n      this.subscriptions.splice(i, 1);\n    }\n  }\n\n  /**\n   * Broadcasts a message to all observers and callbacks\n   * @param message\n   */\n  notifyAll(message: T) {\n    this.observers.forEach((o) => o.notify(message));\n    this.subscriptions.forEach(cb => cb(message));\n  }\n\n  /**\n   * Removes all observers and callbacks\n   */\n  clear() {\n    this.observers.length = 0;\n    this.subscriptions.length = 0;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n\n  /**\n   * Inverts the collision group. For example, if before the group specified \"players\",\n   * inverting would specify all groups except players\n   * @returns CollisionGroup\n   */\n  public invert(): CollisionGroup {\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\n  }\n\n  /**\n   * Combine collision groups with each other. The new group includes all of the previous groups.\n   *\n   * @param collisionGroups\n   */\n  public static combine(collisionGroups: CollisionGroup[]) {\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\n    const combinedMask = ~combinedCategory;\n\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\n  }\n\n  /**\n   * Creates a collision group that collides with the listed groups\n   * @param collisionGroups\n   */\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\n    return CollisionGroup.combine(collisionGroups).invert();\n  }\n}\n","import { CollisionContact } from './CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { BodyComponent } from '../BodyComponent';\nimport { Id } from '../../Id';\nimport { Collider } from '../Colliders/Collider';\n\n/**\n * Models a potential collision between 2 colliders\n */\nexport class Pair {\n  public id: string = null;\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\n   * @param colliderA\n   * @param colliderB\n   */\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    const bodyA = colliderA?.owner?.get(BodyComponent);\n    const bodyB = colliderB?.owner?.get(BodyComponent);\n\n    // Prevent self collision\n    if (colliderA.id === colliderB.id) {\n      return false;\n    }\n\n    // Colliders with the same owner do not collide (composite colliders)\n    if (colliderA.owner &&\n        colliderB.owner &&\n        colliderA.owner.id === colliderB.owner.id) {\n      return false;\n    }\n\n    // if the pair has a member with zero dimension don't collide\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\n      return false;\n    }\n\n    // Body's needed for collision in the current state\n    // TODO can we collide without a body?\n    if (!bodyA || !bodyB) {\n      return false;\n    }\n\n    // If both are in the same collision group short circuit\n    if (!bodyA.group.canCollide(bodyB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!bodyA.active || !bodyB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const colliderA = this.colliderA;\n    const colliderB = this.colliderB;\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Runs the collision intersection logic on the members of this pair\n   */\n  public collide(): CollisionContact[] {\n    return this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Check if the collider is part of the pair\n   * @param collider\n   */\n  public hasCollider(collider: Collider) {\n    return collider === this.colliderA || collider === this.colliderB;\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair (owning id)\n   */\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\n    if (idA.value < idB.value) {\n      return `#${idA.value}+${idB.value}`;\n    } else {\n      return `#${idB.value}+${idA.value}`;\n    }\n  }\n}\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\nimport { BoundingBox } from '../BoundingBox';\n\nimport { Ray } from '../../Math/ray';\nimport { Logger } from '../../Util/Log';\nimport { Id } from '../../Id';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { BodyComponent } from '../BodyComponent';\nimport { Color, ExcaliburGraphicsContext } from '../..';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode<T> {\n  public left: TreeNode<T>;\n  public right: TreeNode<T>;\n  public bounds: BoundingBox;\n  public height: number;\n  public data: T;\n  constructor(public parent?: TreeNode<T>) {\n    this.parent = parent || null;\n    this.data = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\nexport interface ColliderProxy<T> {\n  id: Id<'collider'>;\n  owner: T;\n  bounds: BoundingBox;\n}\n\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\n  public root: TreeNode<T>;\n  public nodes: { [key: number]: TreeNode<T> };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode<T>): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode<T>) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode<T>;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackCollider(collider: T) {\n    const node = new TreeNode<T>();\n    node.data = collider;\n    node.bounds = collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[collider.id.value] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return false;\n    }\n    const b = collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn(\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\n      );\n      this.untrackCollider(collider);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    // THIS IS CAUSING UNECESSARY CHECKS\n    if (collider.owner) {\n      const body = collider.owner?.get(BodyComponent);\n      if (body) {\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n\n        if (multdx < 0) {\n          b.left += multdx;\n        } else {\n          b.right += multdx;\n        }\n\n        if (multdy < 0) {\n          b.top += multdy;\n        } else {\n          b.bottom += multdy;\n        }\n      }\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[collider.id.value] = null;\n    delete this.nodes[collider.id.value];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode<T>) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(collider: T, callback: (other: T) => boolean): void {\n    const bounds = collider.bounds;\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\n          if (callback.call(collider, currentNode.data)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.data)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode<T>[] {\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode<T>) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          currentNode.bounds.draw(ex, Color.Green);\n        } else {\n          currentNode.bounds.draw(ex, Color.White);\n        }\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\nimport { CollisionProcessor } from './CollisionProcessor';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\n\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { FrameStats } from '../../Debug';\nimport { Logger } from '../../Util/Log';\nimport { CollisionType } from '../CollisionType';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BodyComponent } from '../BodyComponent';\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\nimport { ExcaliburGraphicsContext } from '../..';\n\n/**\n * Responsible for performing the collision broadphase (locating potential collisions) and\n * the narrowphase (actual collision contacts)\n */\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\n  private _pairs = new Set<string>();\n\n  private _collisionPairCache: Pair[] = [];\n  private _colliders: Collider[] = [];\n\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null collider');\n      return;\n    }\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        c.owner = target.owner;\n        this._colliders.push(c);\n        this._dynamicCollisionTree.trackCollider(c);\n      }\n    } else {\n      this._colliders.push(target);\n      this._dynamicCollisionTree.trackCollider(target);\n    }\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null collider');\n      return;\n    }\n\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        const index = this._colliders.indexOf(c);\n        if (index !== -1) {\n          this._colliders.splice(index, 1);\n        }\n        this._dynamicCollisionTree.untrackCollider(c);\n      }\n    } else {\n      const index = this._colliders.indexOf(target);\n      if (index !== -1) {\n        this._colliders.splice(index, 1);\n      }\n      this._dynamicCollisionTree.untrackCollider(target);\n    }\n  }\n\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\n    return this._pairs.has(hash);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\n   */\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets.filter((other) => {\n      const body = other.owner?.get(BodyComponent);\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\n    });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._pairs.clear();\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n          const pair = new Pair(collider, other);\n          this._pairs.add(pair.id);\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        const body = collider.owner.get(BodyComponent);\n        // Skip non-active objects. Does not make sense on other collision types\n        if (body.collisionType !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          body.vel.size * seconds + // velocity term\n          body.acc.size * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penetrating in the current position\n          const updateVec = body.pos.sub(body.oldPos);\n          const centerPoint = collider.center;\n          const furthestPoint = collider.getFurthestPoint(body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minCollider: Collider;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.size < minTranslate.size) {\n                  minTranslate = translate;\n                  minCollider = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minCollider && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minCollider);\n            if (!this._pairs.has(pair.id)) {\n              this._pairs.add(pair.id);\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\n            collider.update(body.transform);\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\n    let contacts: CollisionContact[] = [];\n    for (let i = 0; i < pairs.length; i++) {\n      const newContacts = pairs[i].collide();\n      contacts = contacts.concat(newContacts);\n      if (stats && newContacts.length > 0) {\n        for (const c of newContacts) {\n          stats.physics.contacts.set(c.id, c);\n        }\n      }\n    }\n    if (stats) {\n      stats.physics.collisions += contacts.length;\n    }\n    return contacts;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Collider[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    this._dynamicCollisionTree.debug(ex);\n  }\n}\n","import { Color } from '../../Color';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BoundingBox } from '../BoundingBox';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Clonable } from '../../Interfaces/Clonable';\nimport { Entity, Transform } from '../../EntityComponentSystem';\nimport { createId, Id } from '../../Id';\nimport { EventDispatcher } from '../../EventDispatcher';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\n/**\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\n * for the purposes of colliding 2 objects in excalibur.\n */\nexport abstract class Collider implements Clonable<Collider> {\n  private static _ID = 0;\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>();\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const contact = this.collide(other);\n\n    if (contact) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public owner: Entity;\n\n  /**\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\n   * on top of the collider.\n   */\n  offset: Vector;\n\n  /**\n   * Position of the collision collider in world coordinates\n   */\n  abstract get worldPos(): Vector;\n\n  /**\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\n   */\n  abstract get center(): Vector;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\n   */\n  abstract get bounds(): BoundingBox;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\n   */\n  abstract get localBounds(): BoundingBox;\n\n  /**\n   * Return the axes of this particular collider\n   */\n  abstract get axes(): Vector[];\n  /**\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\n   */\n  abstract getFurthestPoint(direction: Vector): Vector;\n\n  abstract getInertia(mass: number): number;\n\n  // All new CollisionShape need to do the following\n  // Create a new collision function in the CollisionJumpTable against all the primitives\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\n  abstract collide(collider: Collider): CollisionContact[];\n\n  /**\n   * Returns the closest line between the surfaces this collider and another\n   * @param collider\n   */\n  abstract getClosestLineBetween(collider: Collider): Line;\n\n  /**\n   * Return wether the collider contains a point inclusive to it's border\n   */\n  abstract contains(point: Vector): boolean;\n\n  /**\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\n   */\n  abstract rayCast(ray: Ray, max?: number): Vector;\n\n  /**\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\n   */\n  abstract project(axis: Vector): Projection;\n\n  /**\n   * Updates collider world space geometry\n   */\n  abstract update(transform: Transform): void;\n\n  /**\n   * Draw the collider\n   * @deprecated Will be removed in 0.26.0\n   * @param ctx\n   * @param color\n   */\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\n\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\n  /**\n   * Draw any debug information\n   * @deprecated Will be removed in 0.26.0\n   */\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\n\n  abstract clone(): Collider;\n}\n","import { Util } from '../..';\nimport { Pair } from '../Detection/Pair';\nimport { Color } from '../../Color';\nimport { Transform } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\nimport { Line } from '../../Math/line';\nimport { Projection } from '../../Math/projection';\nimport { Ray } from '../../Math/ray';\nimport { Vector } from '../../Math/vector';\nimport { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { DynamicTree } from '../Detection/DynamicTree';\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\nimport { Collider } from './Collider';\n\nexport class CompositeCollider extends Collider {\n  private _transform: Transform;\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\n  private _dynamicAABBTree = new DynamicTree();\n  private _colliders: Collider[] = [];\n\n  constructor(colliders: Collider[]) {\n    super();\n    for (const c of colliders) {\n      this.addCollider(c);\n    }\n  }\n\n  clearColliders() {\n    this._colliders = [];\n  }\n\n  addCollider(collider: Collider) {\n    this.events.wire(collider.events);\n    this._colliders.push(collider);\n    this._collisionProcessor.track(collider);\n    this._dynamicAABBTree.trackCollider(collider);\n  }\n\n  removeCollider(collider: Collider) {\n    this.events.unwire(collider.events);\n    Util.removeItemFromArray(collider, this._colliders);\n    this._collisionProcessor.untrack(collider);\n    this._dynamicAABBTree.untrackCollider(collider);\n  }\n\n  getColliders(): Collider[] {\n    return this._colliders;\n  }\n\n  get worldPos(): Vector {\n    // TODO transform component world pos\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get center(): Vector {\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get bounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce(\n      (acc, collider) => acc.combine(collider.bounds),\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\n    );\n\n    return results;\n  }\n\n  get localBounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\n\n    return results;\n  }\n\n  get axes(): Vector[] {\n    // TODO cache this\n    const colliders = this.getColliders();\n    let axes: Vector[] = [];\n    for (const collider of colliders) {\n      axes = axes.concat(collider.axes);\n    }\n    return axes;\n  }\n\n  getFurthestPoint(direction: Vector): Vector {\n    const colliders = this.getColliders();\n    const furthestPoints: Vector[] = [];\n    for (const collider of colliders) {\n      furthestPoints.push(collider.getFurthestPoint(direction));\n    }\n    // Pick best point from all colliders\n    let bestPoint = furthestPoints[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (const point of furthestPoints) {\n      const distance = point.dot(direction);\n      if (distance > maxDistance) {\n        bestPoint = point;\n        maxDistance = distance;\n      }\n    }\n    return bestPoint;\n  }\n\n  getInertia(mass: number): number {\n    const colliders = this.getColliders();\n    let totalInertia = 0;\n    for (const collider of colliders) {\n      totalInertia += collider.getInertia(mass);\n    }\n    return totalInertia;\n  }\n\n  collide(other: Collider): CollisionContact[] {\n    let otherColliders = [other];\n    if (other instanceof CompositeCollider) {\n      otherColliders = other.getColliders();\n    }\n\n    const pairs: Pair[] = [];\n    for (const c of otherColliders) {\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\n        pairs.push(new Pair(c, potentialCollider));\n        return false;\n      });\n    }\n\n    let contacts: CollisionContact[] = [];\n    for (const p of pairs) {\n      contacts = contacts.concat(p.collide());\n    }\n    return contacts;\n  }\n\n  getClosestLineBetween(other: Collider): Line {\n    const colliders = this.getColliders();\n    const lines: Line[] = [];\n    if (other instanceof CompositeCollider) {\n      const otherColliders = other.getColliders();\n      for (const colliderA of colliders) {\n        for (const colliderB of otherColliders) {\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\n          if (maybeLine) {\n            lines.push(maybeLine);\n          }\n        }\n      }\n    } else {\n      for (const collider of colliders) {\n        const maybeLine = other.getClosestLineBetween(collider);\n        if (maybeLine) {\n          lines.push(maybeLine);\n        }\n      }\n    }\n\n    if (lines.length) {\n      let minLength = lines[0].getLength();\n      let minLine = lines[0];\n      for (const line of lines) {\n        const length = line.getLength();\n        if (length < minLength) {\n          minLength = length;\n          minLine = line;\n        }\n      }\n      return minLine;\n    }\n    return null;\n  }\n  contains(point: Vector): boolean {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      if (collider.contains(point)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  rayCast(ray: Ray, max?: number): Vector {\n    const colliders = this.getColliders();\n    const points: Vector[] = [];\n    for (const collider of colliders) {\n      const vec = collider.rayCast(ray, max);\n      if (vec) {\n        points.push(vec);\n      }\n    }\n    if (points.length) {\n      let minPoint = points[0];\n      let minDistance = minPoint.dot(ray.dir);\n      for (const point of points) {\n        const distance = ray.dir.dot(point);\n        if (distance < minDistance) {\n          minPoint = point;\n          minDistance = distance;\n        }\n      }\n      return minPoint;\n    }\n    return null;\n  }\n  project(axis: Vector): Projection {\n    const colliders = this.getColliders();\n    const projs: Projection[] = [];\n    for (const collider of colliders) {\n      const proj = collider.project(axis);\n      if (proj) {\n        projs.push(proj);\n      }\n    }\n    // Merge all proj's on the same axis\n    if (projs.length) {\n      const newProjection = new Projection(projs[0].min, projs[0].max);\n      for (const proj of projs) {\n        newProjection.min = Math.min(proj.min, newProjection.min);\n        newProjection.max = Math.max(proj.max, newProjection.max);\n      }\n      return newProjection;\n    }\n    return null;\n  }\n\n  update(transform: Transform): void {\n    if (transform) {\n      const colliders = this.getColliders();\n      for (const collider of colliders) {\n        collider.owner = this.owner;\n        collider.update(transform);\n      }\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color, pos);\n    }\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.debug(ex, color);\n    }\n  }\n\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color);\n    }\n  }\n  clone(): Collider {\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\n  }\n}\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\n\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface CircleColliderOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n}\n\n/**\n * This is a circle collider for the excalibur rigid body physics simulation\n */\nexport class CircleCollider extends Collider {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0).\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  private _naturalRadius: number;\n  /**\n   * Get the radius of the circle\n   */\n  public get radius(): number {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    return this._naturalRadius * Math.min(scale.x, scale.y);\n  }\n\n  /**\n   * Set the radius of the circle\n   */\n  public set radius(val: number) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\n  }\n\n  private _transform: Transform;\n\n  constructor(options: CircleColliderOptions) {\n    super();\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): CircleCollider {\n    return new CircleCollider({\n      offset: this.offset.clone(),\n      radius: this.radius\n    });\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  /**\n   * Tests if a point is contained in this collider\n   */\n  public contains(point: Vector): boolean {\n    const pos = this._transform?.pos ?? this.offset;\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circle collider and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const positiveToi: number[] = [];\n        if (toi1 >= 0) {\n          positiveToi.push(toi1);\n        }\n\n        if (toi2 >= 0) {\n          positiveToi.push(toi2);\n        }\n\n        const mintoi = Math.min(...positiveToi);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Find the local point on the shape in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const dir = direction.normalize();\n    return dir.scale(this.radius);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    ).rotate(rotation).scale(scale).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return [];\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /* istanbul ignore next */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   * @param pos\n   */\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    ex.save();\n    ex.translate(pos.x, pos.y);\n    ex.rotate(rotation);\n    ex.scale(scale.x, scale.y);\n    ex.drawCircle((this.offset ?? Vector.Zero), this._naturalRadius, Color.Transparent, color, 2);\n    ex.restore();\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const transform = this._transform;\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\n    const rotation = transform ? transform.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perspective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perspective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { TransformComponent } from '../../EntityComponentSystem';\nimport { Pair } from '../Detection/Pair';\n\nexport const CollisionJumpTable = {\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    const combinedRadius = circleA.radius + circleB.radius;\n    const distance = circleAPos.distance(circleBPos);\n\n    if (distance > combinedRadius) {\n      return [];\n    }\n\n    // negative means overlap\n    const separation = combinedRadius - distance;\n\n    // Normal points from A -> B\n    const normal = circleBPos.sub(circleAPos).normalize();\n    const tangent = normal.perpendicular();\n    const mvt = normal.scale(separation);\n\n    const point = circleA.getFurthestPoint(normal);\n    const local = circleA.getFurthestLocalPoint(normal);\n\n    const info: SeparationInfo = {\n      collider: circleA,\n      separation,\n      axis: normal,\n      point: point\n    };\n\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\n  },\n\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\n    if (!minAxis) {\n      return [];\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const point = circle.getFurthestPoint(minAxis);\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\n    const local = xf.applyInverse(point);\n    const normal = minAxis.normalize();\n\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: -minAxis.size,\n      axis: normal,\n      point: point,\n      localPoint: local,\n      side: polygon.findSide(normal.negate()),\n      localSide: polygon.findLocalSide(normal.negate())\n    };\n\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\n  },\n\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\n    // TODO not sure this actually abides by local/world collisions\n    // Are edge.begin and edge.end local space or world space? I think they should be local\n\n    // center of the circle in world pos\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const edgeWorld = edge.asLine();\n    const e = edgeWorld.end.sub(edgeWorld.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edgeWorld.end.sub(cc));\n    const v = e.dot(cc.sub(edgeWorld.begin));\n    const side = edge.asLine();\n    const localSide = edge.asLocalLine();\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edgeWorld.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return []; // no collision\n      }\n\n      const normal = da.normalize();\n      const separation = circle.radius - Math.sqrt(dda);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.begin,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\n      ];\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edgeWorld.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return [];\n      }\n\n      const normal = db.normalize();\n      const separation = circle.radius - Math.sqrt(ddb);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.end,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\n      ];\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edgeWorld.begin\n      .scale(u)\n      .add(edgeWorld.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return []; // no collision\n    }\n\n    let normal = e.perpendicular();\n    // flip correct direction\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\n      normal.x = -normal.x;\n      normal.y = -normal.y;\n    }\n\n    normal = normal.normalize();\n    const separation = circle.radius - Math.sqrt(dd);\n\n    const mvt = normal.scale(separation);\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: separation,\n      axis: normal,\n      point: pointOnEdge,\n      side: side,\n      localSide: localSide\n    };\n\n    return [\n      new CollisionContact(\n        circle,\n        edge,\n        mvt,\n        normal.negate(),\n        normal.negate().perpendicular(),\n        [pointOnEdge],\n        [pointOnEdge.sub(edge.worldPos)],\n        info\n      )\n    ];\n  },\n\n  CollideEdgeEdge(): CollisionContact[] {\n    // Edge-edge collision doesn't make sense\n    return [];\n  },\n\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new PolygonCollider({\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\n      offset: edge.offset\n    });\n    linePoly.owner = edge.owner;\n    const tx = edge.owner?.get(TransformComponent);\n    if (tx) {\n      linePoly.update(edge.owner.get(TransformComponent));\n    }\n    // Gross hack but poly-poly works well\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\n    if (contact.length) {\n      // Fudge the contact back to edge\n      contact[0].colliderB = edge;\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\n      // contact[0].info.collider\n    }\n    return contact;\n  },\n\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\n    // Multi contact from SAT\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\n    // do a SAT test to find a min axis if it exists\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\n    // If there is no overlap from boxA's perspective we can end early\n    if (separationA.separation > 0) {\n      return [];\n    }\n\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\n    // If there is no overlap from boxB's perspective exit now\n    if (separationB.separation > 0) {\n      return [];\n    }\n\n    // Separations are both negative, we want to pick the least negative (minimal movement)\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\n\n    // The incident side is the most opposite from the axes of collision on the other collider\n    const other = separation.collider === polyA ? polyB : polyA;\n    const incident = other.findSide(separation.axis.negate()) as Line;\n\n    // Clip incident side by the perpendicular lines at each end of the reference side\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\n    const reference = separation.side;\n    const refDir = reference.dir().normalize();\n\n    // Find our contact points by clipping the incident by the collision side\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\n    let clipLeft: Line | null = null;\n    if (clipRight) {\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\n    }\n\n    // If there is no left there is no collision\n    if (clipLeft) {\n      // We only want clip points below the reference edge, discard the others\n      const points = clipLeft.getPoints().filter((p) => {\n        return reference.below(p);\n      });\n\n      let normal = separation.axis;\n      let tangent = normal.perpendicular();\n      // Point Contact A -> B\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\n        normal = normal.negate();\n        tangent = normal.perpendicular();\n      }\n      // Points are clipped from incident which is the other collider\n      // Store those as locals\n      let localPoints: Vector[] = [];\n      if (separation.collider === polyA) {\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      } else {\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      }\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\n    }\n    return [];\n  },\n\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\n    const shapeA = contact.colliderA;\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\n    const shapeB = contact.colliderB;\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\n\n    // both are circles\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\n      const combinedRadius = shapeA.radius + shapeB.radius;\n      const distance = txA.pos.distance(txB.pos);\n      const separation = combinedRadius - distance;\n      return -separation;\n    }\n\n    // both are polygons\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\n      if (contact.info.localSide) {\n        let side: Line;\n        let worldPoint: Vector;\n        if (contact.info.collider === shapeA) {\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\n          worldPoint = txB.apply(localPoint);\n        } else {\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\n          worldPoint = txA.apply(localPoint);\n        }\n\n        return side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v circle\n    if (\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\n    ) {\n      const worldPoint = txA.apply(localPoint);\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v edge\n    if (\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\n    ) {\n      let worldPoint: Vector;\n      if (contact.info.collider === shapeA) {\n        worldPoint = txB.apply(localPoint);\n      } else {\n        worldPoint = txA.apply(localPoint);\n      }\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // circle v edge\n    if (\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\n    ) {\n      // Local point is always on the edge which is always shapeB\n      const worldPoint = txB.apply(localPoint);\n\n      let circlePoint: Vector;\n      if (shapeA instanceof CircleCollider) {\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\n      }\n\n      const dist = worldPoint.distance(circlePoint);\n\n      if (contact.info.side) {\n        return dist > 0 ? -dist : 0;\n      }\n    }\n\n    return 0;\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface EdgeColliderOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally specify an offset\n   */\n  offset?: Vector;\n}\n\n/**\n * Edge is a single line collider to create collisions with a single line.\n */\nexport class EdgeCollider extends Collider {\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  private _transform: Transform;\n\n  constructor(options: EdgeColliderOptions) {\n    super();\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.offset = options.offset ?? Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): EdgeCollider {\n    return new EdgeCollider({\n      begin: this.begin.clone(),\n      end: this.end.clone()\n    });\n  }\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    return tx?.globalPos.add(this.offset) ?? this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns the closes line between this and another collider, from this -> collider\n   * @param shape\n   */\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: Collider): CollisionContact[] {\n    if (shape instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\n    // this causes problems for the collision system so we give them some padding\n    return new BoundingBox(\n      Math.min(begin.x, end.x) - padding,\n      Math.min(begin.y, end.y) - padding,\n      Math.max(begin.x, end.x) + padding,\n      Math.max(begin.y, end.y) + padding\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in local space\n   */\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Returns this edge represented as a line in world coordinates\n   */\n  public asLine(): Line {\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\n  }\n\n  /**\n   * Return this edge as a line in local line coordinates (relative to the position)\n   */\n  public asLocalLine(): Line {\n    return new Line(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ex.drawLine(begin, end, color, 2);\n    ex.drawCircle(begin, 2, color);\n    ex.drawCircle(end, 2, color);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Color } from '../../Color';\nimport { BoundingBox } from '../BoundingBox';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { Collider } from './Collider';\nimport { ExcaliburGraphicsContext, Logger, range } from '../..';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Shape } from './Shape';\n\nexport interface PolygonColliderOptions {\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   */\n  points: Vector[];\n}\n\n/**\n * Polygon collider for detecting collisions\n */\nexport class PolygonCollider extends Collider {\n  private _logger = Logger.getInstance();\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  public offset: Vector;\n\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   * Excalibur stores these in clockwise order\n   */\n  public points: Vector[];\n\n  private _transform: Transform;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n  private _localSides: Line[] = [];\n\n  constructor(options: PolygonColliderOptions) {\n    super();\n    this.offset = options.offset ?? Vector.Zero;\n    this.points = options.points ?? [];\n    const clockwise = this._isClockwiseWinding(this.points);\n    if (!clockwise) {\n      this.points.reverse();\n    }\n    if (!this.isConvex()) {\n      this._logger.warn(\n        'Excalibur only supports convex polygon colliders and will not behave properly.'+\n        'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles');\n    }\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  private _isClockwiseWinding(points: Vector[]): boolean {\n    // https://stackoverflow.com/a/1165943\n    let sum = 0;\n    for (let i = 0; i < points.length; i++) {\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\n    }\n    return sum < 0;\n  }\n\n  /**\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\n   * Call [[Polygon.triangulate]] to generate a [[CompositeCollider]] from this non-convex shape\n   */\n  public isConvex(): boolean {\n    // From SO: https://stackoverflow.com/a/45372025\n    if (this.points.length < 3) {\n      return false;\n    }\n    let oldPoint = this.points[this.points.length - 2];\n    let newPoint = this.points[this.points.length - 1];\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n    let oldDirection = 0;\n    let orientation = 0;\n    let angleSum = 0;\n    for (const [i, point] of this.points.entries()) {\n      oldPoint = newPoint;\n      oldDirection = direction;\n      newPoint =  point;\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n      if (oldPoint.equals(newPoint)) {\n        return false; // repeat point\n      }\n      let angle = direction - oldDirection;\n      if (angle <= -Math.PI){\n        angle += Math.PI * 2;\n      } else if (angle > Math.PI) {\n        angle -= Math.PI * 2;\n      }\n      if (i === 0) {\n        if (angle === 0.0) {\n          return false;\n        }\n        orientation = angle  > 0 ? 1 : -1;\n      } else {\n        if (orientation * angle <= 0) {\n          return false;\n        }\n      }\n      angleSum += angle;\n    }\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\n  }\n\n  /**\n   * Tessellates the polygon into a triangle fan as a [[CompositeCollider]] of triangle polygons\n   */\n  public tessellate(): CompositeCollider {\n    const polygons: Vector[][] = [];\n    for (let i = 1; i < this.points.length - 2; i++) {\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\n    }\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\n\n    return new CompositeCollider(polygons.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\n   * Returns a new [[CompositeCollider]] made up of smaller triangles.\n   */\n  public triangulate(): CompositeCollider {\n    // https://www.youtube.com/watch?v=hTJFcHutls8\n    if (this.points.length < 3) {\n      throw Error('Invalid polygon');\n    }\n\n    /**\n     * Helper to get a vertex in the list\n     */\n    function getItem<T>(index: number, list: T[]) {\n      if (index >= list.length) {\n        return list[index % list.length];\n      } else if (index < 0) {\n        return list[index % list.length + list.length];\n      } else {\n        return list[index];\n      }\n    }\n\n    /**\n     * Quick test for point in triangle\n     */\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\n      const ab = b.sub(a);\n      const bc = c.sub(b);\n      const ca = a.sub(c);\n\n      const ap = point.sub(a);\n      const bp = point.sub(b);\n      const cp = point.sub(c);\n\n      const cross1 = ab.cross(ap);\n      const cross2 = bc.cross(bp);\n      const cross3 = ca.cross(cp);\n\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\n        return false;\n      }\n      return true;\n    }\n\n    const triangles: Vector[][] = [];\n    const vertices = [...this.points];\n    const indices = range(0, this.points.length - 1);\n\n    // 1. Loop through vertices clockwise\n    //    if the vertex is convex (interior angle is < 180) (cross product positive)\n    //    if the polygon formed by it's edges doesn't contain the points\n    //         it's an ear add it to our list of triangles, and restart\n\n    while (indices.length > 3) {\n      for (let i = 0; i < indices.length; i++) {\n        const a = indices[i];\n        const b = getItem(i - 1, indices);\n        const c = getItem(i + 1, indices);\n\n        const va = vertices[a];\n        const vb = vertices[b];\n        const vc = vertices[c];\n\n        // Check convexity\n        const leftArm = vb.sub(va);\n        const rightArm = vc.sub(va);\n        const isConvex = rightArm.cross(leftArm) > 0; // positive cross means convex\n        if (!isConvex) {\n          continue;\n        }\n\n        let isEar = true;\n        // Check that if any vertices are in the triangle a, b, c\n        for (let j = 0; j < indices.length; j++) {\n          const vertIndex = indices[j];\n          // We can skip these\n          if (vertIndex === a || vertIndex === b || vertIndex === c) {\n            continue;\n          }\n\n          const point = vertices[vertIndex];\n          if (isPointInTriangle(point, vb, va, vc)) {\n            isEar = false;\n            break;\n          }\n        }\n\n        // Add ear to polygon list and remove from list\n        if (isEar) {\n          triangles.push([vb, va, vc]);\n          indices.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    triangles.push([vertices[indices[0]], vertices[indices[1]], vertices[indices[2]]]);\n\n    return new CompositeCollider(triangles.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): PolygonCollider {\n    return new PolygonCollider({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone())\n    });\n  }\n\n  /**\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\n   */\n  public get worldPos(): Vector {\n    if (this._transform) {\n      return this._transform.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const transform = this._transform as TransformComponent;\n\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\n    const angle = transform ? transform.globalRotation : 0;\n    const scale = transform ? transform.globalScale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    this._calculateTransformation();\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  /**\n   * Returns the local coordinate space sides\n   */\n  public getLocalSides(): Line[] {\n    if (this._localSides.length) {\n      return this._localSides;\n    }\n    const lines = [];\n    const points = this.points;\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._localSides = lines;\n    return this._localSides;\n  }\n\n  /**\n   * Given a direction vector find the world space side that is most in that direction\n   * @param direction\n   */\n  public findSide(direction: Vector): Line {\n    const sides = this.getSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Given a direction vector find the local space side that is most in that direction\n   * @param direction\n   */\n  public findLocalSide(direction: Vector): Line {\n    const sides = this.getLocalSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n    const axes = this.getSides().map((s) => s.normal());\n    this._axes = axes;\n    return this._axes;\n  }\n\n  public update(transform: Transform): void {\n    this._transform = transform;\n    this._sides.length = 0;\n    this._localSides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n    this.getLocalSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collider in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function (accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  public getClosestLineBetween(collider: Collider): Line {\n    if (collider instanceof CircleCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\n   * return null.\n   * @param collider\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Find the local point on the collider furthest in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const pts = this.points;\n    let furthestPoint = pts[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const effectiveOffset = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n\n    const firstPoint = this.points[0].add(effectiveOffset);\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    // Points are relative\n    this.points\n      .map((p) => p.add(effectiveOffset))\n      .forEach(function (point) {\n        ctx.lineTo(point.x, point.y);\n      });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const firstPoint = this.getTransformedPoints()[0];\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\n    for (let i = 0; i < points.length - 1; i++) {\n      ex.drawLine(points[i], points[i + 1], color, 2);\n      ex.drawCircle(points[i], 2, color);\n      ex.drawCircle(points[i + 1], 2, color);\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function (point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { PolygonCollider } from './PolygonCollider';\nimport { CircleCollider } from './CircleCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { BoundingBox } from '../BoundingBox';\nimport { vec, Vector } from '../../Math/vector';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Logger } from '../..';\n\n/**\n * Excalibur helper for defining colliders quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\n   *\n   * PolygonColliders are useful for creating convex polygon shapes\n   * @param points Points specified in counter clockwise\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: points,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[CircleCollider|circle]] collider\n   *\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\n   * @param radius Radius of the circle collider\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\n    return new CircleCollider({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[EdgeCollider|edge]] collider\n   *\n   * Edge colliders are useful for  floors, walls, and other barriers\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\n    return new EdgeCollider({\n      begin: begin,\n      end: end\n    });\n  }\n\n  /**\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\n   *\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\n   * player experience.\n   *\n   * @param width\n   * @param height\n   * @param offset Optional offset\n   */\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\n    const logger = Logger.getInstance();\n    if (width === height) {\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\n    }\n\n    const vertical = height >= width;\n\n    if (vertical) {\n      // height > width, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\n        Shape.Box(width, height - width, Vector.Half, offset),\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\n      ]);\n      return capsule;\n    } else {\n      // width > height, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\n        Shape.Box(width - height, height, Vector.Half, offset),\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\n      ]);\n      return capsule;\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport { Observable } from '../Util/Observable';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { CircleCollider } from './Colliders/CircleCollider';\nimport { Collider } from './Colliders/Collider';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { PolygonCollider } from './Colliders/PolygonCollider';\nimport { EdgeCollider } from './Colliders/EdgeCollider';\nimport { Shape } from './Colliders/Shape';\n\nexport class ColliderComponent extends Component<'ex.collider'> {\n  public readonly type = 'ex.collider';\n\n  public events = new EventDispatcher();\n  /**\n   * Observable that notifies when a collider is added to the body\n   */\n  public $colliderAdded = new Observable<Collider>();\n\n  /**\n   * Observable that notifies when a collider is removed from the body\n   */\n  public $colliderRemoved = new Observable<Collider>();\n\n  constructor(collider?: Collider) {\n    super();\n    this.set(collider);\n  }\n\n  private _collider: Collider;\n  /**\n   * Get the current collider geometry\n   */\n  public get() {\n    return this._collider;\n  }\n\n  /**\n   * Set the collider geometry\n   * @param collider\n   * @returns the collider you set\n   */\n  public set<T extends Collider>(collider: T): T {\n    this.clear();\n    if (collider) {\n      this._collider = collider;\n      this._collider.owner = this.owner;\n      this.events.wire(collider.events);\n      this.$colliderAdded.notifyAll(collider);\n      this.update();\n    }\n    return collider;\n  }\n\n  /**\n   * Remove collider geometry from collider component\n   */\n  public clear() {\n    if (this._collider) {\n      this.events.unwire(this._collider.events);\n      this.$colliderRemoved.notifyAll(this._collider);\n      this._collider.owner = null;\n      this._collider = null;\n    }\n  }\n\n  /**\n   * Return world space bounds\n   */\n  public get bounds() {\n    return this._collider?.bounds ?? new BoundingBox();\n  }\n\n  /**\n   * Return local space bounds\n   */\n  public get localBounds() {\n    return this._collider?.localBounds ?? new BoundingBox();\n  }\n\n  /**\n   * Update the collider's transformed geometry\n   */\n  public update() {\n    const tx = this.owner?.get(TransformComponent);\n    if (this._collider) {\n      this._collider.owner = this.owner;\n      if (tx) {\n        this._collider.update(tx);\n      }\n    }\n  }\n\n  /**\n   * Collide component with another\n   * @param other\n   */\n  collide(other: ColliderComponent): CollisionContact[] {\n    let colliderA = this._collider;\n    let colliderB = other._collider;\n    if (!colliderA || !colliderB) {\n      return [];\n    }\n\n    // If we have a composite lefthand side :(\n    // Might bite us, but to avoid updating all the handlers make composite always left side\n    let flipped = false;\n    if (colliderB instanceof CompositeCollider) {\n      colliderA = colliderB;\n      colliderB = this._collider;\n      flipped = true;\n    }\n\n    if (this._collider) {\n      const contacts = colliderA.collide(colliderB);\n      if (contacts) {\n        if (flipped) {\n          contacts.forEach((contact) => {\n            contact.mtv = contact.mtv.negate();\n            contact.normal = contact.normal.negate();\n            contact.tangent = contact.normal.perpendicular();\n            contact.colliderA = this._collider;\n            contact.colliderB = other._collider;\n          });\n        }\n        return contacts;\n      }\n      return [];\n    }\n    return [];\n  }\n\n  onAdd(entity: Entity) {\n    if (this._collider) {\n      this.update();\n    }\n    // Wire up the collider events to the owning entity\n    this.events.on('precollision', (evt: any) => {\n      const precollision = evt as PreCollisionEvent<Collider>;\n      entity.events.emit(\n        'precollision',\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\n      );\n    });\n    this.events.on('postcollision', (evt: any) => {\n      const postcollision = evt as PostCollisionEvent<Collider>;\n      entity.events.emit(\n        'postcollision',\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\n      );\n    });\n    this.events.on('collisionstart', (evt: any) => {\n      const start = evt as CollisionStartEvent<Collider>;\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\n    });\n    this.events.on('collisionend', (evt: any) => {\n      const end = evt as CollisionEndEvent<Collider>;\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\n    });\n  }\n\n  onRemove() {\n    this.events.clear();\n    this.$colliderRemoved.notifyAll(this._collider);\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\n    const collider = Shape.Box(width, height, anchor, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\n    const poly = Shape.Polygon(points, center);\n    return (this.set(poly));\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\n    const collider = Shape.Circle(radius, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\n    const collider = Shape.Edge(begin, end);\n    return (this.set(collider));\n  }\n\n  /**\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\n   * @param colliders\n   */\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\n    return (this.set(new CompositeCollider(colliders)));\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from './Physics';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { CollisionGroup } from './Group/CollisionGroup';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { createId, Id } from '../Id';\nimport { clamp } from '../Math/util';\nimport { ColliderComponent } from './ColliderComponent';\n\nexport interface BodyComponentOptions {\n  type?: CollisionType;\n  group?: CollisionGroup;\n  useGravity?: boolean;\n}\n\nexport enum DegreeOfFreedom {\n  Rotation = 'rotation',\n  X = 'x',\n  Y = 'y'\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\n * of physics simulation.\n */\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\n  public readonly type = 'ex.body';\n  public dependencies = [TransformComponent, MotionComponent];\n  public static _ID = 0;\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\n  public events = new EventDispatcher();\n\n  constructor(options?: BodyComponentOptions) {\n    super();\n    if (options) {\n      this.collisionType = options.type ?? this.collisionType;\n      this.group = options.group ?? this.group;\n      this.useGravity = options.useGravity ?? this.useGravity;\n    }\n  }\n\n  /**\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\n   */\n  public collisionType: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * The collision group for the body's colliders, by default body colliders collide with everything\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /**\n   * The amount of mass the body has\n   */\n  public mass: number = Physics.defaultMass;\n\n  /**\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseMass(): number {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\n  }\n\n  /**\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\n   */\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\n\n  /**\n   * Can this body sleep, by default bodies do not sleep\n   */\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\n\n  private _sleeping = false;\n  /**\n   * Whether this body is sleeping or not\n   */\n  public get sleeping(): boolean {\n    return this._sleeping;\n  }\n\n  /**\n   * Set the sleep state of the body\n   * @param sleeping\n   */\n  public setSleeping(sleeping: boolean) {\n    this._sleeping = sleeping;\n    if (!sleeping) {\n      // Give it a kick to keep it from falling asleep immediately\n      this.sleepMotion = Physics.sleepEpsilon * 5;\n    } else {\n      this.vel = Vector.Zero;\n      this.acc = Vector.Zero;\n      this.angularVelocity = 0;\n      this.sleepMotion = 0;\n    }\n  }\n\n  /**\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\n   */\n  public updateMotion() {\n    if (this._sleeping) {\n      this.setSleeping(true);\n    }\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\n    const bias = Physics.sleepBias;\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\n      this.setSleeping(true);\n    }\n  }\n\n  /**\n   * Get the moment of inertia from the [[ColliderComponent]]\n   */\n  public get inertia() {\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\n    const collider = this.owner.get(ColliderComponent);\n    if (collider?.get()) {\n      return collider.get().getInertia(this.mass);\n    }\n    return 0;\n  }\n\n  /**\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseInertia() {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\n  }\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\n   */\n  public useGravity: boolean = true;\n\n  /**\n   * Degrees of freedom to limit\n   */\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\n\n  /**\n   * Returns if the owner is active\n   */\n  public get active() {\n    return !!this.owner?.active;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  public get transform(): TransformComponent {\n    return this.owner?.get(TransformComponent);\n  }\n\n  public get motion(): MotionComponent {\n    return this.owner?.get(MotionComponent);\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public get pos(): Vector {\n    return this.transform.globalPos;\n  }\n\n  public set pos(val: Vector) {\n    this.transform.globalPos = val;\n  }\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this.motion.vel = val;\n  }\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  public set acc(val: Vector) {\n    this.motion.acc = val;\n  }\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public get torque(): number {\n    return this.motion.torque;\n  }\n\n  public set torque(val: number) {\n    this.motion.torque = val;\n  }\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the body in radians\n   */\n  public get rotation() {\n    return this.transform.globalRotation;\n  }\n\n  public set rotation(val: number) {\n    this.transform.globalRotation = val;\n  }\n\n  /**\n   * The scale vector of the actor\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\n   */\n  public get scale(): Vector {\n    return this.transform.globalScale;\n  }\n\n  public set scale(val: Vector) {\n    this.transform.globalScale = val;\n  }\n\n  /**\n   * The scale of the actor last frame\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sx(): number {\n    return this.motion.scaleFactor.x;\n  }\n\n  public set sx(xFactor: number) {\n    this.motion.scaleFactor.x = xFactor;\n  }\n\n  /**\n   * The y scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sy(): number {\n    return this.motion.scaleFactor.y;\n  }\n\n  public set sy(yFactor: number) {\n    this.motion.scaleFactor.y = yFactor;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public get rx(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public set rx(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Get the angular velocity in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Set the angular velocity in radians/second\n   */\n  public set angularVelocity(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Apply a specific impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel.addEqual(finalImpulse);\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Apply only linear impulse to the body\n   * @param impulse\n   */\n  public applyLinearImpulse(impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel = this.vel.add(finalImpulse);\n  }\n\n  /**\n   * Apply only angular impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Component, ComponentCtor, TagComponent } from './Component';\n\nimport { Observable, Message } from '../Util/Observable';\nimport { Class } from '../Class';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\nimport { Engine } from '../Engine';\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Util } from '..';\n\n/**\n * Interface holding an entity component pair\n */\nexport interface EntityComponent {\n  component: Component;\n  entity: Entity;\n}\n\n/**\n * AddedComponent message\n */\nexport class AddedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Added' = 'Component Added';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is f an Added Component\n */\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\n  return !!x && x.type === 'Component Added';\n}\n\n/**\n * RemovedComponent message\n */\nexport class RemovedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Removed' = 'Component Removed';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is for a Removed Component\n */\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\n  return !!x && x.type === 'Component Removed';\n}\n\n/**\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\n *\n * Entities can be strongly typed with the components they contain\n *\n * ```typescript\n * const entity = new Entity<ComponentA | ComponentB>();\n * entity.components.a; // Type ComponentA\n * entity.components.b; // Type ComponentB\n * ```\n */\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\n  private static _ID = 0;\n\n  constructor(components?: Component[], name?: string) {\n    super();\n    this._setName(name);\n    if (components) {\n      for (const component of components) {\n        this.addComponent(component);\n      }\n    }\n  }\n\n  /**\n   * The unique identifier for the entity\n   */\n  public id: number = Entity._ID++;\n\n  private _name: string = 'anonymous';\n  protected _setName(name: string) {\n    if (name) {\n      this._name = name;\n    }\n  }\n  public get name(): string {\n    return this._name;\n  }\n\n  public get events(): EventDispatcher {\n    return this.eventDispatcher;\n  }\n\n  /**\n   * Whether this entity is active, if set to false it will be reclaimed\n   */\n  public active: boolean = true;\n\n  /**\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\n   */\n  public kill() {\n    this.active = false;\n  }\n\n  public isKilled() {\n    return !this.active;\n  }\n\n  /**\n   * Specifically get the tags on the entity from [[TagComponent]]\n   */\n  public get tags(): readonly string[] {\n    return this._tagsMemo;\n  }\n\n  /**\n   * Check if a tag exists on the entity\n   * @param tag name to check for\n   */\n  public hasTag(tag: string): boolean {\n    return this.tags.includes(tag);\n  }\n\n  /**\n   * Adds a tag to an entity\n   * @param tag\n   * @returns Entity\n   */\n  public addTag(tag: string) {\n    return this.addComponent(new TagComponent(tag));\n  }\n\n  /**\n   * Removes a tag on the entity\n   *\n   * Removals are deferred until the end of update\n   * @param tag\n   * @param force Remove component immediately, no deferred\n   */\n  public removeTag(tag: string, force = false) {\n    return this.removeComponent(tag, force);\n  }\n\n  /**\n   * The types of the components on the Entity\n   */\n  public get types(): string[] {\n    return this._typesMemo;\n  }\n\n  /**\n   * Bucket to hold on to deferred removals\n   */\n  private _componentsToRemove: (Component | string)[] = [];\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\n  private _componentStringToInstance = new Map<string, Component>();\n\n  private _tagsMemo: string[] = [];\n  private _typesMemo: string[] = [];\n  private _rebuildMemos() {\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\n      .filter((c) => c instanceof TagComponent)\n      .map((c) => c.type);\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\n  }\n\n  public getComponents(): Component[] {\n    return Array.from(this._componentStringToInstance.values());\n  }\n\n  /**\n   * Observable that keeps track of component add or remove changes on the entity\n   */\n  public componentAdded$ = new Observable<AddedComponent>();\n  private _notifyAddComponent(component: Component) {\n    this._rebuildMemos();\n    const added = new AddedComponent({\n      component,\n      entity: this\n    });\n    this.componentAdded$.notifyAll(added);\n  }\n\n  public componentRemoved$ = new Observable<RemovedComponent>();\n  private _notifyRemoveComponent(component: Component) {\n    const removed = new RemovedComponent({\n      component,\n      entity: this\n    });\n    this.componentRemoved$.notifyAll(removed);\n    this._rebuildMemos();\n  }\n\n  private _parent: Entity = null;\n  public get parent(): Entity {\n    return this._parent;\n  }\n\n  public childrenAdded$ = new Observable<Entity>();\n  public childrenRemoved$ = new Observable<Entity>();\n\n  private _children: Entity[] = [];\n  /**\n   * Get the direct children of this entity\n   */\n  public get children(): readonly Entity[] {\n    return this._children;\n  }\n\n  /**\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\n   */\n  public unparent() {\n    if (this._parent) {\n      this._parent.removeChild(this);\n      this._parent = null;\n    }\n  }\n\n  /**\n   * Adds an entity to be a child of this entity\n   * @param entity\n   */\n  public addChild(entity: Entity): Entity {\n    if (entity.parent === null) {\n      if (this.getAncestors().includes(entity)) {\n        throw new Error('Cycle detected, cannot add entity');\n      }\n      this._children.push(entity);\n      entity._parent = this;\n      this.childrenAdded$.notifyAll(entity);\n    } else {\n      throw new Error('Entity already has a parent, cannot add without unparenting');\n    }\n    return this;\n  }\n\n  /**\n   * Remove an entity from children if it exists\n   * @param entity\n   */\n  public removeChild(entity: Entity): Entity {\n    if (entity.parent === this) {\n      Util.removeItemFromArray(entity, this._children);\n      entity._parent = null;\n      this.childrenRemoved$.notifyAll(entity);\n    }\n    return this;\n  }\n\n  /**\n   * Removes all children from this entity\n   */\n  public removeAllChildren(): Entity {\n    this.children.forEach((c) => {\n      this.removeChild(c);\n    });\n    return this;\n  }\n\n  /**\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\n   */\n  public getAncestors(): Entity[] {\n    const result: Entity[] = [this];\n    let current = this.parent;\n    while (current) {\n      result.push(current);\n      current = current.parent;\n    }\n    return result.reverse();\n  }\n\n  /**\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\n   */\n  public getDescendants(): Entity[] {\n    let result: Entity[] = [this];\n    let queue: Entity[] = [this];\n    while (queue.length > 0) {\n      const curr = queue.pop();\n      queue = queue.concat(curr.children);\n      result = result.concat(curr.children);\n    }\n    return result;\n  }\n\n  /**\n   * Creates a deep copy of the entity and a copy of all its components\n   */\n  public clone(): Entity {\n    const newEntity = new Entity();\n    for (const c of this.types) {\n      newEntity.addComponent(this.get(c).clone());\n    }\n    for (const child of this.children) {\n      newEntity.addChild(child.clone());\n    }\n    return newEntity;\n  }\n\n  /**\n   * Adds a copy of all the components from another template entity as a \"prefab\"\n   * @param templateEntity Entity to use as a template\n   * @param force Force component replacement if it already exists on the target entity\n   */\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\n    for (const c of templateEntity.getComponents()) {\n      this.addComponent(c.clone(), force);\n    }\n    for (const child of templateEntity.children) {\n      this.addChild(child.clone().addTemplate(child));\n    }\n    return this;\n  }\n\n  /**\n   * Adds a component to the entity\n   * @param component Component or Entity to add copy of components from\n   * @param force Optionally overwrite any existing components of the same type\n   */\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\n    // if component already exists, skip if not forced\n    if (this.has(component.type)) {\n      if (force) {\n        // Remove existing component type if exists when forced\n        this.removeComponent(component);\n      } else {\n        // early exit component exits\n        return this;\n      }\n    }\n\n    // TODO circular dependencies will be a problem\n    if (component.dependencies && component.dependencies.length) {\n      for (const ctor of component.dependencies) {\n        this.addComponent(new ctor());\n      }\n    }\n\n    component.owner = this;\n    const constuctorType = component.constructor as ComponentCtor<T>;\n    this._componentTypeToInstance.set(constuctorType, component);\n    this._componentStringToInstance.set(component.type, component);\n    if (component.onAdd) {\n      component.onAdd(this);\n    }\n    this._notifyAddComponent(component);\n\n    return this;\n  }\n\n  /**\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\n   *\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\n   * @param componentOrType\n   * @param force\n   */\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\n    if (force) {\n      if (typeof componentOrType === 'string') {\n        this._removeComponentByType(componentOrType);\n      } else if (componentOrType instanceof Component) {\n        this._removeComponentByType(componentOrType.type);\n      }\n    } else {\n      this._componentsToRemove.push(componentOrType);\n    }\n\n    return this as any;\n  }\n\n  private _removeComponentByType(type: string) {\n    if (this.has(type)) {\n      const component = this.get(type);\n      component.owner = null;\n      if (component.onRemove) {\n        component.onRemove(this);\n      }\n      const ctor = component.constructor as ComponentCtor;\n      this._componentTypeToInstance.delete(ctor);\n      this._componentStringToInstance.delete(component.type);\n      this._notifyRemoveComponent(component);\n    }\n  }\n\n  /**\n   * @hidden\n   * @internal\n   */\n  public processComponentRemoval() {\n    for (const componentOrType of this._componentsToRemove) {\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\n      this._removeComponentByType(type);\n    }\n    this._componentsToRemove.length = 0;\n  }\n\n  /**\n   * Check if a component type exists\n   * @param type\n   */\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\n  public has(type: string): boolean;\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.has(type);\n    } else {\n      return this._componentTypeToInstance.has(type);\n    }\n  }\n\n  /**\n   * Get a component by type with typecheck\n   *\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\n   * @param type\n   */\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\n  public get<T extends Component>(type: string): T | null;\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.get(type) as T;\n    } else {\n      return this._componentTypeToInstance.get(type) as T;\n    }\n  }\n\n  private _isInitialized = false;\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\n   * overridden.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an entity is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an entity is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   *\n   * Entity update lifecycle, called internally\n   *\n   * @internal\n   * @param engine\n   * @param delta\n   */\n  public update(engine: Engine, delta: number): void {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n    for (const child of this.children) {\n      child.update(engine, delta);\n    }\n    this._postupdate(engine, delta);\n  }\n}\n","import { Component } from '../EntityComponentSystem';\n\n/**\n * Shim to draw to the canvas when in LegacyDrawing mode\n * @deprecated\n */\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\n  public readonly type = 'ex.canvas';\n\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\n    super();\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    this.draw = this.draw ?? (() => {});\n  }\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Graphic } from './Graphic';\nimport { HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Logger } from '../Util/Log';\nimport { BoundingBox } from '../Collision/Index';\nimport { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\n * @param graphic\n */\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\n  return !!(graphic as unknown as HasTick).tick;\n}\nexport interface GraphicsShowOptions {\n  offset?: Vector;\n  anchor?: Vector;\n}\n\nexport interface GraphicsComponentOptions {\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n\n  /**\n   * Name of current graphic to use\n   */\n  current?: string;\n\n  /**\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\n   */\n  copyGraphics?: boolean;\n\n  /**\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\n   */\n  visible?: boolean;\n\n  /**\n   * Optional opacity\n   */\n  opacity?: number;\n\n  /**\n   * List of graphics\n   */\n  graphics?: { [graphicName: string]: Graphic };\n\n  /**\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\n   */\n  offset?: Vector;\n\n  /**\n   * Optional anchor\n   */\n  anchor?: Vector;\n}\n\nexport interface GraphicsLayerOptions {\n  /**\n   * Name of the layer required, for example 'background'\n   */\n  name: string;\n  /**\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\n   */\n  order: number;\n  /**\n   * Offset to shift the entire layer\n   */\n  offset?: Vector;\n}\nexport class GraphicsLayer {\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\n  public get name(): string {\n    return this._options.name;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in this layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in this layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    if (!nameOrGraphic) {\n      this.graphics.length = 0;\n    } else {\n      let gfx: Graphic = null;\n      if (nameOrGraphic instanceof Graphic) {\n        gfx = nameOrGraphic;\n      } else {\n        gfx = this._graphics.getGraphic(nameOrGraphic);\n      }\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\n      this._graphics.recalculateBounds();\n    }\n  }\n\n  /**\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\n   *\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\n   * @param nameOrGraphic\n   * @param options\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    let gfx: Graphic;\n    if (nameOrGraphic instanceof Graphic) {\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\n    } else {\n      gfx = this._graphics.getGraphic(nameOrGraphic);\n      if (!gfx) {\n        Logger.getInstance().error(\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\n          this._graphics.getNames()\n        );\n      }\n    }\n    if (gfx) {\n      this.graphics.push({ graphic: gfx, options });\n      this._graphics.recalculateBounds();\n      return gfx as T;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Use a specific graphic, swap out any current graphics being shown\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    this.hide();\n    return this.show<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public get order(): number {\n    return this._options.order;\n  }\n\n  /**\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public set order(order: number) {\n    this._options.order = order;\n  }\n\n  /**\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\n   */\n  public get offset(): Vector {\n    return this._options.offset ?? Vector.Zero;\n  }\n\n  public set offset(value: Vector) {\n    this._options.offset = value;\n  }\n\n  public get currentKeys(): string {\n    return this.name ?? 'anonymous';\n  }\n}\n\nexport class GraphicsLayers {\n  private _layers: GraphicsLayer[] = [];\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\n  public default: GraphicsLayer;\n  constructor(private _component: GraphicsComponent) {\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\n    this._maybeAddLayer(this.default);\n  }\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\n    const layer = new GraphicsLayer(options, this._component);\n    return this._maybeAddLayer(layer);\n  }\n\n  /**\n   * Retrieve a single layer by name\n   * @param name\n   */\n  public get(name: string): GraphicsLayer;\n  /**\n   * Retrieve all layers\n   */\n  public get(): readonly GraphicsLayer[];\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\n    if (name) {\n      return this._getLayer(name);\n    }\n    return this._layers;\n  }\n\n  public currentKeys() {\n    const graphicsLayerKeys = [];\n    for (const layer of this._layers) {\n      graphicsLayerKeys.push(layer.currentKeys);\n    }\n    return graphicsLayerKeys;\n  }\n\n  public has(name: string): boolean {\n    return name in this._layerMap;\n  }\n\n  private _maybeAddLayer(layer: GraphicsLayer) {\n    if (this._layerMap[layer.name]) {\n      // todo log warning\n      return this._layerMap[layer.name];\n    }\n    this._layerMap[layer.name] = layer;\n    this._layers.push(layer);\n    this._layers.sort((a, b) => a.order - b.order);\n    return layer;\n  }\n\n  private _getLayer(name: string): GraphicsLayer | undefined {\n    return this._layerMap[name];\n  }\n}\n\n/**\n * Component to manage drawings, using with the position component\n */\nexport class GraphicsComponent extends Component<'ex.graphics'> {\n  readonly type = 'ex.graphics';\n\n  private _graphics: { [graphicName: string]: Graphic } = {};\n\n  public layers: GraphicsLayers;\n\n  public getGraphic(name: string): Graphic | undefined {\n    return this._graphics[name];\n  }\n\n  /**\n   * Get registered graphics names\n   */\n  public getNames(): string[] {\n    return Object.keys(this._graphics);\n  }\n\n  /**\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\n   */\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\n   */\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Sets or gets wether any drawing should be visible in this component\n   */\n  public visible: boolean = true;\n\n  /**\n   * Sets or gets wither all drawings should have an opacity applied\n   */\n  public opacity: number = 1;\n\n  /**\n   * Offset to apply to graphics by default\n   */\n  public offset: Vector = Vector.Zero;\n\n  /**\n   * Anchor to apply to graphics by default\n   */\n  public anchor: Vector = Vector.Half;\n\n  /**\n   * If set to true graphics added to the component will be copied. This can affect performance\n   */\n  public copyGraphics: boolean = false;\n\n  constructor(options?: GraphicsComponentOptions) {\n    super();\n    // Defaults\n    options = {\n      visible: this.visible,\n      ...options\n    };\n\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\n\n    this._graphics = graphics || {};\n    this.offset = offset ?? this.offset;\n    this.opacity = opacity ?? this.opacity;\n    this.anchor = anchor ?? this.anchor;\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\n    this.visible = !!visible;\n\n    this.layers = new GraphicsLayers(this);\n    if (current && this._graphics[current]) {\n      this.show(this._graphics[current]);\n    }\n  }\n\n  /**\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\n   */\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\n    return this.layers.default.graphics;\n  }\n\n  /**\n   * Returns all graphics associated with this component\n   */\n  public get graphics(): { [graphicName: string]: Graphic } {\n    return this._graphics;\n  }\n\n  /**\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\n   * `show(\"default\")`\n   * @param graphic\n   */\n  public add(graphic: Graphic): Graphic;\n  public add(name: string, graphic: Graphic): Graphic;\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\n    let name = 'default';\n    let graphicToSet: Graphic = null;\n    if (typeof nameOrGraphic === 'string') {\n      name = nameOrGraphic;\n      graphicToSet = graphic;\n    } else {\n      graphicToSet = nameOrGraphic;\n    }\n\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\n    if (name === 'default') {\n      this.show('default');\n    }\n    return graphicToSet;\n  }\n\n  /**\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.show<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.use<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in the **default** layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    this.layers.default.hide(nameOrGraphic);\n  }\n\n  private _localBounds: BoundingBox = null;\n  public set localBounds(bounds: BoundingBox) {\n    this._localBounds = bounds;\n  }\n\n  public recalculateBounds() {\n    let bb = new BoundingBox();\n    for (const layer of this.layers.get()) {\n      for (const { graphic, options } of layer.graphics) {\n        let anchor = this.anchor;\n        let offset = this.offset;\n        if (options?.anchor) {\n          anchor = options.anchor;\n        }\n        if (options?.offset) {\n          offset = options.offset;\n        }\n        const bounds = graphic.localBounds;\n        const offsetX = -bounds.width *  anchor.x + offset.x;\n        const offsetY = -bounds.height *  anchor.y + offset.y;\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\n      }\n    }\n    this._localBounds = bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    if (!this._localBounds) {\n      this.recalculateBounds();\n    }\n    return this._localBounds;\n  }\n\n  /**\n   * Update underlying graphics if necesary, called internally\n   * @param elapsed\n   * @internal\n   */\n  public update(elapsed: number, idempotencyToken: number = 0) {\n    for (const layer of this.layers.get()) {\n      for (const { graphic } of layer.graphics) {\n        if (hasGraphicsTick(graphic)) {\n          graphic?.tick(elapsed, idempotencyToken);\n        }\n      }\n    }\n  }\n}\n","import { Raster, RasterOptions } from './Raster';\n\nexport interface RectangleOptions {\n  width: number;\n  height: number;\n}\n\n/**\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\n */\nexport class Rectangle extends Raster {\n  constructor(options: RasterOptions & RectangleOptions) {\n    super(options);\n    this.width = options.width;\n    this.height = options.height;\n    this.rasterize();\n  }\n\n  public clone(): Rectangle {\n    return new Rectangle({\n      width: this.width,\n      height: this.height,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.color) {\n      ctx.fillRect(0, 0, this.width, this.height);\n    }\n    if (this.strokeColor) {\n      ctx.strokeRect(0, 0, this.width, this.height);\n    }\n  }\n}\n","import { ImageFiltering } from '.';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CircleOptions {\n  radius: number;\n}\n\n/**\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\n *\n * Circles default to [[ImageFiltering.Blended]]\n */\nexport class Circle extends Raster {\n  private _radius: number = 0;\n  public get radius() {\n    return this._radius;\n  }\n  public set radius(value: number) {\n    this._radius = value;\n    this.width = this._radius * 2;\n    this.height = this._radius * 2;\n    this.flagDirty();\n  }\n  constructor(options: RasterOptions & CircleOptions) {\n    super(options);\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\n    this.radius = options.radius;\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Circle {\n    return new Circle({\n      radius: this.radius,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.radius > 0) {\n      ctx.beginPath();\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\n\n      if (this.color) {\n        ctx.fill();\n      }\n\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Add this component to optionally configure how the pointer\n * system detects pointer events.\n *\n * By default the collider shape is used and graphics bounds is not.\n *\n * If both collider shape and graphics bounds are enabled it will fire events if either or\n * are intersecting the pointer.\n */\nexport class PointerComponent extends Component<'ex.pointer'> {\n  public readonly type = 'ex.pointer';\n  /**\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\n   * user pointer events only to trigger on the same collision geometry used in the collider component\n   * for collision resolution. Default is `true`.\n   */\n  public useColliderShape = true;\n  /**\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\n   * bounds around the graphic to trigger pointer events. Default is `false`.\n   */\n  public useGraphicsBounds = false;\n}","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Entity } from '../EntityComponentSystem/Entity';\nimport { Action } from './Action';\n\n/**\n * Action Queues represent an ordered sequence of actions\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _entity: Entity;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  /**\n   * Add an action to the sequence\n   * @param action\n   */\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  /**\n   * Remove an action by reference from the sequence\n   * @param action\n   */\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  /**\n   * Removes all actions from this sequence\n   */\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  /**\n   *\n   * @returns The total list of actions in this sequence complete or not\n   */\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  /**\n   *\n   * @returns `true` if there are more actions to process in the sequence\n   */\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  /**\n   * @returns `true` if the current sequence of actions is done\n   */\n  public isComplete(): boolean {\n    return this._actions.length === 0;\n  }\n\n  /**\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\n   */\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  /**\n   * Update the queue which updates actions and handles completing actions\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(elapsedMs);\n\n      if (this._currentAction.isComplete(this._entity)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\nexport class Repeat implements Action {\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    this._repeatBuilder(this._repeatContext);\n    this._repeat--; // current execution is the first repeat\n  }\n\n  public update(delta: number): void {\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\n/**\n * RepeatForever Action implementation, it is recommended you use the fluent action\n * context API.\n *\n *\n */\nexport class RepeatForever implements Action {\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeatBuilder(this._repeatContext);\n  }\n\n  public update(delta: number): void {\n    if (this._stopped) {\n      return;\n    }\n\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class MoveBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _entity: Entity;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\n    this._entity = entity;\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    if (this.isComplete(this._entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    } else {\n      this._motion.vel = this._dir.scale(this._speed);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class MoveTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete(this.entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { vec } from '../../Math/vector';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\nimport { Entity } from '../../EntityComponentSystem/Entity';\n\nexport class ScaleTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._tx.scale.x;\n      this._startY = this._tx.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.x = this._speedX * directionX;\n    } else {\n      this._motion.scaleFactor.x = 0;\n    }\n\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.y = this._speedY * directionY;\n    } else {\n      this._motion.scaleFactor.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._tx.scale = vec(this._endX, this._endY);\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\n\nexport class ScaleBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._tx.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._tx.scale = this._endScale;\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class CallMethod implements Action {\n  private _method: () => any = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(method: () => any) {\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method();\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n","import { Entity} from '../../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Actor } from '../../Actor';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class EaseTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    entity: Entity,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    // Need to update lerp time first, otherwise the first update will always be zero\n    this._currentLerpTime += delta;\n    let newX = this._tx.pos.x;\n    let newY = this._tx.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      // Given the lerp position figure out the velocity in pixels per second\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\n    } else {\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n      this._motion.vel = Vector.Zero;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n}\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\n\nexport class Blink implements Action {\n  private _graphics: GraphicsComponent;\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n    if (!this._graphics) {\n      return;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\n      this._graphics.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._graphics.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._graphics.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    if (this._graphics) {\n      this._graphics.visible = true;\n    }\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class Fade implements Action {\n  private _graphics: GraphicsComponent;\n  public x: number;\n  public y: number;\n\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, endOpacity: number, speed: number) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._graphics) {\n      return;\n    }\n\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._graphics.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._graphics.opacity += (this._multiplier *\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._graphics.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class Delay implements Action {\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(delay: number) {\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionsComponent } from '../ActionsComponent';\n\nexport class Die implements Action {\n  private _entity: Entity;\n  private _stopped = false;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  public update(_delta: number): void {\n    this._entity.get(ActionsComponent).clearActions();\n    this._entity.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Follow implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _followTx: TransformComponent;\n  private _followMotion: MotionComponent;\n\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._followTx = entityToFollow.get(TransformComponent);\n    this._followMotion = entityToFollow.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._motion.vel = vec(m.x, m.y);\n    } else {\n      this._motion.vel = vec(0, 0);\n    }\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Meet implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _meetTx: TransformComponent;\n  private _meetMotion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\n    this._tx = actor.get(TransformComponent);\n    this._motion = actor.get(MotionComponent);\n    this._meetTx = actorToMeet.get(TransformComponent);\n    this._meetMotion = actorToMeet.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { RotationType } from './RotationType';\n\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { Repeat } from './Action/Repeat';\nimport { RepeatForever } from './Action/RepeatForever';\nimport { MoveBy } from './Action/MoveBy';\nimport { MoveTo } from './Action/MoveTo';\nimport { RotateTo } from './Action/RotateTo';\nimport { RotateBy } from './Action/RotateBy';\nimport { ScaleTo } from './Action/ScaleTo';\nimport { ScaleBy } from './Action/ScaleBy';\nimport { CallMethod } from './Action/CallMethod';\nimport { EaseTo } from './Action/EaseTo';\nimport { Blink } from './Action/Blink';\nimport { Fade } from './Action/Fade';\nimport { Delay } from './Action/Delay';\nimport { Die } from './Action/Die';\nimport { Follow } from './Action/Follow';\nimport { Meet } from './Action/Meet';\nimport { Vector } from '../Math/vector';\nimport { Entity } from '../EntityComponentSystem/Entity';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[Action]] interface.\n */\nexport class ActionContext {\n  private _entity: Entity;\n  private _queue: ActionQueue;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n    this._queue = new ActionQueue(entity);\n  }\n\n  public getQueue(): ActionQueue {\n    return this._queue;\n  }\n\n  public update(elapsedMs: number) {\n    this._queue.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._queue.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\n  public easeTo(...args: any[]): ActionContext {\n    let x = 0;\n    let y = 0;\n    let duration = 0;\n    let easingFcn = EasingFunctions.Linear;\n    if (args[0] instanceof Vector) {\n      x = args[0].x;\n      y = args[0].y;\n      duration = args[1];\n      easingFcn = args[2] ?? easingFcn;\n    } else {\n      x = args[0];\n      y = args[1];\n      duration = args[2];\n      easingFcn = args[3] ?? easingFcn;\n    }\n\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let x = 0;\n    let y = 0;\n    let speed = 0;\n    if (xOrPos instanceof Vector) {\n      x = xOrPos.x;\n      y = xOrPos.y;\n      speed = yOrSpeed;\n    } else {\n      x = xOrPos;\n      y = yOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let xOffset = 0;\n    let yOffset = 0;\n    let speed = 0;\n    if (xOffsetOrVector instanceof Vector) {\n      xOffset = xOffsetOrVector.x;\n      yOffset = xOffsetOrVector.y;\n      speed = yOffsetOrSpeed;\n    } else {\n      xOffset = xOffsetOrVector;\n      yOffset = yOffsetOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number | undefined,\n    speedYOrUndefined?: number | undefined): ActionContext {\n\n    let sizeX = 1;\n    let sizeY = 1;\n    let speedX = 0;\n    let speedY = 0;\n\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\n      sizeX = sizeXOrVector.x;\n      sizeY = sizeXOrVector.y;\n\n      speedX = sizeYOrSpeed.x;\n      speedY = sizeYOrSpeed.y;\n    }\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\n      sizeX = sizeXOrVector;\n      sizeY = sizeYOrSpeed;\n\n      speedX = speedXOrUndefined;\n      speedY = speedYOrUndefined;\n    }\n\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\n    let sizeOffsetX = 1;\n    let sizeOffsetY = 1;\n\n    if (sizeOffsetXOrVector instanceof Vector) {\n      sizeOffsetX = sizeOffsetXOrVector.x;\n      sizeOffsetY = sizeOffsetXOrVector.y;\n\n      speed = sizeOffsetYOrSpeed;\n    }\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\n      sizeOffsetX = sizeOffsetXOrVector;\n      sizeOffsetY = sizeOffsetYOrSpeed;\n    }\n\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    this._queue.add(new Fade(this._entity, opacity, time));\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    this._queue.add(new Delay(time));\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    this._queue.add(new Die(this._entity));\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    this._queue.add(new CallMethod(method));\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever(repeatBuilder);\n      return this;\n    }\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Entity, followDistance?: number): ActionContext {\n    if (followDistance === undefined) {\n      this._queue.add(new Follow(this._entity, entity));\n    } else {\n      this._queue.add(new Follow(this._entity, entity, followDistance));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Entity, speed?: number): ActionContext {\n    if (speed === undefined) {\n      this._queue.add(new Meet(this._entity, entity));\n    } else {\n      this._queue.add(new Meet(this._entity, entity, speed));\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    const temp = new Promise<void>((resolve) => {\n      this._queue.add(\n        new CallMethod(() => {\n          resolve();\n        })\n      );\n    });\n    return temp;\n  }\n}\n","import { ActionContext } from './ActionContext';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Actor } from '../Actor';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Vector } from '../Math/vector';\nimport { EasingFunction } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { RotationType } from './RotationType';\n\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\n\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\n  public readonly type = 'ex.actions';\n  dependencies = [TransformComponent, MotionComponent];\n  private _ctx: ActionContext;\n\n  onAdd(entity: Entity) {\n    this._ctx = new ActionContext(entity);\n  }\n\n  onRemove() {\n    this._ctx = null;\n  }\n\n  /**\n   * Returns the internal action queue\n   * @returns action queue\n   */\n  public getQueue(): ActionQueue {\n    return this._ctx?.getQueue();\n  }\n\n  /**\n   * Updates the internal action context, performing action and moving through the internal queue\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number): void {\n    return this._ctx?.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._ctx?.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\n  public easeTo(...args: any[]): ActionContext {\n    return this._ctx.easeTo.apply(this._ctx, args);\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param offset The (x, y) offset to apply to this actor\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(\n    sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number,\n    speedYOrUndefined?: number): ActionContext {\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    return this._ctx.fade(opacity, time);\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    return this._ctx.delay(time);\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    return this._ctx.die();\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    return this._ctx.callMethod(method);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    return this._ctx.repeat(repeatBuilder, times);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    return this._ctx.repeatForever(repeatBuilder);\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Actor, followDistance?: number): ActionContext {\n    return this._ctx.follow(entity, followDistance);\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Actor, speed?: number): ActionContext {\n    return this._ctx.meet(entity, speed);\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    return this._ctx.toPromise();\n  }\n}","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { RasterOptions } from './Raster';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\n/**\n * Represents a system or web font in Excalibur\n *\n * If no options specified, the system sans-serif 10 pixel is used\n *\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\n */\nexport class Font extends Graphic implements FontRenderer {\n  /**\n   * Set the font filtering mode, by default set to [[ImageFiltering.Blended]] regardless of the engine default smoothing\n   *\n   * If you have a pixel style font that may be a reason to switch this to [[ImageFiltering.Pixel]]\n   */\n  public filtering: ImageFiltering = ImageFiltering.Blended;\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\n    super(options); // <- Graphics properties\n\n    // Raster properties\n    this.smoothing = options?.smoothing ?? this.smoothing;\n    this.padding = options?.padding ?? this.padding;\n    this.color = options?.color ?? this.color;\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\n    this.lineDash = options?.lineDash ?? this.lineDash;\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\n    this.filtering = options?.filtering ?? this.filtering;\n\n    // Font specific properties\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 2)\n   */\n  public quality = 2;\n\n  // Raster properties for fonts\n  public padding = 2;\n  public smoothing = false;\n  public lineWidth = 1;\n  public lineDash: number[] = [];\n  public color: Color = Color.Black;\n  public strokeColor: Color;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _textBounds: BoundingBox = new BoundingBox();\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\n    // TODO weird vestigial drawimage\n  }\n\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n\n  /**\n   * Returns a BoundingBox that is the total size of the text including multiple lines\n   *\n   * Does not include any padding or adjustment\n   * @param text\n   * @returns BoundingBox\n   */\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const ctx = this._getTextBitmap(text);\n\n    this._applyFont(ctx); // font must be applied to the context to measure it\n    const metrics = ctx.measureText(maxWidthLine);\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n    // TODO lineheight makes the text bounds wonky\n    const lineAdjustedHeight = textHeight * lines.length;\n    textHeight = lineAdjustedHeight;\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n    const x = 0;\n    const y = 0;\n    return new BoundingBox({\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n      bottom: y + bottomBounds + this.padding,\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n    });\n  }\n\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\n\n    // Changing the width and height clears the context properties\n    // We double the bitmap width to account for all possible alignment\n    // We scale by \"quality\" so we render text without jaggies\n    bitmap.canvas.width = (textBounds.width + this.padding * 2) * 2 * this.quality;\n    bitmap.canvas.height = (textBounds.height + this.padding * 2) * 2 * this.quality;\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    ex.restore();\n  }\n\n  /**\n   * We need to identify bitmaps with more than just the text content\n   *\n   * Any properties that can change the rendering of the text\n   */\n  private _getRasterPropertiesHash(color?: Color): string {\n    const hash = '__hashcode__' +\n    this.fontString +\n    this.showDebug +\n    this.textAlign +\n    this.baseAlign +\n    this.direction +\n    JSON.stringify(this.shadow) +\n    (this.padding.toString() +\n    this.smoothing.toString() +\n    this.lineWidth.toString() +\n    this.lineDash.toString() +\n    this.strokeColor?.toString() +\n    ( color ? color.toString() : this.color?.toString()).toString());\n    return hash;\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D, color: Color) {\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = color ? color.toString() : this.color?.toString();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + ctx.canvas.width / 2, this.padding + ctx.canvas.height / 2);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  private _drawText(ctx: CanvasRenderingContext2D, text: string, colorOverride: Color, lineHeight: number): void {\n    const lines = text.split('\\n');\n    this._applyRasterProperties(ctx, colorOverride);\n    this._applyFont(ctx);\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      if (this.color) {\n        ctx.fillText(line, 0, i * lineHeight);\n      }\n\n      if (this.strokeColor) {\n        ctx.strokeText(line, 0, i * lineHeight);\n      }\n    }\n\n    if (this.showDebug) {\n      // Horizontal line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\n      // Vertical line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\n    }\n  }\n\n  private _textToBitmap = new Map<string, CanvasRenderingContext2D>();\n  private _bitmapUsage = new Map<CanvasRenderingContext2D, number>();\n  private _getTextBitmap(text: string, color?: Color): CanvasRenderingContext2D {\n    const textAndHash = text + this._getRasterPropertiesHash(color);\n    const bitmap = this._textToBitmap.get(textAndHash);\n    if (bitmap) {\n      return bitmap;\n    }\n\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    this._textToBitmap.set(textAndHash, ctx);\n    return ctx;\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number) {\n    if (this.showDebug) {\n      this.clearCache();\n    }\n    this.checkAndClearCache();\n    const bitmap = this._getTextBitmap(text, colorOverride);\n    const isNewBitmap = !this._bitmapUsage.get(bitmap);\n    this._textBounds = this.measureText(text);\n\n    if (isNewBitmap) {\n      this._setDimension(this._textBounds, bitmap);\n    }\n\n    this._preDraw(ex, x, y);\n\n    const lines = text.split('\\n');\n    const lineHeight = this._textBounds.height / lines.length;\n\n\n    const rasterWidth = bitmap.canvas.width;\n    const rasterHeight = bitmap.canvas.height;\n\n    if (isNewBitmap) {\n      // draws the text to the bitmap\n      this._drawText(bitmap, text, colorOverride, lineHeight);\n      // draws the bitmap to excalibur graphics context\n      TextureLoader.load(bitmap.canvas, this.filtering, true);\n    }\n\n    ex.drawImage(\n      bitmap.canvas,\n      0,\n      0,\n      rasterWidth,\n      rasterHeight,\n      x - rasterWidth / this.quality / 2,\n      y - rasterHeight / this.quality / 2,\n      rasterWidth / this.quality,\n      rasterHeight / this.quality\n    );\n\n    this._postDraw(ex);\n\n    // Cache the bitmap for certain amount of time\n    this._bitmapUsage.set(bitmap, performance.now());\n  }\n\n  /**\n   * Get the internal cache size of the font\n   * This is useful when debugging memory usage, these numbers indicate the number of cached in memory text bitmaps\n   */\n  public get cacheSize() {\n    return this._bitmapUsage.size;\n  }\n\n  /**\n   * Force clear all cached text bitmaps\n   */\n  public clearCache() {\n    this._bitmapUsage.clear();\n  }\n\n  /**\n   * Remove any expired cached text bitmaps\n   */\n  public checkAndClearCache() {\n    for (const [bitmap, time] of this._bitmapUsage.entries()) {\n      // if bitmap hasn't been used in 1 second clear it\n      if (time + 1000 < performance.now()) {\n        this._bitmapUsage.delete(bitmap);\n      }\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { SpriteFont } from './SpriteFont';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Color } from '../Color';\nimport { Font } from './Font';\n\nexport interface TextOptions {\n  /**\n   * Text to draw\n   */\n  text: string;\n\n  /**\n   * Optionally override the font color, currently unsupported by SpriteFont\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\n   */\n  font?: Font | SpriteFont;\n}\n\n/**\n * Represent Text graphics in excalibur\n *\n * Useful for in game labels, ui, or overlays\n */\nexport class Text extends Graphic {\n  public color?: Color;\n  constructor(options: TextOptions & GraphicOptions) {\n    super(options);\n    // This order is important font, color, then text\n    this.font = options.font ?? new Font();\n    this.color = options.color ?? this.color;\n    this.text = options.text;\n  }\n\n  public clone(): Text {\n    return new Text({\n      text: this.text.slice(),\n      color: this.color?.clone() ?? Color.Black,\n      font: this.font.clone()\n    });\n  }\n\n  private _text: string = '';\n  public get text() {\n    return this._text;\n  }\n\n  public set text(value: string) {\n    this._text = value;\n    const bounds = this.font.measureText(this._text);\n    this._textWidth = bounds.width;\n    this._textHeight = bounds.height;\n  }\n\n  private _font: Font | SpriteFont;\n  public get font(): Font | SpriteFont {\n    return this._font;\n  }\n  public set font(font: Font | SpriteFont) {\n    this._font = font;\n  }\n\n  private _textWidth: number = 0;\n\n  public get width() {\n    if (this._textWidth === 0) {\n      this._calculateDimension();\n    }\n    return this._textWidth * this.scale.x;\n  }\n\n  private _textHeight: number = 0;\n  public get height() {\n    if (this._textHeight === 0) {\n      this._calculateDimension();\n    }\n    return this._textHeight * this.scale.y;\n  }\n\n  private _calculateDimension() {\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n  }\n\n  public get localBounds(): BoundingBox {\n    return this.font.measureText(this._text).scale(this.scale);\n  }\n\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    let color = Color.Black;\n    if (this.font instanceof Font) {\n      color = this.color ?? this.font.color;\n    }\n\n    if (this.isStale() || this.font.isStale()) {\n      this.font.flipHorizontal = this.flipHorizontal;\n      this.font.flipVertical = this.flipVertical;\n      this.font.rotation = this.rotation;\n      this.font.origin = this.origin;\n      this.font.opacity = this.opacity;\n    }\n\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n\n    this.font.render(ex, this._text, color, x, y);\n    if (this.font.showDebug) {\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\n    }\n  }\n}\n","import { Texture } from './Drawing/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { Engine } from './Engine';\nimport { Color } from './Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Animation } from './Drawing/Animation';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { Vector, vec } from './Math/vector';\nimport { BodyComponent } from './Collision/BodyComponent';\nimport { Eventable } from './Interfaces/Evented';\nimport * as Traits from './Traits/Index';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\nimport { CollisionType } from './Collision/CollisionType';\n\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Rectangle } from './Graphics/Rectangle';\nimport { Flags, Legacy } from './Flags';\nimport { obsolete } from './Util/Decorators';\nimport { ColliderComponent } from './Collision/ColliderComponent';\nimport { Shape } from './Collision/Colliders/Shape';\nimport { watch } from './Util/Watch';\nimport { Collider, CollisionGroup } from './Collision/Index';\nimport { Circle } from './Graphics/Circle';\nimport { PointerEvent } from './Input/PointerEvent';\nimport { WheelEvent } from './Input/WheelEvent';\nimport { PointerComponent } from './Input/PointerComponent';\nimport { ActionsComponent } from './Actions/ActionsComponent';\nimport { Raster } from './Graphics/Raster';\nimport { Text } from './Graphics/Text';\n\n/**\n * Type guard for checking if something is an Actor\n * @param x\n */\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\n/**\n * Actor contructor options\n */\nexport interface ActorArgs {\n  /**\n   * Optionally set the name of the actor, default is 'anonymous'\n   */\n  name?: string;\n  /**\n   * Optionally set the x position of the actor, default is 0\n   */\n  x?: number;\n  /**\n   * Optionally set the y position of the actor, default is 0\n   */\n  y?: number;\n  /**\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\n   */\n  pos?: Vector;\n  /**\n   * Optionally set the coordinate plane of the actor, default is [[CoordPlane.World]] meaning actor is subject to camera positioning\n   */\n  coordPlane?: CoordPlane;\n  /**\n   * Optionally set the width of a box collider for the actor\n   */\n  width?: number;\n  /**\n   * Optionally set the height of a box collider for the actor\n   */\n  height?: number;\n  /**\n   * Optionally set the radius of the circle collider for the actor\n   */\n  radius?: number;\n  /**\n   * Optionally set the velocity of the actor in pixels/sec\n   */\n  vel?: Vector;\n  /**\n   * Optionally set the acceleration of the actor in pixels/sec^2\n   */\n  acc?: Vector;\n  /**\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\n   */\n  rotation?: number;\n  /**\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\n   */\n  angularVelocity?: number;\n  /**\n   * Optionally set the scale of the actor's transform\n   */\n  scale?: Vector;\n  /**\n   * Optionally set the z index of the actor, default is 0\n   */\n  z?: number;\n  /**\n   * Optionally set the color of an actor, only used if no graphics are present\n   * If a width/height or a radius was set a default graphic will be added\n   */\n  color?: Color;\n  /**\n   * Optionally set the visibility of the actor\n   */\n  visible?: boolean;\n  /**\n   * Optionally set the anchor for graphics in the actor\n   */\n  anchor?: Vector;\n  /**\n   * Optionally set the collision type\n   */\n  collisionType?: CollisionType;\n  /**\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\n   */\n  collider?: Collider;\n  /**\n   * Optionally suppy a [[CollisionGroup]]\n   */\n  collisionGroup?: CollisionGroup;\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n */\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Set defaults for all Actors\n   */\n  public static defaults = {\n    anchor: Vector.Half\n  };\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): BodyComponent {\n    return this.get(BodyComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[TransformComponent]]\n   */\n  public get transform(): TransformComponent {\n    return this.get(TransformComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[MotionComponent]]\n   */\n  public get motion(): MotionComponent {\n    return this.get(MotionComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[GraphicsComponent]]\n   */\n  public get graphics(): GraphicsComponent {\n    return this.get(GraphicsComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[ColliderComponent]]\n   */\n  public get collider(): ColliderComponent {\n    return this.get(ColliderComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[PointerComponent]] config\n   */\n  public get pointer(): PointerComponent {\n    return this.get(PointerComponent);\n  }\n\n  /**\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\n   *\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\n   * [[ActionContext|Action context]] of the actor.\n   */\n  public get actions(): ActionsComponent {\n    return this.get(ActionsComponent);\n  }\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.transform.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.transform.pos = thePos.clone();\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.motion.vel = theVel.clone();\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.motion.acc = theAcc.clone();\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.transform.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.transform.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set angularVelocity(angularVelocity: number) {\n    this.motion.angularVelocity = angularVelocity;\n  }\n\n  public get scale(): Vector {\n    return this.get(TransformComponent).scale;\n  }\n\n  public set scale(scale: Vector) {\n    this.get(TransformComponent).scale = scale;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\n  public get anchor(): Vector {\n    return this._anchor;\n  }\n\n  public set anchor(vec: Vector) {\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\n    this._handleAnchorChange(vec);\n  }\n\n  private _handleAnchorChange(v: Vector) {\n    if (this.graphics) {\n      this.graphics.anchor = v;\n    }\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public get isOffScreen(): boolean {\n    return this.hasTag('offscreen');\n  }\n  /**\n   * The visibility of an actor\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\n  public get visible(): boolean {\n    return this.graphics.visible;\n  }\n\n  public set visible(isVisible: boolean) {\n    this.graphics.visible = isVisible;\n  }\n\n  /**\n   * The opacity of an actor.\n   *\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\n   */\n  @obsolete({\n    message: 'Actor.opacity will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.opacity'\n  })\n  public get opacity(): number {\n    return this.graphics.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this.graphics.opacity = opacity;\n  }\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * @deprecated will be removed in v0.26.0\n   */\n  public frames: { [key: string]: Drawable } = {};\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   * @deprecated will be removed in v0.26.0\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Draggable helper\n   */\n  private _draggable: boolean = false;\n  private _dragging: boolean = false;\n\n  private _pointerDragStartHandler = () => {\n    this._dragging = true;\n  };\n\n  private _pointerDragEndHandler = () => {\n    this._dragging = false;\n  };\n\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  public get draggable(): boolean {\n    return this._draggable;\n  }\n\n  public set draggable(isDraggable: boolean) {\n    if (isDraggable) {\n      if (isDraggable && !this._draggable) {\n        this.on('pointerdragstart', this._pointerDragStartHandler);\n        this.on('pointerdragend', this._pointerDragEndHandler);\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\n      } else if (!isDraggable && this._draggable) {\n        this.off('pointerdragstart', this._pointerDragStartHandler);\n        this.off('pointerdragend', this._pointerDragEndHandler);\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\n      }\n\n      this._draggable = isDraggable;\n    }\n  }\n\n  /**\n   * Modify the current actor update pipeline.\n   * @deprecated will be removed in v0.26.0\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor's current graphic\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n    const defaultLayer = this.graphics.layers.default;\n    const currentGraphic = defaultLayer.graphics[0]?.graphic;\n    if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\n      currentGraphic.color = this._color;\n    }\n  }\n  private _color: Color;\n\n  // #endregion\n\n  /**\n   *\n   * @param config\n   */\n  constructor(config?: ActorArgs) {\n    super();\n\n    const {\n      name,\n      x,\n      y,\n      pos,\n      coordPlane,\n      scale,\n      width,\n      height,\n      radius,\n      collider,\n      vel,\n      acc,\n      rotation,\n      angularVelocity,\n      z,\n      color,\n      visible,\n      anchor,\n      collisionType,\n      collisionGroup\n    } = {\n      ...config\n    };\n\n    this._setName(name);\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\n    const tx = new TransformComponent();\n    this.addComponent(tx);\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.rotation = rotation ?? 0;\n    this.scale = scale ?? vec(1, 1);\n    this.z = z ?? 0;\n    tx.coordPlane = coordPlane ?? CoordPlane.World;\n\n    this.addComponent(new PointerComponent);\n\n    this.addComponent(new GraphicsComponent({\n      anchor: this.anchor\n    }));\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(new MotionComponent());\n    this.vel = vel ?? Vector.Zero;\n    this.acc = acc ?? Vector.Zero;\n    this.angularVelocity = angularVelocity ?? 0;\n\n    this.addComponent(new ActionsComponent());\n\n    this.addComponent(new BodyComponent());\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\n    if (collisionGroup) {\n      this.body.group = collisionGroup;\n    }\n\n    if (collider) {\n      this.addComponent(new ColliderComponent(collider));\n    } else if (radius) {\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\n    } else {\n      if (width > 0 && height > 0) {\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\n      } else {\n        this.addComponent(new ColliderComponent()); // no collider\n      }\n    }\n\n    this.graphics.visible = visible ?? true;\n\n    if (color) {\n      this.color = color;\n      if (width && height) {\n        this.graphics.add(\n          new Rectangle({\n            color: color,\n            width,\n            height\n          })\n        );\n      } else if (radius) {\n        this.graphics.add(\n          new Circle({\n            color: color,\n            radius\n          })\n        );\n      }\n    }\n\n    // Build default pipeline\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      // TODO remove offscreen trait after legacy drawing removed\n      this.traits.push(new Traits.OffscreenCulling());\n    }\n\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  // #region Events\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      super.kill();\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this.active = true;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return !this.active;\n  }\n\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: number): void;\n  @obsolete({\n    message: 'Actor.setDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\n  })\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\n      this.currentDrawing.tick(0);\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  @obsolete({\n    message: 'Actor.addDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.add()'\n  })\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   */\n  public get z(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.getZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public getZIndex(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newZ new z-index to assign\n   */\n  public set z(newZ: number) {\n    this.get(TransformComponent).z = newZ;\n  }\n\n  /**\n   * @param newIndex new z-index to assign\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.setZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public setZIndex(newIndex: number) {\n    this.get(TransformComponent).z = newIndex;\n  }\n\n  /**\n   * Get the center point of an actor (global position)\n   */\n  public get center(): Vector {\n    const globalPos = this.getGlobalPos();\n    return new Vector(\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\n      globalPos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  /**\n   * Get the local center point of an actor\n   */\n  public get localCenter(): Vector {\n    return new Vector(\n      this.pos.x + this.width / 2 - this.anchor.x * this.width,\n      this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this.collider.localBounds.width * this.getGlobalScale().x;\n  }\n\n  public get height() {\n    return this.collider.localBounds.height * this.getGlobalScale().y;\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getGlobalRotation(): number {\n    return this.get(TransformComponent).globalRotation;\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getGlobalPos(): Vector {\n    return this.get(TransformComponent).globalPos;\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    return this.get(TransformComponent).globalScale;\n  }\n\n  // #region Collision\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    const point = vec(x, y);\n    const collider = this.get(ColliderComponent);\n    collider.update();\n    const geom = collider.get();\n    if (!geom) {\n      return false;\n    }\n    const containment = geom.contains(point);\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    const collider = this.get(ColliderComponent);\n    const otherCollider = actor.get(ColliderComponent);\n    const me = collider.get();\n    const other = otherCollider.get();\n    if (me && other) {\n      return me.getClosestLineBetween(other).getLength() <= distance;\n    }\n    return false;\n  }\n\n  // #endregion\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @internal\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Tick animations\n    const drawing = this.currentDrawing;\n    if (drawing && drawing instanceof Animation) {\n      drawing.tick(delta, engine.stats.currFrame.id);\n    }\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    // translate canvas by anchor offset\n    ctx.save();\n\n    if (this.currentDrawing) {\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\n\n      this._predraw(ctx, delta);\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\n    } else {\n      this._predraw(ctx, delta);\n      if (this.color && this.collider) {\n        // update collider geometry based on transform\n        const collider = this.get(ColliderComponent);\n        collider.update();\n        if (collider && !collider.bounds.hasZeroDimensions()) {\n          // Colliders are already shifted by anchor, unshift\n          ctx.globalAlpha = this.graphics.opacity;\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\n        }\n      }\n    }\n    ctx.restore();\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   *\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated will be removed in v0.26.0\n   * @internal\n   */\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n  // #endregion\n}\n","import { Vector, vec } from './Math/vector';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(config?: ActorArgs);\n\n  constructor(config?: ActorArgs) {\n    super({ ...config });\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\n    this.anchor = vec(0, 0);\n    this.body.collisionType = CollisionType.PreventCollision;\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\nimport { obsolete } from './Util/Decorators';\nimport { Logger } from './Util/Log';\n\nexport interface TimerOptions {\n  repeats?: boolean;\n  numberOfRepeats?: number;\n  fcn?: () => void;\n  interval: number;\n}\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  private _logger = Logger.getInstance();\n  private static _MAX_ID: number = 0;\n  public id: number = 0;\n\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n\n  private _running = false;\n\n  private _numberOfTicks: number = 0;\n  private _callbacks: Array<() => void>;\n\n  public interval: number = 10;\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n\n  private _complete = false;\n  public get complete() {\n    return this._complete;\n  }\n  public scene: Scene = null;\n\n  /**\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   * @param fcn        The callback to be fired after the interval is complete.\n   */\n  constructor(options: TimerOptions);\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (typeof fcn !== 'function') {\n      const options = fcn;\n      fcn = options.fcn;\n      interval = options.interval;\n      repeats = options.repeats;\n      numberOfRepeats = options.numberOfRepeats;\n    }\n\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.id = Timer._MAX_ID++;\n    this.interval = interval || this.interval;\n    this.repeats = repeats || this.repeats;\n\n    this._callbacks = [];\n\n    if (fcn) {\n      this.on(fcn);\n    }\n  }\n\n  /**\n   * Adds a new callback to be fired after the interval is complete\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\n   */\n  public on(fcn: () => void) {\n    this._callbacks.push(fcn);\n  }\n\n  /**\n   * Removes a callback from the callback list to be fired after the interval is complete.\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\n   */\n  public off(fcn: () => void) {\n    const index = this._callbacks.indexOf(fcn);\n    this._callbacks.splice(index, 1);\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (this._running) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this._complete = true;\n        this._running = false;\n        this._elapsedTime = 0;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this._callbacks.forEach((c) => {\n          c.call(this);\n        });\n\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this._complete = true;\n          this._running = false;\n          this._elapsedTime = 0;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   *\n   * Warning** you may need to call `timer.start()` again if the timer had completed\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this._complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * @returns milliseconds until the next action callback, if complete will return 0\n   */\n  public get timeToNextAction() {\n    if (this.complete) {\n      return 0;\n    }\n    return this.interval - this._elapsedTime;\n  }\n\n  /**\n   * @returns milliseconds elapsed toward the next action\n   */\n  public get timeElapsedTowardNextAction() {\n    return this._elapsedTime;\n  }\n\n  public get isRunning() {\n    return this._running;\n  }\n\n  /**\n   * Pauses the timer, time will no longer increment towards the next call\n   */\n  public pause(): Timer {\n    this._running = false;\n    return this;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   * @deprecated Will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\n  public unpause() {\n    this._running = true;\n  }\n\n  /**\n   * Resumes the timer, time will now increment towards the next call.\n   */\n  public resume(): Timer {\n    this._running = true;\n    return this;\n  }\n\n  /**\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\n   */\n  public start(): Timer {\n    if (!this.scene) {\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\n    }\n\n    this._running = true;\n    if (this.complete) {\n      this._complete = false;\n      this._elapsedTime = 0;\n      this._numberOfTicks = 0;\n    }\n\n    return this;\n  }\n\n  /**\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\n   */\n  public stop(): Timer {\n    this._running = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n    return this;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    this.pause();\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from '.';\nimport { Component } from '../EntityComponentSystem/Component';\n\n\n/**\n * Provide arbitrary drawing for the purposes of debugging your game\n *\n * Will only show when the Engine is set to debug mode [[Engine.showDebug]] or [[Engine.toggleDebug]]\n *\n */\nexport class DebugGraphicsComponent extends Component<'ex.debuggraphics'> {\n  readonly type = 'ex.debuggraphics';\n  constructor(public draw: (ctx: ExcaliburGraphicsContext) => void, public useTransform = true) {\n    super();\n  }\n}","import { Engine } from './Engine';\nimport { Screen } from './Screen';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { Vector, vec } from './Math/vector';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { Logger } from './Util/Log';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { watchAny } from './Util/Watch';\nimport { Matrix } from './Math/matrix';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param actor Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param actor Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n\n  /**\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\n   * @param box The bounding box to limit the camera to.\n   */\n  public limitCameraBounds(box: BoundingBox) {\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = cam.vel.clone();\n\n    // Calculate the stretch vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.size;\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Prevent a camera from going beyond the given camera dimensions.\n */\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\n  /**\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\n   *\n   * Note that this strategy does not perform any movement by itself.\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\n   *\n   * Make sure that the camera bounds are at least as large as the viewport size.\n   *\n   * @param target The bounding box to limit the camera to\n   */\n\n  boundSizeChecked: boolean = false; // Check and warn only once\n\n  constructor(public target: BoundingBox) {}\n\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\n    const focus = cam.getFocus();\n\n    if (!this.boundSizeChecked) {\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\n      }\n      this.boundSizeChecked = true;\n    }\n\n    let focusX = focus.x;\n    let focusY = focus.y;\n    if (focus.x < target.left + _eng.halfDrawWidth) {\n      focusX = target.left + _eng.halfDrawWidth;\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\n      focusX = target.right - _eng.halfDrawWidth;\n    }\n\n    if (focus.y < target.top + _eng.halfDrawHeight) {\n      focusY = target.top + _eng.halfDrawHeight;\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\n      focusY = target.bottom - _eng.halfDrawHeight;\n    }\n\n    return vec(focusX, focusY);\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  public transform: Matrix = Matrix.identity();\n  public inverse: Matrix = Matrix.identity();\n\n\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  /**\n   * Get or set current zoom of the camera, defaults to 1\n   */\n  private _z = 1;\n  public get zoom(): number {\n    return this._z;\n  }\n\n  public set zoom(val: number) {\n    this._z = val;\n    if (this._engine) {\n      this._halfWidth = this._engine.halfDrawWidth;\n      this._halfHeight = this._engine.halfDrawHeight;\n    }\n  }\n  /**\n   * Get or set rate of change in zoom, defaults to 0\n   */\n  public dz: number = 0;\n  /**\n   * Get or set zoom acceleration\n   */\n  public az: number = 0;\n\n  /**\n   * Current rotation of the camera\n   */\n  public rotation: number = 0;\n\n  /**\n   * Current angular velocity\n   * @deprecated will be removed in v0.26.0, use angularVelocity\n   */\n  public rx: number = 0;\n\n  /**\n   * Get or set the camera's angular velocity\n   */\n  public get angularVelocity(): number {\n    return this.rx;\n  }\n\n  public set angularVelocity(value: number) {\n    this.rx = value;\n  }\n\n  /**\n   * Get or set the camera's position\n   */\n  private _posChanged = false;\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\n  public get pos(): Vector {\n    return this._pos;\n  }\n  public set pos(vec: Vector) {\n    this._pos = watchAny(vec, () => (this._posChanged = true));\n    this._posChanged = true;\n  }\n\n  /**\n   * Get or set the camera's velocity\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * Get or set the camera's acceleration\n   */\n  public acc: Vector = Vector.Zero;\n\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpResolve: (value: Vector) => void;\n  private _lerpPromise: Promise<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomResolve: (val: boolean) => void;\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  private _halfWidth: number = 0;\n  private _halfHeight: number = 0;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this.pos.x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(value, this.pos.y);\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this.pos.y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(this.pos.x, value);\n    }\n  }\n\n  /**\n   * Get or set the camera's x velocity\n   */\n  public get dx() {\n    return this.vel.x;\n  }\n\n  public set dx(value: number) {\n    this.vel = vec(value, this.vel.y);\n  }\n\n  /**\n   * Get or set the camera's y velocity\n   */\n  public get dy() {\n    return this.vel.y;\n  }\n\n  public set dy(value: number) {\n    this.vel = vec(this.vel.x, value);\n  }\n\n  /**\n   * Get or set the camera's x acceleration\n   */\n  public get ax() {\n    return this.acc.x;\n  }\n\n  public set ax(value: number) {\n    this.acc = vec(value, this.acc.y);\n  }\n\n  /**\n   * Get or set the camera's y acceleration\n   */\n  public get ay() {\n    return this.acc.y;\n  }\n\n  public set ay(value: number) {\n    this.acc = vec(this.acc.x, value);\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return this.pos;\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return Promise.reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpResolve) {\n      this._lerpResolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>((resolve) => {\n      this._lerpResolve = resolve;\n    });\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>((resolve) => {\n      this._zoomResolve = resolve;\n    });\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.zoom;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.zoom = scale;\n      return Promise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  private _viewport: BoundingBox = null;\n  /**\n   * Gets the bounding box of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._viewport) {\n      return this._viewport;\n    }\n\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _screen: Screen;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this._engine = _engine;\n      this._screen = _engine.screen;\n\n      const currentRes = this._screen.resolution;\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\n      if (!this._engine.loadingComplete) {\n        // If there was a loading screen, we peek the configured resolution\n        const res = this._screen.peekResolution();\n        if (res) {\n          center = vec(res.width / 2, res.height / 2);\n        }\n      }\n      this._halfWidth = center.x;\n      this._halfHeight = center.y;\n\n      // If the user has not set the camera pos, apply default center screen position\n      if (!this._posChanged) {\n        this.pos = center;\n      }\n      // First frame bootstrap\n\n      // Ensure camera tx is correct\n      // Run update twice to ensure properties are init'd\n      this.updateTransform();\n\n      // Run strategies for first frame\n      this.runStrategies(_engine, _engine.clock.elapsed());\n\n      // Setup the first frame viewport\n      this.updateViewport();\n\n      // It's important to update the camera after strategies\n      // This prevents jitter\n      this.updateTransform();\n\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public runStrategies(engine: Engine, delta: number) {\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, engine, delta);\n    }\n  }\n\n  public updateViewport() {\n    // recalc viewport\n    this._viewport = new BoundingBox(\n      this.x - this._halfWidth,\n      this.y - this._halfHeight,\n      this.x + this._halfWidth,\n      this.y + this._halfHeight\n    );\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\n    this.zoom += (this.dz * delta) / 1000;\n\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.angularVelocity * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.zoom = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.zoom = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomResolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this.pos = lerpPoint;\n\n        this._currentLerpTime += delta;\n      } else {\n        this.pos = this._lerpEnd;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpResolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    this.runStrategies(_engine, delta);\n\n    this.updateViewport();\n\n    // It's important to update the camera after strategies\n    // This prevents jitter\n    this.updateTransform();\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx Canvas context to apply transformations\n   */\n  public draw(ctx: CanvasRenderingContext2D): void;\n  public draw(ctx: ExcaliburGraphicsContext): void;\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\n    // Apply transform\n    if (ctx instanceof CanvasRenderingContext2D) {\n      // TODO This will be removed in v0.26.0\n      const focus = this.getFocus();\n\n      // center the camera\n      const newCanvasWidth = this._screen.resolution.width / this.zoom;\n      const newCanvasHeight = this._screen.resolution.height / this.zoom;\n      const cameraPos = vec(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n      ctx.scale(this.zoom, this.zoom);\n      ctx.translate(cameraPos.x, cameraPos.y);\n    } else {\n      ctx.multiply(this.transform);\n    }\n  }\n\n  public updateTransform() {\n    // center the camera\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\n    const cameraPos = vec(-this.x + newCanvasWidth / 2 + this._xShake, -this.y + newCanvasHeight / 2 + this._yShake);\n\n    // Calculate camera transform\n    this.transform.reset();\n    this.transform.scale(this.zoom, this.zoom);\n    this.transform.translate(cameraPos.x, cameraPos.y);\n    this.transform.getAffineInverse(this.inverse);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Engine } from '../Engine';\nimport { Vector, vec } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport * as Events from '../Events';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { BodyComponent } from '../Collision/BodyComponent';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { Shape } from '../Collision/Colliders/Shape';\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from '../Graphics';\nimport * as Graphics from '../Graphics';\nimport { CanvasDrawComponent, Sprite } from '../Drawing/Index';\nimport { Sprite as LegacySprite } from '../Drawing/Index';\nimport { removeItemFromArray } from '../Util/Util';\nimport { obsolete } from '../Util/Decorators';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\nimport { Color } from '../Color';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\nimport { Collider } from '../Collision/Colliders/Collider';\n\nexport interface TileMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Width of an individual tile in pixels\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\n *\n * TileMaps are useful for top down or side scrolling grid oriented games.\n */\nexport class TileMap extends Entity {\n  private _token = 0;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = Number.MAX_VALUE;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = Number.MAX_VALUE;\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\n\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\n  public logger: Logger = Logger.getInstance();\n  public readonly tiles: Tile[] = [];\n  private _rows: Tile[][] = [];\n  private _cols: Tile[][] = [];\n\n  public readonly tileWidth: number;\n  public readonly tileHeight: number;\n  public readonly height: number;\n  public readonly width: number;\n\n  private _collidersDirty = true;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n  private _transform: TransformComponent;\n  private _motion: MotionComponent;\n  private _collider: ColliderComponent;\n  private _composite: CompositeCollider;\n\n  public get x(): number {\n    return this._transform.pos.x ?? 0;\n  }\n\n  public set x(val: number) {\n    if (this._transform?.pos) {\n      this.get(TransformComponent).pos = vec(val, this.y);\n    }\n  }\n\n  public get y(): number {\n    return this._transform?.pos.y ?? 0;\n  }\n\n  public set y(val: number) {\n    if (this._transform?.pos) {\n      this._transform.pos = vec(this.x, val);\n    }\n  }\n\n  public get z(): number {\n    return this._transform.z ?? 0;\n  }\n\n  public set z(val: number) {\n    if (this._transform) {\n      this._transform.z = val;\n    }\n  }\n\n  public get rotation(): number {\n    return this._transform?.rotation ?? 0;\n  }\n\n  public set rotation(val: number) {\n    if (this._transform?.rotation) {\n      this._transform.rotation = val;\n    }\n  }\n\n  public get scale(): Vector {\n    return this._transform?.scale ?? Vector.One;\n  }\n\n  public set scale(val: Vector) {\n    if (this._transform?.scale) {\n      this._transform.scale = val;\n    }\n  }\n\n  public get pos(): Vector {\n    return this._transform.pos;\n  }\n\n  public set pos(val: Vector) {\n    this._transform.pos = val;\n  }\n\n  public get vel(): Vector {\n    return this._motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this._motion.vel = val;\n  }\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n\n  /**\n   * @param options\n   */\n  constructor(options: TileMapOptions) {\n    super(null, options.name);\n    this.addComponent(new TransformComponent());\n    this.addComponent(new MotionComponent());\n    this.addComponent(\n      new BodyComponent({\n        type: CollisionType.Fixed\n      })\n    );\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(\n      new GraphicsComponent({\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\n      })\n    );\n    this.addComponent(new DebugGraphicsComponent((ctx) => this.debug(ctx)));\n    this.addComponent(new ColliderComponent());\n    this._transform = this.get(TransformComponent);\n    this._motion = this.get(MotionComponent);\n    this._collider = this.get(ColliderComponent);\n    this._composite = this._collider.useCompositeCollider([]);\n\n    this._transform.pos = options.pos ?? Vector.Zero;\n    this._transform.posChanged$.subscribe(() => this.flagCollidersDirty());\n    this.tileWidth = options.tileWidth;\n    this.tileHeight = options.tileHeight;\n    this.height = options.height;\n    this.width = options.width;\n    this.tiles = new Array<Tile>(this.height * this.width);\n    this._rows = new Array(this.height);\n    this._cols = new Array(this.width);\n    let currentCol: Tile[] = [];\n    for (let i = 0; i < this.width; i++) {\n      for (let j = 0; j < this.height; j++) {\n        const cd = new Tile({\n          x: i,\n          y: j,\n          map: this\n        });\n        cd.map = this;\n        this.tiles[i + j * this.width] = cd;\n        currentCol.push(cd);\n        if (!this._rows[j]) {\n          this._rows[j] = [];\n        }\n        this._rows[j].push(cd);\n      }\n      this._cols[i] = currentCol;\n      currentCol = [];\n    }\n\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\n      left: 0,\n      top: 0,\n      right: this.width * this.tileWidth,\n      bottom: this.height * this.tileHeight\n    });\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  /**\n   *\n   * @param key\n   * @param spriteSheet\n   * @deprecated No longer used, will be removed in v0.26.0\n   */\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\n      this._spriteSheets[key] = spriteSheet;\n    } else {\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\n    }\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  /**\n   * Tiles colliders based on the solid tiles in the tilemap.\n   */\n  private _updateColliders(): void {\n    this._composite.clearColliders();\n    const colliders: BoundingBox[] = [];\n    this._composite = this._collider.useCompositeCollider([]);\n    let current: BoundingBox;\n    // Bad square tesselation algo\n    for (let i = 0; i < this.width; i++) {\n      // Scan column for colliders\n      for (let j = 0; j < this.height; j++) {\n        // Columns start with a new collider\n        if (j === 0) {\n          current = null;\n        }\n        const tile = this.tiles[i + j * this.width];\n        // Current tile in column is solid build up current collider\n        if (tile.solid) {\n          // Use custom collider otherwise bounding box\n          if (tile.getColliders().length > 0) {\n            for (const collider of tile.getColliders()) {\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n              collider.offset = vec(tile.x * this.tileWidth, tile.y * this.tileHeight).add(originalOffset);\n              collider.owner = this;\n              this._composite.addCollider(collider);\n            }\n            current = null;\n          } else {\n            if (!current) {\n              current = tile.bounds;\n            } else {\n              current = current.combine(tile.bounds);\n            }\n          }\n        } else {\n          // Not solid skip and cut off the current collider\n          if (current) {\n            colliders.push(current);\n          }\n          current = null;\n        }\n      }\n      // After a column is complete check to see if it can be merged into the last one\n      if (current) {\n        // if previous is the same combine it\n        const prev = colliders[colliders.length - 1];\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\n          colliders[colliders.length - 1] = prev.combine(current);\n        } else {\n          // else new collider\n          colliders.push(current);\n        }\n      }\n    }\n\n    for (const c of colliders) {\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\n      collider.owner = this;\n      this._composite.addCollider(collider);\n    }\n    this._collider.update();\n  }\n\n  /**\n   * Returns the [[Tile]] by index (row major order)\n   */\n  public getTileByIndex(index: number): Tile {\n    return this.tiles[index];\n  }\n  /**\n   * Returns the [[Tile]] by its x and y integer coordinates\n   */\n  public getTile(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n  /**\n   * Returns the [[Tile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): Tile {\n    const x = Math.floor((point.x - this.pos.x) / this.tileWidth);\n    const y = Math.floor((point.y - this.pos.y) / this.tileHeight);\n    const tile = this.getTile(x, y);\n    if (x >= 0 && y >= 0 && x < this.width && y < this.height && tile) {\n      return tile;\n    }\n    return null;\n  }\n\n  public getRows(): readonly Tile[][] {\n    return this._rows;\n  }\n\n  public getColumns(): readonly Tile[][] {\n    return this._cols;\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.onPreUpdate(engine, delta);\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n    if (this._collidersDirty) {\n      this._collidersDirty = false;\n      this._updateColliders();\n    }\n\n    this._token++;\n    const worldBounds = engine.getWorldBounds();\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.tileWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.tileHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.tileWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.tileHeight) + 2, 0);\n    this._transform.pos = vec(this.x, this.y);\n\n    this.onPostUpdate(engine, delta);\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.width);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.height);\n\n    let graphics: readonly Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        graphics = this.getTile(x, y).getGraphics();\n\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\n          // draw sprite, warning if sprite doesn't exist\n          const graphic = graphics[graphicsIndex];\n          if (graphic) {\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\n              if (hasGraphicsTick(graphic)) {\n                graphic?.tick(delta, this._token);\n              }\n              graphic.draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            } else if (graphic instanceof Graphics.Sprite) {\n              // TODO legacy drawing mode\n              if (!this._legacySpriteMap.has(graphic)) {\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\n              }\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            }\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\n  }\n\n  public debug(gfx: ExcaliburGraphicsContext) {\n    const width = this.tileWidth * this.width;\n    const height = this.tileHeight * this.height;\n    const pos = Vector.Zero;\n    for (let r = 0; r < this.height + 1; r++) {\n      const yOffset = vec(0, r * this.tileHeight);\n      gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), Color.Red, 2);\n    }\n\n    for (let c = 0; c < this.width + 1; c++) {\n      const xOffset = vec(c * this.tileWidth, 0);\n      gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), Color.Red, 2);\n    }\n\n    const colliders = this._composite.getColliders();\n    for (const collider of colliders) {\n      const grayish = Color.Gray;\n      grayish.a = 0.5;\n      const bounds = collider.localBounds;\n      const pos = collider.worldPos.sub(this.pos);\n      gfx.drawRectangle(pos, bounds.width, bounds.height, grayish);\n    }\n  }\n}\n\nexport interface TileOptions {\n  /**\n   * Integer tile x coordinate\n   */\n  x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  y: number;\n  map: TileMap;\n  solid?: boolean;\n  graphics?: Graphics.Graphic[];\n}\n\n/**\n * TileMap Tile\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Tile extends Entity {\n  private _bounds: BoundingBox;\n  private _pos: Vector;\n  private _posDirty = false;\n  private _transform: TransformComponent;\n\n  /**\n   * Return the world position of the top left corner of the tile\n   */\n  public get pos() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._pos;\n  }\n\n  /**\n   * Integer x coordinate of the tile\n   */\n  public readonly x: number;\n\n  /**\n   * Integer y coordinate of the tile\n   */\n  public readonly y: number;\n\n  /**\n   * Width of the tile in pixels\n   */\n  public readonly width: number;\n\n  /**\n   * Height of the tile in pixels\n   */\n  public readonly height: number;\n\n  /**\n   * Reference to the TileMap this tile is associated with\n   */\n  public map: TileMap;\n\n  private _solid = false;\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public get solid(): boolean {\n    return this._solid;\n  }\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public set solid(val: boolean) {\n    this.map?.flagCollidersDirty();\n    this._solid = val;\n  }\n\n  private _graphics: Graphics.Graphic[] = [];\n\n  /**\n   * Current list of graphics for this tile\n   */\n  public getGraphics(): readonly Graphics.Graphic[] {\n    return this._graphics;\n  }\n\n  /**\n   * Add another [[Graphic]] to this TileMap tile\n   * @param graphic\n   */\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    if (graphic instanceof LegacySprite) {\n      this._graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\n    } else {\n      this._graphics.push(graphic);\n    }\n  }\n\n  /**\n   * Remove an instance of a [[Graphic]] from this tile\n   */\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    removeItemFromArray(graphic, this._graphics);\n  }\n\n  /**\n   * Clear all graphics from this tile\n   */\n  public clearGraphics() {\n    this._graphics.length = 0;\n  }\n\n  /**\n   * Current list of colliders for this tile\n   */\n  private _colliders: Collider[] = [];\n\n  /**\n   * Returns the list of colliders\n   */\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a custom collider to the [[Tile]] to use instead of it's bounds\n   *\n   * If no collider is set but [[Tile.solid]] is set, the tile bounds are used as a collider.\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the [[Tile]]\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the [[Tile]]\n   */\n  public clearColliders() {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Arbitrary data storage per tile, useful for any game specific data\n   */\n  public data = new Map<string, any>();\n\n  constructor(options: TileOptions) {\n    super();\n    this.x = options.x;\n    this.y = options.y;\n    this.map = options.map;\n    this.width = options.map.tileWidth;\n    this.height = options.map.tileHeight;\n    this.solid = options.solid ?? this.solid;\n    this._graphics = options.graphics ?? [];\n    this._recalculate();\n    this._transform = options.map.get(TransformComponent);\n    this._transform.posChanged$.subscribe(() => {\n      this._posDirty = true;\n    });\n  }\n\n  private _recalculate() {\n    this._pos = this.map.pos.add(\n      vec(\n        this.x * this.map.tileWidth,\n        this.y * this.map.tileHeight));\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this.width, this._pos.y + this.height);\n  }\n\n  public get bounds() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this._pos.x + this.width / 2, this._pos.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[Sprite]] to this tile\n   * @deprecated Use addSprite, will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\n    this.addGraphic(sprite);\n  }\n}","import { Actor } from '../Actor';\nimport { ScreenElement } from '../ScreenElement';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\n/**\n * Type guard to detect if something is an actor\n * @deprecated Will be removed in v0.26.0\n * @param actor\n */\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\n/**\n * Type guard to detect a screen element\n * @todo move to ScreenElement\n */\nexport function isScreenElement(actor: Actor) {\n  return actor instanceof ScreenElement;\n}\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = {\n      ...triggerDefaults,\n      ...opts\n    };\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher();\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\nimport { Message, Observer } from '../Util/Observable';\nimport { Component } from './Component';\nimport { Scene } from '../Scene';\n\n/**\n * Enum that determines whether to run the system in the update or draw phase\n */\nexport enum SystemType {\n  Update = 'update',\n  Draw = 'draw'\n}\n\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * An Excalibur [[System]] that updates entities of certain types.\n * Systems are scene specific\n *\n * Excalibur Systems currently require at least 1 Component type to operated\n *\n * Multiple types are declared as a type union\n * For example:\n *\n * ```typescript\n * class MySystem extends System<ComponentA | ComponentB> {\n *   public readonly types = ['a', 'b'] as const;\n *   public readonly systemType = SystemType.Update;\n *   public update(entities: Entity<ComponentA | ComponentB>) {\n *      ...\n *   }\n * }\n * ```\n */\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\nimplements Observer<AddedEntity | RemovedEntity> {\n  /**\n   * The types of entities that this system operates on\n   * For example ['transform', 'motion']\n   */\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\n\n  /**\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\n   */\n  abstract readonly systemType: SystemType;\n\n  /**\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\n   */\n  public priority: number = 0;\n\n  /**\n   * Optionally specify a sort order for entities passed to the your system\n   * @param a The left entity\n   * @param b The right entity\n   */\n  sort?(a: Entity, b: Entity): number;\n\n  /**\n   * Optionally specify an initialize handler\n   * @param scene\n   */\n  initialize?(engine: ContextType): void;\n\n  /**\n   * Update all entities that match this system's types\n   * @param entities Entities to update that match this system's types\n   * @param delta Time in milliseconds\n   */\n  abstract update(entities: Entity[], delta: number): void;\n\n  /**\n   * Optionally run a preupdate before the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  preupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Optionally run a postupdate after the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  postupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Systems observe when entities match their types or no longer match their types, override\n   * @param _entityAddedOrRemoved\n   */\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\n    // Override me\n  }\n}\n\n/**\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\n */\nexport class AddedEntity implements Message<Entity> {\n  readonly type: 'Entity Added' = 'Entity Added';\n  constructor(public data: Entity) {}\n}\n\n/**\n * Type guard to check for AddedEntity messages\n * @param x\n */\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\n  return !!x && x.type === 'Entity Added';\n}\n\n/**\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\n */\nexport class RemovedEntity implements Message<Entity> {\n  readonly type: 'Entity Removed' = 'Entity Removed';\n  constructor(public data: Entity) {}\n}\n\n/**\n * type guard to check for the RemovedEntity message\n */\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\n  return !!x && x.type === 'Entity Removed';\n}\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\nimport { Observer } from '../Util/Observable';\nimport { World } from './World';\nimport { Util } from '..';\n\n// Add/Remove entities and components\n\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\n  public entities: Entity[] = [];\n  public _entityIndex: { [entityId: string]: Entity } = {};\n\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Runs the entity lifecycle\n   * @param _context\n   */\n  public updateEntities(_context: ContextType, elapsed: number) {\n    for (const entity of this.entities) {\n      // TODO is this right?\n      entity.update((_context as any).engine, elapsed);\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  public findEntitiesForRemoval() {\n    for (const entity of this.entities) {\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * EntityManager observes changes on entities\n   * @param message\n   */\n  public notify(message: RemovedComponent | AddedComponent): void {\n    if (isAddedComponent(message)) {\n      // we don't need the component, it's already on the entity\n      this._world.queryManager.addEntity(message.data.entity);\n    }\n\n    if (isRemovedComponent(message)) {\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\n    }\n  }\n\n  /**\n   * Adds an entity to be tracked by the EntityManager\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    entity.active = true;\n    if (entity && !this._entityIndex[entity.id]) {\n      this._entityIndex[entity.id] = entity;\n      this.entities.push(entity);\n      this._world.queryManager.addEntity(entity);\n      entity.componentAdded$.register(this);\n      entity.componentRemoved$.register(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.addEntity(c));\n      entity.childrenAdded$.register({\n        notify: (e) => {\n          this.addEntity(e);\n        }\n      });\n      entity.childrenRemoved$.register({\n        notify: (e) => {\n          this.removeEntity(e, false);\n        }\n      });\n    }\n  }\n\n  public removeEntity(entity: Entity, deferred?: boolean): void;\n  public removeEntity(id: number, deferred?: boolean): void;\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\n    let id = 0;\n    if (idOrEntity instanceof Entity) {\n      id = idOrEntity.id;\n    } else {\n      id = idOrEntity;\n    }\n    const entity = this._entityIndex[id];\n    if (entity && entity.active) {\n      entity.kill();\n    }\n\n    if (entity && deferred) {\n      this._entitiesToRemove.push(entity);\n      return;\n    }\n\n    delete this._entityIndex[id];\n    if (entity) {\n      Util.removeItemFromArray(entity, this.entities);\n      this._world.queryManager.removeEntity(entity);\n      entity.componentAdded$.unregister(this);\n      entity.componentRemoved$.unregister(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\n      entity.childrenAdded$.clear();\n      entity.childrenRemoved$.clear();\n\n      // stats\n      if ((this._world.context as any)?.engine) {\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\n      }\n    }\n  }\n\n  private _entitiesToRemove: Entity[] = [];\n  public processEntityRemovals(): void {\n    for (const entity of this._entitiesToRemove) {\n      if (entity.active) {\n        continue;\n      }\n      this.removeEntity(entity, false);\n    }\n  }\n\n  public processComponentRemovals(): void {\n    for (const entity of this.entities) {\n      entity.processComponentRemoval();\n    }\n  }\n\n  public getById(id: number): Entity {\n    return this._entityIndex[id];\n  }\n\n  public getByName(name: string): Entity[]{\n    return this.entities.filter(e => e.name === name);\n  }\n\n  public clear(): void {\n    for (const entity of this.entities) {\n      this.removeEntity(entity);\n    }\n  }\n}\n","export const buildTypeKey = (types: readonly string[]) => {\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\n  return key;\n};\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Observable } from '../Util/Observable';\nimport { Util, Component, ComponentCtor } from '..';\nimport { AddedEntity, RemovedEntity } from './System';\n\n/**\n * Represents query for entities that match a list of types that is cached and observable\n *\n * Queries can be strongly typed by supplying a type union in the optional type parameter\n * ```typescript\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\n * ```\n */\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\n  public types: readonly string[];\n  private _entities: Entity[] = [];\n  private _key: string;\n  public get key(): string {\n    if (this._key) {\n      return this._key;\n    }\n    return (this._key = buildTypeKey(this.types));\n  }\n\n  constructor(types: readonly string[]);\n  constructor(types: readonly ComponentCtor<T>[]);\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\n    super();\n    if (types[0] instanceof Function) {\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\n    } else {\n      this.types = types as string[];\n    }\n  }\n\n  /**\n   * Returns a list of entities that match the query\n   *\n   * @param sort Optional sorting function to sort entities returned from the query\n   */\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\n    if (sort) {\n      this._entities.sort(sort);\n    }\n    return this._entities;\n  }\n\n  /**\n   * Add an entity to the query, will only be added if the entity matches the query types\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\n      this._entities.push(entity);\n      this.notifyAll(new AddedEntity(entity));\n    }\n  }\n\n  /**\n   * If the entity is part of the query it will be removed regardless of types\n   * @param entity\n   */\n  public removeEntity(entity: Entity): void {\n    if (Util.removeItemFromArray(entity, this._entities)) {\n      this.notifyAll(new RemovedEntity(entity));\n    }\n  }\n\n  /**\n   * Removes all entities and observers from the query\n   */\n  public clear(): void {\n    this._entities.length = 0;\n    for (const observer of this.observers) {\n      this.unregister(observer);\n    }\n  }\n\n  /**\n   * Returns whether the entity's types match query\n   * @param entity\n   */\n  public matches(entity: Entity): boolean;\n\n  /**\n   * Returns whether the list of ComponentTypes have at least the same types as the query\n   * @param types\n   */\n  public matches(types: string[]): boolean;\n  public matches(typesOrEntity: string[] | Entity): boolean {\n    let types: string[] = [];\n    if (typesOrEntity instanceof Entity) {\n      types = typesOrEntity.types;\n    } else {\n      types = typesOrEntity;\n    }\n\n    let matches = true;\n    for (const type of this.types) {\n      matches = matches && types.indexOf(type) > -1;\n      if (!matches) {\n        return false;\n      }\n    }\n    return matches;\n  }\n\n  public contain(type: string) {\n    return this.types.indexOf(type) > -1;\n  }\n}\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Query } from './Query';\nimport { Component } from './Component';\nimport { World } from './World';\n\n/**\n * The query manager is responsible for updating all queries when entities/components change\n */\nexport class QueryManager {\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\n\n  constructor(private _world: World<any>) {}\n\n  /**\n   * Adds a query to the manager and populates with any entities that match\n   * @param query\n   */\n  private _addQuery(query: Query<any>) {\n    this._queries[buildTypeKey(query.types)] = query;\n    for (const entity of this._world.entityManager.entities) {\n      query.addEntity(entity);\n    }\n  }\n\n  /**\n   * Removes the query if there are no observers left\n   * @param query\n   */\n  public maybeRemoveQuery(query: Query): void {\n    if (query.observers.length === 0) {\n      query.clear();\n      delete this._queries[buildTypeKey(query.types)];\n    }\n  }\n\n  /**\n   * Adds the entity to any matching query in the query manage\n   * @param entity\n   */\n  public addEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      if (this._queries[queryType]) {\n        this._queries[queryType].addEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from queries if the removed component disqualifies it\n   * @param entity\n   * @param component\n   */\n  public removeComponent(entity: Entity, component: Component) {\n    for (const queryType in this._queries) {\n      // If the component being removed from an entity is a part of a query,\n      // it is now disqualified from that query, remove it\n      if (this._queries[queryType].contain(component.type)) {\n        this._queries[queryType].removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from all queries it is currently a part of\n   * @param entity\n   */\n  public removeEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      this._queries[queryType].removeEntity(entity);\n    }\n  }\n\n  /**\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\n   * @param types\n   */\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const maybeExistingQuery = this.getQuery<T>(types);\n    if (maybeExistingQuery) {\n      return maybeExistingQuery;\n    }\n    const query = new Query<T>(types);\n    this._addQuery(query);\n    return query;\n  }\n\n  /**\n   * Retrieves an existing query by types if it exists otherwise returns null\n   * @param types\n   */\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const key = buildTypeKey(types);\n    if (this._queries[key]) {\n      return this._queries[key] as Query<T>;\n    }\n    return null;\n  }\n}\n","import { System, SystemType } from './System';\nimport { Scene, Util } from '..';\nimport { World } from './World';\n\nexport interface SystemCtor<T extends System> {\n  new (): T;\n}\n\n/**\n * The SystemManager is responsible for keeping track of all systems in a scene.\n * Systems are scene specific\n */\nexport class SystemManager<ContextType> {\n  /**\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\n   */\n  public systems: System<any, ContextType>[] = [];\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\n  public initialized = false;\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Get a system registered in the manager by type\n   * @param systemType\n   */\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\n  }\n\n  /**\n   * Adds a system to the manager, it will now be updated every frame\n   * @param system\n   */\n  public addSystem(system: System<any, ContextType>): void {\n    // validate system has types\n    if (!system.types || system.types.length === 0) {\n      throw new Error(`Attempted to add a System without any types`);\n    }\n\n    const query = this._world.queryManager.createQuery(system.types);\n    this.systems.push(system);\n    this.systems.sort((a, b) => a.priority - b.priority);\n    query.register(system);\n    if (this.initialized && system.initialize) {\n      system.initialize(this._world.context);\n    }\n  }\n\n  /**\n   * Removes a system from the manager, it will no longer be updated\n   * @param system\n   */\n  public removeSystem(system: System<any, ContextType>) {\n    Util.removeItemFromArray(system, this.systems);\n    const query = this._world.queryManager.getQuery(system.types);\n    if (query) {\n      query.unregister(system);\n      this._world.queryManager.maybeRemoveQuery(query);\n    }\n  }\n\n  /**\n   * Initialize all systems in the manager\n   *\n   * Systems added after initialize() will be initialized on add\n   */\n  public initialize() {\n    if (!this.initialized) {\n      this.initialized = true;\n      for (const s of this.systems) {\n        if (s.initialize) {\n          s.initialize(this._world.context);\n        }\n      }\n    }\n  }\n\n  /**\n   * Updates all systems\n   * @param type whether this is an update or draw system\n   * @param context context reference\n   * @param delta time in milliseconds\n   */\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\n    const systems = this.systems.filter((s) => s.systemType === type);\n    for (const s of systems) {\n      if (s.preupdate) {\n        s.preupdate(context, delta);\n      }\n    }\n\n    for (const s of systems) {\n      // Get entities that match the system types, pre-sort\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\n      // Initialize entities if needed\n      if (context instanceof Scene) {\n        for (const entity of entities) {\n          entity._initialize(context?.engine);\n        }\n      }\n      s.update(entities, delta);\n    }\n\n    for (const s of systems) {\n      if (s.postupdate) {\n        s.postupdate(context, delta);\n      }\n    }\n  }\n\n  public clear(): void {\n    for (const system of this.systems) {\n      this.removeSystem(system);\n    }\n  }\n}\n","import { Entity } from './Entity';\nimport { EntityManager } from './EntityManager';\nimport { QueryManager } from './QueryManager';\nimport { System, SystemType } from './System';\nimport { SystemManager } from './SystemManager';\n\n/**\n * The World is a self-contained entity component system for a particular context.\n */\nexport class World<ContextType> {\n  public queryManager: QueryManager = new QueryManager(this);\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\n\n  /**\n   * The context type is passed to the system updates\n   * @param context\n   */\n  constructor(public context: ContextType) {}\n\n  /**\n   * Update systems by type and time elapsed in milliseconds\n   */\n  update(type: SystemType, delta: number) {\n    if (type === SystemType.Update) {\n      this.entityManager.updateEntities(this.context, delta);\n    }\n    this.systemManager.updateSystems(type, this.context, delta);\n    this.entityManager.findEntitiesForRemoval();\n    this.entityManager.processComponentRemovals();\n    this.entityManager.processEntityRemovals();\n  }\n\n  /**\n   * Add an entity to the ECS world\n   * @param entity\n   */\n  add(entity: Entity): void;\n  /**\n   * Add a system to the ECS world\n   * @param system\n   */\n  add(system: System<any, ContextType>): void;\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.addEntity(entityOrSystem);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.addSystem(entityOrSystem);\n    }\n  }\n\n  /**\n   * Remove an entity from the ECS world\n   * @param entity\n   */\n  remove(entity: Entity, deferred?: boolean): void;\n  /**\n   * Remove a system from the ECS world\n   * @param system\n   */\n  remove(system: System<any, ContextType>): void;\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.removeEntity(entityOrSystem, deferred);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.removeSystem(entityOrSystem);\n    }\n  }\n\n  clearEntities(): void {\n    this.entityManager.clear();\n  }\n\n  clearSystems(): void {\n    this.systemManager.clear();\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { Physics } from './Physics';\nimport { BodyComponent } from './BodyComponent';\nimport { CollisionType } from './CollisionType';\nimport { EulerIntegrator } from './Integrator';\n\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    let transform: TransformComponent;\n    let motion: MotionComponent;\n    for (const entity of _entities) {\n      transform = entity.get(TransformComponent);\n      motion = entity.get(MotionComponent);\n\n      const optionalBody = entity.get(BodyComponent);\n      if (optionalBody?.sleeping) {\n        continue;\n      }\n\n      const totalAcc = motion.acc.clone();\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\n        totalAcc.addEqual(Physics.gravity);\n      }\n      optionalBody?.captureOldTransform();\n\n      // Update transform and motion based on Euler linear algebra\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","import { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * A collision solver figures out how to position colliders such that they are no longer overlapping\n *\n * Solvers are executed in the order\n *\n * 1. preSolve\n * 2. solveVelocity\n * 3. solvePosition\n * 4. postSolve\n * @inheritdoc\n */\nexport abstract class CollisionSolver {\n  /**\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract preSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Post-solve is fired after all resolution is complete\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract postSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solveVelocity(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve position adjust the position of colliders so that they are not overlapping\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solvePosition(contacts: CollisionContact[]): void;\n\n  /**\n   * Solves overlapping contact in\n   *\n   * Solvers are executed in the order\n   * 1. preSolve\n   * 2. solveVelocity\n   * 3. solvePosition\n   * 4. postSolve\n   * @param contacts\n   */\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\n    // Events and init\n    this.preSolve(contacts);\n\n    // Remove any canceled contacts\n    contacts = contacts.filter(c => !c.isCanceled());\n\n    // Solve velocity first\n    this.solveVelocity(contacts);\n\n    // Solve position last because non-overlap is the most important\n    this.solvePosition(contacts);\n\n    // Events and any contact house-keeping the solver needs\n    this.postSolve(contacts);\n\n    return contacts;\n  }\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { Side } from '../Side';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\n * and negates velocity along the collision normal.\n *\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\n *\n */\nexport class ArcadeSolver extends CollisionSolver {\n  public preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n      }\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public solvePosition(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // if bounds no longer interesect skip to the next\n      // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\n      if (!contact.colliderA.bounds.intersect(contact.colliderB.bounds)) {\n        continue;\n      }\n      let mtv = contact.mtv;\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\n          // split overlaps if both are Active\n          mtv = mtv.scale(0.5);\n        }\n\n        // Resolve overlaps\n        if (bodyA.collisionType === CollisionType.Active) {\n          bodyA.pos.x -= mtv.x;\n          bodyA.pos.y -= mtv.y;\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          bodyB.pos.x += mtv.x;\n          bodyB.pos.y += mtv.y;\n        }\n      }\n    }\n  }\n\n  public solveVelocity(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        const normal = contact.normal;\n        const opposite = normal.negate();\n\n        // Cancel out velocity opposite direction of collision normal\n        if (bodyA.collisionType === CollisionType.Active) {\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\n          bodyA.vel = bodyA.vel.add(velAdj);\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\n          bodyB.vel = bodyB.vel.add(velAdj);\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity between bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { clamp } from '../../Math/util';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\nimport { Side } from '../Side';\nimport { Physics } from '../Physics';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\n\nexport class RealisticSolver extends CollisionSolver {\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\n\n  // map contact id to contact points\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\n\n  getContactConstraints(id: string) {\n    return this.idToContactConstraint.get(id) ?? [];\n  }\n\n  preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n\n      // Match awake state for sleeping\n      contact.matchAwake();\n    }\n\n    // Keep track of contacts that done\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\n    for (const contact of contacts) {\n      // Remove all current contacts that are not done\n      const index = finishedContactIds.indexOf(contact.id);\n      if (index > -1) {\n        finishedContactIds.splice(index, 1);\n      }\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n\n      let pointIndex = 0;\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n      if (bodyA && bodyB) {\n        for (const point of contact.points) {\n          const normal = contact.normal;\n          const tangent = contact.tangent;\n\n          const aToContact = point.sub(bodyA.pos);\n          const bToContact = point.sub(bodyB.pos);\n\n          const aToContactNormal = aToContact.cross(normal);\n          const bToContactNormal = bToContact.cross(normal);\n\n          const normalMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n          const aToContactTangent = aToContact.cross(tangent);\n          const bToContactTangent = bToContact.cross(tangent);\n\n          const tangentMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\n            contactPoints[pointIndex].point = point;\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\n          } else {\n            // new contact if it's not close or doesn't exist\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\n          }\n\n          // Update contact point calculations\n          contactPoints[pointIndex].aToContact = aToContact;\n          contactPoints[pointIndex].bToContact = bToContact;\n          contactPoints[pointIndex].normalMass = normalMass;\n          contactPoints[pointIndex].tangentMass = tangentMass;\n\n          pointIndex++;\n        }\n      }\n      this.idToContactConstraint.set(contact.id, contactPoints);\n    }\n\n    // Clean up any contacts that did not occur last frame\n    for (const id of finishedContactIds) {\n      this.idToContactConstraint.delete(id);\n    }\n\n    // Warm contacts with accumulated impulse\n    // Useful for tall stacks\n    if (Physics.warmStart) {\n      this.warmStart(contacts);\n    } else {\n      for (const contact of contacts) {\n        const contactPoints = this.getContactConstraints(contact.id);\n        for (const point of contactPoints) {\n          point.normalImpulse = 0;\n          point.tangentImpulse = 0;\n        }\n      }\n    }\n  }\n\n  postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n        // Skip post solve for active+passive collisions\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        // Update motion values for sleeping\n        bodyA.updateMotion();\n        bodyB.updateMotion();\n      }\n\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n    }\n\n    // Store contacts\n    this.lastFrameContacts.clear();\n    for (const c of contacts) {\n      this.lastFrameContacts.set(c.id, c);\n    }\n  }\n\n  /**\n   * Warm up body's based on previous frame contact points\n   * @param contacts\n   */\n  warmStart(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n        for (const point of contactPoints) {\n          if (Physics.warmStart) {\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\n            const impulse = normalImpulse.add(tangentImpulse);\n\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          } else {\n            point.normalImpulse = 0;\n            point.tangentImpulse = 0;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Iteratively solve the position overlap constraint\n   * @param contacts\n   */\n  solvePosition(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.positionIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n          for (const point of constraints) {\n            const normal = contact.normal;\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\n\n            const steeringConstant = Physics.steeringFactor; //0.2;\n            const maxCorrection = -5;\n            const slop = Physics.slop; //1;\n\n            // Clamp to avoid over-correction\n            // Remember that we are shooting for 0 overlap in the end\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\n            const impulse = normal.scale(-steeringForce / point.normalMass);\n\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\n            // We adjust position and rotation instead of doing the velocity\n            if (bodyA.collisionType === CollisionType.Active) {\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\n            }\n\n            if (bodyB.collisionType === CollisionType.Active) {\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  solveVelocity(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.velocityIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const restitution = bodyA.bounciness * bodyB.bounciness;\n          const friction = Math.min(bodyA.friction, bodyB.friction);\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n\n          for (const point of constraints) {\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Negate velocity in tangent direction to simulate friction\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\n            let impulseDelta = tangentVelocity / point.tangentMass;\n\n            // Clamping based in Erin Catto's GDC 2006 talk\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\n            // But deltas can vary\n            const maxFriction = friction * point.normalImpulse;\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\n            impulseDelta = newImpulse - point.tangentImpulse;\n            point.tangentImpulse = newImpulse;\n\n            const impulse = contact.tangent.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n\n          for (const point of constraints) {\n            // Need to recalc relative velocity because the previous step could have changed vel\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Compute impulse in normal direction\n            const normalVelocity = relativeVelocity.dot(contact.normal);\n            // See https://en.wikipedia.org/wiki/Collision_response\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\n\n            // Clamping based in Erin Catto's GDC 2014 talk\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\n            // But deltas can be negative\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\n            impulseDelta = newImpulse - point.normalImpulse;\n            point.normalImpulse = newImpulse;\n\n            const impulse = contact.normal.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n        }\n      }\n    }\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\nimport { CollisionResolutionStrategy, Physics } from './Physics';\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\nimport { Collider } from './Colliders/Collider';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\nimport { RealisticSolver } from './Solver/RealisticSolver';\nimport { CollisionSolver } from './Solver/Solver';\nimport { ColliderComponent } from './ColliderComponent';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\n\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _realisticSolver = new RealisticSolver();\n  private _arcadeSolver = new ArcadeSolver();\n  private _processor = new DynamicTreeCollisionProcessor();\n  private _lastFrameContacts = new Map<string, CollisionContact>();\n  private _currentFrameContacts = new Map<string, CollisionContact>();\n\n  private _trackCollider = (c: Collider) => this._processor.track(c);\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\n\n  notify(message: AddedEntity | RemovedEntity) {\n    if (isAddedSystemEntity(message)) {\n      const colliderComponent = message.data.get(ColliderComponent);\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\n      const collider = colliderComponent.get();\n      if (collider) {\n        this._processor.track(collider);\n      }\n    } else {\n      const colliderComponent = message.data.get(ColliderComponent);\n      const collider = colliderComponent.get();\n      if (colliderComponent && collider) {\n        this._processor.untrack(collider);\n      }\n    }\n  }\n\n  initialize(scene: Scene) {\n    this._engine = scene.engine;\n  }\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    if (!Physics.enabled) {\n      return;\n    }\n\n    // Collect up all the colliders\n    let colliders: Collider[] = [];\n    for (const entity of _entities) {\n      const colliderComp = entity.get(ColliderComponent);\n      const collider = colliderComp?.get();\n      if (colliderComp && colliderComp.owner?.active && collider) {\n        colliderComp.update();\n        if (collider instanceof CompositeCollider) {\n          colliders = colliders.concat(collider.getColliders());\n        } else {\n          colliders.push(collider);\n        }\n      }\n    }\n\n    // Update the spatial partitioning data structures\n    // TODO if collider invalid it will break the processor\n    // TODO rename \"update\" to something more specific\n    this._processor.update(colliders);\n\n    // Run broadphase on all colliders and locates potential collisions\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\n\n    this._currentFrameContacts.clear();\n\n    // Given possible pairs find actual contacts\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\n\n    const solver: CollisionSolver = this.getSolver();\n\n    // Solve, this resolves the position/velocity so entities aren't overlapping\n    contacts = solver.solve(contacts);\n\n    // Record contacts\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\n\n    // Emit contact start/end events\n    this.runContactStartEnd();\n\n    // reset the last frame cache\n    this._lastFrameContacts.clear();\n\n    // Keep track of collisions contacts that have started or ended\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\n  }\n\n  getSolver(): CollisionSolver {\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\n  }\n\n  debug(ex: ExcaliburGraphicsContext) {\n    this._processor.debug(ex);\n  }\n\n  public runContactStartEnd() {\n    for (const [id, c] of this._currentFrameContacts) {\n      // find all new contacts\n      if (!this._lastFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\n      }\n    }\n\n    // find all contacts taht have ceased\n    for (const [id, c] of this._lastFrameContacts) {\n      if (!this._currentFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\n      }\n    }\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { SpriteSheet } from './SpriteSheet';\nimport { Logger } from '../Util/Log';\nimport { Engine, LegacyDrawing } from '..';\nimport { Sprite } from '.';\nimport { clamp } from '../Math/util';\n\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\nexport enum AnimationDirection {\n  /**\n   * Animation is playing forwards\n   */\n  Forward = 'forward',\n  /**\n   * Animation is play backwards\n   */\n  Backward = 'backward'\n}\n\nexport enum AnimationStrategy {\n  /**\n   * Animation ends without displaying anything\n   */\n  End = 'end',\n  /**\n   * Animation loops to the first frame after the last frame\n   */\n  Loop = 'loop',\n  /**\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\n   */\n  PingPong = 'pingpong',\n  /**\n   * Animation ends stopping on the last frame\n   */\n  Freeze = 'freeze'\n}\n\n/**\n * Frame of animation\n */\nexport interface Frame {\n  /**\n   * Optionally specify a graphic to show, no graphic shows an empty frame\n   */\n  graphic?: Graphic;\n  /**\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\n   */\n  duration?: number;\n}\n\n/**\n * Animation options for building an animation via constructor.\n */\nexport interface AnimationOptions {\n  /**\n   * List of frames in the order you wish to play them\n   */\n  frames: Frame[];\n  /**\n   * Optionally reverse the direction of play\n   */\n  reverse?: boolean;\n  /**\n   * Optionally specify a default frame duration in ms (Default is 1000)\n   */\n  frameDuration?: number;\n  /**\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\n   */\n  totalDuration?: number;\n  /**\n   * Optionally specify the [[AnimationStrategy]] for the Animation\n   */\n  strategy?: AnimationStrategy;\n}\n\n// TODO wire up to new Emitter\nexport type AnimationEvents = {\n  frame: Frame;\n  loop: Animation;\n  ended: Animation;\n};\n\n/**\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\n *\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\n */\nexport class Animation extends Graphic implements HasTick {\n  private static _LOGGER = Logger.getInstance();\n  public events = new EventDispatcher<any>(); // TODO replace with new Emitter\n  public frames: Frame[] = [];\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\n  public frameDuration: number = 100;\n  public timeScale: number = 1;\n\n  private _idempotencyToken = -1;\n\n  private _firstTick = true;\n  private _currentFrame = 0;\n  private _timeLeftInFrame = 0;\n  private _direction = 1; // TODO only used in ping-pong\n  private _done = false;\n  private _playing = true;\n\n  constructor(options: GraphicOptions & AnimationOptions) {\n    super(options);\n    this.frames = options.frames;\n    this.strategy = options.strategy ?? this.strategy;\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\n    if (options.reverse) {\n      this.reverse();\n    }\n    this.goToFrame(0);\n  }\n\n  public clone(): Animation {\n    return new Animation({\n      frames: this.frames.map((f) => ({ ...f })),\n      frameDuration: this.frameDuration,\n      reverse: this._reversed,\n      strategy: this.strategy,\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  public override get width(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\n    }\n    return 0;\n  }\n\n  public override get height(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\n    }\n    return 0;\n  }\n\n\n  /**\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\n   * and optional [[AnimationStrategy]]\n   *\n   * Example:\n   * ```typescript\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\n   *\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\n   * ```\n   *\n   * @param spriteSheet\n   * @param frameIndices\n   * @param durationPerFrameMs\n   * @param strategy\n   */\n  public static fromSpriteSheet(\n    spriteSheet: SpriteSheet,\n    frameIndices: number[],\n    durationPerFrameMs: number,\n    strategy: AnimationStrategy = AnimationStrategy.Loop\n  ): Animation {\n    const maxIndex = spriteSheet.sprites.length - 1;\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\n    if (invalidIndices.length) {\n      Animation._LOGGER.warn(\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\n      );\n    }\n    return new Animation({\n      frames: spriteSheet.sprites\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\n        .map((f) => ({\n          graphic: f,\n          duration: durationPerFrameMs\n        })),\n      strategy: strategy\n    });\n  }\n\n  /**\n   * Converts an animation to a legacy animation\n   * @deprecated\n   * @param engine\n   * @param animation\n   * @returns LegacyDrawing.Animation\n   */\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\n    return new LegacyDrawing.Animation({\n      sprites: legacySprites,\n      loop: animation.strategy === AnimationStrategy.Loop,\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\n      speed: animation.frameDuration,\n      engine: engine\n    });\n  }\n\n  /**\n   * Returns the current Frame of the animation\n   */\n  public get currentFrame(): Frame | null {\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\n      return this.frames[this._currentFrame];\n    }\n    return null;\n  }\n\n  /**\n   * Returns the current frame index of the animation\n   */\n  public get currentFrameIndex(): number {\n    return this._currentFrame;\n  }\n\n  /**\n   * Returns `true` if the animation is playing\n   */\n  public get isPlaying(): boolean {\n    return this._playing;\n  }\n\n  private _reversed = false;\n  /**\n   * Reverses the play direction of the Animation, this preserves the current frame\n   */\n  public reverse(): void {\n    // Don't mutate with the original frame list, create a copy\n    this.frames = this.frames.slice().reverse();\n    this._reversed = !this._reversed;\n  }\n\n  /**\n   * Returns the current play direction of the animation\n   */\n  public get direction(): AnimationDirection {\n    // Keep logically consistent with ping-pong direction\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\n  }\n\n  /**\n   * Plays or resumes the animation from the current frame\n   */\n  public play(): void {\n    this._playing = true;\n  }\n\n  /**\n   * Pauses the animation on the current frame\n   */\n  public pause(): void {\n    this._playing = false;\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\n  }\n\n  /**\n   * Reset the animation back to the beginning, including if the animation were done\n   */\n  public reset(): void {\n    this._done = false;\n    this._firstTick = true;\n    this._currentFrame = 0;\n  }\n\n  /**\n   * Returns `true` if the animation can end\n   */\n  public get canFinish(): boolean {\n    switch (this.strategy) {\n      case AnimationStrategy.End:\n      case AnimationStrategy.Freeze: {\n        return true;\n      }\n      default: {\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Returns `true` if the animation is done, for looping type animations\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\n   *\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\n   */\n  public get done(): boolean {\n    return this._done;\n  }\n\n  /**\n   * Jump the animation immediately to a specific frame if it exists\n   * @param frameNumber\n   */\n  public goToFrame(frameNumber: number) {\n    this._currentFrame = frameNumber;\n    this._timeLeftInFrame = this.frameDuration;\n    const maybeFrame = this.frames[this._currentFrame];\n    if (maybeFrame && !this._done) {\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\n      this.events.emit('frame', maybeFrame as any);\n    }\n  }\n\n  private _nextFrame(): number {\n    const currentFrame = this._currentFrame;\n    if (this._done) {\n      return currentFrame;\n    }\n    let next = -1;\n\n    switch (this.strategy) {\n      case AnimationStrategy.Loop: {\n        next = (currentFrame + 1) % this.frames.length;\n        if (next === 0) {\n          this.events.emit('loop', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.End: {\n        next = currentFrame + 1;\n        if (next >= this.frames.length) {\n          this._done = true;\n          this._currentFrame = this.frames.length;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.Freeze: {\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\n        if (next >= this.frames.length - 1) {\n          this._done = true;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.PingPong: {\n        if (currentFrame + this._direction >= this.frames.length) {\n          this._direction = -1;\n          this.events.emit('loop', this as any);\n        }\n\n        if (currentFrame + this._direction < 0) {\n          this._direction = 1;\n          this.events.emit('loop', this as any);\n        }\n\n        next = currentFrame + (this._direction % this.frames.length);\n        break;\n      }\n    }\n    return next;\n  }\n\n  /**\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\n   * @param elapsedMilliseconds Milliseconds elapsed\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\n   */\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    if (!this._playing) {\n      return;\n    }\n\n    // if it's the first frame emit frame event\n    if (this._firstTick) {\n      this._firstTick = false;\n      this.events.emit('frame', this.currentFrame as any);\n    }\n\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\n    if (this._timeLeftInFrame <= 0) {\n      this.goToFrame(this._nextFrame());\n    }\n  }\n\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.currentFrame) {\n      this.currentFrame.graphic.draw(ctx, x, y);\n    }\n  }\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Color } from './Color';\nimport { Vector, vec } from './Math/vector';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/Index';\nimport { Sprite } from './Graphics/Sprite';\nimport { BoundingBox, LegacyDrawing } from '.';\nimport { clamp, randomInRange } from './Math/util';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl extends Entity {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: LegacyDrawing.Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  public visible = true;\n  public isOffscreen = false;\n\n  public transform: TransformComponent;\n  public graphics: GraphicsComponent;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super();\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = (position || this.position).add(this.emitter.pos);\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n\n    this.addComponent((this.transform = new TransformComponent()));\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\n    this.addComponent((this.graphics = new GraphicsComponent()));\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // TODO wut\n    if (this.particleSprite) {\n      this.graphics.opacity = this.opacity;\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\n    } else {\n      this.graphics.localBounds = BoundingBox.fromDimension(this.particleSize, this.particleSize, Vector.Half);\n      this.graphics.onPostDraw = (ctx) => {\n        ctx.save();\n        this.graphics.opacity = this.opacity;\n        const tmpColor = this._currentColor.clone();\n        tmpColor.a = 1;\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\n        ctx.restore();\n      };\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // todo wut\n    this.graphics.opacity = this.opacity;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.opacity(this.opacity);\n      this.particleSprite.draw(ctx, 0, 0);\n      return;\n    }\n\n    ctx.save();\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n    ctx.restore();\n  }\n}\n\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: LegacyDrawing.Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\nexport interface ParticleEmitterArgs {\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: LegacyDrawing.Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n */\nexport class ParticleEmitter extends Actor {\n  private _particlesToEmit: number = 0;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Particle[] = [];\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Particle[] = [];\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public get opacity(): number {\n    return super.graphics.opacity;\n  }\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public set opacity(opacity: number) {\n    super.graphics.opacity = opacity;\n  }\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = null;\n  /**\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /**\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  private _og: LegacyDrawing.Sprite = null;\n  private _sprite: Sprite = null;\n  /**\n   * Gets or sets the sprite that a particle should use\n   */\n  public get particleSprite(): LegacyDrawing.Sprite {\n    return this._og;\n  }\n\n  public set particleSprite(val: LegacyDrawing.Sprite) {\n    this._og = val;\n    if (val) {\n      this._sprite = Sprite.fromLegacySprite(val);\n    }\n  }\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param config particle emitter options bag\n   */\n  constructor(config: ParticleEmitterArgs) {\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\n\n    const {\n      x,\n      y,\n      pos,\n      isEmitting,\n      minVel,\n      maxVel,\n      acceleration,\n      minAngle,\n      maxAngle,\n      emitRate,\n      particleLife,\n      opacity,\n      fadeFlag,\n      focus,\n      focusAccel,\n      startSize,\n      endSize,\n      minSize,\n      maxSize,\n      beginColor,\n      endColor,\n      particleSprite,\n      emitterType,\n      radius,\n      particleRotationalVelocity,\n      randomRotation,\n      random\n    } = { ...config };\n\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.isEmitting = isEmitting ?? this.isEmitting;\n    this.minVel = minVel ?? this.minVel;\n    this.maxVel = maxVel ?? this.maxVel;\n    this.acceleration = acceleration ?? this.acceleration;\n    this.minAngle = minAngle ?? this.minAngle;\n    this.maxAngle = maxAngle ?? this.maxAngle;\n    this.emitRate = emitRate ?? this.emitRate;\n    this.particleLife = particleLife ?? this.particleLife;\n    this.opacity = opacity ?? this.opacity;\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\n    this.focus = focus ?? this.focus;\n    this.focusAccel = focusAccel ?? this.focusAccel;\n    this.startSize = startSize ?? this.startSize;\n    this.endSize = endSize ?? this.endSize;\n    this.minSize = minSize ?? this.minSize;\n    this.maxSize = maxSize ?? this.maxSize;\n    this.beginColor = beginColor ?? this.beginColor;\n    this.endColor = endColor ?? this.endColor;\n    this.particleSprite = particleSprite ?? this.particleSprite;\n    this.emitterType = emitterType ?? this.emitterType;\n    this.radius = radius ?? this.radius;\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\n    this.randomRotation = randomRotation ?? this.randomRotation;\n\n    this.body.collisionType = CollisionType.PreventCollision;\n\n    this.random = random ?? new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      const p = this._createParticle();\n      this.particles.push(p);\n      if (this?.scene?.world) {\n        this.scene.world.add(p);\n      }\n    }\n  }\n\n  public clearParticles() {\n    this.particles.length = 0;\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = randomInRange(0, this.width, this.random);\n      ranY = randomInRange(0, this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle);\n      ranY = radius * Math.sin(angle);\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n      p.graphics.opacity = this.opacity;\n      p.graphics.use(this._sprite);\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    // deferred removal\n    for (let i = 0; i < this.deadParticles.length; i++) {\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\n      if (this?.scene?.world) {\n        this.scene.world.remove(this.deadParticles[i], false);\n      }\n    }\n    this.deadParticles.length = 0;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Scene } from '../Scene';\nimport { GraphicsComponent } from './GraphicsComponent';\nimport { vec } from '../Math/vector';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Camera } from '../Camera';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem';\nimport { Engine } from '../Engine';\nimport { GraphicsGroup } from '.';\nimport { Particle } from '../Particles';\n\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 0;\n  private _token = 0;\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  private _sortedTransforms: TransformComponent[] = [];\n  public get sortedTransforms() {\n    return this._sortedTransforms;\n  }\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n  }\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return a.z - b.z;\n      });\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n      }\n    }\n  }\n\n  public update(_entities: Entity[], delta: number): void {\n    this._token++;\n    let graphics: GraphicsComponent;\n\n    // This is a performance enhancement, most things are in world space\n    // so if we can only do this once saves a ton of transform updates\n    this._graphicsContext.save();\n    if (this._camera) {\n      this._camera.draw(this._graphicsContext);\n    }\n    for (const transform of this._sortedTransforms) {\n      const entity = transform.owner as Entity;\n\n      // If the entity is offscreen skip\n      if (entity.hasTag('ex.offscreen')) {\n        continue;\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      // Exit if graphics set to not visible\n      if (!graphics.visible) {\n        continue;\n      }\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.restore();\n      }\n\n      this._graphicsContext.save();\n\n      // Tick any graphics state (but only once) for animations and graphics groups\n      graphics.update(delta, this._token);\n\n      // Position the entity\n      this._applyTransform(entity);\n\n      // Optionally run the onPreDraw graphics lifecycle draw\n      if (graphics.onPreDraw) {\n        graphics.onPreDraw(this._graphicsContext, delta);\n      }\n\n      // TODO remove this hack on the particle redo\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\n\n      // Draw the graphics component\n      this._drawGraphicsComponent(graphics);\n\n      // Optionally run the onPostDraw graphics lifecycle draw\n      if (graphics.onPostDraw) {\n        graphics.onPostDraw(this._graphicsContext, delta);\n      }\n\n      this._graphicsContext.restore();\n\n      // Reset the transform back to the original world space\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.save();\n        if (this._camera) {\n          this._camera.draw(this._graphicsContext);\n        }\n      }\n    }\n    this._graphicsContext.restore();\n  }\n\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\n    if (graphicsComponent.visible) {\n      // this should be moved to the graphics system\n      for (const layer of graphicsComponent.layers.get()) {\n        for (const { graphic, options } of layer.graphics) {\n          let anchor = graphicsComponent.anchor;\n          let offset = graphicsComponent.offset;\n          if (options?.anchor) {\n            anchor = options.anchor;\n          }\n          if (options?.offset) {\n            offset = options.offset;\n          }\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n          const offsetX = -graphic.width * anchor.x + offset.x;\n          const offsetY = -graphic.height * anchor.y + offset.y;\n\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\n\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\n            if (graphic instanceof GraphicsGroup) {\n              for (const g of graphic.members) {\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n              }\n            } else {\n              /* istanbul ignore next */\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Actor } from '../Actor';\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\n\n/**\n * Draws anything with a transform and a \"draw\" method\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\n */\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\n  public systemType = SystemType.Draw;\n  public priority = -1;\n\n  private _ctx: CanvasRenderingContext2D;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._ctx = scene.engine.ctx;\n    this._engine = scene.engine;\n    this._camera = scene.camera;\n  }\n\n  public sort(a: Entity, b: Entity) {\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\n  }\n\n  public update(entities: Entity[], delta: number) {\n    this._clearScreen();\n\n    let transform: TransformComponent;\n    let canvasdraw: CanvasDrawComponent;\n    const length = entities.length;\n    for (let i = 0; i < length; i++) {\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\n      const offscreen = (entities[i] as Actor).isOffScreen;\n      if (visible && !offscreen) {\n        transform = entities[i].get(TransformComponent);\n        canvasdraw = entities[i].get(CanvasDrawComponent);\n\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n\n        this._ctx.save();\n        this._applyTransform(entities[i]);\n        canvasdraw.draw(this._ctx, delta);\n        this._ctx.restore();\n\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n\n      if (this._engine.isDebug) {\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n        this._ctx.strokeStyle = 'yellow';\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n    }\n    if (this._engine.isDebug) {\n      this._ctx.save();\n      this._camera.draw(this._ctx);\n      this._camera.debugDraw(this._ctx);\n      this._ctx.restore();\n    }\n\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n  }\n\n  private _applyTransform(entity: Entity) {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._ctx.translate(transform.pos.x, transform.pos.y);\n        this._ctx.rotate(transform.rotation);\n        this._ctx.scale(transform.scale.x, transform.scale.y);\n      }\n    }\n  }\n\n  private _clearScreen(): void {\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n  }\n\n  private _pushCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera transform to place entity in world space\n      this._ctx.save();\n      if (this._camera) {\n        this._camera.draw(this._ctx);\n      }\n    }\n  }\n\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Restore back to screen space from world space if we were drawing an entity there\n      this._ctx.restore();\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { vec, Vector } from '../Math/vector';\nimport { toDegrees } from '../Math/util';\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle } from '..';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\n\nexport class DebugSystem extends System<TransformComponent> {\n  public readonly types = ['ex.transform'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 999; // lowest priority\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _collisionSystem: CollisionSystem;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\n  }\n\n  update(entities: Entity[], _delta: number): void {\n    if (!this._engine.isDebug) {\n      return;\n    }\n\n    const filterSettings = this._engine.debug.filter;\n\n    let id: number;\n    let name: string;\n    const entitySettings = this._engine.debug.entity;\n\n    let tx: TransformComponent;\n    const txSettings = this._engine.debug.transform;\n\n    let motion: MotionComponent;\n    const motionSettings = this._engine.debug.motion;\n\n    let colliderComp: ColliderComponent;\n    const colliderSettings = this._engine.debug.collider;\n\n    const physicsSettings = this._engine.debug.physics;\n\n    let graphics: GraphicsComponent;\n    const graphicsSettings = this._engine.debug.graphics;\n\n    let debugDraw: DebugGraphicsComponent;\n\n    let body: BodyComponent;\n    const bodySettings = this._engine.debug.body;\n\n    const cameraSettings = this._engine.debug.camera;\n    for (const entity of entities) {\n      if (entity.hasTag('offscreen')) {\n        // skip offscreen entities\n        continue;\n      }\n      if (entity instanceof Particle) {\n        // Particles crush the renderer :(\n        continue;\n      }\n      if (filterSettings.useFilter) {\n        const allIds = filterSettings.ids.length === 0;\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\n        if (!idMatch) {\n          continue;\n        }\n        const allNames = filterSettings.nameQuery === '';\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\n        if (!nameMatch) {\n          continue;\n        }\n      }\n\n      let cursor = Vector.Zero;\n      const lineHeight = vec(0, 16);\n      id = entity.id;\n      name = entity.name;\n      tx = entity.get(TransformComponent);\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      this._pushCameraTransform(tx);\n\n      this._graphicsContext.save();\n\n      this._applyTransform(entity);\n      if (tx) {\n        if (txSettings.showAll || txSettings.showPosition) {\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\n        }\n        if (txSettings.showAll || txSettings.showPositionLabel) {\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n        if (txSettings.showAll || txSettings.showZIndex) {\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showId) {\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showName) {\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showRotation) {\n          this._graphicsContext.drawLine(\n            Vector.Zero,\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\n            txSettings.rotationColor,\n            2\n          );\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showScale) {\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\n        }\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      if (graphics) {\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\n          const bounds = graphics.localBounds;\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\n        }\n      }\n\n      debugDraw = entity.get(DebugGraphicsComponent);\n      if (debugDraw) {\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.restore();\n        }\n        debugDraw.draw(this._graphicsContext);\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.save();\n          this._applyTransform(entity);\n        }\n      }\n\n      body = entity.get(BodyComponent);\n      if (body) {\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMass) {\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMotion) {\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showSleeping) {\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n      }\n\n      this._graphicsContext.restore();\n\n      motion = entity.get(MotionComponent);\n      if (motion) {\n        if (motionSettings.showAll || motionSettings.showVelocity) {\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\n        }\n      }\n\n      // Colliders live in world space already so after the restore()\n      colliderComp = entity.get(ColliderComponent);\n      if (colliderComp) {\n        const collider = colliderComp.get();\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\n        }\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\n          if (collider instanceof CompositeCollider) {\n            const colliders = collider.getColliders();\n            for (const collider of colliders) {\n              const bounds = collider.bounds;\n              const pos = vec(bounds.left, bounds.top);\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\n              }\n            }\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\n          } else if (collider) {\n            const bounds = colliderComp.bounds;\n            const pos = vec(bounds.left, bounds.top);\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\n            }\n          }\n        }\n      }\n\n      this._popCameraTransform(tx);\n    }\n\n    this._graphicsContext.save();\n    this._camera.draw(this._graphicsContext);\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\n      this._collisionSystem.debug(this._graphicsContext);\n    }\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\n          }\n        }\n\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\n              color: physicsSettings.collisionNormalColor\n            });\n          }\n        }\n      }\n    }\n    this._graphicsContext.restore();\n\n    if (cameraSettings) {\n      this._graphicsContext.save();\n      this._camera.draw(this._graphicsContext);\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\n      }\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\n      }\n      this._graphicsContext.restore();\n    }\n\n    this._graphicsContext.flush();\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n\n  /**\n   * Applies the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _pushCameraTransform(transform: TransformComponent) {\n    // Establish camera offset per entity\n    if (transform.coordPlane === CoordPlane.World) {\n      this._graphicsContext.save();\n      if (this._camera) {\n        this._camera.draw(this._graphicsContext);\n      }\n    }\n  }\n\n  /**\n   * Resets the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera world offset\n      this._graphicsContext.restore();\n    }\n  }\n}\n","import { ColliderComponent } from '../Collision/ColliderComponent';\nimport { Engine } from '../Engine';\nimport {\n  System,\n  TransformComponent,\n  SystemType,\n  Entity,\n  CoordPlane,\n  AddedEntity,\n  RemovedEntity,\n  isAddedSystemEntity\n} from '../EntityComponentSystem';\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\nimport { Scene } from '../Scene';\nimport { PointerComponent } from './PointerComponent';\nimport { PointerEventReceiver } from './PointerEventReceiver';\nimport { PointerEvent } from './PointerEvent';\n\n/**\n * The PointerSystem is responsible for dispatching pointer events to entities\n * that need them.\n *\n * The PointerSystem can be optionally configured by the [[PointerComponent]], by default Entities use\n * the [[Collider]]'s shape for pointer events.\n */\nexport class PointerSystem extends System<TransformComponent | PointerComponent> {\n  public readonly types = ['ex.transform', 'ex.pointer'] as const;\n  public readonly systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _receiver: PointerEventReceiver;\n\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseColliderShape = false;\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseGraphicsBounds = false;\n\n  public lastFrameEntityToPointers = new Map<number, number[]>();\n  public currentFrameEntityToPointers = new Map<number, number[]>();\n\n  public initialize(scene: Scene): void {\n    this._engine = scene.engine;\n    this._receiver = this._engine.input.pointers;\n  }\n\n  private _sortedTransforms: TransformComponent[] = [];\n  private _sortedEntities: Entity[] = [];\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return b.z - a.z;\n      });\n      this._sortedEntities = this._sortedTransforms.map(t => t.owner);\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      this._sortedEntities.push(tx.owner);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n        this._sortedEntities.splice(index, 1);\n      }\n    }\n  }\n\n  public entityCurrentlyUnderPointer(entity: Entity, pointerId: number) {\n    return this.currentFrameEntityToPointers.has(entity.id) &&\n           this.currentFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entityWasUnderPointer(entity: Entity, pointerId: number) {\n    return this.lastFrameEntityToPointers.has(entity.id) &&\n           this.lastFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entered(entity: Entity, pointerId: number) {\n    return this.entityCurrentlyUnderPointer(entity, pointerId) &&\n           !this.lastFrameEntityToPointers.has(entity.id);\n  }\n\n  public left(entity: Entity, pointerId: number) {\n    return !this.currentFrameEntityToPointers.has(entity.id) &&\n            this.entityWasUnderPointer(entity, pointerId);\n  }\n\n  public addPointerToEntity(entity: Entity, pointerId: number) {\n    if (!this.currentFrameEntityToPointers.has(entity.id)) {\n      this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\n      return;\n    }\n    const pointers = this.currentFrameEntityToPointers.get(entity.id);\n    this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\n  }\n\n  public update(_entities: Entity[]): void {\n    // Locate all the pointer/entity mappings\n    this._processPointerToEntity(this._sortedEntities);\n\n    // Dispatch pointer events on entities\n    this._dispatchEvents(this._sortedEntities);\n\n    // Clear last frame's events\n    this._receiver.update();\n    this.lastFrameEntityToPointers.clear();\n    this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\n    this.currentFrameEntityToPointers.clear();\n    this._receiver.clear();\n  }\n\n  private _processPointerToEntity(entities: Entity[]) {\n    let transform: TransformComponent;\n    let collider: ColliderComponent;\n    let graphics: GraphicsComponent;\n    let pointer: PointerComponent;\n\n    // TODO probably a spatial partition optimization here to quickly query bounds for pointer\n    // doesn't seem to cause issues tho for perf\n\n    // Pre-process find entities under pointers\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      pointer = entity.get(PointerComponent) ?? new PointerComponent;\n      // Check collider contains pointer\n      collider = entity.get(ColliderComponent);\n      if (collider && (pointer.useColliderShape || this.overrideUseColliderShape)) {\n        const geom = collider.get();\n        if (geom) {\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n            if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n              this.addPointerToEntity(entity, pointerId);\n            }\n          }\n        }\n      }\n\n      // Check graphics contains pointer\n      graphics = entity.get(GraphicsComponent);\n      if (graphics && (pointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\n        const graphicBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n        for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n          if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n            this.addPointerToEntity(entity, pointerId);\n          }\n        }\n      }\n    }\n  }\n\n  private _processDownAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastDownPerPointer = new Map<number, PointerEvent>();\n    // Loop through down and dispatch to entities\n    for (const event of this._receiver.currentFrameDown) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerdown', event as any);\n        if (this._receiver.isDragStart(event.pointerId)) {\n          entity.events.emit('pointerdragstart', event as any);\n        }\n      }\n      lastDownPerPointer.set(event.pointerId, event);\n    }\n    return lastDownPerPointer;\n  }\n\n  private _processUpAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastUpPerPointer = new Map<number, PointerEvent>();\n    // Loop through up and dispatch to entities\n    for (const event of this._receiver.currentFrameUp) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerup', event as any);\n        if (this._receiver.isDragEnd(event.pointerId)) {\n          entity.events.emit('pointerdragend', event as any);\n        }\n      }\n      lastUpPerPointer.set(event.pointerId, event);\n    }\n    return lastUpPerPointer;\n  }\n\n  private _processMoveAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastMovePerPointer = new Map<number, PointerEvent>();\n    // Loop through move and dispatch to entities\n    for (const event of this._receiver.currentFrameMove) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        // move\n        entity.events.emit('pointermove', event as any);\n\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragmove', event as any);\n        }\n      }\n      lastMovePerPointer.set(event.pointerId, event);\n    }\n    return lastMovePerPointer;\n  }\n\n  private _processEnterLeaveAndEmit(entity: Entity, lastUpDownMoveEvents: PointerEvent[]) {\n    // up, down, and move are considered for enter and leave\n    for (const event of lastUpDownMoveEvents) {\n      // enter\n      if (event.active && entity.active && this.entered(entity, event.pointerId)) {\n        entity.events.emit('pointerenter', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragenter', event as any);\n        }\n        break;\n      }\n      if (event.active && entity.active &&\n          // leave can happen on move\n          (this.left(entity, event.pointerId) ||\n          // or leave can happen on pointer up\n          (this.entityCurrentlyUnderPointer(entity, event.pointerId) && event.type === 'up'))) {\n        entity.events.emit('pointerleave', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragleave', event as any);\n        }\n        break;\n      }\n    }\n  }\n\n  private _processCancelAndEmit(entity: Entity) {\n    // cancel\n    for (const event of this._receiver.currentFrameCancel) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)){\n        entity.events.emit('pointercancel', event as any);\n      }\n    }\n  }\n\n  private _processWheelAndEmit(entity: Entity) {\n    // wheel\n    for (const event of this._receiver.currentFrameWheel) {\n      // Currently the wheel only fires under the primary pointer '0'\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, 0)) {\n        entity.events.emit('pointerwheel', event as any);\n      }\n    }\n  }\n\n  private _dispatchEvents(entities: Entity[]) {\n    const lastFrameEntities = new Set(this.lastFrameEntityToPointers.keys());\n    const currentFrameEntities = new Set(this.currentFrameEntityToPointers.keys());\n    // Filter preserves z order\n    const entitiesWithEvents = entities.filter(e => lastFrameEntities.has(e.id) || currentFrameEntities.has(e.id));\n    let lastMovePerPointer: Map<number, PointerEvent>;\n    let lastUpPerPointer: Map<number, PointerEvent>;\n    let lastDownPerPointer: Map<number, PointerEvent>;\n    // Dispatch events in entity z order\n    for (const entity of entitiesWithEvents) {\n      lastDownPerPointer = this._processDownAndEmit(entity);\n\n      lastUpPerPointer = this._processUpAndEmit(entity);\n\n      lastMovePerPointer = this._processMoveAndEmit(entity);\n\n      const lastUpDownMoveEvents = [\n        ...lastMovePerPointer.values(),\n        ...lastDownPerPointer.values(),\n        ...lastUpPerPointer.values()\n      ];\n      this._processEnterLeaveAndEmit(entity, lastUpDownMoveEvents);\n\n      this._processCancelAndEmit(entity);\n\n      this._processWheelAndEmit(entity);\n    }\n  }\n}","import { Entity } from '../EntityComponentSystem';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { ActionsComponent } from './ActionsComponent';\n\n\nexport class ActionsSystem extends System<ActionsComponent> {\n  public readonly types = ['ex.actions'] as const;\n  systemType = SystemType.Update;\n  priority = -1;\n\n  private _actions: ActionsComponent[] = [];\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      this._actions.push(action);\n    } else {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      const index = this._actions.indexOf(action);\n      if (index > -1) {\n        this._actions.splice(index, 1);\n      }\n    }\n  }\n\n  update(_entities: Entity[], delta: number): void {\n    for (const actions of this._actions) {\n      actions.update(delta);\n    }\n  }\n}","import { Component } from '../EntityComponentSystem/Component';\nimport { IsometricMap } from './IsometricMap';\n\nexport class IsometricEntityComponent extends Component<'ex.isometricentity'> {\n  public readonly type = 'ex.isometricentity';\n  /**\n   * Vertical \"height\" in the isometric world\n   */\n  public elevation: number = 0;\n\n  public map: IsometricMap;\n\n  /**\n   * Specify the isometric map to use to position this entity's z-index\n   * @param map\n   */\n  constructor(map: IsometricMap) {\n    super();\n    this.map = map;\n  }\n}","import { System, SystemType } from '../EntityComponentSystem/System';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\n\nexport class IsometricEntitySystem extends System<TransformComponent | IsometricEntityComponent> {\n  public readonly types = ['ex.transform', 'ex.isometricentity'] as const;\n  public readonly systemType = SystemType.Update;\n  priority: number = 99;\n  update(entities: Entity[], _delta: number): void {\n    let transform: TransformComponent;\n    let iso: IsometricEntityComponent;\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      iso = entity.get(IsometricEntityComponent);\n\n      const maxZindexPerElevation = Math.max(iso.map.width * iso.map.tileWidth, iso.map.height * iso.map.tileHeight);\n\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\n      transform.z = newZ;\n    }\n  }\n}","import { GraphicsComponent } from './GraphicsComponent';\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\nimport { Scene } from '../Scene';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent, CoordPlane } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Camera } from '../Camera';\nimport { System, SystemType } from '../EntityComponentSystem/System';\n\nexport class OffscreenSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public systemType = SystemType.Draw;\n  priority: number = -1;\n  private _camera: Camera;\n\n  public initialize(scene: Scene): void {\n    this._camera = scene.camera;\n  }\n\n  update(entities: Entity[]): void {\n    let transform: TransformComponent;\n    let graphics: GraphicsComponent;\n\n    for (const entity of entities) {\n      graphics = entity.get(GraphicsComponent);\n      transform = entity.get(TransformComponent);\n\n      // Figure out if entities are offscreen\n      const entityOffscreen = this._isOffscreen(transform, graphics);\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\n        entity.addTag('ex.offscreen');\n      }\n\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\n        entity.removeTag('ex.offscreen');\n      }\n    }\n  }\n\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      const transformedBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n      const graphicsOffscreen = !this._camera.viewport.overlaps(transformedBounds);\n      return graphicsOffscreen;\n    } else {\n      // TODO screen coordinates\n      return false;\n    }\n  }\n\n}","\n\nexport enum ColorBlindnessMode {\n  Protanope = 'Protanope',\n  Deuteranope = 'Deuteranope',\n  Tritanope = 'Tritanope'\n}\n","/**\n * Determines the scope of handling mouse/touch events.\n */\n\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n","import { Logger } from '../Util/Log';\nimport { Class } from '../Class';\nimport * as Events from '../Events';\n\n/**\n * Enum representing physical input key codes\n */\nexport enum Keys {\n  // NUMPAD\n  Num0 = 'Numpad0',\n  Num1 = 'Numpad1',\n  Num2 = 'Numpad2',\n  Num3 = 'Numpad3',\n  Num4 = 'Numpad4',\n  Num5 = 'Numpad5',\n  Num6 = 'Numpad6',\n  Num7 = 'Numpad7',\n  Num8 = 'Numpad8',\n  Num9 = 'Numpad9',\n  NumAdd = 'NumpadAdd',\n  NumSubtract = 'NumpadSubtract',\n  NumMultiply = 'NumpadMultiply',\n  NumDivide = 'NumpadDivide',\n  // NumComma = 'NumpadComma', // not x-browser\n  NumDecimal = 'NumpadDecimal',\n  Numpad0 = 'Numpad0',\n  Numpad1 = 'Numpad1',\n  Numpad2 = 'Numpad2',\n  Numpad3 = 'Numpad3',\n  Numpad4 = 'Numpad4',\n  Numpad5 = 'Numpad5',\n  Numpad6 = 'Numpad6',\n  Numpad7 = 'Numpad7',\n  Numpad8 = 'Numpad8',\n  Numpad9 = 'Numpad9',\n  NumpadAdd = 'NumpadAdd',\n  NumpadSubtract = 'NumpadSubtract',\n  NumpadMultiply = 'NumpadMultiply',\n  NumpadDivide = 'NumpadDivide',\n  // NumpadComma = 'NumpadComma', // not x-browser\n  NumpadDecimal = 'NumpadDecimal',\n\n  // MODIFIERS\n  NumLock = 'NumLock',\n  ShiftLeft = 'ShiftLeft',\n  ShiftRight = 'ShiftRight',\n  AltLeft = 'AltLeft',\n  AltRight = 'AltRight',\n  ControlLeft = 'ControlLeft',\n  ControlRight = 'ControlRight',\n  MetaLeft = 'MetaLeft',\n  MetaRight = 'MetaRight',\n\n  // NUMBERS\n  Key0 = 'Digit0',\n  Key1 = 'Digit1',\n  Key2 = 'Digit2',\n  Key3 = 'Digit3',\n  Key4 = 'Digit4',\n  Key5 = 'Digit5',\n  Key6 = 'Digit6',\n  Key7 = 'Digit7',\n  Key8 = 'Digit8',\n  Key9 = 'Digit9',\n  Digit0 = 'Digit0',\n  Digit1 = 'Digit1',\n  Digit2 = 'Digit2',\n  Digit3 = 'Digit3',\n  Digit4 = 'Digit4',\n  Digit5 = 'Digit5',\n  Digit6 = 'Digit6',\n  Digit7 = 'Digit7',\n  Digit8 = 'Digit8',\n  Digit9 = 'Digit9',\n\n  // FUNCTION KEYS\n  F1 = 'F1',\n  F2 = 'F2',\n  F3 = 'F3',\n  F4 = 'F4',\n  F5 = 'F5',\n  F6 = 'F6',\n  F7 = 'F7',\n  F8 = 'F8',\n  F9 = 'F9',\n  F10 = 'F10',\n  F11 = 'F11',\n  F12 = 'F12',\n\n  // LETTERS\n  A = 'KeyA',\n  B = 'KeyB',\n  C = 'KeyC',\n  D = 'KeyD',\n  E = 'KeyE',\n  F = 'KeyF',\n  G = 'KeyG',\n  H = 'KeyH',\n  I = 'KeyI',\n  J = 'KeyJ',\n  K = 'KeyK',\n  L = 'KeyL',\n  M = 'KeyM',\n  N = 'KeyN',\n  O = 'KeyO',\n  P = 'KeyP',\n  Q = 'KeyQ',\n  R = 'KeyR',\n  S = 'KeyS',\n  T = 'KeyT',\n  U = 'KeyU',\n  V = 'KeyV',\n  W = 'KeyW',\n  X = 'KeyX',\n  Y = 'KeyY',\n  Z = 'KeyZ',\n  KeyA = 'KeyA',\n  KeyB = 'KeyB',\n  KeyC = 'KeyC',\n  KeyD = 'KeyD',\n  KeyE = 'KeyE',\n  KeyF = 'KeyF',\n  KeyG = 'KeyG',\n  KeyH = 'KeyH',\n  KeyI = 'KeyI',\n  KeyJ = 'KeyJ',\n  KeyK = 'KeyK',\n  KeyL = 'KeyL',\n  KeyM = 'KeyM',\n  KeyN = 'KeyN',\n  KeyO = 'KeyO',\n  KeyP = 'KeyP',\n  KeyQ = 'KeyQ',\n  KeyR = 'KeyR',\n  KeyS = 'KeyS',\n  KeyT = 'KeyT',\n  KeyU = 'KeyU',\n  KeyV = 'KeyV',\n  KeyW = 'KeyW',\n  KeyX = 'KeyX',\n  KeyY = 'KeyY',\n  KeyZ = 'KeyZ',\n\n  // SYMBOLS\n  Semicolon = 'Semicolon',\n  Quote = 'Quote',\n  Comma = 'Comma',\n  Minus = 'Minus',\n  Period = 'Period',\n  Slash = 'Slash',\n  Equal = 'Equal',\n  BracketLeft = 'BracketLeft',\n  Backslash = 'Backslash',\n  BracketRight = 'BracketRight',\n  Backquote = 'Backquote',\n\n  // DIRECTIONS\n  Up = 'ArrowUp',\n  Down = 'ArrowDown',\n  Left = 'ArrowLeft',\n  Right = 'ArrowRight',\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n\n  // OTHER\n  Space = 'Space',\n  Backspace = 'Backspace',\n  Delete = 'Delete',\n  Esc = 'Escape',\n  Escape = 'Escape',\n  Enter = 'Enter',\n  NumpadEnter = 'NumpadEnter',\n  ContextMenu = 'ContextMenu'\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends Events.GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   * @param value The key's typed value the browser detected\n   * @param originalEvent The original keyboard event that Excalibur handled\n   */\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n */\nexport class Keyboard extends Class {\n  private _keys: Keys[] = [];\n  private _keysUp: Keys[] = [];\n  private _keysDown: Keys[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    if (!global) {\n      try {\n        // Try and listen to events on top window frame if within an iframe.\n        //\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\n        //\n        // Attempt to add an event listener, which triggers a DOMException on\n        // cross-origin iframes\n        const noop = () => {\n          return;\n        };\n        window.top.addEventListener('blur', noop);\n        window.top.removeEventListener('blur', noop);\n\n        // this will be the same as window if not embedded within an iframe\n        global = window.top;\n      } catch {\n        // fallback to current frame\n        global = window;\n\n        Logger.getInstance().warn(\n          'Failed to bind to keyboard events to top frame. ' +\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\n        );\n      }\n    }\n\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', this._handleKeyUp);\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', this._handleKeyDown);\n  }\n\n  private _handleKeyDown = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    if (this._keys.indexOf(code) === -1) {\n      this._keys.push(code);\n      this._keysDown.push(code);\n      const keyEvent = new KeyEvent(code, ev.key, ev);\n      this.eventDispatcher.emit('down', keyEvent);\n      this.eventDispatcher.emit('press', keyEvent);\n    }\n  };\n\n  private _handleKeyUp = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    const key = this._keys.indexOf(code);\n    this._keys.splice(key, 1);\n    this._keysUp.push(code);\n    const keyEvent = new KeyEvent(code, ev.key, ev);\n\n    // alias the old api, we may want to deprecate this in the future\n    this.eventDispatcher.emit('up', keyEvent);\n    this.eventDispatcher.emit('release', keyEvent);\n  };\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n\n  /**\n   * Trigger a manual key event\n   * @param type\n   * @param key\n   * @param character\n   */\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\n    if (type === 'down') {\n      this._handleKeyDown(new KeyboardEvent('keydown', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n    if (type === 'up') {\n      this._handleKeyUp(new KeyboardEvent('keyup', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n  }\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n","/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n","/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n","/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n","import { ScreenElement } from './ScreenElement';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { SystemType } from './EntityComponentSystem/System';\nimport { obsolete } from './Util/Decorators';\nimport { World } from './EntityComponentSystem/World';\nimport { MotionSystem } from './Collision/MotionSystem';\nimport { CollisionSystem } from './Collision/CollisionSystem';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\nimport { Flags, Legacy } from './Flags';\nimport { DebugSystem } from './Debug/DebugSystem';\nimport { PointerSystem } from './Input/PointerSystem';\nimport { ActionsSystem } from './Actions/ActionsSystem';\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera = new Camera();\n\n  /**\n   * The ECS world for the scene\n   */\n  public world = new World(this);\n\n  /**\n   * The actors in the current scene\n   */\n  public get actors(): Actor[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Actor;\n    }) as Actor[];\n  }\n\n  /**\n   * The entities in the current scene\n   */\n  public get entities(): Entity[] {\n    return this.world.entityManager.entities;\n  }\n\n  /**\n   * The triggers in the current scene\n   */\n  public get triggers(): Trigger[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Trigger;\n    }) as Trigger[];\n  }\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public get tileMaps(): TileMap[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof TileMap;\n    }) as TileMap[];\n  }\n\n  /**\n   * Access to the Excalibur engine\n   */\n  public engine: Engine;\n\n  /**\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\n   * @deprecated Use [[Scene.actors]]\n   */\n  @obsolete({\n    message: 'Will be removed in excalibur v0.26.0',\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\n  })\n  public get screenElements(): ScreenElement[] {\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n  }\n\n  private _isInitialized: boolean = false;\n  private _timers: Timer[] = [];\n  public get timers(): readonly Timer[] {\n    return this._timers;\n  }\n  private _cancelQueue: Timer[] = [];\n\n  constructor() {\n    super();\n    // Initialize systems\n    this.world.add(new ActionsSystem());\n    this.world.add(new MotionSystem());\n    this.world.add(new CollisionSystem());\n    this.world.add(new PointerSystem());\n    this.world.add(new IsometricEntitySystem());\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      this.world.add(new CanvasDrawingSystem());\n    } else {\n      this.world.add(new OffscreenSystem());\n      this.world.add(new GraphicsSystem());\n    }\n    this.world.add(new DebugSystem());\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overridden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.entities) {\n      child._initialize(this.engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.engine = engine;\n      // Initialize camera first\n      this.camera._initialize(engine);\n\n      this.world.systemManager.initialize();\n\n      // This order is important! we want to be sure any custom init that add actors\n      // fire before the actor init\n      this.onInitialize.call(this, engine);\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDeactivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n\n    // TODO differed entity removal for timers\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    this.world.update(SystemType.Update, delta);\n\n    // Camera last keeps renders smooth that are based on entity/actor\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n\n    this.world.update(SystemType.Draw, delta);\n\n    if (this.engine?.isDebug) {\n      this.debugDraw(ctx);\n    }\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   * @deprecated Signature will change in v0.26.0\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n    // pass\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the scene.\n   * @param screenElement  The ScreenElement to add to the current scene\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    this.emit('entityadded', { target: entity } as any);\n    this.world.add(entity);\n    entity.scene = this;\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  public remove(entity: Entity): void;\n\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the current scene\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.emit('entityremoved', { target: entity } as any);\n      this.world.remove(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `ScreenElement` only?\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addScreenElement(actor: Actor) {\n    this.add(actor);\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeScreenElement(actor: Actor) {\n    this.remove(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addTileMap(tileMap: TileMap) {\n    this.world.add(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeTileMap(tileMap: TileMap) {\n    this.world.remove(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  public isCurrentScene(): boolean {\n    if (this.engine) {\n      return this.engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n    for (const _ui of screenElements) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isScreenElement(child as Actor)) {\n          // TODO not true\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { Shader } from '../Context/shader';\nimport { VertexBuffer } from '../Context/vertex-buffer';\nimport { VertexLayout } from '../Context/vertex-layout';\n\n/**\n * Helper that defines a whole screen renderer, just provide a fragment source!\n *\n * Currently supports 1 varying\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\n */\nexport class ScreenShader {\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(fragmentSource: string) {\n    this._shader = new Shader({\n      vertexSource: `\n      attribute vec2 a_position;\n      attribute vec2 a_texcoord;\n      varying vec2 v_texcoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_texcoord;\n      }`,\n      fragmentSource: fragmentSource\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  public getShader() {\n    return this._shader;\n  }\n  public getLayout() {\n    return this._layout;\n  }\n}","import colorBlindCorrectSource from './color-blind-fragment.glsl';\nimport { PostProcessor } from './PostProcessor';\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\nimport { Shader } from '../Context/shader';\nimport { VertexLayout } from '../Context/vertex-layout';\nimport { ScreenShader } from './ScreenShader';\n\nexport class ColorBlindnessPostProcessor implements PostProcessor {\n  private _shader: ScreenShader;\n  private _simulate = false;\n  constructor(private _colorBlindnessMode: ColorBlindnessMode, simulate = false) {\n    this._simulate = simulate;\n  }\n\n  initialize(_gl: WebGLRenderingContext): void {\n    this._shader = new ScreenShader(colorBlindCorrectSource);\n    this.simulate = this._simulate;\n    this.colorBlindnessMode = this._colorBlindnessMode;\n  }\n\n  getShader(): Shader {\n    return this._shader.getShader();\n  }\n\n  getLayout(): VertexLayout {\n    return this._shader.getLayout();\n  }\n\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\n    this._colorBlindnessMode = colorBlindMode;\n    if (this._shader) {\n      const shader = this._shader.getShader();\n      shader.use();\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\n        shader.setUniformInt('u_type', 0);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\n        shader.setUniformInt('u_type', 1);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\n        shader.setUniformInt('u_type', 2);\n      }\n    }\n  }\n\n  get colorBlindnessMode(): ColorBlindnessMode {\n    return this._colorBlindnessMode;\n  }\n\n  set simulate(value: boolean) {\n    this._simulate = value;\n    if (this._shader) {\n\n      const shader = this._shader.getShader();\n      shader.use();\n      shader.setUniformBoolean('u_simulate', value);\n    }\n  }\n\n  get simulate(): boolean {\n    return this._simulate;\n  }\n}\n","export default \"precision mediump float;\\n// our texture\\nuniform sampler2D u_image;\\n// the texCoords passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// color blind type\\nuniform int u_type;\\n\\n// simulation?\\nuniform bool u_simulate;\\n\\nvoid main() {\\n  vec4 o =  texture2D(u_image, v_texcoord);\\n  // RGB to LMS matrix conversion\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\n  // Simulate color blindness\\n  float l;\\n  float m;\\n  float s;\\n  //MODE CODE//\\n  if (u_type == 0) {\\n    // Protanope\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\n  } else if (u_type == 1) {\\n    // Deuteranope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\n  } else if (u_type == 2) {\\n    // Tritanope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\n  }\\n\\n  // LMS to RGB matrix conversion\\n  vec4 error; // simulate the colors\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\n  error.a = 1.0;\\n  vec4 diff = o - error;\\n  vec4 correction; // correct the colors\\n  correction.r = 0.0;\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\n  correction = o + correction;\\n  correction.a = o.a;\\n  //SIMULATE//\\n\\n  // sim \\n  if (u_simulate) {\\n    gl_FragColor = error.rgba;\\n  } else {\\n    gl_FragColor = correction.rgba;\\n  }\\n}\";","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\nimport { Engine } from '../Engine';\nimport { ExcaliburGraphicsContextWebGL } from '..';\n\nexport interface DebugFlags {\n  colorBlindMode: ColorBlindFlags;\n}\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n  }\n\n  /**\n   * Correct colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public correct(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = false;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Simulate colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public simulate(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = true;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Remove color blindness post processor\n   */\n  public clear() {\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n  }\n}\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\nimport { StandardClock, TestClock } from '..';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n\n  /**\n   * Graphics statistics\n   */\n  graphics: GraphicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisions\n   */\n  collisions: number;\n\n  /**\n   * Copy of the current frame contacts (only updated if debug is toggled on)\n   */\n  contacts: Map<string, CollisionContact>;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\nexport interface GraphicsStatistics {\n  drawCalls: number;\n  drawnImages: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  private _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[TestClock]] and return\n   * it in the same running state.\n   *\n   * This is useful when you need to debug frame by frame.\n   */\n  public useTestClock(): TestClock {\n    const clock = this._engine.clock;\n    const wasRunning = clock.isRunning();\n    clock.stop();\n\n    const testClock = clock.toTestClock();\n    if (wasRunning) {\n      testClock.start();\n    }\n    this._engine.clock = testClock;\n    return testClock;\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[StandardClock]] and\n   * return it in the same running state.\n   *\n   * This is useful when you need to switch back to normal mode after\n   * debugging.\n   */\n  public useStandardClock(): StandardClock {\n    const currentClock = this._engine.clock;\n    const wasRunning = currentClock.isRunning();\n    currentClock.stop();\n\n    const standardClock = currentClock.toStandardClock();\n    if (wasRunning) {\n      standardClock.start();\n    }\n    this._engine.clock = standardClock;\n    return standardClock;\n  }\n\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n\n  /**\n   * Correct or simulate color blindness using [[ColorBlindnessPostProcessor]].\n   * @warning Will reduce FPS.\n   */\n  public colorBlindMode: ColorBlindFlags;\n\n  /**\n   * Filter debug context to named entities or entity ids\n   */\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\n    /**\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\n     */\n    useFilter: false,\n    /**\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\n     */\n    nameQuery: '',\n    /**\n     * Query for Entity ids, if the id matches it will be included\n     */\n    ids: []\n  };\n\n  /**\n   * Entity debug settings\n   */\n  public entity = {\n    showAll: false,\n    showId: true,\n    showName: false\n  };\n\n  /**\n   * Transform component debug settings\n   */\n  public transform = {\n    showAll: false,\n\n    showPosition: false,\n    showPositionLabel: false,\n    positionColor: Color.Yellow,\n\n    showZIndex: false,\n\n    showScale: false,\n    scaleColor: Color.Green,\n\n    showRotation: false,\n    rotationColor: Color.Blue\n  };\n\n  /**\n   * Graphics component debug settings\n   */\n  public graphics = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Yellow\n  };\n\n  /**\n   * Collider component debug settings\n   */\n  public collider = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Blue,\n\n    showOwner: false,\n\n    showGeometry: true,\n    geometryColor: Color.Green\n  };\n\n  /**\n   * Physics simulation debug settings\n   */\n  public physics = {\n    showAll: false,\n\n    showBroadphaseSpacePartitionDebug: false,\n\n    showCollisionNormals: false,\n    collisionNormalColor: Color.Cyan,\n\n    showCollisionContacts: true,\n    collisionContactColor: Color.Red\n  };\n\n  /**\n   * Motion component debug settings\n   */\n  public motion = {\n    showAll: false,\n\n    showVelocity: false,\n    velocityColor: Color.Yellow,\n\n    showAcceleration: false,\n    accelerationColor: Color.Red\n  };\n\n  /**\n   * Body component debug settings\n   */\n  public body = {\n    showAll: false,\n\n    showCollisionGroup: false,\n    showCollisionType: false,\n    showSleeping: false,\n    showMotion: false,\n    showMass: false\n  };\n\n  /**\n   * Camera debug settings\n   */\n  public camera = {\n    showAll: false,\n\n    showFocus: false,\n    focusColor: Color.Red,\n\n    showZoom: false\n  };\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining() {\n      return this.alive - this.killed;\n    },\n    get total() {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total() {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  private _graphicsStats: GraphicsStatistics = {\n    drawCalls: 0,\n    drawnImages: 0\n  };\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n\n  /**\n   * Gets the frame's graphics statistics\n   */\n  public get graphics() {\n    return this._graphicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _contacts: Map<string, CollisionContact> = new Map();\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.contacts = otherStats.contacts;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.contacts.clear();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get contacts(): Map<string, CollisionContact> {\n    return this._contacts;\n  }\n\n  public set contacts(contacts: Map<string, CollisionContact>) {\n    this._contacts = contacts;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","export interface NativeEventable {\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\n}\n\nexport class BrowserComponent<T extends NativeEventable> {\n  private _paused = false;\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\n\n  on(eventName: string, handler: (evt: any) => void): void {\n    if (this._nativeHandlers[eventName]) {\n      this.off(eventName, this._nativeHandlers[eventName]);\n    }\n    this._nativeHandlers[eventName] = this._decorate(handler);\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n  }\n  off(eventName: string, handler?: (event: any) => void): void {\n    if (!handler) {\n      handler = this._nativeHandlers[eventName];\n    }\n    this.nativeComponent.removeEventListener(eventName, handler);\n    this._nativeHandlers[eventName] = null;\n  }\n\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\n    return (evt: any) => {\n      if (!this._paused) {\n        handler(evt);\n      }\n    };\n  }\n\n  public pause() {\n    this._paused = true;\n  }\n\n  public resume() {\n    this._paused = false;\n  }\n\n  public clear() {\n    for (const event in this._nativeHandlers) {\n      this.off(event);\n    }\n  }\n\n  constructor(public nativeComponent: T) {}\n}\n\nexport class BrowserEvents {\n  private _windowComponent: BrowserComponent<Window>;\n  private _documentComponent: BrowserComponent<Document>;\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\n  }\n\n  public get window(): BrowserComponent<Window> {\n    return this._windowComponent;\n  }\n\n  public get document(): BrowserComponent<Document> {\n    return this._documentComponent;\n  }\n\n  public pause() {\n    this.window.pause();\n    this.document.pause();\n  }\n\n  public resume() {\n    this.window.resume();\n    this.document.resume();\n  }\n\n  public clear() {\n    this.window.clear();\n    this.document.clear();\n  }\n}\n","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\nimport { Vector } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\nimport { DebugText } from './debug-text';\nimport { Matrix } from '../../Math/matrix';\nimport { ScreenDimension } from '../../Screen';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\n\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\n  /**\n   * Draw a debug rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.strokeStyle = 'red';\n    this._ex.__ctx.strokeRect(\n      this._ex.snapToPixel ? ~~x : x,\n      this._ex.snapToPixel ? ~~y : y,\n      this._ex.snapToPixel ? ~~width : width,\n      this._ex.snapToPixel ? ~~height : height\n    );\n    this._ex.__ctx.restore();\n  }\n\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\n    this._ex.__ctx.lineWidth = 2;\n    this._ex.__ctx.stroke();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\n    this._ex.__ctx.arc(\n      this._ex.snapToPixel ? ~~point.x : point.x,\n      this._ex.snapToPixel ? ~~point.y : point.y,\n      pointOptions.size,\n      0,\n      Math.PI * 2\n    );\n    this._ex.__ctx.fill();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._ex, text, pos);\n  }\n}\n\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n  public get width() {\n    return this.__ctx.canvas.width;\n  }\n\n  public get height() {\n    return this.__ctx.canvas.height;\n  }\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  private _state = new StateStack();\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public snapToPixel: boolean = true;\n\n  public get smoothing(): boolean {\n    return this.__ctx.imageSmoothingEnabled;\n  }\n\n  public set smoothing(value: boolean) {\n    this.__ctx.imageSmoothingEnabled = value;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\n    this.__ctx = canvasElement.getContext('2d', {\n      alpha: enableTransparency ?? true\n    });\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n  }\n\n  public resetTransform(): void {\n    this.__ctx.resetTransform();\n  }\n\n  public updateViewport(_resolution: ScreenDimension): void {\n    // pass\n  }\n\n  /**\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\n   */\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    this.__ctx.globalAlpha = this.opacity;\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\n      .filter((a) => a !== undefined)\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\n    this.__ctx.drawImage.apply(this.__ctx, args);\n    GraphicsDiagnostics.DrawCallCount++;\n    GraphicsDiagnostics.DrawnImagesCount = 1;\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    this.__ctx.strokeStyle = color.toString();\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\n    this.__ctx.lineWidth = thickness;\n    this.__ctx.stroke();\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\n    this.__ctx.save();\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.fillRect(\n      this.snapToPixel ? ~~pos.x : pos.x,\n      this.snapToPixel ? ~~pos.y : pos.y,\n      this.snapToPixel ? ~~width : width,\n      this.snapToPixel ? ~~height : height\n    );\n    this.__ctx.restore();\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    if (stroke) {\n      this.__ctx.strokeStyle = stroke.toString();\n    }\n    if (thickness) {\n      this.__ctx.lineWidth = thickness;\n    }\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\n    this.__ctx.fill();\n    if (stroke) {\n      this.__ctx.stroke();\n    }\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\n\n  /**\n   * Save the current state of the canvas to the stack (transforms and opacity)\n   */\n  save(): void {\n    this.__ctx.save();\n  }\n\n  /**\n   * Restore the state of the canvas from the stack\n   */\n  restore(): void {\n    this.__ctx.restore();\n  }\n\n  /**\n   * Translate the origin of the context by an x and y\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number): void {\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  /**\n   * Rotate the context about the current origin\n   */\n  rotate(angle: number): void {\n    this.__ctx.rotate(angle);\n  }\n\n  /**\n   * Scale the context by an x and y factor\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number): void {\n    this.__ctx.scale(x, y);\n  }\n\n  public getTransform(): Matrix {\n    throw new Error('Not implemented');\n  }\n\n  public multiply(_m: Matrix): void {\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\n  }\n\n  public addPostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public removePostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public clearPostProcessors() {\n    throw Error('Not implemented');\n  }\n\n  public beginDrawLifecycle() {\n    // pass\n  }\n\n  public endDrawLifecycle() {\n    // pass\n  }\n\n  clear(): void {\n    // Clear frame\n    this.__ctx.clearRect(0, 0, this.width, this.height);\n    this.__ctx.fillStyle = this.backgroundColor.toString();\n    this.__ctx.fillRect(0, 0, this.width, this.height);\n    GraphicsDiagnostics.clear();\n  }\n\n  /**\n   * Flushes the batched draw calls to the screen\n   */\n  flush(): void {\n    // pass\n  }\n}\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { GlobalCoordinates } from '../Math/global-coordinates';\nimport { Vector } from '../Math/vector';\nimport { PointerButton } from './PointerButton';\nimport { PointerType } from './PointerType';\n\nexport class PointerEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n\n  get pagePos(): Vector {\n    return this.coordinates.pagePos;\n  }\n\n  get screenPos(): Vector {\n    return this.coordinates.screenPos;\n  }\n\n  get worldPos(): Vector {\n    return this.coordinates.worldPos;\n  }\n\n  constructor(\n    public type: 'down' | 'up' | 'move' | 'cancel',\n    public pointerId: number,\n    public button: PointerButton,\n    public pointerType: PointerType,\n    public coordinates: GlobalCoordinates,\n    public nativeEvent: Event) { };\n}\n","import { WheelDeltaMode } from './WheelDeltaMode';\n\n\nexport class WheelEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: Event\n  ) { }\n}\n","import { Class } from '../Class';\nimport { Vector } from '../Math/vector';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerEvent } from './PointerEvent';\n\nexport class PointerAbstraction extends Class {\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = Vector.Zero;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = Vector.Zero;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = Vector.Zero;\n\n  constructor() {\n    super();\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  private _onPointerMove = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n\n  private _onPointerDown = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { GlobalCoordinates } from '../Math/global-coordinates';\nimport { vec, Vector } from '../Math/vector';\nimport { PointerEvent } from './PointerEvent';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerAbstraction } from './PointerAbstraction';\n\nimport { WheelDeltaMode } from './WheelDeltaMode';\nimport { PointerSystem } from './PointerSystem';\nimport { NativePointerButton } from './NativePointerButton';\nimport { PointerButton } from './PointerButton';\nimport { Util } from '..';\nimport { PointerType } from './PointerType';\n\n\nexport type NativePointerEvent = globalThis.PointerEvent;\nexport type NativeMouseEvent = globalThis.MouseEvent;\nexport type NativeTouchEvent = globalThis.TouchEvent;\nexport type NativeWheelEvent = globalThis.WheelEvent;\n\n/**\n * Is this event a native touch event?\n */\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\n}\n\n/**\n * Is this event a native pointer event\n */\nfunction isPointerEvent(value: any): value is NativePointerEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\n}\n\n/**\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\n */\nexport class PointerEventReceiver extends Class {\n  public primary: PointerAbstraction = new PointerAbstraction();\n\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\n\n  public currentFramePointerDown = new Map<number, boolean>();\n  public lastFramePointerDown = new Map<number, boolean>();\n\n  public currentFrameDown: PointerEvent[] = [];\n  public currentFrameUp: PointerEvent[] = [];\n  public currentFrameMove: PointerEvent[] = [];\n  public currentFrameCancel: PointerEvent[] = [];\n  public currentFrameWheel: WheelEvent[] = [];\n\n  constructor(public readonly target: GlobalEventHandlers & EventTarget, public engine: Engine) {\n    super();\n  }\n\n  private _pointers: PointerAbstraction[] = [this.primary];\n  /**\n   * Locates a specific pointer by id, creates it if it doesn't exist\n   * @param index\n   */\n  public at(index: number): PointerAbstraction {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new PointerAbstraction());\n      }\n    }\n    return this._pointers[index];\n  }\n\n  /**\n   * The number of pointers currently being tracked by excalibur\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  /**\n   * Is the specified pointer id down this frame\n   * @param pointerId\n   */\n  public isDown(pointerId: number) {\n    return this.currentFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Was the specified pointer id down last frame\n   * @param pointerId\n   */\n  public wasDown(pointerId: number) {\n    return this.lastFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public isDragging(pointerId: number): boolean {\n    return this.isDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public isDragStart(pointerId: number): boolean {\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public isDragEnd(pointerId: number): boolean {\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Called internally by excalibur\n   *\n   * Updates the current frame pointer info and emits raw pointer events\n   *\n   * This does not emit events to entities, see PointerSystem\n   */\n  public update() {\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\n\n    for (const event of this.currentFrameDown) {\n      this.emit('down', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('down', event);\n      this.primary.emit('pointerdown', event);\n    }\n\n    for (const event of this.currentFrameUp) {\n      this.emit('up', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('up', event);\n    }\n\n    for (const event of this.currentFrameMove) {\n      this.emit('move', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('move', event);\n    }\n\n    for (const event of this.currentFrameCancel) {\n      this.emit('cancel', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('cancel', event);\n    }\n\n    for (const event of this.currentFrameWheel) {\n      this.emit('wheel', event);\n      this.primary.emit('pointerwheel', event);\n    }\n  }\n\n  /**\n   * Clears the current frame event and pointer data\n   */\n  public clear() {\n    for (const event of this.currentFrameUp) {\n      this.currentFramePointerCoords.delete(event.pointerId);\n      const ids = this._activeNativePointerIdsToNormalized.entries();\n      for (const [native, normalized] of ids) {\n        if (normalized === event.pointerId) {\n          this._activeNativePointerIdsToNormalized.delete(native);\n        }\n      }\n    }\n    this.currentFrameDown.length = 0;\n    this.currentFrameUp.length = 0;\n    this.currentFrameMove.length = 0;\n    this.currentFrameCancel.length = 0;\n    this.currentFrameWheel.length = 0;\n  }\n\n  private _boundHandle = this._handle.bind(this);\n  private _boundWheel = this._handleWheel.bind(this);\n  /**\n   * Initializes the pointer event receiver so that it can start listening to native\n   * browser events.\n   */\n  public init() {\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\n    // It is important on mobile to have touch action 'none'\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\n    if (this.target === this.engine.canvas) {\n      this.engine.canvas.style.touchAction = 'none';\n    } else {\n      document.body.style.touchAction = 'none';\n    }\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.addEventListener('pointerdown', this._boundHandle);\n      this.target.addEventListener('pointerup', this._boundHandle);\n      this.target.addEventListener('pointermove', this._boundHandle);\n      this.target.addEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.addEventListener('touchstart', this._boundHandle);\n      this.target.addEventListener('touchend', this._boundHandle);\n      this.target.addEventListener('touchmove', this._boundHandle);\n      this.target.addEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.addEventListener('mousedown', this._boundHandle);\n      this.target.addEventListener('mouseup', this._boundHandle);\n      this.target.addEventListener('mousemove', this._boundHandle);\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\n    }\n  }\n\n  public detach() {\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.removeEventListener('pointerdown', this._boundHandle);\n      this.target.removeEventListener('pointerup', this._boundHandle);\n      this.target.removeEventListener('pointermove', this._boundHandle);\n      this.target.removeEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.removeEventListener('touchstart', this._boundHandle);\n      this.target.removeEventListener('touchend', this._boundHandle);\n      this.target.removeEventListener('touchmove', this._boundHandle);\n      this.target.removeEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.removeEventListener('mousedown', this._boundHandle);\n      this.target.removeEventListener('mouseup', this._boundHandle);\n      this.target.removeEventListener('mousemove', this._boundHandle);\n    }\n\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.removeEventListener('wheel', this._boundWheel);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\n    }\n  }\n\n  /**\n   * Take native pointer id and map it to index in active pointers\n   * @param nativePointerId\n   */\n  private _normalizePointerId(nativePointerId: number) {\n    // Add to the the native pointer set id\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\n\n    // Native pointer ids in ascending order\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\n\n    // The index into sorted ids will be the new id, will always have an id\n    const id = currentPointerIds.findIndex(p => p === nativePointerId);\n\n    // Save the mapping so we can reverse it later\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\n\n    // ignore pointer because game isn't watching\n    return id;\n  }\n\n  /**\n   * Responsible for handling and parsing pointer events\n   */\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\n    ev.preventDefault();\n    const eventCoords = new Map<number, GlobalCoordinates>();\n    let button: PointerButton;\n    let pointerType: PointerType;\n    if (isTouchEvent(ev)) {\n      button = PointerButton.Unknown;\n      pointerType = PointerType.Touch;\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\n      for (let i = 0; i < ev.changedTouches.length; i++) {\n        const touch = ev.changedTouches[i];\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\n        const nativePointerId = i + 1;\n        const pointerId = this._normalizePointerId(nativePointerId);\n        this.currentFramePointerCoords.set(pointerId, coordinates);\n        eventCoords.set(pointerId, coordinates);\n      }\n    } else {\n      button = this._nativeButtonToPointerButton(ev.button);\n      pointerType = PointerType.Mouse;\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\n      let nativePointerId = 1;\n      if (isPointerEvent(ev)) {\n        nativePointerId = ev.pointerId;\n        pointerType = this._stringToPointerType(ev.pointerType);\n      }\n      const pointerId = this._normalizePointerId(nativePointerId);\n      this.currentFramePointerCoords.set(pointerId, coordinates);\n      eventCoords.set(pointerId, coordinates);\n    }\n\n    for (const [pointerId, coord] of eventCoords.entries()) {\n      switch (ev.type) {\n        case 'mousedown':\n        case 'pointerdown':\n        case 'touchstart':\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, true);\n          break;\n        case 'mouseup':\n        case 'pointerup':\n        case 'touchend':\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, false);\n          break;\n        case 'mousemove':\n        case 'pointermove':\n        case 'touchmove':\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\n          break;\n        case 'touchcancel':\n        case 'pointercancel':\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\n          break;\n      }\n    }\n  }\n\n  private _handleWheel(ev: NativeWheelEvent) {\n    // Should we prevent page scroll because of this event\n    if (\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\n    ) {\n      ev.preventDefault();\n    }\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\n\n    /**\n     * A constant used to normalize wheel events across different browsers\n     *\n     * This normalization factor is pulled from\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n     */\n    const ScrollWheelNormalizationFactor = -1 / 40;\n\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n    const deltaY =\n        ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\n    const deltaZ = ev.deltaZ || 0;\n    let deltaMode = WheelDeltaMode.Pixel;\n\n    if (ev.deltaMode) {\n      if (ev.deltaMode === 1) {\n        deltaMode = WheelDeltaMode.Line;\n      } else if (ev.deltaMode === 2) {\n        deltaMode = WheelDeltaMode.Page;\n      }\n    }\n\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\n    this.currentFrameWheel.push(we);\n  }\n\n  /**\n   * Triggers an excalibur pointer event in a world space pos\n   *\n   * Useful for testing pointers in excalibur\n   * @param type\n   * @param pos\n   */\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\n    const page = this.engine.screen.worldToPageCoordinates(pos);\n    // Send an event to the event receiver\n    if (window.PointerEvent) {\n      this._handle(new window.PointerEvent('pointer' + type, {\n        pointerId: 0,\n        clientX: page.x,\n        clientY: page.y\n      }));\n    } else {\n      // Safari hack\n      this._handle(new window.MouseEvent('mouse' + type, {\n        clientX: page.x,\n        clientY: page.y\n      }));\n    }\n\n    // Force update pointer system\n    const pointerSystem = this.engine.currentScene.world.systemManager.get(PointerSystem);\n    const transformEntities = this.engine.currentScene.world.queryManager.createQuery(pointerSystem.types);\n    pointerSystem.update(transformEntities.getEntities());\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}","export interface FpsSamplerOptions {\n  /**\n   * Specify the sampling period in milliseconds (default 100)\n   */\n  samplePeriod?: number;\n  /**\n   * Specify the initial FPS\n   */\n  initialFps: number;\n\n  /**\n   * Specify the function used to return the current time (in milliseconds)\n   */\n  nowFn: () => number;\n}\n\nexport class FpsSampler {\n  private _fps: number;\n  private _samplePeriod: number = 100;\n  private _currentFrameTime: number = 0;\n  private _frames: number = 0;\n  private _previousSampleTime: number = 0;\n  private _beginFrameTime: number = 0;\n  private _nowFn: () => number;\n\n  constructor(options: FpsSamplerOptions) {\n    this._fps = options.initialFps;\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\n    this._currentFrameTime = 1000/options.initialFps;\n    this._nowFn = options.nowFn;\n    this._previousSampleTime = this._nowFn();\n  }\n\n  /**\n   * Start of code block to sample FPS for\n   */\n  start() {\n    this._beginFrameTime = this._nowFn();\n  }\n\n  /**\n   * End of code block to sample FPS for\n   */\n  end() {\n    this._frames++;\n    const time = this._nowFn();\n\n    this._currentFrameTime = time - this._beginFrameTime;\n\n    if (time >= this._previousSampleTime + this._samplePeriod) {\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\n      this._previousSampleTime = time;\n      this._frames = 0;\n    }\n  }\n\n  /**\n   * Return the currently sampled fps over the last sample period, by default every 100ms\n   */\n  get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\n   */\n  get instant() {\n    return 1000 / this._currentFrameTime;\n  }\n}","import { Logger } from '..';\nimport { FpsSampler } from './Fps';\n\nexport interface ClockOptions {\n  /**\n   * Define the function you'd like the clock to tick when it is started\n   */\n  tick: (elapsedMs: number) => any;\n  /**\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\n   */\n  onFatalException?: (e: unknown) => any;\n  /**\n   * Optionally limit the maximum FPS of the clock\n   */\n  maxFps?: number;\n}\n\n\n/**\n * Abstract Clock is the base type of all Clocks\n *\n * It has a few opinions\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\n * 2. The default timing api is implemented in now()\n *\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\n * method is unique to your clock implementation.\n */\nexport abstract class Clock {\n  protected tick: (elapsedMs: number) => any;\n  private _onFatalException: (e: unknown) => any = () => { /* default nothing */ };\n  private _maxFps: number = Infinity;\n  private _lastTime: number = 0;\n  public fpsSampler: FpsSampler;\n  private _options: ClockOptions;\n  private _elapsed: number = 1;\n  private _scheduledCbs: [cb: () => any, scheduledTime: number][] = [];\n  private _totalElapsed: number = 0;\n  constructor(options: ClockOptions) {\n    this._options = options;\n    this.tick = options.tick;\n    this._lastTime = this.now() ?? 0;\n    this._maxFps = options.maxFps ?? this._maxFps;\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\n    this.fpsSampler = new FpsSampler({\n      initialFps: 60,\n      nowFn: () => this.now()\n    });\n  }\n\n  /**\n   * Get the elapsed time for the last completed frame\n   */\n  public elapsed(): number {\n    return this._elapsed;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public now(): number {\n    return performance.now();\n  }\n\n  public toTestClock() {\n    const testClock = new TestClock({\n      ...this._options,\n      defaultUpdateMs: 16.6\n    });\n    return testClock;\n  }\n\n  public toStandardClock() {\n    const clock = new StandardClock({\n      ...this._options\n    });\n    return clock;\n  }\n\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\n    this._onFatalException = handler;\n  }\n\n  /**\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur [[Clock]]\n   *\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\n   * stopped or paused.\n   *\n   * @param cb callback to fire\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\n   */\n  public schedule(cb: () => any, timeoutMs: number = 0) {\n    const scheduledTime = this.now() + timeoutMs;\n    this._scheduledCbs.push([cb, scheduledTime]);\n  }\n\n  private _runScheduledCbs() {\n    // walk backwards to delete items as we loop\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\n      if (this._scheduledCbs[i][1] <= this._totalElapsed) {\n        this._scheduledCbs[i][0]();\n        this._scheduledCbs.splice(i, 1);\n      }\n    }\n  }\n\n  protected update(overrideUpdateMs?: number): void {\n    try {\n      this.fpsSampler.start();\n      // Get the time to calculate time-elapsed\n      const now = this.now();\n      let elapsed = now - this._lastTime || 1; // first frame\n\n      // Constrain fps\n      const fpsInterval = (1000 / this._maxFps);\n\n      // only run frame if enough time has elapsed\n      if (elapsed >= fpsInterval) {\n        let leftover = 0;\n        if (fpsInterval !== 0) {\n          leftover = (elapsed % fpsInterval);\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n\n        // tick the mainloop and run scheduled callbacks\n        this._elapsed = overrideUpdateMs || elapsed;\n        this._totalElapsed += this._elapsed;\n        this._runScheduledCbs();\n        this.tick(overrideUpdateMs || elapsed);\n\n        if (fpsInterval !== 0) {\n          this._lastTime = now - leftover;\n        } else {\n          this._lastTime = now;\n        }\n        this.fpsSampler.end();\n      }\n    } catch (e) {\n      this._onFatalException(e);\n      this.stop();\n    }\n  }\n\n  /**\n   * Returns if the clock is currently running\n   */\n  public abstract isRunning(): boolean;\n\n  /**\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\n   */\n  public abstract start(): void;\n\n  /**\n   * Stop the clock, tick() is no longer called\n   */\n  public abstract stop(): void;\n}\n\n\n/**\n * The [[StandardClock]] implements the requestAnimationFrame browser api to run the tick()\n */\nexport class StandardClock extends Clock {\n\n  private _running = false;\n  private _requestId: number;\n  constructor(options: ClockOptions) {\n    super(options);\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n\n  public start(): void {\n    if (this._running) {\n      return;\n    }\n    this._running = true;\n    const mainloop = () => {\n      // stop the loop\n      if (!this._running) {\n        return;\n      }\n      try {\n        // request next loop\n        this._requestId = window.requestAnimationFrame(mainloop);\n        this.update();\n      } catch (e) {\n        window.cancelAnimationFrame(this._requestId);\n        throw e;\n      }\n    };\n\n    // begin the first frame\n    mainloop();\n  }\n\n  public stop(): void {\n    this._running = false;\n  }\n}\n\nexport interface TestClockOptions {\n  /**\n   * Specify the update milliseconds to use for each manual step()\n   */\n  defaultUpdateMs: number;\n}\n\n/**\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\n */\nexport class TestClock extends Clock {\n  private _logger = Logger.getInstance();\n  private _updateMs: number;\n  private _running: boolean = false;\n  private _currentTime = 0;\n  constructor(options: ClockOptions & TestClockOptions) {\n    super({\n      ...options\n    });\n    this._updateMs = options.defaultUpdateMs;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public override now() {\n    return this._currentTime ?? 0;\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n  public start(): void {\n    this._running = true;\n  }\n  public stop(): void {\n    this._running = false;\n  }\n\n  /**\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\n   * @param overrideUpdateMs\n   */\n  step(overrideUpdateMs?: number): void {\n    const time = overrideUpdateMs ?? this._updateMs;\n\n    if (this._running) {\n      // to be comparable to RAF this needs to be a full blown Task\n      // For example, images cannot decode synchronously in a single step\n      this.update(time);\n      this._currentTime += time;\n    } else {\n      this._logger.warn('The clock is not running, no step will be performed');\n    }\n  }\n\n  /**\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\n   * @param numberOfSteps\n   * @param overrideUpdateMs\n   */\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\n    for (let i = 0; i < numberOfSteps; i++) {\n      this.step(overrideUpdateMs ?? this._updateMs);\n    }\n  }\n}","import { EX_VERSION } from './';\nimport { Flags, Legacy } from './Flags';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Vector } from './Math/vector';\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\nimport { ScreenElement } from './ScreenElement';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Color';\nimport { Scene } from './Scene';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { Debug, DebugStats } from './Debug/Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Events from './Events';\nimport { BrowserEvents } from './Util/Browser';\nimport { obsolete } from './Util/Decorators';\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL, TextureLoader } from './Graphics';\nimport { PointerEventReceiver } from './Input/PointerEventReceiver';\nimport { FpsSampler } from './Util/Fps';\nimport { Clock, StandardClock } from './Util/Clock';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the width of the viewport in css pixels\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the height of the viewport in css pixels\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the width & height of the viewport in css pixels.\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\n   */\n  viewport?: ScreenDimension;\n\n  /**\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\n   * See [[Resolution]] for common presets.\n   */\n  resolution?: ScreenDimension;\n\n  /**\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\n   *\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\n   * with [[ImageFiltering.Blended]]\n   *\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\n   * with [[ImageFiltering.Pixel]]\n   */\n  antialiasing?: boolean;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * Optionally specify the target canvas DOM element directly\n   */\n  canvasElement?: HTMLCanvasElement;\n\n  /**\n   * Optionally snap drawings to nearest pixel\n   */\n  snapToPixel?: boolean;\n\n  /**\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\n   * Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  maxFps?: number;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   * Excalibur browser events abstraction used for wiring to native browser events safely\n   */\n  public browser: BrowserEvents;\n\n  /**\n   * Screen abstraction\n   */\n  public screen: Screen;\n\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   * @deprecated Will be removed in v0.26.0, use Engine.graphicsContext\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\n   */\n  public graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  public maxFps: number = Number.POSITIVE_INFINITY;\n\n  /**\n   * Direct access to the excalibur clock\n   */\n  public clock: Clock;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.screen.canvasWidth;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.screen.halfCanvasWidth;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.screen.canvasHeight;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.screen.halfCanvasHeight;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    return this.screen.drawWidth;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.screen.halfDrawWidth;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    return this.screen.drawHeight;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.screen.halfDrawHeight;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.screen.isHiDpi;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   *\n   * Useful when you want to debug different aspects of built in engine features like\n   *   * Transform\n   *   * Graphics\n   *   * Colliders\n   */\n  public debug: Debug;\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public readonly rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public readonly scenes: { [key: string]: Scene } = {};\n\n  /**\n   * @hidden\n   * @deprecated will be removed in v0.26.0\n   */\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public get isFullscreen(): boolean {\n    return this.screen.isFullScreen;\n  }\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public get displayMode(): DisplayMode {\n    return this.screen.displayMode;\n  }\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    return this.screen.pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   * @deprecated will be removed in v0.26.0\n   */\n  public position: string | AbsolutePosition;\n\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  private _isDebug: boolean = false;\n  public get isDebug(): boolean {\n    return this._isDebug;\n  }\n\n  /**\n   * No longer used\n   * @deprecated will be removed in v0.26.0\n   */\n  public debugColor: Color = new Color(255, 255, 255);\n\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * Hints the graphics context to truncate fractional world space coordinates\n   */\n  public get snapToPixel(): boolean {\n    return this.graphicsContext.snapToPixel;\n  };\n\n  public set snapToPixel(shouldSnapToPixel: boolean) {\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\n  };\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: Loader;\n\n  private _isInitialized: boolean = false;\n\n  private _deferredGoTo: string = null;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    canvasElement: undefined,\n    snapToPixel: false,\n    pointerScope: Input.PointerScope.Canvas,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\n\n    Flags.freeze();\n\n    // Initialize browser events facade\n    this.browser = new BrowserEvents(window, document);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function (test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    // eslint-disable-next-line no-console\n    if (console.log && !options.suppressConsoleBootMessage) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      // eslint-disable-next-line no-console\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      // eslint-disable-next-line no-console\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else if (options.canvasElement) {\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\n      this.canvas = options.canvasElement;\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\n    if ((options.width && options.height) || options.viewport) {\n      if (options.displayMode === undefined) {\n        displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fit');\n      displayMode = DisplayMode.FitScreen;\n    }\n\n    if (Flags.isEnabled(Legacy.Canvas)) {\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = ex2dCtx;\n      this.ctx = ex2dCtx.__ctx;\n    } else {\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = exWebglCtx;\n      this.ctx = exWebglCtx.__ctx;\n    }\n\n    this.screen = new Screen({\n      canvas: this.canvas,\n      context: this.graphicsContext,\n      antialiasing: options.antialiasing ?? true,\n      browser: this.browser,\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\n      resolution: options.resolution,\n      displayMode,\n      position: options.position,\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\n    });\n\n    TextureLoader.filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.maxFps = options.maxFps ?? this.maxFps;\n\n    this.clock = new StandardClock({\n      maxFps: this.maxFps,\n      tick: this._mainloop.bind(this),\n      onFatalException: (e) => this.onFatalException(e)\n    });\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n    this._loader.wireEngine(this);\n    this.debug = new Debug(this);\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene();\n\n    this.addScene('root', this.rootScene);\n    (window as any).___EXCALIBUR_DEVTOOL = this;\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    return this.screen.getWorldBounds();\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   * @deprecated\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\n   * ScreenElements do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n      return;\n    }\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\n      this.scenes[this._deferredGoTo].add(entity);\n    } else {\n      this.currentScene.add(entity);\n    }\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.currentScene.remove(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string): void {\n    // if not yet initialized defer goToScene\n    if (!this.isInitialized) {\n      this._deferredGoTo = key;\n      return;\n    }\n\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n      this.screen.setCurrentCamera(newScene.camera);\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    return this.screen.screenToWorldCoordinates(point);\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    return this.screen.worldToScreenCoordinates(point);\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // initialize inputs\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new PointerEventReceiver(pointerTarget, this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init();\n    this.input.gamepads.init();\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    this.browser.document.on(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    if (!this.canvasElementId && !options.canvasElement) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this.screen.antialiasing = isSmooth;\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    return this.screen.antialiasing;\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n      if (this._deferredGoTo) {\n        this.goToScene(this._deferredGoTo);\n      } else {\n        this.goToScene('root');\n      }\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (!this.ready) {\n      // suspend updates until loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.gamepads.update();\n      return;\n    }\n\n\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    // TODO remove\n    this._animations = this._animations.filter(function (a) {\n      return !a.animation.isDone();\n    });\n\n    // Publish update event\n    this._postupdate(delta);\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.gamepads.update();\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this.graphicsContext.beginDrawLifecycle();\n    this.graphicsContext.clear();\n    this._predraw(ctx, delta);\n\n    // Drawing nothing else while loading\n    if (!this._isReady) {\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\n      this.graphicsContext.flush();\n      return;\n    }\n\n    // TODO move to graphics systems?\n    this.graphicsContext.backgroundColor = this.backgroundColor;\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    // TODO don't access ctx directly\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    this._postdraw(ctx, delta);\n\n    // Flush any pending drawings\n    this.graphicsContext.flush();\n    this.graphicsContext.endDrawLifecycle();\n\n    this._checkForScreenShots();\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Enable or disable Excalibur debugging functionality.\n   * @param toggle a value that debug drawing will be changed to\n   */\n  public showDebug(toggle: boolean): void {\n    this._isDebug = toggle;\n  }\n\n  /**\n   * Toggle Excalibur debugging functionality.\n   */\n  public toggleDebug(): boolean {\n    this._isDebug = !this._isDebug;\n    return this._isDebug;\n  }\n\n  private _loadingComplete: boolean = false;\n\n  /**\n   * Returns true when loading is totally complete and the player has clicked start\n   */\n  public get loadingComplete() {\n    return this._loadingComplete;\n  }\n\n  private _isReady = false;\n  public get ready() {\n    return this._isReady;\n  }\n  private _isReadyResolve: () => any;\n  private _isReadyPromise = new Promise<void>(resolve => {\n    this._isReadyResolve = resolve;\n  });\n  public isReady(): Promise<void> {\n    return this._isReadyPromise;\n  }\n\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   *\n   * Note: start() only resolves AFTER the user has clicked the play button\n   */\n  public async start(loader?: Loader): Promise<void> {\n    if (!this._compatible) {\n      throw new Error('Excalibur is incompatible with your browser');\n    }\n\n    // Wire loader if we have it\n    if (loader) {\n      // Push the current user entered resolution/viewport\n      this.screen.pushResolutionAndViewport();\n\n      // Configure resolution for loader, it expects resolution === viewport\n      this.screen.resolution = this.screen.viewport;\n      this.screen.applyResolutionAndViewport();\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n    }\n\n    // Start the excalibur clock which drives the mainloop\n    // has started is a slight misnomer, it's really mainloop started\n    this._logger.debug('Starting game clock...');\n    this.browser.resume();\n    this.clock.start();\n    this._logger.debug('Game clock started');\n\n    if (loader) {\n      await this.load(this._loader);\n      this._loadingComplete = true;\n\n      // reset back to previous user resolution/viewport\n      this.screen.popResolutionAndViewport();\n      this.screen.applyResolutionAndViewport();\n    }\n\n    this._loadingComplete = true;\n\n    // Initialize before ready\n    this._overrideInitialize(this);\n\n    this._isReady = true;\n\n    this._isReadyResolve();\n    this.emit('start', new GameStartEvent(this));\n    return this._isReadyPromise;\n  }\n\n  private _mainloop(elapsed: number) {\n    this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\n    const delta = elapsed * this.timescale;\n\n    // reset frame stats (reuse existing instances)\n    const frameId = this.stats.prevFrame.id + 1;\n    this.stats.currFrame.reset();\n    this.stats.currFrame.id = frameId;\n    this.stats.currFrame.delta = delta;\n    this.stats.currFrame.fps = this.clock.fpsSampler.fps;\n    GraphicsDiagnostics.clear();\n\n    const beforeUpdate = this.clock.now();\n    this._update(delta);\n    const afterUpdate = this.clock.now();\n    this._draw(delta);\n    const afterDraw = this.clock.now();\n\n    this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n    this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n    this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n\n    this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\n    this.stats.prevFrame.reset(this.stats.currFrame);\n  }\n\n  /**\n   *\n   * @param game\n   * @param raf\n   * @param nowFn\n   * @deprecated Use [[Clock]] to run the mainloop, will be removed in v0.26.0\n   */\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n    const fpsSampler = new FpsSampler({\n      nowFn,\n      initialFps: game.maxFps === Infinity ? 60 : game.maxFps\n    });\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        fpsSampler.start();\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = now - lastTime || 1; // first frame\n\n        // Constrain fps\n        const fpsInterval = game.maxFps === Number.POSITIVE_INFINITY ? 0 : 1000 / game.maxFps;\n        if (elapsed <= fpsInterval) {\n          return; // too fast 😎 skip this frame\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = fpsSampler.fps;\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        // if fps interval is not a multiple\n        if (fpsInterval > 0) {\n          lastTime = now - (elapsed % fpsInterval);\n        } else {\n          lastTime = now;\n        }\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n        fpsSampler.end();\n        game.stats.prevFrame.reset(game.stats.currFrame);\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this.clock.isRunning()) {\n      this.emit('stop', new GameStopEvent(this));\n      this.browser.pause();\n      this.clock.stop();\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   * @deprecated will be removed in v0.26.0, use isRunning()\n   */\n  public isPaused(): boolean {\n    return !this.clock.isRunning();\n  }\n\n  /**\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\n   */\n  public isRunning() {\n    return this.clock.isRunning();\n  }\n\n\n  private _screenShotRequests: { preserveHiDPIResolution: boolean, resolve: (image: HTMLImageElement) => void }[] = [];\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\n   */\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\n      this._screenShotRequests.push({preserveHiDPIResolution, resolve});\n    });\n    return screenShotPromise;\n  }\n\n  private _checkForScreenShots() {\n    // We must grab the draw buffer before we yield to the browser\n    // the draw buffer is cleared after compositing\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\n    for (const request of this._screenShotRequests) {\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\n      const screenshot = document.createElement('canvas');\n      screenshot.width = finalWidth;\n      screenshot.height = finalHeight;\n      const ctx = screenshot.getContext('2d');\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\n\n      const result = new Image();\n      const raw = screenshot.toDataURL('image/png');\n      result.src = raw;\n      request.resolve(result);\n    }\n    // Reset state\n    this._screenShotRequests.length = 0;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public async load(loader: Loadable<any>): Promise<void> {\n    try {\n      await loader.load();\n    } catch {\n      await Promise.resolve();\n    }\n  }\n}\n\n/**\n * @internal\n * @deprecated\n */\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: WebAudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n\nexport class NativeSoundProcessedEvent extends MediaEvent {\n  public data: string | AudioBuffer;\n\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\n    super(target, 'NativeSoundProcessedEvent');\n\n    this.data = this._processedData;\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Color';\nimport { vec, Vector } from './Math/vector';\nimport { Text } from './Graphics/Text';\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\nimport { obsolete } from './Util/Decorators';\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\nimport { Font } from './Graphics/Font';\nimport { Actor } from './Actor';\nimport { ActorArgs } from '.';\n\n/**\n * Option for creating a label\n */\nexport interface LabelOptions {\n  /**\n   * Specify the label text\n   */\n  text?: string;\n  /**\n   * Specify the color of the text (does not apply to SpriteFonts)\n   */\n  color?: Color;\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  /**\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\n   */\n  spriteFont?: SpriteFont | LegacySpriteFont;\n  /**\n   * Specify a custom font\n   */\n  font?: Font\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n */\nexport class Label extends Actor {\n  private _font: Font = new Font();\n  private _text: Text = new Text({ text: '', font: this._font });\n\n  public get font(): Font {\n    return this._font;\n  }\n\n  public set font(newFont: Font) {\n    this._font = newFont;\n    this._text.font = newFont;\n  }\n\n  /**\n   * The text to draw.\n   */\n  public get text(): string {\n    return this._text.text;\n  }\n\n  public set text(text: string) {\n    this._text.text = text;\n  }\n\n  public override get color(): Color {\n    return this._text.color;\n  }\n\n  public override set color(color: Color) {\n    if (this._text) {\n      this._text.color = color;\n    }\n  }\n\n  public get opacity(): number {\n    return this._text.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this._text.opacity = opacity;\n  }\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   * @deprecated Use [[Font.bold|Label.font.bold]]\n   */\n  @obsolete({\n    message: 'Label.bold will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.bold'\n  })\n  public get bold(): boolean {\n    return this.font.bold;\n  }\n\n  public set bold(isBold: boolean) {\n    this.font.bold = isBold;\n  }\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   * @deprecated Use [[Font.family|Label.font.family]]\n   */\n  @obsolete({\n    message: 'Label.fontFamily will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.family'\n  })\n  public get fontFamily(): string {\n    return this.font.family;\n  }\n\n  public set fontFamily(family: string) {\n    this.font.family = family;\n  }\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   * @deprecated Use [[Font.size|Label.font.size]]\n   */\n  @obsolete({\n    message: 'Label.fontSize will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.size'\n  })\n  public get fontSize(): number {\n    return this.font.size;\n  }\n\n  public set fontSize(sizeInUnit: number) {\n    this.font.size = sizeInUnit;\n  }\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   * @deprecated Use [[Font.style|Label.font.style]]\n   */\n  @obsolete({\n    message: 'Label.fontStyle will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.style'\n  })\n  public get fontStyle(): FontStyle {\n    return this.font.style;\n  }\n\n  public set fontStyle(style: FontStyle) {\n    this.font.style = style;\n  }\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   * @deprecated Use [[Font.unit|Label.font.unit]]\n   */\n  @obsolete({\n    message: 'Label.fontUnit will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.unit'\n  })\n  public get fontUnit(): FontUnit {\n    return this.font.unit;\n  }\n\n  public set fontUnit(unit: FontUnit) {\n    this.font.unit = unit;\n  }\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\n   */\n  @obsolete({\n    message: 'Label.textAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.textAlign'\n  })\n  public get textAlign(): TextAlign {\n    return this.font.textAlign;\n  }\n\n  public set textAlign(align: TextAlign) {\n    this.font.textAlign = align;\n  }\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\n   */\n  @obsolete({\n    message: 'Label.baseAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.baseAlign'\n  })\n  public get baseAlign(): BaseAlign {\n    return this.font.baseAlign;\n  }\n\n  public set baseAlign(align: BaseAlign) {\n    this.font.baseAlign = align;\n  }\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   * @deprecated The maxWidth constraint is gone\n   */\n  public maxWidth: number;\n\n  private _legacySpriteFont: LegacySpriteFont;\n  private _spriteFont: SpriteFont;\n  /**\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   * @deprecated Use [[SpriteFont]]\n   */\n  public get spriteFont(): LegacySpriteFont {\n    return this._legacySpriteFont;\n  }\n\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\n    if (sf) {\n      if (sf instanceof LegacySpriteFont) {\n        this._legacySpriteFont = sf;\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\n        this._text.font = this._spriteFont;\n        return;\n      }\n      this._spriteFont = sf;\n      this._text.font = this._spriteFont;\n    }\n  }\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   * @deprecated Use [[SpriteFont.spacing]]\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   * @deprecated Use Graphics.SpriteFont.caseInsensitive\n   */\n  public caseInsensitive: boolean = true;\n\n  private _graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Build a new label\n   * @param options\n   */\n  constructor(options?: LabelOptions & ActorArgs) {\n    super(options);\n    const {text, pos, x, y, spriteFont, font, color} = options;\n\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\n    this.text = text ?? this.text;\n    this.font = font ?? this.font;\n    this.spriteFont = spriteFont ?? this.spriteFont;\n    this._text.color = color ?? this.color;\n    const gfx = this.get(GraphicsComponent);\n    gfx.anchor = Vector.Zero;\n    gfx.use(this._text);\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    this._graphicsContext = engine.graphicsContext;\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   */\n  public getTextWidth(): number {\n    return this._text.width;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.setTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.useTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public useTextShadow(on: boolean) {\n    if (this.spriteFont) {\n      this.spriteFont.useTextShadow(on);\n    }\n  }\n\n  /**\n   * Clears the current text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public clearTextShadow() {\n    this.font.shadow = null;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   * @param _delta\n   */\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    const exctx = this._graphicsContext;\n    this._text.draw(exctx, 0, 0);\n  }\n}\n","import { BodyComponent, BoundingBox, Collider, ColliderComponent, CollisionType, Color, CompositeCollider, vec, Vector } from '..';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\nexport class IsometricTile extends Entity {\n  /**\n   * Indicates whether this tile is solid\n   */\n  public solid: boolean = false;\n\n  private _gfx: GraphicsComponent;\n  private _tileBounds = new BoundingBox();\n  private _graphics: Graphic[] = [];\n  public getGraphics(): readonly Graphic[] {\n    return this._graphics;\n  }\n  /**\n   * Tile graphics\n   */\n  public addGraphic(graphic: Graphic) {\n    this._graphics.push(graphic);\n    this._gfx.visible = true;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  private _recalculateBounds(): BoundingBox {\n    let bounds = this._tileBounds.clone();\n    for (const graphic of this._graphics) {\n      const offset = vec(\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\n    }\n    return bounds;\n  }\n\n  public removeGraphic(graphic: Graphic) {\n    const index = this._graphics.indexOf(graphic);\n    if (index > -1) {\n      this._graphics.splice(index, 1);\n    }\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  public clearGraphics() {\n    this._graphics.length = 0;\n    this._gfx.visible = false;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  /**\n   * Tile colliders\n   */\n  private _colliders: Collider[] = [];\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a collider to the IsometricTile\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the IsometricTile\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the IsometricTile\n   */\n  public clearColliders(): void {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Integer tile x coordinate\n   */\n  public readonly x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  public readonly y: number;\n  /**\n   * Reference to the [[IsometricMap]] this tile is part of\n   */\n  public readonly map: IsometricMap;\n\n  private _transform: TransformComponent;\n  private _isometricEntityComponent: IsometricEntityComponent;\n\n  /**\n   * Returns the top left corner of the [[IsometricTile]] in world space\n   */\n  public get pos(): Vector {\n    return this.map.tileToWorld(vec(this.x, this.y));\n  }\n\n  /**\n   * Returns the center of the [[IsometricTile]]\n   */\n  public get center(): Vector {\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\n  }\n\n  /**\n   * Construct a new IsometricTile\n   * @param x tile coordinate in x (not world position)\n   * @param y tile coordinate in y (not world position)\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\n   * @param map reference to owning IsometricMap\n   */\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\n    super([\n      new TransformComponent(),\n      new GraphicsComponent({\n        offset: graphicsOffset ?? Vector.Zero,\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\n      }),\n      new IsometricEntityComponent(map)\n    ]);\n    this.x = x;\n    this.y = y;\n    this.map = map;\n    this._transform = this.get(TransformComponent);\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\n\n    const halfTileWidth = this.map.tileWidth / 2;\n    const halfTileHeight = this.map.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    // The x position shifts left with every y step\n    const xPos = (this.x - this.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (this.x + this.y) * halfTileHeight;\n    this._transform.pos = vec(xPos, yPos);\n    this._isometricEntityComponent.elevation = 0;\n\n    this._gfx = this.get(GraphicsComponent);\n    this._gfx.visible = false; // start not visible\n    const totalWidth = this.map.tileWidth;\n    const totalHeight = this.map.tileHeight;\n\n    // initial guess at gfx bounds based on the tile\n    const offset = vec(0, (this.map.renderFromTopOfGraphic ? totalHeight : 0));\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\n      left: -totalWidth / 2,\n      top: -totalHeight,\n      right: totalWidth / 2,\n      bottom: totalHeight\n    }).translate(offset);\n  }\n\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\n    const halfTileWidth = this.map.tileWidth / 2;\n    gfx.save();\n    // shift left origin to corner of map, not the left corner of the first sprite\n    gfx.translate(-halfTileWidth, 0);\n    for (const graphic of this._graphics) {\n      graphic.draw(\n        gfx,\n        this.map.graphicsOffset.x,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n    }\n    gfx.restore();\n  }\n}\n\nexport interface IsometricMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\n   */\n  renderFromTopOfGraphic?: boolean;\n  /**\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\n   */\n  graphicsOffset?: Vector;\n  /**\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\n *\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\n *\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\n * your art assets.\n */\nexport class IsometricMap extends Entity {\n  /**\n   * Width of individual tile in pixels\n   */\n  public readonly tileWidth: number;\n  /**\n   * Height of individual tile in pixels\n   */\n  public readonly tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  public readonly width: number;\n  /**\n   * Number of tiles high\n   */\n  public readonly height: number;\n  /**\n   * List containing all of the tiles in IsometricMap\n   */\n  public readonly tiles: IsometricTile[];\n\n  /**\n   * Render the tile graphic from the top instead of the bottom\n   *\n   * default is `false` meaning rendering from the bottom\n   */\n  public renderFromTopOfGraphic: boolean = false;\n  public graphicsOffset: Vector = vec(0, 0);\n\n  /**\n   * Isometric map [[TransformComponent]]\n   */\n  public transform: TransformComponent;\n\n  /**\n   * Isometric map [[ColliderComponent]]\n   */\n  public collider: ColliderComponent;\n\n  private _composite: CompositeCollider;\n\n  constructor(options: IsometricMapOptions) {\n    super([\n      new TransformComponent(),\n      new BodyComponent({\n        type: CollisionType.Fixed\n      }),\n      new ColliderComponent(),\n      new DebugGraphicsComponent((ctx) => this.debug(ctx), false)\n    ], options.name);\n    const { pos, tileWidth, tileHeight, width, height, renderFromTopOfGraphic, graphicsOffset } = options;\n\n    this.transform = this.get(TransformComponent);\n    if (pos) {\n      this.transform.pos = pos;\n    }\n\n    this.collider = this.get(ColliderComponent);\n    if (this.collider) {\n      this.collider.set(this._composite = new CompositeCollider([]));\n    }\n\n\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\n\n    this.tileWidth = tileWidth;\n    this.tileHeight = tileHeight;\n    this.width = width;\n    this.height = height;\n\n    this.tiles = new Array(width * height);\n\n    // build up tile representation\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\n        this.tiles[x + y * width] = tile;\n        this.addChild(tile);\n        // TODO row/columns helpers\n      }\n    }\n  }\n\n  public update(): void {\n    if (this._collidersDirty) {\n      this.updateColliders();\n      this._collidersDirty = false;\n    }\n  }\n\n  private _collidersDirty = false;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  public updateColliders() {\n    this._composite.clearColliders();\n    for (const tile of this.tiles) {\n      if (tile.solid) {\n        for (const collider of tile.getColliders()) {\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\n            .add(originalOffset)\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\n          collider.owner = this;\n          this._composite.addCollider(collider);\n        }\n      }\n    }\n    this.collider.update();\n  }\n\n  /**\n   * Convert world space coordinates to the tile x, y coordinate\n   * @param worldCoordinate\n   */\n  public worldToTile(worldCoordinate: Vector): Vector {\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\n\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    return vec(\n      ~~((worldCoordinate.x / halfTileWidth + (worldCoordinate.y / halfTileHeight)) / 2),\n      ~~((worldCoordinate.y / halfTileHeight - (worldCoordinate.x / halfTileWidth)) / 2));\n  }\n\n  /**\n   * Given a tile coordinate, return the top left corner in world space\n   * @param tileCoordinate\n   */\n  public tileToWorld(tileCoordinate: Vector): Vector {\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // The x position shifts left with every y step\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\n    return vec(xPos, yPos).add(this.transform.pos);\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by its x and y coordinates\n   */\n  public getTile(x: number, y: number): IsometricTile | null {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): IsometricTile | null {\n    const tileCoord = this.worldToTile(point);\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\n    return tile;\n  }\n\n  /**\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\n   * @param gfx\n   */\n  public debug(gfx: ExcaliburGraphicsContext) {\n\n    for (let y = 0; y < this.height + 1; y++) {\n      const left = this.tileToWorld(vec(0, y));\n      const right = this.tileToWorld(vec(this.width, y));\n      gfx.drawLine(left, right, Color.Red, 2);\n    }\n\n    for (let x = 0; x < this.width + 1; x++) {\n      const top = this.tileToWorld(vec(x, 0));\n      const bottom = this.tileToWorld(vec(x, this.height));\n      gfx.drawLine(top, bottom, Color.Red, 2);\n    }\n\n    for (const tile of this.tiles) {\n      gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), 3, Color.Yellow);\n    }\n  }\n}","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @deprecated Use [[Polygon]]\n * @warning Use sparingly as Polygons are performance intensive\n */\n@obsolete({\n  message: 'Polygon will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Polygon'\n})\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = Vector.Zero;\n  public offset = Vector.Zero;\n  public rotation: number = 0;\n  public scale = Vector.One;\n  public opacity: number = 1;\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\n    };\n\n    const xpoint = drawWidth * anchor.x + offset.x + x;\n    const ypoint = drawHeight * anchor.y + offset.y + y;\n\n    ctx.save();\n    ctx.translate(xpoint, ypoint);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    ctx.stroke();\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n}\n","import { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Engine } from './../Engine';\nimport * as Events from './../Events';\nimport { Scene } from '../Scene';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _initialize {\n  _initialize(engine: Engine): void;\n}\n\n/**\n * Type guard checking for internal initialize method\n * @internal\n * @param a\n */\nexport function has_initialize(a: any): a is _initialize {\n  return !!a._initialize;\n}\n\nexport interface OnInitialize {\n  onInitialize(engine: Engine): void;\n}\n\n/**\n *\n */\nexport function hasOnInitialize(a: any): a is OnInitialize {\n  return !!a.onInitialize;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _preupdate {\n  _preupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_preupdate(a: any): a is _preupdate {\n  return !!a._preupdate;\n}\n\nexport interface OnPreUpdate {\n  onPreUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\n  return !!a.onPreUpdate;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _postupdate {\n  _postupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_postupdate(a: any): a is _postupdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface OnPostUpdate {\n  onPostUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface CanInitialize {\n  /**\n   * Overridable implementation\n   */\n  onInitialize(_engine: Engine): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\n}\n\nexport interface CanActivate {\n  /**\n   * Overridable implementation\n   */\n  onActivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\n}\n\nexport interface CanDeactivate {\n  /**\n   * Overridable implementation\n   */\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\n}\n\nexport interface CanUpdate {\n  /**\n   * Overridable implementation\n   */\n  onPreUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\n}\n\nexport interface OnPreDraw {\n  /**\n   * Overridable implementation\n   */\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n}\n\nexport interface OnPostDraw {\n  /**\n   * Overridable implementation\n   */\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\n/**\n *\n */\nexport function hasPreDraw(a: any): a is OnPreDraw {\n  return !!a.onPreDraw;\n}\n\n/**\n *\n */\nexport function hasPostDraw(a: any): a is OnPostDraw {\n  return !!a.onPostDraw;\n}\n\nexport interface CanBeKilled {\n  /**\n   * Overridable implementation\n   */\n  onPreKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport { clamp } from '../../Math/util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\nexport class WebAudioInstance implements Audio {\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n\n  private _playingPromise: Promise<boolean>;\n  private _playingResolve: (value: boolean) => void;\n\n  private _loop = false;\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    value = clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant transition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public set duration(value: number | undefined) {\n    this._duration = value;\n  }\n\n  /**\n   * Duration of the sound, in seconds.\n   */\n  public get duration() {\n    return this._duration;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  private _isPlaying = false;\n  private _isPaused = false;\n  private _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(private _src: AudioBuffer) {\n    this._createNewBufferSource();\n  }\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public play(playStarted: () => any = () => {}) {\n    if (this._isPaused) {\n      this._resumePlayBack();\n      playStarted();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n      playStarted();\n    }\n\n    return this._playingPromise;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  private _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>((resolve) => {\n      this._playingResolve = resolve;\n    });\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._wireUpOnEnded();\n  }\n\n  private _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  private _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  private _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingResolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { WebAudioInstance } from './WebAudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\nimport { canPlayFile } from '../../Util/Sound';\nimport { Loadable } from '../../Interfaces/Index';\nimport { Logger } from '../../Util/Log';\nimport { Class } from '../../Class';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n */\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\n  public logger: Logger = Logger.getInstance();\n  public data: AudioBuffer;\n  private _resource: Resource<ArrayBuffer>;\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public get duration(): number | undefined {\n    return this._duration;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): Audio[] {\n    return this._tracks;\n  }\n\n  public get path() {\n    return this._resource.path;\n  }\n\n  public set path(val: string) {\n    this._resource.path = val;\n  }\n\n  private _loop = false;\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n  private _isStopped = false;\n  private _isPaused = false;\n  private _tracks: Audio[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super();\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\n    /**\n     * Chrome : MP3, WAV, Ogg\n     * Firefox : WAV, Ogg,\n     * IE : MP3, WAV coming soon\n     * Safari MP3, WAV, Ogg\n     */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  public async load(): Promise<AudioBuffer> {\n    if (this.data) {\n      return this.data;\n    }\n    const arraybuffer = await this._resource.load();\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\n    return this.data = audiobuffer;\n  }\n\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\n    try {\n      return await this._audioContext.decodeAudioData(data.slice(0));\n    } catch (e) {\n      this.logger.error(\n        'Unable to decode ' +\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\n          'if this is an mp3 try removing id3 tags and album art from the file.'\n      );\n      return await Promise.reject();\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n\n      this._engine.on('start', () => {\n        this._isStopped = false;\n      });\n\n      this._engine.on('stop', () => {\n        this.stop();\n        this._isStopped = true;\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    if (this._isStopped) {\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n      return Promise.resolve(false);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n   */\n  public stop() {\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[Audio]] which Id is to be given\n   */\n  public getTrackId(track: Audio): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private async _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed: Promise<boolean>[] = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      await Promise.all(resumed);\n    }\n    return true;\n  }\n\n  /**\n   * Starts playback, returns a promise that resolves when playback is complete\n   */\n  private async _startPlayback(): Promise<boolean> {\n    const track = await this._getTrackInstance(this.data);\n\n    const complete = await track.play(() => {\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    // when done, remove track\n    this.emit('playbackend', new NativeSoundEvent(this, track));\n    this._tracks.splice(this.getTrackId(track), 1);\n\n    return complete;\n  }\n\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\n    const newTrack = new WebAudioInstance(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n    newTrack.duration = this.duration;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n}\n","import { Resource } from './Resource';\nimport { Sprite } from '../Graphics/Sprite';\nimport { Color } from '../Color';\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\nimport { Animation } from '../Graphics/Animation';\nimport { Engine } from '../Engine';\nimport { Loadable } from '../Interfaces/Index';\nimport { ImageSource } from '../Graphics/ImageSource';\nimport { LegacyDrawing } from '..';\nimport { range } from '../Math/util';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n */\nexport class Gif implements Loadable<ImageSource[]> {\n  private _resource: Resource<ArrayBuffer>;\n\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _textures: ImageSource[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n\n  public data: ImageSource[];\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<ImageSource[]> {\n    const arraybuffer = await this._resource.load();\n    this._stream = new Stream(arraybuffer);\n    this._gif = new ParseGif(this._stream, this._transparentColor);\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\n\n    // Load all textures\n    await Promise.all(images.map(t => t.load()));\n    return this.data = this._textures = images;\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  /**\n   * Return a frame of the gif as a legacy sprite by index\n   * @deprecated\n   */\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\n    return Sprite.toLegacySprite(this.toSprite(id));\n  }\n\n  /**\n   * Return the gif as a legacy spritesheet\n   * @deprecated\n   */\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\n  }\n\n  /**\n   * Return the gif as a legacy animation\n   * @deprecated\n   * @param engine\n   * @param speed\n   */\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\n  }\n\n  /**\n   * Return a frame of the gif as a sprite by id\n   * @param id\n   */\n  public toSprite(id: number = 0): Sprite {\n    const sprite = this._textures[id].toSprite();\n    return sprite;\n  }\n\n  /**\n   * Return the gif as a spritesheet\n   */\n  public toSpriteSheet(): SpriteSheet {\n    const sprites: Sprite[] = this._textures.map((image) => {\n      return image.toSprite();\n    });\n    return new SpriteSheet({ sprites });\n  }\n\n  /**\n   * Transform the GIF into an animation with duration per frame\n   */\n  public toAnimation(durationPerFrameMs: number): Animation {\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\n    const length = spriteSheet.sprites.length;\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface GifFrame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function (s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function (minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function (size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function () {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: GifFrame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: GifFrame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","import { ImageFiltering } from '.';\nimport { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n *\n * Polygons default to [[ImageFiltering.Blended]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.filtering = ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\n\n/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\nexport class SortedList<T> {\n  private _getComparable: (item: T) => number;\n  private _root: BinaryTreeNode<T>;\n\n  constructor(getComparable: (item: T) => number) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: T): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: T): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\n    if (node != null) {\n      if (this._getComparable(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: T): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (element.getKey() < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<T>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach((element) => {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\nexport class BinaryTreeNode<T> {\n  private _key: number;\n  private _data: Array<T>;\n  private _left: BinaryTreeNode<T>;\n  private _right: BinaryTreeNode<T>;\n\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): T[] {\n    return this._data;\n  }\n\n  public setData(data: T[]) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode<T> {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode<T>) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode<T> {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode<T>) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n * @deprecated Will be removed in v0.26.0\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","import { Logger } from '..';\nexport class Pool<Type> {\n  public totalAllocations = 0;\n  public index = 0;\n  public objects: Type[] = [];\n  private _logger = Logger.getInstance();\n\n  constructor(\n    public builder: (...args: any[]) => Type,\n    public recycler: (instance: Type, ...args: any[]) => Type,\n    public maxObjects: number = 100\n  ) {}\n\n  /**\n   * Use many instances out of the in the context and return all to the pool.\n   *\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\n   * @param context\n   */\n  using(context: (pool: Pool<Type>) => Type[] | void) {\n    const result = context(this);\n    if (result) {\n      return this.done(...result);\n    }\n    return this.done();\n  }\n\n  /**\n   * Use a single instance out of th pool and immediately return it to the pool\n   * @param context\n   */\n  borrow(context: (object: Type) => void) {\n    const object = this.get();\n    context(object);\n    this.index--;\n  }\n\n  /**\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\n   * @param args\n   */\n  get(...args: any[]): Type {\n    if (this.index === this.maxObjects) {\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\n      this.maxObjects = this.maxObjects * 2;\n    }\n\n    if (this.objects[this.index]) {\n      // Pool has an available object already constructed\n      return this.recycler(this.objects[this.index++], ...args);\n    } else {\n      // New allocation\n      this.totalAllocations++;\n      const object = (this.objects[this.index++] = this.builder(...args));\n      return object;\n    }\n  }\n\n  /**\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\n   *\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\n   * to be passed to consumers\n   * @param objects A list of object to separate from the pool\n   */\n  done(...objects: Type[]): Type[];\n  done(): void;\n  done(...objects: Type[]): Type[] | void {\n    // All objects in pool now considered \"free\"\n    this.index = 0;\n    for (const object of objects) {\n      const poolIndex = this.objects.indexOf(object);\n      // Build a new object to take the pool place\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\n      this.totalAllocations++;\n    }\n    return objects;\n  }\n}\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Valid states for a promise to be in\n * @deprecated Will be removed in v0.26.0\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\n/**\n * @deprecated Will be removed in v0.26.0\n */\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\n  alternateMethod: 'Use browser native promises'\n})\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   * @deprecated Use browser native promises\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   * @deprecated Use browser native promises\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   * @deprecated Use browser native promises\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resolved call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   * @deprecated Use browser native promises\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   * @deprecated Use browser native promises\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   * @deprecated Use browser native promises\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   * @deprecated Use browser native promises\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport const EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\nexport * from './Flags';\nexport * from './Id';\nexport * from './Engine';\nexport * from './Screen';\nexport { Actor, ActorArgs } from './Actor';\nexport * from './Math/Index';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug/index';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport * from './Label';\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Collision/Physics';\nexport * from './Scene';\n\nexport * from './TileMap/index';\n\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './ScreenElement';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\n\n// ex.LegacyDrawing namespace\nimport * as legacyDrawing from './Drawing/Index';\nexport { legacyDrawing as LegacyDrawing };\nexport * from './Interfaces/Index';\nexport * from './Resources/Index';\n\nexport * from './EntityComponentSystem/index';\n\nexport * from './Color';\n\nexport * from './Graphics/index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\nexport { PointerComponent } from './Input/Index';\nexport { PointerSystem } from './Input/PointerSystem';\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Browser';\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Observable';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\nexport * from './Util/Pool';\nexport * from './Util/Fps';\nexport * from './Util/Clock';\nexport * from './Util/WebAudio';\n\n// ex.Deprecated\nexport * from './Promises';\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n","var util = require('./util')\nvar slice = util.slice\nvar pluck = util.pluck\nvar each = util.each\nvar bind = util.bind\nvar create = util.create\nvar isList = util.isList\nvar isFunction = util.isFunction\nvar isObject = util.isObject\n\nmodule.exports = {\n\tcreateStore: createStore\n}\n\nvar storeAPI = {\n\tversion: '2.0.12',\n\tenabled: false,\n\t\n\t// get returns the value of the given key. If that value\n\t// is undefined, it returns optionalDefaultValue instead.\n\tget: function(key, optionalDefaultValue) {\n\t\tvar data = this.storage.read(this._namespacePrefix + key)\n\t\treturn this._deserialize(data, optionalDefaultValue)\n\t},\n\n\t// set will store the given value at key and returns value.\n\t// Calling set with value === undefined is equivalent to calling remove.\n\tset: function(key, value) {\n\t\tif (value === undefined) {\n\t\t\treturn this.remove(key)\n\t\t}\n\t\tthis.storage.write(this._namespacePrefix + key, this._serialize(value))\n\t\treturn value\n\t},\n\n\t// remove deletes the key and value stored at the given key.\n\tremove: function(key) {\n\t\tthis.storage.remove(this._namespacePrefix + key)\n\t},\n\n\t// each will call the given callback once for each key-value pair\n\t// in this store.\n\teach: function(callback) {\n\t\tvar self = this\n\t\tthis.storage.each(function(val, namespacedKey) {\n\t\t\tcallback.call(self, self._deserialize(val), (namespacedKey || '').replace(self._namespaceRegexp, ''))\n\t\t})\n\t},\n\n\t// clearAll will remove all the stored key-value pairs in this store.\n\tclearAll: function() {\n\t\tthis.storage.clearAll()\n\t},\n\n\t// additional functionality that can't live in plugins\n\t// ---------------------------------------------------\n\n\t// hasNamespace returns true if this store instance has the given namespace.\n\thasNamespace: function(namespace) {\n\t\treturn (this._namespacePrefix == '__storejs_'+namespace+'_')\n\t},\n\n\t// createStore creates a store.js instance with the first\n\t// functioning storage in the list of storage candidates,\n\t// and applies the the given mixins to the instance.\n\tcreateStore: function() {\n\t\treturn createStore.apply(this, arguments)\n\t},\n\t\n\taddPlugin: function(plugin) {\n\t\tthis._addPlugin(plugin)\n\t},\n\t\n\tnamespace: function(namespace) {\n\t\treturn createStore(this.storage, this.plugins, namespace)\n\t}\n}\n\nfunction _warn() {\n\tvar _console = (typeof console == 'undefined' ? null : console)\n\tif (!_console) { return }\n\tvar fn = (_console.warn ? _console.warn : _console.log)\n\tfn.apply(_console, arguments)\n}\n\nfunction createStore(storages, plugins, namespace) {\n\tif (!namespace) {\n\t\tnamespace = ''\n\t}\n\tif (storages && !isList(storages)) {\n\t\tstorages = [storages]\n\t}\n\tif (plugins && !isList(plugins)) {\n\t\tplugins = [plugins]\n\t}\n\n\tvar namespacePrefix = (namespace ? '__storejs_'+namespace+'_' : '')\n\tvar namespaceRegexp = (namespace ? new RegExp('^'+namespacePrefix) : null)\n\tvar legalNamespaces = /^[a-zA-Z0-9_\\-]*$/ // alpha-numeric + underscore and dash\n\tif (!legalNamespaces.test(namespace)) {\n\t\tthrow new Error('store.js namespaces can only have alphanumerics + underscores and dashes')\n\t}\n\t\n\tvar _privateStoreProps = {\n\t\t_namespacePrefix: namespacePrefix,\n\t\t_namespaceRegexp: namespaceRegexp,\n\n\t\t_testStorage: function(storage) {\n\t\t\ttry {\n\t\t\t\tvar testStr = '__storejs__test__'\n\t\t\t\tstorage.write(testStr, testStr)\n\t\t\t\tvar ok = (storage.read(testStr) === testStr)\n\t\t\t\tstorage.remove(testStr)\n\t\t\t\treturn ok\n\t\t\t} catch(e) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t},\n\n\t\t_assignPluginFnProp: function(pluginFnProp, propName) {\n\t\t\tvar oldFn = this[propName]\n\t\t\tthis[propName] = function pluginFn() {\n\t\t\t\tvar args = slice(arguments, 0)\n\t\t\t\tvar self = this\n\n\t\t\t\t// super_fn calls the old function which was overwritten by\n\t\t\t\t// this mixin.\n\t\t\t\tfunction super_fn() {\n\t\t\t\t\tif (!oldFn) { return }\n\t\t\t\t\teach(arguments, function(arg, i) {\n\t\t\t\t\t\targs[i] = arg\n\t\t\t\t\t})\n\t\t\t\t\treturn oldFn.apply(self, args)\n\t\t\t\t}\n\n\t\t\t\t// Give mixing function access to super_fn by prefixing all mixin function\n\t\t\t\t// arguments with super_fn.\n\t\t\t\tvar newFnArgs = [super_fn].concat(args)\n\n\t\t\t\treturn pluginFnProp.apply(self, newFnArgs)\n\t\t\t}\n\t\t},\n\n\t\t_serialize: function(obj) {\n\t\t\treturn JSON.stringify(obj)\n\t\t},\n\n\t\t_deserialize: function(strVal, defaultVal) {\n\t\t\tif (!strVal) { return defaultVal }\n\t\t\t// It is possible that a raw string value has been previously stored\n\t\t\t// in a storage without using store.js, meaning it will be a raw\n\t\t\t// string value instead of a JSON serialized string. By defaulting\n\t\t\t// to the raw string value in case of a JSON parse error, we allow\n\t\t\t// for past stored values to be forwards-compatible with store.js\n\t\t\tvar val = ''\n\t\t\ttry { val = JSON.parse(strVal) }\n\t\t\tcatch(e) { val = strVal }\n\n\t\t\treturn (val !== undefined ? val : defaultVal)\n\t\t},\n\t\t\n\t\t_addStorage: function(storage) {\n\t\t\tif (this.enabled) { return }\n\t\t\tif (this._testStorage(storage)) {\n\t\t\t\tthis.storage = storage\n\t\t\t\tthis.enabled = true\n\t\t\t}\n\t\t},\n\n\t\t_addPlugin: function(plugin) {\n\t\t\tvar self = this\n\n\t\t\t// If the plugin is an array, then add all plugins in the array.\n\t\t\t// This allows for a plugin to depend on other plugins.\n\t\t\tif (isList(plugin)) {\n\t\t\t\teach(plugin, function(plugin) {\n\t\t\t\t\tself._addPlugin(plugin)\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Keep track of all plugins we've seen so far, so that we\n\t\t\t// don't add any of them twice.\n\t\t\tvar seenPlugin = pluck(this.plugins, function(seenPlugin) {\n\t\t\t\treturn (plugin === seenPlugin)\n\t\t\t})\n\t\t\tif (seenPlugin) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.plugins.push(plugin)\n\n\t\t\t// Check that the plugin is properly formed\n\t\t\tif (!isFunction(plugin)) {\n\t\t\t\tthrow new Error('Plugins must be function values that return objects')\n\t\t\t}\n\n\t\t\tvar pluginProperties = plugin.call(this)\n\t\t\tif (!isObject(pluginProperties)) {\n\t\t\t\tthrow new Error('Plugins must return an object of function properties')\n\t\t\t}\n\n\t\t\t// Add the plugin function properties to this store instance.\n\t\t\teach(pluginProperties, function(pluginFnProp, propName) {\n\t\t\t\tif (!isFunction(pluginFnProp)) {\n\t\t\t\t\tthrow new Error('Bad plugin property: '+propName+' from plugin '+plugin.name+'. Plugins should only return functions.')\n\t\t\t\t}\n\t\t\t\tself._assignPluginFnProp(pluginFnProp, propName)\n\t\t\t})\n\t\t},\n\t\t\n\t\t// Put deprecated properties in the private API, so as to not expose it to accidential\n\t\t// discovery through inspection of the store object.\n\t\t\n\t\t// Deprecated: addStorage\n\t\taddStorage: function(storage) {\n\t\t\t_warn('store.addStorage(storage) is deprecated. Use createStore([storages])')\n\t\t\tthis._addStorage(storage)\n\t\t}\n\t}\n\n\tvar store = create(_privateStoreProps, storeAPI, {\n\t\tplugins: []\n\t})\n\tstore.raw = {}\n\teach(store, function(prop, propName) {\n\t\tif (isFunction(prop)) {\n\t\t\tstore.raw[propName] = bind(store, prop)\t\t\t\n\t\t}\n\t})\n\teach(storages, function(storage) {\n\t\tstore._addStorage(storage)\n\t})\n\teach(plugins, function(plugin) {\n\t\tstore._addPlugin(plugin)\n\t})\n\treturn store\n}\n","module.exports = [\n\t// Listed in order of usage preference\n\trequire('./localStorage'),\n\trequire('./oldFF-globalStorage'),\n\trequire('./oldIE-userDataStorage'),\n\trequire('./cookieStorage'),\n\trequire('./sessionStorage'),\n\trequire('./memoryStorage')\n]\n","var engine = require('../src/store-engine')\n\nvar storages = require('../storages/all')\nvar plugins = [require('../plugins/json2')]\n\nmodule.exports = engine.createStore(storages, plugins)\n","import store from \"store\";\n\nexport let Preferences = {\n  muteBackgroundMusic: false,\n  muteAll: false,\n};\n\nlet _origPreferences = { ...Preferences };\n\nexport function resetPreferences() {\n  Preferences = { ..._origPreferences };\n}\n\nexport function savePreferences() {\n  store.set(\"pref\", Preferences);\n}\n\nexport function loadPreferences() {\n  // overwrite but allow new properties\n  Preferences = { ...Preferences, ...store.get(\"pref\") };\n}","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"93Bqc\")).toString();","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"lxy2T\")).toString();","import { ImageSource, Sound } from \"excalibur\";\n\n// Images\nimport swordUrl from \"./images/sword.png\";\n\n// Sounds\nimport clankUrl from \"./sounds/clank.wav\";\n\nexport const Resources = {\n    // Images\n    Sword: new ImageSource(swordUrl),\n\n    // Sounds\n    Clank: new Sound(clankUrl)\n}","export default {\n    DebugMenuEnabled: false,\n    SoundVolume: 0.3,\n    Seed: 1337\n}","import { Actor, Engine, Random, Scene, vec } from \"excalibur\";\nimport { Resources } from \"./resources\";\nimport config from \"./config\";\n\nexport class Level extends Scene {\n    random = new Random(config.Seed);\n    onInitialize(_engine: Engine): void {\n        const actor = new Actor({\n            pos: vec(this.random.floating(100, 500), this.random.floating(100, 500)),\n        });\n        actor.graphics.use(Resources.Sword.toSprite());\n        this.add(actor);\n    }\n}","/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","import { Sound } from \"excalibur\";\nimport classNames from 'classnames';\nimport { Resources } from \"./resources\";\nimport { Preferences, savePreferences } from \"./preferences\";\nimport Config from \"./config\";\n\n\nexport class SoundManager {\n    static setSoundSpecificVolume() {\n      Resources.Clank.volume = 0.5;\n    }\n  \n    static init() {\n      SoundManager.setSoundSpecificVolume();\n      if (Preferences.muteBackgroundMusic) {\n        SoundManager.muteBackgroundMusic();\n      }\n      if (Preferences.muteAll) {\n        SoundManager.muteAll();\n      }\n  \n      $(\"#mute-music\").on(\"click\", () => {\n        if (Preferences.muteBackgroundMusic) {\n          SoundManager.unmuteBackgroundMusic();\n        } else {\n          SoundManager.muteBackgroundMusic();\n        }\n        savePreferences();\n        return false;\n      });\n  \n      $(\"#mute-all\").on(\"click\", () => {\n        if (Preferences.muteAll) {\n          SoundManager.unmuteAll();\n        } else {\n          SoundManager.muteAll();\n        }\n        savePreferences();\n        return false;\n      });\n    }\n  \n    static muteAll() {\n      Preferences.muteAll = true;\n      Preferences.muteBackgroundMusic = true;\n  \n      for (let r in Resources) {\n        let snd = (Resources as any)[r];\n        if (snd instanceof Sound) {\n          snd.volume = 0;\n        }\n      }\n      SoundManager.muteBackgroundMusic();\n      SoundManager._updateMuteAllButton();\n    }\n  \n    static unmuteAll() {\n      Preferences.muteAll = false;\n      Preferences.muteBackgroundMusic = false;\n  \n      for (var r in Resources) {\n        let snd = (Resources as any)[r];\n        if (snd instanceof Sound) {\n          snd.volume = Config.SoundVolume;\n        }\n      }\n      SoundManager.setSoundSpecificVolume();\n      SoundManager.unmuteBackgroundMusic();\n      SoundManager._updateMuteAllButton();\n    }\n  \n    static startBackgroundMusic() {\n      // start bg music\n      // Resources.BackgroundMusic.volume = Preferences.muteBackgroundMusic\n      //   ? 0\n      //   : Config.BackgroundVolume;\n      // Resources.BackgroundMusic.loop = true;\n      // if (!Resources.BackgroundMusic.isPlaying())\n      //   Resources.BackgroundMusic.play();\n    }\n  \n    static stopBackgroundMusic() {\n      // stop bg music\n      // Resources.BackgroundMusic.loop = false;\n    }\n  \n    static muteBackgroundMusic() {\n      Preferences.muteBackgroundMusic = true;\n  \n      // mute bg music\n      // Resources.BackgroundMusic.volume = 0;\n      SoundManager._updateMusicButton();\n    }\n  \n    static unmuteBackgroundMusic() {\n      Preferences.muteBackgroundMusic = false;\n  \n      // unmute bg music\n      // Resources.BackgroundMusic.volume = Config.BackgroundVolume;\n  \n      SoundManager._updateMusicButton();\n    }\n  \n  \n    private static _updateMusicButton() {\n      $(\"#mute-music i\").get(0).className = classNames(\"fa\", {\n        \"fa-music\": !Preferences.muteBackgroundMusic,\n        \"fa-play\": Preferences.muteBackgroundMusic,\n      });\n    }\n  \n    private static _updateMuteAllButton() {\n      $(\"#mute-all i\").get(0).className = classNames(\"fa\", {\n        \"fa-volume-up\": !Preferences.muteAll,\n        \"fa-volume-off\": Preferences.muteAll,\n      });\n    }\n  }","import { DisplayMode, Engine, Loader } from \"excalibur\";\nimport { loadPreferences } from \"./preferences\";\nimport { Level } from \"./level\";\nimport { Resources } from \"./resources\";\nimport { SoundManager } from \"./sound-manager\";\n\nloadPreferences();\nSoundManager.init();\nexport class Game extends Engine {\n    constructor() {\n        super({\n            canvasElementId: 'game',\n            displayMode: DisplayMode.FitScreen\n        });\n    }\n\n    init() {\n        this.startLevel();\n        const loader = new Loader();\n        for (const resource of Object.values(Resources)) {\n            loader.addResource(resource);\n        }\n        this.start(loader).then(() => {\n            // game start stuff\n        });\n    }\n\n    startLevel = () => {\n        const level = new Level();\n        this.addScene(\"main\", level);\n        this.goToScene(\"main\");\n    }\n}\n\nexport const game = new Game();\n\ngame.init();"],"names":["$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","$55b3c5c261aa2a00$var$Global","$b63e377f8a561b77$exports","Global","$55b3c5c261aa2a00$var$localStorage","localStorage","$55b3c5c261aa2a00$var$read","key","getItem","module","exports","name","read","write","data","setItem","each","fn","remove","removeItem","clearAll","clear","$b63e377f8a561b77$var$assign","$b63e377f8a561b77$var$make_assign","$b63e377f8a561b77$var$create","$b63e377f8a561b77$var$make_create","$b63e377f8a561b77$var$trim","$b63e377f8a561b77$var$make_trim","$b63e377f8a561b77$var$Global","window","$parcel$global","assign","obj","props1","props2","etc","arguments","$b63e377f8a561b77$var$each","val","create","assignProps1","assignProps2","assignArgsList","$b63e377f8a561b77$var$slice","apply","this","concat","F","prototype","String","trim","str","call","replace","$b63e377f8a561b77$var$bind","Array","slice","arr","index","$b63e377f8a561b77$var$pluck","$b63e377f8a561b77$var$map","res","$b63e377f8a561b77$var$isList","v","k","hasOwnProperty","$b63e377f8a561b77$var$isFunction","toString","$b63e377f8a561b77$var$isObject","bind","map","pluck","isList","isFunction","isObject","$9a27346c17ebc997$var$Global","$9a27346c17ebc997$var$globalStorage","$9a27346c17ebc997$var$each","_","globalStorage","$aa4a0f0382525b09$var$Global","unfixedKey","$aa4a0f0382525b09$var$disable","fixedKey","$aa4a0f0382525b09$var$fixKey","$aa4a0f0382525b09$var$_withStorageEl","storageEl","setAttribute","save","$aa4a0f0382525b09$var$storageName","getAttribute","callback","attributes","XMLDocument","documentElement","attr","removeAttribute","load","$aa4a0f0382525b09$var$doc","document","addBehavior","storageOwner","storageContainer","ActiveXObject","open","close","w","frames","createElement","e","body","storeFunction","args","unshift","appendChild","removeChild","$aa4a0f0382525b09$var$_makeIEStorageElFunction","navigator","userAgent","match","$aa4a0f0382525b09$var$forbiddenCharsRegex","RegExp","$ca53a254bb96ef40$var$Global","$ca53a254bb96ef40$var$trim","$ca53a254bb96ef40$var$_has","regexpStr","escape","unescape","$ca53a254bb96ef40$var$doc","cookie","$ca53a254bb96ef40$var$each","$ca53a254bb96ef40$var$remove","cookies","split","kvp","test","$46abab686a422357$var$Global","$46abab686a422357$var$sessionStorage","sessionStorage","$46abab686a422357$var$read","$d3df9a3b32b1c1df$var$memoryStorage","parcelRequire","JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","f","n","this_value","valueOf","quote","string","lastIndex","a","c","charCodeAt","holder","partial","mind","value","toJSON","isFinite","join","push","Date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","stringify","replacer","space","parse","text","reviver","j","walk","undefined","eval","SyntaxError","register","factory","self","__webpack_require__","entryUnbind","path","global","isCallable","tryToString","TypeError","argument","toIndexedObject","toAbsoluteIndex","lengthOfArrayLike","createMethod","IS_INCLUDES","$this","el","fromIndex","O","includes","indexOf","fails","METHOD_NAME","method","createProperty","max","Math","start","end","fin","result","arraySlice","floor","mergeSort","array","comparefn","middle","insertionSort","merge","element","left","right","llength","rlength","lindex","rindex","uncurryThis","stringSlice","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","tag","error","tryGet","callee","hasOwn","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","exceptions","defineProperty","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","toPropertyKey","propertyKey","get","EXISTS","firefox","UA","getBuiltIn","version","process","Deno","versions","v8","webkit","CONSTRUCTOR","METHOD","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","NATIVE_BIND","Function","FunctionPrototype","getDescriptor","PROPER","CONFIGURABLE","aFunction","namespace","aCallable","V","P","func","check","globalThis","g","toObject","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","has","NATIVE_WEAK_MAP","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","normalize","POLYFILL","NATIVE","toLowerCase","isPrototypeOf","USE_SYMBOL_AS_UID","$Symbol","toLength","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","V8_PROTOTYPE_DEFINE_BUG","anObject","$defineProperty","$getOwnPropertyDescriptor","ENUMERABLE","WRITABLE","Attributes","current","propertyIsEnumerableModule","internalObjectKeys","getOwnPropertyNames","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","uid","SHARED","IS_PURE","mode","copyright","license","toIntegerOrInfinity","min","integer","IndexedObject","requireObjectCoercible","ceil","number","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","symbolFor","createWellKnownSymbol","withoutSetter","description","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","un$Sort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","b","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","sources","mappings","sourcesContent","sourceRoot","__WEBPACK_DEFAULT_EXPORT__","cssWithMappingToString","list","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_k","cssMapping","btoa","base64","encodeURIComponent","sourceMapping","sourceURLs","__webpack_module_cache__","__webpack_require__1","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","definition","o","prop","r","toStringTag","Experiments1","Legacy1","Legacy","LogLevel1","LogLevel","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","createId","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","len","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","property","DecoratedClass","super","Vector","_x","_y","Zero","One","Half","Up","Down","Left","Right","angle","cos","sin","vec","isNaN","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","__decorate","Side1","Side","Color","parseInt","parseFloat","hex","h","s","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","Color_decorate","p","q","t","hue2rgb","getOpposite","side","Top","Bottom","None","fromDirection","direction","directions","directionEnum","MAX_VALUE","maxIndex","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","matFirstColumn","xa","xb","matSecondColumn","ya","yb","matrixPos","getPosition","topLeft","bottomRight","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","contains","combine","other","dimensions","overlaps","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","now","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","sign","clamp","canonicalizeAngle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","randomInRange","randomIntInRange","round","Util_TwoPI","Util_clamp","Util_randomInRange","Util_randomIntInRange","Util_canonicalizeAngle","Util_toDegrees","Util_toRadians","Util_range","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","internalSize","elementAt","insert","removed","removeElement","toArray","forEach","fail","delay1","milliseconds","clock","schedule","setTimeout","MatrixLocations1","MatrixLocations","ImageFiltering1","ImageFiltering","EventTypes1","EventTypes","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","toDOMMatrix","DOMMatrix","reset","identity","sx","sy","angleRadians","vectorOrMatrix","dest","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","restore","StateStack","_states","_currentState","_getDefaultState","_cloneState","watch","change","__isProxy","Proxy","watchAny","Graphic","_ID","_transformStale","showDebug","_flipHorizontal","_flipVertical","_rotation","_scale","_origin","_width","_height","origin","flipHorizontal","flipVertical","rotation","_d","_e","isStale","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","isPowerOfTwo","nextHighestPowerOfTwo","ensurePowerOfTwo","getGlTypeSizeBytes","gl","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","UNSIGNED_BYTE","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","getAttributePointerType","TextureLoader","context","_GL","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","image","_TEXTURE_MAP","filtering","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","Pixel","NEAREST","LINEAR","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","originalSrc","dataset","_LOGGER","Blended","Map","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","_g","bitmapHeight","_h","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","setLineDash","getLineDash","_options","cache","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","emit","eventName","event","on","off","eventHandlers","once","ev","wire","eventDispatcher","unwire","Resource","responseType","bustCache","logger","events","isLoaded","_cacheBust","uri","request","XMLHttpRequest","addEventListener","status","response","statusText","send","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","SpriteEffects_decorate","Invert","Opacity","Colorize","Lighten","fromRGB","Darken","Saturate","Desaturate","Fill","Texture","_sprite","loaded","_loadedResolve","_resource","Sprite_Sprite","async","url","blob","URL","createObjectURL","Image","src","decode","naturalWidth","naturalHeight","asSprite","Configurable","base","props","filter","SpriteImpl","imageOrConfig","offset","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","texture","_initPixelsFromTexture","drawWidth","drawHeight","_loadPixels","_flushTexture","grayscale","addEffect","fill","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","xpoint","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","_j","anchorX","anchorY","oldAlpha","globalAlpha","Sprite_decorate","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","_logger","_filtering","endsWith","_src","toSprite","unload","AnimationImpl","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","Engine","config","_engine","_setAnchor","_setRotation","_setScale","isDone","tick","elapsed","idempotencyToken","_updateValues","skip","animOptions","currSprite","play","playAnimation","Animation_Animation","images","FontUnit1","FontUnit","TextAlign1","TextAlign","BaseAlign1","BaseAlign","FontStyle1","FontStyle","Direction1","Direction","Animation_decorate","SpriteSheet_SpriteSheet","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteFont","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","setTextShadow","offsetX","offsetY","shadowColor","character","useTextShadow","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet_decorate","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","SpriteFont_SpriteFont","_text","shadow","_alreadyWarnedAlphabet","_alreadyWarnedSpriteSheet","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","measureText","lines","maxWidthLine","reduce","xCursor","yCursor","line","render","bounds","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","RenderSource","_gl","_texture","use","activeTexture","TEXTURE0","disable","RenderTarget","_setupFramebuffer","setResolution","_frameTexture","frameBuffer","_frameBuffer","frameTexture","attachmentPoint","COLOR_ATTACHMENT0","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","toRenderSource","viewport","ExcaliburWebGLContextAccessor","Shader","uniforms","_compiled","vertexSource","fragmentSource","compiled","useProgram","program","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","setUniformIntArray","setUniformBoolean","setUniformFloat","setUniformFloatArray","setUniformFloatVector","setUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","upload","STATIC_DRAW","DYNAMIC_DRAW","VertexLayout","_layout","_attributes","_vertexTotalSizeBytes","vertexBuffer","_vertexBuffer","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","uploadBuffer","vert","vertexAttribPointer","enableVertexAttribArray","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_context","ortho","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","finalPoint","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","getExtension","Uint32Array","maxUint16","maxUint16Index","bufferGlType","Uint16Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","MAX_TEXTURE_IMAGE_UNITS","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","_bindTextures","_getTextureIdForImage","swidth","sheight","dx","dy","dwidth","dheight","view","sw","sh","snapToPixel","topRight","bottomLeft","textureId","potWidth","potHeight","uvx0","uvy0","uvx1","uvy1","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","drawPoint","pointOptions","drawText","ExcaliburGraphicsContextWebGL","_renderers","_isDrawLifecycle","_postProcessTargets","_postprocessors","_transform","_state","backgroundColor","_alreadyWarnedDrawLifecycle","canvasElement","enableTransparency","__gl","antialias","premultipliedAlpha","alpha","depth","powerPreference","_init","canvas","_ortho","checkIfResolutionSupported","dim","supported","clearColor","COLOR_BUFFER_BIT","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","_screenRenderer","_renderTarget","__ctx","renderer","rendererName","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","resetTransform","updateViewport","resolution","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","values","DisplayMode1","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","_displayMode","displayMode","Fixed","graphicsContext","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","dispose","_resizeObserver","disconnect","removeEventListener","isHiDpi","FillContainer","FitContainer","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","imageRendering","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","inverse","worldToScreenCoordinates","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","halfDrawWidth","halfDrawHeight","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","Position","_initializeDisplayModePosition","Window","ResizeObserver","observe","FillScreen","FitScreen","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line1","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","point1","arc","vector1","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle1","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","Loader_0","Z","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","_isLoadedPromise","_isLoadedResolve","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","addResource","loadable","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","_a1","update","_delta","areResourcesLoaded","all","finally","showPlayButton","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","arraybuffer","dataurl","objecturl","rgba","getGamepads","failedCritical","warning","CollisionType1","CollisionType","CollisionResolutionStrategy1","CollisionResolutionStrategy","BroadphaseStrategy1","BroadphaseStrategy","Integrator1","Integrator","CoordPlane1","CoordPlane","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","Physics_decorate","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","Component","owner","newComponent","TagComponent","Observable","observers","subscriptions","observer","subscribe","unregister","unsubscribe","notifyAll","notify","cb","TransformComponent","X","Y","createPosView","posChanged$","createScaleView","coordPlane","World","zIndexChanged$","_z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","z","oldPos","oldX","oldY","parentTransform","oldz","globalScaleX","globalScaleY","applyInverse","MotionComponent","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_name","_category","_mask","canCollide","collisionGroups","combinedName","combinedCategory","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","group","collisionType","PreventCollision","active","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","worldBounds","root","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","u","getLength","intersectPoint","time","getPoint","DynamicTreeCollisionProcessor","_dynamicCollisionTree","_pairs","Set","_collisionPairCache","_colliders","getColliders","track","CompositeCollider","colliders","untrack","_pairExists","hash","broadphase","targets","seconds","potentialColliders","pair","physics","collider1","Active","updateDistance","minDimension","fastBodies","updateVec","centerPoint","furthestPoint","getFurthestPoint","minCollider","minTranslate","hitPoint","isValid","shift","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","touching","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","maxDistance","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","minPoint","minDistance","project","projs","proj","newProjection","Line","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","PolygonCircleClosestLine","circle","circlex","circley","CircleCircleClosestLine","circleA","circleB","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","CircleCollider","_naturalRadius","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","newPos","CollisionContact","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","SeparatingAxis","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","circleAPos","circleBPos","combinedRadius","mvt","local","findCirclePolygonSeparation","samedir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clipLeft","xf","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","_isClockwiseWinding","reverse","isConvex","_calculateTransformation","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","entries","tessellate","polygons","Shape","Polygon","triangulate","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","triangles","vertices","va","vb","vc","leftArm","isEar","vertIndex","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Circle","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom1","DegreeOfFreedom","RotationType1","RotationType","dependencies","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","inverseInertia","motion","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","OffscreenCulling","cullingBox","actorBoundsOffscreen","currentScene","isOffScreen","removeComponent","addComponent","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","Entity","components","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","component","kill","isKilled","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","getComponents","_notifyAddComponent","added","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","child","addTemplate","templateEntity","ctor","constuctorType","componentOrType","_removeComponentByType","delete","processComponentRemoval","isInitialized","_initialize","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","hasGraphicsTick","graphic","GraphicsLayer","_graphics","graphics","hide","nameOrGraphic","gfx","getGraphic","recalculateBounds","show","copyGraphics","getNames","order","currentKeys","GraphicsLayers","_component","_layers","_layerMap","default","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_localBounds","onPreDraw","onPostDraw","layers","graphicToSet","Rectangle","_radius","PointerComponent","useColliderShape","useGraphicsBounds","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","EasingFunctions_decorate","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","isComplete","elapsedMs","Repeat","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","MoveTo","destx","desty","RotateTo","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_method","_hasBeenCalled","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","Fade","endOpacity","_multiplier","_endOpacity","Delay","delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","_queue","easeTo","xOrPos","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","toPromise","Font","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textToBitmap","_bitmapUsage","_o","_p","_q","_r","blur","fontString","_ex","_getTextBitmap","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","_setDimension","textBounds","_getRasterPropertiesHash","textBaseline","font","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","colorOverride","lineHeight","strokeText","textAndHash","clearCache","checkAndClearCache","isNewBitmap","rasterWidth","rasterHeight","performance","cacheSize","Text","_textWidth","_textHeight","_font","_calculateDimension","Actor","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","_pointerDragLeaveHandler","traits","collisionGroup","defaults","Passive","pointer","actions","thePos","theVel","theAcc","theAngle","isVisible","draggable","isDraggable","currentGraphic","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","Actor_decorate","ScreenElement_ScreenElement","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","_MAX_ID","_callbacks","complete","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Timer_decorate","DebugGraphicsComponent","useTransform","Axis1","Axis","TileMap","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","tiles","_cols","_collidersDirty","_originalOffsets","_composite","flagCollidersDirty","tileWidth","tileHeight","currentCol","cd","Tile","registerSpriteSheet","fromLegacySpriteSheet","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","tile","solid","prev","getTileByIndex","getTile","getTileByPoint","getRows","getColumns","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","getGraphics","grayish","TileMap_decorate","_posDirty","_solid","_pos","addGraphic","removeGraphic","clearGraphics","_bounds","pushSprite","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","target1","_cam","_eng","target2","cam","currentFocus","getFocus","target3","focus","cameraVel","stretch","target4","target5","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","dz","az","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","cameraPos","isScreenElement","triggerDefaults","Trigger_Trigger","opts","_dispatchAction","_target","wp","SystemType1","SystemType","System","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","EntityManager","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","removeEntity","findEntitiesForRemoval","queryManager","addEntity","idOrEntity","deferred","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","buildTypeKey","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","QueryManager","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","maybeExistingQuery","getQuery","SystemManager","systems","initialized","systemType","find","addSystem","system","removeSystem","updateSystems","s3","preupdate","s1","Scene","s2","postupdate","systemManager","Update","entityOrSystem","clearEntities","clearSystems","EulerIntegrator","totalAcc","MotionSystem","optionalBody","integrate","CollisionSolver","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contact1","contactPoints","pointIndex","contact2","constraints","maxCorrection","steeringForce","restitution","impulseDelta","maxFriction","newImpulse","point2","CollisionSystem","_realisticSolver","_arcadeSolver","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","colliderComponent","colliderComp","getSolver","runContactStartEnd","id1","c1","AnimationDirection1","AnimationDirection","AnimationStrategy1","AnimationStrategy","EmitterType1","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","maybeFrame","frameIndices","durationPerFrameMs","invalidIndices","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","done","frameNumber","_nextFrame","PingPong","elapsedMilliseconds","GraphicsGroup","members","_updateDimensions","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","isOffscreen","ParticleEmitter","tmpColor","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","emitParticles","particleCount","_createParticle","world","clearParticles","ranX","ranY","GraphicsSystem","Draw","_sortedTransforms","_zHasChanged","_zIndexUpdate","sortedTransforms","_graphicsContext","entityAddedOrRemoved","_applyTransform","particleOpacity","_drawGraphicsComponent","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","CanvasDrawingSystem","canvasdraw","_clearScreen","offscreen","_pushCameraTransform","_popCameraTransform","drawnImages","drawCalls","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","showAll","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","collider2","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","point3","collisionNormalColor","showFocus","focusColor","showZoom","PointerSystem","overrideUseColliderShape","overrideUseGraphicsBounds","lastFrameEntityToPointers","currentFrameEntityToPointers","_sortedEntities","_receiver","pointers","entityCurrentlyUnderPointer","pointerId","entityWasUnderPointer","entered","addPointerToEntity","_processPointerToEntity","_dispatchEvents","currentFramePointerCoords","screenPos","graphicBounds","_processDownAndEmit","lastDownPerPointer","currentFrameDown","isDragStart","_processUpAndEmit","lastUpPerPointer","currentFrameUp","isDragEnd","_processMoveAndEmit","lastMovePerPointer","currentFrameMove","isDragging","_processEnterLeaveAndEmit","lastUpDownMoveEvents","_processCancelAndEmit","currentFrameCancel","_processWheelAndEmit","currentFrameWheel","lastFrameEntities","currentFrameEntities","entitiesWithEvents","ActionsSystem","IsometricEntityComponent","elevation","IsometricEntitySystem","iso","OffscreenSystem","entityOffscreen","_isOffscreen","transformedBounds","ColorBlindnessMode1","ColorBlindnessMode","PointerScope1","PointerScope","Keys1","Keys","Buttons1","Buttons","Axes1","Axes","WheelDeltaMode1","WheelDeltaMode","NativePointerButton1","NativePointerButton","PointerButton1","PointerButton","PointerType1","PointerType","_timers","_cancelQueue","triggers","tileMaps","screenElements","timers","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","addTimer","addScreenElement","removeScreenElement","addTileMap","tileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","ui","alive","Scene_decorate","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","FrameStats","prevFrame","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","otherStats","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_handleKeyDown","keyEvent","_handleKeyUp","init","noop","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","KeyboardEvent","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","at","timestamp","bi","ai","navigatorGamepad","getButton","pressed","updateButton","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","clonedPad","MinAxisMoveThreshold","_buttons","i1","isButtonPressed","buttonIndex","axesIndex","BrowserComponent","_paused","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","ExcaliburGraphicsContext2DCanvasDebug","ExcaliburGraphicsContext2DCanvas","setTransform","_postprocessor","GlobalCoordinates","pagePos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","pointerType","coordinates","nativeEvent","WheelEvent","screenX","screenY","deltaX","deltaY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","isDown","wasDown","event1","event2","event3","event4","native","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode1","onmousewheel","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","TouchEvent","Unknown","Touch","changedTouches","touch","fromPagePosition","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","transformEntities","NoButton","Pen","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","scheduledTime","_runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","step","run","numberOfSteps","ScrollPreventionMode","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","_timescale","_deferredGoTo","_loadingComplete","_isReady","_isReadyPromise","_isReadyResolve","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","freeze","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","ex2dCtx","exWebglCtx","suppressHiDPIScaling","_mainloop","_loader","rootScene","addScene","___EXCALIBUR_DEVTOOL","isFullscreen","shouldSnapToPixel","timescale","AnimationNode","removeScene","goToScene","scrollPreventionMode","pointerTarget","pointerScope","Document","hidden","visibilityChange","keyboard","_overrideInitialize","_update","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","loader","frameId","beforeUpdate","afterUpdate","afterDraw","game","raf","lastTime","isPaused","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Engine_decorate","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","Label_Label","newFont","isBold","fontFamily","sizeInUnit","fontStyle","fontUnit","align","_legacySpriteFont","sf","fromLegacySpriteFont","getTextWidth","clearTextShadow","exctx","Label_decorate","IsometricTile","graphicsOffset","_tileBounds","_isometricEntityComponent","halfTileWidth","halfTileHeight","xPos","yPos","_gfx","totalWidth","totalHeight","renderFromTopOfGraphic","_recalculateBounds","tileToWorld","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","CollisionGroupManager","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","filled","_points","fillColor","lineColor","Polygon_decorate","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","any","json","WebAudioInstance","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","Sound","paths","_isStopped","_tracks","_wasPlayingOnHidden","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","resumed","_getTrackInstance","newTrack","Gif","_stream","_gif","_animation","_transparentColor","Stream","ParseGif","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","readUnsigned","Uint8Array","stream","_st","_handler","globalColorTable","parseColorTable","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block1","parseGCExt","block","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","block2","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","output","clearCode","eoiCode","codeSize","dict","code1","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","fromRow1","pass","toRow1","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","Polygon_Polygon","SortedList","getComparable","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","SortedList_decorate","_data","_left","_right","MockedElement","getTheKey","Pool","builder","recycler","maxObjects","totalAllocations","objects","using","borrow","poolIndex","PromiseState1","PromiseState","Promises_Promise","Promise_1","Pending","_successCallbacks","_rejectCallback","promises","isArray","_i","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback","Promises_decorate","$e06dc7d24ca8b574$exports","$b56da5de5b72d494$var$slice","$b56da5de5b72d494$var$pluck","$b56da5de5b72d494$var$each","$b56da5de5b72d494$var$bind","$b56da5de5b72d494$var$create","$b56da5de5b72d494$var$isList","$b56da5de5b72d494$var$isFunction","$b56da5de5b72d494$var$isObject","$b56da5de5b72d494$exports","createStore","$b56da5de5b72d494$var$createStore","$b56da5de5b72d494$var$storeAPI","optionalDefaultValue","storage","_namespacePrefix","_deserialize","_serialize","namespacedKey","_namespaceRegexp","hasNamespace","addPlugin","plugin","_addPlugin","plugins","$b56da5de5b72d494$var$_warn","_console","storages","namespacePrefix","namespaceRegexp","_privateStoreProps","_testStorage","testStr","ok","_assignPluginFnProp","pluginFnProp","propName","oldFn","super_fn","arg","newFnArgs","strVal","defaultVal","_addStorage","plugin1","seenPlugin","pluginProperties","addStorage","$f590d80a5de1f4a7$exports","$1b5031d44df7baeb$var$plugins","$1b5031d44df7baeb$exports","$3d149cbfd3136500$export$6b7b6cff4ccb438b","muteBackgroundMusic","muteAll","$3d149cbfd3136500$var$_origPreferences","$3d149cbfd3136500$export$de31a87075fdbfcc","$3d149cbfd3136500$export$f1786e2fa4419c16","$parcel$interopDefault","$3d149cbfd3136500$export$add4fa36ca2fc569","$73991847afc42666$exports","import","$b6db5538437aa8f6$exports","$7c4c300842bd4cf2$export$e9a269813a6315a4","Sword","Clank","$9d936a2aecb96285$export$2e2bcd8739ae039","DebugMenuEnabled","SoundVolume","Seed","$84ab826914df134a$export$ca664994d1d54bff","classNames","classes","argType","inner","$60313e3b9e75c852$exports","define","amd","$613a632b39062363$export$a62869ddf53aa3e3","setSoundSpecificVolume","unmuteBackgroundMusic","unmuteAll","snd","_updateMuteAllButton","_updateMusicButton","className","$ad2bcec7a0192558$export$985739bfa5723e08","startLevel","resource","$ad2bcec7a0192558$export$119d2a93e2780362"],"version":3,"file":"index.9328a0da.js.map"}