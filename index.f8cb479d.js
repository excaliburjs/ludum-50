function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},n={},r=i.parcelRequire957c;null==r&&((r=function(t){if(t in s)return s[t].exports;if(t in n){var e=n[t];delete n[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){n[t]=e},i.parcelRequire957c=r),r.register("27Lyk",(function(e,i){var s,n;t(e.exports,"register",(()=>s),(t=>s=t)),t(e.exports,"resolve",(()=>n),(t=>n=t));var r={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)r[e[i]]=t[e[i]]},n=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),r.register("1b2ls",(function(e,i){var s,n,o;t(e.exports,"Fragment",(()=>s),(t=>s=t)),t(e.exports,"jsx",(()=>n),(t=>n=t)),t(e.exports,"jsxs",(()=>o),(t=>o=t));var a=r("acw62"),l=Symbol.for("react.element"),h=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,u=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(t,e,i){var s,n={},r=null,o=null;for(s in void 0!==i&&(r=""+i),void 0!==e.key&&(r=""+e.key),void 0!==e.ref&&(o=e.ref),e)c.call(e,s)&&!d.hasOwnProperty(s)&&(n[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps)void 0===n[s]&&(n[s]=e[s]);return{$$typeof:l,type:t,key:r,ref:o,props:n,_owner:u.current}}s=h,n=p,o=p})),r.register("acw62",(function(t,e){t.exports=r("2pUnB")})),r.register("2pUnB",(function(e,i){var s,n,r,o,a,l,h,c,u,d,p,f,g,m,_,y,v,w,x,b,S,C,T,E,P,A,k,R,I,F,D,M,B,L,z;t(e.exports,"Children",(()=>s),(t=>s=t)),t(e.exports,"Component",(()=>n),(t=>n=t)),t(e.exports,"Fragment",(()=>r),(t=>r=t)),t(e.exports,"Profiler",(()=>o),(t=>o=t)),t(e.exports,"PureComponent",(()=>a),(t=>a=t)),t(e.exports,"StrictMode",(()=>l),(t=>l=t)),t(e.exports,"Suspense",(()=>h),(t=>h=t)),t(e.exports,"__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED",(()=>c),(t=>c=t)),t(e.exports,"cloneElement",(()=>u),(t=>u=t)),t(e.exports,"createContext",(()=>d),(t=>d=t)),t(e.exports,"createElement",(()=>p),(t=>p=t)),t(e.exports,"createFactory",(()=>f),(t=>f=t)),t(e.exports,"createRef",(()=>g),(t=>g=t)),t(e.exports,"forwardRef",(()=>m),(t=>m=t)),t(e.exports,"isValidElement",(()=>_),(t=>_=t)),t(e.exports,"lazy",(()=>y),(t=>y=t)),t(e.exports,"memo",(()=>v),(t=>v=t)),t(e.exports,"startTransition",(()=>w),(t=>w=t)),t(e.exports,"unstable_act",(()=>x),(t=>x=t)),t(e.exports,"useCallback",(()=>b),(t=>b=t)),t(e.exports,"useContext",(()=>S),(t=>S=t)),t(e.exports,"useDebugValue",(()=>C),(t=>C=t)),t(e.exports,"useDeferredValue",(()=>T),(t=>T=t)),t(e.exports,"useEffect",(()=>E),(t=>E=t)),t(e.exports,"useId",(()=>P),(t=>P=t)),t(e.exports,"useImperativeHandle",(()=>A),(t=>A=t)),t(e.exports,"useInsertionEffect",(()=>k),(t=>k=t)),t(e.exports,"useLayoutEffect",(()=>R),(t=>R=t)),t(e.exports,"useMemo",(()=>I),(t=>I=t)),t(e.exports,"useReducer",(()=>F),(t=>F=t)),t(e.exports,"useRef",(()=>D),(t=>D=t)),t(e.exports,"useState",(()=>M),(t=>M=t)),t(e.exports,"useSyncExternalStore",(()=>B),(t=>B=t)),t(e.exports,"useTransition",(()=>L),(t=>L=t)),t(e.exports,"version",(()=>z),(t=>z=t));var O=Symbol.for("react.element"),N=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),G=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),q=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),Y=Symbol.iterator;var Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$=Object.assign,Z={};function J(t,e,i){this.props=t,this.context=e,this.refs=Z,this.updater=i||Q}function tt(){}function et(t,e,i){this.props=t,this.context=e,this.refs=Z,this.updater=i||Q}J.prototype.isReactComponent={},J.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},J.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},tt.prototype=J.prototype;var it=et.prototype=new tt;it.constructor=et,$(it,J.prototype),it.isPureReactComponent=!0;var st=Array.isArray,nt=Object.prototype.hasOwnProperty,rt={current:null},ot={key:!0,ref:!0,__self:!0,__source:!0};function at(t,e,i){var s,n={},r=null,o=null;if(null!=e)for(s in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(r=""+e.key),e)nt.call(e,s)&&!ot.hasOwnProperty(s)&&(n[s]=e[s]);var a=arguments.length-2;if(1===a)n.children=i;else if(1<a){for(var l=Array(a),h=0;h<a;h++)l[h]=arguments[h+2];n.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps)void 0===n[s]&&(n[s]=a[s]);return{$$typeof:O,type:t,key:r,ref:o,props:n,_owner:rt.current}}function lt(t){return"object"==typeof t&&null!==t&&t.$$typeof===O}var ht=/\/+/g;function ct(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function ut(t,e,i,s,n){var r=typeof t;"undefined"!==r&&"boolean"!==r||(t=null);var o,a=!1;if(null===t)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case O:case N:a=!0}}if(a)return n=n(a=t),t=""===s?"."+ct(a,0):s,st(n)?(i="",null!=t&&(i=t.replace(ht,"$&/")+"/"),ut(n,e,i,"",(function(t){return t}))):null!=n&&(lt(n)&&(n=function(t,e){return{$$typeof:O,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(ht,"$&/")+"/")+t)),e.push(n)),1;if(a=0,s=""===s?".":s+":",st(t))for(var l=0;l<t.length;l++){var h=s+ct(r=t[l],l);a+=ut(r,e,i,h,n)}else if("function"==typeof(h=null===(o=t)||"object"!=typeof o?null:"function"==typeof(o=Y&&o[Y]||o["@@iterator"])?o:null))for(t=h.call(t),l=0;!(r=t.next()).done;)a+=ut(r=r.value,e,i,h=s+ct(r,l++),n);else if("object"===r)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function dt(t,e,i){if(null==t)return t;var s=[],n=0;return ut(t,s,"","",(function(t){return e.call(i,t,n++)})),s}function pt(t){if(-1===t._status){var e=t._result;(e=e()).then((function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)}),(function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)})),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var ft={current:null},gt={transition:null};s={map:dt,forEach:function(t,e,i){dt(t,(function(){e.apply(this,arguments)}),i)},count:function(t){var e=0;return dt(t,(function(){e++})),e},toArray:function(t){return dt(t,(function(t){return t}))||[]},only:function(t){if(!lt(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},n=J,r=H,o=W,a=et,l=U,h=X,c={ReactCurrentDispatcher:ft,ReactCurrentBatchConfig:gt,ReactCurrentOwner:rt},u=function(t,e,i){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=$({},t.props),n=t.key,r=t.ref,o=t._owner;if(null!=e){if(void 0!==e.ref&&(r=e.ref,o=rt.current),void 0!==e.key&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)nt.call(e,l)&&!ot.hasOwnProperty(l)&&(s[l]=void 0===e[l]&&void 0!==a?a[l]:e[l])}var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){a=Array(l);for(var h=0;h<l;h++)a[h]=arguments[h+2];s.children=a}return{$$typeof:O,type:t.type,key:n,ref:r,props:s,_owner:o}},d=function(t){return(t={$$typeof:G,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:V,_context:t},t.Consumer=t},p=at,f=function(t){var e=at.bind(null,t);return e.type=t,e},g=function(){return{current:null}},m=function(t){return{$$typeof:j,render:t}},_=lt,y=function(t){return{$$typeof:K,_payload:{_status:-1,_result:t},_init:pt}},v=function(t,e){return{$$typeof:q,type:t,compare:void 0===e?null:e}},w=function(t){var e=gt.transition;gt.transition={};try{t()}finally{gt.transition=e}},x=function(){throw Error("act(...) is not supported in production builds of React.")},b=function(t,e){return ft.current.useCallback(t,e)},S=function(t){return ft.current.useContext(t)},C=function(){},T=function(t){return ft.current.useDeferredValue(t)},E=function(t,e){return ft.current.useEffect(t,e)},P=function(){return ft.current.useId()},A=function(t,e,i){return ft.current.useImperativeHandle(t,e,i)},k=function(t,e){return ft.current.useInsertionEffect(t,e)},R=function(t,e){return ft.current.useLayoutEffect(t,e)},I=function(t,e){return ft.current.useMemo(t,e)},F=function(t,e,i){return ft.current.useReducer(t,e,i)},D=function(t){return ft.current.useRef(t)},M=function(t){return ft.current.useState(t)},B=function(t,e,i){return ft.current.useSyncExternalStore(t,e,i)},L=function(){return ft.current.useTransition()},z="18.0.0-fc46dba67-20220329"})),r.register("Xw6Mv",(function(e,i){var s,n,o,a,l,h,c,u,d,p,f,g;t(e.exports,"__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED",(()=>s),(t=>s=t)),t(e.exports,"createPortal",(()=>n),(t=>n=t)),t(e.exports,"createRoot",(()=>o),(t=>o=t)),t(e.exports,"findDOMNode",(()=>a),(t=>a=t)),t(e.exports,"flushSync",(()=>l),(t=>l=t)),t(e.exports,"hydrate",(()=>h),(t=>h=t)),t(e.exports,"hydrateRoot",(()=>c),(t=>c=t)),t(e.exports,"render",(()=>u),(t=>u=t)),t(e.exports,"unmountComponentAtNode",(()=>d),(t=>d=t)),t(e.exports,"unstable_batchedUpdates",(()=>p),(t=>p=t)),t(e.exports,"unstable_renderSubtreeIntoContainer",(()=>f),(t=>f=t)),t(e.exports,"version",(()=>g),(t=>g=t));var m=r("acw62"),_=r("fO90s");function y(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v=new Set,w={};function x(t,e){b(t,e),b(t+"Capture",e)}function b(t,e){for(w[t]=e,t=0;t<e.length;t++)v.add(e[t])}var S=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),C=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,E={},P={};function A(t,e,i,s,n,r,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=s,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var k={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){k[t]=new A(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];k[e]=new A(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){k[t]=new A(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){k[t]=new A(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){k[t]=new A(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){k[t]=new A(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){k[t]=new A(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){k[t]=new A(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){k[t]=new A(t,5,!1,t.toLowerCase(),null,!1,!1)}));var R=/[\-:]([a-z])/g;function I(t){return t[1].toUpperCase()}function F(t,e,i,s){var n=k.hasOwnProperty(e)?k[e]:null;(null!==n?0!==n.type:s||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,i,s){if(null==e||function(t,e,i,s){if(null!==i&&0===i.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!s&&(null!==i?!i.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,i,s))return!0;if(s)return!1;if(null!==i)switch(i.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,i,n,s)&&(i=null),s||null===n?function(t){return!!C.call(P,t)||!C.call(E,t)&&(T.test(t)?P[t]=!0:(E[t]=!0,!1))}(e)&&(null===i?t.removeAttribute(e):t.setAttribute(e,""+i)):n.mustUseProperty?t[n.propertyName]=null===i?3!==n.type&&"":i:(e=n.attributeName,s=n.attributeNamespace,null===i?t.removeAttribute(e):(i=3===(n=n.type)||4===n&&!0===i?"":""+i,s?t.setAttributeNS(s,e,i):t.setAttribute(e,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(R,I);k[e]=new A(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(R,I);k[e]=new A(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(R,I);k[e]=new A(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){k[t]=new A(t,1,!1,t.toLowerCase(),null,!1,!1)})),k.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){k[t]=new A(t,1,!1,t.toLowerCase(),null,!0,!0)}));var D=m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),B=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),H=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),j=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var X=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var q=Symbol.iterator;function K(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=q&&t[q]||t["@@iterator"])?t:null}var Y,Q=Object.assign;function $(t){if(void 0===Y)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Y=e&&e[1]||""}return"\n"+Y+t}var Z=!1;function J(t,e){if(!t||Z)return"";Z=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(t){var s=t}Reflect.construct(t,[],e)}else{try{e.call()}catch(t){s=t}t.call(e.prototype)}else{try{throw Error()}catch(t){s=t}t()}}catch(e){if(e&&s&&"string"==typeof e.stack){for(var n=e.stack.split("\n"),r=s.stack.split("\n"),o=n.length-1,a=r.length-1;1<=o&&0<=a&&n[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==r[a]){if(1!==o||1!==a)do{if(o--,0>--a||n[o]!==r[a]){var l="\n"+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=a);break}}}finally{Z=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?$(t):""}function tt(t){switch(t.tag){case 5:return $(t.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return t=J(t.type,!1);case 11:return t=J(t.type.render,!1);case 1:return t=J(t.type,!0);default:return""}}function et(t){if(null==t)return null;if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case L:return"Fragment";case B:return"Portal";case O:return"Profiler";case z:return"StrictMode";case W:return"Suspense";case V:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case H:return(t.displayName||"Context")+".Consumer";case N:return(t._context.displayName||"Context")+".Provider";case U:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case G:return null!==(e=t.displayName||null)?e:et(t.type)||"Memo";case j:e=t._payload,t=t._init;try{return et(t(e))}catch(t){}}return null}function it(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(e);case 8:return e===z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e}return null}function st(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function nt(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function rt(t){t._valueTracker||(t._valueTracker=function(t){var e=nt(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var n=i.get,r=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(t){s=""+t,r.call(this,t)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return s},setValue:function(t){s=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function ot(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),s="";return t&&(s=nt(t)?t.checked?"true":"false":t.value),(t=s)!==i&&(e.setValue(t),!0)}function at(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function lt(t,e){var i=e.checked;return Q({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:t._wrapperState.initialChecked})}function ht(t,e){var i=null==e.defaultValue?"":e.defaultValue,s=null!=e.checked?e.checked:e.defaultChecked;i=st(null!=e.value?e.value:i),t._wrapperState={initialChecked:s,initialValue:i,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function ct(t,e){null!=(e=e.checked)&&F(t,"checked",e,!1)}function ut(t,e){ct(t,e);var i=st(e.value),s=e.type;if(null!=i)"number"===s?(0===i&&""===t.value||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if("submit"===s||"reset"===s)return void t.removeAttribute("value");e.hasOwnProperty("value")?pt(t,e.type,i):e.hasOwnProperty("defaultValue")&&pt(t,e.type,st(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function dt(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!("submit"!==s&&"reset"!==s||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}""!==(i=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==i&&(t.name=i)}function pt(t,e,i){"number"===e&&at(t.ownerDocument)===t||(null==i?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var ft=Array.isArray;function gt(t,e,i,s){if(t=t.options,e){e={};for(var n=0;n<i.length;n++)e["$"+i[n]]=!0;for(i=0;i<t.length;i++)n=e.hasOwnProperty("$"+t[i].value),t[i].selected!==n&&(t[i].selected=n),n&&s&&(t[i].defaultSelected=!0)}else{for(i=""+st(i),e=null,n=0;n<t.length;n++){if(t[n].value===i)return t[n].selected=!0,void(s&&(t[n].defaultSelected=!0));null!==e||t[n].disabled||(e=t[n])}null!==e&&(e.selected=!0)}}function mt(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(y(91));return Q({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _t(t,e){var i=e.value;if(null==i){if(i=e.children,e=e.defaultValue,null!=i){if(null!=e)throw Error(y(92));if(ft(i)){if(1<i.length)throw Error(y(93));i=i[0]}e=i}null==e&&(e=""),i=e}t._wrapperState={initialValue:st(i)}}function yt(t,e){var i=st(e.value),s=st(e.defaultValue);null!=i&&((i=""+i)!==t.value&&(t.value=i),null==e.defaultValue&&t.defaultValue!==i&&(t.defaultValue=i)),null!=s&&(t.defaultValue=""+s)}function vt(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function wt(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?wt(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var bt,St,Ct=(St=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((bt=bt||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=bt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,i,s){MSApp.execUnsafeLocalFunction((function(){return St(t,e)}))}:St);function Tt(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&3===i.nodeType)return void(i.nodeValue=e)}t.textContent=e}var Et={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pt=["Webkit","ms","Moz","O"];function At(t,e,i){return null==e||"boolean"==typeof e||""===e?"":i||"number"!=typeof e||0===e||Et.hasOwnProperty(t)&&Et[t]?(""+e).trim():e+"px"}function kt(t,e){for(var i in t=t.style,e)if(e.hasOwnProperty(i)){var s=0===i.indexOf("--"),n=At(i,e[i],s);"float"===i&&(i="cssFloat"),s?t.setProperty(i,n):t[i]=n}}Object.keys(Et).forEach((function(t){Pt.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Et[e]=Et[t]}))}));var Rt=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function It(t,e){if(e){if(Rt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(y(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(y(60));if("object"!=typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(y(61))}if(null!=e.style&&"object"!=typeof e.style)throw Error(y(62))}}function Ft(t,e){if(-1===t.indexOf("-"))return"string"==typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dt=null;function Mt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Bt=null,Lt=null,zt=null;function Ot(t){if(t=En(t)){if("function"!=typeof Bt)throw Error(y(280));var e=t.stateNode;e&&(e=An(e),Bt(t.stateNode,t.type,e))}}function Nt(t){Lt?zt?zt.push(t):zt=[t]:Lt=t}function Ht(){if(Lt){var t=Lt,e=zt;if(zt=Lt=null,Ot(t),e)for(t=0;t<e.length;t++)Ot(e[t])}}function Ut(t,e){return t(e)}function Wt(){}var Vt=!1;function Gt(t,e,i){if(Vt)return t(e,i);Vt=!0;try{return Ut(t,e,i)}finally{Vt=!1,(null!==Lt||null!==zt)&&(Wt(),Ht())}}function jt(t,e){var i=t.stateNode;if(null===i)return null;var s=An(i);if(null===s)return null;i=s[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!s;break t;default:t=!1}if(t)return null;if(i&&"function"!=typeof i)throw Error(y(231,e,typeof i));return i}var Xt=!1;if(S)try{var qt={};Object.defineProperty(qt,"passive",{get:function(){Xt=!0}}),window.addEventListener("test",qt,qt),window.removeEventListener("test",qt,qt)}catch(St){Xt=!1}function Kt(t,e,i,s,n,r,o,a,l){var h=Array.prototype.slice.call(arguments,3);try{e.apply(i,h)}catch(t){this.onError(t)}}var Yt=!1,Qt=null,$t=!1,Zt=null,Jt={onError:function(t){Yt=!0,Qt=t}};function te(t,e,i,s,n,r,o,a,l){Yt=!1,Qt=null,Kt.apply(Jt,arguments)}function ee(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!=(4098&(e=t).flags)&&(i=e.return),t=e.return}while(t)}return 3===e.tag?i:null}function ie(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function se(t){if(ee(t)!==t)throw Error(y(188))}function ne(t){return t=function(t){var e=t.alternate;if(!e){if(null===(e=ee(t)))throw Error(y(188));return e!==t?null:t}for(var i=t,s=e;;){var n=i.return;if(null===n)break;var r=n.alternate;if(null===r){if(null!==(s=n.return)){i=s;continue}break}if(n.child===r.child){for(r=n.child;r;){if(r===i)return se(n),t;if(r===s)return se(n),e;r=r.sibling}throw Error(y(188))}if(i.return!==s.return)i=n,s=r;else{for(var o=!1,a=n.child;a;){if(a===i){o=!0,i=n,s=r;break}if(a===s){o=!0,s=n,i=r;break}a=a.sibling}if(!o){for(a=r.child;a;){if(a===i){o=!0,i=r,s=n;break}if(a===s){o=!0,s=r,i=n;break}a=a.sibling}if(!o)throw Error(y(189))}}if(i.alternate!==s)throw Error(y(190))}if(3!==i.tag)throw Error(y(188));return i.stateNode.current===i?t:e}(t),null!==t?re(t):null}function re(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=re(t);if(null!==e)return e;t=t.sibling}return null}var oe=_.unstable_scheduleCallback,ae=_.unstable_cancelCallback,le=_.unstable_shouldYield,he=_.unstable_requestPaint,ce=_.unstable_now,ue=_.unstable_getCurrentPriorityLevel,de=_.unstable_ImmediatePriority,pe=_.unstable_UserBlockingPriority,fe=_.unstable_NormalPriority,ge=_.unstable_LowPriority,me=_.unstable_IdlePriority,_e=null,ye=null;var ve=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(we(t)/xe|0)|0},we=Math.log,xe=Math.LN2;var be=64,Se=4194304;function Ce(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Te(t,e){var i=t.pendingLanes;if(0===i)return 0;var s=0,n=t.suspendedLanes,r=t.pingedLanes,o=268435455&i;if(0!==o){var a=o&~n;0!==a?s=Ce(a):0!==(r&=o)&&(s=Ce(r))}else 0!==(o=i&~n)?s=Ce(o):0!==r&&(s=Ce(r));if(0===s)return 0;if(0!==e&&e!==s&&0==(e&n)&&((n=s&-s)>=(r=e&-e)||16===n&&0!=(4194240&r)))return e;if(0!=(4&s)&&(s|=16&i),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=s;0<e;)n=1<<(i=31-ve(e)),s|=t[i],e&=~n;return s}function Ee(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function Pe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function Ae(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function ke(t,e,i){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-ve(e)]=i}function Re(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var s=31-ve(i),n=1<<s;n&e|t[s]&e&&(t[s]|=e),i&=~n}}var Ie=0;function Fe(t){return 1<(t&=-t)?4<t?0!=(268435455&t)?16:536870912:4:1}var De,Me,Be,Le,ze,Oe=!1,Ne=[],He=null,Ue=null,We=null,Ve=new Map,Ge=new Map,je=[],Xe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qe(t,e){switch(t){case"focusin":case"focusout":He=null;break;case"dragenter":case"dragleave":Ue=null;break;case"mouseover":case"mouseout":We=null;break;case"pointerover":case"pointerout":Ve.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ge.delete(e.pointerId)}}function Ke(t,e,i,s,n,r){return null===t||t.nativeEvent!==r?(t={blockedOn:e,domEventName:i,eventSystemFlags:s,nativeEvent:r,targetContainers:[n]},null!==e&&(null!==(e=En(e))&&Me(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,null!==n&&-1===e.indexOf(n)&&e.push(n),t)}function Ye(t){var e=Tn(t.target);if(null!==e){var i=ee(e);if(null!==i)if(13===(e=i.tag)){if(null!==(e=ie(i)))return t.blockedOn=e,void ze(t.priority,(function(){Be(i)}))}else if(3===e&&i.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}t.blockedOn=null}function Qe(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var i=oi(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==i)return null!==(e=En(i))&&Me(e),t.blockedOn=i,!1;var s=new(i=t.nativeEvent).constructor(i.type,i);Dt=s,i.target.dispatchEvent(s),Dt=null,e.shift()}return!0}function $e(t,e,i){Qe(t)&&i.delete(e)}function Ze(){Oe=!1,null!==He&&Qe(He)&&(He=null),null!==Ue&&Qe(Ue)&&(Ue=null),null!==We&&Qe(We)&&(We=null),Ve.forEach($e),Ge.forEach($e)}function Je(t,e){t.blockedOn===e&&(t.blockedOn=null,Oe||(Oe=!0,_.unstable_scheduleCallback(_.unstable_NormalPriority,Ze)))}function ti(t){function e(e){return Je(e,t)}if(0<Ne.length){Je(Ne[0],t);for(var i=1;i<Ne.length;i++){var s=Ne[i];s.blockedOn===t&&(s.blockedOn=null)}}for(null!==He&&Je(He,t),null!==Ue&&Je(Ue,t),null!==We&&Je(We,t),Ve.forEach(e),Ge.forEach(e),i=0;i<je.length;i++)(s=je[i]).blockedOn===t&&(s.blockedOn=null);for(;0<je.length&&null===(i=je[0]).blockedOn;)Ye(i),null===i.blockedOn&&je.shift()}var ei=D.ReactCurrentBatchConfig;function ii(t,e,i,s){var n=Ie,r=ei.transition;ei.transition=null;try{Ie=1,ni(t,e,i,s)}finally{Ie=n,ei.transition=r}}function si(t,e,i,s){var n=Ie,r=ei.transition;ei.transition=null;try{Ie=4,ni(t,e,i,s)}finally{Ie=n,ei.transition=r}}function ni(t,e,i,s){var n=oi(t,e,i,s);if(null===n)$s(t,e,s,ri,i),qe(t,s);else if(function(t,e,i,s,n){switch(e){case"focusin":return He=Ke(He,t,e,i,s,n),!0;case"dragenter":return Ue=Ke(Ue,t,e,i,s,n),!0;case"mouseover":return We=Ke(We,t,e,i,s,n),!0;case"pointerover":var r=n.pointerId;return Ve.set(r,Ke(Ve.get(r)||null,t,e,i,s,n)),!0;case"gotpointercapture":return r=n.pointerId,Ge.set(r,Ke(Ge.get(r)||null,t,e,i,s,n)),!0}return!1}(n,t,e,i,s))s.stopPropagation();else if(qe(t,s),4&e&&-1<Xe.indexOf(t)){for(;null!==n;){var r=En(n);if(null!==r&&De(r),null===(r=oi(t,e,i,s))&&$s(t,e,s,ri,i),r===n)break;n=r}null!==n&&s.stopPropagation()}else $s(t,e,s,null,i)}var ri=null;function oi(t,e,i,s){if(ri=null,null!==(t=Tn(t=Mt(s))))if(null===(e=ee(t)))t=null;else if(13===(i=e.tag)){if(null!==(t=ie(e)))return t;t=null}else if(3===i){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ri=t,null}function ai(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ue()){case de:return 1;case pe:return 4;case fe:case ge:return 16;case me:return 536870912;default:return 16}default:return 16}}var li=null,hi=null,ci=null;function ui(){if(ci)return ci;var t,e,i=hi,s=i.length,n="value"in li?li.value:li.textContent,r=n.length;for(t=0;t<s&&i[t]===n[t];t++);var o=s-t;for(e=1;e<=o&&i[s-e]===n[r-e];e++);return ci=n.slice(t,1<e?1-e:void 0)}function di(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function pi(){return!0}function fi(){return!1}function gi(t){function e(e,i,s,n,r){for(var o in this._reactName=e,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=r,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(n):n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?pi:fi,this.isPropagationStopped=fi,this}return Q(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!=typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=pi)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!=typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=pi)},persist:function(){},isPersistent:pi}),e}var mi,_i,yi,vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wi=gi(vi),xi=Q({},vi,{view:0,detail:0}),bi=gi(xi),Si=Q({},xi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mi,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yi&&(yi&&"mousemove"===t.type?(mi=t.screenX-yi.screenX,_i=t.screenY-yi.screenY):_i=mi=0,yi=t),mi)},movementY:function(t){return"movementY"in t?t.movementY:_i}}),Ci=gi(Si),Ti=gi(Q({},Si,{dataTransfer:0})),Ei=gi(Q({},xi,{relatedTarget:0})),Pi=gi(Q({},vi,{animationName:0,elapsedTime:0,pseudoElement:0})),Ai=gi(Q({},vi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}})),ki=gi(Q({},vi,{data:0})),Ri={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ii={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Di(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Fi[t])&&!!e[t]}function Mi(){return Di}var Bi=gi(Q({},xi,{key:function(t){if(t.key){var e=Ri[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=di(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?Ii[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mi,charCode:function(t){return"keypress"===t.type?di(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?di(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}})),Li=gi(Q({},Si,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),zi=gi(Q({},xi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mi})),Oi=gi(Q({},vi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ni=gi(Q({},Si,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0})),Hi=[9,13,27,32],Ui=S&&"CompositionEvent"in window,Wi=null;S&&"documentMode"in document&&(Wi=document.documentMode);var Vi=S&&"TextEvent"in window&&!Wi,Gi=S&&(!Ui||Wi&&8<Wi&&11>=Wi),ji=String.fromCharCode(32),Xi=!1;function qi(t,e){switch(t){case"keyup":return-1!==Hi.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ki(t){return"object"==typeof(t=t.detail)&&"data"in t?t.data:null}var Yi=!1;var Qi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $i(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Qi[t.type]:"textarea"===e}function Zi(t,e,i,s){Nt(s),0<(e=Js(e,"onChange")).length&&(i=new wi("onChange","change",null,i,s),t.push({event:i,listeners:e}))}var Ji=null,ts=null;function es(t){js(t,0)}function is(t){if(ot(Pn(t)))return t}function ss(t,e){if("change"===t)return e}var ns=!1;if(S){var rs;if(S){var os="oninput"in document;if(!os){var as=document.createElement("div");as.setAttribute("oninput","return;"),os="function"==typeof as.oninput}rs=os}else rs=!1;ns=rs&&(!document.documentMode||9<document.documentMode)}function ls(){Ji&&(Ji.detachEvent("onpropertychange",hs),ts=Ji=null)}function hs(t){if("value"===t.propertyName&&is(ts)){var e=[];Zi(e,ts,t,Mt(t)),Gt(es,e)}}function cs(t,e,i){"focusin"===t?(ls(),ts=i,(Ji=e).attachEvent("onpropertychange",hs)):"focusout"===t&&ls()}function us(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return is(ts)}function ds(t,e){if("click"===t)return is(e)}function ps(t,e){if("input"===t||"change"===t)return is(e)}var fs="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e};function gs(t,e){if(fs(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(s=0;s<i.length;s++){var n=i[s];if(!C.call(e,n)||!fs(t[n],e[n]))return!1}return!0}function ms(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _s(t,e){var i,s=ms(t);for(t=0;s;){if(3===s.nodeType){if(i=t+s.textContent.length,t<=e&&i>=e)return{node:s,offset:e-t};t=i}t:{for(;s;){if(s.nextSibling){s=s.nextSibling;break t}s=s.parentNode}s=void 0}s=ms(s)}}function ys(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?ys(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function vs(){for(var t=window,e=at();e instanceof t.HTMLIFrameElement;){try{var i="string"==typeof e.contentWindow.location.href}catch(t){i=!1}if(!i)break;e=at((t=e.contentWindow).document)}return e}function ws(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function xs(t){var e=vs(),i=t.focusedElem,s=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&ys(i.ownerDocument.documentElement,i)){if(null!==s&&ws(i))if(e=s.start,void 0===(t=s.end)&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if((t=(e=i.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var n=i.textContent.length,r=Math.min(s.start,n);s=void 0===s.end?r:Math.min(s.end,n),!t.extend&&r>s&&(n=s,s=r,r=n),n=_s(i,r);var o=_s(i,s);n&&o&&(1!==t.rangeCount||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(n.node,n.offset),t.removeAllRanges(),r>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=i;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<e.length;i++)(t=e[i]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var bs=S&&"documentMode"in document&&11>=document.documentMode,Ss=null,Cs=null,Ts=null,Es=!1;function Ps(t,e,i){var s=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;Es||null==Ss||Ss!==at(s)||("selectionStart"in(s=Ss)&&ws(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},Ts&&gs(Ts,s)||(Ts=s,0<(s=Js(Cs,"onSelect")).length&&(e=new wi("onSelect","select",null,e,i),t.push({event:e,listeners:s}),e.target=Ss)))}function As(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var ks={animationend:As("Animation","AnimationEnd"),animationiteration:As("Animation","AnimationIteration"),animationstart:As("Animation","AnimationStart"),transitionend:As("Transition","TransitionEnd")},Rs={},Is={};function Fs(t){if(Rs[t])return Rs[t];if(!ks[t])return t;var e,i=ks[t];for(e in i)if(i.hasOwnProperty(e)&&e in Is)return Rs[t]=i[e];return t}S&&(Is=document.createElement("div").style,"AnimationEvent"in window||(delete ks.animationend.animation,delete ks.animationiteration.animation,delete ks.animationstart.animation),"TransitionEvent"in window||delete ks.transitionend.transition);var Ds=Fs("animationend"),Ms=Fs("animationiteration"),Bs=Fs("animationstart"),Ls=Fs("transitionend"),zs=new Map,Os="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ns(t,e){zs.set(t,e),x(e,[t])}for(var Hs=0;Hs<Os.length;Hs++){var Us=Os[Hs];Ns(Us.toLowerCase(),"on"+(Us[0].toUpperCase()+Us.slice(1)))}Ns(Ds,"onAnimationEnd"),Ns(Ms,"onAnimationIteration"),Ns(Bs,"onAnimationStart"),Ns("dblclick","onDoubleClick"),Ns("focusin","onFocus"),Ns("focusout","onBlur"),Ns(Ls,"onTransitionEnd"),b("onMouseEnter",["mouseout","mouseover"]),b("onMouseLeave",["mouseout","mouseover"]),b("onPointerEnter",["pointerout","pointerover"]),b("onPointerLeave",["pointerout","pointerover"]),x("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),x("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),x("onBeforeInput",["compositionend","keypress","textInput","paste"]),x("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),x("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),x("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ws="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vs=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ws));function Gs(t,e,i){var s=t.type||"unknown-event";t.currentTarget=i,function(t,e,i,s,n,r,o,a,l){if(te.apply(this,arguments),Yt){if(!Yt)throw Error(y(198));var h=Qt;Yt=!1,Qt=null,$t||($t=!0,Zt=h)}}(s,e,void 0,t),t.currentTarget=null}function js(t,e){e=0!=(4&e);for(var i=0;i<t.length;i++){var s=t[i],n=s.event;s=s.listeners;t:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,h=a.currentTarget;if(a=a.listener,l!==r&&n.isPropagationStopped())break t;Gs(n,a,h),r=l}else for(o=0;o<s.length;o++){if(l=(a=s[o]).instance,h=a.currentTarget,a=a.listener,l!==r&&n.isPropagationStopped())break t;Gs(n,a,h),r=l}}}if($t)throw t=Zt,$t=!1,Zt=null,t}function Xs(t,e){var i=e[bn];void 0===i&&(i=e[bn]=new Set);var s=t+"__bubble";i.has(s)||(Qs(e,t,2,!1),i.add(s))}function qs(t,e,i){var s=0;e&&(s|=4),Qs(i,t,s,e)}var Ks="_reactListening"+Math.random().toString(36).slice(2);function Ys(t){if(!t[Ks]){t[Ks]=!0,v.forEach((function(e){"selectionchange"!==e&&(Vs.has(e)||qs(e,!1,t),qs(e,!0,t))}));var e=9===t.nodeType?t:t.ownerDocument;null===e||e[Ks]||(e[Ks]=!0,qs("selectionchange",!1,e))}}function Qs(t,e,i,s){switch(ai(e)){case 1:var n=ii;break;case 4:n=si;break;default:n=ni}i=n.bind(null,e,i,t),n=void 0,!Xt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(n=!0),s?void 0!==n?t.addEventListener(e,i,{capture:!0,passive:n}):t.addEventListener(e,i,!0):void 0!==n?t.addEventListener(e,i,{passive:n}):t.addEventListener(e,i,!1)}function $s(t,e,i,s,n){var r=s;if(0==(1&e)&&0==(2&e)&&null!==s)t:for(;;){if(null===s)return;var o=s.tag;if(3===o||4===o){var a=s.stateNode.containerInfo;if(a===n||8===a.nodeType&&a.parentNode===n)break;if(4===o)for(o=s.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;o=o.return}for(;null!==a;){if(null===(o=Tn(a)))return;if(5===(l=o.tag)||6===l){s=r=o;continue t}a=a.parentNode}}s=s.return}Gt((function(){var s=r,n=Mt(i),o=[];t:{var a=zs.get(t);if(void 0!==a){var l=wi,h=t;switch(t){case"keypress":if(0===di(i))break t;case"keydown":case"keyup":l=Bi;break;case"focusin":h="focus",l=Ei;break;case"focusout":h="blur",l=Ei;break;case"beforeblur":case"afterblur":l=Ei;break;case"click":if(2===i.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Ci;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Ti;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=zi;break;case Ds:case Ms:case Bs:l=Pi;break;case Ls:l=Oi;break;case"scroll":l=bi;break;case"wheel":l=Ni;break;case"copy":case"cut":case"paste":l=Ai;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Li}var c=0!=(4&e),u=!c&&"scroll"===t,d=c?null!==a?a+"Capture":null:a;c=[];for(var p,f=s;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==d&&(null!=(g=jt(f,d))&&c.push(Zs(f,g,p)))),u)break;f=f.return}0<c.length&&(a=new l(a,h,null,i,n),o.push({event:a,listeners:c}))}}if(0==(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(a="mouseover"===t||"pointerover"===t)||i===Dt||!(h=i.relatedTarget||i.fromElement)||!Tn(h)&&!h[xn])&&(l||a)&&(a=n.window===n?n:(a=n.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=s,null!==(h=(h=i.relatedTarget||i.toElement)?Tn(h):null)&&(h!==(u=ee(h))||5!==h.tag&&6!==h.tag)&&(h=null)):(l=null,h=s),l!==h)){if(c=Ci,g="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(c=Li,g="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?a:Pn(l),p=null==h?a:Pn(h),(a=new c(g,f+"leave",l,i,n)).target=u,a.relatedTarget=p,g=null,Tn(n)===s&&((c=new c(d,f+"enter",h,i,n)).target=p,c.relatedTarget=u,g=c),u=g,l&&h)t:{for(d=h,f=0,p=c=l;p;p=tn(p))f++;for(p=0,g=d;g;g=tn(g))p++;for(;0<f-p;)c=tn(c),f--;for(;0<p-f;)d=tn(d),p--;for(;f--;){if(c===d||null!==d&&c===d.alternate)break t;c=tn(c),d=tn(d)}c=null}else c=null;null!==l&&en(o,a,l,c,!1),null!==h&&null!==u&&en(o,u,h,c,!0)}if("select"===(l=(a=s?Pn(s):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=ss;else if($i(a))if(ns)m=ps;else{m=us;var _=cs}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=ds);switch(m&&(m=m(t,s))?Zi(o,m,i,n):(_&&_(t,a,s),"focusout"===t&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&pt(a,"number",a.value)),_=s?Pn(s):window,t){case"focusin":($i(_)||"true"===_.contentEditable)&&(Ss=_,Cs=s,Ts=null);break;case"focusout":Ts=Cs=Ss=null;break;case"mousedown":Es=!0;break;case"contextmenu":case"mouseup":case"dragend":Es=!1,Ps(o,i,n);break;case"selectionchange":if(bs)break;case"keydown":case"keyup":Ps(o,i,n)}var y;if(Ui)t:{switch(t){case"compositionstart":var v="onCompositionStart";break t;case"compositionend":v="onCompositionEnd";break t;case"compositionupdate":v="onCompositionUpdate";break t}v=void 0}else Yi?qi(t,i)&&(v="onCompositionEnd"):"keydown"===t&&229===i.keyCode&&(v="onCompositionStart");v&&(Gi&&"ko"!==i.locale&&(Yi||"onCompositionStart"!==v?"onCompositionEnd"===v&&Yi&&(y=ui()):(hi="value"in(li=n)?li.value:li.textContent,Yi=!0)),0<(_=Js(s,v)).length&&(v=new ki(v,t,null,i,n),o.push({event:v,listeners:_}),y?v.data=y:null!==(y=Ki(i))&&(v.data=y))),(y=Vi?function(t,e){switch(t){case"compositionend":return Ki(e);case"keypress":return 32!==e.which?null:(Xi=!0,ji);case"textInput":return(t=e.data)===ji&&Xi?null:t;default:return null}}(t,i):function(t,e){if(Yi)return"compositionend"===t||!Ui&&qi(t,e)?(t=ui(),ci=hi=li=null,Yi=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Gi&&"ko"!==e.locale?null:e.data}}(t,i))&&(0<(s=Js(s,"onBeforeInput")).length&&(n=new ki("onBeforeInput","beforeinput",null,i,n),o.push({event:n,listeners:s}),n.data=y))}js(o,e)}))}function Zs(t,e,i){return{instance:t,listener:e,currentTarget:i}}function Js(t,e){for(var i=e+"Capture",s=[];null!==t;){var n=t,r=n.stateNode;5===n.tag&&null!==r&&(n=r,null!=(r=jt(t,i))&&s.unshift(Zs(t,r,n)),null!=(r=jt(t,e))&&s.push(Zs(t,r,n))),t=t.return}return s}function tn(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function en(t,e,i,s,n){for(var r=e._reactName,o=[];null!==i&&i!==s;){var a=i,l=a.alternate,h=a.stateNode;if(null!==l&&l===s)break;5===a.tag&&null!==h&&(a=h,n?null!=(l=jt(i,r))&&o.unshift(Zs(i,l,a)):n||null!=(l=jt(i,r))&&o.push(Zs(i,l,a))),i=i.return}0!==o.length&&t.push({event:e,listeners:o})}var sn=/\r\n?/g,nn=/\u0000|\uFFFD/g;function rn(t){return("string"==typeof t?t:""+t).replace(sn,"\n").replace(nn,"")}function on(t,e,i){if(e=rn(e),rn(t)!==e&&i)throw Error(y(425))}function an(){}var ln=null;function hn(t,e){return"textarea"===t||"noscript"===t||"string"==typeof e.children||"number"==typeof e.children||"object"==typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var cn="function"==typeof setTimeout?setTimeout:void 0,un="function"==typeof clearTimeout?clearTimeout:void 0,dn="function"==typeof Promise?Promise:void 0,pn="function"==typeof queueMicrotask?queueMicrotask:void 0!==dn?function(t){return dn.resolve(null).then(t).catch(fn)}:cn;function fn(t){setTimeout((function(){throw t}))}function gn(t,e){var i=e,s=0;do{var n=i.nextSibling;if(t.removeChild(i),n&&8===n.nodeType)if("/$"===(i=n.data)){if(0===s)return t.removeChild(n),void ti(e);s--}else"$"!==i&&"$?"!==i&&"$!"!==i||s++;i=n}while(i);ti(e)}function mn(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function _n(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var i=t.data;if("$"===i||"$!"===i||"$?"===i){if(0===e)return t;e--}else"/$"===i&&e++}t=t.previousSibling}return null}var yn=Math.random().toString(36).slice(2),vn="__reactFiber$"+yn,wn="__reactProps$"+yn,xn="__reactContainer$"+yn,bn="__reactEvents$"+yn,Sn="__reactListeners$"+yn,Cn="__reactHandles$"+yn;function Tn(t){var e=t[vn];if(e)return e;for(var i=t.parentNode;i;){if(e=i[xn]||i[vn]){if(i=e.alternate,null!==e.child||null!==i&&null!==i.child)for(t=_n(t);null!==t;){if(i=t[vn])return i;t=_n(t)}return e}i=(t=i).parentNode}return null}function En(t){return!(t=t[vn]||t[xn])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function Pn(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(y(33))}function An(t){return t[wn]||null}var kn=[],Rn=-1;function In(t){return{current:t}}function Fn(t){0>Rn||(t.current=kn[Rn],kn[Rn]=null,Rn--)}function Dn(t,e){Rn++,kn[Rn]=t.current,t.current=e}var Mn={},Bn=In(Mn),Ln=In(!1),zn=Mn;function On(t,e){var i=t.type.contextTypes;if(!i)return Mn;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var n,r={};for(n in i)r[n]=e[n];return s&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Nn(t){return null!=(t=t.childContextTypes)}function Hn(){Fn(Ln),Fn(Bn)}function Un(t,e,i){if(Bn.current!==Mn)throw Error(y(168));Dn(Bn,e),Dn(Ln,i)}function Wn(t,e,i){var s=t.stateNode;if(e=e.childContextTypes,"function"!=typeof s.getChildContext)return i;for(var n in s=s.getChildContext())if(!(n in e))throw Error(y(108,it(t)||"Unknown",n));return Q({},i,s)}function Vn(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Mn,zn=Bn.current,Dn(Bn,t),Dn(Ln,Ln.current),!0}function Gn(t,e,i){var s=t.stateNode;if(!s)throw Error(y(169));i?(t=Wn(t,e,zn),s.__reactInternalMemoizedMergedChildContext=t,Fn(Ln),Fn(Bn),Dn(Bn,t)):Fn(Ln),Dn(Ln,i)}var jn=null,Xn=!1,qn=!1;function Kn(t){null===jn?jn=[t]:jn.push(t)}function Yn(){if(!qn&&null!==jn){qn=!0;var t=0,e=Ie;try{var i=jn;for(Ie=1;t<i.length;t++){var s=i[t];do{s=s(!0)}while(null!==s)}jn=null,Xn=!1}catch(e){throw null!==jn&&(jn=jn.slice(t+1)),oe(de,Yn),e}finally{Ie=e,qn=!1}}return null}var Qn=D.ReactCurrentBatchConfig;function $n(t,e){if(t&&t.defaultProps){for(var i in e=Q({},e),t=t.defaultProps)void 0===e[i]&&(e[i]=t[i]);return e}return e}var Zn=In(null),Jn=null,tr=null,er=null;function ir(){er=tr=Jn=null}function sr(t){var e=Zn.current;Fn(Zn),t._currentValue=e}function nr(t,e,i){for(;null!==t;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==s&&(s.childLanes|=e)):null!==s&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===i)break;t=t.return}}function rr(t,e){Jn=t,er=tr=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!=(t.lanes&e)&&(Pa=!0),t.firstContext=null)}function or(t){var e=t._currentValue;if(er!==t)if(t={context:t,memoizedValue:e,next:null},null===tr){if(null===Jn)throw Error(y(308));tr=t,Jn.dependencies={lanes:0,firstContext:t}}else tr=tr.next=t;return e}var ar=null,lr=!1;function hr(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cr(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ur(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function dr(t,e){var i=t.updateQueue;null!==i&&(i=i.shared,null!==Al&&0!=(1&t.mode)&&0==(2&Pl)?(null===(t=i.interleaved)?(e.next=e,null===ar?ar=[i]:ar.push(i)):(e.next=t.next,t.next=e),i.interleaved=e):(null===(t=i.pending)?e.next=e:(e.next=t.next,t.next=e),i.pending=e))}function pr(t,e,i){if(null!==(e=e.updateQueue)&&(e=e.shared,0!=(4194240&i))){var s=e.lanes;i|=s&=t.pendingLanes,e.lanes=i,Re(t,i)}}function fr(t,e){var i=t.updateQueue,s=t.alternate;if(null!==s&&i===(s=s.updateQueue)){var n=null,r=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===r?n=r=o:r=r.next=o,i=i.next}while(null!==i);null===r?n=r=e:r=r.next=e}else n=r=e;return i={baseState:s.baseState,firstBaseUpdate:n,lastBaseUpdate:r,shared:s.shared,effects:s.effects},void(t.updateQueue=i)}null===(t=i.lastBaseUpdate)?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function gr(t,e,i,s){var n=t.updateQueue;lr=!1;var r=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(null!==a){n.shared.pending=null;var l=a,h=l.next;l.next=null,null===o?r=h:o.next=h,o=l;var c=t.alternate;null!==c&&((a=(c=c.updateQueue).lastBaseUpdate)!==o&&(null===a?c.firstBaseUpdate=h:a.next=h,c.lastBaseUpdate=l))}if(null!==r){var u=n.baseState;for(o=0,c=h=l=null,a=r;;){var d=a.lane,p=a.eventTime;if((s&d)===d){null!==c&&(c=c.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var f=t,g=a;switch(d=e,p=i,g.tag){case 1:if("function"==typeof(f=g.payload)){u=f.call(p,u,d);break t}u=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=g.payload)?f.call(p,u,d):f))break t;u=Q({},u,d);break t;case 2:lr=!0}}null!==a.callback&&0!==a.lane&&(t.flags|=64,null===(d=n.effects)?n.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===c?(h=c=p,l=u):c=c.next=p,o|=d;if(null===(a=a.next)){if(null===(a=n.shared.pending))break;a=(d=a).next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}if(null===c&&(l=u),n.baseState=l,n.firstBaseUpdate=h,n.lastBaseUpdate=c,null!==(e=n.shared.interleaved)){n=e;do{o|=n.lane,n=n.next}while(n!==e)}else null===r&&(n.shared.lanes=0);Bl|=o,t.lanes=o,t.memoizedState=u}}function mr(t,e,i){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var s=t[e],n=s.callback;if(null!==n){if(s.callback=null,s=i,"function"!=typeof n)throw Error(y(191,n));n.call(s)}}}var _r=(new m.Component).refs;function yr(t,e,i,s){i=null==(i=i(s,e=t.memoizedState))?e:Q({},e,i),t.memoizedState=i,0===t.lanes&&(t.updateQueue.baseState=i)}var vr={isMounted:function(t){return!!(t=t._reactInternals)&&ee(t)===t},enqueueSetState:function(t,e,i){t=t._reactInternals;var s=Zl(),n=Jl(t),r=ur(s,n);r.payload=e,null!=i&&(r.callback=i),dr(t,r),null!==(e=th(t,n,s))&&pr(e,t,n)},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var s=Zl(),n=Jl(t),r=ur(s,n);r.tag=1,r.payload=e,null!=i&&(r.callback=i),dr(t,r),null!==(e=th(t,n,s))&&pr(e,t,n)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Zl(),s=Jl(t),n=ur(i,s);n.tag=2,null!=e&&(n.callback=e),dr(t,n),null!==(e=th(t,s,i))&&pr(e,t,s)}};function wr(t,e,i,s,n,r,o){return"function"==typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(s,r,o):!e.prototype||!e.prototype.isPureReactComponent||(!gs(i,s)||!gs(n,r))}function xr(t,e,i){var s=!1,n=Mn,r=e.contextType;return"object"==typeof r&&null!==r?r=or(r):(n=Nn(e)?zn:Bn.current,r=(s=null!=(s=e.contextTypes))?On(t,n):Mn),e=new e(i,r),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=vr,t.stateNode=e,e._reactInternals=t,s&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=r),e}function br(t,e,i,s){t=e.state,"function"==typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(i,s),"function"==typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(i,s),e.state!==t&&vr.enqueueReplaceState(e,e.state,null)}function Sr(t,e,i,s){var n=t.stateNode;n.props=i,n.state=t.memoizedState,n.refs=_r,hr(t);var r=e.contextType;"object"==typeof r&&null!==r?n.context=or(r):(r=Nn(e)?zn:Bn.current,n.context=On(t,r)),n.state=t.memoizedState,"function"==typeof(r=e.getDerivedStateFromProps)&&(yr(t,e,r,i),n.state=t.memoizedState),"function"==typeof e.getDerivedStateFromProps||"function"==typeof n.getSnapshotBeforeUpdate||"function"!=typeof n.UNSAFE_componentWillMount&&"function"!=typeof n.componentWillMount||(e=n.state,"function"==typeof n.componentWillMount&&n.componentWillMount(),"function"==typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),e!==n.state&&vr.enqueueReplaceState(n,n.state,null),gr(t,i,n,s),n.state=t.memoizedState),"function"==typeof n.componentDidMount&&(t.flags|=4194308)}var Cr=[],Tr=0,Er=null,Pr=0,Ar=[],kr=0,Rr=null,Ir=1,Fr="";function Dr(t,e){Cr[Tr++]=Pr,Cr[Tr++]=Er,Er=t,Pr=e}function Mr(t,e,i){Ar[kr++]=Ir,Ar[kr++]=Fr,Ar[kr++]=Rr,Rr=t;var s=Ir;t=Fr;var n=32-ve(s)-1;s&=~(1<<n),i+=1;var r=32-ve(e)+n;if(30<r){var o=n-n%5;r=(s&(1<<o)-1).toString(32),s>>=o,n-=o,Ir=1<<32-ve(e)+n|i<<n|s,Fr=r+t}else Ir=1<<r|i<<n|s,Fr=t}function Br(t){null!==t.return&&(Dr(t,1),Mr(t,1,0))}function Lr(t){for(;t===Er;)Er=Cr[--Tr],Cr[Tr]=null,Pr=Cr[--Tr],Cr[Tr]=null;for(;t===Rr;)Rr=Ar[--kr],Ar[kr]=null,Fr=Ar[--kr],Ar[kr]=null,Ir=Ar[--kr],Ar[kr]=null}var zr=null,Or=null,Nr=!1,Hr=null;function Ur(t,e){var i=Rh(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,null===(e=t.deletions)?(t.deletions=[i],t.flags|=16):e.push(i)}function Wr(t,e){switch(t.tag){case 5:var i=t.type;return null!==(e=1!==e.nodeType||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,zr=t,Or=mn(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,zr=t,Or=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(i=null!==Rr?{id:Ir,overflow:Fr}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},(i=Rh(18,null,null,0)).stateNode=e,i.return=t,t.child=i,zr=t,Or=null,!0);default:return!1}}function Vr(t){return 0!=(1&t.mode)&&0==(128&t.flags)}function Gr(t){if(Nr){var e=Or;if(e){var i=e;if(!Wr(t,e)){if(Vr(t))throw Error(y(418));e=mn(i.nextSibling);var s=zr;e&&Wr(t,e)?Ur(s,i):(t.flags=-4097&t.flags|2,Nr=!1,zr=t)}}else{if(Vr(t))throw Error(y(418));t.flags=-4097&t.flags|2,Nr=!1,zr=t}}}function jr(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;zr=t}function Xr(t){if(t!==zr)return!1;if(!Nr)return jr(t),Nr=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!hn(t.type,t.memoizedProps)),e&&(e=Or)){if(Vr(t)){for(t=Or;t;)t=mn(t.nextSibling);throw Error(y(418))}for(;e;)Ur(t,e),e=mn(e.nextSibling)}if(jr(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(y(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var i=t.data;if("/$"===i){if(0===e){Or=mn(t.nextSibling);break t}e--}else"$"!==i&&"$!"!==i&&"$?"!==i||e++}t=t.nextSibling}Or=null}}else Or=zr?mn(t.stateNode.nextSibling):null;return!0}function qr(){Or=zr=null,Nr=!1}function Kr(t){null===Hr?Hr=[t]:Hr.push(t)}function Yr(t,e,i){if(null!==(t=i.ref)&&"function"!=typeof t&&"object"!=typeof t){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(y(309));var s=i.stateNode}if(!s)throw Error(y(147,t));var n=s,r=""+t;return null!==e&&null!==e.ref&&"function"==typeof e.ref&&e.ref._stringRef===r?e.ref:((e=function(t){var e=n.refs;e===_r&&(e=n.refs={}),null===t?delete e[r]:e[r]=t})._stringRef=r,e)}if("string"!=typeof t)throw Error(y(284));if(!i._owner)throw Error(y(290,t))}return t}function Qr(t,e){throw t=Object.prototype.toString.call(e),Error(y(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function $r(t){return(0,t._init)(t._payload)}function Zr(t){function e(e,i){if(t){var s=e.deletions;null===s?(e.deletions=[i],e.flags|=16):s.push(i)}}function i(i,s){if(!t)return null;for(;null!==s;)e(i,s),s=s.sibling;return null}function s(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function n(t,e){return(t=Fh(t,e)).index=0,t.sibling=null,t}function r(e,i,s){return e.index=s,t?null!==(s=e.alternate)?(s=s.index)<i?(e.flags|=2,i):s:(e.flags|=2,i):(e.flags|=1048576,i)}function o(e){return t&&null===e.alternate&&(e.flags|=2),e}function a(t,e,i,s){return null===e||6!==e.tag?((e=Lh(i,t.mode,s)).return=t,e):((e=n(e,i)).return=t,e)}function l(t,e,i,s){var r=i.type;return r===L?c(t,e,i.props.children,s,i.key):null!==e&&(e.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===j&&$r(r)===e.type)?((s=n(e,i.props)).ref=Yr(t,e,i),s.return=t,s):((s=Dh(i.type,i.key,i.props,null,t.mode,s)).ref=Yr(t,e,i),s.return=t,s)}function h(t,e,i,s){return null===e||4!==e.tag||e.stateNode.containerInfo!==i.containerInfo||e.stateNode.implementation!==i.implementation?((e=zh(i,t.mode,s)).return=t,e):((e=n(e,i.children||[])).return=t,e)}function c(t,e,i,s,r){return null===e||7!==e.tag?((e=Mh(i,t.mode,s,r)).return=t,e):((e=n(e,i)).return=t,e)}function u(t,e,i){if("string"==typeof e&&""!==e||"number"==typeof e)return(e=Lh(""+e,t.mode,i)).return=t,e;if("object"==typeof e&&null!==e){switch(e.$$typeof){case M:return(i=Dh(e.type,e.key,e.props,null,t.mode,i)).ref=Yr(t,null,e),i.return=t,i;case B:return(e=zh(e,t.mode,i)).return=t,e;case j:return u(t,(0,e._init)(e._payload),i)}if(ft(e)||K(e))return(e=Mh(e,t.mode,i,null)).return=t,e;Qr(t,e)}return null}function d(t,e,i,s){var n=null!==e?e.key:null;if("string"==typeof i&&""!==i||"number"==typeof i)return null!==n?null:a(t,e,""+i,s);if("object"==typeof i&&null!==i){switch(i.$$typeof){case M:return i.key===n?l(t,e,i,s):null;case B:return i.key===n?h(t,e,i,s):null;case j:return d(t,e,(n=i._init)(i._payload),s)}if(ft(i)||K(i))return null!==n?null:c(t,e,i,s,null);Qr(t,i)}return null}function p(t,e,i,s,n){if("string"==typeof s&&""!==s||"number"==typeof s)return a(e,t=t.get(i)||null,""+s,n);if("object"==typeof s&&null!==s){switch(s.$$typeof){case M:return l(e,t=t.get(null===s.key?i:s.key)||null,s,n);case B:return h(e,t=t.get(null===s.key?i:s.key)||null,s,n);case j:return p(t,e,i,(0,s._init)(s._payload),n)}if(ft(s)||K(s))return c(e,t=t.get(i)||null,s,n,null);Qr(e,s)}return null}return function a(l,h,c,f){if("object"==typeof c&&null!==c&&c.type===L&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case M:t:{for(var g=c.key,m=h;null!==m;){if(m.key===g){if((g=c.type)===L){if(7===m.tag){i(l,m.sibling),(h=n(m,c.props.children)).return=l,l=h;break t}}else if(m.elementType===g||"object"==typeof g&&null!==g&&g.$$typeof===j&&$r(g)===m.type){i(l,m.sibling),(h=n(m,c.props)).ref=Yr(l,m,c),h.return=l,l=h;break t}i(l,m);break}e(l,m),m=m.sibling}c.type===L?((h=Mh(c.props.children,l.mode,f,c.key)).return=l,l=h):((f=Dh(c.type,c.key,c.props,null,l.mode,f)).ref=Yr(l,h,c),f.return=l,l=f)}return o(l);case B:t:{for(m=c.key;null!==h;){if(h.key===m){if(4===h.tag&&h.stateNode.containerInfo===c.containerInfo&&h.stateNode.implementation===c.implementation){i(l,h.sibling),(h=n(h,c.children||[])).return=l,l=h;break t}i(l,h);break}e(l,h),h=h.sibling}(h=zh(c,l.mode,f)).return=l,l=h}return o(l);case j:return a(l,h,(m=c._init)(c._payload),f)}if(ft(c))return function(n,o,a,l){for(var h=null,c=null,f=o,g=o=0,m=null;null!==f&&g<a.length;g++){f.index>g?(m=f,f=null):m=f.sibling;var _=d(n,f,a[g],l);if(null===_){null===f&&(f=m);break}t&&f&&null===_.alternate&&e(n,f),o=r(_,o,g),null===c?h=_:c.sibling=_,c=_,f=m}if(g===a.length)return i(n,f),Nr&&Dr(n,g),h;if(null===f){for(;g<a.length;g++)null!==(f=u(n,a[g],l))&&(o=r(f,o,g),null===c?h=f:c.sibling=f,c=f);return Nr&&Dr(n,g),h}for(f=s(n,f);g<a.length;g++)null!==(m=p(f,n,g,a[g],l))&&(t&&null!==m.alternate&&f.delete(null===m.key?g:m.key),o=r(m,o,g),null===c?h=m:c.sibling=m,c=m);return t&&f.forEach((function(t){return e(n,t)})),Nr&&Dr(n,g),h}(l,h,c,f);if(K(c))return function(n,o,a,l){var h=K(a);if("function"!=typeof h)throw Error(y(150));if(null==(a=h.call(a)))throw Error(y(151));for(var c=h=null,f=o,g=o=0,m=null,_=a.next();null!==f&&!_.done;g++,_=a.next()){f.index>g?(m=f,f=null):m=f.sibling;var v=d(n,f,_.value,l);if(null===v){null===f&&(f=m);break}t&&f&&null===v.alternate&&e(n,f),o=r(v,o,g),null===c?h=v:c.sibling=v,c=v,f=m}if(_.done)return i(n,f),Nr&&Dr(n,g),h;if(null===f){for(;!_.done;g++,_=a.next())null!==(_=u(n,_.value,l))&&(o=r(_,o,g),null===c?h=_:c.sibling=_,c=_);return Nr&&Dr(n,g),h}for(f=s(n,f);!_.done;g++,_=a.next())null!==(_=p(f,n,g,_.value,l))&&(t&&null!==_.alternate&&f.delete(null===_.key?g:_.key),o=r(_,o,g),null===c?h=_:c.sibling=_,c=_);return t&&f.forEach((function(t){return e(n,t)})),Nr&&Dr(n,g),h}(l,h,c,f);Qr(l,c)}return"string"==typeof c&&""!==c||"number"==typeof c?(c=""+c,null!==h&&6===h.tag?(i(l,h.sibling),(h=n(h,c)).return=l,l=h):(i(l,h),(h=Lh(c,l.mode,f)).return=l,l=h),o(l)):i(l,h)}}var Jr=Zr(!0),to=Zr(!1),eo={},io=In(eo),so=In(eo),no=In(eo);function ro(t){if(t===eo)throw Error(y(174));return t}function oo(t,e){switch(Dn(no,e),Dn(so,t),Dn(io,eo),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:xt(null,"");break;default:e=xt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}Fn(io),Dn(io,e)}function ao(){Fn(io),Fn(so),Fn(no)}function lo(t){ro(no.current);var e=ro(io.current),i=xt(e,t.type);e!==i&&(Dn(so,t),Dn(io,i))}function ho(t){so.current===t&&(Fn(io),Fn(so))}var co=In(0);function uo(t){for(var e=t;null!==e;){if(13===e.tag){var i=e.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!=(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var po=[];function fo(){for(var t=0;t<po.length;t++)po[t]._workInProgressVersionPrimary=null;po.length=0}var go=D.ReactCurrentDispatcher,mo=D.ReactCurrentBatchConfig,_o=0,yo=null,vo=null,wo=null,xo=!1,bo=!1,So=0,Co=0;function To(){throw Error(y(321))}function Eo(t,e){if(null===e)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!fs(t[i],e[i]))return!1;return!0}function Po(t,e,i,s,n,r){if(_o=r,yo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,go.current=null===t||null===t.memoizedState?ha:ca,t=i(s,n),bo){r=0;do{if(bo=!1,So=0,25<=r)throw Error(y(301));r+=1,wo=vo=null,e.updateQueue=null,go.current=ua,t=i(s,n)}while(bo)}if(go.current=la,e=null!==vo&&null!==vo.next,_o=0,wo=vo=yo=null,xo=!1,e)throw Error(y(300));return t}function Ao(){var t=0!==So;return So=0,t}function ko(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wo?yo.memoizedState=wo=t:wo=wo.next=t,wo}function Ro(){if(null===vo){var t=yo.alternate;t=null!==t?t.memoizedState:null}else t=vo.next;var e=null===wo?yo.memoizedState:wo.next;if(null!==e)wo=e,vo=t;else{if(null===t)throw Error(y(310));t={memoizedState:(vo=t).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===wo?yo.memoizedState=wo=t:wo=wo.next=t}return wo}function Io(t,e){return"function"==typeof e?e(t):e}function Fo(t){var e=Ro(),i=e.queue;if(null===i)throw Error(y(311));i.lastRenderedReducer=t;var s=vo,n=s.baseQueue,r=i.pending;if(null!==r){if(null!==n){var o=n.next;n.next=r.next,r.next=o}s.baseQueue=n=r,i.pending=null}if(null!==n){r=n.next,s=s.baseState;var a=o=null,l=null,h=r;do{var c=h.lane;if((_o&c)===c)null!==l&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),s=h.hasEagerState?h.eagerState:t(s,h.action);else{var u={lane:c,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===l?(a=l=u,o=s):l=l.next=u,yo.lanes|=c,Bl|=c}h=h.next}while(null!==h&&h!==r);null===l?o=s:l.next=a,fs(s,e.memoizedState)||(Pa=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,i.lastRenderedState=s}if(null!==(t=i.interleaved)){n=t;do{r=n.lane,yo.lanes|=r,Bl|=r,n=n.next}while(n!==t)}else null===n&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function Do(t){var e=Ro(),i=e.queue;if(null===i)throw Error(y(311));i.lastRenderedReducer=t;var s=i.dispatch,n=i.pending,r=e.memoizedState;if(null!==n){i.pending=null;var o=n=n.next;do{r=t(r,o.action),o=o.next}while(o!==n);fs(r,e.memoizedState)||(Pa=!0),e.memoizedState=r,null===e.baseQueue&&(e.baseState=r),i.lastRenderedState=r}return[r,s]}function Mo(){}function Bo(t,e){var i=yo,s=Ro(),n=e(),r=!fs(s.memoizedState,n);if(r&&(s.memoizedState=n,Pa=!0),s=s.queue,Xo(Oo.bind(null,i,s,t),[t]),s.getSnapshot!==e||r||null!==wo&&1&wo.memoizedState.tag){if(i.flags|=2048,Uo(9,zo.bind(null,i,s,n,e),void 0,null),null===Al)throw Error(y(349));0!=(30&_o)||Lo(i,e,n)}return n}function Lo(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},null===(e=yo.updateQueue)?(e={lastEffect:null,stores:null},yo.updateQueue=e,e.stores=[t]):null===(i=e.stores)?e.stores=[t]:i.push(t)}function zo(t,e,i,s){e.value=i,e.getSnapshot=s,No(e)&&th(t,1,-1)}function Oo(t,e,i){return i((function(){No(e)&&th(t,1,-1)}))}function No(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!fs(t,i)}catch(t){return!0}}function Ho(t){var e=ko();return"function"==typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:t},e.queue=t,t=t.dispatch=sa.bind(null,yo,t),[e.memoizedState,t]}function Uo(t,e,i,s){return t={tag:t,create:e,destroy:i,deps:s,next:null},null===(e=yo.updateQueue)?(e={lastEffect:null,stores:null},yo.updateQueue=e,e.lastEffect=t.next=t):null===(i=e.lastEffect)?e.lastEffect=t.next=t:(s=i.next,i.next=t,t.next=s,e.lastEffect=t),t}function Wo(){return Ro().memoizedState}function Vo(t,e,i,s){var n=ko();yo.flags|=t,n.memoizedState=Uo(1|e,i,void 0,void 0===s?null:s)}function Go(t,e,i,s){var n=Ro();s=void 0===s?null:s;var r=void 0;if(null!==vo){var o=vo.memoizedState;if(r=o.destroy,null!==s&&Eo(s,o.deps))return void(n.memoizedState=Uo(e,i,r,s))}yo.flags|=t,n.memoizedState=Uo(1|e,i,r,s)}function jo(t,e){return Vo(8390656,8,t,e)}function Xo(t,e){return Go(2048,8,t,e)}function qo(t,e){return Go(4,2,t,e)}function Ko(t,e){return Go(4,4,t,e)}function Yo(t,e){return"function"==typeof e?(t=t(),e(t),function(){e(null)}):null!=e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Qo(t,e,i){return i=null!=i?i.concat([t]):null,Go(4,4,Yo.bind(null,e,t),i)}function $o(){}function Zo(t,e){var i=Ro();e=void 0===e?null:e;var s=i.memoizedState;return null!==s&&null!==e&&Eo(e,s[1])?s[0]:(i.memoizedState=[t,e],t)}function Jo(t,e){var i=Ro();e=void 0===e?null:e;var s=i.memoizedState;return null!==s&&null!==e&&Eo(e,s[1])?s[0]:(t=t(),i.memoizedState=[t,e],t)}function ta(t,e){var i=Ie;Ie=0!==i&&4>i?i:4,t(!0);var s=mo.transition;mo.transition={};try{t(!1),e()}finally{Ie=i,mo.transition=s}}function ea(){return Ro().memoizedState}function ia(t,e,i){var s=Jl(t);i={lane:s,action:i,hasEagerState:!1,eagerState:null,next:null},na(t)?ra(e,i):(oa(t,e,i),null!==(t=th(t,s,i=Zl()))&&aa(t,e,s))}function sa(t,e,i){var s=Jl(t),n={lane:s,action:i,hasEagerState:!1,eagerState:null,next:null};if(na(t))ra(e,n);else{oa(t,e,n);var r=t.alternate;if(0===t.lanes&&(null===r||0===r.lanes)&&null!==(r=e.lastRenderedReducer))try{var o=e.lastRenderedState,a=r(o,i);if(n.hasEagerState=!0,n.eagerState=a,fs(a,o))return}catch(t){}null!==(t=th(t,s,i=Zl()))&&aa(t,e,s)}}function na(t){var e=t.alternate;return t===yo||null!==e&&e===yo}function ra(t,e){bo=xo=!0;var i=t.pending;null===i?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function oa(t,e,i){null!==Al&&0!=(1&t.mode)&&0==(2&Pl)?(null===(t=e.interleaved)?(i.next=i,null===ar?ar=[e]:ar.push(e)):(i.next=t.next,t.next=i),e.interleaved=i):(null===(t=e.pending)?i.next=i:(i.next=t.next,t.next=i),e.pending=i)}function aa(t,e,i){if(0!=(4194240&i)){var s=e.lanes;i|=s&=t.pendingLanes,e.lanes=i,Re(t,i)}}var la={readContext:or,useCallback:To,useContext:To,useEffect:To,useImperativeHandle:To,useInsertionEffect:To,useLayoutEffect:To,useMemo:To,useReducer:To,useRef:To,useState:To,useDebugValue:To,useDeferredValue:To,useTransition:To,useMutableSource:To,useSyncExternalStore:To,useId:To,unstable_isNewReconciler:!1},ha={readContext:or,useCallback:function(t,e){return ko().memoizedState=[t,void 0===e?null:e],t},useContext:or,useEffect:jo,useImperativeHandle:function(t,e,i){return i=null!=i?i.concat([t]):null,Vo(4194308,4,Yo.bind(null,e,t),i)},useLayoutEffect:function(t,e){return Vo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Vo(4,2,t,e)},useMemo:function(t,e){var i=ko();return e=void 0===e?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var s=ko();return e=void 0!==i?i(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=ia.bind(null,yo,t),[s.memoizedState,t]},useRef:function(t){return t={current:t},ko().memoizedState=t},useState:Ho,useDebugValue:$o,useDeferredValue:function(t){var e=Ho(t),i=e[0],s=e[1];return jo((function(){var e=mo.transition;mo.transition={};try{s(t)}finally{mo.transition=e}}),[t]),i},useTransition:function(){var t=Ho(!1),e=t[0];return t=ta.bind(null,t[1]),ko().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var s=yo,n=ko();if(Nr){if(void 0===i)throw Error(y(407));i=i()}else{if(i=e(),null===Al)throw Error(y(349));0!=(30&_o)||Lo(s,e,i)}n.memoizedState=i;var r={value:i,getSnapshot:e};return n.queue=r,jo(Oo.bind(null,s,r,t),[t]),s.flags|=2048,Uo(9,zo.bind(null,s,r,i,e),void 0,null),i},useId:function(){var t=ko(),e=Al.identifierPrefix;if(Nr){var i=Fr;e=":"+e+"R"+(i=(Ir&~(1<<32-ve(Ir)-1)).toString(32)+i),0<(i=So++)&&(e+="H"+i.toString(32)),e+=":"}else e=":"+e+"r"+(i=Co++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ca={readContext:or,useCallback:Zo,useContext:or,useEffect:Xo,useImperativeHandle:Qo,useInsertionEffect:qo,useLayoutEffect:Ko,useMemo:Jo,useReducer:Fo,useRef:Wo,useState:function(){return Fo(Io)},useDebugValue:$o,useDeferredValue:function(t){var e=Fo(Io),i=e[0],s=e[1];return Xo((function(){var e=mo.transition;mo.transition={};try{s(t)}finally{mo.transition=e}}),[t]),i},useTransition:function(){return[Fo(Io)[0],Ro().memoizedState]},useMutableSource:Mo,useSyncExternalStore:Bo,useId:ea,unstable_isNewReconciler:!1},ua={readContext:or,useCallback:Zo,useContext:or,useEffect:Xo,useImperativeHandle:Qo,useInsertionEffect:qo,useLayoutEffect:Ko,useMemo:Jo,useReducer:Do,useRef:Wo,useState:function(){return Do(Io)},useDebugValue:$o,useDeferredValue:function(t){var e=Do(Io),i=e[0],s=e[1];return Xo((function(){var e=mo.transition;mo.transition={};try{s(t)}finally{mo.transition=e}}),[t]),i},useTransition:function(){return[Do(Io)[0],Ro().memoizedState]},useMutableSource:Mo,useSyncExternalStore:Bo,useId:ea,unstable_isNewReconciler:!1};function da(t,e){try{var i="",s=e;do{i+=tt(s),s=s.return}while(s);var n=i}catch(t){n="\nError generating stack: "+t.message+"\n"+t.stack}return{value:t,source:e,stack:n}}function pa(t,e){try{console.error(e.value)}catch(t){setTimeout((function(){throw t}))}}var fa,ga,ma,_a="function"==typeof WeakMap?WeakMap:Map;function ya(t,e,i){(i=ur(-1,i)).tag=3,i.payload={element:null};var s=e.value;return i.callback=function(){Wl||(Wl=!0,Vl=s),pa(0,e)},i}function va(t,e,i){(i=ur(-1,i)).tag=3;var s=t.type.getDerivedStateFromError;if("function"==typeof s){var n=e.value;i.payload=function(){return s(n)},i.callback=function(){pa(0,e)}}var r=t.stateNode;return null!==r&&"function"==typeof r.componentDidCatch&&(i.callback=function(){pa(0,e),"function"!=typeof s&&(null===Gl?Gl=new Set([this]):Gl.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),i}function wa(t,e,i){var s=t.pingCache;if(null===s){s=t.pingCache=new _a;var n=new Set;s.set(e,n)}else void 0===(n=s.get(e))&&(n=new Set,s.set(e,n));n.has(i)||(n.add(i),t=Ch.bind(null,t,e,i),e.then(t,t))}function xa(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function ba(t,e,i,s,n){return 0==(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((e=ur(-1,1)).tag=2,dr(i,e))),i.lanes|=1),t):(t.flags|=65536,t.lanes=n,t)}function Sa(t,e){if(!Nr)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;null!==e;)null!==e.alternate&&(i=e),e=e.sibling;null===i?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var s=null;null!==i;)null!==i.alternate&&(s=i),i=i.sibling;null===s?e||null===t.tail?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Ca(t){var e=null!==t.alternate&&t.alternate.child===t.child,i=0,s=0;if(e)for(var n=t.child;null!==n;)i|=n.lanes|n.childLanes,s|=14680064&n.subtreeFlags,s|=14680064&n.flags,n.return=t,n=n.sibling;else for(n=t.child;null!==n;)i|=n.lanes|n.childLanes,s|=n.subtreeFlags,s|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=s,t.childLanes=i,e}function Ta(t,e,i){var s=e.pendingProps;switch(Lr(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ca(e),null;case 1:case 17:return Nn(e.type)&&Hn(),Ca(e),null;case 3:return s=e.stateNode,ao(),Fn(Ln),Fn(Bn),fo(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==t&&null!==t.child||(Xr(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0==(256&e.flags)||(e.flags|=1024,null!==Hr&&(rh(Hr),Hr=null))),Ca(e),null;case 5:ho(e);var n=ro(no.current);if(i=e.type,null!==t&&null!=e.stateNode)ga(t,e,i,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(null===e.stateNode)throw Error(y(166));return Ca(e),null}if(t=ro(io.current),Xr(e)){s=e.stateNode,i=e.type;var r=e.memoizedProps;switch(s[vn]=e,s[wn]=r,t=0!=(1&e.mode),i){case"dialog":Xs("cancel",s),Xs("close",s);break;case"iframe":case"object":case"embed":Xs("load",s);break;case"video":case"audio":for(n=0;n<Ws.length;n++)Xs(Ws[n],s);break;case"source":Xs("error",s);break;case"img":case"image":case"link":Xs("error",s),Xs("load",s);break;case"details":Xs("toggle",s);break;case"input":ht(s,r),Xs("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},Xs("invalid",s);break;case"textarea":_t(s,r),Xs("invalid",s)}for(var o in It(i,r),n=null,r)if(r.hasOwnProperty(o)){var a=r[o];"children"===o?"string"==typeof a?s.textContent!==a&&(on(s.textContent,a,t),n=["children",a]):"number"==typeof a&&s.textContent!==""+a&&(on(s.textContent,a,t),n=["children",""+a]):w.hasOwnProperty(o)&&null!=a&&"onScroll"===o&&Xs("scroll",s)}switch(i){case"input":rt(s),dt(s,r,!0);break;case"textarea":rt(s),vt(s);break;case"select":case"option":break;default:"function"==typeof r.onClick&&(s.onclick=an)}s=n,e.updateQueue=s,null!==s&&(e.flags|=4)}else{o=9===n.nodeType?n:n.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=wt(i)),"http://www.w3.org/1999/xhtml"===t?"script"===i?((t=o.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"==typeof s.is?t=o.createElement(i,{is:s.is}):(t=o.createElement(i),"select"===i&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,i),t[vn]=e,t[wn]=s,fa(t,e),e.stateNode=t;t:{switch(o=Ft(i,s),i){case"dialog":Xs("cancel",t),Xs("close",t),n=s;break;case"iframe":case"object":case"embed":Xs("load",t),n=s;break;case"video":case"audio":for(n=0;n<Ws.length;n++)Xs(Ws[n],t);n=s;break;case"source":Xs("error",t),n=s;break;case"img":case"image":case"link":Xs("error",t),Xs("load",t),n=s;break;case"details":Xs("toggle",t),n=s;break;case"input":ht(t,s),n=lt(t,s),Xs("invalid",t);break;case"option":default:n=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},n=Q({},s,{value:void 0}),Xs("invalid",t);break;case"textarea":_t(t,s),n=mt(t,s),Xs("invalid",t)}for(r in It(i,n),a=n)if(a.hasOwnProperty(r)){var l=a[r];"style"===r?kt(t,l):"dangerouslySetInnerHTML"===r?null!=(l=l?l.__html:void 0)&&Ct(t,l):"children"===r?"string"==typeof l?("textarea"!==i||""!==l)&&Tt(t,l):"number"==typeof l&&Tt(t,""+l):"suppressContentEditableWarning"!==r&&"suppressHydrationWarning"!==r&&"autoFocus"!==r&&(w.hasOwnProperty(r)?null!=l&&"onScroll"===r&&Xs("scroll",t):null!=l&&F(t,r,l,o))}switch(i){case"input":rt(t),dt(t,s,!1);break;case"textarea":rt(t),vt(t);break;case"option":null!=s.value&&t.setAttribute("value",""+st(s.value));break;case"select":t.multiple=!!s.multiple,null!=(r=s.value)?gt(t,!!s.multiple,r,!1):null!=s.defaultValue&&gt(t,!!s.multiple,s.defaultValue,!0);break;default:"function"==typeof n.onClick&&(t.onclick=an)}switch(i){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break t;case"img":s=!0;break t;default:s=!1}}s&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Ca(e),null;case 6:if(t&&null!=e.stateNode)ma(0,e,t.memoizedProps,s);else{if("string"!=typeof s&&null===e.stateNode)throw Error(y(166));if(i=ro(no.current),ro(io.current),Xr(e)){if(s=e.stateNode,i=e.memoizedProps,s[vn]=e,(r=s.nodeValue!==i)&&null!==(t=zr))switch(o=0!=(1&t.mode),t.tag){case 3:on(s.nodeValue,i,o);break;case 5:!0!==t.memoizedProps[void 0]&&on(s.nodeValue,i,o)}r&&(e.flags|=4)}else(s=(9===i.nodeType?i:i.ownerDocument).createTextNode(s))[vn]=e,e.stateNode=s}return Ca(e),null;case 13:if(Fn(co),s=e.memoizedState,Nr&&null!==Or&&0!=(1&e.mode)&&0==(128&e.flags)){for(s=Or;s;)s=mn(s.nextSibling);return qr(),e.flags|=98560,e}if(null!==s&&null!==s.dehydrated){if(s=Xr(e),null===t){if(!s)throw Error(y(318));if(!(s=null!==(s=e.memoizedState)?s.dehydrated:null))throw Error(y(317));s[vn]=e}else qr(),0==(128&e.flags)&&(e.memoizedState=null),e.flags|=4;return Ca(e),null}return null!==Hr&&(rh(Hr),Hr=null),0!=(128&e.flags)?(e.lanes=i,e):(s=null!==s,i=!1,null===t?Xr(e):i=null!==t.memoizedState,s&&!i&&(e.child.flags|=8192,0!=(1&e.mode)&&(null===t||0!=(1&co.current)?0===Dl&&(Dl=3):fh())),null!==e.updateQueue&&(e.flags|=4),Ca(e),null);case 4:return ao(),null===t&&Ys(e.stateNode.containerInfo),Ca(e),null;case 10:return sr(e.type._context),Ca(e),null;case 19:if(Fn(co),null===(r=e.memoizedState))return Ca(e),null;if(s=0!=(128&e.flags),null===(o=r.rendering))if(s)Sa(r,!1);else{if(0!==Dl||null!==t&&0!=(128&t.flags))for(t=e.child;null!==t;){if(null!==(o=uo(t))){for(e.flags|=128,Sa(r,!1),null!==(s=o.updateQueue)&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=i,i=e.child;null!==i;)t=s,(r=i).flags&=14680066,null===(o=r.alternate)?(r.childLanes=0,r.lanes=t,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,t=o.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Dn(co,1&co.current|2),e.child}t=t.sibling}null!==r.tail&&ce()>Ul&&(e.flags|=128,s=!0,Sa(r,!1),e.lanes=4194304)}else{if(!s)if(null!==(t=uo(o))){if(e.flags|=128,s=!0,null!==(i=t.updateQueue)&&(e.updateQueue=i,e.flags|=4),Sa(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!Nr)return Ca(e),null}else 2*ce()-r.renderingStartTime>Ul&&1073741824!==i&&(e.flags|=128,s=!0,Sa(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(null!==(i=r.last)?i.sibling=o:e.child=o,r.last=o)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ce(),e.sibling=null,i=co.current,Dn(co,s?1&i|2:1&i),e):(Ca(e),null);case 22:case 23:return ch(),s=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==s&&(e.flags|=8192),s&&0!=(1&e.mode)?0!=(1073741824&Il)&&(Ca(e),6&e.subtreeFlags&&(e.flags|=8192)):Ca(e),null;case 24:case 25:return null}throw Error(y(156,e.tag))}fa=function(t,e){for(var i=e.child;null!==i;){if(5===i.tag||6===i.tag)t.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},ga=function(t,e,i,s){var n=t.memoizedProps;if(n!==s){t=e.stateNode,ro(io.current);var r,o=null;switch(i){case"input":n=lt(t,n),s=lt(t,s),o=[];break;case"select":n=Q({},n,{value:void 0}),s=Q({},s,{value:void 0}),o=[];break;case"textarea":n=mt(t,n),s=mt(t,s),o=[];break;default:"function"!=typeof n.onClick&&"function"==typeof s.onClick&&(t.onclick=an)}for(h in It(i,s),i=null,n)if(!s.hasOwnProperty(h)&&n.hasOwnProperty(h)&&null!=n[h])if("style"===h){var a=n[h];for(r in a)a.hasOwnProperty(r)&&(i||(i={}),i[r]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(w.hasOwnProperty(h)?o||(o=[]):(o=o||[]).push(h,null));for(h in s){var l=s[h];if(a=null!=n?n[h]:void 0,s.hasOwnProperty(h)&&l!==a&&(null!=l||null!=a))if("style"===h)if(a){for(r in a)!a.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(i||(i={}),i[r]="");for(r in l)l.hasOwnProperty(r)&&a[r]!==l[r]&&(i||(i={}),i[r]=l[r])}else i||(o||(o=[]),o.push(h,i)),i=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,a=a?a.__html:void 0,null!=l&&a!==l&&(o=o||[]).push(h,l)):"children"===h?"string"!=typeof l&&"number"!=typeof l||(o=o||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(w.hasOwnProperty(h)?(null!=l&&"onScroll"===h&&Xs("scroll",t),o||a===l||(o=[])):(o=o||[]).push(h,l))}i&&(o=o||[]).push("style",i);var h=o;(e.updateQueue=h)&&(e.flags|=4)}},ma=function(t,e,i,s){i!==s&&(e.flags|=4)};var Ea=D.ReactCurrentOwner,Pa=!1;function Aa(t,e,i,s){e.child=null===t?to(e,null,i,s):Jr(e,t.child,i,s)}function ka(t,e,i,s,n){i=i.render;var r=e.ref;return rr(e,n),s=Po(t,e,i,s,r,n),i=Ao(),null===t||Pa?(Nr&&i&&Br(e),e.flags|=1,Aa(t,e,s,n),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Ya(t,e,n))}function Ra(t,e,i,s,n){if(null===t){var r=i.type;return"function"!=typeof r||Ih(r)||void 0!==r.defaultProps||null!==i.compare||void 0!==i.defaultProps?((t=Dh(i.type,null,s,e,e.mode,n)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=r,Ia(t,e,r,s,n))}if(r=t.child,0==(t.lanes&n)){var o=r.memoizedProps;if((i=null!==(i=i.compare)?i:gs)(o,s)&&t.ref===e.ref)return Ya(t,e,n)}return e.flags|=1,(t=Fh(r,s)).ref=e.ref,t.return=e,e.child=t}function Ia(t,e,i,s,n){if(null!==t&&gs(t.memoizedProps,s)&&t.ref===e.ref){if(Pa=!1,0==(t.lanes&n))return e.lanes=t.lanes,Ya(t,e,n);0!=(131072&t.flags)&&(Pa=!0)}return Ma(t,e,i,s,n)}function Fa(t,e,i){var s=e.pendingProps,n=s.children,r=null!==t?t.memoizedState:null;if("hidden"===s.mode)if(0==(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null},Dn(Fl,Il),Il|=i;else{if(0==(1073741824&i))return t=null!==r?r.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null},e.updateQueue=null,Dn(Fl,Il),Il|=t,null;e.memoizedState={baseLanes:0,cachePool:null},s=null!==r?r.baseLanes:i,Dn(Fl,Il),Il|=s}else null!==r?(s=r.baseLanes|i,e.memoizedState=null):s=i,Dn(Fl,Il),Il|=s;return Aa(t,e,n,i),e.child}function Da(t,e){var i=e.ref;(null===t&&null!==i||null!==t&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function Ma(t,e,i,s,n){var r=Nn(i)?zn:Bn.current;return r=On(e,r),rr(e,n),i=Po(t,e,i,s,r,n),s=Ao(),null===t||Pa?(Nr&&s&&Br(e),e.flags|=1,Aa(t,e,i,n),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Ya(t,e,n))}function Ba(t,e,i,s,n){if(Nn(i)){var r=!0;Vn(e)}else r=!1;if(rr(e,n),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),xr(e,i,s),Sr(e,i,s,n),s=!0;else if(null===t){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,h=i.contextType;"object"==typeof h&&null!==h?h=or(h):h=On(e,h=Nn(i)?zn:Bn.current);var c=i.getDerivedStateFromProps,u="function"==typeof c||"function"==typeof o.getSnapshotBeforeUpdate;u||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==s||l!==h)&&br(e,o,s,h),lr=!1;var d=e.memoizedState;o.state=d,gr(e,s,o,n),l=e.memoizedState,a!==s||d!==l||Ln.current||lr?("function"==typeof c&&(yr(e,i,c,s),l=e.memoizedState),(a=lr||wr(e,i,a,s,d,l,h))?(u||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(e.flags|=4194308)):("function"==typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=h,s=a):("function"==typeof o.componentDidMount&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,cr(t,e),a=e.memoizedProps,h=e.type===e.elementType?a:$n(e.type,a),o.props=h,u=e.pendingProps,d=o.context,"object"==typeof(l=i.contextType)&&null!==l?l=or(l):l=On(e,l=Nn(i)?zn:Bn.current);var p=i.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==u||d!==l)&&br(e,o,s,l),lr=!1,d=e.memoizedState,o.state=d,gr(e,s,o,n);var f=e.memoizedState;a!==u||d!==f||Ln.current||lr?("function"==typeof p&&(yr(e,i,p,s),f=e.memoizedState),(h=lr||wr(e,i,h,s,d,f,l)||!1)?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(s,f,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(s,f,l)),"function"==typeof o.componentDidUpdate&&(e.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=f),o.props=s,o.state=f,o.context=l,s=h):("function"!=typeof o.componentDidUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),s=!1)}return La(t,e,i,s,r,n)}function La(t,e,i,s,n,r){Da(t,e);var o=0!=(128&e.flags);if(!s&&!o)return n&&Gn(e,i,!1),Ya(t,e,r);s=e.stateNode,Ea.current=e;var a=o&&"function"!=typeof i.getDerivedStateFromError?null:s.render();return e.flags|=1,null!==t&&o?(e.child=Jr(e,t.child,null,r),e.child=Jr(e,null,a,r)):Aa(t,e,a,r),e.memoizedState=s.state,n&&Gn(e,i,!0),e.child}function za(t){var e=t.stateNode;e.pendingContext?Un(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Un(0,e.context,!1),oo(t,e.containerInfo)}function Oa(t,e,i,s,n){return qr(),Kr(n),e.flags|=256,Aa(t,e,i,s),e.child}var Na={dehydrated:null,treeContext:null,retryLane:0};function Ha(t){return{baseLanes:t,cachePool:null}}function Ua(t,e,i){var s,n=e.pendingProps,r=co.current,o=!1,a=0!=(128&e.flags);if((s=a)||(s=(null===t||null!==t.memoizedState)&&0!=(2&r)),s?(o=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(r|=1),Dn(co,1&r),null===t)return Gr(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0==(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(r=n.children,t=n.fallback,o?(n=e.mode,o=e.child,r={mode:"hidden",children:r},0==(1&n)&&null!==o?(o.childLanes=0,o.pendingProps=r):o=Bh(r,n,0,null),t=Mh(t,n,i,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Ha(i),e.memoizedState=Na,t):Wa(e,r));if(null!==(r=t.memoizedState)){if(null!==(s=r.dehydrated)){if(a)return 256&e.flags?(e.flags&=-257,ja(t,e,i,Error(y(422)))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(o=n.fallback,r=e.mode,n=Bh({mode:"visible",children:n.children},r,0,null),(o=Mh(o,r,i,null)).flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,0!=(1&e.mode)&&Jr(e,t.child,null,i),e.child.memoizedState=Ha(i),e.memoizedState=Na,o);if(0==(1&e.mode))e=ja(t,e,i,null);else if("$!"===s.data)e=ja(t,e,i,Error(y(419)));else if(n=0!=(i&t.childLanes),Pa||n){if(null!==(n=Al)){switch(i&-i){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(n=0!=(o&(n.suspendedLanes|i))?0:o)&&n!==r.retryLane&&(r.retryLane=n,th(t,n,-1))}fh(),e=ja(t,e,i,Error(y(421)))}else"$?"===s.data?(e.flags|=128,e.child=t.child,e=Eh.bind(null,t),s._reactRetry=e,e=null):(i=r.treeContext,Or=mn(s.nextSibling),zr=e,Nr=!0,Hr=null,null!==i&&(Ar[kr++]=Ir,Ar[kr++]=Fr,Ar[kr++]=Rr,Ir=i.id,Fr=i.overflow,Rr=e),(e=Wa(e,e.pendingProps.children)).flags|=4096);return e}return o?(n=Ga(t,e,n.children,n.fallback,i),o=e.child,r=t.child.memoizedState,o.memoizedState=null===r?Ha(i):{baseLanes:r.baseLanes|i,cachePool:null},o.childLanes=t.childLanes&~i,e.memoizedState=Na,n):(i=Va(t,e,n.children,i),e.memoizedState=null,i)}return o?(n=Ga(t,e,n.children,n.fallback,i),o=e.child,r=t.child.memoizedState,o.memoizedState=null===r?Ha(i):{baseLanes:r.baseLanes|i,cachePool:null},o.childLanes=t.childLanes&~i,e.memoizedState=Na,n):(i=Va(t,e,n.children,i),e.memoizedState=null,i)}function Wa(t,e){return(e=Bh({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Va(t,e,i,s){var n=t.child;return t=n.sibling,i=Fh(n,{mode:"visible",children:i}),0==(1&e.mode)&&(i.lanes=s),i.return=e,i.sibling=null,null!==t&&(null===(s=e.deletions)?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=i}function Ga(t,e,i,s,n){var r=e.mode,o=(t=t.child).sibling,a={mode:"hidden",children:i};return 0==(1&r)&&e.child!==t?((i=e.child).childLanes=0,i.pendingProps=a,e.deletions=null):(i=Fh(t,a)).subtreeFlags=14680064&t.subtreeFlags,null!==o?s=Fh(o,s):(s=Mh(s,r,n,null)).flags|=2,s.return=e,i.return=e,i.sibling=s,e.child=i,s}function ja(t,e,i,s){return null!==s&&Kr(s),Jr(e,t.child,null,i),(t=Wa(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Xa(t,e,i){t.lanes|=e;var s=t.alternate;null!==s&&(s.lanes|=e),nr(t.return,e,i)}function qa(t,e,i,s,n){var r=t.memoizedState;null===r?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:i,tailMode:n}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=i,r.tailMode=n)}function Ka(t,e,i){var s=e.pendingProps,n=s.revealOrder,r=s.tail;if(Aa(t,e,s.children,i),0!=(2&(s=co.current)))s=1&s|2,e.flags|=128;else{if(null!==t&&0!=(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Xa(t,i,e);else if(19===t.tag)Xa(t,i,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Dn(co,s),0==(1&e.mode))e.memoizedState=null;else switch(n){case"forwards":for(i=e.child,n=null;null!==i;)null!==(t=i.alternate)&&null===uo(t)&&(n=i),i=i.sibling;null===(i=n)?(n=e.child,e.child=null):(n=i.sibling,i.sibling=null),qa(e,!1,n,i,r);break;case"backwards":for(i=null,n=e.child,e.child=null;null!==n;){if(null!==(t=n.alternate)&&null===uo(t)){e.child=n;break}t=n.sibling,n.sibling=i,i=n,n=t}qa(e,!0,i,null,r);break;case"together":qa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ya(t,e,i){if(null!==t&&(e.dependencies=t.dependencies),Bl|=e.lanes,0==(i&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(y(153));if(null!==e.child){for(i=Fh(t=e.child,t.pendingProps),e.child=i,i.return=e;null!==t.sibling;)t=t.sibling,(i=i.sibling=Fh(t,t.pendingProps)).return=e;i.sibling=null}return e.child}function Qa(t,e){switch(Lr(e),e.tag){case 1:return Nn(e.type)&&Hn(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return ao(),Fn(Ln),Fn(Bn),fo(),0!=(65536&(t=e.flags))&&0==(128&t)?(e.flags=-65537&t|128,e):null;case 5:return ho(e),null;case 13:if(Fn(co),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(y(340));qr()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return Fn(co),null;case 4:return ao(),null;case 10:return sr(e.type._context),null;case 22:case 23:return ch(),null;default:return null}}var $a=!1,Za=!1,Ja="function"==typeof WeakSet?WeakSet:Set,tl=null;function el(t,e){var i=t.ref;if(null!==i)if("function"==typeof i)try{i(null)}catch(i){Sh(t,e,i)}else i.current=null}function il(t,e,i){try{i()}catch(i){Sh(t,e,i)}}var sl=!1;function nl(t,e,i){var s=e.updateQueue;if(null!==(s=null!==s?s.lastEffect:null)){var n=s=s.next;do{if((n.tag&t)===t){var r=n.destroy;n.destroy=void 0,void 0!==r&&il(e,i,r)}n=n.next}while(n!==s)}}function rl(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var i=e=e.next;do{if((i.tag&t)===t){var s=i.create;i.destroy=s()}i=i.next}while(i!==e)}}function ol(t){var e=t.ref;if(null!==e){var i=t.stateNode;t.tag,t=i,"function"==typeof e?e(t):e.current=t}}function al(t,e,i){if(ye&&"function"==typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(_e,e)}catch(t){}switch(e.tag){case 0:case 11:case 14:case 15:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var s=t=t.next;do{var n=s,r=n.destroy;n=n.tag,void 0!==r&&(0!=(2&n)||0!=(4&n))&&il(e,i,r),s=s.next}while(s!==t)}break;case 1:if(el(e,i),"function"==typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Sh(e,i,t)}break;case 5:el(e,i);break;case 4:fl(t,e,i)}}function ll(t){var e=t.alternate;null!==e&&(t.alternate=null,ll(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[vn],delete e[wn],delete e[bn],delete e[Sn],delete e[Cn])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hl(t){return 5===t.tag||3===t.tag||4===t.tag}function cl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||hl(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ul(t){t:{for(var e=t.return;null!==e;){if(hl(e))break t;e=e.return}throw Error(y(160))}var i=e;switch(i.tag){case 5:e=i.stateNode,32&i.flags&&(Tt(e,""),i.flags&=-33),pl(t,i=cl(t),e);break;case 3:case 4:e=i.stateNode.containerInfo,dl(t,i=cl(t),e);break;default:throw Error(y(161))}}function dl(t,e,i){var s=t.tag;if(5===s||6===s)t=t.stateNode,e?8===i.nodeType?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(8===i.nodeType?(e=i.parentNode).insertBefore(t,i):(e=i).appendChild(t),null!=(i=i._reactRootContainer)||null!==e.onclick||(e.onclick=an));else if(4!==s&&null!==(t=t.child))for(dl(t,e,i),t=t.sibling;null!==t;)dl(t,e,i),t=t.sibling}function pl(t,e,i){var s=t.tag;if(5===s||6===s)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(4!==s&&null!==(t=t.child))for(pl(t,e,i),t=t.sibling;null!==t;)pl(t,e,i),t=t.sibling}function fl(t,e,i){for(var s,n,r=e,o=!1;;){if(!o){o=r.return;t:for(;;){if(null===o)throw Error(y(160));switch(s=o.stateNode,o.tag){case 5:n=!1;break t;case 3:case 4:s=s.containerInfo,n=!0;break t}o=o.return}o=!0}if(5===r.tag||6===r.tag){t:for(var a=t,l=r,h=i,c=l;;)if(al(a,c,h),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break t;for(;null===c.sibling;){if(null===c.return||c.return===l)break t;c=c.return}c.sibling.return=c.return,c=c.sibling}n?(a=s,l=r.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):s.removeChild(r.stateNode)}else if(18===r.tag)n?(a=s,l=r.stateNode,8===a.nodeType?gn(a.parentNode,l):1===a.nodeType&&gn(a,l),ti(a)):gn(s,r.stateNode);else if(4===r.tag){if(null!==r.child){s=r.stateNode.containerInfo,n=!0,r.child.return=r,r=r.child;continue}}else if(al(t,r,i),null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;4===(r=r.return).tag&&(o=!1)}r.sibling.return=r.return,r=r.sibling}}function gl(t,e){switch(e.tag){case 0:case 11:case 14:case 15:return nl(3,e,e.return),rl(3,e),void nl(5,e,e.return);case 1:case 12:case 17:return;case 5:var i=e.stateNode;if(null!=i){var s=e.memoizedProps,n=null!==t?t.memoizedProps:s;t=e.type;var r=e.updateQueue;if(e.updateQueue=null,null!==r){for("input"===t&&"radio"===s.type&&null!=s.name&&ct(i,s),Ft(t,n),e=Ft(t,s),n=0;n<r.length;n+=2){var o=r[n],a=r[n+1];"style"===o?kt(i,a):"dangerouslySetInnerHTML"===o?Ct(i,a):"children"===o?Tt(i,a):F(i,o,a,e)}switch(t){case"input":ut(i,s);break;case"textarea":yt(i,s);break;case"select":t=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!s.multiple,null!=(r=s.value)?gt(i,!!s.multiple,r,!1):t!==!!s.multiple&&(null!=s.defaultValue?gt(i,!!s.multiple,s.defaultValue,!0):gt(i,!!s.multiple,s.multiple?[]:"",!1))}i[wn]=s}}return;case 6:if(null===e.stateNode)throw Error(y(162));return void(e.stateNode.nodeValue=e.memoizedProps);case 3:return void(null!==t&&t.memoizedState.isDehydrated&&ti(e.stateNode.containerInfo));case 13:case 19:return void ml(e)}throw Error(y(163))}function ml(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var i=t.stateNode;null===i&&(i=t.stateNode=new Ja),e.forEach((function(e){var s=Ph.bind(null,t,e);i.has(e)||(i.add(e),e.then(s,s))}))}}function _l(t,e,i){tl=t,yl(t,e,i)}function yl(t,e,i){for(var s=0!=(1&t.mode);null!==tl;){var n=tl,r=n.child;if(22===n.tag&&s){var o=null!==n.memoizedState||$a;if(!o){var a=n.alternate,l=null!==a&&null!==a.memoizedState||Za;a=$a;var h=Za;if($a=o,(Za=l)&&!h)for(tl=n;null!==tl;)l=(o=tl).child,22===o.tag&&null!==o.memoizedState?xl(n):null!==l?(l.return=o,tl=l):xl(n);for(;null!==r;)tl=r,yl(r,e,i),r=r.sibling;tl=n,$a=a,Za=h}vl(t)}else 0!=(8772&n.subtreeFlags)&&null!==r?(r.return=n,tl=r):vl(t)}}function vl(t){for(;null!==tl;){var e=tl;if(0!=(8772&e.flags)){var i=e.alternate;try{if(0!=(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Za||rl(5,e);break;case 1:var s=e.stateNode;if(4&e.flags&&!Za)if(null===i)s.componentDidMount();else{var n=e.elementType===e.type?i.memoizedProps:$n(e.type,i.memoizedProps);s.componentDidUpdate(n,i.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;null!==r&&mr(e,r,s);break;case 3:var o=e.updateQueue;if(null!==o){if(i=null,null!==e.child)switch(e.child.tag){case 5:case 1:i=e.child.stateNode}mr(e,o,i)}break;case 5:var a=e.stateNode;if(null===i&&4&e.flags){i=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(null===e.memoizedState){var h=e.alternate;if(null!==h){var c=h.memoizedState;if(null!==c){var u=c.dehydrated;null!==u&&ti(u)}}}break;default:throw Error(y(163))}Za||512&e.flags&&ol(e)}catch(t){Sh(e,e.return,t)}}if(e===t){tl=null;break}if(null!==(i=e.sibling)){i.return=e.return,tl=i;break}tl=e.return}}function wl(t){for(;null!==tl;){var e=tl;if(e===t){tl=null;break}var i=e.sibling;if(null!==i){i.return=e.return,tl=i;break}tl=e.return}}function xl(t){for(;null!==tl;){var e=tl;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{rl(4,e)}catch(t){Sh(e,i,t)}break;case 1:var s=e.stateNode;if("function"==typeof s.componentDidMount){var n=e.return;try{s.componentDidMount()}catch(t){Sh(e,n,t)}}var r=e.return;try{ol(e)}catch(t){Sh(e,r,t)}break;case 5:var o=e.return;try{ol(e)}catch(t){Sh(e,o,t)}}}catch(t){Sh(e,e.return,t)}if(e===t){tl=null;break}var a=e.sibling;if(null!==a){a.return=e.return,tl=a;break}tl=e.return}}var bl,Sl=Math.ceil,Cl=D.ReactCurrentDispatcher,Tl=D.ReactCurrentOwner,El=D.ReactCurrentBatchConfig,Pl=0,Al=null,kl=null,Rl=0,Il=0,Fl=In(0),Dl=0,Ml=null,Bl=0,Ll=0,zl=0,Ol=null,Nl=null,Hl=0,Ul=1/0,Wl=!1,Vl=null,Gl=null,jl=!1,Xl=null,ql=0,Kl=0,Yl=null,Ql=-1,$l=0;function Zl(){return 0!=(6&Pl)?ce():-1!==Ql?Ql:Ql=ce()}function Jl(t){return 0==(1&t.mode)?1:0!=(2&Pl)&&0!==Rl?Rl&-Rl:null!==Qn.transition?(0===$l&&(t=be,0==(4194240&(be<<=1))&&(be=64),$l=t),$l):0!==(t=Ie)?t:t=void 0===(t=window.event)?16:ai(t.type)}function th(t,e,i){if(50<Kl)throw Kl=0,Yl=null,Error(y(185));var s=eh(t,e);return null===s?null:(ke(s,e,i),0!=(2&Pl)&&s===Al||(s===Al&&(0==(2&Pl)&&(Ll|=e),4===Dl&&oh(s,Rl)),ih(s,i),1===e&&0===Pl&&0==(1&t.mode)&&(Ul=ce()+500,Xn&&Yn())),s)}function eh(t,e){t.lanes|=e;var i=t.alternate;for(null!==i&&(i.lanes|=e),i=t,t=t.return;null!==t;)t.childLanes|=e,null!==(i=t.alternate)&&(i.childLanes|=e),i=t,t=t.return;return 3===i.tag?i.stateNode:null}function ih(t,e){var i=t.callbackNode;!function(t,e){for(var i=t.suspendedLanes,s=t.pingedLanes,n=t.expirationTimes,r=t.pendingLanes;0<r;){var o=31-ve(r),a=1<<o,l=n[o];-1===l?0!=(a&i)&&0==(a&s)||(n[o]=Ee(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}}(t,e);var s,n=Te(t,t===Al?Rl:0);if(0===n)null!==i&&ae(i),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(null!=i&&ae(i),1===e)0===t.tag?(s=ah.bind(null,t),Xn=!0,Kn(s)):Kn(ah.bind(null,t)),pn((function(){0===Pl&&Yn()})),i=null;else{switch(Fe(n)){case 1:i=de;break;case 4:i=pe;break;case 16:default:i=fe;break;case 536870912:i=me}i=Ah(i,sh.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function sh(t,e){if(Ql=-1,$l=0,0!=(6&Pl))throw Error(y(327));var i=t.callbackNode;if(xh()&&t.callbackNode!==i)return null;var s=Te(t,t===Al?Rl:0);if(0===s)return null;if(0!=(30&s)||0!=(s&t.expiredLanes)||e)e=gh(t,s);else{e=s;var n=Pl;Pl|=2;var r=ph();for(Al===t&&Rl===e||(Ul=ce()+500,uh(t,e));;)try{_h();break}catch(e){dh(t,e)}ir(),Cl.current=r,Pl=n,null!==kl?e=0:(Al=null,Rl=0,e=Dl)}if(0!==e){if(2===e&&(0!==(n=Pe(t))&&(s=n,e=nh(t,n))),1===e)throw i=Ml,uh(t,0),oh(t,s),ih(t,ce()),i;if(6===e)oh(t,s);else{if(n=t.current.alternate,0==(30&s)&&!function(t){for(var e=t;;){if(16384&e.flags){var i=e.updateQueue;if(null!==i&&null!==(i=i.stores))for(var s=0;s<i.length;s++){var n=i[s],r=n.getSnapshot;n=n.value;try{if(!fs(r(),n))return!1}catch(t){return!1}}}if(i=e.child,16384&e.subtreeFlags&&null!==i)i.return=e,e=i;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(n)&&(2===(e=gh(t,s))&&(0!==(r=Pe(t))&&(s=r,e=nh(t,r))),1===e))throw i=Ml,uh(t,0),oh(t,s),ih(t,ce()),i;switch(t.finishedWork=n,t.finishedLanes=s,e){case 0:case 1:throw Error(y(345));case 2:case 5:wh(t,Nl);break;case 3:if(oh(t,s),(130023424&s)===s&&10<(e=Hl+500-ce())){if(0!==Te(t,0))break;if(((n=t.suspendedLanes)&s)!==s){Zl(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=cn(wh.bind(null,t,Nl),e);break}wh(t,Nl);break;case 4:if(oh(t,s),(4194240&s)===s)break;for(e=t.eventTimes,n=-1;0<s;){var o=31-ve(s);r=1<<o,(o=e[o])>n&&(n=o),s&=~r}if(s=n,10<(s=(120>(s=ce()-s)?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Sl(s/1960))-s)){t.timeoutHandle=cn(wh.bind(null,t,Nl),s);break}wh(t,Nl);break;default:throw Error(y(329))}}}return ih(t,ce()),t.callbackNode===i?sh.bind(null,t):null}function nh(t,e){var i=Ol;return t.current.memoizedState.isDehydrated&&(uh(t,e).flags|=256),2!==(t=gh(t,e))&&(e=Nl,Nl=i,null!==e&&rh(e)),t}function rh(t){null===Nl?Nl=t:Nl.push.apply(Nl,t)}function oh(t,e){for(e&=~zl,e&=~Ll,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-ve(e),s=1<<i;t[i]=-1,e&=~s}}function ah(t){if(0!=(6&Pl))throw Error(y(327));xh();var e=Te(t,0);if(0==(1&e))return ih(t,ce()),null;var i=gh(t,e);if(0!==t.tag&&2===i){var s=Pe(t);0!==s&&(e=s,i=nh(t,s))}if(1===i)throw i=Ml,uh(t,0),oh(t,e),ih(t,ce()),i;if(6===i)throw Error(y(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wh(t,Nl),ih(t,ce()),null}function lh(t,e){var i=Pl;Pl|=1;try{return t(e)}finally{0===(Pl=i)&&(Ul=ce()+500,Xn&&Yn())}}function hh(t){null!==Xl&&0===Xl.tag&&0==(6&Pl)&&xh();var e=Pl;Pl|=1;var i=El.transition,s=Ie;try{if(El.transition=null,Ie=1,t)return t()}finally{Ie=s,El.transition=i,0==(6&(Pl=e))&&Yn()}}function ch(){Il=Fl.current,Fn(Fl)}function uh(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(-1!==i&&(t.timeoutHandle=-1,un(i)),null!==kl)for(i=kl.return;null!==i;){var s=i;switch(Lr(s),s.tag){case 1:null!=(s=s.type.childContextTypes)&&Hn();break;case 3:ao(),Fn(Ln),Fn(Bn),fo();break;case 5:ho(s);break;case 4:ao();break;case 13:case 19:Fn(co);break;case 10:sr(s.type._context);break;case 22:case 23:ch()}i=i.return}if(Al=t,kl=t=Fh(t.current,null),Rl=Il=e,Dl=0,Ml=null,zl=Ll=Bl=0,Nl=Ol=null,null!==ar){for(e=0;e<ar.length;e++)if(null!==(s=(i=ar[e]).interleaved)){i.interleaved=null;var n=s.next,r=i.pending;if(null!==r){var o=r.next;r.next=n,s.next=o}i.pending=s}ar=null}return t}function dh(t,e){for(;;){var i=kl;try{if(ir(),go.current=la,xo){for(var s=yo.memoizedState;null!==s;){var n=s.queue;null!==n&&(n.pending=null),s=s.next}xo=!1}if(_o=0,wo=vo=yo=null,bo=!1,So=0,Tl.current=null,null===i||null===i.return){Dl=1,Ml=e,kl=null;break}t:{var r=t,o=i.return,a=i,l=e;if(e=Rl,a.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var h=l,c=a,u=c.tag;if(0==(1&c.mode)&&(0===u||11===u||15===u)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=xa(o);if(null!==p){p.flags&=-257,ba(p,o,a,0,e),1&p.mode&&wa(r,h,e),l=h;var f=(e=p).updateQueue;if(null===f){var g=new Set;g.add(l),e.updateQueue=g}else f.add(l);break t}if(0==(1&e)){wa(r,h,e),fh();break t}l=Error(y(426))}else if(Nr&&1&a.mode){var m=xa(o);if(null!==m){0==(65536&m.flags)&&(m.flags|=256),ba(m,o,a,0,e),Kr(l);break t}}r=l,4!==Dl&&(Dl=2),null===Ol?Ol=[r]:Ol.push(r),l=da(l,a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e,fr(a,ya(0,l,e));break t;case 1:r=l;var _=a.type,v=a.stateNode;if(0==(128&a.flags)&&("function"==typeof _.getDerivedStateFromError||null!==v&&"function"==typeof v.componentDidCatch&&(null===Gl||!Gl.has(v)))){a.flags|=65536,e&=-e,a.lanes|=e,fr(a,va(a,r,e));break t}}a=a.return}while(null!==a)}vh(i)}catch(t){e=t,kl===i&&null!==i&&(kl=i=i.return);continue}break}}function ph(){var t=Cl.current;return Cl.current=la,null===t?la:t}function fh(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Al||0==(268435455&Bl)&&0==(268435455&Ll)||oh(Al,Rl)}function gh(t,e){var i=Pl;Pl|=2;var s=ph();for(Al===t&&Rl===e||uh(t,e);;)try{mh();break}catch(e){dh(t,e)}if(ir(),Pl=i,Cl.current=s,null!==kl)throw Error(y(261));return Al=null,Rl=0,Dl}function mh(){for(;null!==kl;)yh(kl)}function _h(){for(;null!==kl&&!le();)yh(kl)}function yh(t){var e=bl(t.alternate,t,Il);t.memoizedProps=t.pendingProps,null===e?vh(t):kl=e,Tl.current=null}function vh(t){var e=t;do{var i=e.alternate;if(t=e.return,0==(32768&e.flags)){if(null!==(i=Ta(i,e,Il)))return void(kl=i)}else{if(null!==(i=Qa(i,e)))return i.flags&=32767,void(kl=i);if(null===t)return Dl=6,void(kl=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(kl=e);kl=e=t}while(null!==e);0===Dl&&(Dl=5)}function wh(t,e){var i=Ie,s=El.transition;try{El.transition=null,Ie=1,function(t,e,i){do{xh()}while(null!==Xl);if(0!=(6&Pl))throw Error(y(327));var s=t.finishedWork,n=t.finishedLanes;if(null===s)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(y(177));t.callbackNode=null,t.callbackPriority=0;var r=s.lanes|s.childLanes;if(function(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<i;){var n=31-ve(i),r=1<<n;e[n]=0,s[n]=-1,t[n]=-1,i&=~r}}(t,r),t===Al&&(kl=Al=null,Rl=0),0==(2064&s.subtreeFlags)&&0==(2064&s.flags)||jl||(jl=!0,Ah(fe,(function(){return xh(),null}))),r=0!=(15990&s.flags),0!=(15990&s.subtreeFlags)||r){r=El.transition,El.transition=null;var o=Ie;Ie=1;var a=Pl;Pl|=4,Tl.current=null,function(t,e){if(ws(t=vs())){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else t:{var s=(i=(i=t.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(s&&0!==s.rangeCount){i=s.anchorNode;var n=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{i.nodeType,r.nodeType}catch(t){i=null;break t}var o=0,a=-1,l=-1,h=0,c=0,u=t,d=null;e:for(;;){for(var p;u!==i||0!==n&&3!==u.nodeType||(a=o+n),u!==r||0!==s&&3!==u.nodeType||(l=o+s),3===u.nodeType&&(o+=u.nodeValue.length),null!==(p=u.firstChild);)d=u,u=p;for(;;){if(u===t)break e;if(d===i&&++h===n&&(a=o),d===r&&++c===s&&(l=o),null!==(p=u.nextSibling))break;d=(u=d).parentNode}u=p}i=-1===a||-1===l?null:{start:a,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(ln={focusedElem:t,selectionRange:i},tl=e;null!==tl;)if(t=(e=tl).child,0!=(1028&e.subtreeFlags)&&null!==t)t.return=e,tl=t;else for(;null!==tl;){e=tl;try{var f=e.alternate;if(0!=(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,m=f.memoizedState,_=e.stateNode,v=_.getSnapshotBeforeUpdate(e.elementType===e.type?g:$n(e.type,g),m);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;if(1===w.nodeType)w.textContent="";else if(9===w.nodeType){var x=w.body;null!=x&&(x.textContent="")}break;default:throw Error(y(163))}}catch(t){Sh(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,tl=t;break}tl=e.return}f=sl,sl=!1}(t,s),function(t,e){for(tl=e;null!==tl;){var i=(e=tl).deletions;if(null!==i)for(var s=0;s<i.length;s++){var n=i[s];try{fl(t,n,e);var r=n.alternate;null!==r&&(r.return=null),n.return=null}catch(t){Sh(n,e,t)}}if(i=e.child,0!=(12854&e.subtreeFlags)&&null!==i)i.return=e,tl=i;else for(;null!==tl;){e=tl;try{var o=e.flags;if(32&o&&Tt(e.stateNode,""),512&o){var a=e.alternate;if(null!==a){var l=a.ref;null!==l&&("function"==typeof l?l(null):l.current=null)}}if(8192&o)switch(e.tag){case 13:if(null!==e.memoizedState){var h=e.alternate;null!==h&&null!==h.memoizedState||(Hl=ce())}break;case 22:var c=null!==e.memoizedState,u=e.alternate,d=null!==u&&null!==u.memoizedState;t:{n=c;for(var p=null,f=s=i=e;;){if(5===f.tag){if(null===p){p=f;var g=f.stateNode;if(n){var m=g.style;"function"==typeof m.setProperty?m.setProperty("display","none","important"):m.display="none"}else{var _=f.stateNode,y=f.memoizedProps.style,v=null!=y&&y.hasOwnProperty("display")?y.display:null;_.style.display=At("display",v)}}}else if(6===f.tag)null===p&&(f.stateNode.nodeValue=n?"":f.memoizedProps);else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===s)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===s)break;for(;null===f.sibling;){if(null===f.return||f.return===s)break t;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}}if(c&&!d&&0!=(1&i.mode)){tl=i;for(var w=i.child;null!==w;){for(i=tl=w;null!==tl;){var x=(s=tl).child;switch(s.tag){case 0:case 11:case 14:case 15:nl(4,s,s.return);break;case 1:el(s,s.return);var b=s.stateNode;if("function"==typeof b.componentWillUnmount){var S=s.return;try{b.props=s.memoizedProps,b.state=s.memoizedState,b.componentWillUnmount()}catch(t){Sh(s,S,t)}}break;case 5:el(s,s.return);break;case 22:if(null!==s.memoizedState){wl(i);continue}}null!==x?(x.return=s,tl=x):wl(i)}w=w.sibling}}}switch(4102&o){case 2:ul(e),e.flags&=-3;break;case 6:ul(e),e.flags&=-3,gl(e.alternate,e);break;case 4096:e.flags&=-4097;break;case 4100:e.flags&=-4097,gl(e.alternate,e);break;case 4:gl(e.alternate,e)}}catch(t){Sh(e,e.return,t)}if(null!==(i=e.sibling)){i.return=e.return,tl=i;break}tl=e.return}}}(t,s),xs(ln),ln=null,t.current=s,_l(s,t,n),he(),Pl=a,Ie=o,El.transition=r}else t.current=s;if(jl&&(jl=!1,Xl=t,ql=n),0===(r=t.pendingLanes)&&(Gl=null),function(t){if(ye&&"function"==typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(_e,t,void 0,128==(128&t.current.flags))}catch(t){}}(s.stateNode),ih(t,ce()),null!==e)for(i=t.onRecoverableError,s=0;s<e.length;s++)i(e[s]);if(Wl)throw Wl=!1,t=Vl,Vl=null,t;0!=(1&ql)&&0!==t.tag&&xh(),0!=(1&(r=t.pendingLanes))?t===Yl?Kl++:(Kl=0,Yl=t):Kl=0,Yn()}(t,e,i)}finally{El.transition=s,Ie=i}return null}function xh(){if(null!==Xl){var t=Fe(ql),e=El.transition,i=Ie;try{if(El.transition=null,Ie=16>t?16:t,null===Xl)var s=!1;else{if(t=Xl,Xl=null,ql=0,0!=(6&Pl))throw Error(y(331));var n=Pl;for(Pl|=4,tl=t.current;null!==tl;){var r=tl,o=r.child;if(0!=(16&tl.flags)){var a=r.deletions;if(null!==a){for(var l=0;l<a.length;l++){var h=a[l];for(tl=h;null!==tl;){var c=tl;switch(c.tag){case 0:case 11:case 15:nl(8,c,r)}var u=c.child;if(null!==u)u.return=c,tl=u;else for(;null!==tl;){var d=(c=tl).sibling,p=c.return;if(ll(c),c===h){tl=null;break}if(null!==d){d.return=p,tl=d;break}tl=p}}}var f=r.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}tl=r}}if(0!=(2064&r.subtreeFlags)&&null!==o)o.return=r,tl=o;else t:for(;null!==tl;){if(0!=(2048&(r=tl).flags))switch(r.tag){case 0:case 11:case 15:nl(9,r,r.return)}var _=r.sibling;if(null!==_){_.return=r.return,tl=_;break t}tl=r.return}}var v=t.current;for(tl=v;null!==tl;){var w=(o=tl).child;if(0!=(2064&o.subtreeFlags)&&null!==w)w.return=o,tl=w;else t:for(o=v;null!==tl;){if(0!=(2048&(a=tl).flags))try{switch(a.tag){case 0:case 11:case 15:rl(9,a)}}catch(t){Sh(a,a.return,t)}if(a===o){tl=null;break t}var x=a.sibling;if(null!==x){x.return=a.return,tl=x;break t}tl=a.return}}if(Pl=n,Yn(),ye&&"function"==typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(_e,t)}catch(t){}s=!0}return s}finally{Ie=i,El.transition=e}}return!1}function bh(t,e,i){dr(t,e=ya(0,e=da(i,e),1)),e=Zl(),null!==(t=eh(t,1))&&(ke(t,1,e),ih(t,e))}function Sh(t,e,i){if(3===t.tag)bh(t,t,i);else for(;null!==e;){if(3===e.tag){bh(e,t,i);break}if(1===e.tag){var s=e.stateNode;if("function"==typeof e.type.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&(null===Gl||!Gl.has(s))){dr(e,t=va(e,t=da(i,t),1)),t=Zl(),null!==(e=eh(e,1))&&(ke(e,1,t),ih(e,t));break}}e=e.return}}function Ch(t,e,i){var s=t.pingCache;null!==s&&s.delete(e),e=Zl(),t.pingedLanes|=t.suspendedLanes&i,Al===t&&(Rl&i)===i&&(4===Dl||3===Dl&&(130023424&Rl)===Rl&&500>ce()-Hl?uh(t,0):zl|=i),ih(t,e)}function Th(t,e){0===e&&(0==(1&t.mode)?e=1:(e=Se,0==(130023424&(Se<<=1))&&(Se=4194304)));var i=Zl();null!==(t=eh(t,e))&&(ke(t,e,i),ih(t,i))}function Eh(t){var e=t.memoizedState,i=0;null!==e&&(i=e.retryLane),Th(t,i)}function Ph(t,e){var i=0;switch(t.tag){case 13:var s=t.stateNode,n=t.memoizedState;null!==n&&(i=n.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(y(314))}null!==s&&s.delete(e),Th(t,i)}function Ah(t,e){return oe(t,e)}function kh(t,e,i,s){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rh(t,e,i,s){return new kh(t,e,i,s)}function Ih(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Fh(t,e){var i=t.alternate;return null===i?((i=Rh(t.tag,e,t.key,t.mode)).elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&t.flags,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Dh(t,e,i,s,n,r){var o=2;if(s=t,"function"==typeof t)Ih(t)&&(o=1);else if("string"==typeof t)o=5;else t:switch(t){case L:return Mh(i.children,n,r,e);case z:o=8,n|=8;break;case O:return(t=Rh(12,i,e,2|n)).elementType=O,t.lanes=r,t;case W:return(t=Rh(13,i,e,n)).elementType=W,t.lanes=r,t;case V:return(t=Rh(19,i,e,n)).elementType=V,t.lanes=r,t;case X:return Bh(i,n,r,e);default:if("object"==typeof t&&null!==t)switch(t.$$typeof){case N:o=10;break t;case H:o=9;break t;case U:o=11;break t;case G:o=14;break t;case j:o=16,s=null;break t}throw Error(y(130,null==t?t:typeof t,""))}return(e=Rh(o,i,e,n)).elementType=t,e.type=s,e.lanes=r,e}function Mh(t,e,i,s){return(t=Rh(7,t,s,e)).lanes=i,t}function Bh(t,e,i,s){return(t=Rh(22,t,s,e)).elementType=X,t.lanes=i,t.stateNode={},t}function Lh(t,e,i){return(t=Rh(6,t,null,e)).lanes=i,t}function zh(t,e,i){return(e=Rh(4,null!==t.children?t.children:[],t.key,e)).lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Oh(t,e,i,s,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ae(0),this.expirationTimes=Ae(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ae(0),this.identifierPrefix=s,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Nh(t,e,i,s,n,r,o,a,l){return t=new Oh(t,e,i,a,l),1===e?(e=1,!0===r&&(e|=8)):e=0,r=Rh(3,null,null,e),t.current=r,r.stateNode=t,r.memoizedState={element:s,isDehydrated:i,cache:null,transitions:null},hr(r),t}function Hh(t,e,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:B,key:null==s?null:""+s,children:t,containerInfo:e,implementation:i}}function Uh(t){if(!t)return Mn;t:{if(ee(t=t._reactInternals)!==t||1!==t.tag)throw Error(y(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(y(171))}if(1===t.tag){var i=t.type;if(Nn(i))return Wn(t,i,e)}return e}function Wh(t,e,i,s,n,r,o,a,l){return(t=Nh(i,s,!0,t,0,r,0,a,l)).context=Uh(null),i=t.current,(r=ur(s=Zl(),n=Jl(i))).callback=null!=e?e:null,dr(i,r),t.current.lanes=n,ke(t,n,s),ih(t,s),t}function Vh(t,e,i,s){var n=e.current,r=Zl(),o=Jl(n);return i=Uh(i),null===e.context?e.context=i:e.pendingContext=i,(e=ur(r,o)).payload={element:t},null!==(s=void 0===s?null:s)&&(e.callback=s),dr(n,e),null!==(t=th(n,o,r))&&pr(t,n,o),o}function Gh(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function jh(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var i=t.retryLane;t.retryLane=0!==i&&i<e?i:e}}function Xh(t,e){jh(t,e),(t=t.alternate)&&jh(t,e)}bl=function(t,e,i){if(null!==t)if(t.memoizedProps!==e.pendingProps||Ln.current)Pa=!0;else{if(0==(t.lanes&i)&&0==(128&e.flags))return Pa=!1,function(t,e,i){switch(e.tag){case 3:za(e),qr();break;case 5:lo(e);break;case 1:Nn(e.type)&&Vn(e);break;case 4:oo(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,n=e.memoizedProps.value;Dn(Zn,s._currentValue),s._currentValue=n;break;case 13:if(null!==(s=e.memoizedState))return null!==s.dehydrated?(Dn(co,1&co.current),e.flags|=128,null):0!=(i&e.child.childLanes)?Ua(t,e,i):(Dn(co,1&co.current),null!==(t=Ya(t,e,i))?t.sibling:null);Dn(co,1&co.current);break;case 19:if(s=0!=(i&e.childLanes),0!=(128&t.flags)){if(s)return Ka(t,e,i);e.flags|=128}if(null!==(n=e.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),Dn(co,co.current),s)break;return null;case 22:case 23:return e.lanes=0,Fa(t,e,i)}return Ya(t,e,i)}(t,e,i);Pa=0!=(131072&t.flags)}else Pa=!1,Nr&&0!=(1048576&e.flags)&&Mr(e,Pr,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps;var n=On(e,Bn.current);rr(e,i),n=Po(null,e,s,t,n,i);var r=Ao();return e.flags|=1,"object"==typeof n&&null!==n&&"function"==typeof n.render&&void 0===n.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(s)?(r=!0,Vn(e)):r=!1,e.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,hr(e),n.updater=vr,e.stateNode=n,n._reactInternals=e,Sr(e,s,t,i),e=La(null,e,s,!0,r,i)):(e.tag=0,Nr&&r&&Br(e),Aa(null,e,n,i),e=e.child),e;case 16:s=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,s=(n=s._init)(s._payload),e.type=s,n=e.tag=function(t){if("function"==typeof t)return Ih(t)?1:0;if(null!=t){if((t=t.$$typeof)===U)return 11;if(t===G)return 14}return 2}(s),t=$n(s,t),n){case 0:e=Ma(null,e,s,t,i);break t;case 1:e=Ba(null,e,s,t,i);break t;case 11:e=ka(null,e,s,t,i);break t;case 14:e=Ra(null,e,s,$n(s.type,t),i);break t}throw Error(y(306,s,""))}return e;case 0:return s=e.type,n=e.pendingProps,Ma(t,e,s,n=e.elementType===s?n:$n(s,n),i);case 1:return s=e.type,n=e.pendingProps,Ba(t,e,s,n=e.elementType===s?n:$n(s,n),i);case 3:t:{if(za(e),null===t)throw Error(y(387));s=e.pendingProps,n=(r=e.memoizedState).element,cr(t,e),gr(e,s,null,i);var o=e.memoizedState;if(s=o.element,r.isDehydrated){if(r={element:s,isDehydrated:!1,cache:o.cache,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,256&e.flags){e=Oa(t,e,s,i,n=Error(y(423)));break t}if(s!==n){e=Oa(t,e,s,i,n=Error(y(424)));break t}for(Or=mn(e.stateNode.containerInfo.firstChild),zr=e,Nr=!0,Hr=null,i=to(e,null,s,i),e.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(qr(),s===n){e=Ya(t,e,i);break t}Aa(t,e,s,i)}e=e.child}return e;case 5:return lo(e),null===t&&Gr(e),s=e.type,n=e.pendingProps,r=null!==t?t.memoizedProps:null,o=n.children,hn(s,n)?o=null:null!==r&&hn(s,r)&&(e.flags|=32),Da(t,e),Aa(t,e,o,i),e.child;case 6:return null===t&&Gr(e),null;case 13:return Ua(t,e,i);case 4:return oo(e,e.stateNode.containerInfo),s=e.pendingProps,null===t?e.child=Jr(e,null,s,i):Aa(t,e,s,i),e.child;case 11:return s=e.type,n=e.pendingProps,ka(t,e,s,n=e.elementType===s?n:$n(s,n),i);case 7:return Aa(t,e,e.pendingProps,i),e.child;case 8:case 12:return Aa(t,e,e.pendingProps.children,i),e.child;case 10:t:{if(s=e.type._context,n=e.pendingProps,r=e.memoizedProps,o=n.value,Dn(Zn,s._currentValue),s._currentValue=o,null!==r)if(fs(r.value,o)){if(r.children===n.children&&!Ln.current){e=Ya(t,e,i);break t}}else for(null!==(r=e.child)&&(r.return=e);null!==r;){var a=r.dependencies;if(null!==a){o=r.child;for(var l=a.firstContext;null!==l;){if(l.context===s){if(1===r.tag){(l=ur(-1,i&-i)).tag=2;var h=r.updateQueue;if(null!==h){var c=(h=h.shared).pending;null===c?l.next=l:(l.next=c.next,c.next=l),h.pending=l}}r.lanes|=i,null!==(l=r.alternate)&&(l.lanes|=i),nr(r.return,i,e),a.lanes|=i;break}l=l.next}}else if(10===r.tag)o=r.type===e.type?null:r.child;else if(18===r.tag){if(null===(o=r.return))throw Error(y(341));o.lanes|=i,null!==(a=o.alternate)&&(a.lanes|=i),nr(o,i,e),o=r.sibling}else o=r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===e){o=null;break}if(null!==(r=o.sibling)){r.return=o.return,o=r;break}o=o.return}r=o}Aa(t,e,n.children,i),e=e.child}return e;case 9:return n=e.type,s=e.pendingProps.children,rr(e,i),s=s(n=or(n)),e.flags|=1,Aa(t,e,s,i),e.child;case 14:return n=$n(s=e.type,e.pendingProps),Ra(t,e,s,n=$n(s.type,n),i);case 15:return Ia(t,e,e.type,e.pendingProps,i);case 17:return s=e.type,n=e.pendingProps,n=e.elementType===s?n:$n(s,n),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,Nn(s)?(t=!0,Vn(e)):t=!1,rr(e,i),xr(e,s,n),Sr(e,s,n,i),La(null,e,s,!0,t,i);case 19:return Ka(t,e,i);case 22:return Fa(t,e,i)}throw Error(y(156,e.tag))};var qh="function"==typeof reportError?reportError:function(t){console.error(t)};function Kh(t){this._internalRoot=t}function Yh(t){this._internalRoot=t}function Qh(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function $h(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Zh(){}function Jh(t,e,i,s,n){var r=i._reactRootContainer;if(r){var o=r;if("function"==typeof n){var a=n;n=function(){var t=Gh(o);a.call(t)}}Vh(e,o,t,n)}else o=function(t,e,i,s,n){if(n){if("function"==typeof s){var r=s;s=function(){var t=Gh(o);r.call(t)}}var o=Wh(e,s,t,0,null,!1,0,"",Zh);return t._reactRootContainer=o,t[xn]=o.current,Ys(8===t.nodeType?t.parentNode:t),hh(),o}for(;n=t.lastChild;)t.removeChild(n);if("function"==typeof s){var a=s;s=function(){var t=Gh(l);a.call(t)}}var l=Nh(t,0,!1,null,0,!1,0,"",Zh);return t._reactRootContainer=l,t[xn]=l.current,Ys(8===t.nodeType?t.parentNode:t),hh((function(){Vh(e,l,i,s)})),l}(i,e,t,n,s);return Gh(o)}Yh.prototype.render=Kh.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(y(409));Vh(t,e,null,null)},Yh.prototype.unmount=Kh.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;hh((function(){Vh(null,t,null,null)})),e[xn]=null}},Yh.prototype.unstable_scheduleHydration=function(t){if(t){var e=Le();t={blockedOn:null,target:t,priority:e};for(var i=0;i<je.length&&0!==e&&e<je[i].priority;i++);je.splice(i,0,t),0===i&&Ye(t)}},De=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=Ce(e.pendingLanes);0!==i&&(Re(e,1|i),ih(e,ce()),0==(6&Pl)&&(Ul=ce()+500,Yn()))}break;case 13:var s=Zl();hh((function(){return th(t,1,s)})),Xh(t,1)}},Me=function(t){13===t.tag&&(th(t,134217728,Zl()),Xh(t,134217728))},Be=function(t){if(13===t.tag){var e=Zl(),i=Jl(t);th(t,i,e),Xh(t,i)}},Le=function(){return Ie},ze=function(t,e){var i=Ie;try{return Ie=t,e()}finally{Ie=i}},Bt=function(t,e,i){switch(e){case"input":if(ut(t,i),e=i.name,"radio"===i.type&&null!=e){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var s=i[e];if(s!==t&&s.form===t.form){var n=An(s);if(!n)throw Error(y(90));ot(s),ut(s,n)}}}break;case"textarea":yt(t,i);break;case"select":null!=(e=i.value)&&gt(t,!!i.multiple,e,!1)}},Ut=lh,Wt=hh;var tc={usingClientEntryPoint:!1,Events:[En,Pn,An,Nt,Ht,lh]},ec={findFiberByHostInstance:Tn,bundleType:0,version:"18.0.0-fc46dba67-20220329",rendererPackageName:"react-dom"},ic={bundleType:ec.bundleType,version:ec.version,rendererPackageName:ec.rendererPackageName,rendererConfig:ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:D.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=ne(t))?null:t.stateNode},findFiberByHostInstance:ec.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var sc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sc.isDisabled&&sc.supportsFiber)try{_e=sc.inject(ic),ye=sc}catch(St){}}s=tc,n=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qh(e))throw Error(y(200));return Hh(t,e,null,i)},o=function(t,e){if(!Qh(t))throw Error(y(299));var i=!1,s="",n=qh;return null!=e&&(!0===e.unstable_strictMode&&(i=!0),void 0!==e.identifierPrefix&&(s=e.identifierPrefix),void 0!==e.onRecoverableError&&(n=e.onRecoverableError)),e=Nh(t,1,!1,null,0,i,0,s,n),t[xn]=e.current,Ys(8===t.nodeType?t.parentNode:t),new Kh(e)},a=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"==typeof t.render)throw Error(y(188));throw t=Object.keys(t).join(","),Error(y(268,t))}return t=null===(t=ne(e))?null:t.stateNode},l=function(t){return hh(t)},h=function(t,e,i){if(!$h(e))throw Error(y(200));return Jh(null,t,e,!0,i)},c=function(t,e,i){if(!Qh(t))throw Error(y(405));var s=null!=i&&i.hydratedSources||null,n=!1,r="",o=qh;if(null!=i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(r=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),e=Wh(e,null,t,1,null!=i?i:null,n,0,r,o),t[xn]=e.current,Ys(t),s)for(t=0;t<s.length;t++)n=(n=(i=s[t])._getVersion)(i._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[i,n]:e.mutableSourceEagerHydrationData.push(i,n);return new Yh(e)},u=function(t,e,i){if(!$h(e))throw Error(y(200));return Jh(null,t,e,!1,i)},d=function(t){if(!$h(t))throw Error(y(40));return!!t._reactRootContainer&&(hh((function(){Jh(null,null,t,!1,(function(){t._reactRootContainer=null,t[xn]=null}))})),!0)},p=lh,f=function(t,e,i,s){if(!$h(i))throw Error(y(200));if(null==t||void 0===t._reactInternals)throw Error(y(38));return Jh(t,e,i,!1,s)},g="18.0.0-fc46dba67-20220329"})),r.register("fO90s",(function(t,e){t.exports=r("gcnCG")})),r.register("gcnCG",(function(e,i){var s,n,r,o,a,l,h,c,u,d,p,f,g,m,_,y,v,w,x;function b(t,e){var i=t.length;t.push(e);t:for(;0<i;){var s=i-1>>>1,n=t[s];if(!(0<T(n,e)))break t;t[s]=e,t[i]=n,i=s}}function S(t){return 0===t.length?null:t[0]}function C(t){if(0===t.length)return null;var e=t[0],i=t.pop();if(i!==e){t[0]=i;t:for(var s=0,n=t.length,r=n>>>1;s<r;){var o=2*(s+1)-1,a=t[o],l=o+1,h=t[l];if(0>T(a,i))l<n&&0>T(h,a)?(t[s]=h,t[l]=i,s=l):(t[s]=a,t[o]=i,s=o);else{if(!(l<n&&0>T(h,i)))break t;t[s]=h,t[l]=i,s=l}}}return e}function T(t,e){var i=t.sortIndex-e.sortIndex;return 0!==i?i:t.id-e.id}if(t(e.exports,"unstable_now",(()=>s),(t=>s=t)),t(e.exports,"unstable_IdlePriority",(()=>n),(t=>n=t)),t(e.exports,"unstable_ImmediatePriority",(()=>r),(t=>r=t)),t(e.exports,"unstable_LowPriority",(()=>o),(t=>o=t)),t(e.exports,"unstable_NormalPriority",(()=>a),(t=>a=t)),t(e.exports,"unstable_Profiling",(()=>l),(t=>l=t)),t(e.exports,"unstable_UserBlockingPriority",(()=>h),(t=>h=t)),t(e.exports,"unstable_cancelCallback",(()=>c),(t=>c=t)),t(e.exports,"unstable_continueExecution",(()=>u),(t=>u=t)),t(e.exports,"unstable_forceFrameRate",(()=>d),(t=>d=t)),t(e.exports,"unstable_getCurrentPriorityLevel",(()=>p),(t=>p=t)),t(e.exports,"unstable_getFirstCallbackNode",(()=>f),(t=>f=t)),t(e.exports,"unstable_next",(()=>g),(t=>g=t)),t(e.exports,"unstable_pauseExecution",(()=>m),(t=>m=t)),t(e.exports,"unstable_requestPaint",(()=>_),(t=>_=t)),t(e.exports,"unstable_runWithPriority",(()=>y),(t=>y=t)),t(e.exports,"unstable_scheduleCallback",(()=>v),(t=>v=t)),t(e.exports,"unstable_shouldYield",(()=>w),(t=>w=t)),t(e.exports,"unstable_wrapCallback",(()=>x),(t=>x=t)),"object"==typeof performance&&"function"==typeof performance.now){var E=performance;s=function(){return E.now()}}else{var P=Date,A=P.now();s=function(){return P.now()-A}}var k=[],R=[],I=1,F=null,D=3,M=!1,B=!1,L=!1,z="function"==typeof setTimeout?setTimeout:null,O="function"==typeof clearTimeout?clearTimeout:null,N="undefined"!=typeof setImmediate?setImmediate:null;function H(t){for(var e=S(R);null!==e;){if(null===e.callback)C(R);else{if(!(e.startTime<=t))break;C(R),e.sortIndex=e.expirationTime,b(k,e)}e=S(R)}}function U(t){if(L=!1,H(t),!B)if(null!==S(k))B=!0,J(W);else{var e=S(R);null!==e&&tt(U,e.startTime-t)}}function W(t,e){B=!1,L&&(L=!1,O(X),X=-1),M=!0;var i=D;try{for(H(e),F=S(k);null!==F&&(!(F.expirationTime>e)||t&&!Y());){var n=F.callback;if("function"==typeof n){F.callback=null,D=F.priorityLevel;var r=n(F.expirationTime<=e);e=s(),"function"==typeof r?F.callback=r:F===S(k)&&C(k),H(e)}else C(k);F=S(k)}if(null!==F)var o=!0;else{var a=S(R);null!==a&&tt(U,a.startTime-e),o=!1}return o}finally{F=null,D=i,M=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var V,G=!1,j=null,X=-1,q=5,K=-1;function Y(){return!(s()-K<q)}function Q(){if(null!==j){var t=s();K=t;var e=!0;try{e=j(!0,t)}finally{e?V():(G=!1,j=null)}}else G=!1}if("function"==typeof N)V=function(){N(Q)};else if("undefined"!=typeof MessageChannel){var $=new MessageChannel,Z=$.port2;$.port1.onmessage=Q,V=function(){Z.postMessage(null)}}else V=function(){z(Q,0)};function J(t){j=t,G||(G=!0,V())}function tt(t,e){X=z((function(){t(s())}),e)}n=5,r=1,o=4,a=3,l=null,h=2,c=function(t){t.callback=null},u=function(){B||M||(B=!0,J(W))},d=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<t?Math.floor(1e3/t):5},p=function(){return D},f=function(){return S(k)},g=function(t){switch(D){case 1:case 2:case 3:var e=3;break;default:e=D}var i=D;D=e;try{return t()}finally{D=i}},m=function(){},_=function(){},y=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var i=D;D=t;try{return e()}finally{D=i}},v=function(t,e,i){var n=s();switch("object"==typeof i&&null!==i?i="number"==typeof(i=i.delay)&&0<i?n+i:n:i=n,t){case 1:var r=-1;break;case 2:r=250;break;case 5:r=1073741823;break;case 4:r=1e4;break;default:r=5e3}return t={id:I++,callback:e,priorityLevel:t,startTime:i,expirationTime:r=i+r,sortIndex:-1},i>n?(t.sortIndex=i,b(R,t),null===S(k)&&t===S(R)&&(L?(O(X),X=-1):L=!0,tt(U,i-n))):(t.sortIndex=r,b(k,t),B||M||(B=!0,J(W))),t},w=Y,x=function(t){var e=D;return function(){var i=D;D=e;try{return t.apply(this,arguments)}finally{D=i}}}})),r.register("3OncY",(function(e,i){t(e.exports,"default",(()=>o));var s=r("jgD1p"),n=r("cT3l2"),o={DatGuiMenuEnabled:!1,ShowDevTool:!1,SoundVolume:.3,BackgroundAmbianceVolume:1,BackgroundMusicVolume:.2,Seed:1337,z:{towers:3,bullets:6,enemies:4,healthbars:5},grid:{width:9,height:5,padding:1,tileWidth:64,tileHeight:64},sandcastle:{maxHealth:3},healthBarWidthPixels:54,player:{startingMonies:5,passiveWealthTick:30,passiveWealthAmt:1},tower:{default:{baseTowerFireRateMs:5e3,bulletDamage:1,bulletRadius:5,bulletSpeedPixelsPerSecond:100,color:s.Color.Orange,cost:1,firesBullets:!0,displayName:"Hatty",hoverText:"A sand turret to spray",maxHealth:5,resourceSpawnTimer:0,resourceSpawnValue:0,sprite:n.Resources.BaseTower,spriteBroken:n.Resources.BaseTowerBroken,spriteReady:n.Resources.BaseTower},upgradeCatapult:{baseTowerFireRateMs:5e3,bulletDamage:2,bulletRadius:5,bulletSpeedPixelsPerSecond:750,color:s.Color.DarkGray,cost:3,firesBullets:!0,displayName:"Sandapult",hoverText:"Seas the day to fling sand!",maxHealth:2,resourceSpawnTimer:0,resourceSpawnValue:0,sprite:n.Resources.CatapultTower,spriteBroken:n.Resources.CatapultTowerBroken,spriteReady:n.Resources.CatapultTowerLoaded},sandBucket:{bulletSpeedPixelsPerSecond:0,bulletRadius:0,baseTowerFireRateMs:0,bulletDamage:0,color:s.Color.Azure,cost:1,firesBullets:!1,displayName:"Buckaroo",hoverText:"All the kids need sand to build!",maxHealth:5,resourceSpawnTimer:20,resourceSpawnValue:1,sprite:n.Resources.BucketTower,spriteBroken:n.Resources.BucketTowerBroken,spriteReady:n.Resources.BucketTower},sandWall:{bulletSpeedPixelsPerSecond:0,bulletRadius:0,baseTowerFireRateMs:0,bulletDamage:0,color:s.Color.Orange,cost:2,firesBullets:!1,displayName:"Sandguard",hoverText:"Piled sand to hold the nastys at bay!",maxHealth:10,resourceSpawnTimer:0,resourceSpawnValue:0,sprite:n.Resources.Sandwall,spriteBroken:null,spriteReady:n.Resources.Sandwall}},enemy:{crab:{width:50,height:50,health:3,damage:2,damageTimerMs:1e3,speed:15,color:s.Color.Red,sprite:null,collisionGroup:"enemy_ground"},turtle:{width:50,height:50,health:5,damage:1,damageTimerMs:1e3,speed:8,color:s.Color.Green,sprite:null,collisionGroup:"enemy_ground"},seagull:{width:50,height:50,health:2,damage:1,damageTimerMs:1e3,speed:26,color:s.Color.Blue,sprite:null,collisionGroup:"enemy_flying"}},waves:{0:{name:"A day at the beach",offsets:{2:[{type:"crab",count:0}],15:[{type:"crab",count:1}],25:[{type:"crab",count:2}],35:[{type:"crab",count:3}]}},1:{name:"Wave 1",offsets:{7:[{type:"crab",count:1},{type:"turtle",count:1}],11:[{type:"turtle",count:1}],20:[{type:"crab",count:2},{type:"turtle",count:3}]}},2:{name:"Wave 2",offsets:{7:[{type:"seagull",count:3}],11:[{type:"crab",count:5},{type:"seagull",count:3}],20:[{type:"crab",count:5},{type:"turtle",count:3},{type:"seagull",count:4}]}},3:{name:"Wave 3",offsets:{7:[{type:"crab",count:4},{type:"turtle",count:3},{type:"seagull",count:4}],11:[{type:"crab",count:4},{type:"turtle",count:4},{type:"seagull",count:4}],20:[{type:"crab",count:8},{type:"turtle",count:6},{type:"seagull",count:4}]}},4:{name:"Wave 3",offsets:{2:[{type:"crab",count:5},{type:"turtle",count:6},{type:"seagull",count:3}],10:[{type:"crab",count:5},{type:"turtle",count:6},{type:"seagull",count:6}],20:[{type:"crab",count:5},{type:"turtle",count:9},{type:"seagull",count:6}],30:[{type:"crab",count:5},{type:"turtle",count:5},{type:"seagull",count:8}],40:[{type:"crab",count:10},{type:"turtle",count:5},{type:"seagull",count:5}],27:[{type:"crab",count:10},{type:"turtle",count:10},{type:"seagull",count:7}]}}}}})),r.register("jgD1p",(function(t,e){
/*!
 * excalibur - 0.26.0-alpha.151+483dc65 - 2022-4-4
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2022 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */
var i;self,i=function(){return(()=>{var t={4662:(t,e,i)=>{i(3430);var s=i(8791);t.exports=s("Array","sort")},8343:(t,e,i)=>{i(4769);var s=i(9276);t.exports=s.Object.keys},7111:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(9821),o=s.TypeError;t.exports=function(t){if(n(t))return t;throw o(r(t)+" is not a function")}},1176:(t,e,i)=>{var s=i(9859),n=i(5052),r=s.String,o=s.TypeError;t.exports=function(t){if(n(t))return t;throw o(r(t)+" is not an object")}},9540:(t,e,i)=>{var s=i(905),n=i(3231),r=i(9646),o=function(t){return function(e,i,o){var a,l=s(e),h=r(l),c=n(o,h);if(t&&i!=i){for(;h>c;)if((a=l[c++])!=a)return!0}else for(;h>c;c++)if((t||c in l)&&l[c]===i)return t||c||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},6038:(t,e,i)=>{var s=i(4229);t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},9794:(t,e,i)=>{var s=i(9859),n=i(3231),r=i(9646),o=i(2324),a=s.Array,l=Math.max;t.exports=function(t,e,i){for(var s=r(t),h=n(e,s),c=n(void 0===i?s:i,s),u=a(l(c-h,0)),d=0;h<c;h++,d++)o(u,d,t[h]);return u.length=d,u}},3867:(t,e,i)=>{var s=i(9794),n=Math.floor,r=function(t,e){var i=t.length,l=n(i/2);return i<8?o(t,e):a(t,r(s(t,0,l),e),r(s(t,l),e),e)},o=function(t,e){for(var i,s,n=t.length,r=1;r<n;){for(s=r,i=t[r];s&&e(t[s-1],i)>0;)t[s]=t[--s];s!==r++&&(t[s]=i)}return t},a=function(t,e,i,s){for(var n=e.length,r=i.length,o=0,a=0;o<n||a<r;)t[o+a]=o<n&&a<r?s(e[o],i[a])<=0?e[o++]:i[a++]:o<n?e[o++]:i[a++];return t};t.exports=r},7079:(t,e,i)=>{var s=i(5968),n=s({}.toString),r=s("".slice);t.exports=function(t){return r(n(t),8,-1)}},1589:(t,e,i)=>{var s=i(9859),n=i(1601),r=i(6733),o=i(7079),a=i(95)("toStringTag"),l=s.Object,h="Arguments"==o(function(){return arguments}());t.exports=n?o:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=l(t),a))?i:h?o(e):"Object"==(s=o(e))&&r(e.callee)?"Arguments":s}},7081:(t,e,i)=>{var s=i(8270),n=i(4826),r=i(7933),o=i(1787);t.exports=function(t,e,i){for(var a=n(e),l=o.f,h=r.f,c=0;c<a.length;c++){var u=a[c];s(t,u)||i&&s(i,u)||l(t,u,h(e,u))}}},5762:(t,e,i)=>{var s=i(7400),n=i(1787),r=i(5358);t.exports=s?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},5358:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},2324:(t,e,i)=>{var s=i(9310),n=i(1787),r=i(5358);t.exports=function(t,e,i){var o=s(e);o in t?n.f(t,o,r(0,i)):t[o]=i}},7400:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},2635:(t,e,i)=>{var s=i(9859),n=i(5052),r=s.document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},2671:(t,e,i)=>{var s=i(598).match(/firefox\/(\d+)/i);t.exports=!!s&&+s[1]},8506:(t,e,i)=>{var s=i(598);t.exports=/MSIE|Trident/.test(s)},598:(t,e,i)=>{var s=i(1333);t.exports=s("navigator","userAgent")||""},6358:(t,e,i)=>{var s,n,r=i(9859),o=i(598),a=r.process,l=r.Deno,h=a&&a.versions||l&&l.version,c=h&&h.v8;c&&(n=(s=c.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!n&&o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(n=+s[1]),t.exports=n},9811:(t,e,i)=>{var s=i(598).match(/AppleWebKit\/(\d+)\./);t.exports=!!s&&+s[1]},8791:(t,e,i)=>{var s=i(9859),n=i(5968);t.exports=function(t,e){return n(s[t].prototype[e])}},3837:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(t,e,i)=>{var s=i(9859),n=i(7933).f,r=i(5762),o=i(7487),a=i(2079),l=i(7081),h=i(6541);t.exports=function(t,e){var i,c,u,d,p,f=t.target,g=t.global,m=t.stat;if(i=g?s:m?s[f]||a(f,{}):(s[f]||{}).prototype)for(c in e){if(d=e[c],u=t.noTargetGet?(p=n(i,c))&&p.value:i[c],!h(g?c:f+(m?".":"#")+c,t.forced)&&void 0!==u){if(typeof d==typeof u)continue;l(d,u)}(t.sham||u&&u.sham)&&r(d,"sham",!0),o(i,c,d,t)}}},4229:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},7188:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},266:(t,e,i)=>{var s=i(7188),n=Function.prototype.call;t.exports=s?n.bind(n):function(){return n.apply(n,arguments)}},1805:(t,e,i)=>{var s=i(7400),n=i(8270),r=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,a=n(r,"name"),l=a&&"something"===function(){}.name,h=a&&(!s||s&&o(r,"name").configurable);t.exports={EXISTS:a,PROPER:l,CONFIGURABLE:h}},5968:(t,e,i)=>{var s=i(7188),n=Function.prototype,r=n.bind,o=n.call,a=s&&r.bind(o,o);t.exports=s?function(t){return t&&a(t)}:function(t){return t&&function(){return o.apply(t,arguments)}}},1333:(t,e,i)=>{var s=i(9859),n=i(6733),r=function(t){return n(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?r(s[t]):s[t]&&s[t][e]}},5300:(t,e,i)=>{var s=i(7111);t.exports=function(t,e){var i=t[e];return null==i?void 0:s(i)}},9859:(t,e,i)=>{var s=function(t){return t&&t.Math==Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof i.g&&i.g)||function(){return this}()||Function("return this")()},8270:(t,e,i)=>{var s=i(5968),n=i(2991),r=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return r(n(t),e)}},5977:t=>{t.exports={}},4394:(t,e,i)=>{var s=i(7400),n=i(4229),r=i(2635);t.exports=!s&&!n((function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},9337:(t,e,i)=>{var s=i(9859),n=i(5968),r=i(4229),o=i(7079),a=s.Object,l=n("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?l(t,""):a(t)}:a},8511:(t,e,i)=>{var s=i(5968),n=i(6733),r=i(5353),o=s(Function.toString);n(r.inspectSource)||(r.inspectSource=function(t){return o(t)}),t.exports=r.inspectSource},6407:(t,e,i)=>{var s,n,r,o=i(8694),a=i(9859),l=i(5968),h=i(5052),c=i(5762),u=i(8270),d=i(5353),p=i(4399),f=i(5977),g="Object already initialized",m=a.TypeError,_=a.WeakMap;if(o||d.state){var y=d.state||(d.state=new _),v=l(y.get),w=l(y.has),x=l(y.set);s=function(t,e){if(w(y,t))throw new m(g);return e.facade=t,x(y,t,e),e},n=function(t){return v(y,t)||{}},r=function(t){return w(y,t)}}else{var b=p("state");f[b]=!0,s=function(t,e){if(u(t,b))throw new m(g);return e.facade=t,c(t,b,e),e},n=function(t){return u(t,b)?t[b]:{}},r=function(t){return u(t,b)}}t.exports={set:s,get:n,has:r,enforce:function(t){return r(t)?n(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=n(e)).type!==t)throw m("Incompatible receiver, "+t+" required");return i}}}},6733:t=>{t.exports=function(t){return"function"==typeof t}},6541:(t,e,i)=>{var s=i(4229),n=i(6733),r=/#|\.prototype\./,o=function(t,e){var i=l[a(t)];return i==c||i!=h&&(n(e)?s(e):!!e)},a=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},l=o.data={},h=o.NATIVE="N",c=o.POLYFILL="P";t.exports=o},5052:(t,e,i)=>{var s=i(6733);t.exports=function(t){return"object"==typeof t?null!==t:s(t)}},4231:t=>{t.exports=!1},9395:(t,e,i)=>{var s=i(9859),n=i(1333),r=i(6733),o=i(1321),a=i(6969),l=s.Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return r(e)&&o(e.prototype,l(t))}},9646:(t,e,i)=>{var s=i(4237);t.exports=function(t){return s(t.length)}},3839:(t,e,i)=>{var s=i(6358),n=i(4229);t.exports=!!Object.getOwnPropertySymbols&&!n((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}))},8694:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(8511),o=s.WeakMap;t.exports=n(o)&&/native code/.test(r(o))},1787:(t,e,i)=>{var s=i(9859),n=i(7400),r=i(4394),o=i(7137),a=i(1176),l=i(9310),h=s.TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",p="configurable",f="writable";e.f=n?o?function(t,e,i){if(a(t),e=l(e),a(i),"function"==typeof t&&"prototype"===e&&"value"in i&&f in i&&!i.writable){var s=u(t,e);s&&s.writable&&(t[e]=i.value,i={configurable:p in i?i.configurable:s.configurable,enumerable:d in i?i.enumerable:s.enumerable,writable:!1})}return c(t,e,i)}:c:function(t,e,i){if(a(t),e=l(e),a(i),r)try{return c(t,e,i)}catch(t){}if("get"in i||"set"in i)throw h("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},7933:(t,e,i)=>{var s=i(7400),n=i(266),r=i(9195),o=i(5358),a=i(905),l=i(9310),h=i(8270),c=i(4394),u=Object.getOwnPropertyDescriptor;e.f=s?u:function(t,e){if(t=a(t),e=l(e),c)try{return u(t,e)}catch(t){}if(h(t,e))return o(!n(r.f,t,e),t[e])}},8151:(t,e,i)=>{var s=i(140),n=i(3837).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},894:(t,e)=>{e.f=Object.getOwnPropertySymbols},1321:(t,e,i)=>{var s=i(5968);t.exports=s({}.isPrototypeOf)},140:(t,e,i)=>{var s=i(5968),n=i(8270),r=i(905),o=i(9540).indexOf,a=i(5977),l=s([].push);t.exports=function(t,e){var i,s=r(t),h=0,c=[];for(i in s)!n(a,i)&&n(s,i)&&l(c,i);for(;e.length>h;)n(s,i=e[h++])&&(~o(c,i)||l(c,i));return c}},5632:(t,e,i)=>{var s=i(140),n=i(3837);t.exports=Object.keys||function(t){return s(t,n)}},9195:(t,e)=>{var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,n=s&&!i.call({1:2},1);e.f=n?function(t){var e=s(this,t);return!!e&&e.enumerable}:i},2914:(t,e,i)=>{var s=i(9859),n=i(266),r=i(6733),o=i(5052),a=s.TypeError;t.exports=function(t,e){var i,s;if("string"===e&&r(i=t.toString)&&!o(s=n(i,t)))return s;if(r(i=t.valueOf)&&!o(s=n(i,t)))return s;if("string"!==e&&r(i=t.toString)&&!o(s=n(i,t)))return s;throw a("Can't convert object to primitive value")}},4826:(t,e,i)=>{var s=i(1333),n=i(5968),r=i(8151),o=i(894),a=i(1176),l=n([].concat);t.exports=s("Reflect","ownKeys")||function(t){var e=r.f(a(t)),i=o.f;return i?l(e,i(t)):e}},9276:(t,e,i)=>{var s=i(9859);t.exports=s},7487:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(8270),o=i(5762),a=i(2079),l=i(8511),h=i(6407),c=i(1805).CONFIGURABLE,u=h.get,d=h.enforce,p=String(String).split("String");(t.exports=function(t,e,i,l){var h,u=!!l&&!!l.unsafe,f=!!l&&!!l.enumerable,g=!!l&&!!l.noTargetGet,m=l&&void 0!==l.name?l.name:e;n(i)&&("Symbol("===String(m).slice(0,7)&&(m="["+String(m).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!r(i,"name")||c&&i.name!==m)&&o(i,"name",m),(h=d(i)).source||(h.source=p.join("string"==typeof m?m:""))),t!==s?(u?!g&&t[e]&&(f=!0):delete t[e],f?t[e]=i:o(t,e,i)):f?t[e]=i:a(e,i)})(Function.prototype,"toString",(function(){return n(this)&&u(this).source||l(this)}))},8885:(t,e,i)=>{var s=i(9859).TypeError;t.exports=function(t){if(null==t)throw s("Can't call method on "+t);return t}},2079:(t,e,i)=>{var s=i(9859),n=Object.defineProperty;t.exports=function(t,e){try{n(s,t,{value:e,configurable:!0,writable:!0})}catch(i){s[t]=e}return e}},4399:(t,e,i)=>{var s=i(3036),n=i(1441),r=s("keys");t.exports=function(t){return r[t]||(r[t]=n(t))}},5353:(t,e,i)=>{var s=i(9859),n=i(2079),r="__core-js_shared__",o=s[r]||n(r,{});t.exports=o},3036:(t,e,i)=>{var s=i(4231),n=i(5353);(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.0",mode:s?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE",source:"https://github.com/zloirock/core-js"})},3231:(t,e,i)=>{var s=i(3329),n=Math.max,r=Math.min;t.exports=function(t,e){var i=s(t);return i<0?n(i+e,0):r(i,e)}},905:(t,e,i)=>{var s=i(9337),n=i(8885);t.exports=function(t){return s(n(t))}},3329:t=>{var e=Math.ceil,i=Math.floor;t.exports=function(t){var s=+t;return s!=s||0===s?0:(s>0?i:e)(s)}},4237:(t,e,i)=>{var s=i(3329),n=Math.min;t.exports=function(t){return t>0?n(s(t),9007199254740991):0}},2991:(t,e,i)=>{var s=i(9859),n=i(8885),r=s.Object;t.exports=function(t){return r(n(t))}},2066:(t,e,i)=>{var s=i(9859),n=i(266),r=i(5052),o=i(9395),a=i(5300),l=i(2914),h=i(95),c=s.TypeError,u=h("toPrimitive");t.exports=function(t,e){if(!r(t)||o(t))return t;var i,s=a(t,u);if(s){if(void 0===e&&(e="default"),i=n(s,t,e),!r(i)||o(i))return i;throw c("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(t,e)}},9310:(t,e,i)=>{var s=i(2066),n=i(9395);t.exports=function(t){var e=s(t,"string");return n(e)?e:e+""}},1601:(t,e,i)=>{var s={};s[i(95)("toStringTag")]="z",t.exports="[object z]"===String(s)},3326:(t,e,i)=>{var s=i(9859),n=i(1589),r=s.String;t.exports=function(t){if("Symbol"===n(t))throw TypeError("Cannot convert a Symbol value to a string");return r(t)}},9821:(t,e,i)=>{var s=i(9859).String;t.exports=function(t){try{return s(t)}catch(t){return"Object"}}},1441:(t,e,i)=>{var s=i(5968),n=0,r=Math.random(),o=s(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++n+r,36)}},6969:(t,e,i)=>{var s=i(3839);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7137:(t,e,i)=>{var s=i(7400),n=i(4229);t.exports=s&&n((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},95:(t,e,i)=>{var s=i(9859),n=i(3036),r=i(8270),o=i(1441),a=i(3839),l=i(6969),h=n("wks"),c=s.Symbol,u=c&&c.for,d=l?c:c&&c.withoutSetter||o;t.exports=function(t){if(!r(h,t)||!a&&"string"!=typeof h[t]){var e="Symbol."+t;a&&r(c,t)?h[t]=c[t]:h[t]=l&&u?u(e):d(e)}return h[t]}},3430:(t,e,i)=>{var s=i(3103),n=i(5968),r=i(7111),o=i(2991),a=i(9646),l=i(3326),h=i(4229),c=i(3867),u=i(6038),d=i(2671),p=i(8506),f=i(6358),g=i(9811),m=[],_=n(m.sort),y=n(m.push),v=h((function(){m.sort(void 0)})),w=h((function(){m.sort(null)})),x=u("sort"),b=!h((function(){if(f)return f<70;if(!(d&&d>3)){if(p)return!0;if(g)return g<603;var t,e,i,s,n="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)m.push({k:e+s,v:i})}for(m.sort((function(t,e){return e.v-t.v})),s=0;s<m.length;s++)e=m[s].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}}));s({target:"Array",proto:!0,forced:v||!w||!x||!b},{sort:function(t){void 0!==t&&r(t);var e=o(this);if(b)return void 0===t?_(e):_(e,t);var i,s,n=[],h=a(e);for(s=0;s<h;s++)s in e&&y(n,e[s]);for(c(n,function(t){return function(e,i){return void 0===i?-1:void 0===e?1:void 0!==t?+t(e,i)||0:l(e)>l(i)?1:-1}}(t)),i=n.length,s=0;s<i;)e[s]=n[s++];for(;s<h;)delete e[s++];return e}})},4769:(t,e,i)=>{var s=i(3103),n=i(2991),r=i(5632);s({target:"Object",stat:!0,forced:i(4229)((function(){r(1)}))},{keys:function(t){return r(n(t))}})},1388:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(272),n=i.n(s),r=i(2609),o=i.n(r)()(n());o.push([t.id,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  white-space: nowrap;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n","",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:["/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  white-space: nowrap;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n"],sourceRoot:""}]);const a=o},2609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);s&&o[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},272:t=>{t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),r="/*# ".concat(n," */"),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[e].concat(o).concat([r]).join("\n")}return[e].join("\n")}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{ActionContext:()=>qs,ActionQueue:()=>Rs,ActionsComponent:()=>Ks,ActionsSystem:()=>Jn,ActivateEvent:()=>ae,Actor:()=>Zs,AddedComponent:()=>ms,AddedEntity:()=>xn,Animation:()=>Gn,AnimationDirection:()=>On,AnimationStrategy:()=>Hn,ArcadeSolver:()=>Mn,AudioContextFactory:()=>fi,Axis:()=>sn,BaseAlign:()=>ze,BinaryTreeNode:()=>Po,Blink:()=>Us,BodyComponent:()=>ps,BoundingBox:()=>D,BroadphaseStrategy:()=>Ri,BrowserComponent:()=>Dr,BrowserEvents:()=>Mr,Camera:()=>fn,Canvas:()=>kt,Circle:()=>Ps,CircleCollider:()=>es,Class:()=>mi,Clock:()=>Vr,ClosestLine:()=>Ji,ClosestLineJumpTable:()=>ts,Collider:()=>Qi,ColliderComponent:()=>ls,CollisionContact:()=>is,CollisionEndEvent:()=>re,CollisionGroup:()=>Vi,CollisionGroupManager:()=>no,CollisionJumpTable:()=>ns,CollisionPostSolveEvent:()=>se,CollisionPreSolveEvent:()=>ie,CollisionResolutionStrategy:()=>Ai,CollisionSolver:()=>Dn,CollisionStartEvent:()=>ne,CollisionSystem:()=>zn,CollisionType:()=>Ei,Color:()=>I,ColorBlindFlags:()=>Tr,ColorBlindnessMode:()=>sr,ColorBlindnessPostProcessor:()=>Cr,Component:()=>Oi,CompositeCollider:()=>$i,Configurable:()=>Ee,ConsoleAppender:()=>v,ContactConstraintPoint:()=>Bn,ContactEndEvent:()=>ee,ContactStartEvent:()=>te,CoordPlane:()=>Mi,CullingBox:()=>fs,DeactivateEvent:()=>le,Debug:()=>Er,DebugGraphicsComponent:()=>en,DebugSystem:()=>$n,DebugText:()=>qe,DegreeOfFreedom:()=>hs,Detector:()=>Ti,Die:()=>Gs,Direction:()=>Ue,DisplayMode:()=>ci,DynamicTree:()=>qi,DynamicTreeCollisionProcessor:()=>Yi,EX_VERSION:()=>Mo,EaseTo:()=>Hs,EasingFunctions:()=>ks,EdgeCollider:()=>rs,ElasticToActorStrategy:()=>un,EmitterType:()=>Wn,Engine:()=>Yr,EnterTriggerEvent:()=>ue,EnterViewPortEvent:()=>ce,Entity:()=>ws,EntityManager:()=>Tn,EventDispatcher:()=>pe,EventTypes:()=>pt,Events:()=>e,ExResponse:()=>oo,ExcaliburGraphicsContext2DCanvas:()=>Lr,ExcaliburGraphicsContextWebGL:()=>hi,ExcaliburWebGLContextAccessor:()=>Qe,ExitTriggerEvent:()=>de,ExitViewPortEvent:()=>he,Experiments:()=>h,Fade:()=>Ws,Flags:()=>m,Follow:()=>js,Font:()=>Ys,FontStyle:()=>Ne,FontUnit:()=>De,FpsSampler:()=>Wr,FrameStats:()=>Pr,GameEvent:()=>Rt,GameStartEvent:()=>Mt,GameStopEvent:()=>Bt,GamepadAxisEvent:()=>qt,GamepadButtonEvent:()=>Xt,GamepadConnectEvent:()=>Gt,GamepadDisconnectEvent:()=>jt,Gif:()=>vo,GlobalCoordinates:()=>zr,Graphic:()=>wt,GraphicsComponent:()=>Ts,GraphicsGroup:()=>jn,GraphicsLayer:()=>Ss,GraphicsLayers:()=>Cs,GraphicsSystem:()=>Yn,HiddenEvent:()=>$t,ImageFiltering:()=>ut,ImageSource:()=>Re,InitializeEvent:()=>oe,Input:()=>a,Integrator:()=>Fi,IsometricEntityComponent:()=>tr,IsometricEntitySystem:()=>er,IsometricMap:()=>so,IsometricTile:()=>io,KillEvent:()=>It,Label:()=>eo,Legacy:()=>c,LegacyDrawing:()=>o,LimitCameraBoundsStrategy:()=>pn,Line:()=>Zi,Loader:()=>Si,LockCameraToActorAxisStrategy:()=>cn,LockCameraToActorStrategy:()=>hn,LogLevel:()=>d,Logger:()=>y,Matrix:()=>gt,MatrixLocations:()=>ht,MediaEvent:()=>$r,Meet:()=>Xs,MockedElement:()=>Ao,MotionComponent:()=>Wi,MotionSystem:()=>Fn,MoveBy:()=>Ds,MoveTo:()=>Ms,NativeSoundEvent:()=>Zr,NativeSoundProcessedEvent:()=>Jr,Observable:()=>Hi,OffscreenSystem:()=>ir,Pair:()=>Gi,ParseGif:()=>So,Particle:()=>qn,ParticleEmitter:()=>Kn,Physics:()=>Li,PhysicsStats:()=>Ar,PointerComponent:()=>As,PointerSystem:()=>Zn,Polygon:()=>Co,PolygonCollider:()=>os,Pool:()=>ko,PostCollisionEvent:()=>Jt,PostDebugDrawEvent:()=>Nt,PostDrawEvent:()=>zt,PostFrameEvent:()=>Vt,PostKillEvent:()=>Dt,PostUpdateEvent:()=>Ut,PreCollisionEvent:()=>Zt,PreDebugDrawEvent:()=>Ot,PreDrawEvent:()=>Lt,PreFrameEvent:()=>Wt,PreKillEvent:()=>Ft,PreUpdateEvent:()=>Ht,Projection:()=>ji,Promise:()=>Do,PromiseState:()=>Io,QuadIndexBuffer:()=>ni,Query:()=>Pn,QueryManager:()=>An,RadiusAroundActorStrategy:()=>dn,Random:()=>B,Raster:()=>At,Ray:()=>Ki,RealisticSolver:()=>Ln,Rectangle:()=>Es,RemovedComponent:()=>ys,RemovedEntity:()=>Sn,Repeat:()=>Is,RepeatForever:()=>Fs,Resolution:()=>di,Resource:()=>fe,RotateBy:()=>Ls,RotateTo:()=>Bs,RotationType:()=>us,ScaleBy:()=>Os,ScaleTo:()=>zs,Scene:()=>br,Screen:()=>pi,ScreenAppender:()=>w,ScreenElement:()=>Js,ScreenShader:()=>Sr,ScrollPreventionMode:()=>Xr,Shader:()=>$e,Shape:()=>as,Side:()=>A,SortedList:()=>Eo,Sound:()=>yo,Sprite:()=>ke,SpriteFont:()=>Xe,SpriteSheet:()=>je,StandardClock:()=>Gr,StrategyContainer:()=>ln,Stream:()=>bo,SubscribeEvent:()=>Kt,System:()=>wn,SystemManager:()=>kn,SystemType:()=>yn,TagComponent:()=>Ni,TestClock:()=>jr,Text:()=>Qs,TextAlign:()=>Be,TextureLoader:()=>Pt,Tile:()=>an,TileMap:()=>on,Timer:()=>tn,Traits:()=>l,TransformComponent:()=>Ui,TreeNode:()=>Xi,Trigger:()=>_n,TwoPI:()=>L,UnsubscribeEvent:()=>Yt,Util:()=>f,Vector:()=>E,VectorView:()=>zi,VertexBuffer:()=>Ze,VertexLayout:()=>Je,VisibleEvent:()=>Qt,WebAudio:()=>gi,WebAudioInstance:()=>mo,World:()=>Rn,canonicalizeAngle:()=>H,clamp:()=>N,createId:()=>_,frac:()=>z,hasGraphicsTick:()=>bs,hasOnInitialize:()=>lo,hasOnPostUpdate:()=>po,hasOnPreUpdate:()=>co,hasPostDraw:()=>go,hasPreDraw:()=>fo,has_initialize:()=>ao,has_postupdate:()=>uo,has_preupdate:()=>ho,isAddedComponent:()=>_s,isAddedSystemEntity:()=>bn,isRemoveSystemEntity:()=>Cn,isRemovedComponent:()=>vs,maxMessages:()=>x,obsolete:()=>T,randomInRange:()=>G,randomIntInRange:()=>j,range:()=>V,resetObsoleteCounter:()=>S,sign:()=>O,toDegrees:()=>U,toRadians:()=>W,vec:()=>P,webgl:()=>t});var t={};i.r(t),i.d(t,{ensurePowerOfTwo:()=>St,getAttributeComponentSize:()=>Tt,getAttributePointerType:()=>Et,getGlTypeSizeBytes:()=>Ct,isPowerOfTwo:()=>xt,nextHighestPowerOfTwo:()=>bt});var e={};i.r(e),i.d(e,{ActivateEvent:()=>ae,CollisionEndEvent:()=>re,CollisionPostSolveEvent:()=>se,CollisionPreSolveEvent:()=>ie,CollisionStartEvent:()=>ne,ContactEndEvent:()=>ee,ContactStartEvent:()=>te,DeactivateEvent:()=>le,EnterTriggerEvent:()=>ue,EnterViewPortEvent:()=>ce,EventTypes:()=>pt,ExitTriggerEvent:()=>de,ExitViewPortEvent:()=>he,GameEvent:()=>Rt,GameStartEvent:()=>Mt,GameStopEvent:()=>Bt,GamepadAxisEvent:()=>qt,GamepadButtonEvent:()=>Xt,GamepadConnectEvent:()=>Gt,GamepadDisconnectEvent:()=>jt,HiddenEvent:()=>$t,InitializeEvent:()=>oe,KillEvent:()=>It,PostCollisionEvent:()=>Jt,PostDebugDrawEvent:()=>Nt,PostDrawEvent:()=>zt,PostFrameEvent:()=>Vt,PostKillEvent:()=>Dt,PostUpdateEvent:()=>Ut,PreCollisionEvent:()=>Zt,PreDebugDrawEvent:()=>Ot,PreDrawEvent:()=>Lt,PreFrameEvent:()=>Wt,PreKillEvent:()=>Ft,PreUpdateEvent:()=>Ht,SubscribeEvent:()=>Kt,UnsubscribeEvent:()=>Yt,VisibleEvent:()=>Qt});var n={};i.r(n),i.d(n,{Colorize:()=>ve,Darken:()=>xe,Desaturate:()=>Se,Fill:()=>Ce,Grayscale:()=>me,Invert:()=>_e,Lighten:()=>we,Opacity:()=>ye,Saturate:()=>be});var r={};i.r(r),i.d(r,{circle:()=>xi,line:()=>_i,point:()=>yi,roundRect:()=>wi,vector:()=>vi});var o={};i.r(o),i.d(o,{Animation:()=>Fe,CanvasDrawComponent:()=>xs,CanvasDrawingSystem:()=>Qn,Effects:()=>n,Polygon:()=>ro,Sprite:()=>Ae,SpriteFont:()=>Ge,SpriteSheet:()=>Ve,Texture:()=>Te});var a={};i.r(a),i.d(a,{Axes:()=>ur,Buttons:()=>hr,Gamepad:()=>Fr,Gamepads:()=>Ir,KeyEvent:()=>kr,Keyboard:()=>Rr,Keys:()=>ar,NativePointerButton:()=>gr,PointerButton:()=>_r,PointerComponent:()=>As,PointerEvent:()=>Or,PointerEventReceiver:()=>Ur,PointerScope:()=>rr,PointerSystem:()=>Zn,PointerType:()=>vr,WheelDeltaMode:()=>pr,WheelEvent:()=>Nr});var l={};i.r(l),i.d(l,{OffscreenCulling:()=>gs});var h,c,u,d,p,f={};function g(){if("undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"!=typeof window&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise(((i,s)=>{t.call(this,e,i,s)}))}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1)}i.r(f),i.d(f,{Collection:()=>ot,ConsoleAppender:()=>v,DrawUtil:()=>r,EasingFunctions:()=>ks,LogLevel:()=>d,Logger:()=>y,Observable:()=>Hi,ScreenAppender:()=>w,TwoPI:()=>X,addItemToArray:()=>et,canonicalizeAngle:()=>Q,clamp:()=>q,contains:()=>st,delay:()=>lt,fail:()=>at,getOppositeSide:()=>nt,getPosition:()=>tt,getSideFromDirection:()=>rt,randomInRange:()=>K,randomIntInRange:()=>Y,range:()=>J,removeItemFromArray:()=>it,toDegrees:()=>$,toRadians:()=>Z}),i(4662),i(8343),(h||(h={})).WebGL="use-webgl",(u=c||(c={})).Canvas="use-canvas-context",u.LegacyDrawing="use-legacy-drawing";class m{static freeze(){m._FROZEN=!0}static _reset(){m._FROZEN=!1,m._FLAGS={}}static useWebGL(){m.enable(h.WebGL)}static useCanvasGraphicsContext(){m.enable(c.Canvas)}static useLegacyDrawing(){m.enable(c.LegacyDrawing)}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");m._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");m._FLAGS[t]=!1}static isEnabled(t){return!!m._FLAGS[t]}static show(){return Object.keys(m._FLAGS)}}function _(t,e){return{type:t,value:e}}m._FROZEN=!1,m._FLAGS={},(p=d||(d={}))[p.Debug=0]="Debug",p[p.Info=1]="Info",p[p.Warn=2]="Warn",p[p.Error=3]="Error",p[p.Fatal=4]="Fatal";class y{constructor(){if(this._appenders=[],this.defaultLevel=d.Info,y._INSTANCE)throw new Error("Logger is a singleton");return y._INSTANCE=this,y._INSTANCE.addAppender(new v),y._INSTANCE}static getInstance(){return null==y._INSTANCE&&(y._INSTANCE=new y),y._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){null==t&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}debug(...t){this._log(d.Debug,t)}info(...t){this._log(d.Info,t)}warn(...t){this._log(d.Warn,t)}error(...t){this._log(d.Error,t)}fatal(...t){this._log(d.Fatal,t)}}y._INSTANCE=null;class v{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+d[t]+"] : "),t<d.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<d.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class w{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+d[t]+"] : "+i);let s=10,n=1;for(let t=0;t<this._messages.length;t++)this._ctx.fillStyle="rgba(255,255,255,"+n.toFixed(2)+")",this._ctx.fillText(this._messages[t],200,s),s+=10,n=n>0?n-.05:0}}const x=5,b={},S=()=>{for(const t in b)b[t]=0},C=(t,e)=>{const i=m.isEnabled("suppress-obsolete-message");b[t]<x&&!i&&(y.getInstance().warn(t),console.trace&&e.showStackTrace&&console.trace()),b[t]++};function T(t){return t={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...t},function(e,i,s){if(s&&"function"!=typeof s.value&&"function"!=typeof s.get&&"function"!=typeof s.set)throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const n=`${e.name||""}${e.name&&i?".":""}${i||""} is marked obsolete: ${t.message}`+(t.alternateMethod?` Use ${t.alternateMethod} instead`:"");b[n]||(b[n]=0);const r=s?{...s}:e;if(!s){class e extends r{constructor(...e){C(n,t),super(...e)}}return e}return s&&s.value?(r.value=function(){return C(n,t),s.value.apply(this,arguments)},r):(s&&s.get&&(r.get=function(){return C(n,t),s.get.apply(this,arguments)}),s&&s.set&&(r.set=function(){return C(n,t),s.set.apply(this,arguments)}),r)}}class E{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new E(0,0)}static get One(){return new E(1,1)}static get Half(){return new E(.5,.5)}static get Up(){return new E(0,-1)}static get Down(){return new E(0,1)}static get Left(){return new E(-1,0)}static get Right(){return new E(1,0)}static fromAngle(t){return new E(Math.cos(t),Math.sin(t))}static isValid(t){return null!=t&&!isNaN(t.x)&&!isNaN(t.y)&&t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new E(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new E(Math.max(t.x,e.x),Math.max(t.y,e.y))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){return t||(t=E.Zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}squareDistance(t){return t||(t=E.Zero),Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)}magnitude(){return this.distance()}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new E(this.x/t,this.y/t):new E(0,1)}average(t){return this.add(t).scale(.5)}scale(t){return t instanceof E?new E(this.x*t.x,this.y*t.y):new E(this.x*t,this.y*t)}add(t){return new E(this.x+t.x,this.y+t.y)}sub(t){return new E(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return t instanceof E?this.x*t.y-this.y*t.x:"number"==typeof t?new E(t*this.y,-t*this.x):void 0}static cross(t,e){return new E(-t*e.y,t*e.x)}perpendicular(){return new E(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new E(0,0));const i=Math.sin(t),s=Math.cos(t),n=s*(this.x-e.x)-i*(this.y-e.y)+e.x,r=i*(this.x-e.x)+s*(this.y-e.y)+e.y;return new E(n,r)}clone(){return new E(this.x,this.y)}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}function P(t,e){return new E(t,e)}!function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([T({message:"will be removed in favour of `.size` in version 0.25.0"})],E.prototype,"magnitude",null);var A,k,R=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class I{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=null!=s?s:1}static fromRGB(t,e,i,s){return new I(t,e,i,s)}static fromRGBString(t){let e=null;if(e=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i)){const t=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10);let n=1;return e[4]&&(n=parseFloat(e[4])),new I(t,i,s,n)}throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){let e=null;if(e=t.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){const t=parseInt(e[1],16),i=parseInt(e[2],16),s=parseInt(e[3],16);let n=1;return e[4]&&(n=parseInt(e[4],16)/255),new I(t,i,s,n)}throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new F(t,e,i,s).toRGBA()}lighten(t=.1){const e=F.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=F.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=F.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=F.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,n=t.a*this.a;return new I(e,i,s,n)}mulitiply(t){return this.multiply(t)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new I(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,n=(t.a+this.a)/2;return new I(e,i,s,n)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return F.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new I(this.r,this.g,this.b,this.a)}static get Black(){return I.fromHex("#000000")}static get White(){return I.fromHex("#FFFFFF")}static get Gray(){return I.fromHex("#808080")}static get LightGray(){return I.fromHex("#D3D3D3")}static get DarkGray(){return I.fromHex("#A9A9A9")}static get Yellow(){return I.fromHex("#FFFF00")}static get Orange(){return I.fromHex("#FFA500")}static get Red(){return I.fromHex("#FF0000")}static get Vermilion(){return I.fromHex("#FF5B31")}static get Vermillion(){return I.Vermilion}static get Rose(){return I.fromHex("#FF007F")}static get Magenta(){return I.fromHex("#FF00FF")}static get Violet(){return I.fromHex("#7F00FF")}static get Blue(){return I.fromHex("#0000FF")}static get Azure(){return I.fromHex("#007FFF")}static get Cyan(){return I.fromHex("#00FFFF")}static get Viridian(){return I.fromHex("#59978F")}static get Green(){return I.fromHex("#00FF00")}static get Chartreuse(){return I.fromHex("#7FFF00")}static get Transparent(){return I.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return I.fromHex("#176BAA")}}R([T({message:"Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0"})],I.prototype,"mulitiply",null),R([T({message:"Alias for incorrect spelling used in older versions",alternateMethod:"Vermilion"})],I,"Vermillion",null);class F{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const n=Math.max(t,e,i),r=Math.min(t,e,i);let o,a;const l=(n+r)/2;if(n===r)o=a=0;else{const s=n-r;switch(a=l>.5?s/(2-n-r):s/(n+r),n){case t:o=(e-i)/s+(e<i?6:0);break;case e:o=(i-t)/s+2;break;case i:o=(t-e)/s+4}o/=6}return new F(o,a,l,s)}toRGBA(){let t,e,i;if(0===this.s)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,n=2*this.l-s;t=F.hue2rgb(n,s,this.h+1/3),e=F.hue2rgb(n,s,this.h),i=F.hue2rgb(n,s,this.h-1/3)}return new I(255*t,255*e,255*i,this.a)}toString(){return`hsla(${this.h.toFixed(0)}, ${this.s.toFixed(0)}, ${this.l.toFixed(0)}, ${this.a.toFixed(0)})`}}(k=A||(A={})).None="None",k.Top="Top",k.Bottom="Bottom",k.Left="Left",k.Right="Right",function(t){t.getOpposite=function(e){return e===t.Top?t.Bottom:e===t.Bottom?t.Top:e===t.Left?t.Right:e===t.Right?t.Left:t.None},t.fromDirection=function(e){const i=[E.Left,E.Right,E.Up,E.Down],s=[t.Left,t.Right,t.Top,t.Bottom];let n=-Number.MAX_VALUE,r=-1;for(let t=0;t<i.length;t++)i[t].dot(e)>n&&(n=i[t].dot(e),r=t);return s[r]}}(A||(A={}));class D{constructor(t=0,e=0,i=0,s=0){"object"==typeof t?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):"number"==typeof t&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}clone(){return new D(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?A.Right:A.Left:t.y<0?A.Bottom:A.Top:A.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r].x<e&&(e=t[r].x),t[r].x>s&&(s=t[r].x),t[r].y<i&&(i=t[r].y),t[r].y>n&&(n=t[r].y);return new D(e,i,s,n)}static fromDimension(t,e,i=E.Half,s=E.Zero){return new D(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return 0===this.width||0===this.height}get center(){return new E((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new D(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=E.Zero){const i=this.getPoints().map((i=>i.rotate(t,e)));return D.fromPoints(i)}scale(t,e=E.Zero){const i=this.translate(e);return new D(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=P(t.data[0],t.data[1]),i=e.scale(this.left),s=e.scale(this.right),n=P(t.data[4],t.data[5]),r=n.scale(this.top),o=n.scale(this.bottom),a=t.getPosition(),l=E.min(i,s).add(E.min(r,o)).add(a),h=E.max(i,s).add(E.max(r,o)).add(a);return new D({left:l.x,top:l.y,right:h.x,bottom:h.y})}getPerimeter(){return 2*(this.width+this.height)}getPoints(){const t=[];return t.push(new E(this.left,this.top)),t.push(new E(this.right,this.top)),t.push(new E(this.right,this.bottom)),t.push(new E(this.left,this.bottom)),t}rayCast(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const l=(this.top-t.pos.y)*r,h=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(l,h)),s=Math.min(s,Math.max(l,h)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const l=(this.top-t.pos.y)*r,h=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(l,h)),s=Math.min(s,Math.max(l,h)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof E?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof D&&this.left<t.left&&this.top<t.top&&t.bottom<this.bottom&&t.right<this.right}combine(t){return new D(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new E(this.width,this.height)}overlaps(t){const e=this.combine(t);return e.width<t.width+this.width&&e.height<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let e=0;e=this.right>=t.left&&this.right<=t.right?t.left-this.right:t.right-this.left;let i=0;return i=this.top<=t.bottom&&this.top>=t.top?t.bottom-this.top:t.top-this.bottom,Math.abs(e)<Math.abs(i)?new E(e,0):new E(0,i)}if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let e=0;e=this.width-t.width>=0?this.right-t.right<=t.left-this.left?t.left-this.right:t.right-this.left:t.right-this.right<=this.left-t.left?this.left-t.right:this.right-t.left;let i=0;return i=this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?t.top-this.bottom:t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?this.top-t.bottom:this.bottom-t.top,Math.abs(e)<Math.abs(i)?new E(e,0):new E(0,i)}return null}intersectWithSide(t){const e=this.intersect(t);return D.getSideFromIntersection(e)}debugDraw(t,e=I.Yellow){t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.width,this.height)}draw(t,e=I.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}const M=4294967295;class B{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let t=1;t<this._n;t++){const e=this._mt[t-1]^this._mt[t-1]>>>this._w-2;this._mt[t]=(this._f*((4294901760&e)>>>16)<<16)+this._f*(65535&e)+t>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[1&e]&M;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[1&e]&M;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[1&e]&M,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const n=t.slice(0);for(;s<e;){const t=this.integer(0,n.length-1);i[s++]=n[t],n.splice(t,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let t=0;t<e.length-2;t++){const s=this.integer(t,e.length-1);i=e[t],e[t]=e[s],e[s]=i}return e}range(t,e,i){const s=new Array(t);for(let n=0;n<t;n++)s[n]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const L=2*Math.PI;function z(t){return t>=0?t-Math.floor(t):t-Math.ceil(t)}function O(t){return 0===t?0:t<0?-1:1}function N(t,e,i){return Math.min(Math.max(e,t),i)}function H(t){let e=t;if(t>L)for(;e>L;)e-=L;if(t<0)for(;e<0;)e+=L;return e}function U(t){return 180/Math.PI*t}function W(t){return t/180*Math.PI}const V=(t,e)=>Array.from(new Array(e-t+1),((e,i)=>i+t));function G(t,e,i=new B){return i?i.floating(t,e):t+Math.random()*(e-t)}function j(t,e,i=new B){return i?i.integer(t,e):Math.round(G(t,e))}const X=L,q=N,K=G,Y=j,Q=H,$=U,Z=W,J=V;function tt(t){let e=0,i=0;const s=t=>{e+=t.offsetLeft,t.offsetParent&&s(t.offsetParent)},n=t=>{i+=t.offsetTop,t.offsetParent&&n(t.offsetParent)};return s(t),n(t),new E(e,i)}function et(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function it(t,e){let i=-1;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)}function st(t,e){for(let i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}function nt(t){return t===A.Top?A.Bottom:t===A.Bottom?A.Top:t===A.Left?A.Right:t===A.Right?A.Left:A.None}function rt(t){const e=[E.Left,E.Right,E.Up,E.Down],i=[A.Left,A.Right,A.Top,A.Bottom];let s=-Number.MAX_VALUE,n=-1;for(let i=0;i<e.length;i++)e[i].dot(t)>s&&(s=e[i].dot(t),n=i);return i[n]}class ot{constructor(t=ot.DefaultSize){this._internalArray=null,this._endPointer=0,this._internalArray=new Array(t)}_resize(){const t=2*this._internalArray.length,e=new Array(t),i=this.count();for(let t=0;t<i;t++)e[t]=this._internalArray[t];delete this._internalArray,this._internalArray=e}push(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t}pop(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]}count(){return this._endPointer}clear(){this._endPointer=0}internalSize(){return this._internalArray.length}elementAt(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]}insert(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e}remove(t){const e=this.count();if(0===e)throw new Error("Invalid parameter "+t);const i=this._internalArray[t];for(let i=t;i<e;i++)this._internalArray[i]=this._internalArray[i+1];return this._endPointer--,i}removeElement(t){const e=this._internalArray.indexOf(t);this.remove(e)}toArray(){return this._internalArray.slice(0,this._endPointer)}forEach(t){let e=0;const i=this.count();for(;e<i;e++)t.call(this,this._internalArray[e],e)}map(t){const e=this.count();for(let i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)}}function at(t){throw new Error(t)}function lt(t,e){var i;const s=null!==(i=null==e?void 0:e.schedule.bind(e))&&void 0!==i?i:setTimeout;return new Promise((e=>{s((()=>{e()}),t)}))}var ht,ct,ut,dt,pt,ft;ot.DefaultSize=200,(ct=ht||(ht={}))[ct.X=12]="X",ct[ct.Y=13]="Y";class gt{constructor(){this.data=new Float32Array(16),this._scaleSignX=1,this._scaleSignY=1}static ortho(t,e,i,s,n,r){const o=new gt;return o.data[0]=2/(e-t),o.data[1]=0,o.data[2]=0,o.data[3]=0,o.data[4]=0,o.data[5]=2/(s-i),o.data[6]=0,o.data[7]=0,o.data[8]=0,o.data[9]=0,o.data[10]=-2/(r-n),o.data[11]=0,o.data[12]=-(e+t)/(e-t),o.data[13]=-(s+i)/(s-i),o.data[14]=-(r+n)/(r-n),o.data[15]=1,o}clone(){const t=new gt;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=this.data[2],t.data[3]=this.data[3],t.data[4]=this.data[4],t.data[5]=this.data[5],t.data[6]=this.data[6],t.data[7]=this.data[7],t.data[8]=this.data[8],t.data[9]=this.data[9],t.data[10]=this.data[10],t.data[11]=this.data[11],t.data[12]=this.data[12],t.data[13]=this.data[13],t.data[14]=this.data[14],t.data[15]=this.data[15],t}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new gt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=gt.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=gt.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=gt.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof E){const i=e||new E(0,0),s=t,n=s.x*this.data[0]+s.y*this.data[4]+this.data[12],r=s.x*this.data[1]+s.y*this.data[5]+this.data[13];return i.x=n,i.y=r,i}{const i=e||new gt,s=t,n=this.data[0],r=this.data[1],o=this.data[2],a=this.data[3],l=this.data[4],h=this.data[5],c=this.data[6],u=this.data[7],d=this.data[8],p=this.data[9],f=this.data[10],g=this.data[11],m=this.data[12],_=this.data[13],y=this.data[14],v=this.data[15],w=s.data[0],x=s.data[1],b=s.data[2],S=s.data[3],C=s.data[4],T=s.data[5],E=s.data[6],P=s.data[7],A=s.data[8],k=s.data[9],R=s.data[10],I=s.data[11],F=s.data[12],D=s.data[13],M=s.data[14],B=s.data[15];i.data[0]=n*w+l*x+d*b+m*S,i.data[1]=r*w+h*x+p*b+_*S,i.data[2]=o*w+c*x+f*b+y*S,i.data[3]=a*w+u*x+g*b+v*S,i.data[4]=n*C+l*T+d*E+m*P,i.data[5]=r*C+h*T+p*E+_*P,i.data[6]=o*C+c*T+f*E+y*P,i.data[7]=a*C+u*T+g*E+v*P,i.data[8]=n*A+l*k+d*R+m*I,i.data[9]=r*A+h*k+p*R+_*I,i.data[10]=o*A+c*k+f*R+y*I,i.data[11]=a*A+u*k+g*R+v*I,i.data[12]=n*F+l*D+d*M+m*B,i.data[13]=r*F+h*D+p*M+_*B,i.data[14]=o*F+c*D+f*M+y*B,i.data[15]=a*F+u*D+g*M+v*B;const L=this.getScale();return i._scaleSignX=O(L.x)*O(i._scaleSignX),i._scaleSignY=O(L.y)*O(i._scaleSignY),i}}translate(t,e){const i=this.data[0],s=this.data[1],n=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],l=this.data[6],h=this.data[7],c=this.data[8],u=this.data[9],d=this.data[10],p=this.data[11],f=this.data[12],g=this.data[13],m=this.data[14],_=this.data[15];return this.data[12]=i*t+o*e+0*c+1*f,this.data[13]=s*t+a*e+0*u+1*g,this.data[14]=n*t+l*e+0*d+1*m,this.data[15]=r*t+h*e+0*p+1*_,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return P(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],n=this.data[3],r=this.data[4],o=this.data[5],a=this.data[6],l=this.data[7],h=Math.sin(t),c=Math.cos(t);return this.data[0]=c*e+h*r,this.data[1]=c*i+h*o,this.data[2]=c*s+h*a,this.data[3]=c*n+h*l,this.data[4]=c*r-h*e,this.data[5]=c*o-h*i,this.data[6]=c*a-h*s,this.data[7]=c*l-h*n,this}scale(t,e){const i=this.data[0],s=this.data[1],n=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],l=this.data[6],h=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=n*t,this.data[3]=r*t,this.data[4]=o*e,this.data[5]=a*e,this.data[6]=l*e,this.data[7]=h*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){return H(Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX()))}getScaleX(){const t=P(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=P(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return P(this.getScaleX(),this.getScaleY())}setScaleX(t){this._scaleSignX=O(t);const e=P(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t}setScaleY(t){this._scaleSignY=O(t);const e=P(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const e=1/this.getBasisDeterminant(),i=this.data[0],s=this.data[4],n=this.data[1],r=this.data[5],o=t||gt.identity();o.data[0]=r*e,o.data[1]=-n*e,o.data[4]=-s*e,o.data[5]=i*e;const a=this.data[12],l=this.data[13];return o.data[12]=-(a*o.data[0]+l*o.data[4]),o.data[13]=-(a*o.data[1]+l*o.data[5]),o}isIdentity(){return 1===this.data[0]&&0===this.data[1]&&0===this.data[2]&&0===this.data[3]&&0===this.data[4]&&1===this.data[5]&&0===this.data[6]&&0===this.data[7]&&0===this.data[8]&&0===this.data[9]&&1===this.data[10]&&0===this.data[11]&&0===this.data[12]&&0===this.data[13]&&0===this.data[14]&&1===this.data[15]}toString(){return`\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`}}class mt{constructor(){this._transforms=[],this._currentTransform=gt.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class _t{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1}}_cloneState(){return{opacity:this._currentState.opacity}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}}function yt(t,e){return t&&void 0===t.__isProxy?new Proxy(t,{set:(t,i,s)=>(t[i]!==s&&(t[i]=s,"string"==typeof i&&"_"!==i[0]&&e(t)),!0),get:(t,e)=>"__isProxy"===e||t[e]}):t}function vt(t,e){return t&&void 0===t.__isProxy?new Proxy(t,{set:(t,i,s)=>(t[i]=s,"string"==typeof i&&"_"!==i[0]&&e(t),!0),get:(t,e)=>"__isProxy"===e||t[e]}):t}class wt{constructor(t){var e,i,s,n,r,o;this.id=wt._ID++,this.transform=gt.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=E.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=null!==(e=t.origin)&&void 0!==e?e:this.origin,this.flipHorizontal=null!==(i=t.flipHorizontal)&&void 0!==i?i:this.flipHorizontal,this.flipVertical=null!==(s=t.flipVertical)&&void 0!==s?s:this.flipVertical,this.rotation=null!==(n=t.rotation)&&void 0!==n?n:this.rotation,this.opacity=null!==(r=t.opacity)&&void 0!==r?r:this.opacity,this.scale=null!==(o=t.scale)&&void 0!==o?o:this.scale)}isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=yt(t,(()=>{this._transformStale=!0})),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=yt(t,(()=>{this._transformStale=!0})),this._transformStale=!0}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return D.fromDimension(this.width,this.height,E.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,n=null!==(e=this.origin)&&void 0!==e?e:P(this.width/2,this.height/2);t.translate(n.x,n.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-n.x,-n.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}function xt(t){return 0==(t&t-1)}function bt(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function St(t){return xt(t)?t:bt(t)}function Ct(t,e){switch(e){case t.FLOAT:return 4;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.BYTE:case t.UNSIGNED_BYTE:default:return 1}}function Tt(t,e){switch(e){case t.LOW_FLOAT:case t.HIGH_FLOAT:case t.FLOAT:return 1;case t.FLOAT_VEC2:return 2;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC4:return 4;case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:case t.SHORT:default:return 1}}function Et(t,e){switch(e){case t.LOW_FLOAT:case t.HIGH_FLOAT:case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:return t.FLOAT;case t.BYTE:return t.BYTE;case t.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case t.SHORT:return t.SHORT;case t.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;default:return t.FLOAT}}wt._ID=0,(dt=ut||(ut={})).Pixel="Pixel",dt.Blended="Blended";class Pt{static register(t){Pt._GL=t,Pt._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}static get(t){return Pt._TEXTURE_MAP.get(t)}static has(t){return Pt._TEXTURE_MAP.has(t)}static load(t,e,i=!1){const s=Pt._GL;if(!s)return null;let n=null;if(Pt.has(t)&&(n=Pt.get(t)),n){if(i){s.bindTexture(s.TEXTURE_2D,n);const e=Pt.toPowerOfTwoImage(t);s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)}return n}n=s.createTexture();const r=Pt.toPowerOfTwoImage(t);Pt.checkImageSizeSupportedAndLog(t),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const o=null!=e?e:Pt.filtering;return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o===ut.Pixel?s.NEAREST:s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o===ut.Pixel?s.NEAREST:s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,r),Pt._TEXTURE_MAP.set(t,n),n}static toPowerOfTwoImage(t){const e=Pt._POT_CANVAS,i=Pt._POT_CTX;return xt(t.width)&&xt(t.height)||(e.width=St(t.width),e.height=St(t.height),i.imageSmoothingEnabled=!1,i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0,t.width,t.height),t=e),t}static checkImageSizeSupportedAndLog(t){var e;const i=null!==(e=t.dataset.originalSrc)&&void 0!==e?e:"internal canvas bitmap";return t.width>Pt._MAX_TEXTURE_SIZE||t.height>Pt._MAX_TEXTURE_SIZE?(Pt._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${Pt._MAX_TEXTURE_SIZE}x${Pt._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.\n\nImages will likely render as black rectangles.\n\nRead more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&Pt._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).\n\nImages will likely render as black rectangles on some mobile platforms.\n\nRead more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}Pt._LOGGER=y.getInstance(),Pt.filtering=ut.Blended,Pt._POT_CANVAS=document.createElement("canvas"),Pt._POT_CTX=Pt._POT_CANVAS.getContext("2d"),Pt._TEXTURE_MAP=new Map,Pt._MAX_TEXTURE_SIZE=0;class At extends wt{constructor(t){var e,i,s,n,r,o,a,l;super(t),this.filtering=null,this._dirty=!0,this._smoothing=!1,this._color=yt(I.Black,(()=>this.flagDirty())),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.color=null!==(e=t.color)&&void 0!==e?e:I.Black,this.strokeColor=null==t?void 0:t.strokeColor,this.smoothing=null!==(i=t.smoothing)&&void 0!==i?i:this.smoothing,this.lineWidth=null!==(s=t.lineWidth)&&void 0!==s?s:this.lineWidth,this.lineDash=null!==(n=t.lineDash)&&void 0!==n?n:this.lineDash,this.padding=null!==(r=t.padding)&&void 0!==r?r:this.padding,this.filtering=null!==(o=t.filtering)&&void 0!==o?o:this.filtering),this._bitmap=document.createElement("canvas");const h=null!==(a=null==t?void 0:t.width)&&void 0!==a?a:this._bitmap.width,c=null!==(l=null==t?void 0:t.height)&&void 0!==l?l:this._bitmap.height;this.width=St(h),this.height=St(c);const u=this._bitmap.getContext("2d");if(!u)throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic");this._ctx=u}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(null!==(t=this._originalWidth)&&void 0!==t?t:this._bitmap.width)+2*this.padding}_getTotalHeight(){var t;return(null!==(t=this._originalHeight)&&void 0!==t?t:this._bitmap.height)+2*this.padding}get localBounds(){return D.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,E.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=yt(t,(()=>this.flagDirty()))}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=yt(t,(()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore(),Pt.load(this._bitmap,this.filtering,!0)}_applyRasterProperties(t){var e,i,s;this._bitmap.width=this._getTotalWidth(),this._bitmap.height=this._getTotalHeight(),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash(null!==(e=this.lineDash)&&void 0!==e?e:t.getLineDash()),t.strokeStyle=null===(i=this.strokeColor)||void 0===i?void 0:i.toString(),t.fillStyle=null===(s=this.color)||void 0===s?void 0:s.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.drawImage(this._bitmap,e,i)}}class kt extends At{constructor(t){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new kt({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;(null===(e=this._options)||void 0===e?void 0:e.draw)&&(null===(i=this._options)||void 0===i||i.draw(t)),this._options.cache||this.flagDirty()}}(ft=pt||(pt={})).Kill="kill",ft.PreKill="prekill",ft.PostKill="postkill",ft.PreDraw="predraw",ft.PostDraw="postdraw",ft.PreDebugDraw="predebugdraw",ft.PostDebugDraw="postdebugdraw",ft.PreUpdate="preupdate",ft.PostUpdate="postupdate",ft.PreFrame="preframe",ft.PostFrame="postframe",ft.PreCollision="precollision",ft.CollisionStart="collisionstart",ft.CollisionEnd="collisionend",ft.PostCollision="postcollision",ft.Initialize="initialize",ft.Activate="activate",ft.Deactivate="deactivate",ft.ExitViewport="exitviewport",ft.EnterViewport="enterviewport",ft.ExitTrigger="exit",ft.EnterTrigger="enter",ft.Connect="connect",ft.Disconnect="disconnect",ft.Button="button",ft.Axis="axis",ft.Subscribe="subscribe",ft.Unsubscribe="unsubscribe",ft.Visible="visible",ft.Hidden="hidden",ft.Start="start",ft.Stop="stop",ft.PointerUp="pointerup",ft.PointerDown="pointerdown",ft.PointerMove="pointermove",ft.PointerEnter="pointerenter",ft.PointerLeave="pointerleave",ft.PointerCancel="pointercancel",ft.PointerWheel="pointerwheel",ft.Up="up",ft.Down="down",ft.Move="move",ft.Enter="enter",ft.Leave="leave",ft.Cancel="cancel",ft.Wheel="wheel",ft.Press="press",ft.Release="release",ft.Hold="hold",ft.PointerDragStart="pointerdragstart",ft.PointerDragEnd="pointerdragend",ft.PointerDragEnter="pointerdragenter",ft.PointerDragLeave="pointerdragleave",ft.PointerDragMove="pointerdragmove";class Rt{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class It extends Rt{constructor(t){super(),this.target=t}}class Ft extends Rt{constructor(t){super(),this.target=t}}class Dt extends Rt{constructor(t){super(),this.target=t}}class Mt extends Rt{constructor(t){super(),this.target=t}}class Bt extends Rt{constructor(t){super(),this.target=t}}class Lt extends Rt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class zt extends Rt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class Ot extends Rt{constructor(t,e){super(),this.ctx=t,this.target=e}}class Nt extends Rt{constructor(t,e){super(),this.ctx=t,this.target=e}}class Ht extends Rt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class Ut extends Rt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class Wt extends Rt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class Vt extends Rt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class Gt extends Rt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class jt extends Rt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Xt extends Rt{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class qt extends Rt{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class Kt extends Rt{constructor(t,e){super(),this.topic=t,this.handler=e}}class Yt extends Rt{constructor(t,e){super(),this.topic=t,this.handler=e}}class Qt extends Rt{constructor(t){super(),this.target=t}}class $t extends Rt{constructor(t){super(),this.target=t}}class Zt extends Rt{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}}class Jt extends Rt{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class te{constructor(t,e,i){this.target=t,this.other=e,this.contact=i}}class ee{constructor(t,e){this.target=t,this.other=e}}class ie{constructor(t,e,i,s,n){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=n}}class se{constructor(t,e,i,s,n){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=n}}class ne extends Rt{constructor(t,e,i){super(),this.other=e,this.contact=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class re extends Rt{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class oe extends Rt{constructor(t,e){super(),this.engine=t,this.target=e}}class ae extends Rt{constructor(t,e){super(),this.oldScene=t,this.target=e}}class le extends Rt{constructor(t,e){super(),this.newScene=t,this.target=e}}class he extends Rt{constructor(t){super(),this.target=t}}class ce extends Rt{constructor(t){super(),this.target=t}}class ue extends Rt{constructor(t,e){super(),this.target=t,this.actor=e}}class de extends Rt{constructor(t,e){super(),this.target=t,this.actor=e}}class pe{constructor(){this._handlers={},this._wiredEventDispatchers=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}emit(t,e){if(!t)return;let i,s;if(t=t.toLowerCase(),e||(e=new Rt),this._handlers[t])for(i=0,s=this._handlers[t].length;i<s;i++)this._handlers[t][i](e);for(i=0,s=this._wiredEventDispatchers.length;i<s;i++)this._wiredEventDispatchers[i].emit(t,e)}on(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new Kt(t,e))}off(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(e){const s=i.indexOf(e);this._handlers[t].splice(s,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new Yt(t,e))}once(t,e){this.on(t,(i=>{const s=i||new Rt;this.off(t,e),e(s)}))}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class fe{constructor(t,e,i=!0){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=y.getInstance(),this.events=new pe}isLoaded(){return null!==this.data}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise(((t,e)=>{if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),void t(this.data);const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",(t=>this.events.emit("loadstart",t))),i.addEventListener("progress",(t=>this.events.emit("progress",t))),i.addEventListener("error",(t=>this.events.emit("error",t))),i.addEventListener("load",(t=>this.events.emit("load",t))),i.addEventListener("load",(()=>{if(0!==i.status&&200!==i.status)return this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),void e(new Error(i.statusText));this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)})),i.send()}))}}var ge=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let me=class{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=(n[s+0]+n[s+1]+n[s+2])/3;n[s+0]=r,n[s+1]=r,n[s+2]=r}};me=ge([T({message:"Grayscale will be removed in v0.26.0"})],me);let _e=class{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;n[s+0]=255-n[s+0],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2]}};_e=ge([T({message:"Invert will be removed in v0.26.0"})],_e);let ye=class{constructor(t){this.opacity=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+3]=Math.round(this.opacity*n[s+3]))}};ye=ge([T({message:"Opacity will be removed in v0.26.0"})],ye);let ve=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=(n[s+0]+this.color.r)/2,n[s+1]=(n[s+1]+this.color.g)/2,n[s+2]=(n[s+2]+this.color.b)/2)}};ve=ge([T({message:"Colorize will be removed in v0.26.0"})],ve);let we=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=I.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).lighten(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};we=ge([T({message:"Lighten will be removed in v0.26.0"})],we);let xe=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=I.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).darken(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};xe=ge([T({message:"Darken will be removed v0.26.0"})],xe);let be=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=I.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).saturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};be=ge([T({message:"Saturate will be removed in v0.26.0"})],be);let Se=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=I.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).desaturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};Se=ge([T({message:"Desaturate will be removed in v0.26.0"})],Se);let Ce=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=this.color.r,n[s+1]=this.color.g,n[s+2]=this.color.b)}};Ce=ge([T({message:"Fill will be removed in v0.26.0"})],Ce);class Te{constructor(t,e=!0){this.path=t,this.bustCache=e,this._sprite=null,this.loaded=new Promise((t=>{this._loadedResolve=t})),this._resource=new fe(t,"blob",e),this._sprite=new Ae(this,0,0,0,0)}get image(){return this.data}isLoaded(){return!!this.data}async load(){try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=await this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,await e.decode(),this.data=e,this.width=this._sprite.width=e.naturalWidth,this.height=this._sprite.height=e.naturalHeight,this._sprite=new Ae(this,0,0,this.width,this.height)}catch(t){await Promise.reject("Error loading texture")}return this._loadedResolve(this.data),this.data}asSprite(){return this._sprite}}function Ee(t){return class extends t{assign(t){for(const e in t)"function"!=typeof this[e]&&(this[e]=t[e])}constructor(...t){super(...t),1!==t.filter((function(t){return void 0!==t})).length||!t[0]||"object"!=typeof t[0]||t[0]instanceof Array||this.assign(t[0])}}}class Pe{constructor(t,e,i,s,n){this.x=0,this.y=0,this.rotation=0,this.anchor=E.Half,this.offset=E.Zero,this.scale=E.One,this.drawAroundAnchor=!1,this.logger=y.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!0,this._opacity=1;let r=t;if(t&&!(t instanceof Te)&&(e=0|t.x,i=0|t.y,s=0|t.width,n=0|t.height,r=t.image,!r))throw new Error("An image texture is required to construct a sprite");this.x=e||0,this.y=i||0,this.texture=r,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=s,this._spriteCanvas.height=n,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._initPixelsFromTexture(),this.width=s,this.height=n}get drawWidth(){return Math.abs(this.width*this.scale.x)}get drawHeight(){return Math.abs(this.height*this.scale.y)}async _initPixelsFromTexture(){try{const t=await this.texture.loaded;this.width=this.width||t.naturalWidth,this.height=this.height||t.naturalHeight,this._spriteCanvas.width=this._spriteCanvas.width||t.naturalWidth,this._spriteCanvas.height=this._spriteCanvas.height||t.naturalHeight,this._loadPixels(),this._dirtyEffect=!0}catch(t){this.logger.error("Error loading texture ",this.texture.path,t)}}_loadPixels(){if(this.texture.isLoaded()&&!this._pixelsLoaded){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${t} of the backing texture ${this.texture.path}`),this.width<=0||t<=0)throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${t}`);if(this.height>e&&this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${e} of the backing texture ${this.texture.path}`),this.height<=0||e<=0)throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${e}`);this._flushTexture(),this._pixelsLoaded=!0}}_flushTexture(){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this.texture.image,N(this.x,0,t),N(this.y,0,e),N(this.width,0,t),N(this.height,0,e),0,0,this.width,this.height)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new me)}invert(){this.addEffect(new _e)}fill(t){this.addEffect(new Ce(t))}colorize(t){this.addEffect(new ve(t))}lighten(t=.1){this.addEffect(new we(t))}darken(t=.1){this.addEffect(new xe(t))}saturate(t=.1){this.addEffect(new be(t))}desaturate(t=.1){this.addEffect(new Se(t))}addEffect(t){this.effects.push(t),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0}removeEffect(t){let e=-1;e="number"==typeof t?t:this.effects.indexOf(t),e<0||e>=this.effects.length||(this.effects.splice(e,1),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)}_applyEffects(){if(this._flushTexture(),this.effects.length>0){this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);const t=this.effects.length;for(let e=0;e<t;e++)for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.effects[e].updatePixel(i,t,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0)}this._dirtyEffect=!1}clearEffects(){this.effects.length=0,this._applyEffects()}reset(){}debugDraw(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);const s=this.drawWidth*this.anchor.x,n=this.drawHeight*this.anchor.y;t.strokeStyle=I.Black.toString(),t.strokeRect(-s,-n,this.drawWidth,this.drawHeight),t.restore()}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l,h;const{ctx:c,x:u,y:d,rotation:p,drawWidth:f,drawHeight:g,anchor:m,offset:_,opacity:y,flipHorizontal:v,flipVertical:w}={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.width,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.height,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:(null!==(l=t.opacity)&&void 0!==l?l:1)*(null!==(h=this._opacity)&&void 0!==h?h:1)};this._dirtyEffect&&this._applyEffects();const x=f*m.x+_.x,b=g*m.y+_.y,S=this.scale.x>0?1:-1,C=this.scale.y>0?1:-1;c.save(),c.translate(u,d),c.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this.drawAroundAnchor&&c.translate(-x,-b),c.translate(x,b),c.rotate(p),c.scale(S,C),c.translate(-x,-b),v&&(c.translate(f,0),c.scale(-1,1)),w&&(c.translate(0,g),c.scale(1,-1));const T=c.globalAlpha;c.globalAlpha=y,c.drawImage(this._spriteCanvas,0,0,this.width,this.height,0,0,this.width,this.height),c.globalAlpha=T,c.restore()}clone(){const t=new Ae(this.texture,this.x,this.y,this.width,this.height);t.anchor=this.anchor.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;const e=this.effects.length;for(let i=0;i<e;i++)t.addEffect(this.effects[i]);return t}}let Ae=class extends(Ee(Pe)){constructor(t,e,i,s,n){super(t,e,i,s,n)}};Ae=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([T({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],Ae);class ke extends wt{constructor(t){var e,i;super(t),this._dirty=!0,this.image=t.image;const{width:s,height:n}=t;this.sourceView=null!==(e=t.sourceView)&&void 0!==e?e:{x:0,y:0,width:null!=s?s:0,height:null!=n?n:0},this.destSize=null!==(i=t.destSize)&&void 0!==i?i:{width:null!=s?s:0,height:null!=n?n:0},this._updateSpriteDimensions(),this.image.ready.then((()=>{this._updateSpriteDimensions()}))}static from(t){return new ke({image:t})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,s,n,r;const{width:o,height:a}=this.image;this.sourceView.width=(null===(t=this.sourceView)||void 0===t?void 0:t.width)||o,this.sourceView.height=(null===(e=this.sourceView)||void 0===e?void 0:e.height)||a,this.destSize.width=(null===(i=this.destSize)||void 0===i?void 0:i.width)||(null===(s=this.sourceView)||void 0===s?void 0:s.width)||o,this.destSize.height=(null===(n=this.destSize)||void 0===n?void 0:n.height)||(null===(r=this.sourceView)||void 0===r?void 0:r.height)||a,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()&&t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height)}static fromLegacySprite(t){const e=t.texture,i=Re.fromLegacyTexture(e);return new ke({image:i,sourceView:{x:t.x,y:t.y,width:t.width,height:t.height}})}static toLegacySprite(t){const e=t.image,i=new Te(e.path);return i.data=e.image,new Ae(i,t.sourceView.x,t.sourceView.y,t.sourceView.width,t.sourceView.height)}clone(){return new ke({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}class Re{constructor(t,e=!1,i){this.path=t,this._logger=y.getInstance(),this.data=new Image,this._resource=new fe(t,"blob",e),this._filtering=i,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`),this.ready=new Promise((t=>{this._loadedResolve=t}))}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}async load(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=await this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,e.setAttribute("data-original-src",this.path),await e.decode(),this.data=e}catch(t){throw`Error loading ImageSource from path '${this.path}' with error [${t.message}]`}return Pt.load(this.data,this._filtering),this._loadedResolve(this.data),this.data}toSprite(){return ke.from(this)}static fromLegacyTexture(t){const e=new Re(t.path);return t.isLoaded()?e.data=t.data:t.loaded.then((()=>{e.data=t.data})),e}unload(){this.data=new Image}}class Ie{constructor(t,e,i,s){this.sprites=[],this.currentFrame=0,this._timeLeftInFrame=0,this._idempotencyToken=-1,this.anchor=E.Zero,this.rotation=0,this.scale=E.One,this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0,this._opacity=1;let n=t;if(t&&!(t instanceof Yr)){const r=t;n=r.engine,e=r.sprites,i=r.speed,s=r.loop}this.sprites=e,this.speed=i,this._engine=n,this._timeLeftInFrame=this.speed,null!=s&&(this.loop=s),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new me)}invert(){this.addEffect(new _e)}fill(t){this.addEffect(new Ce(t))}colorize(t){this.addEffect(new ve(t))}lighten(t=.1){this.addEffect(new we(t))}darken(t=.1){this.addEffect(new xe(t))}saturate(t=.1){this.addEffect(new be(t))}desaturate(t=.1){this.addEffect(new Se(t))}addEffect(t){for(const e in this.sprites)this.sprites[e].addEffect(t)}removeEffect(t){for(const e in this.sprites)this.sprites[e].removeEffect(t)}clearEffects(){for(const t in this.sprites)this.sprites[t].clearEffects()}_setAnchor(t){for(const e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)}_setRotation(t){for(const e in this.sprites)this.sprites[e].rotation=t}_setScale(t){for(const e in this.sprites)this.sprites[e].scale=t}reset(){this.currentFrame=0}isDone(){return!this.loop&&this.currentFrame>=this.sprites.length}tick(t,e){if(this._idempotencyToken===e)return;this._idempotencyToken=e,this._timeLeftInFrame-=t,this._timeLeftInFrame<=0&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._timeLeftInFrame=this.speed),this._updateValues();const i=this.sprites[this.currentFrame];i&&(this.width=i.width,this.height=i.height,this.drawWidth=i.drawWidth,this.drawHeight=i.drawHeight)}_updateValues(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)}skip(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l;const h={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,opacity:(null!==(a=t.opacity)&&void 0!==a?a:1)*(null!==(l=this._opacity)&&void 0!==l?l:1)};let c;this._updateValues(),this.currentFrame<this.sprites.length&&(c=this.sprites[this.currentFrame],c.draw(h)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(c=this.sprites[N(this.freezeFrame,0,this.sprites.length-1)],c.draw(h)),c&&(this.drawWidth=c.drawWidth,this.drawHeight=c.drawHeight)}play(t,e){this.reset(),this._engine.playAnimation(this,t,e)}}let Fe=class extends(Ee(Ie)){constructor(t,e,i,s){super(t,e,i,s)}};var De,Me,Be,Le,ze,Oe,Ne,He,Ue,We;Fe=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([T({message:"Animation will be removed in v0.26.0",alternateMethod:"Use Graphics.Animation"})],Fe),(Me=De||(De={})).Em="em",Me.Rem="rem",Me.Px="px",Me.Pt="pt",Me.Percent="%",(Le=Be||(Be={})).Left="left",Le.Right="right",Le.Center="center",Le.Start="start",Le.End="end",(Oe=ze||(ze={})).Top="top",Oe.Hanging="hanging",Oe.Middle="middle",Oe.Alphabetic="alphabetic",Oe.Ideographic="ideographic",Oe.Bottom="bottom",(He=Ne||(Ne={})).Normal="normal",He.Italic="italic",He.Oblique="oblique",(We=Ue||(Ue={})).LeftToRight="ltr",We.RightToLeft="rtl";class Ve{constructor(t,e,i,s,n,r){this._sprites=[],this._image=null,this._columns=0,this._rows=0,this._spWidth=0,this._spHeight=0,this._spacing=0;let o=!1;if(t instanceof Array?this._sprites=t:(!t||t instanceof Te?(this._image=t,this._columns=e,this._rows=i,this._spWidth=s,this._spHeight=n,this._spacing=r||0):(this._columns=t.columns,this._rows=t.rows,this._spWidth=t.spWidth,this._spHeight=t.spHeight,this._image=t.image,this._spacing=t.spacing||0),this._sprites=new Array(this._columns*this._rows),o=!0),this.image instanceof Te){let t=!1,e=!1;if(this.image.isLoaded()){if(t=this.spWidth*this.columns>this.image.image.naturalWidth,e=this.spHeight*this.rows>this.image.image.naturalHeight,t)throw new RangeError(`SpriteSheet specified is wider, ${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} pixels than image width`);if(e)throw new RangeError(`SpriteSheet specified is taller, ${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} pixels than image height`)}}if(o){const t=this.getSpacingDimensions();for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this._sprites[i+e*this.columns]=new Ae(this.image,i*this.spWidth+t.margin*i+t.left,e*this.spHeight+t.margin*e+t.top,this.spWidth,this.spHeight)}}get spacing(){return this._spacing}get sprites(){return[...this._sprites]}get image(){return this._image}get columns(){return this._columns}get rows(){return this._rows}get spWidth(){return this._spWidth}get spHeight(){return this._spHeight}getSpacingDimensions(){var t,e,i;return"number"==typeof this.spacing?{left:this.spacing,top:this.spacing,margin:this.spacing}:{left:null!==(t=this.spacing.left)&&void 0!==t?t:0,top:null!==(e=this.spacing.top)&&void 0!==e?e:0,margin:null!==(i=this.spacing.margin)&&void 0!==i?i:0}}getAnimationByIndices(t,e,i){let s=e.map((t=>this.sprites[t]));return s=s.map((function(t){return t.clone()})),new Fe(t,s,i)}getAnimationBetween(t,e,i,s){let n=this.sprites.slice(e,i);return n=n.map((function(t){return t.clone()})),new Fe(t,n,s)}getAnimationForAll(t,e){const i=this.sprites.map((function(t){return t.clone()}));return new Fe(t,i,e)}getSprite(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)}getAnimationByCoords(t,e,i){let s=0,n=0;const r=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t];i.image=i.image||this.image,s=Math.max(s,i.drawWidth),n=Math.max(n,i.drawHeight),r[t]=new Ae(i)}const o=new Fe(t,r,i);return o.drawWidth=s,o.drawHeight=n,o}}let Ge=class extends Ve{constructor(t,e,i,s,n,r,o,a){super(t instanceof Te?{image:t,spWidth:r,spHeight:o,rows:n,columns:s,spacing:a||0}:t),this._currentColor=I.Black,this._currentOpacity=1,this._spriteRecord={},this._textShadowOn=!1,this._textShadowDirty=!0,this._textShadowColor=I.Black,this._textShadowSprites={},this._shadowOffsetX=5,this._shadowOffsetY=5,!t||t instanceof Te||(e=t.alphabet,i=t.caseInsensitive),this.alphabet=e,this.caseInsensitive=i,this._spriteRecord=this.getTextSprites()}getTextSprites(){const t={};for(let e=0;e<this.alphabet.length;e++){let i=this.alphabet[e];this.caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t}setTextShadow(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0;for(const t in this._spriteRecord)this._textShadowSprites[t]=this._spriteRecord[t].clone()}useTextShadow(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)}draw(t,e,i,s,n){if(n=this._parseOptions(n),this._currentColor.toString()!==n.color.toString()||this._currentOpacity!==n.opacity){this._currentOpacity=n.opacity,this._currentColor=n.color;for(const t in this._spriteRecord)this._spriteRecord[t].clearEffects(),this._spriteRecord[t].fill(n.color),this._spriteRecord[t].opacity(n.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(const t in this._textShadowSprites)this._textShadowSprites[t].clearEffects(),this._textShadowSprites[t].addEffect(new Ce(this._textShadowColor.clone()));this._textShadowDirty=!1}const r=this.sprites[0],o=r.height,a=n.fontSize/o,l=e.length*r.width*a+e.length*n.letterSpacing;let h=i;n.textAlign===Be.Left||n.textAlign===Be.Start?h=i:n.textAlign===Be.Right||n.textAlign===Be.End?h=i-l:n.textAlign===Be.Center&&(h=i-l/2);let c=s-o*a;n.baseAlign===ze.Top||n.baseAlign===ze.Hanging?c=s:n.baseAlign===ze.Ideographic||n.baseAlign===ze.Bottom||n.baseAlign===ze.Alphabetic?c=s-o*a:n.baseAlign===ze.Middle&&(c=s-o*a/2);for(let i=0;i<e.length;i++){let s=e[i];this.caseInsensitive&&(s=s.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[s].drawAroundAnchor=!1,this._textShadowSprites[s].scale=P(a,a),this._textShadowSprites[s].draw(t,h+this._shadowOffsetX,c+this._shadowOffsetY));const e=this._spriteRecord[s];e.drawAroundAnchor=!1,e.scale=P(a,a),e.draw(t,h,c),h+=e.drawWidth+n.letterSpacing}catch(t){y.getInstance().error(`SpriteFont Error drawing char ${s}`)}}}_parseOptions(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||I.Black,textAlign:(t.textAlign,t.textAlign),baseAlign:(t.baseAlign,t.baseAlign),maxWidth:t.maxWidth||-1,opacity:t.opacity||0}}};Ge=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([T({message:"SpriteSheet will be removed in v0.26.0",alternateMethod:"Use Graphics.SpriteSheet"})],Ge);class je{constructor(t){this._logger=y.getInstance(),this.sprites=[];const{sprites:e,rows:i,columns:s}=t;this.sprites=e,this.rows=null!=i?i:1,this.columns=null!=s?s:this.sprites.length}getSprite(t,e){if(t>=this.columns||t<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1}`),null;if(e>=this.rows||e<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1}`),null;const i=t+e*this.columns;return this.sprites[i]}static fromLegacySpriteSheet(t){const e=t.sprites.map((t=>ke.fromLegacySprite(t)));return new je({sprites:e})}static toLegacySpriteSheet(t){const e=t.sprites.map((t=>ke.toLegacySprite(t)));return new Ve(e)}static fromImageSource(t){var e;const i=[];t.spacing=null!==(e=t.spacing)&&void 0!==e?e:{};const{image:s,grid:{rows:n,columns:r,spriteWidth:o,spriteHeight:a},spacing:{originOffset:l,margin:h}}=t,c={x:0,y:0,...l},u={x:0,y:0,...h};for(let t=0;t<r;t++)for(let e=0;e<n;e++)i[t+e*r]=new ke({image:s,sourceView:{x:t*o+u.x*t+c.x,y:e*a+u.y*e+c.y,width:o,height:a},destSize:{height:a,width:o}});return new je({sprites:i,rows:n,columns:r})}}class Xe extends wt{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=y.getInstance(),this._alreadyWarnedAlphabet=!1,this._alreadyWarnedSpriteSheet=!1;const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:n,shadow:r}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=null!=s?s:this.caseInsensitive,this.spacing=null!=n?n:this.spacing,this.shadow=null!=r?r:this.shadow}static fromLegacySpriteFont(t){const e=t.sprites.map(ke.fromLegacySprite);return new Xe({alphabet:t.alphabet,spacing:0,caseInsensitive:t.caseInsensitive,spriteSheet:new je({sprites:e})})}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let t=0;t<i.length;t++){const n=i[t];let r=s.indexOf(n);-1===r&&(r=0,this._alreadyWarnedAlphabet||(this._logger.warn(`SpriteFont - Cannot find letter '${n}' in configured alphabet '${s}'.`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedAlphabet=!0));const o=this.spriteSheet.sprites[r];o?e.push(o):this._alreadyWarnedSpriteSheet||(this._logger.warn(`SpriteFont - Cannot find sprite for '${n}' at index '${r}' in configured SpriteSheet`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedSpriteSheet=!0)}return e}measureText(t){const e=t.split("\n"),i=e.reduce(((t,e)=>t.length>e.length?t:e)),s=this._getCharacterSprites(i);let n=0,r=0;for(const t of s)n+=t.width+this.spacing,r=Math.max(r,t.height);return D.fromDimension(n,r*e.length,E.Zero)}_drawImage(t,e,i){let s=0,n=0,r=0;const o=this._text.split("\n");for(const a of o){for(const o of this._getCharacterSprites(a))o.draw(t,e+s,i+n),s+=o.width+this.spacing,r=Math.max(r,o.height);s=0,n+=r}}render(t,e,i,s,n){this._text=e;const r=this.measureText(e);this.width=r.width,this.height=r.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this.draw(t,s,n),t.restore()),this.draw(t,s,n)}clone(){return new Xe({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}}class qe{constructor(){this.fontSheet="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAwCAYAAAD+f6R/AAAAAXNSR0IArs4c6QAABcJJREFUeJztnemu7CgMhGE07//KmT9NhrAFVzkQndQntXRP3/bCZkwCSQhCCCGEEEIIIYQQQog/TRz953Ecx/nDGIe/vdNhlc9tIz605Fk/ZmWfsO1hn9Gxuv1KHbvb3iL/VN+d1WORbyr7yR/5b9M4vjNeqko6jPJHq5wGHU151o9J2Udse9hndCxuv0rH7rY3yD/Wdyf13MrnQeDfkZIUSGKM4ff3cWN82pEZuTyQGX2IxeyR63va//8VNCYCq+1yEkLtWyagXv1P1r1H+110gP3PzT4gT8uW/mdQ8mUG8E9DqOz4MS9ICKGbXpS2BpnIrRzYeS96cll08INlCMl2/glzdcfazuuPqQO03lmqrBHsf272Q6NODXj6zzZIJd/LAHYTg3Mays5gBi7ZR27fOgs0yj8rm36DLMFiPgkAdXHKOwUQeMCQ/adSh/qBQrT/tPxbAwA9+DOZEILPAATSuHMgTv7+Auk/df2lHPCZLvMSLJe34LkEQ9PwXF1SRTllMYgvIaflqyVAjLGbsiCDcOK76jflxZ+sINPyROc5071yKWK5CJTV3dMp6+tBlyCtNlhAq/+XbWoBDcRNXYBMzD4VvQygSuPYC2jGGaSSOxXfy3dTUEsanIvNeepm38N/hssSALTPZnAXfwIYRJn2b7UBcw0FKX+nDdAMpm2j9WVnxrUa7TXaVAca/B+TgaAVh6R/rH0P/5m01dt/RLYViJn+w/bhVX2P7f/duqom5qb02pRLCLGIMgBU1wCEEN9BAUCID6MAIMSHUQAQ4sMoAAjxYRQAhPgwd1uB0fuZ7H3cnn2P+9mr/Pe4B8/eB/fwP4eRtci/0f6OfTCPt/9oHwC6G6y19RHZDumxmwzR4eE/s/2Tte/q/+XLdc9DeJ19diesQc/j7Z8fCe4tAS4CxZ7sp7eiJi7HiZmjmOTGJs+93CbS3nP0XIPH3vW8/qz6QPnX2QdsV/1uw/iZYvg8ACeHd28rpPzfNfhL+7vkw/4Ou9s+Onhbv91elpKZ48Dl6bzpwwibHigRArf+Ptk9+L3Y1Q5OB4LgCeSBw1iuB3GeJh1/HrX/zF0A9Mk+u45zMkc3r4rWPomma5+p/514LB+Zo93MErJ1JHxXPzByGa/licRYVKbpeQCoQ6Q8yxuCwJF9IPsoDkHAo/3Tx26cvA4EtJ/n04w8QOq/mrR7ddfLAC5BYFNlVI/0CnOVUflOpvJUQMx9AIMIW/nWDM67/qw0+95v9goBqD9j+72u/KD9U89IbnQbMIR2Zbneh5zUY7Hdk7XIP3UffVb+r+wDYAZLq+1n1+C7y3/ny2r7p5yeByDEh9HzAIQQJwoAQnwYBQAhPowCgBBjoNu3hNxSFACE6INuKvPajPZ4EFEAEKINcybGYzOd247WEd3TgA2jlmjEyrd+j9hvfVbD2PWQ3ZmGlu2HyO8og8eBuNUvNYWoDgMVpwHTJoLWdz1Y+ZYOy5uF7t6PPruZxANrud1lQXkP0jsGz/Yz+vGGMuygFyhSPcJnc1pMnQZElc+cRnoAlxdTvoDuK7puqF7uCQy+3fyFMiA02/vJQHh7DQDogMPTSGFNA56HTzbZ9yAfBOb1Zyo3qGM3MfMZ3f76huXf6xlmAHknMlLNXsBBBvbljIz9Uyz5Y5TzIBLR/qy/rNyrZ8+L/0BZ0m+tgXD0OK5XZxC/9P7I/g4hVFvzXf1/6i5A7+3AlijMPBLMZfCvuAp7A9rY56ApHitmLQc7c8bOv6ftAxlM9Xp35nkEK7nJetBsaMhtAAAuOLQGXwhh2dXQnn1rZ/a42BI3dL7L+jkFAbQddwdA9Ah35yMKhgEgVT46EFh5D4jz+OgavNKxeBCd1wDSJ/97oR8eoJkLi9t9/BDgDHTJ5NE7Dnzechh914OVv9M1K9PCqsfqb88XVg9qN9lm6nG176UPu+zn17GOxuO0vOWEEC/j+LFKTgghlvEfYJaLS+SA2O0AAAAASUVORK5CYII=",this.size=16,this.load()}load(){return this._imageSource=new Re(this.fontSheet),this._imageSource.load().then((()=>{this._spriteSheet=je.fromImageSource({image:this._imageSource,grid:{rows:3,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Xe({alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&.\"?-()+ ",caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})}))}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class Ke{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Ye{constructor(t){this.width=t.width,this.height=t.height,this._gl=t.gl,this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return new Ke(this._gl,this._frameTexture)}use(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}class Qe{static clear(){Qe._GL=null}static register(t){Qe._GL=t}static get gl(){if(!Qe._GL)throw Error("Attempted gl access before init");return Qe._GL}}class $e{constructor(t){this._gl=Qe.gl,this.uniforms={},this.attributes={},this._compiled=!1;const{vertexSource:e,fragmentSource:i}=t;this.vertexSource=e,this.fragmentSource=i}get compiled(){return this._compiled}use(){this._gl.useProgram(this.program),$e._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return $e._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const s=this.getAttributes();for(const t of s)this.attributes[t.name]=t;const n=this.getUniforms();for(const t of n)this.uniforms[t.name]=t;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let s=0;s<e;s++){const e=t.getActiveUniform(this.program,s),n=t.getUniformLocation(this.program,e.name);i.push({name:e.name,glType:e.type,location:n})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let s=0;s<e;s++){const e=t.getActiveAttrib(this.program,s),n=t.getAttribLocation(this.program,e.name);i.push({name:e.name,glType:Et(t,e.type),size:Tt(t,e.type),location:n,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const s=this._gl.getUniformLocation(this.program,e);if(!s)throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`);{const e=[s,...i];this._gl[t].apply(this._gl,e)}}_createProgram(t,e,i){const s=t.createProgram();if(null===s)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.VERTEX_SHADER===i?"vertex":"fragment",n=t.createShader(i);if(null===n)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(n);throw Error(`Could not compile ${s} shader:\n\n${i}${this._processSourceForError(e,i)}`)}return n}_processSourceForError(t,e){const i=t.split("\n"),s=e.search(/\d:\d/),n=e.indexOf(" ",s),[r,o]=e.slice(s,n).split(":").map((t=>Number(t)));for(let t=0;t<i.length;t++)i[t]=`${t+1}: ${i[t]}${o===t+1?" <----- ERROR!":""}`;return"\n\nSource:\n"+i.join("\n")}}$e._ACTIVE_SHADER_INSTANCE=null;class Ze{constructor(t){this._gl=Qe.gl,this.type="dynamic";const{size:e,type:i,data:s}=t;if(this.buffer=this._gl.createBuffer(),!s&&!e)throw Error("Must either provide data or a size to the VertexBuffer");this.bufferData=s||new Float32Array(e),this.type=null!=i?i:this.type}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}upload(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.bufferData,"static"===this.type?t.STATIC_DRAW:t.DYNAMIC_DRAW)}}class Je{constructor(t){this._gl=Qe.gl,this._logger=y.getInstance(),this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0;const{shader:e,vertexBuffer:i,attributes:s}=t;this._vertexBuffer=i,this._attributes=s,this._shader=e,this.initialize()}get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}initialize(){if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._layout.length=0;const t=this._shader.attributes;for(const e of this._attributes){const i=t[e[0]];if(!i)throw Error(`The attribute named: ${e[0]} size ${e[1]} not found in the shader source code:\n ${this._shader.vertexSource}`);if(i.size!==e[1])throw Error(`VertexLayout size definition for attribute: [${e[0]}, ${e[1]}], doesnt match shader source size ${i.size}:\n ${this._shader.vertexSource}`);this._layout.push(i)}let e=0;for(const t of this._layout){const i=Ct(this._gl,t.glType);this._vertexTotalSizeBytes+=i*t.size,e+=t.size}this._vertexBuffer.bufferData.length%e!=0&&this._logger.warn(`The vertex component size (${e})  does divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`)}use(t=!1){const e=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload();let i=0;for(const t of this._layout)e.vertexAttribPointer(t.location,t.size,t.glType,t.normalized,this.totalVertexSizeBytes,i),e.enableVertexAttribArray(t.location),i+=Ct(e,t.glType)*t.size}}class ti{static clear(){ti.DrawCallCount=0,ti.DrawnImagesCount=0}}ti.DrawCallCount=0,ti.DrawnImagesCount=0;class ei{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new $e({vertexSource:"attribute vec2 a_position;\nattribute vec4 a_color;\n\nvarying lowp vec4 v_color;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Passthrough the color\n   v_color = a_color;\n}",fragmentSource:"precision mediump float;\n\n// Color\nvarying lowp vec4 v_color;\n\n\nvoid main() {\n  gl_FragColor = v_color;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Ze({size:12*this._maxLines,type:"dynamic"}),this._layout=new Je({vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const s=this._context.getTransform(),n=s.multiply(t),r=s.multiply(e),o=this._vertexBuffer.bufferData;o[this._vertexIndex++]=n.x,o[this._vertexIndex++]=n.y,o[this._vertexIndex++]=i.r/255,o[this._vertexIndex++]=i.g/255,o[this._vertexIndex++]=i.b/255,o[this._vertexIndex++]=i.a,o[this._vertexIndex++]=r.x,o[this._vertexIndex++]=r.y,o[this._vertexIndex++]=i.r/255,o[this._vertexIndex++]=i.g/255,o[this._vertexIndex++]=i.b/255,o[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return 0!==this._lineCount}flush(){if(0===this._lineCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,2*this._lineCount),ti.DrawnImagesCount+=this._lineCount,ti.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}class ii{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new $e({vertexSource:"attribute vec2 a_position;\nattribute vec4 a_color;\nattribute float a_size;\nvarying lowp vec4 v_color;\nuniform mat4 u_matrix;\n\nvoid main() {\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n  gl_PointSize = a_size * 2.0;\n  v_color = a_color;\n}",fragmentSource:'#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\nvarying lowp vec4 v_color;\n\nvoid main() {\n  float r = 0.0, delta = 0.0, alpha = 1.0;\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  r = dot(cxy, cxy);\n\n#ifdef GL_OES_standard_derivatives\n  delta = fwidth(r);\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n#else\n  if (r > 1.0) {\n    discard;\n  }\n#endif\n  // "premultiply" the color by alpha\n  vec4 color = v_color;\n  color.a = color.a * alpha;\n  color.rgb = color.rgb * color.a;\n  gl_FragColor = color;\n}'}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Ze({size:7*this._maxPoints,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const s=this._context.getTransform(),n=this._context.opacity,r=s.multiply(t),o=this._buffer.bufferData;o[this._vertexIndex++]=r.x,o[this._vertexIndex++]=r.y,o[this._vertexIndex++]=e.r/255,o[this._vertexIndex++]=e.g/255,o[this._vertexIndex++]=e.b/255,o[this._vertexIndex++]=e.a*n,o[this._vertexIndex++]=i*Math.max(s.getScaleX(),s.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return 0!==this._pointCount}flush(){if(0===this._pointCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),ti.DrawnImagesCount+=this._pointCount,ti.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}class si{constructor(t){this._gl=t,this._shader=new $e({vertexSource:"attribute vec2 a_position;\n\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = vec4(a_position, 0.0, 1.0);\n\n  // Pass the texcoord to the fragment shader.\n  v_texcoord = a_texcoord;\n}",fragmentSource:"precision mediump float;\n\n// Passed in from the vertex shader.\nvarying vec2 v_texcoord;\n\n// The texture.\nuniform sampler2D u_texture;\n\nvoid main() {\n   gl_FragColor = texture2D(u_texture, v_texcoord);\n}"}),this._shader.compile(),this._buffer=new Ze({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl;t.getShader().use(),t.getLayout().use(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class ni{constructor(t,e){this._gl=Qe.gl,this._logger=y.getInstance();const i=this._gl;this.buffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.buffer);const s=6*t;if(i.getExtension("OES_element_index_uint")&&!e)this.bufferData=new Uint32Array(s);else{const e=65535,n=Math.floor((e-1)/4);this.bufferGlType=i.UNSIGNED_SHORT,this.bufferData=new Uint16Array(s),t>n&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${n}) requested quads(${t})`)}let n=0;for(let t=0;t<s;t+=6)this.bufferData[t+0]=n+0,this.bufferData[t+1]=n+1,this.bufferData[t+2]=n+2,this.bufferData[t+3]=n+2,this.bufferData[t+4]=n+1,this.bufferData[t+5]=n+3,n+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.bufferData,i.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}}class ri{constructor(){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const i=this._transformFragmentSource("precision mediump float;\n\n// UV coord\nvarying vec2 v_texcoord;\n\n// Texture index\nvarying lowp float v_textureIndex;\n\n// Textures in the current draw\nuniform sampler2D u_textures[%%count%%];\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n   // In order to support the most efficient sprite batching, we have multiple\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\n   // that do not apply to a particular sprite.\n\n   vec4 color = vec4(1.0, 0, 0, 1.0);\n\n   // GLSL is templated out to pick the right texture and set the vec4 color\n   %%texture_picker%%\n\n   color.rgb = color.rgb * v_opacity;\n   color.a = color.a * v_opacity;\n   gl_FragColor = color;\n}",this._maxTextures);this._shader=new $e({fragmentSource:i,vertexSource:"attribute vec2 a_position;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\n// UV coordinate\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n\n// Texture number\nattribute lowp float a_textureIndex;\nvarying lowp float v_textureIndex;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the UV coord to the fragment shader\n   v_texcoord = a_texcoord;\n   // Pass through the texture number to the fragment shader\n   v_textureIndex = a_textureIndex;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map(((t,e)=>e))),this._buffer=new Ze({size:24*this._maxImages,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_texcoord",2],["a_textureIndex",1]]}),this._quads=new ni(this._maxImages,!0)}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let t=0;t<e;t++)s+=0===t?`if (v_textureIndex <= ${t}.5) {\n`:`   else if (v_textureIndex <= ${t}.5) {\n`,s+=`      color = texture2D(u_textures[${t}], v_texcoord);\n`,s+="   }\n";return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){const e=Pt.load(t);-1===this._textures.indexOf(e)&&this._textures.push(e)}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){return t?this._textures.indexOf(Pt.get(t)):-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}draw(t,e,i,s,n,r,o,a,l){var h,c,u,d;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);let p=(null==t?void 0:t.width)||s||0,f=(null==t?void 0:t.height)||n||0,g=[0,0,null!==(h=null!=s?s:null==t?void 0:t.width)&&void 0!==h?h:0,null!==(c=null!=n?n:null==t?void 0:t.height)&&void 0!==c?c:0],m=[null!=e?e:1,null!=i?i:1];void 0!==r&&void 0!==o&&void 0!==a&&void 0!==l&&(g=[null!=e?e:1,null!=i?i:1,null!==(u=null!=s?s:null==t?void 0:t.width)&&void 0!==u?u:0,null!==(d=null!=n?n:null==t?void 0:t.height)&&void 0!==d?d:0],m=[r,o],p=a,f=l),e=g[0],i=g[1];const _=g[2],y=g[3],v=this._context.getTransform(),w=this._context.opacity,x=this._context.snapToPixel;let b=P(m[0],m[1]),S=P(m[0]+p,m[1]),C=P(m[0],m[1]+f),T=P(m[0]+p,m[1]+f);b=v.multiply(b),S=v.multiply(S),C=v.multiply(C),T=v.multiply(T),x&&(b.x=~~b.x,b.y=~~b.y,S.x=~~S.x,S.y=~~S.y,C.x=~~C.x,C.y=~~C.y,T.x=~~T.x,T.y=~~T.y);const E=this._getTextureIdForImage(t),A=St(t.width||p),k=St(t.height||f),R=e/A,I=i/k,F=(e+_-.01)/A,D=(i+y-.01)/k,M=this._layout.vertexBuffer.bufferData;M[this._vertexIndex++]=b.x,M[this._vertexIndex++]=b.y,M[this._vertexIndex++]=w,M[this._vertexIndex++]=R,M[this._vertexIndex++]=I,M[this._vertexIndex++]=E,M[this._vertexIndex++]=C.x,M[this._vertexIndex++]=C.y,M[this._vertexIndex++]=w,M[this._vertexIndex++]=R,M[this._vertexIndex++]=D,M[this._vertexIndex++]=E,M[this._vertexIndex++]=S.x,M[this._vertexIndex++]=S.y,M[this._vertexIndex++]=w,M[this._vertexIndex++]=F,M[this._vertexIndex++]=I,M[this._vertexIndex++]=E,M[this._vertexIndex++]=T.x,M[this._vertexIndex++]=T.y,M[this._vertexIndex++]=w,M[this._vertexIndex++]=F,M[this._vertexIndex++]=D,M[this._vertexIndex++]=E}hasPendingDraws(){return 0!==this._imageCount}flush(){if(0===this._imageCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._imageCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._imageCount,ti.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0}}class oi{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,t.getExtension("OES_standard_derivatives"),this._shader=new $e({fragmentSource:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision mediump float;\n\n// UV coord\nvarying vec2 v_uv;\n\nvarying vec2 v_size; // in pixels\n\n// Color coord to blend with image\nvarying lowp vec4 v_color;\n\n// Stroke color if used\nvarying lowp vec4 v_strokeColor;\n\n// Stroke thickness if used\nvarying lowp float v_strokeThickness; // in pixels\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n    vec2 uv = v_uv;\n    vec2 fragCoord = uv * v_size;\n    float maxX = v_size.x - v_strokeThickness;\n    float minX = v_strokeThickness;\n    float maxY = v_size.y - v_strokeThickness;\n    float minY = v_strokeThickness;\n\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\n        fragCoord.y < maxY && fragCoord.y > minY) {\n      gl_FragColor = v_color;\n    } else {\n      gl_FragColor = v_strokeColor;\n    }\n    gl_FragColor.a *= v_opacity;\n    gl_FragColor.rgb *= gl_FragColor.a;\n\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\n\n    // float fHalfBorderDist      = 0.0;\n    // float fHalfBorderThickness = 0.0;\n\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\n    // {\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\n    // }\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\n    // {\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\n    // }\n    // else\n    // {\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\n        \n    //     float ellipse_ab    = v_radius-v_strokeThickness;\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \n            \n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\n    // }\n\n    // vec4 v4FromColor = v_strokeColor;\n    // v4FromColor.rgb *= v4FromColor.a;\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\n    // if (fHalfBorderDist < 0.0) {\n    //     v4ToColor = v_color;\n    //     v4ToColor.rgb *= v4ToColor.a;\n    // }\n\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\n\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\n    // gl_FragColor = finalColor;\n}",vertexSource:"attribute vec2 a_position;\n\n// UV coordinate\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n\nattribute vec2 a_size;\nvarying vec2 v_size;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\nattribute vec4 a_color;\nvarying vec4 v_color;\n\nattribute vec4 a_strokeColor;\nvarying vec4 v_strokeColor;\n\nattribute float a_strokeThickness;\nvarying float v_strokeThickness;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through UV coords\n   v_uv = a_uv;\n   // Pass through size\n   v_size = a_size;\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the color to the fragment shader\n   v_color = a_color;\n   // Pass through the stroke color to the fragment shader\n   v_strokeColor = a_strokeColor;\n   // Pass through the stroke thickenss to the fragment shader\n   v_strokeThickness = a_strokeThickness;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Ze({size:64*this._maxRectangles,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ni(this._maxRectangles,!0)}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof E&&t[1]instanceof E?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,s=1){this._isFull()&&this.flush(),this._rectangleCount++;const n=this._context.getTransform(),r=this._context.opacity,o=e.sub(t),a=o.size,l=o.normalize().perpendicular(),h=s/2,c=n.multiply(l.scale(h).add(t)),u=n.multiply(l.scale(-h).add(t)),d=n.multiply(l.scale(h).add(e)),p=n.multiply(l.scale(-h).add(e)),f=I.Transparent,g=this._layout.vertexBuffer.bufferData;g[this._vertexIndex++]=c.x,g[this._vertexIndex++]=c.y,g[this._vertexIndex++]=0,g[this._vertexIndex++]=0,g[this._vertexIndex++]=a,g[this._vertexIndex++]=s,g[this._vertexIndex++]=r,g[this._vertexIndex++]=i.r/255,g[this._vertexIndex++]=i.g/255,g[this._vertexIndex++]=i.b/255,g[this._vertexIndex++]=i.a,g[this._vertexIndex++]=f.r/255,g[this._vertexIndex++]=f.g/255,g[this._vertexIndex++]=f.b/255,g[this._vertexIndex++]=f.a,g[this._vertexIndex++]=0,g[this._vertexIndex++]=u.x,g[this._vertexIndex++]=u.y,g[this._vertexIndex++]=0,g[this._vertexIndex++]=1,g[this._vertexIndex++]=a,g[this._vertexIndex++]=s,g[this._vertexIndex++]=r,g[this._vertexIndex++]=i.r/255,g[this._vertexIndex++]=i.g/255,g[this._vertexIndex++]=i.b/255,g[this._vertexIndex++]=i.a,g[this._vertexIndex++]=f.r/255,g[this._vertexIndex++]=f.g/255,g[this._vertexIndex++]=f.b/255,g[this._vertexIndex++]=f.a,g[this._vertexIndex++]=0,g[this._vertexIndex++]=d.x,g[this._vertexIndex++]=d.y,g[this._vertexIndex++]=1,g[this._vertexIndex++]=0,g[this._vertexIndex++]=a,g[this._vertexIndex++]=s,g[this._vertexIndex++]=r,g[this._vertexIndex++]=i.r/255,g[this._vertexIndex++]=i.g/255,g[this._vertexIndex++]=i.b/255,g[this._vertexIndex++]=i.a,g[this._vertexIndex++]=f.r/255,g[this._vertexIndex++]=f.g/255,g[this._vertexIndex++]=f.b/255,g[this._vertexIndex++]=f.a,g[this._vertexIndex++]=0,g[this._vertexIndex++]=p.x,g[this._vertexIndex++]=p.y,g[this._vertexIndex++]=1,g[this._vertexIndex++]=1,g[this._vertexIndex++]=a,g[this._vertexIndex++]=s,g[this._vertexIndex++]=r,g[this._vertexIndex++]=i.r/255,g[this._vertexIndex++]=i.g/255,g[this._vertexIndex++]=i.b/255,g[this._vertexIndex++]=i.a,g[this._vertexIndex++]=f.r/255,g[this._vertexIndex++]=f.g/255,g[this._vertexIndex++]=f.b/255,g[this._vertexIndex++]=f.a,g[this._vertexIndex++]=0}drawRectangle(t,e,i,s,n=I.Transparent,r=0){this._isFull()&&this.flush(),this._rectangleCount++;const o=this._context.getTransform(),a=this._context.opacity,l=o.multiply(t.add(P(0,0))),h=o.multiply(t.add(P(e,0))),c=o.multiply(t.add(P(e,i))),u=o.multiply(t.add(P(0,i))),d=this._layout.vertexBuffer.bufferData;d[this._vertexIndex++]=l.x,d[this._vertexIndex++]=l.y,d[this._vertexIndex++]=0,d[this._vertexIndex++]=0,d[this._vertexIndex++]=e,d[this._vertexIndex++]=i,d[this._vertexIndex++]=a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n.r/255,d[this._vertexIndex++]=n.g/255,d[this._vertexIndex++]=n.b/255,d[this._vertexIndex++]=n.a,d[this._vertexIndex++]=r,d[this._vertexIndex++]=u.x,d[this._vertexIndex++]=u.y,d[this._vertexIndex++]=0,d[this._vertexIndex++]=1,d[this._vertexIndex++]=e,d[this._vertexIndex++]=i,d[this._vertexIndex++]=a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n.r/255,d[this._vertexIndex++]=n.g/255,d[this._vertexIndex++]=n.b/255,d[this._vertexIndex++]=n.a,d[this._vertexIndex++]=r,d[this._vertexIndex++]=h.x,d[this._vertexIndex++]=h.y,d[this._vertexIndex++]=1,d[this._vertexIndex++]=0,d[this._vertexIndex++]=e,d[this._vertexIndex++]=i,d[this._vertexIndex++]=a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n.r/255,d[this._vertexIndex++]=n.g/255,d[this._vertexIndex++]=n.b/255,d[this._vertexIndex++]=n.a,d[this._vertexIndex++]=r,d[this._vertexIndex++]=c.x,d[this._vertexIndex++]=c.y,d[this._vertexIndex++]=1,d[this._vertexIndex++]=1,d[this._vertexIndex++]=e,d[this._vertexIndex++]=i,d[this._vertexIndex++]=a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n.r/255,d[this._vertexIndex++]=n.g/255,d[this._vertexIndex++]=n.b/255,d[this._vertexIndex++]=n.a,d[this._vertexIndex++]=r}hasPendingDraws(){return 0!==this._rectangleCount}flush(){if(0===this._rectangleCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._rectangleCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._rectangleCount,ti.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}class ai{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,t.getExtension("OES_standard_derivatives"),this._shader=new $e({fragmentSource:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\n\n// UV coord\nvarying vec2 v_uv;\n\n// Color coord to blend with image\nvarying lowp vec4 v_color;\n\n// Stroke color if used\nvarying lowp vec4 v_strokeColor;\n\n// Stroke thickness if used\nvarying lowp float v_strokeThickness;\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n  // make (0, 0) the center the uv \n  vec2 uv = v_uv * 2.0 - 1.0;\n\n  vec4 color = v_color;\n  vec4 strokeColor = v_strokeColor;\n\n  // circle border is at radius 1.0 \n  // dist is > 0 when inside the circle \n  float d = length(uv);\n  float dist = 1.0 - length(uv);\n\n  // Fade based on fwidth\n  float fade = fwidth(dot(uv, uv));\n\n  // if dist is greater than 0 step to 1;\n  // when we cross this 0 threshold add a smooth fade\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\n\n  // if dist is greater than the stroke thickness step to 1\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\n\n  strokeColor.a *= fill * stroke;\n  strokeColor.rgb *= strokeColor.a;\n\n  color.a *= fill * (1.0 - stroke);\n  color.rgb *= color.a;\n\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\n  finalColor.rgb = finalColor.rgb * v_opacity;\n  finalColor.a = finalColor.a * v_opacity;\n  gl_FragColor = finalColor;\n}",vertexSource:"attribute vec2 a_position;\n\n// UV coordinate\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\nattribute vec4 a_color;\nvarying vec4 v_color;\n\nattribute vec4 a_strokeColor;\nvarying vec4 v_strokeColor;\n\nattribute float a_strokeThickness;\nvarying float v_strokeThickness;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through UV coords\n   v_uv = a_uv;\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the color to the fragment shader\n   v_color = a_color;\n   // Pass through the stroke color to the fragment shader\n   v_strokeColor = a_strokeColor;\n   // Pass through the stroke thickenss to the fragment shader\n   v_strokeThickness = a_strokeThickness;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Ze({size:56*this._maxCircles,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ni(this._maxCircles,!0)}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,s=I.Transparent,n=0){this._isFull()&&this.flush(),this._circleCount++;const r=this._context.getTransform(),o=this._context.opacity,a=r.multiply(t.add(P(-e,-e))),l=r.multiply(t.add(P(e,-e))),h=r.multiply(t.add(P(e,e))),c=r.multiply(t.add(P(-e,e))),u=this._layout.vertexBuffer.bufferData;u[this._vertexIndex++]=a.x,u[this._vertexIndex++]=a.y,u[this._vertexIndex++]=0,u[this._vertexIndex++]=0,u[this._vertexIndex++]=o,u[this._vertexIndex++]=i.r/255,u[this._vertexIndex++]=i.g/255,u[this._vertexIndex++]=i.b/255,u[this._vertexIndex++]=i.a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n/e,u[this._vertexIndex++]=c.x,u[this._vertexIndex++]=c.y,u[this._vertexIndex++]=0,u[this._vertexIndex++]=1,u[this._vertexIndex++]=o,u[this._vertexIndex++]=i.r/255,u[this._vertexIndex++]=i.g/255,u[this._vertexIndex++]=i.b/255,u[this._vertexIndex++]=i.a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n/e,u[this._vertexIndex++]=l.x,u[this._vertexIndex++]=l.y,u[this._vertexIndex++]=1,u[this._vertexIndex++]=0,u[this._vertexIndex++]=o,u[this._vertexIndex++]=i.r/255,u[this._vertexIndex++]=i.g/255,u[this._vertexIndex++]=i.b/255,u[this._vertexIndex++]=i.a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n/e,u[this._vertexIndex++]=h.x,u[this._vertexIndex++]=h.y,u[this._vertexIndex++]=1,u[this._vertexIndex++]=1,u[this._vertexIndex++]=o,u[this._vertexIndex++]=i.r/255,u[this._vertexIndex++]=i.g/255,u[this._vertexIndex++]=i.b/255,u[this._vertexIndex++]=i.a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n/e}hasPendingDraws(){return 0!==this._circleCount}flush(){if(0===this._circleCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._circleCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._circleCount,ti.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class li{constructor(t){this._webglCtx=t,this._debugText=new qe}drawRect(t,e,i,s,n={color:I.Black}){this.drawLine(P(t,e),P(t+i,e),{...n}),this.drawLine(P(t+i,e),P(t+i,e+s),{...n}),this.drawLine(P(t+i,e+s),P(t,e+s),{...n}),this.drawLine(P(t,e+s),P(t,e),{...n})}drawLine(t,e,i={color:I.Black}){this._webglCtx.draw("ex.line",t,e,i.color)}drawPoint(t,e={color:I.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class hi{constructor(t){this._logger=y.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this._postProcessTargets=[],this._postprocessors=[],this._transform=new mt,this._state=new _t,this.snapToPixel=!0,this.smoothing=!1,this.backgroundColor=I.ExcaliburBlue,this._alreadyWarnedDrawLifecycle=!1,this.debug=new li(this);const{canvasElement:e,enableTransparency:i,smoothing:s,snapToPixel:n,backgroundColor:r}=t;this.__gl=e.getContext("webgl",{antialias:null!=s?s:this.smoothing,premultipliedAlpha:!1,alpha:null==i||i,depth:!0,powerPreference:"high-performance"}),Qe.register(this.__gl),Pt.register(this.__gl),this.snapToPixel=null!=n?n:this.snapToPixel,this.smoothing=null!=s?s:this.smoothing,this.backgroundColor=null!=r?r:this.backgroundColor,this._init()}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}_init(){const t=this.__gl;this._ortho=gt.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new ri),this.register(new oi),this.register(new ai),this.register(new ii),this.register(new ei),this._screenRenderer=new si(t),this._renderTarget=new Ye({gl:t,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Ye({gl:t,width:t.canvas.width,height:t.canvas.height}),new Ye({gl:t,width:t.canvas.width,height:t.canvas.height})],this._canvas=new kt({width:t.canvas.width,height:t.canvas.height}),this.__ctx=this._canvas.ctx}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){this._isDrawLifecycle||this._alreadyWarnedDrawLifecycle||(this._logger.warn("Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\nIf you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler."),this._alreadyWarnedDrawLifecycle=!0);const i=this._renderers.get(t);if(!i)throw Error(`No renderer with name ${t} has been registered`);this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(...e),this._currentRenderer=i}resetTransform(){this._transform.current=gt.identity()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=gt.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height),this._canvas.width=e.canvas.width,this._canvas.height=e.canvas.height}drawImage(t,e,i,s,n,r,o,a,l){if(0!==s&&0!==n&&0!==a&&0!==l&&0!==t.width&&0!==t.height)return t?void this.draw("ex.image",t,e,i,s,n,r,o,a,l):(y.getInstance().warn("Cannot draw a null or undefined image"),void(console.trace&&console.trace()))}drawLine(t,e,i,s=1){this.draw("ex.rectangle",t,e,i,s)}drawRectangle(t,e,i,s,n,r){this.draw("ex.rectangle",t,e,i,s,n,r)}drawCircle(t,e,i,s,n){this.draw("ex.circle",t,e,i,s,n)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current=this._transform.current.multiply(t)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);-1!==e&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}clear(){const t=this.__gl;this._renderTarget.use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){const t=this.__gl;this._renderTarget.use();for(const t of this._renderers.values())t.hasPendingDraws()&&t.flush();this._renderTarget.disable(),this._renderTarget.toRenderSource().use();for(let t=0;t<this._postprocessors.length;t++)this._postProcessTargets[t%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[t]),this._postProcessTargets[t%2].toRenderSource().use();t.bindFramebuffer(t.FRAMEBUFFER,null),this._screenRenderer.renderToScreen()}}var ci,ui;(ui=ci||(ci={})).Fixed="Fixed",ui.FitScreen="FitScreen",ui.FillScreen="FillScreen",ui.FitContainer="FitContainer",ui.FillContainer="FillContainer",ui.Position="Position";class di{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class pi{constructor(t){var e,i,s;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=y.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._resizeHandler=()=>{const t=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(t),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._alreadyWarned=!1,this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:{...this.viewport},this._displayMode=null!==(i=t.displayMode)&&void 0!==i?i:ci.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=null!==(s=t.antialiasing)&&void 0!==s?s:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._resizeHandler),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return 1!==this.pixelRatio}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){return this.displayMode===ci.FillContainer||this.displayMode===ci.FitContainer?this.canvas.parentElement||document.body:window}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this.graphicsContext instanceof hi&&(this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})||this._alreadyWarned||(this._alreadyWarned=!0,this._logger.warn(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`))),this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",""===this._canvas.style.imageRendering&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(){return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let e=t.x,i=t.y;if(this._isFullScreen||(e-=tt(this._canvas).x,i-=tt(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio;i=(i-(window.innerHeight-t)/2)/t*this.viewport.height,e=e/window.innerWidth*this.viewport.width}else{const t=window.innerHeight*this.aspectRatio;e=(e-(window.innerWidth-t)/2)/t*this.viewport.width,i=i/window.innerHeight*this.viewport.height}return e=e/this.viewport.width*this.resolution.width,i=i/this.viewport.height*this.resolution.height,new E(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;if(e=e/this.resolution.width*this.viewport.width,i=i/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio,s=(window.innerHeight-t)/2;i=i/this.viewport.height*t+s,e=e/this.viewport.width*window.innerWidth}else{const t=window.innerHeight*this.aspectRatio,s=(window.innerWidth-t)/2;e=e/this.viewport.width*t+s,i=i/this.viewport.height*window.innerHeight}return this._isFullScreen||(e+=tt(this._canvas).x,i+=tt(this._canvas).y),new E(e,i)}screenToWorldCoordinates(t){return this._camera?this._camera.inverse.multiply(t):t.sub(P(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(P(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){const t=this.screenToWorldCoordinates(E.Zero),e=t.x+this.drawWidth,i=t.y+this.drawHeight;return new D(t.x,t.y,e,i)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return P(this.halfDrawWidth,this.halfDrawHeight)}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i}}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0;const s=this.canvas.parentElement;s.clientWidth/t<s.clientHeight?(e=s.clientWidth,i=s.clientWidth/t):(e=s.clientHeight*t,i=s.clientHeight),this.viewport={width:e,height:i}}_applyDisplayMode(){var t,e;this.displayMode===ci.Position?this._initializeDisplayModePosition(this._position):(this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver((()=>{this._resizeHandler()})),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler),(null===(e=null===(t=null===window||void 0===window?void 0:window.screen)||void 0===t?void 0:t.orientation)||void 0===e?void 0:e.onchange)?window.screen.orientation.onchange=this._resizeHandler:this._browser.window.on("orientationchange",this._resizeHandler))}forceResize(){this._resizeHandler()}_setResolutionAndViewportByDisplayMode(t){this.displayMode===ci.FillContainer&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===ci.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this.displayMode===ci.FitScreen&&this._computeFit(),this.displayMode===ci.FitContainer&&this._computeFitContainer()}_initializeDisplayModePosition(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){const e=t.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";const t=-this.halfDrawHeight;this.canvas.style.marginTop=t.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";const t=-this.halfDrawWidth;this.canvas.style.marginLeft=t.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)}}class fi{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}fi._INSTANCE=null;class gi{static unlock(){return new Promise(((t,e)=>{if(gi._UNLOCKED||!fi.create())return t(!0);const i=setTimeout((()=>{y.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),t(!1)}),200),s=fi.create();s.resume().then((()=>{const e=s.createBuffer(1,1,22050),n=s.createBufferSource();let r=!1;n.buffer=e,n.connect(s.destination),n.onended=()=>r=!0,n.start(0),setTimeout((()=>{!function(t){return!!t.playbackState}(n)?(s.currentTime>0||r)&&(gi._UNLOCKED=!0):n.playbackState!==n.PLAYING_STATE&&n.playbackState!==n.FINISHED_STATE||(gi._UNLOCKED=!0)}),0),clearTimeout(i),t(!0)}),(()=>{e()}))}))}static isUnlocked(){return this._UNLOCKED}}gi._UNLOCKED=!1;class mi{constructor(){this.eventDispatcher=new pe}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}function _i(t,e=I.Red,i,s,n,r,o=1,a="butt"){t.save(),t.beginPath(),t.lineWidth=o,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(i,s),t.lineTo(n,r),t.closePath(),t.stroke(),t.restore()}function yi(t,e=I.Red,i){t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function vi(t,e,i,s,n=1){const r=e?e.toString():"blue",o=s.scale(n);t.beginPath(),t.strokeStyle=r,t.moveTo(i.x,i.y),t.lineTo(i.x+o.x,i.y+o.y),t.closePath(),t.stroke()}function wi(t,e,i,s,n,r=5,o=I.White,a=null){let l;if("number"==typeof r)l={tl:r,tr:r,br:r,bl:r};else{const t={tl:0,tr:0,br:0,bl:0};for(const e in t)if(t.hasOwnProperty(e)){const i=e;l[i]=r[i]||t[i]}}t.beginPath(),t.moveTo(e+l.tl,i),t.lineTo(e+s-l.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+l.tr),t.lineTo(e+s,i+n-l.br),t.quadraticCurveTo(e+s,i+n,e+s-l.br,i+n),t.lineTo(e+l.bl,i+n),t.quadraticCurveTo(e,i+n,e,i+n-l.bl),t.lineTo(e,i+l.tl),t.quadraticCurveTo(e,i,e+l.tl,i),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),o&&(t.strokeStyle=o.toString(),t.stroke())}function xi(t,e,i,s,n=I.White,r=null){t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),r&&(t.fillStyle=r.toString(),t.fill()),n&&(t.strokeStyle=n.toString(),t.stroke())}var bi=i(1388);class Si extends mi{constructor(t){super(),this.canvas=new kt({filtering:ut.Blended,smoothing:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=I.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=bi.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let t=document.getElementById("excalibur-play");return t||(t=document.createElement("button")),t.id="excalibur-play",t.textContent=this.playButtonText,t.style.display="none",t},this._isLoadedPromise=new Promise((t=>{this._isLoadedResolve=t})),t&&this.addResources(t)}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const i=t.length;for(;e<i;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}async showPlayButton(){var t,e;if(!this.suppressPlayButton){const t=()=>{this._positionPlayButton()};(null===(e=this._engine)||void 0===e?void 0:e.browser)&&this._engine.browser.window.on("resize",t),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",(t=>{"Enter"===t.key&&this._playButton.click()})),this._positionPlayButton();const i=new Promise((e=>{const i=i=>{var s;i.stopPropagation(),this.hidePlayButton(),(null===(s=this._engine)||void 0===s?void 0:s.browser)&&this._engine.browser.window.off("resize",t),e()};this._playButton.addEventListener("click",i),this._playButton.addEventListener("touchend",i),this._playButton.addEventListener("pointerup",i)}));return await i}this.hidePlayButton(),await lt(500,null===(t=this._engine)||void 0===t?void 0:t.clock)}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}areResourcesLoaded(){return this._isLoadedPromise}async load(){var t,e;return await(null===(t=this._image)||void 0===t?void 0:t.decode()),await Promise.all(this._resourceList.map((t=>t.load().finally((()=>{this._numLoaded++}))))),this._isLoadedResolve(),await lt(200,null===(e=this._engine)||void 0===e?void 0:e.clock),await this.showPlayButton(),await gi.unlock(),this.data=this._resourceList}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?N(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}_positionPlayButton(){if(this._engine){const t=this._engine.screen.viewport.height,e=this._engine.screen.viewport.width;if(this._playButtonRootElement){const i=this._engine.canvas.offsetLeft,s=this._engine.canvas.offsetTop,n=this._playButton.clientWidth,r=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=i+e/2-n/2+"px",this._playButtonRootElement.style.top=s+t/2-r/2+100+"px")}}}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,i=this._engine.canvasWidth/this._engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const n=Math.min(this.logoWidth,.75*i);let r=i/2-n/2;this.logoPosition&&(r=this.logoPosition.x,s=this.logoPosition.y);const o=Math.floor(n*(this.logoHeight/this.logoWidth)),a=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s,n,o):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s-o-20,n,o),!this.suppressPlayButton&&this._playButtonShown)return void this._engine.setAntialiasing(a);let l=r,h=s;this.loadingBarPosition&&(l=this.loadingBarPosition.x,h=this.loadingBarPosition.y),t.lineWidth=2,wi(t,l,h,n,20,10,this.loadingBarColor);const c=n*this.progress-10;wi(t,l+5,h+5,c>10?c:10,10,5,null,this.loadingBarColor),this._engine.setAntialiasing(a)}}const Ci={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Ti{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n";const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(Ci))i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Ci[s]+"\n";e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),y.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const t in this._warningTest)this._warningTest[t]()||y.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",t);return!0}}var Ei,Pi,Ai,ki,Ri,Ii,Fi,Di,Mi,Bi;(Pi=Ei||(Ei={})).PreventCollision="PreventCollision",Pi.Passive="Passive",Pi.Active="Active",Pi.Fixed="Fixed",(ki=Ai||(Ai={})).Arcade="arcade",ki.Realistic="realistic",(Ii=Ri||(Ri={}))[Ii.DynamicAABBTree=0]="DynamicAABBTree",(Di=Fi||(Fi={}))[Di.Euler=0]="Euler";class Li{static get gravity(){return Li.acc}static set gravity(t){Li.acc=t}static useArcadePhysics(){Li.collisionResolutionStrategy=Ai.Arcade}static useRealisticPhysics(){Li.collisionResolutionStrategy=Ai.Realistic}static get dynamicTreeVelocityMultiplyer(){return Li.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){Li.dynamicTreeVelocityMultiplier=t}}Li.acc=new E(0,0),Li.enabled=!0,Li.broadphaseStrategy=Ri.DynamicAABBTree,Li.collisionResolutionStrategy=Ai.Arcade,Li.defaultMass=10,Li.integrator=Fi.Euler,Li.dynamicTreeVelocityMultiplier=2,Li.boundsPadding=5,Li.positionIterations=3,Li.velocityIterations=8,Li.slop=1,Li.steeringFactor=.2,Li.warmStart=!0,Li.bodiesCanSleepByDefault=!1,Li.surfaceEpsilon=.1,Li.sleepEpsilon=.07,Li.wakeThreshold=3*Li.sleepEpsilon,Li.sleepBias=.9,Li.checkForFastBodies=!0,Li.disableMinimumSpeedForFastBody=!1,function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([T({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],Li,"dynamicTreeVelocityMultiplyer",null);class zi extends E{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class Oi{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const i in this)if(this.hasOwnProperty(i)){const s=this[i];(null==(e=s)?void 0:e.clone)&&"owner"!==i&&"clone"!==i?t[i]=s.clone():t[i]=s}var e;return t}}class Ni extends Oi{constructor(t,e){super(),this.type=t,this.value=e}}class Hi{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);-1!==e&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);-1!==e&&this.subscriptions.splice(e,1)}notifyAll(t){this.observers.forEach((e=>e.notify(t))),this.subscriptions.forEach((e=>e(t)))}clear(){this.observers.length=0,this.subscriptions.length=0}}(Bi=Mi||(Mi={})).World="world",Bi.Screen="screen";class Ui extends Oi{constructor(){super(...arguments),this.type="ex.transform",this._dirty=!1,this.matrix=gt.identity().translate(0,0).rotate(0).scale(1,1),this._position=yt((t=>{const e=t;return new zi({setX:t=>{e.data[ht.X]=t},setY:t=>{e.data[ht.Y]=t},getX:()=>e.data[ht.X],getY:()=>e.data[ht.Y]})})(this.matrix),(t=>{this.posChanged$.notifyAll(t)})),this._rotation=0,this._scale=(t=>{const e=t;return new zi({setX:t=>{e.setScaleX(t)},setY:t=>{e.setScaleY(t)},getX:()=>e.getScaleX(),getY:()=>e.getScaleY()})})(this.matrix),this.coordPlane=Mi.World,this.posChanged$=new Hi,this.zIndexChanged$=new Hi,this._z=0}_recalculate(){this._rotation=this.matrix.getRotation(),this._dirty=!1}getGlobalMatrix(){return this.parent?this.parent.getGlobalMatrix().multiply(this.matrix):this.matrix}getGlobalTransform(){return{pos:this.globalPos,scale:this.globalScale,rotation:this.globalRotation,z:this.z,coordPlane:this.coordPlane}}get parent(){var t,e;return null===(e=null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)||void 0===e?void 0:e.get(Ui)}get pos(){return this._dirty&&this._recalculate(),this._position}set pos(t){const e=this.matrix.getPosition();this.matrix.setPosition(t.x,t.y),this._dirty=!0,e.equals(t)||this.posChanged$.notifyAll(this._position)}get dirty(){var t;return(null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)&&this.parent.dirty||this._dirty}get globalPos(){const t=this.getGlobalMatrix();return new zi({getX:()=>t.data[ht.X],getY:()=>t.data[ht.Y],setX:e=>{var i;const s=this.matrix.data[ht.X];if(this.parent){const{x:s}=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multiply(P(e,t.data[ht.Y]));this.matrix.data[ht.X]=s}else this.matrix.data[ht.X]=e;s!==this.matrix.data[ht.X]&&this.posChanged$.notifyAll(this._position)},setY:e=>{var i;const s=this.matrix.data[ht.Y];if(this.parent){const{y:s}=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multiply(P(t.data[ht.X],e));this.matrix.data[ht.Y]=s}else this.matrix.data[ht.Y]=e;s!==this.matrix.data[ht.Y]&&this.posChanged$.notifyAll(this._position)}})}set globalPos(t){const e=this.pos,i=this.parent;this.pos=i?i.getGlobalMatrix().getAffineInverse().multiply(t):t,e.equals(t)||this.posChanged$.notifyAll(this.pos)}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get rotation(){return this._dirty&&this._recalculate(),this._rotation}set rotation(t){this.matrix.setRotation(t),this._dirty=!0}get globalRotation(){return this.getGlobalMatrix().getRotation()}set globalRotation(t){const e=this.parent;this.rotation=e?t-e.globalRotation:t}get scale(){return this._dirty&&this._recalculate(),this._scale}set scale(t){this.matrix.setScale(t),this._dirty=!0}get globalScale(){const t=this.getGlobalMatrix();return new zi({getX:()=>t.getScaleX(),getY:()=>t.getScaleY(),setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.matrix.setScaleX(t/e)}else this.matrix.setScaleX(t)},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.matrix.setScaleY(t/e)}else this.matrix.setScaleY(t)}})}set globalScale(t){const e=this.parent;this.scale=e?P(t.x/e.globalScale.x,t.y/e.globalScale.y):t}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.matrix.getAffineInverse().multiply(t)}}class Wi extends Oi{constructor(){super(...arguments),this.type="ex.motion",this.vel=E.Zero,this.acc=E.Zero,this.scaleFactor=E.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class Vi{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return 0!=(this.category&t.mask)&&0!=(t.category&this.mask)}invert(){return new Vi("~("+this.name+")",~this.category,~this.mask)}static combine(t){const e=t.map((t=>t.name)).join("+"),i=t.reduce(((t,e)=>e.category|t),0);return new Vi(e,i,~i)}static collidesWith(t){return Vi.combine(t).invert()}}Vi.All=new Vi("Collide with all groups",-1,-1);class Gi{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=Gi.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,s;const n=null===(i=null==t?void 0:t.owner)||void 0===i?void 0:i.get(ps),r=null===(s=null==e?void 0:e.owner)||void 0===s?void 0:s.get(ps);return!(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions()||!n||!r||!n.group.canCollide(r.group)||n.collisionType===Ei.Fixed&&r.collisionType===Ei.Fixed||r.collisionType===Ei.PreventCollision||n.collisionType===Ei.PreventCollision||!n.active||!r.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return Gi.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class ji{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Xi{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new D,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class qi{constructor(t=new D(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(null===this.root)return this.root=t,void(this.root.parent=null);const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const t=i.left,s=i.right,n=i.bounds.getPerimeter(),r=i.bounds.combine(e).getPerimeter(),o=2*r,a=2*(r-n);let l=0;const h=e.combine(t.bounds);let c,u;t.isLeaf()?l=h.getPerimeter()+a:(u=t.bounds.getPerimeter(),c=h.getPerimeter(),l=c-u+a);let d=0;const p=e.combine(s.bounds);if(s.isLeaf()?d=p.getPerimeter()+a:(u=s.bounds.getPerimeter(),c=p.getPerimeter(),d=c-u+a),o<l&&o<d)break;i=l<d?t:s}const s=i.parent,n=new Xi(s);n.bounds=e.combine(i.bounds),n.height=i.height+1,null!==s?(s.left===i?s.left=n:s.right=n,n.left=i,n.right=t,i.parent=n,t.parent=n):(n.left=i,n.right=t,i.parent=n,t.parent=n,this.root=n);let r=t.parent;for(;r;){if(r=this._balance(r),!r.left)throw new Error("Parent of current leaf cannot have a null left child"+r);if(!r.right)throw new Error("Parent of current leaf cannot have a null right child"+r);r.height=1+Math.max(r.left.height,r.right.height),r.bounds=r.left.bounds.combine(r.right.bounds),r=r.parent}}_remove(t){if(t===this.root)return void(this.root=null);const e=t.parent,i=e.parent;let s;if(s=e.left===t?e.right:e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let t=i;for(;t;)t=this._balance(t),t.bounds=t.left.bounds.combine(t.right.bounds),t.height=1+Math.max(t.left.height,t.right.height),t=t.parent}else this.root=s,s.parent=null}trackCollider(t){const e=new Xi;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const s=t.bounds;if(!this.worldBounds.contains(s))return y.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(s))return!1;if(this._remove(i),s.left-=Li.boundsPadding,s.top-=Li.boundsPadding,s.right+=Li.boundsPadding,s.bottom+=Li.boundsPadding,t.owner){const i=null===(e=t.owner)||void 0===e?void 0:e.get(ps);if(i){const t=32*i.vel.x/1e3*Li.dynamicTreeVelocityMultiplier,e=32*i.vel.y/1e3*Li.dynamicTreeVelocityMultiplier;t<0?s.left+=t:s.right+=t,e<0?s.top+=e:s.bottom+=e}}return i.bounds=s,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,n=e,r=i,o=e.left,a=e.right,l=i.left,h=i.right,c=r.height-n.height;if(c>1)return r.left=s,r.parent=s.parent,s.parent=r,r.parent?r.parent.left===s?r.parent.left=r:r.parent.right=r:this.root=r,l.height>h.height?(r.right=l,s.right=h,h.parent=s,s.bounds=n.bounds.combine(h.bounds),r.bounds=s.bounds.combine(l.bounds),s.height=1+Math.max(n.height,h.height),r.height=1+Math.max(s.height,l.height)):(r.right=h,s.right=l,l.parent=s,s.bounds=n.bounds.combine(l.bounds),r.bounds=s.bounds.combine(h.bounds),s.height=1+Math.max(n.height,l.height),r.height=1+Math.max(s.height,h.height)),r;if(c<-1){if(n.left=s,n.parent=s.parent,s.parent=n,n.parent)if(n.parent.left===s)n.parent.left=n;else{if(n.parent.right!==s)throw"Error rotating Dynamic Tree";n.parent.right=n}else this.root=n;return o.height>a.height?(n.right=o,s.left=a,a.parent=s,s.bounds=r.bounds.combine(a.bounds),n.bounds=s.bounds.combine(o.bounds),s.height=1+Math.max(r.height,a.height),n.height=1+Math.max(s.height,o.height)):(n.right=a,s.left=o,o.parent=s,s.bounds=r.bounds.combine(o.bounds),n.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(r.height,o.height),n.height=1+Math.max(s.height,a.height)),n}return t}getHeight(){return null===this.root?0:this.root.height}query(t,e){const i=t.bounds,s=n=>{if(n&&n.bounds.intersect(i)){if(!n.isLeaf()||n.data===t)return s(n.left)||s(n.right);if(e.call(t,n.data))return!0}return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=n=>{if(n&&n.bounds.rayCast(t,e)){if(!n.isLeaf())return s(n.left)||s(n.right);if(i.call(t,n.data))return!0}return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,I.Green):i.bounds.draw(t,I.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class Ki{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;const i=this.dir.cross(t.getSlope());if(0===i)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const n=e.cross(this.dir)/i/t.getLength();if(n>=0&&n<=1)return s}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class Yi{constructor(){this._dynamicCollisionTree=new qi,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[]}getColliders(){return this._colliders}track(t){if(t)if(t instanceof $i){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t);else y.getInstance().warn("Cannot track null collider")}untrack(t){if(t)if(t instanceof $i){const e=t.getColliders();for(const t of e){const e=this._colliders.indexOf(t);-1!==e&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}else{const e=this._colliders.indexOf(t);-1!==e&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}else y.getInstance().warn("Cannot untrack a null collider")}_pairExists(t,e){const i=Gi.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const s=e/1e3,n=t.filter((t=>{var e,i;const s=null===(e=t.owner)||void 0===e?void 0:e.get(ps);return(null===(i=t.owner)||void 0===i?void 0:i.active)&&s.collisionType!==Ei.PreventCollision}));let r;this._collisionPairCache=[],this._pairs.clear();for(let t=0,e=n.length;t<e;t++)r=n[t],this._dynamicCollisionTree.query(r,(t=>{if(!this._pairExists(r,t)&&Gi.canCollide(r,t)){const e=new Gi(r,t);this._pairs.add(e.id),this._collisionPairCache.push(e)}return!1}));if(i&&(i.physics.pairs=this._collisionPairCache.length),Li.checkForFastBodies)for(const t of n){const e=t.owner.get(ps);if(e.collisionType!==Ei.Active)continue;const n=e.vel.size*s+.5*e.acc.size*s*s,r=Math.min(t.bounds.height,t.bounds.width);if(Li.disableMinimumSpeedForFastBody||n>r/2){i&&i.physics.fastBodies++;const s=e.pos.sub(e.oldPos),r=t.center,o=t.getFurthestPoint(e.vel),a=o.sub(s),l=new Ki(a,e.vel);let h;l.pos=l.pos.add(l.dir.scale(-2*Li.surfaceEpsilon));let c=new E(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(l,n+2*Li.surfaceEpsilon,(e=>{if(!this._pairExists(t,e)&&Gi.canCollide(t,e)){const t=e.rayCast(l,n+10*Li.surfaceEpsilon);if(t){const i=t.sub(a);i.size<c.size&&(c=i,h=e)}}return!1})),h&&E.isValid(c)){const s=new Gi(t,h);this._pairs.has(s.id)||(this._pairs.add(s.id),this._collisionPairCache.push(s));const n=r.sub(o);e.pos=a.add(n).add(c).add(l.dir.scale(10*Li.surfaceEpsilon)),t.update(e.transform),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let s=0;s<t.length;s++){const n=t[s].collide();if(i=i.concat(n),e&&n.length>0)for(const t of n)e.physics.contacts.set(t.id,t)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateCollider(t[s])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class Qi{constructor(){this.id=_("collider",Qi._ID++),this.events=new pe}touching(t){return!!this.collide(t)}}Qi._ID=0;class $i extends Qi{constructor(t){super(),this._collisionProcessor=new Yi,this._dynamicAABBTree=new qi,this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){this.events.wire(t.events),this._colliders.push(t),this._collisionProcessor.track(t),this._dynamicAABBTree.trackCollider(t)}removeCollider(t){this.events.unwire(t.events),it(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos)&&void 0!==e?e:E.Zero}get center(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos)&&void 0!==e?e:E.Zero}get bounds(){var t,e;const i=this.getColliders();return i.reduce(((t,e)=>t.combine(e.bounds)),null!==(e=null===(t=i[0])||void 0===t?void 0:t.bounds)&&void 0!==e?e:(new D).translate(this.worldPos))}get localBounds(){var t,e;const i=this.getColliders();return i.reduce(((t,e)=>t.combine(e.localBounds)),null!==(e=null===(t=i[0])||void 0===t?void 0:t.localBounds)&&void 0!==e?e:new D)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const s of e)i.push(s.getFurthestPoint(t));let s=i[0],n=-Number.MAX_VALUE;for(const e of i){const i=e.dot(t);i>n&&(s=e,n=i)}return s}getInertia(t){const e=this.getColliders();let i=0;for(const s of e)i+=s.getInertia(t);return i}collide(t){let e=[t];t instanceof $i&&(e=t.getColliders());const i=[];for(const t of e)this._dynamicAABBTree.query(t,(e=>(i.push(new Gi(t,e)),!1)));let s=[];for(const t of i)s=s.concat(t.collide());return s}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof $i){const s=t.getColliders();for(const t of e)for(const e of s){const s=t.getClosestLineBetween(e);s&&i.push(s)}}else for(const s of e){const e=t.getClosestLineBetween(s);e&&i.push(e)}if(i.length){let t=i[0].getLength(),e=i[0];for(const s of i){const i=s.getLength();i<t&&(t=i,e=s)}return e}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),s=[];for(const n of i){const i=n.rayCast(t,e);i&&s.push(i)}if(s.length){let e=s[0],i=e.dot(t.dir);for(const n of s){const s=t.dir.dot(n);s<i&&(e=n,i=s)}return e}return null}project(t){const e=this.getColliders(),i=[];for(const s of e){const e=s.project(t);e&&i.push(e)}if(i.length){const t=new ji(i[0].min,i[0].max);for(const e of i)t.min=Math.min(e.min,t.min),t.max=Math.max(e.max,t.max);return t}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}draw(t,e,i){const s=this.getColliders();for(const n of s)n.draw(t,e,i)}debug(t,e){const i=this.getColliders();for(const s of i)s.debug(t,e)}debugDraw(t,e){const i=this.getColliders();for(const s of i)s.draw(t,e)}clone(){return new $i(this._colliders.map((t=>t.clone())))}}class Zi{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this.end.sub(this.begin).normal()}dir(){return this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){const t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Zi(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e){let i=t;i=i.normalize();const s=i.dot(this.begin)-e,n=i.dot(this.end)-e,r=[];if(s<=0&&r.push(this.begin),n<=0&&r.push(this.end),s*n<0){const t=s/(s-n);r.push(this.begin.add(this.end.sub(this.begin).scale(t)))}return 2!==r.length?null:new Zi(r[0],r[1])}distanceToPoint(t,e=!1){const i=t.x,s=t.y,n=this.getLength(),r=((this.end.y-this.begin.y)*i-(this.end.x-this.begin.x)*s+this.end.x*this.begin.y-this.end.y*this.begin.x)/n;return e?r:Math.abs(r)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(null!==t)return new E(t,i*t+s);if(null!==e)return new E((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new E(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof E))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}const i=t.x-this.begin.x,s=t.y-this.begin.y,n=this.end.x-this.begin.x,r=this.end.y-this.begin.y,o=i*r-s*n;return!(Math.abs(o)>e)&&(Math.abs(n)>=Math.abs(r)?n>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:r>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)}}function Ji(t,e,i,s){const n=t.sub(i),r=e.dot(e),o=e.dot(s),a=s.dot(s),l=e.dot(n),h=s.dot(n),c=r*a-o*o;let u=c,d=c;if(0===c||c<=.01){const e=l/o;return new Zi(t,i.add(s.scale(e)))}let p=o*h-a*l,f=r*h-o*l;return p<0?(p=0,f=h,d=a):p>u&&(p=u,f=h+o,d=a),f<0?(f=0,-l<0?p=0:-l>r?p=u:(p=-l,u=r)):f>d&&(f=d,-l+o<0?p=0:-l+o>r?p=u:(p=-l+o,u=r)),p=Math.abs(p)<.001?0:p/u,f=Math.abs(f)<.001?0:f/d,new Zi(t.add(e.scale(p)),i.add(s.scale(f)))}const ts={PolygonPolygonClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=s.negate(),r=new Ki(t.worldPos,s),o=new Ki(i,n),a=t.rayCast(r).add(r.dir.scale(.1)),l=e.rayCast(o).add(o.dir.scale(.1)),h=t.getClosestFace(a),c=e.getClosestFace(l);return Ji(h.face.begin,h.face.getEdge(),c.face.begin,c.face.getEdge())},PolygonEdgeClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=new Ki(t.worldPos,i),n=t.rayCast(s).add(s.dir.scale(.1)),r=t.getClosestFace(n),o=r.face.begin,a=r.face.getEdge(),l=e.asLine();return Ji(o,a,l.begin,l.getEdge())},PolygonCircleClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=new Ki(t.worldPos,s.normalize()),r=t.rayCast(n).add(n.dir.scale(.1)),o=t.getClosestFace(r),a=o.face.begin,l=o.face.getEdge();let h=(l.x*(i.x-a.x)+l.y*(i.y-a.y))/(l.x*l.x+l.y*l.y);h>1?h=1:h<0&&(h=0);const c=Math.sqrt(Math.pow(a.x+l.x*h-i.x,2)+Math.pow(a.y+l.y*h-i.y,2))-e.radius,u=(a.x+l.x*h-i.x)*e.radius/(e.radius+c),d=(a.y+l.y*h-i.y)*e.radius/(e.radius+c);return new Zi(l.scale(h).add(a),new E(i.x+u,i.y+d))},CircleCircleClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=t.worldPos.sub(e.worldPos),n=new Ki(t.worldPos,i),r=new Ki(e.worldPos,s),o=t.rayCast(n),a=e.rayCast(r);return new Zi(o,a)},CircleEdgeClosestLine(t,e){const i=t.worldPos,s=e.asLine(),n=s.begin,r=s.getEdge();let o=(r.x*(i.x-n.x)+r.y*(i.y-n.y))/(r.x*r.x+r.y*r.y);o>1?o=1:o<0&&(o=0);const a=Math.sqrt(Math.pow(n.x+r.x*o-i.x,2)+Math.pow(n.y+r.y*o-i.y,2))-t.radius,l=(n.x+r.x*o-i.x)*t.radius/(t.radius+a),h=(n.y+r.y*o-i.y)*t.radius/(t.radius+a);return new Zi(r.scale(o).add(n),new E(i.x+l,i.y+h))},EdgeEdgeClosestLine(t,e){const i=t.asLine(),s=i.begin,n=i.getEdge(),r=e.asLine();return Ji(s,n,r.begin,r.getEdge())}};class es extends Qi{constructor(t){super(),this.offset=E.Zero,this.offset=t.offset||E.Zero,this.radius=t.radius||0}get worldPos(){var t,e,i,s;const n=this._transform,r=null!==(t=null==n?void 0:n.globalScale)&&void 0!==t?t:E.One,o=null!==(e=null==n?void 0:n.globalRotation)&&void 0!==e?e:0,a=null!==(i=null==n?void 0:n.globalPos)&&void 0!==i?i:E.Zero;return(null!==(s=this.offset)&&void 0!==s?s:E.Zero).scale(r).rotate(o).add(a)}get radius(){var t;const e=this._transform,i=null!==(t=null==e?void 0:e.globalScale)&&void 0!==t?t:E.One;return this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,s=null!==(e=null==i?void 0:i.globalScale)&&void 0!==e?e:E.One;this._naturalRadius=t/Math.min(s.x,s.y)}clone(){return new es({offset:this.offset.clone(),radius:this.radius})}get center(){var t,e,i,s;const n=this._transform,r=null!==(t=null==n?void 0:n.globalScale)&&void 0!==t?t:E.One,o=null!==(e=null==n?void 0:n.globalRotation)&&void 0!==e?e:0,a=null!==(i=null==n?void 0:n.globalPos)&&void 0!==i?i:E.Zero;return(null!==(s=this.offset)&&void 0!==s?s:E.Zero).scale(r).rotate(o).add(a)}contains(t){var e,i;return(null!==(i=null===(e=this._transform)||void 0===e?void 0:e.pos)&&void 0!==i?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){const i=this.center,s=t.dir,n=t.pos,r=Math.sqrt(Math.pow(s.dot(n.sub(i)),2)-Math.pow(n.sub(i).distance(),2)+Math.pow(this.radius,2));if(r<0)return null;{let o=0;if(0===r)return o=-s.dot(n.sub(i)),o>0&&o<e?t.getPoint(o):null;{const o=-s.dot(n.sub(i))+r,a=-s.dot(n.sub(i))-r,l=[];o>=0&&l.push(o),a>=0&&l.push(a);const h=Math.min(...l);return h<=e?t.getPoint(h):null}}}getClosestLineBetween(t){if(t instanceof es)return ts.CircleCircleClosestLine(this,t);if(t instanceof os)return ts.PolygonCircleClosestLine(t,this).flip();if(t instanceof rs)return ts.CircleEdgeClosestLine(this,t).flip();throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCircleCircle(this,t);if(t instanceof os)return ns.CollideCirclePolygon(this,t);if(t instanceof rs)return ns.CollideCircleEdge(this,t);throw new Error("Circle could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,e,i;const s=this._transform,n=null!==(t=null==s?void 0:s.globalScale)&&void 0!==t?t:E.One,r=null!==(e=null==s?void 0:s.globalRotation)&&void 0!==e?e:0,o=null!==(i=null==s?void 0:s.globalPos)&&void 0!==i?i:E.Zero;return new D(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(r).scale(n).translate(o)}get localBounds(){return new D(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){this._transform=t}project(t){const e=[],i=this.center.dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new ji(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=I.Green,i=E.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.fill()}debug(t,e){var i,s,n,r;const o=this._transform,a=null!==(i=null==o?void 0:o.globalScale)&&void 0!==i?i:E.One,l=null!==(s=null==o?void 0:o.globalRotation)&&void 0!==s?s:0,h=null!==(n=null==o?void 0:o.globalPos)&&void 0!==n?n:E.Zero;t.save(),t.translate(h.x,h.y),t.rotate(l),t.scale(a.x,a.y),t.drawCircle(null!==(r=this.offset)&&void 0!==r?r:E.Zero,this._naturalRadius,I.Transparent,e,2),t.restore()}debugDraw(t,e=I.Green){const i=this._transform,s=i?i.pos.add(this.offset):this.offset,n=i?i.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(Math.cos(n)*this.radius+s.x,Math.sin(n)*this.radius+s.y),t.closePath(),t.stroke()}}class is{constructor(t,e,i,s,n,r,o,a){this._canceled=!1,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=s,this.tangent=n,this.points=r,this.localPoints=o,this.info=a,this.id=Gi.calculatePairHash(t.id,e.id)}matchAwake(){const t=this.colliderA.owner.get(ps),e=this.colliderB.owner.get(ps);t&&e&&t.sleeping!==e.sleeping&&(t.sleeping&&t.collisionType!==Ei.Fixed&&e.sleepMotion>=Li.wakeThreshold&&t.setSleeping(!1),e.sleeping&&e.collisionType!==Ei.Fixed&&t.sleepMotion>=Li.wakeThreshold&&e.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class ss{static findPolygonPolygonSeparation(t,e){let i=-Number.MAX_VALUE,s=null,n=null,r=-1,o=null;const a=t.getSides(),l=t.getLocalSides();for(let t=0;t<a.length;t++){const l=a[t],h=l.normal(),c=e.getFurthestPoint(h.negate()),u=l.distanceToPoint(c,!0);u>i&&(i=u,s=l,n=h,r=t,o=c)}return{collider:t,separation:n?i:99,axis:n,side:s,localSide:l[r],sideId:r,point:o,localPoint:n?e.getFurthestLocalPoint(n.negate()):null}}static findCirclePolygonSeparation(t,e){const i=e.axes,s=e.center.sub(t.worldPos),n=e.getFurthestPoint(s.negate());i.push(n.sub(t.worldPos).normalize());let r=Number.MAX_VALUE,o=null,a=-1;for(let s=0;s<i.length;s++){const n=e.project(i[s]),l=t.project(i[s]),h=n.getOverlap(l);if(h<=0)return null;h<r&&(r=h,o=i[s],a=s)}return a<0?null:o.normalize().scale(r)}}const ns={CollideCircleCircle(t,e){const i=t.worldPos,s=e.worldPos,n=t.radius+e.radius,r=i.distance(s);if(r>n)return[];const o=n-r,a=s.sub(i).normalize(),l=a.perpendicular(),h=a.scale(o),c=t.getFurthestPoint(a),u=t.getFurthestLocalPoint(a);return[new is(t,e,h,a,l,[c],[u],{collider:t,separation:o,axis:a,point:c})]},CollideCirclePolygon(t,e){var i,s;let n=ss.findCirclePolygonSeparation(t,e);if(!n)return[];const r=n.dot(e.center.sub(t.center));n=r<0?n.negate():n;const o=t.getFurthestPoint(n),a=(null!==(s=null===(i=t.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui).applyInverse(o),l=n.normalize(),h={collider:t,separation:-n.size,axis:l,point:o,localPoint:a,side:e.findSide(l.negate()),localSide:e.findLocalSide(l.negate())};return[new is(t,e,n,l,l.perpendicular(),[o],[a],h)]},CollideCircleEdge(t,e){const i=t.center,s=e.asLine(),n=s.end.sub(s.begin),r=n.dot(s.end.sub(i)),o=n.dot(i.sub(s.begin)),a=e.asLine(),l=e.asLocalLine();if(o<=0){const n=s.begin.sub(i),r=n.dot(n);if(r>t.radius*t.radius)return[];const o=n.normalize(),h=t.radius-Math.sqrt(r),c={collider:t,separation:h,axis:o,point:a.begin,side:a,localSide:l};return[new is(t,e,o.scale(h),o,o.perpendicular(),[a.begin],[l.begin],c)]}if(r<=0){const n=s.end.sub(i),r=n.dot(n);if(r>t.radius*t.radius)return[];const o=n.normalize(),h=t.radius-Math.sqrt(r),c={collider:t,separation:h,axis:o,point:a.end,side:a,localSide:l};return[new is(t,e,o.scale(h),o,o.perpendicular(),[a.end],[l.end],c)]}const h=n.dot(n),c=s.begin.scale(r).add(s.end.scale(o)).scale(1/h),u=i.sub(c),d=u.dot(u);if(d>t.radius*t.radius)return[];let p=n.perpendicular();p.dot(i.sub(s.begin))<0&&(p.x=-p.x,p.y=-p.y),p=p.normalize();const f=t.radius-Math.sqrt(d),g=p.scale(f),m={collider:t,separation:f,axis:p,point:c,side:a,localSide:l};return[new is(t,e,g,p.negate(),p.negate().perpendicular(),[c],[c.sub(e.worldPos)],m)]},CollideEdgeEdge:()=>[],CollidePolygonEdge(t,e){var i;const s=t.center,n=e.center.sub(s).normalize(),r=new os({points:[e.begin,e.end,e.end.add(n.scale(100)),e.begin.add(n.scale(100))],offset:e.offset});r.owner=e.owner,(null===(i=e.owner)||void 0===i?void 0:i.get(Ui))&&r.update(e.owner.get(Ui));const o=this.CollidePolygonPolygon(t,r);return o.length&&(o[0].colliderB=e,o[0].id=Gi.calculatePairHash(t.id,e.id)),o},CollidePolygonPolygon(t,e){var i,s,n,r;const o=ss.findPolygonPolygonSeparation(t,e);if(o.separation>0)return[];const a=ss.findPolygonPolygonSeparation(e,t);if(a.separation>0)return[];const l=o.separation>a.separation?o:a,h=(l.collider===t?e:t).findSide(l.axis.negate()),c=l.side,u=c.dir().normalize(),d=h.clip(u.negate(),-u.dot(c.begin));let p=null;if(d&&(p=d.clip(u,u.dot(c.end))),p){const o=p.getPoints().filter((t=>c.below(t)));let a=l.axis,h=a.perpendicular();e.center.sub(t.center).dot(a)<0&&(a=a.negate(),h=a.perpendicular());let u=[];if(l.collider===t){const t=null!==(s=null===(i=e.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui;u=o.map((e=>t.applyInverse(e)))}else{const e=null!==(r=null===(n=t.owner)||void 0===n?void 0:n.get(Ui))&&void 0!==r?r:new Ui;u=o.map((t=>e.applyInverse(t)))}return[new is(t,e,a.scale(-l.separation),a,h,o,u,l)]}return[]},FindContactSeparation(t,e){var i,s,n,r;const o=t.colliderA,a=null!==(s=null===(i=t.colliderA.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui,l=t.colliderB,h=null!==(r=null===(n=t.colliderB.owner)||void 0===n?void 0:n.get(Ui))&&void 0!==r?r:new Ui;if(o instanceof es&&l instanceof es)return-(o.radius+l.radius-a.pos.distance(h.pos));if(o instanceof os&&l instanceof os&&t.info.localSide){let i,s;return t.info.collider===o?(i=new Zi(a.apply(t.info.localSide.begin),a.apply(t.info.localSide.end)),s=h.apply(e)):(i=new Zi(h.apply(t.info.localSide.begin),h.apply(t.info.localSide.end)),s=a.apply(e)),i.distanceToPoint(s,!0)}if(o instanceof os&&l instanceof es||l instanceof os&&o instanceof es){const i=a.apply(e);if(t.info.side)return t.info.side.distanceToPoint(i,!0)}if(o instanceof rs&&l instanceof os||l instanceof rs&&o instanceof os){let i;if(i=t.info.collider===o?h.apply(e):a.apply(e),t.info.side)return t.info.side.distanceToPoint(i,!0)}if(o instanceof es&&l instanceof rs||l instanceof es&&o instanceof rs){const i=h.apply(e);let s;o instanceof es&&(s=o.getFurthestPoint(t.normal));const n=i.distance(s);if(t.info.side)return n>0?-n:0}return 0}};class rs extends Qi{constructor(t){var e;super(),this.begin=t.begin||E.Zero,this.end=t.end||E.Zero,this.offset=null!==(e=t.offset)&&void 0!==e?e:E.Zero}clone(){return new rs({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return null!==(t=null==e?void 0:e.globalPos.add(this.offset))&&void 0!==t?t:this.offset}get center(){return this.begin.average(this.end).add(this._getBodyPos())}_getBodyPos(){var t;const e=this._transform;return null!==(t=null==e?void 0:e.globalPos)&&void 0!==t?t:E.Zero}_getTransformedBegin(){const t=this._transform,e=t?t.globalRotation:0;return this.begin.rotate(e).add(this._getBodyPos())}_getTransformedEnd(){const t=this._transform,e=t?t.globalRotation:0;return this.end.rotate(e).add(this._getBodyPos())}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;const s=t.dir.cross(this.getSlope());if(0===s)return null;const n=i.cross(this.getSlope())/s;if(n>=0&&n<=e){const e=i.cross(t.dir)/s/this.getLength();if(e>=0&&e<=1)return t.getPoint(n)}return null}getClosestLineBetween(t){if(t instanceof es)return ts.CircleEdgeClosestLine(t,this);if(t instanceof os)return ts.PolygonEdgeClosestLine(t,this).flip();if(t instanceof rs)return ts.EdgeEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCircleEdge(t,this);if(t instanceof os)return ns.CollidePolygonEdge(t,this);if(t instanceof rs)return ns.CollideEdgeEdge();throw new Error("Edge could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new D(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Zi(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Zi(this.begin,this.end)}get axes(){const t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){this._transform=t}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let n=0;n<s;n++)e.push(i[n].dot(t));return new ji(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=I.Green,i=E.Zero){const s=this.begin.add(i),n=this.end.add(i);t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath(),t.stroke()}debug(t,e){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.drawLine(i,s,e,2),t.drawCircle(i,2,e),t.drawCircle(s,2,e)}debugDraw(t,e=I.Red){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.closePath(),t.stroke()}}class os extends Qi{constructor(t){var e,i;super(),this._logger=y.getInstance(),this._transformedPoints=[],this._axes=[],this._sides=[],this._localSides=[],this.offset=null!==(e=t.offset)&&void 0!==e?e:E.Zero,this.points=null!==(i=t.points)&&void 0!==i?i:[],this._isClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),s=0,n=0,r=0;for(const[o,a]of this.points.entries()){if(t=e,s=i,e=a,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let l=i-s;if(l<=-Math.PI?l+=2*Math.PI:l>Math.PI&&(l-=2*Math.PI),0===o){if(0===l)return!1;n=l>0?1:-1}else if(n*l<=0)return!1;r+=l}return 1===Math.abs(Math.round(r/(2*Math.PI)))}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new $i(t.map((t=>as.Polygon(t))))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");function t(t,e){return t>=e.length?e[t%e.length]:t<0?e[t%e.length+e.length]:e[t]}function e(t,e,i,s){const n=i.sub(e),r=s.sub(i),o=e.sub(s),a=t.sub(e),l=t.sub(i),h=t.sub(s),c=n.cross(a),u=r.cross(l),d=o.cross(h);return!(c>0||u>0||d>0)}const i=[],s=[...this.points],n=V(0,this.points.length-1);for(;n.length>3;)for(let r=0;r<n.length;r++){const o=n[r],a=t(r-1,n),l=t(r+1,n),h=s[o],c=s[a],u=s[l],d=c.sub(h);if(!(u.sub(h).cross(d)>0))continue;let p=!0;for(let t=0;t<n.length;t++){const i=n[t];if(i!==o&&i!==a&&i!==l&&e(s[i],c,h,u)){p=!1;break}}if(p){i.push([c,h,u]),n.splice(r,1);break}}return i.push([s[n[0]],s[n[1]],s[n[2]]]),new $i(i.map((t=>as.Polygon(t))))}clone(){return new os({offset:this.offset.clone(),points:this.points.map((t=>t.clone()))})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this._transform,e=t?t.globalPos.add(this.offset):this.offset,i=t?t.globalRotation:0,s=t?t.globalScale:E.One,n=this.points.length;this._transformedPoints.length=0;for(let t=0;t<n;t++)this._transformedPoints[t]=this.points[t].scale(s).rotate(i).add(e)}getTransformedPoints(){return this._calculateTransformation(),this._transformedPoints}getSides(){if(this._sides.length)return this._sides;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new Zi(e[s],e[(s+1)%i]));return this._sides=t,this._sides}getLocalSides(){if(this._localSides.length)return this._localSides;const t=[],e=this.points,i=e.length;for(let s=0;s<i;s++)t.push(new Zi(e[s],e[(s+1)%i]));return this._localSides=t,this._localSides}findSide(t){const e=this.getSides();let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=e[n],o=r.normal().dot(t);o>s&&(i=r,s=o)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=e[n],o=r.normal().dot(t);o>s&&(i=r,s=o)}return i}get axes(){if(this._axes.length)return this._axes;const t=this.getSides().map((t=>t.normal()));return this._axes=t,this._axes}update(t){this._transform=t,this._sides.length=0,this._localSides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getSides(),this.getLocalSides()}contains(t){const e=new Ki(t,new E(1,0));return this.getSides().reduce((function(t,i){return e.intersect(i)>=0?t+1:t}),0)%2!=0}getClosestLineBetween(t){if(t instanceof es)return ts.PolygonCircleClosestLine(this,t);if(t instanceof os)return ts.PolygonPolygonClosestLine(this,t);if(t instanceof rs)return ts.PolygonEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCirclePolygon(t,this);if(t instanceof os)return ns.CollidePolygonPolygon(this,t);if(t instanceof rs)return ns.CollidePolygonEdge(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=t.dot(e[n]);r>s&&(s=r,i=e[n])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=t.dot(e[n]);r>s&&(s=r,i=e[n])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,n=-1;for(let r=0;r<e.length;r++){const o=e[r].distanceToPoint(t);o<i&&(i=o,s=r,n=o)}return-1!==s?{distance:e[s].normal().scale(n),face:e[s]}:null}get bounds(){var t,e,i;const s=this._transform,n=null!==(t=null==s?void 0:s.globalScale)&&void 0!==t?t:E.One,r=null!==(e=null==s?void 0:s.globalRotation)&&void 0!==e?e:0,o=(null!==(i=null==s?void 0:s.globalPos)&&void 0!==i?i:E.Zero).add(this.offset);return this.localBounds.scale(n).rotate(r).translate(o)}get localBounds(){return D.fromPoints(this.points)}getInertia(t){let e=0,i=0;for(let t=0;t<this.points.length;t++){const s=(t+1)%this.points.length,n=this.points[s].cross(this.points[t]);e+=n*(this.points[t].dot(this.points[t])+this.points[t].dot(this.points[s])+this.points[s].dot(this.points[s])),i+=n}return t/6*(e/i)}rayCast(t,e=1/0){const i=this.getSides(),s=i.length;let n=Number.MAX_VALUE,r=-1;for(let o=0;o<s;o++){const s=t.intersect(i[o]);s>=0&&s<n&&s<=e&&(n=s,r=o)}return r>=0?t.getPoint(n):null}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<i;r++){const i=e[r].dot(t);s=Math.min(s,i),n=Math.max(n,i)}return new ji(s,n)}draw(t,e=I.Green,i=E.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString();const n=this.points[0].add(s);t.moveTo(n.x,n.y),this.points.map((t=>t.add(s))).forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(n.x,n.y),t.closePath(),t.fill()}debug(t,e){const i=this.getTransformedPoints()[0],s=[i,...this.getTransformedPoints(),i];for(let i=0;i<s.length-1;i++)t.drawLine(s[i],s[i+1],e,2),t.drawCircle(s[i],2,e),t.drawCircle(s[i+1],2,e)}debugDraw(t,e=I.Red){t.beginPath(),t.strokeStyle=e.toString();const i=this.getTransformedPoints()[0];t.moveTo(i.x,i.y),this.getTransformedPoints().forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()}}class as{static Box(t,e,i=E.Half,s=E.Zero){return new os({points:new D(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=E.Zero){return new os({points:t,offset:e})}static Circle(t,e=E.Zero){return new es({radius:t,offset:e})}static Edge(t,e){return new rs({begin:t,end:e})}static Capsule(t,e,i=E.Zero){const s=y.getInstance();return t===e&&s.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),new $i(e>=t?[as.Circle(t/2,P(0,-e/2+t/2).add(i)),as.Box(t,e-t,E.Half,i),as.Circle(t/2,P(0,e/2-t/2).add(i))]:[as.Circle(e/2,P(-t/2+e/2,0).add(i)),as.Box(t-e,e,E.Half,i),as.Circle(e/2,P(t/2-e/2,0).add(i))])}}class ls extends Oi{constructor(t){super(),this.type="ex.collider",this.events=new pe,this.$colliderAdded=new Hi,this.$colliderRemoved=new Hi,this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,this.events.wire(t.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this.events.unwire(this._collider.events),this.$colliderRemoved.notifyAll(this._collider),this._collider.owner=null,this._collider=null)}get bounds(){var t,e;return null!==(e=null===(t=this._collider)||void 0===t?void 0:t.bounds)&&void 0!==e?e:new D}get localBounds(){var t,e;return null!==(e=null===(t=this._collider)||void 0===t?void 0:t.localBounds)&&void 0!==e?e:new D}update(){var t;const e=null===(t=this.owner)||void 0===t?void 0:t.get(Ui);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let s=!1;if(i instanceof $i&&(e=i,i=this._collider,s=!0),this._collider){const n=e.collide(i);return n?(s&&n.forEach((e=>{e.mtv=e.mtv.negate(),e.normal=e.normal.negate(),e.tangent=e.normal.perpendicular(),e.colliderA=this._collider,e.colliderB=t._collider})),n):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",(e=>{const i=e;t.events.emit("precollision",new Zt(i.target.owner,i.other.owner,i.side,i.intersection))})),this.events.on("postcollision",(e=>{const i=e;t.events.emit("postcollision",new Jt(i.target.owner,i.other.owner,i.side,i.intersection))})),this.events.on("collisionstart",(e=>{const i=e;t.events.emit("collisionstart",new ne(i.target.owner,i.other.owner,i.contact))})),this.events.on("collisionend",(e=>{const i=e;t.events.emit("collisionend",new re(i.target.owner,i.other.owner))}))}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=E.Half,s=E.Zero){const n=as.Box(t,e,i,s);return this.set(n)}usePolygonCollider(t,e=E.Zero){const i=as.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=E.Zero){const i=as.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=as.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new $i(t))}}var hs,cs,us,ds;(cs=hs||(hs={})).Rotation="rotation",cs.X="x",cs.Y="y";class ps extends Oi{constructor(t){var e,i,s;super(),this.type="ex.body",this.dependencies=[Ui,Wi],this.id=_("body",ps._ID++),this.events=new pe,this.collisionType=Ei.PreventCollision,this.group=Vi.All,this.mass=Li.defaultMass,this.sleepMotion=5*Li.sleepEpsilon,this.canSleep=Li.bodiesCanSleepByDefault,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldPos=new E(0,0),this.oldVel=new E(0,0),this.oldAcc=E.Zero,this.oldRotation=0,this.oldScale=E.One,t&&(this.collisionType=null!==(e=t.type)&&void 0!==e?e:this.collisionType,this.group=null!==(i=t.group)&&void 0!==i?i:this.group,this.useGravity=null!==(s=t.useGravity)&&void 0!==s?s:this.useGravity)}get inverseMass(){return this.collisionType===Ei.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=E.Zero,this.acc=E.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=5*Li.sleepEpsilon}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),e=Li.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=N(this.sleepMotion,0,10*Li.sleepEpsilon),this.canSleep&&this.sleepMotion<Li.sleepEpsilon&&this.setSleeping(!0)}get inertia(){const t=this.owner.get(ls);return(null==t?void 0:t.get())?t.get().getInertia(this.mass):0}get inverseInertia(){return this.collisionType===Ei.Fixed?0:1/this.inertia}get active(){var t;return!!(null===(t=this.owner)||void 0===t?void 0:t.active)}get center(){return this.pos}get transform(){var t;return null===(t=this.owner)||void 0===t?void 0:t.get(Ui)}get motion(){var t;return null===(t=this.owner)||void 0===t?void 0:t.get(Wi)}get pos(){return this.transform.globalPos}set pos(t){this.transform.globalPos=t}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get sx(){return this.motion.scaleFactor.x}set sx(t){this.motion.scaleFactor.x=t}get sy(){return this.motion.scaleFactor.y}set sy(t){this.motion.scaleFactor.y=t}get rx(){return this.motion.angularVelocity}set rx(t){this.motion.angularVelocity=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==Ei.Active)return;const i=e.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(hs.X)&&(i.x=0),this.limitDegreeOfFreedom.includes(hs.Y)&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(hs.Rotation)){const i=t.sub(this.pos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==Ei.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(hs.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(hs.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===Ei.Active&&!this.limitDegreeOfFreedom.includes(hs.Rotation)){const i=t.sub(this.pos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation}debugDraw(t){}}ps._ID=0;class fs{constructor(){this._topLeft=new E(0,0),this._topRight=new E(0,0),this._bottomLeft=new E(0,0),this._bottomRight=new E(0,0)}isSpriteOffScreen(t,e){const i=t.currentDrawing.drawWidth,s=t.currentDrawing.drawHeight,n=t.rotation,r=t.center,o=t.getGlobalPos();this._topLeft=P(o.x-i/2,o.y-s/2),this._topLeft=this._topLeft.rotate(n,r),this._topRight=P(o.x+i/2,o.y-s/2),this._topRight=this._topRight.rotate(n,r),this._bottomLeft=P(o.x-i/2,o.y+s/2),this._bottomLeft=this._bottomLeft.rotate(n,r),this._bottomRight=P(o.x+i/2,o.y+s/2),this._bottomRight=this._bottomRight.rotate(n,r);const a=e.worldToScreenCoordinates(this._topLeft),l=e.worldToScreenCoordinates(this._topRight),h=e.worldToScreenCoordinates(this._bottomLeft),c=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,l.x,h.x,c.x),this._yCoords.push(a.y,l.y,h.y,c.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);const u=e.screenToWorldCoordinates(new E(this._xMin,this._yMin)),d=e.screenToWorldCoordinates(new E(this._xMax,this._yMax));this._xMinWorld=u.x,this._yMinWorld=u.y,this._xMaxWorld=d.x,this._yMaxWorld=d.y;const p=[new E(this._xMin,this._yMin),new E(this._xMax,this._yMin),new E(this._xMin,this._yMax),new E(this._xMax,this._yMax)];if(p[0].x<0&&p[1].x>e.canvas.clientWidth&&(p[0].y>0||p[2].y<e.canvas.clientHeight))return!1;if(p[0].y<0&&p[2].y>e.canvas.clientHeight&&(p[1].x>0||p[0].x<e.canvas.clientWidth))return!1;for(let t=0;t<p.length;t++)if(p[t].x>0&&p[t].y>0&&p[t].x<e.canvas.clientWidth&&p[t].y<e.canvas.clientHeight)return!1;return!0}debugDraw(t){t.beginPath(),t.strokeStyle=I.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=I.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=I.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=I.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=I.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()}}class gs{constructor(){this.cullingBox=new fs}update(t,e){const i=t.eventDispatcher;let s=!0;null!=t.currentDrawing&&(s=this.cullingBox.isSpriteOffScreen(t,e));let n=!1;e&&e.currentScene&&e.currentScene.camera&&e.currentScene.camera.viewport&&!t.parent&&(n=!e.currentScene.camera.viewport.intersect(t.collider.bounds)),t.isOffScreen?n&&s||(i.emit("enterviewport",new ce(t)),t.removeComponent("offscreen")):n&&s&&(i.emit("exitviewport",new he(t)),t.addComponent(new Ni("offscreen")))}}class ms{constructor(t){this.data=t,this.type="Component Added"}}function _s(t){return!!t&&"Component Added"===t.type}class ys{constructor(t){this.data=t,this.type="Component Removed"}}function vs(t){return!!t&&"Component Removed"===t.type}class ws extends mi{constructor(t,e){if(super(),this.id=ws._ID++,this._name="anonymous",this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new Hi,this.componentRemoved$=new Hi,this._parent=null,this.childrenAdded$=new Hi,this.childrenRemoved$=new Hi,this._children=[],this._isInitialized=!1,this._setName(e),t)for(const e of t)this.addComponent(e)}_setName(t){t&&(this._name=t)}get name(){return this._name}get events(){return this.eventDispatcher}kill(){this.active=!1}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new Ni(t))}removeTag(t,e=!1){return this.removeComponent(t,e)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter((t=>t instanceof Ni)).map((t=>t.type)),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();const e=new ms({component:t,entity:this});this.componentAdded$.notifyAll(e)}_notifyRemoveComponent(t){const e=new ys({component:t,entity:this});this.componentRemoved$.notifyAll(e),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(null!==t.parent)throw new Error("Entity already has a parent, cannot add without unparenting");if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");return this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t),this}removeChild(t){return t.parent===this&&(it(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){return this.children.forEach((t=>{this.removeChild(t)})),this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();e=e.concat(i.children),t=t.concat(i.children)}return t}clone(){const t=new ws;for(const e of this.types)t.addComponent(this.get(e).clone());for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const e of t.children)this.addChild(e.clone().addTemplate(e));return this}addComponent(t,e=!1){if(this.has(t.type)){if(!e)return this;this.removeComponent(t)}if(t.dependencies&&t.dependencies.length)for(const e of t.dependencies)this.addComponent(new e);t.owner=this;const i=t.constructor;return this._componentTypeToInstance.set(i,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,e=!1){return e?"string"==typeof t?this._removeComponentByType(t):t instanceof Oi&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){if(this.has(t)){const e=this.get(t);e.owner=null,e.onRemove&&e.onRemove(this);const i=e.constructor;this._componentTypeToInstance.delete(i),this._componentStringToInstance.delete(e.type),this._notifyRemoveComponent(e)}}processComponentRemoval(){for(const t of this._componentsToRemove){const e="string"==typeof t?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return"string"==typeof t?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return"string"==typeof t?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new Ht(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e)}}ws._ID=0;class xs extends Oi{constructor(t){var e;super(),this.draw=t,this.type="ex.canvas",this.draw=null!==(e=this.draw)&&void 0!==e?e:()=>{}}}function bs(t){return!!t.tick}class Ss{constructor(t,e){this._options=t,this._graphics=e,this.graphics=[]}get name(){return this._options.name}hide(t){if(t){let e=null;e=t instanceof wt?t:this._graphics.getGraphic(t),this.graphics=this.graphics.filter((t=>t.graphic!==e)),this._graphics.recalculateBounds()}else this.graphics.length=0}show(t,e){let i;return e={...e},t instanceof wt?i=this._graphics.copyGraphics?t.clone():t:(i=this._graphics.getGraphic(t),i||y.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),i?(this.graphics.push({graphic:i,options:e}),this._graphics.recalculateBounds(),i):null}use(t,e){return e={...e},this.hide(),this.show(t,e)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return null!==(t=this._options.offset)&&void 0!==t?t:E.Zero}set offset(t){this._options.offset=t}get currentKeys(){var t;return null!==(t=this.name)&&void 0!==t?t:"anonymous"}}class Cs{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new Ss({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){const e=new Ss(t,this._component);return this._maybeAddLayer(e)}get(t){return t?this._getLayer(t):this._layers}currentKeys(){const t=[];for(const e of this._layers)t.push(e.currentKeys);return t}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort(((t,e)=>t.order-e.order)),t)}_getLayer(t){return this._layerMap[t]}}class Ts extends Oi{constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=E.Zero,this.anchor=E.Half,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,...t};const{current:e,anchor:i,opacity:s,visible:n,graphics:r,offset:o,copyGraphics:a,onPreDraw:l,onPostDraw:h}=t;this._graphics=r||{},this.offset=null!=o?o:this.offset,this.opacity=null!=s?s:this.opacity,this.anchor=null!=i?i:this.anchor,this.copyGraphics=null!=a?a:this.copyGraphics,this.onPreDraw=null!=l?l:this.onPreDraw,this.onPostDraw=null!=h?h:this.onPostDraw,this.visible=!!n,this.layers=new Cs(this),e&&this._graphics[e]&&this.show(this._graphics[e])}getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,e){let i="default",s=null;return"string"==typeof t?(i=t,s=e):s=t,this._graphics[i]=this.copyGraphics?s.clone():s,"default"===i&&this.show("default"),s}show(t,e){const i=this.layers.default.show(t,e);return this.recalculateBounds(),i}use(t,e){const i=this.layers.default.use(t,e);return this.recalculateBounds(),i}hide(t){this.layers.default.hide(t)}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new D;for(const e of this.layers.get())for(const{graphic:i,options:s}of e.graphics){let n=this.anchor,r=this.offset;(null==s?void 0:s.anchor)&&(n=s.anchor),(null==s?void 0:s.offset)&&(r=s.offset);const o=i.localBounds,a=-o.width*n.x+r.x,l=-o.height*n.y+r.y;t=null==i?void 0:i.localBounds.translate(P(a+e.offset.x,l+e.offset.y)).combine(t)}this._localBounds=t}get localBounds(){return this._localBounds||this.recalculateBounds(),this._localBounds}update(t,e=0){for(const i of this.layers.get())for(const{graphic:s}of i.graphics)bs(s)&&(null==s||s.tick(t,e))}}class Es extends At{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Es({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class Ps extends At{constructor(t){var e,i;super(t),this._radius=0,this.padding=null!==(e=t.padding)&&void 0!==e?e:2,this.radius=t.radius,this.filtering=null!==(i=t.filtering)&&void 0!==i?i:ut.Blended,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=2*this._radius,this.height=2*this._radius,this.flagDirty()}clone(){return new Ps({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class As extends Oi{constructor(){super(...arguments),this.type="ex.pointer",this.useColliderShape=!0,this.useGraphicsBounds=!1}}class ks{static CreateReversibleEasingFunction(t){return(e,i,s,n)=>s<i?i-(t(e,s,i,n)-s):t(e,i,s,n)}static CreateReversableEasingFunction(t){return ks.CreateReversibleEasingFunction(t)}static CreateVectorEasingFunction(t){return(e,i,s,n)=>new E(t(e,i.x,s.x,n),t(e,i.y,s.y,n))}}ks.Linear=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*t/s+e)),ks.EaseInQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t+e)),ks.EaseOutQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>-(i-=e)*(t/=s)*(t-2)+e)),ks.EaseInOutQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e))),ks.EaseInCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t*t+e)),ks.EaseOutCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(t/=s,(i-=e)*(--t*t*t+1)+e))),ks.EaseInOutCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e))),function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([T({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"CreateReversibleEasingFunction"})],ks,"CreateReversableEasingFunction",null);class Rs{constructor(t){this._actions=[],this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return 0===this._actions.length}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._entity)&&this._completedActions.push(this._actions.shift()))}}class Is{constructor(t,e,i){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Fs{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Ds{constructor(t,e,i,s){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(Ui),this._motion=t.get(Wi),this._speed=s,this._offset=new E(e,i),s<=0)throw y.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new E(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(Ui);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1}}class Ms{constructor(t,e,i,s){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._end=new E(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new E(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=P(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}isComplete(t){const e=t.get(Ui);return this._stopped||new E(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1}}(ds=us||(us={}))[ds.ShortestPath=0]="ShortestPath",ds[ds.LongestPath=1]="LongestPath",ds[ds.Clockwise=2]="Clockwise",ds[ds.CounterClockwise=3]="CounterClockwise";class Bs{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._end=e,this._speed=i,this._rotationType=s||us.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const t=Math.abs(this._end-this._start),e=L-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+L)%L>=Math.PI,this._rotationType){case us.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case us.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case us.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case us.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1}}class Ls{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._speed=i,this._offset=e,this._rotationType=s||us.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const t=Math.abs(this._end-this._start),e=L-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+L)%L>=Math.PI,this._rotationType){case us.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case us.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case us.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case us.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1}}class zs{constructor(t,e,i,s,n){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._endX=e,this._endY=i,this._speedX=s,this._speedY=n}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const t=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*t}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const t=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*t}this.isComplete()&&(this._tx.scale=P(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.y-this._startX)>=this._distanceX&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1}}class Os{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._offset=new E(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1}}class Ns{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class Hs{constructor(t,e,i,s,n){this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new E(0,0),this._lerpEnd=new E(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._tx=t.get(Ui),this._motion=t.get(Wi),this._lerpDuration=s,this._lerpEnd=new E(e,i)}_initialize(){this._lerpStart=new E(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=P((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=P(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=E.Zero)}isComplete(t){return this._stopped||new E(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance}reset(){this._initialized=!1}stop(){this._motion.vel=P(0,0),this._stopped=!0}}class Us{constructor(t,e,i,s=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Ts),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._elapsedTime=0,this._totalTime=0}}class Ws{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Ts),this._endOpacity=e,this._speed=i}update(t){this._graphics&&(this._started||(this._started=!0,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),y.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1}}class Vs{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1}}class Gs{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(Ks).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class js{constructor(t,e,i){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._followTx=e.get(Ui),this._followMotion=e.get(Wi),this._current=new E(this._tx.pos.x,this._tx.pos.y),this._end=new E(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(0!==e&&(this._speed=e),this._current=P(this._tx.pos.x,this._tx.pos.y),this._end=P(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const t=this._dir.scale(this._speed);this._motion.vel=P(t.x,t.y)}else this._motion.vel=P(0,0);this.isComplete()&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}stop(){this._motion.vel=P(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1}}class Xs{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(Ui),this._motion=t.get(Wi),this._meetTx=e.get(Ui),this._meetMotion=e.get(Wi),this._current=new E(this._tx.pos.x,this._tx.pos.y),this._end=new E(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current=P(this._tx.pos.x,this._tx.pos.y),this._end=P(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=P(i.x,i.y),this.isComplete()&&(this._tx.pos=P(this._end.x,this._end.y),this._motion.vel=P(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=P(0,0),this._stopped=!0}reset(){this._started=!1}}class qs{constructor(t){this._entity=t,this._queue=new Rs(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}easeTo(...t){var e,i;let s=0,n=0,r=0,o=ks.Linear;return t[0]instanceof E?(s=t[0].x,n=t[0].y,r=t[1],o=null!==(e=t[2])&&void 0!==e?e:o):(s=t[0],n=t[1],r=t[2],o=null!==(i=t[3])&&void 0!==i?i:o),this._queue.add(new Hs(this._entity,s,n,r,o)),this}moveTo(t,e,i){let s=0,n=0,r=0;return t instanceof E?(s=t.x,n=t.y,r=e):(s=t,n=e,r=i),this._queue.add(new Ms(this._entity,s,n,r)),this}moveBy(t,e,i){let s=0,n=0,r=0;return t instanceof E?(s=t.x,n=t.y,r=e):(s=t,n=e,r=i),this._queue.add(new Ds(this._entity,s,n,r)),this}rotateTo(t,e,i){return this._queue.add(new Bs(this._entity,t,e,i)),this}rotateBy(t,e,i){return this._queue.add(new Ls(this._entity,t,e,i)),this}scaleTo(t,e,i,s){let n=1,r=1,o=0,a=0;return t instanceof E&&e instanceof E&&(n=t.x,r=t.y,o=e.x,a=e.y),"number"==typeof t&&"number"==typeof e&&(n=t,r=e,o=i,a=s),this._queue.add(new zs(this._entity,n,r,o,a)),this}scaleBy(t,e,i){let s=1,n=1;return t instanceof E&&(s=t.x,n=t.y,i=e),"number"==typeof t&&"number"==typeof e&&(s=t,n=e),this._queue.add(new Os(this._entity,s,n,i)),this}blink(t,e,i=1){return this._queue.add(new Us(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new Ws(this._entity,t,e)),this}delay(t){return this._queue.add(new Vs(t)),this}die(){return this._queue.add(new Gs(this._entity)),this}callMethod(t){return this._queue.add(new Ns(t)),this}repeat(t,e){return e?(this._queue.add(new Is(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Fs(this._entity,t)),this}follow(t,e){return void 0===e?this._queue.add(new js(this._entity,t)):this._queue.add(new js(this._entity,t,e)),this}meet(t,e){return void 0===e?this._queue.add(new Xs(this._entity,t)):this._queue.add(new Xs(this._entity,t,e)),this}asPromise(){return this.toPromise()}toPromise(){return new Promise((t=>{this._queue.add(new Ns((()=>{t()})))}))}}class Ks extends Oi{constructor(){super(...arguments),this.type="ex.actions",this.dependencies=[Ui,Wi]}onAdd(t){this._ctx=new qs(t)}onRemove(){this._ctx=null}getQueue(){var t;return null===(t=this._ctx)||void 0===t?void 0:t.getQueue()}update(t){var e;return null===(e=this._ctx)||void 0===e?void 0:e.update(t)}clearActions(){var t;null===(t=this._ctx)||void 0===t||t.clearActions()}easeTo(...t){return this._ctx.easeTo.apply(this._ctx,t)}moveTo(t,e,i){return this._ctx.moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._ctx.moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._ctx.rotateTo(t,e,i)}rotateBy(t,e,i){return this._ctx.rotateBy(t,e,i)}scaleTo(t,e,i,s){return this._ctx.scaleTo.apply(this._ctx,[t,e,i,s])}scaleBy(t,e,i){return this._ctx.scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._ctx.blink(t,e,i)}fade(t,e){return this._ctx.fade(t,e)}delay(t){return this._ctx.delay(t)}die(){return this._ctx.die()}callMethod(t){return this._ctx.callMethod(t)}repeat(t,e){return this._ctx.repeat(t,e)}repeatForever(t){return this._ctx.repeatForever(t)}follow(t,e){return this._ctx.follow(t,e)}meet(t,e){return this._ctx.meet(t,e)}asPromise(){return this.toPromise()}toPromise(){return this._ctx.toPromise()}}class Ys extends wt{constructor(t={}){var e,i,s,n,r,o,a,l,h,c,u,d,p,f,g,m,_,y,v;super(t),this.filtering=ut.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=I.Black,this.family="sans-serif",this.style=Ne.Normal,this.bold=!1,this.unit=De.Px,this.textAlign=Be.Left,this.baseAlign=ze.Alphabetic,this.direction=Ue.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new D,this._textToBitmap=new Map,this._bitmapUsage=new Map,this.smoothing=null!==(e=null==t?void 0:t.smoothing)&&void 0!==e?e:this.smoothing,this.padding=null!==(i=null==t?void 0:t.padding)&&void 0!==i?i:this.padding,this.color=null!==(s=null==t?void 0:t.color)&&void 0!==s?s:this.color,this.strokeColor=null!==(n=null==t?void 0:t.strokeColor)&&void 0!==n?n:this.strokeColor,this.lineDash=null!==(r=null==t?void 0:t.lineDash)&&void 0!==r?r:this.lineDash,this.lineWidth=null!==(o=null==t?void 0:t.lineWidth)&&void 0!==o?o:this.lineWidth,this.filtering=null!==(a=null==t?void 0:t.filtering)&&void 0!==a?a:this.filtering,this.family=null!==(l=null==t?void 0:t.family)&&void 0!==l?l:this.family,this.style=null!==(h=null==t?void 0:t.style)&&void 0!==h?h:this.style,this.bold=null!==(c=null==t?void 0:t.bold)&&void 0!==c?c:this.bold,this.size=null!==(u=null==t?void 0:t.size)&&void 0!==u?u:this.size,this.unit=null!==(d=null==t?void 0:t.unit)&&void 0!==d?d:this.unit,this.textAlign=null!==(p=null==t?void 0:t.textAlign)&&void 0!==p?p:this.textAlign,this.baseAlign=null!==(f=null==t?void 0:t.baseAlign)&&void 0!==f?f:this.baseAlign,this.direction=null!==(g=null==t?void 0:t.direction)&&void 0!==g?g:this.direction,this.quality=null!==(m=null==t?void 0:t.quality)&&void 0!==m?m:this.quality,(null==t?void 0:t.shadow)&&(this.shadow={},this.shadow.blur=null!==(_=t.shadow.blur)&&void 0!==_?_:this.shadow.blur,this.shadow.offset=null!==(y=t.shadow.offset)&&void 0!==y?y:this.shadow.offset,this.shadow.color=null!==(v=t.shadow.color)&&void 0!==v?v:this.shadow.color)}clone(){return new Ys({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=null!==(e=this.origin)&&void 0!==e?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureText(t){const e=t.split("\n"),i=e.reduce(((t,e)=>t.length>e.length?t:e)),s=this._getTextBitmap(t);this._applyFont(s);const n=s.measureText(i);let r=Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxDescent);const o=r*e.length;r=o;const a=o-Math.abs(n.actualBoundingBoxAscent);return new D({left:0-Math.abs(n.actualBoundingBoxLeft)-this.padding,top:0-Math.abs(n.actualBoundingBoxAscent)-this.padding,bottom:0+a+this.padding,right:0+Math.abs(n.actualBoundingBoxRight)+this.padding})}_setDimension(t,e){e.canvas.width=2*(t.width+2*this.padding)*this.quality,e.canvas.height=2*(t.height+2*this.padding)*this.quality}_postDraw(t){t.restore()}_getRasterPropertiesHash(t){var e,i;return"__hashcode__"+this.fontString+this.showDebug+this.textAlign+this.baseAlign+this.direction+JSON.stringify(this.shadow)+(this.padding.toString()+this.smoothing.toString()+this.lineWidth.toString()+this.lineDash.toString()+(null===(e=this.strokeColor)||void 0===e?void 0:e.toString())+(t?t.toString():null===(i=this.color)||void 0===i?void 0:i.toString()).toString())}_applyRasterProperties(t,e){var i,s,n;t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash(null!==(i=this.lineDash)&&void 0!==i?i:t.getLineDash()),t.strokeStyle=null===(s=this.strokeColor)||void 0===s?void 0:s.toString(),t.fillStyle=e?e.toString():null===(n=this.color)||void 0===n?void 0:n.toString()}_applyFont(t){t.translate(this.padding+t.canvas.width/2,this.padding+t.canvas.height/2),t.scale(this.quality,this.quality),t.textAlign=this.textAlign,t.textBaseline=this.baseAlign,t.font=this.fontString,t.direction=this.direction,this.shadow&&(t.shadowColor=this.shadow.color.toString(),t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y)}_drawText(t,e,i,s){const n=e.split("\n");this._applyRasterProperties(t,i),this._applyFont(t);for(let e=0;e<n.length;e++){const i=n[e];this.color&&t.fillText(i,0,e*s),this.strokeColor&&t.strokeText(i,0,e*s)}this.showDebug&&(_i(t,I.Red,-t.canvas.width/2,0,t.canvas.width/2,0,2),_i(t,I.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_getTextBitmap(t,e){const i=t+this._getRasterPropertiesHash(e),s=this._textToBitmap.get(i);if(s)return s;const n=document.createElement("canvas").getContext("2d");return this._textToBitmap.set(i,n),n}render(t,e,i,s,n){this.showDebug&&this.clearCache(),this.checkAndClearCache();const r=this._getTextBitmap(e,i),o=!this._bitmapUsage.get(r);this._textBounds=this.measureText(e),o&&this._setDimension(this._textBounds,r),this._preDraw(t,s,n);const a=e.split("\n"),l=this._textBounds.height/a.length,h=r.canvas.width,c=r.canvas.height;o&&(this._drawText(r,e,i,l),Pt.load(r.canvas,this.filtering,!0)),t.drawImage(r.canvas,0,0,h,c,s-h/this.quality/2,n-c/this.quality/2,h/this.quality,c/this.quality),this._postDraw(t),this._bitmapUsage.set(r,performance.now())}get cacheSize(){return this._bitmapUsage.size}clearCache(){this._bitmapUsage.clear()}checkAndClearCache(){for(const[t,e]of this._bitmapUsage.entries())e+1e3<performance.now()&&this._bitmapUsage.delete(t)}}class Qs extends wt{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=null!==(e=t.font)&&void 0!==e?e:new Ys,this.color=null!==(i=t.color)&&void 0!==i?i:this.color,this.text=t.text}clone(){var t,e;return new Qs({text:this.text.slice(),color:null!==(e=null===(t=this.color)||void 0===t?void 0:t.clone())&&void 0!==e?e:I.Black,font:this.font.clone()})}get text(){return this._text}set text(t){this._text=t;const e=this.font.measureText(this._text);this._textWidth=e.width,this._textHeight=e.height}get font(){return this._font}set font(t){this._font=t}get width(){return 0===this._textWidth&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return 0===this._textHeight&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text).scale(this.scale)}_rotate(t){}_flip(t){}_drawImage(t,e,i){var s;let n=I.Black;this.font instanceof Ys&&(n=null!==(s=this.color)&&void 0!==s?s:this.font.color),(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity);const{width:r,height:o}=this.font.measureText(this._text);this._textWidth=r,this._textHeight=o,this.font.render(t,this._text,n,e,i),this.font.showDebug&&t.debug.drawRect(e-r,i-o,2*r,2*o)}}var $s=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Zs extends ws{constructor(t){super(),this._anchor=yt(E.Half,(t=>this._handleAnchorChange(t))),this.logger=y.getInstance(),this.scene=null,this.frames={},this.currentDrawing=null,this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=t=>{this._dragging&&(this.pos=t.worldPos)},this._pointerDragLeaveHandler=t=>{this._dragging&&(this.pos=t.worldPos)},this.traits=[];const{name:e,x:i,y:s,pos:n,coordPlane:r,scale:o,width:a,height:l,radius:h,collider:u,vel:d,acc:p,rotation:f,angularVelocity:g,z:_,color:v,visible:w,anchor:x,collisionType:b,collisionGroup:S}={...t};this._setName(e),this.anchor=null!=x?x:Zs.defaults.anchor.clone();const C=new Ui;this.addComponent(C),this.pos=null!=n?n:P(null!=i?i:0,null!=s?s:0),this.rotation=null!=f?f:0,this.scale=null!=o?o:P(1,1),this.z=null!=_?_:0,C.coordPlane=null!=r?r:Mi.World,this.addComponent(new As),this.addComponent(new Ts({anchor:this.anchor})),this.addComponent(new xs(((t,e)=>this.draw(t,e)))),this.addComponent(new Wi),this.vel=null!=d?d:E.Zero,this.acc=null!=p?p:E.Zero,this.angularVelocity=null!=g?g:0,this.addComponent(new Ks),this.addComponent(new ps),this.body.collisionType=null!=b?b:Ei.Passive,S&&(this.body.group=S),u?this.addComponent(new ls(u)):h?this.addComponent(new ls(as.Circle(h,this.anchor))):a>0&&l>0?this.addComponent(new ls(as.Box(a,l,this.anchor))):this.addComponent(new ls),this.graphics.visible=null==w||w,v&&(this.color=v,a&&l?this.graphics.add(new Es({color:v,width:a,height:l})):h&&this.graphics.add(new Ps({color:v,radius:h}))),m.isEnabled(c.LegacyDrawing)&&this.traits.push(new gs)}get body(){return this.get(ps)}get transform(){return this.get(Ui)}get motion(){return this.get(Wi)}get graphics(){return this.get(Ts)}get collider(){return this.get(ls)}get pointer(){return this.get(As)}get actions(){return this.get(Ks)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(Ui).scale}set scale(t){this.get(Ui).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=yt(t,(t=>this._handleAnchorChange(t))),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get isOffScreen(){return this.hasTag("offscreen")}get visible(){return this.graphics.visible}set visible(t){this.graphics.visible=t}get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){var e;this._color=t.clone();const i=null===(e=this.graphics.layers.default.graphics[0])||void 0===e?void 0:e.graphic;(i instanceof At||i instanceof Qs)&&(i.color=this._color)}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new Ft(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new Dt(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new It(this)),super.kill(),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")}unkill(){this.active=!0}isKilled(){return!this.active}setDrawing(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):y.getInstance().error(`the specified drawing key ${t} does not exist`)),this.currentDrawing&&this.currentDrawing instanceof Fe&&this.currentDrawing.tick(0)}addDrawing(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof Ae&&this.addDrawing("default",arguments[0]),arguments[0]instanceof Te&&this.addDrawing("default",arguments[0].asSprite()))}get z(){return this.get(Ui).z}getZIndex(){return this.get(Ui).z}set z(t){this.get(Ui).z=t}setZIndex(t){this.get(Ui).z=t}get center(){const t=this.getGlobalPos();return new E(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new E(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(Ui).globalRotation}getGlobalPos(){return this.get(Ui).globalPos}getGlobalScale(){return this.get(Ui).globalScale}contains(t,e,i=!1){const s=P(t,e),n=this.get(ls);n.update();const r=n.get();if(!r)return!1;const o=r.contains(s);return i?o||this.children.some((i=>i.contains(t,e,!0))):o}within(t,e){const i=this.get(ls),s=t.get(ls),n=i.get(),r=s.get();return!(!n||!r)&&n.getClosestLineBetween(r).getLength()<=e}update(t,e){this._initialize(t),this._preupdate(t,e);const i=this.currentDrawing;i&&i instanceof Fe&&i.tick(e,t.stats.currFrame.id);for(const i of this.traits)i.update(this,t,e);this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new Ht(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Ht(t,e,this)),this.onPostUpdate(t,e)}draw(t,e){var i;if(t.save(),this.currentDrawing){t.translate(-this.width*this.anchor.x,-this.height*this.anchor.y),this._predraw(t,e);const i=this.currentDrawing,s=(this.width-i.width*i.scale.x)*this.anchor.x,n=(this.height-i.height*i.scale.y)*this.anchor.y;this.currentDrawing.draw({ctx:t,x:s,y:n,opacity:this.graphics.opacity})}else if(this._predraw(t,e),this.color&&this.collider){const e=this.get(ls);e.update(),e&&!e.bounds.hasZeroDimensions()&&(t.globalAlpha=this.graphics.opacity,null===(i=e.get())||void 0===i||i.draw(t,this.color,P(0,0)))}t.restore(),this._postdraw(t,e)}onPreDraw(t,e){}onPostDraw(t,e){}_predraw(t,e){this.emit("predraw",new Lt(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Lt(t,e,this)),this.onPostDraw(t,e)}debugDraw(t){}}Zs.defaults={anchor:E.Half},$s([T({message:"Actor.visible will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.visible"})],Zs.prototype,"visible",null),$s([T({message:"Actor.opacity will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.opacity"})],Zs.prototype,"opacity",null),$s([T({message:"Actor.setDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.show() or Actor.graphics.use()"})],Zs.prototype,"setDrawing",null),$s([T({message:"Actor.addDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.add()"})],Zs.prototype,"addDrawing",null),$s([T({message:"Actor.getZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Zs.prototype,"getZIndex",null),$s([T({message:"Actor.setZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Zs.prototype,"setZIndex",null);class Js extends Zs{constructor(t){super({...t}),this.get(Ui).coordPlane=Mi.Screen,this.anchor=P(0,0),this.body.collisionType=Ei.PreventCollision,this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new E(t,e));return super.contains(s.x,s.y)}}class tn{constructor(t,e,i,s){if(this._logger=y.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this._complete=!1,this.scene=null,"function"!=typeof t){const n=t;t=n.fcn,e=n.interval,i=n.repeats,s=n.numberOfRepeats}if(s&&s>=0&&(this.maxNumberOfRepeats=s,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=tn._MAX_ID++,this.interval=e||this.interval,this.repeats=i||this.repeats,this._callbacks=[],t&&this.on(t)}get complete(){return this._complete}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach((t=>{t.call(this)})),this._numberOfTicks++,this.repeats||(this._complete=!0,this._running=!1),this._elapsedTime=0))}reset(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}unpause(){this._running=!0}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}tn._MAX_ID=0,function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([T({message:"Will be removed in v0.26.0",alternateMethod:"Use Timer.resume()"})],tn.prototype,"unpause",null);class en extends Oi{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e,this.type="ex.debuggraphics"}}var sn,nn,rn=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class on extends ws{constructor(t){var e;super(null,t.name),this._token=0,this._onScreenXStart=0,this._onScreenXEnd=Number.MAX_VALUE,this._onScreenYStart=0,this._onScreenYEnd=Number.MAX_VALUE,this._spriteSheets={},this._legacySpriteMap=new Map,this.logger=y.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this._collidersDirty=!0,this._originalOffsets=new WeakMap,this.addComponent(new Ui),this.addComponent(new Wi),this.addComponent(new ps({type:Ei.Fixed})),this.addComponent(new xs(((t,e)=>this.draw(t,e)))),this.addComponent(new Ts({onPostDraw:(t,e)=>this.draw(t,e)})),this.addComponent(new en((t=>this.debug(t)))),this.addComponent(new ls),this._transform=this.get(Ui),this._motion=this.get(Wi),this._collider=this.get(ls),this._composite=this._collider.useCompositeCollider([]),this._transform.pos=null!==(e=t.pos)&&void 0!==e?e:E.Zero,this._transform.posChanged$.subscribe((()=>this.flagCollidersDirty())),this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.height=t.height,this.width=t.width,this.tiles=new Array(this.height*this.width),this._rows=new Array(this.height),this._cols=new Array(this.width);let i=[];for(let t=0;t<this.width;t++){for(let e=0;e<this.height;e++){const s=new an({x:t,y:e,map:this});s.map=this,this.tiles[t+e*this.width]=s,i.push(s),this._rows[e]||(this._rows[e]=[]),this._rows[e].push(s)}this._cols[t]=i,i=[]}this.get(Ts).localBounds=new D({left:0,top:0,right:this.width*this.tileWidth,bottom:this.height*this.tileHeight})}flagCollidersDirty(){this._collidersDirty=!0}get x(){var t;return null!==(t=this._transform.pos.x)&&void 0!==t?t:0}set x(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this.get(Ui).pos=P(t,this.y))}get y(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos.y)&&void 0!==e?e:0}set y(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this._transform.pos=P(this.x,t))}get z(){var t;return null!==(t=this._transform.z)&&void 0!==t?t:0}set z(t){this._transform&&(this._transform.z=t)}get rotation(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.rotation)&&void 0!==e?e:0}set rotation(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.rotation)&&(this._transform.rotation=t)}get scale(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.scale)&&void 0!==e?e:E.One}set scale(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.scale)&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}on(t,e){super.on(t,e)}_initialize(t){super._initialize(t)}registerSpriteSheet(t,e){this._spriteSheets[t]=e instanceof je?e:je.fromLegacySpriteSheet(e)}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}_updateColliders(){this._composite.clearColliders();const t=[];let e;this._composite=this._collider.useCompositeCollider([]);for(let i=0;i<this.width;i++){for(let s=0;s<this.height;s++){0===s&&(e=null);const n=this.tiles[i+s*this.width];if(n.solid)if(n.getColliders().length>0){for(const t of n.getColliders()){const e=this._getOrSetColliderOriginalOffset(t);t.offset=P(n.x*this.tileWidth,n.y*this.tileHeight).add(e),t.owner=this,this._composite.addCollider(t)}e=null}else e=e?e.combine(n.bounds):n.bounds;else e&&t.push(e),e=null}if(e){const i=t[t.length-1];i&&i.top===e.top&&i.bottom===e.bottom?t[t.length-1]=i.combine(e):t.push(e)}}for(const e of t){const t=as.Box(e.width,e.height,E.Zero,P(e.left-this.pos.x,e.top-this.pos.y));t.owner=this,this._composite.addCollider(t)}this._collider.update()}getTileByIndex(t){return this.tiles[t]}getTile(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.tiles[t+e*this.width]}getTileByPoint(t){const e=Math.floor((t.x-this.pos.x)/this.tileWidth),i=Math.floor((t.y-this.pos.y)/this.tileHeight),s=this.getTile(e,i);return e>=0&&i>=0&&e<this.width&&i<this.height&&s?s:null}getRows(){return this._rows}getColumns(){return this._cols}update(t,e){this.onPreUpdate(t,e),this.emit("preupdate",new Ht(t,e,this)),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++;const i=t.getWorldBounds(),s=P(i.left,i.top),n=P(i.right,i.bottom);this._onScreenXStart=Math.max(Math.floor((s.x-this.x)/this.tileWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((s.y-this.y)/this.tileHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((n.x-this.x)/this.tileWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((n.y-this.y)/this.tileHeight)+2,0),this._transform.pos=P(this.x,this.y),this.onPostUpdate(t,e),this.emit("postupdate",new Ut(t,e,this))}draw(t,e){this.emit("predraw",new Lt(t,e,this));let i=this._onScreenXStart;const s=Math.min(this._onScreenXEnd,this.width);let n=this._onScreenYStart;const r=Math.min(this._onScreenYEnd,this.height);let o,a,l;for(;i<s;i++){for(;n<r;n++)for(o=this.getTile(i,n).getGraphics(),a=0,l=o.length;a<l;a++){const s=o[a];s&&(t instanceof CanvasRenderingContext2D?s instanceof ke&&(this._legacySpriteMap.has(s)||this._legacySpriteMap.set(s,ke.toLegacySprite(s)),this._legacySpriteMap.get(s).draw(t,i*this.tileWidth,n*this.tileHeight)):(bs(s)&&(null==s||s.tick(e,this._token)),s.draw(t,i*this.tileWidth,n*this.tileHeight)))}n=this._onScreenYStart}this.emit("postdraw",new zt(t,e,this))}debug(t){const e=this.tileWidth*this.width,i=this.tileHeight*this.height,s=E.Zero;for(let i=0;i<this.height+1;i++){const n=P(0,i*this.tileHeight);t.drawLine(s.add(n),s.add(P(e,n.y)),I.Red,2)}for(let e=0;e<this.width+1;e++){const n=P(e*this.tileWidth,0);t.drawLine(s.add(n),s.add(P(n.x,i)),I.Red,2)}const n=this._composite.getColliders();for(const e of n){const i=I.Gray;i.a=.5;const s=e.localBounds,n=e.worldPos.sub(this.pos);t.drawRectangle(n,s.width,s.height,i)}}}rn([T({message:"No longer used, will be removed in v0.26.0"})],on.prototype,"registerSpriteSheet",null);class an extends ws{constructor(t){var e,i;super(),this._posDirty=!1,this._solid=!1,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this.width=t.map.tileWidth,this.height=t.map.tileHeight,this.solid=null!==(e=t.solid)&&void 0!==e?e:this.solid,this._graphics=null!==(i=t.graphics)&&void 0!==i?i:[],this._recalculate(),this._transform=t.map.get(Ui),this._transform.posChanged$.subscribe((()=>{this._posDirty=!0}))}get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get solid(){return this._solid}set solid(t){var e;null===(e=this.map)||void 0===e||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}addGraphic(t){t instanceof Ae?this._graphics.push(ke.fromLegacySprite(t)):this._graphics.push(t)}removeGraphic(t){it(t,this._graphics)}clearGraphics(){this._graphics.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}_recalculate(){this._pos=this.map.pos.add(P(this.x*this.map.tileWidth,this.y*this.map.tileHeight)),this._bounds=new D(this._pos.x,this._pos.y,this._pos.x+this.width,this._pos.y+this.height)}get bounds(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._bounds}get center(){return new E(this._pos.x+this.width/2,this._pos.y+this.height/2)}pushSprite(t){this.addGraphic(t)}}rn([T({message:"Will be removed in v0.26.0",alternateMethod:"addSprite"})],an.prototype,"pushSprite",null);class ln{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new hn(t))}lockToActorAxis(t,e){this.camera.addStrategy(new cn(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new un(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new dn(t,e))}limitCameraBounds(t){this.camera.addStrategy(new pn(t))}}(nn=sn||(sn={}))[nn.X=0]="X",nn[nn.Y=1]="Y";class hn{constructor(t){this.target=t,this.action=(t,e,i,s)=>t.center}}class cn{constructor(t,e){this.target=t,this.axis=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus();return this.axis===sn.X?new E(n.x,r.y):new E(r.x,n.y)}}}class un{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(t,e,i,s)=>{const n=t.center;let r=e.getFocus(),o=e.vel.clone();const a=n.sub(r).scale(this.cameraElasticity);o=o.add(a);const l=o.scale(-1).scale(this.cameraFriction);return o=o.add(l),r=r.add(o),r}}}class dn{constructor(t,e){this.target=t,this.radius=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus(),o=n.sub(r),a=o.size;if(a>=this.radius){const t=a-this.radius;return r.add(o.normalize().scale(t))}return r}}}class pn{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(t,e,i,s)=>{const n=e.getFocus();this.boundSizeChecked||((t.bottom-t.top<i.drawHeight||t.right-t.left<i.drawWidth)&&y.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let r=n.x,o=n.y;return n.x<t.left+i.halfDrawWidth?r=t.left+i.halfDrawWidth:n.x>t.right-i.halfDrawWidth&&(r=t.right-i.halfDrawWidth),n.y<t.top+i.halfDrawHeight?o=t.top+i.halfDrawHeight:n.y>t.bottom-i.halfDrawHeight&&(o=t.bottom-i.halfDrawHeight),P(r,o)}}}class fn extends mi{constructor(){super(...arguments),this.transform=gt.identity(),this.inverse=gt.identity(),this._cameraStrategies=[],this.strategy=new ln(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this.rx=0,this._posChanged=!1,this._pos=vt(E.Zero,(()=>this._posChanged=!0)),this.vel=E.Zero,this.acc=E.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=ks.EaseInOutCubic,this._easing=ks.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this.rx}set angularVelocity(t){this.rx=t}get pos(){return this._pos}set pos(t){this._pos=vt(t,(()=>this._posChanged=!0)),this._posChanged=!0}get x(){return this.pos.x}set x(t){this._follow||this._cameraMoving||(this.pos=P(t,this.pos.y))}get y(){return this.pos.y}set y(t){this._follow||this._cameraMoving||(this.pos=P(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=P(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=P(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=P(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=P(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=ks.EaseInOutCubic){if("function"!=typeof i)throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise((t=>{this._lerpResolve=t})),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=ks.EaseInOutCubic){return this._zoomPromise=new Promise((t=>{this._zoomResolve=t})),e?(this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t,this._zoomPromise):(this._isZooming=!1,this.zoom=t,Promise.resolve(!0))}get viewport(){return this._viewport?this._viewport:new D(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){it(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new Ht(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.resolution;let i=P(e.width/2,e.height/2);if(!this._engine.loadingComplete){const t=this._screen.peekResolution();t&&(i=P(t.width/2,t.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.updateTransform(),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(),this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0}}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new D(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const t=(0,this._zoomEasing)(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=t,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const t=ks.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=t,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const t=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(t)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0)),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(),this._postupdate(t,e)}draw(t){if(t instanceof CanvasRenderingContext2D){const e=this.getFocus(),i=this._screen.resolution.width/this.zoom,s=this._screen.resolution.height/this.zoom,n=P(-e.x+i/2+this._xShake,-e.y+s/2+this._yShake);t.scale(this.zoom,this.zoom),t.translate(n.x,n.y)}else t.multiply(this.transform)}updateTransform(){const t=this._screen.resolution.width/this.zoom,e=this._screen.resolution.height/this.zoom,i=P(-this.x+t/2+this._xShake,-this.y+e/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(i.x,i.y),this.transform.getAffineInverse(this.inverse)}debugDraw(t){}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}function gn(t){return t instanceof Js}const mn={pos:E.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class _n extends Zs{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...mn,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=Ei.Passive,this.eventDispatcher=new pe,this.events.on("collisionstart",(t=>{this.filter(t.other)&&(this.emit("enter",new ue(this,t.other)),this._dispatchAction(),0===this.repeat&&this.kill())})),this.events.on("collisionend",(t=>{this.filter(t.other)&&this.emit("exit",new de(this,t.other))}))}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){0!==this.repeat&&(this.action.call(this),this.repeat--)}debugDraw(t){super.debugDraw(t),t.save(),t.translate(this.pos.x,this.pos.y);const e=this.collider.bounds,i=this.getGlobalPos();e.left=e.left-i.x,e.right=e.right-i.x,e.top=e.top-i.y,e.bottom=e.bottom-i.y,t.fillStyle=I.Violet.toString(),t.strokeStyle=I.Violet.toString(),t.fillText("Trigger",10,10),e.debugDraw(t),t.restore()}}var yn,vn;(vn=yn||(yn={})).Update="update",vn.Draw="draw";class wn{constructor(){this.priority=0}notify(t){}}class xn{constructor(t){this.data=t,this.type="Entity Added"}}function bn(t){return!!t&&"Entity Added"===t.type}class Sn{constructor(t){this.data=t,this.type="Entity Removed"}}function Cn(t){return!!t&&"Entity Removed"===t.type}class Tn{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,e){for(const i of this.entities)i.update(t.engine,e),i.active||this.removeEntity(i)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}notify(t){_s(t)&&this._world.queryManager.addEntity(t.data.entity),vs(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t.active=!0,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach((t=>this.addEntity(t))),t.childrenAdded$.register({notify:t=>{this.addEntity(t)}}),t.childrenRemoved$.register({notify:t=>{this.removeEntity(t,!1)}}))}removeEntity(t,e=!0){var i;let s=0;s=t instanceof ws?t.id:t;const n=this._entityIndex[s];n&&n.active&&n.kill(),n&&e?this._entitiesToRemove.push(n):(delete this._entityIndex[s],n&&(it(n,this.entities),this._world.queryManager.removeEntity(n),n.componentAdded$.unregister(this),n.componentRemoved$.unregister(this),n.children.forEach((t=>this.removeEntity(t,e))),n.childrenAdded$.clear(),n.childrenRemoved$.clear(),(null===(i=this._world.context)||void 0===i?void 0:i.engine)&&this._world.context.engine.stats.currFrame.actors.killed++))}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1)}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter((e=>e.name===t))}clear(){for(const t of this.entities)this.removeEntity(t)}}const En=t=>[...t].sort(((t,e)=>t.localeCompare(e))).join("+");class Pn extends Hi{constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map((t=>(new t).type)):this.types=t}get key(){return this._key?this._key:this._key=En(this.types)}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!st(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new xn(t)))}removeEntity(t){it(t,this._entities)&&this.notifyAll(new Sn(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];e=t instanceof ws?t.types:t;let i=!0;for(const t of this.types)if(i=i&&e.indexOf(t)>-1,!i)return!1;return i}contain(t){return this.types.indexOf(t)>-1}}class An{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[En(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){0===t.observers.length&&(t.clear(),delete this._queries[En(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const i in this._queries)this._queries[i].contain(e.type)&&this._queries[i].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const i=new Pn(t);return this._addQuery(i),i}getQuery(t){const e=En(t);return this._queries[e]?this._queries[e]:null}}class kn{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find((e=>e instanceof t))}addSystem(t){if(!t.types||0===t.types.length)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort(((t,e)=>t.priority-e.priority)),e.register(t),this.initialized&&t.initialize&&t.initialize(this._world.context)}removeSystem(t){it(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world.context)}}updateSystems(t,e,i){const s=this.systems.filter((e=>e.systemType===t));for(const t of s)t.preupdate&&t.preupdate(e,i);for(const t of s){const s=this._world.queryManager.getQuery(t.types).getEntities(t.sort);if(e instanceof br)for(const t of s)t._initialize(null==e?void 0:e.engine);t.update(s,i)}for(const t of s)t.postupdate&&t.postupdate(e,i)}clear(){for(const t of this.systems)this.removeSystem(t)}}class Rn{constructor(t){this.context=t,this.queryManager=new An(this),this.entityManager=new Tn(this),this.systemManager=new kn(this)}update(t,e){t===yn.Update&&this.entityManager.updateEntities(this.context,e),this.systemManager.updateSystems(t,this.context,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof ws&&this.entityManager.addEntity(t),t instanceof wn&&this.systemManager.addSystem(t)}remove(t,e=!0){t instanceof ws&&this.entityManager.removeEntity(t,e),t instanceof wn&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class In{static integrate(t,e,i,s){const n=s/1e3;e.vel.addEqual(i.scale(n)),t.pos.addEqual(e.vel.scale(n)).addEqual(i.scale(.5*n*n)),e.angularVelocity+=e.torque*(1/e.inertia)*n,t.rotation+=e.angularVelocity*n,t.scale.addEqual(e.scaleFactor.scale(n))}}class Fn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.motion"],this.systemType=yn.Update,this.priority=-1}update(t,e){let i,s;for(const n of t){i=n.get(Ui),s=n.get(Wi);const t=n.get(ps);if(null==t?void 0:t.sleeping)continue;const r=s.acc.clone();(null==t?void 0:t.collisionType)===Ei.Active&&(null==t?void 0:t.useGravity)&&r.addEqual(Li.gravity),null==t||t.captureOldTransform(),In.integrate(i,s,r,e)}}debugDraw(t){}}class Dn{solve(t){return this.preSolve(t),t=t.filter((t=>!t.isCanceled())),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}}class Mn extends Dn{preSolve(t){for(const e of t){const t=A.fromDirection(e.mtv),i=e.mtv.negate();e.colliderA.events.emit("precollision",new Zt(e.colliderA,e.colliderB,t,i)),e.colliderB.events.emit("precollision",new Zt(e.colliderB,e.colliderA,A.getOpposite(t),i.negate()))}}postSolve(t){var e,i;for(const s of t){const t=s.colliderA,n=s.colliderB,r=null===(e=t.owner)||void 0===e?void 0:e.get(ps),o=null===(i=n.owner)||void 0===i?void 0:i.get(ps);if(r&&o&&(r.collisionType===Ei.Passive||o.collisionType===Ei.Passive))continue;const a=A.fromDirection(s.mtv),l=s.mtv.negate();s.colliderA.events.emit("postcollision",new Jt(s.colliderA,s.colliderB,a,l)),s.colliderB.events.emit("postcollision",new Jt(s.colliderB,s.colliderA,A.getOpposite(a),l.negate()))}}solvePosition(t){var e,i;for(const s of t){if(!s.colliderA.bounds.intersect(s.colliderB.bounds))continue;let t=s.mtv;const n=s.colliderA,r=s.colliderB,o=null===(e=n.owner)||void 0===e?void 0:e.get(ps),a=null===(i=r.owner)||void 0===i?void 0:i.get(ps);if(o&&a){if(o.collisionType===Ei.Passive||a.collisionType===Ei.Passive)continue;o.collisionType===Ei.Active&&a.collisionType===Ei.Active&&(t=t.scale(.5)),o.collisionType===Ei.Active&&(o.pos.x-=t.x,o.pos.y-=t.y),a.collisionType===Ei.Active&&(a.pos.x+=t.x,a.pos.y+=t.y)}}}solveVelocity(t){var e,i;for(const s of t){const t=s.colliderA,n=s.colliderB,r=null===(e=t.owner)||void 0===e?void 0:e.get(ps),o=null===(i=n.owner)||void 0===i?void 0:i.get(ps);if(r&&o){if(r.collisionType===Ei.Passive||o.collisionType===Ei.Passive)continue;const t=s.normal,e=t.negate();if(r.collisionType===Ei.Active){const e=t.scale(t.dot(r.vel.negate()));r.vel=r.vel.add(e)}if(o.collisionType===Ei.Active){const t=e.scale(e.dot(o.vel.negate()));o.vel=o.vel.add(t)}}}}}class Bn{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new E(0,0),this.bToContact=new E(0,0),this.update()}update(){var t,e;const i=null===(t=this.contact.colliderA.owner)||void 0===t?void 0:t.get(ps),s=null===(e=this.contact.colliderB.owner)||void 0===e?void 0:e.get(ps);if(i&&s){const t=this.contact.normal,e=this.contact.tangent;this.aToContact=this.point.sub(i.pos),this.bToContact=this.point.sub(s.pos);const n=this.aToContact.cross(t),r=this.bToContact.cross(t);this.normalMass=i.inverseMass+s.inverseMass+i.inverseInertia*n*n+s.inverseInertia*r*r;const o=this.aToContact.cross(e),a=this.bToContact.cross(e);this.tangentMass=i.inverseMass+s.inverseMass+i.inverseInertia*o*o+s.inverseInertia*a*a}return this}getRelativeVelocity(){var t,e;const i=null===(t=this.contact.colliderA.owner)||void 0===t?void 0:t.get(ps),s=null===(e=this.contact.colliderB.owner)||void 0===e?void 0:e.get(ps);if(i&&s){const t=i.vel.add(E.cross(i.angularVelocity,this.aToContact));return s.vel.add(E.cross(s.angularVelocity,this.bToContact)).sub(t)}return E.Zero}}class Ln extends Dn{constructor(){super(...arguments),this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return null!==(e=this.idToContactConstraint.get(t))&&void 0!==e?e:[]}preSolve(t){var e,i,s;for(const e of t){const t=A.fromDirection(e.mtv);e.colliderA.events.emit("precollision",new Zt(e.colliderA,e.colliderB,t,e.mtv)),e.colliderA.events.emit("beforecollisionresolve",new ie(e.colliderA,e.colliderB,t,e.mtv,e)),e.colliderB.events.emit("precollision",new Zt(e.colliderB,e.colliderA,A.getOpposite(t),e.mtv.negate())),e.colliderB.events.emit("beforecollisionresolve",new ie(e.colliderB,e.colliderA,A.getOpposite(t),e.mtv.negate(),e)),e.matchAwake()}const n=Array.from(this.idToContactConstraint.keys());for(const r of t){const t=n.indexOf(r.id);t>-1&&n.splice(t,1);const o=null!==(e=this.idToContactConstraint.get(r.id))&&void 0!==e?e:[];let a=0;const l=r.colliderA.owner.get(ps),h=r.colliderB.owner.get(ps);if(l&&h)for(const t of r.points){const e=r.normal,n=r.tangent,c=t.sub(l.pos),u=t.sub(h.pos),d=c.cross(e),p=u.cross(e),f=l.inverseMass+h.inverseMass+l.inverseInertia*d*d+h.inverseInertia*p*p,g=c.cross(n),m=u.cross(n),_=l.inverseMass+h.inverseMass+l.inverseInertia*g*g+h.inverseInertia*m*m;o[a]&&(null===(s=null===(i=o[a])||void 0===i?void 0:i.point)||void 0===s?void 0:s.squareDistance(t))<4?(o[a].point=t,o[a].local=r.localPoints[a]):o[a]=new Bn(t,r.localPoints[a],r),o[a].aToContact=c,o[a].bToContact=u,o[a].normalMass=f,o[a].tangentMass=_,a++}this.idToContactConstraint.set(r.id,o)}for(const t of n)this.idToContactConstraint.delete(t);if(Li.warmStart)this.warmStart(t);else for(const e of t){const t=this.getContactConstraints(e.id);for(const e of t)e.normalImpulse=0,e.tangentImpulse=0}}postSolve(t){for(const e of t){const t=e.colliderA.owner.get(ps),i=e.colliderB.owner.get(ps);if(t&&i){if(t.collisionType===Ei.Passive||i.collisionType===Ei.Passive)continue;t.updateMotion(),i.updateMotion()}const s=A.fromDirection(e.mtv);e.colliderA.events.emit("postcollision",new Jt(e.colliderA,e.colliderB,s,e.mtv)),e.colliderA.events.emit("aftercollisionresolve",new se(e.colliderA,e.colliderB,s,e.mtv,e)),e.colliderB.events.emit("postcollision",new Jt(e.colliderB,e.colliderA,A.getOpposite(s),e.mtv.negate())),e.colliderB.events.emit("aftercollisionresolve",new se(e.colliderB,e.colliderA,A.getOpposite(s),e.mtv.negate(),e))}this.lastFrameContacts.clear();for(const e of t)this.lastFrameContacts.set(e.id,e)}warmStart(t){var e,i,s;for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){const e=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const i of e)if(Li.warmStart){const e=n.normal.scale(i.normalImpulse),s=n.tangent.scale(i.tangentImpulse),o=e.add(s);t.applyImpulse(i.point,o.negate()),r.applyImpulse(i.point,o)}else i.normalImpulse=0,i.tangentImpulse=0}}}solvePosition(t){var e,i,s;for(let n=0;n<Li.positionIterations;n++)for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){if(t.collisionType===Ei.Passive||r.collisionType===Ei.Passive)continue;const e=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const i of e){const e=n.normal,s=ns.FindContactSeparation(n,i.local),o=-5,a=N(Li.steeringFactor*(s+Li.slop),o,0),l=e.scale(-a/i.normalMass);t.collisionType===Ei.Active&&(t.pos=t.pos.add(l.negate().scale(t.inverseMass)),t.rotation-=i.aToContact.cross(l)*t.inverseInertia),r.collisionType===Ei.Active&&(r.pos=r.pos.add(l.scale(r.inverseMass)),r.rotation+=i.bToContact.cross(l)*r.inverseInertia)}}}}solveVelocity(t){var e,i,s;for(let n=0;n<Li.velocityIterations;n++)for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){if(t.collisionType===Ei.Passive||r.collisionType===Ei.Passive)continue;const e=t.bounciness*r.bounciness,i=Math.min(t.friction,r.friction),o=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const e of o){let s=-e.getRelativeVelocity().dot(n.tangent)/e.tangentMass;const o=i*e.normalImpulse,a=N(e.tangentImpulse+s,-o,o);s=a-e.tangentImpulse,e.tangentImpulse=a;const l=n.tangent.scale(s);t.applyImpulse(e.point,l.negate()),r.applyImpulse(e.point,l)}for(const i of o){let s=-(1+e)*i.getRelativeVelocity().dot(n.normal)/i.normalMass;const o=Math.max(i.normalImpulse+s,0);s=o-i.normalImpulse,i.normalImpulse=o;const a=n.normal.scale(s);t.applyImpulse(i.point,a.negate()),r.applyImpulse(i.point,a)}}}}}class zn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.motion","ex.collider"],this.systemType=yn.Update,this.priority=-1,this._realisticSolver=new Ln,this._arcadeSolver=new Mn,this._processor=new Yi,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._trackCollider=t=>this._processor.track(t),this._untrackCollider=t=>this._processor.untrack(t)}notify(t){if(bn(t)){const e=t.data.get(ls);e.$colliderAdded.subscribe(this._trackCollider),e.$colliderRemoved.subscribe(this._untrackCollider);const i=e.get();i&&this._processor.track(i)}else{const e=t.data.get(ls),i=e.get();e&&i&&this._processor.untrack(i)}}initialize(t){this._engine=t.engine}update(t,e){var i;if(!Li.enabled)return;let s=[];for(const e of t){const t=e.get(ls),n=null==t?void 0:t.get();t&&(null===(i=t.owner)||void 0===i?void 0:i.active)&&n&&(t.update(),n instanceof $i?s=s.concat(n.getColliders()):s.push(n))}this._processor.update(s);const n=this._processor.broadphase(s,e);this._currentFrameContacts.clear();let r=this._processor.narrowphase(n,this._engine.debug.stats.currFrame);r=this.getSolver().solve(r),r.forEach((t=>this._currentFrameContacts.set(t.id,t))),this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts)}getSolver(){return Li.collisionResolutionStrategy===Ai.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const t=e.colliderA,i=e.colliderB;t.events.emit("collisionstart",new ne(t,i,e)),t.events.emit("contactstart",new te(t,i,e)),i.events.emit("collisionstart",new ne(i,t,e)),i.events.emit("contactstart",new te(i,t,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const t=e.colliderA,i=e.colliderB;t.events.emit("collisionend",new re(t,i)),t.events.emit("contactend",new ee(t,i)),i.events.emit("collisionend",new re(i,t)),i.events.emit("contactend",new ee(i,t))}}}var On,Nn,Hn,Un,Wn,Vn;(Nn=On||(On={})).Forward="forward",Nn.Backward="backward",(Un=Hn||(Hn={})).End="end",Un.Loop="loop",Un.PingPong="pingpong",Un.Freeze="freeze";class Gn extends wt{constructor(t){var e,i;super(t),this.events=new pe,this.frames=[],this.strategy=Hn.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._direction=1,this._done=!1,this._playing=!0,this._reversed=!1,this.frames=t.frames,this.strategy=null!==(e=t.strategy)&&void 0!==e?e:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:null!==(i=t.frameDuration)&&void 0!==i?i:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new Gn({frames:this.frames.map((t=>({...t}))),frameDuration:this.frameDuration,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,s=Hn.Loop){const n=t.sprites.length-1,r=e.filter((t=>t<0||t>n));return r.length&&Gn._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${r.join(",")} no frame will be shown`),new Gn({frames:t.sprites.filter(((t,i)=>e.indexOf(i)>-1)).map((t=>({graphic:t,duration:i}))),strategy:s})}static toLegacyAnimation(t,e){const i=e.frames.map((t=>ke.toLegacySprite(t.graphic)));return new Fe({sprites:i,loop:e.strategy===Hn.Loop,freezeFrame:e.strategy===Hn.Freeze?i.length-1:void 0,speed:e.frameDuration,engine:t})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return this._reversed&&1===this._direction?On.Backward:On.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case Hn.End:case Hn.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;const e=this.frames[this._currentFrame];e&&!this._done&&(this._timeLeftInFrame=(null==e?void 0:e.duration)||this.frameDuration,this.events.emit("frame",e))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case Hn.Loop:e=(t+1)%this.frames.length,0===e&&this.events.emit("loop",this);break;case Hn.End:e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break;case Hn.Freeze:e=N(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break;case Hn.PingPong:t+this._direction>=this.frames.length&&(this._direction=-1,this.events.emit("loop",this)),t+this._direction<0&&(this._direction=1,this.events.emit("loop",this)),e=t+this._direction%this.frames.length}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",this.currentFrame)),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic.draw(t,e,i)}}Gn._LOGGER=y.getInstance();class jn extends wt{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new jn({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){let t=new D;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new D;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return t}_isAnimationOrGroup(t){return t instanceof Gn||t instanceof jn}tick(t,e){for(const i of this.members){const s=i.graphic;this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){const e=t.graphic;this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){for(const s of this.members)t.save(),t.translate(e,i),s.graphic.draw(t,s.pos.x,s.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}(Vn=Wn||(Wn={}))[Vn.Circle=0]="Circle",Vn[Vn.Rectangle=1]="Rectangle";class Xn extends ws{constructor(t,e,i,s,n,r,o,a,l,h){super(),this.position=new E(0,0),this.velocity=new E(0,0),this.acceleration=new E(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=I.White,this.endColor=I.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=I.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let c=t;if(c&&!(t instanceof Kn)){const u=t;c=u.emitter,e=u.life,i=u.opacity,n=u.endColor,s=u.beginColor,r=u.position,o=u.velocity,a=u.acceleration,l=u.startSize,h=u.endSize}this.emitter=c,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=n||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=(r||this.position).add(this.emitter.pos),this.velocity=o||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=l||0,this.endSize=h||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new Ui),this.addComponent(new xs((t=>this.draw(t)))),this.addComponent(this.graphics=new Ts),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=P(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(ke.fromLegacySprite(this.particleSprite))):(this.graphics.localBounds=D.fromDimension(this.particleSize,this.particleSize,E.Half),this.graphics.onPostDraw=t=>{t.save(),this.graphics.opacity=this.opacity;const e=this._currentColor.clone();e.a=1,t.debug.drawPoint(P(0,0),{color:e,size:this.particleSize}),t.restore()})}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=N(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=N(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=N(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=N(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=N(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=N(this.opacity,1e-4,1),this.focus){const t=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(t)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=P(1,1),this.graphics.opacity=this.opacity}draw(t){if(this.particleSprite)return this.particleSprite.opacity(this.opacity),void this.particleSprite.draw(t,0,0);t.save(),this._currentColor.a=N(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(0,0,this.particleSize,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}}class qn extends(Ee(Xn)){constructor(t,e,i,s,n,r,o,a,l,h){super(t,e,i,s,n,r,o,a,l,h)}}class Kn extends Zs{constructor(t){var e,i;super({width:null!==(e=t.width)&&void 0!==e?e:0,height:null!==(i=t.height)&&void 0!==i?i:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new E(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=I.White,this.endColor=I.White,this._og=null,this._sprite=null,this.emitterType=Wn.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1;const{x:s,y:n,pos:r,isEmitting:o,minVel:a,maxVel:l,acceleration:h,minAngle:c,maxAngle:u,emitRate:d,particleLife:p,opacity:f,fadeFlag:g,focus:m,focusAccel:_,startSize:y,endSize:v,minSize:w,maxSize:x,beginColor:b,endColor:S,particleSprite:C,emitterType:T,radius:A,particleRotationalVelocity:k,randomRotation:R,random:F}={...t};this.pos=null!=r?r:P(null!=s?s:0,null!=n?n:0),this.isEmitting=null!=o?o:this.isEmitting,this.minVel=null!=a?a:this.minVel,this.maxVel=null!=l?l:this.maxVel,this.acceleration=null!=h?h:this.acceleration,this.minAngle=null!=c?c:this.minAngle,this.maxAngle=null!=u?u:this.maxAngle,this.emitRate=null!=d?d:this.emitRate,this.particleLife=null!=p?p:this.particleLife,this.opacity=null!=f?f:this.opacity,this.fadeFlag=null!=g?g:this.fadeFlag,this.focus=null!=m?m:this.focus,this.focusAccel=null!=_?_:this.focusAccel,this.startSize=null!=y?y:this.startSize,this.endSize=null!=v?v:this.endSize,this.minSize=null!=w?w:this.minSize,this.maxSize=null!=x?x:this.maxSize,this.beginColor=null!=b?b:this.beginColor,this.endColor=null!=S?S:this.endColor,this.particleSprite=null!=C?C:this.particleSprite,this.emitterType=null!=T?T:this.emitterType,this.radius=null!=A?A:this.radius,this.particleRotationalVelocity=null!=k?k:this.particleRotationalVelocity,this.randomRotation=null!=R?R:this.randomRotation,this.body.collisionType=Ei.PreventCollision,this.random=null!=F?F:new B;for(let t=0;t<this.traits.length;t++)this.traits[t]instanceof gs&&this.traits.splice(t,1)}get opacity(){return super.graphics.opacity}set opacity(t){super.graphics.opacity=t}get particleSprite(){return this._og}set particleSprite(t){this._og=t,t&&(this._sprite=ke.fromLegacySprite(t))}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let i=0;i<t;i++){const t=this._createParticle();this.particles.push(t),(null===(e=null==this?void 0:this.scene)||void 0===e?void 0:e.world)&&this.scene.world.add(t)}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const i=G(this.minAngle,this.maxAngle,this.random),s=G(this.minVel,this.maxVel,this.random),n=this.startSize||G(this.minSize,this.maxSize,this.random),r=s*Math.cos(i),o=s*Math.sin(i);if(this.emitterType===Wn.Rectangle)t=G(0,this.width,this.random),e=G(0,this.height,this.random);else if(this.emitterType===Wn.Circle){const s=G(0,this.radius,this.random);t=s*Math.cos(i),e=s*Math.sin(i)}const a=new qn(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new E(t,e),new E(r,o),this.acceleration,this.startSize,this.endSize);return a.fadeFlag=this.fadeFlag,a.particleSize=n,this.particleSprite&&(a.particleSprite=this.particleSprite,a.graphics.opacity=this.opacity,a.graphics.use(this._sprite)),a.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(a.currentRotation=G(0,2*Math.PI,this.random)),this.focus&&(a.focus=this.focus.add(new E(this.pos.x,this.pos.y)),a.focusAccel=this.focusAccel),a}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let t=0;t<this.deadParticles.length;t++)it(this.deadParticles[t],this.particles),(null===(i=null==this?void 0:this.scene)||void 0===i?void 0:i.world)&&this.scene.world.remove(this.deadParticles[t],!1);this.deadParticles.length=0}draw(t){this.particles.forEach((e=>e.draw(t)))}debugDraw(t){super.debugDraw(t),t.fillStyle=I.Black.toString(),t.fillText("Particles: "+this.particles.length,this.pos.x,this.pos.y+20),this.focus&&(t.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),_i(t,I.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,this.center.x,this.center.y),t.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))}}class Yn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=yn.Draw,this.priority=0,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}get sortedTransforms(){return this._sortedTransforms}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine}preupdate(){this._zHasChanged&&(this._sortedTransforms.sort(((t,e)=>t.z-e.z)),this._zHasChanged=!1)}notify(t){if(bn(t)){const e=t.data.get(Ui);this._sortedTransforms.push(e),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(Ui);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&this._sortedTransforms.splice(i,1)}}update(t,e){let i;this._token++,this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const t of this._sortedTransforms){const s=t.owner;if(s.hasTag("ex.offscreen"))continue;if(i=s.get(Ts),!i.visible)continue;t.coordPlane===Mi.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),i.update(e,this._token),this._applyTransform(s),i.onPreDraw&&i.onPreDraw(this._graphicsContext,e);const n=s instanceof qn?s.opacity:1;this._graphicsContext.opacity=i.opacity*n,this._drawGraphicsComponent(i),i.onPostDraw&&i.onPostDraw(this._graphicsContext,e),this._graphicsContext.restore(),t.coordPlane===Mi.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}this._graphicsContext.restore()}_drawGraphicsComponent(t){var e,i;if(t.visible)for(const s of t.layers.get())for(const{graphic:n,options:r}of s.graphics){let o=t.anchor,a=t.offset;(null==r?void 0:r.anchor)&&(o=r.anchor),(null==r?void 0:r.offset)&&(a=r.offset);const l=-n.width*o.x+a.x,h=-n.height*o.y+a.y;if(null==n||n.draw(this._graphicsContext,l+s.offset.x,h+s.offset.y),(null===(e=this._engine)||void 0===e?void 0:e.isDebug)&&this._engine.debug.graphics.showBounds){const t=P(l+s.offset.x,h+s.offset.y);if(n instanceof jn)for(const e of n.members)null===(i=e.graphic)||void 0===i||i.localBounds.translate(t.add(e.pos)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor);else null==n||n.localBounds.translate(t).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._graphicsContext.translate(e.pos.x,e.pos.y),this._graphicsContext.scale(e.scale.x,e.scale.y),this._graphicsContext.rotate(e.rotation))}}}class Qn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.canvas"],this.systemType=yn.Draw,this.priority=-1}initialize(t){this._ctx=t.engine.ctx,this._engine=t.engine,this._camera=t.camera}sort(t,e){return t.get(Ui).z-e.get(Ui).z}update(t,e){var i,s,n;let r,o;this._clearScreen();const a=t.length;for(let l=0;l<a;l++){const a=null===(n=null===(s=null===(i=t[l])||void 0===i?void 0:i.graphics)||void 0===s?void 0:s.visible)||void 0===n||n,h=t[l].isOffScreen;a&&!h&&(r=t[l].get(Ui),o=t[l].get(xs),this._ctx.save(),this._pushCameraTransform(r),this._ctx.save(),this._applyTransform(t[l]),o.draw(this._ctx,e),this._ctx.restore(),this._popCameraTransform(r),this._ctx.restore()),this._engine.isDebug&&(this._ctx.save(),this._pushCameraTransform(r),this._ctx.strokeStyle="yellow",t[l].debugDraw(this._ctx),this._popCameraTransform(r),this._ctx.restore())}this._engine.isDebug&&(this._ctx.save(),this._camera.draw(this._ctx),this._camera.debugDraw(this._ctx),this._ctx.restore()),this._engine.stats.currFrame.graphics.drawnImages=ti.DrawnImagesCount,this._engine.stats.currFrame.graphics.drawCalls=ti.DrawCallCount}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._ctx.translate(e.pos.x,e.pos.y),this._ctx.rotate(e.rotation),this._ctx.scale(e.scale.x,e.scale.y))}}_clearScreen(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle=this._engine.backgroundColor.toString(),this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}_pushCameraTransform(t){t.coordPlane===Mi.World&&(this._ctx.save(),this._camera&&this._camera.draw(this._ctx))}_popCameraTransform(t){t.coordPlane===Mi.World&&this._ctx.restore()}}class $n extends wn{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=yn.Draw,this.priority=999}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine,this._collisionSystem=t.world.systemManager.get(zn)}update(t,e){var i,s;if(!this._engine.isDebug)return;const n=this._engine.debug.filter;let r,o;const a=this._engine.debug.entity;let l;const h=this._engine.debug.transform;let c;const u=this._engine.debug.motion;let d;const p=this._engine.debug.collider,f=this._engine.debug.physics;let g;const m=this._engine.debug.graphics;let _,y;const v=this._engine.debug.body,w=this._engine.debug.camera;for(const e of t){if(e.hasTag("offscreen"))continue;if(e instanceof qn)continue;if(n.useFilter){if(0!==n.ids.length&&!n.ids.includes(e.id))continue;if(""!==n.nameQuery&&!e.name.includes(n.nameQuery))continue}let t=E.Zero;const f=P(0,16);if(r=e.id,o=e.name,l=e.get(Ui),this._pushCameraTransform(l),this._graphicsContext.save(),this._applyTransform(e),l&&((h.showAll||h.showPosition)&&this._graphicsContext.debug.drawPoint(E.Zero,{size:4,color:h.positionColor}),(h.showAll||h.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${l.pos.toString(2)}`,t),t=t.add(f)),(h.showAll||h.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${l.z.toFixed(1)})`,t),t=t.add(f)),(a.showAll||a.showId)&&(this._graphicsContext.debug.drawText(`id(${r}) ${l.parent?"child of id("+(null===(s=null===(i=l.parent)||void 0===i?void 0:i.owner)||void 0===s?void 0:s.id)+")":""}`,t),t=t.add(f)),(a.showAll||a.showName)&&(this._graphicsContext.debug.drawText(`name(${o})`,t),t=t.add(f)),(h.showAll||h.showRotation)&&(this._graphicsContext.drawLine(E.Zero,E.fromAngle(l.rotation).scale(50).add(E.Zero),h.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${U(l.rotation).toFixed(2)})`,t),t=t.add(f)),(h.showAll||h.showScale)&&this._graphicsContext.drawLine(E.Zero,l.scale.add(E.Zero),h.scaleColor,2)),g=e.get(Ts),g&&(m.showAll||m.showBounds)&&g.localBounds.draw(this._graphicsContext,m.boundsColor),_=e.get(en),_&&(_.useTransform||this._graphicsContext.restore(),_.draw(this._graphicsContext),_.useTransform||(this._graphicsContext.save(),this._applyTransform(e))),y=e.get(ps),y&&((v.showAll||v.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${y.group.name})`,t),t=t.add(f)),(v.showAll||v.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${y.collisionType})`,t),t=t.add(f)),(v.showAll||v.showMass)&&(this._graphicsContext.debug.drawText(`mass(${y.mass})`,t),t=t.add(f)),(v.showAll||v.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${y.sleepMotion})`,t),t=t.add(f)),(v.showAll||v.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${y.canSleep?y.sleeping:"cant sleep"})`,t),t=t.add(f))),this._graphicsContext.restore(),c=e.get(Wi),c&&((u.showAll||u.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${c.vel.toString(2)}`,t.add(l.globalPos)),this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(c.vel),u.velocityColor,2),t=t.add(f)),(u.showAll||u.showAcceleration)&&this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(c.acc),u.accelerationColor,2)),d=e.get(ls),d){const t=d.get();if((p.showAll||p.showGeometry)&&t&&t.debug(this._graphicsContext,p.geometryColor),p.showAll||p.showBounds)if(t instanceof $i){const e=t.getColliders();for(const t of e){const e=t.bounds,i=P(e.left,e.top);this._graphicsContext.debug.drawRect(i.x,i.y,e.width,e.height,{color:p.boundsColor}),(p.showAll||p.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${t.owner.id})`,i)}d.bounds.draw(this._graphicsContext,p.boundsColor)}else if(t){const t=d.bounds,e=P(t.left,t.top);this._graphicsContext.debug.drawRect(e.x,e.y,t.width,t.height,{color:p.boundsColor}),(p.showAll||p.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${d.owner.id})`,e)}}this._popCameraTransform(l)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(f.showAll||f.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),f.showAll||f.showCollisionContacts||f.showCollisionNormals)for(const[t,e]of this._engine.debug.stats.currFrame.physics.contacts){if(f.showAll||f.showCollisionContacts)for(const t of e.points)this._graphicsContext.debug.drawPoint(t,{size:5,color:f.collisionContactColor});if(f.showAll||f.showCollisionNormals)for(const t of e.points)this._graphicsContext.debug.drawLine(t,e.normal.scale(30).add(t),{color:f.collisionNormalColor})}this._graphicsContext.restore(),w&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(w.showAll||w.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,w.focusColor),(w.showAll||w.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._graphicsContext.translate(e.pos.x,e.pos.y),this._graphicsContext.scale(e.scale.x,e.scale.y),this._graphicsContext.rotate(e.rotation))}}_pushCameraTransform(t){t.coordPlane===Mi.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===Mi.World&&this._graphicsContext.restore()}}class Zn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.pointer"],this.systemType=yn.Update,this.priority=-1,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}initialize(t){this._engine=t.engine,this._receiver=this._engine.input.pointers}preupdate(){this._zHasChanged&&(this._sortedTransforms.sort(((t,e)=>e.z-t.z)),this._sortedEntities=this._sortedTransforms.map((t=>t.owner)),this._zHasChanged=!1)}notify(t){if(bn(t)){const e=t.data.get(Ui);this._sortedTransforms.push(e),this._sortedEntities.push(e.owner),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(Ui);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&(this._sortedTransforms.splice(i,1),this._sortedEntities.splice(i,1))}}entityCurrentlyUnderPointer(t,e){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(e)}entityWasUnderPointer(t,e){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(e)}entered(t,e){return this.entityCurrentlyUnderPointer(t,e)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,e){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,e)}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id))return void this.currentFrameEntityToPointers.set(t.id,[e]);const i=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,i.concat(e))}update(t){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receiver.update(),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receiver.clear()}_processPointerToEntity(t){var e;let i,s,n,r;for(const o of t){if(i=o.get(Ui),r=null!==(e=o.get(As))&&void 0!==e?e:new As,s=o.get(ls),s&&(r.useColliderShape||this.overrideUseColliderShape)){const t=s.get();if(t)for(const[e,s]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===Mi.World?s.worldPos:s.screenPos)&&this.addPointerToEntity(o,e)}if(n=o.get(Ts),n&&(r.useGraphicsBounds||this.overrideUseGraphicsBounds)){const t=n.localBounds.transform(i.getGlobalMatrix());for(const[e,s]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===Mi.World?s.worldPos:s.screenPos)&&this.addPointerToEntity(o,e)}}}_processDownAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameDown)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerdown",i),this._receiver.isDragStart(i.pointerId)&&t.events.emit("pointerdragstart",i)),e.set(i.pointerId,i);return e}_processUpAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameUp)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerup",i),this._receiver.isDragEnd(i.pointerId)&&t.events.emit("pointerdragend",i)),e.set(i.pointerId,i);return e}_processMoveAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameMove)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointermove",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragmove",i)),e.set(i.pointerId,i);return e}_processEnterLeaveAndEmit(t,e){for(const i of e){if(i.active&&t.active&&this.entered(t,i.pointerId)){t.events.emit("pointerenter",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragenter",i);break}if(i.active&&t.active&&(this.left(t,i.pointerId)||this.entityCurrentlyUnderPointer(t,i.pointerId)&&"up"===i.type)){t.events.emit("pointerleave",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragleave",i);break}}}_processCancelAndEmit(t){for(const e of this._receiver.currentFrameCancel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,e.pointerId)&&t.events.emit("pointercancel",e)}_processWheelAndEmit(t){for(const e of this._receiver.currentFrameWheel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",e)}_dispatchEvents(t){const e=new Set(this.lastFrameEntityToPointers.keys()),i=new Set(this.currentFrameEntityToPointers.keys()),s=t.filter((t=>e.has(t.id)||i.has(t.id)));let n,r,o;for(const t of s){o=this._processDownAndEmit(t),r=this._processUpAndEmit(t),n=this._processMoveAndEmit(t);const e=[...n.values(),...o.values(),...r.values()];this._processEnterLeaveAndEmit(t,e),this._processCancelAndEmit(t),this._processWheelAndEmit(t)}}}class Jn extends wn{constructor(){super(...arguments),this.types=["ex.actions"],this.systemType=yn.Update,this.priority=-1,this._actions=[]}notify(t){if(bn(t)){const e=t.data.get(Ks);this._actions.push(e)}else{const e=t.data.get(Ks),i=this._actions.indexOf(e);i>-1&&this._actions.splice(i,1)}}update(t,e){for(const t of this._actions)t.update(e)}}class tr extends Oi{constructor(t){super(),this.type="ex.isometricentity",this.elevation=0,this.map=t}}class er extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.isometricentity"],this.systemType=yn.Update,this.priority=99}update(t,e){let i,s;for(const e of t){i=e.get(Ui),s=e.get(tr);const t=Math.max(s.map.width*s.map.tileWidth,s.map.height*s.map.tileHeight)*s.elevation+i.pos.y;i.z=t}}}class ir extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=yn.Draw,this.priority=-1}initialize(t){this._camera=t.camera}update(t){let e,i;for(const s of t){i=s.get(Ts),e=s.get(Ui);const t=this._isOffscreen(e,i);t&&!s.hasTag("ex.offscreen")&&(s.eventDispatcher.emit("exitviewport",new he(s)),s.addTag("ex.offscreen")),!t&&s.hasTag("ex.offscreen")&&(s.eventDispatcher.emit("enterviewport",new ce(s)),s.removeTag("ex.offscreen"))}}_isOffscreen(t,e){if(t.coordPlane===Mi.World){const i=e.localBounds.transform(t.getGlobalMatrix());return!this._camera.viewport.overlaps(i)}return!1}}var sr,nr,rr,or,ar,lr,hr,cr,ur,dr,pr,fr,gr,mr,_r,yr,vr,wr,xr=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class br extends mi{constructor(){super(),this._logger=y.getInstance(),this.camera=new fn,this.world=new Rn(this),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(new Jn),this.world.add(new Fn),this.world.add(new zn),this.world.add(new Zn),this.world.add(new er),m.isEnabled(c.LegacyDrawing)?this.world.add(new Qn):(this.world.add(new ir),this.world.add(new Yn)),this.world.add(new $n)}get actors(){return this.world.entityManager.entities.filter((t=>t instanceof Zs))}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter((t=>t instanceof _n))}get tileMaps(){return this.world.entityManager.entities.filter((t=>t instanceof on))}get screenElements(){return this.actors.filter((t=>t instanceof Js))}get timers(){return this._timers}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t,e){}onDeactivate(t,e){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera._initialize(t),this.world.systemManager.initialize(),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new oe(t,this)),this._isInitialized=!0)}_activate(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)}_deactivate(t,e){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t,e)}_preupdate(t,e){this.emit("preupdate",new Ht(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Lt(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new zt(t,e,this)),this.onPostDraw(t,e)}update(t,e){let i,s;for(this._preupdate(t,e),i=0,s=this._cancelQueue.length;i<s;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(const t of this._timers)t.update(e);this.world.update(yn.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e)}draw(t,e){var i;this._predraw(t,e),this.world.update(yn.Draw,e),(null===(i=this.engine)||void 0===i?void 0:i.isDebug)&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new Ot(t,this)),this.emit("postdebugdraw",new Nt(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof tn&&(st(this._timers,t)||this.addTimer(t))}remove(t){t instanceof ws&&(this.emit("entityremoved",{target:t}),this.world.remove(t)),t instanceof tn&&this.removeTimer(t)}addScreenElement(t){this.add(t)}removeScreenElement(t){this.remove(t)}addTileMap(t){this.world.add(t)}removeTileMap(t){this.world.remove(t)}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return!!this.engine&&this.engine.currentScene===this}_collectActorStats(t){const e=this.actors.filter((t=>t instanceof Js));for(const i of e)t.stats.currFrame.actors.ui++;for(const e of this.actors){t.stats.currFrame.actors.alive++;for(const i of e.children)gn(i)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}xr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"ScreenElements now are normal actors with a Transform Coordinate Plane of Screen"})],br.prototype,"screenElements",null),xr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],br.prototype,"addScreenElement",null),xr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],br.prototype,"removeScreenElement",null),xr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],br.prototype,"addTileMap",null),xr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],br.prototype,"removeTileMap",null),(nr=sr||(sr={})).Protanope="Protanope",nr.Deuteranope="Deuteranope",nr.Tritanope="Tritanope";class Sr{constructor(t){this._shader=new $e({vertexSource:"\n      attribute vec2 a_position;\n      attribute vec2 a_texcoord;\n      varying vec2 v_texcoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_texcoord;\n      }",fragmentSource:t}),this._shader.compile(),this._buffer=new Ze({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class Cr{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new Sr("precision mediump float;\n// our texture\nuniform sampler2D u_image;\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texcoord;\n\n// color blind type\nuniform int u_type;\n\n// simulation?\nuniform bool u_simulate;\n\nvoid main() {\n  vec4 o =  texture2D(u_image, v_texcoord);\n  // RGB to LMS matrix conversion\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\n  // Simulate color blindness\n  float l;\n  float m;\n  float s;\n  //MODE CODE//\n  if (u_type == 0) {\n    // Protanope\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\n  } else if (u_type == 1) {\n    // Deuteranope\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\n  } else if (u_type == 2) {\n    // Tritanope\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\n  }\n\n  // LMS to RGB matrix conversion\n  vec4 error; // simulate the colors\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\n  error.a = 1.0;\n  vec4 diff = o - error;\n  vec4 correction; // correct the colors\n  correction.r = 0.0;\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\n  correction = o + correction;\n  correction.a = o.a;\n  //SIMULATE//\n\n  // sim \n  if (u_simulate) {\n    gl_FragColor = error.rgba;\n  } else {\n    gl_FragColor = correction.rgba;\n  }\n}"),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const t=this._shader.getShader();t.use(),this._colorBlindnessMode===sr.Protanope?t.setUniformInt("u_type",0):this._colorBlindnessMode===sr.Deuteranope?t.setUniformInt("u_type",1):this._colorBlindnessMode===sr.Tritanope&&t.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Tr{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Cr(sr.Protanope)}correct(t){this._engine.graphicsContext instanceof hi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof hi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Er{constructor(t){this.stats={currFrame:new Pr,prevFrame:new Pr},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!0,showName:!1},this.transform={showAll:!1,showPosition:!1,showPositionLabel:!1,positionColor:I.Yellow,showZIndex:!1,showScale:!1,scaleColor:I.Green,showRotation:!1,rotationColor:I.Blue},this.graphics={showAll:!1,showBounds:!0,boundsColor:I.Yellow},this.collider={showAll:!1,showBounds:!0,boundsColor:I.Blue,showOwner:!1,showGeometry:!0,geometryColor:I.Green},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:I.Cyan,showCollisionContacts:!0,collisionContactColor:I.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:I.Yellow,showAcceleration:!1,accelerationColor:I.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:I.Red,showZoom:!1},this._engine=t,this.colorBlindMode=new Tr(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class Pr{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Ar,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Pr;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Ar{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Ar;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}(or=rr||(rr={})).Canvas="Canvas",or.Document="Document",(lr=ar||(ar={})).Num0="Numpad0",lr.Num1="Numpad1",lr.Num2="Numpad2",lr.Num3="Numpad3",lr.Num4="Numpad4",lr.Num5="Numpad5",lr.Num6="Numpad6",lr.Num7="Numpad7",lr.Num8="Numpad8",lr.Num9="Numpad9",lr.NumAdd="NumpadAdd",lr.NumSubtract="NumpadSubtract",lr.NumMultiply="NumpadMultiply",lr.NumDivide="NumpadDivide",lr.NumDecimal="NumpadDecimal",lr.Numpad0="Numpad0",lr.Numpad1="Numpad1",lr.Numpad2="Numpad2",lr.Numpad3="Numpad3",lr.Numpad4="Numpad4",lr.Numpad5="Numpad5",lr.Numpad6="Numpad6",lr.Numpad7="Numpad7",lr.Numpad8="Numpad8",lr.Numpad9="Numpad9",lr.NumpadAdd="NumpadAdd",lr.NumpadSubtract="NumpadSubtract",lr.NumpadMultiply="NumpadMultiply",lr.NumpadDivide="NumpadDivide",lr.NumpadDecimal="NumpadDecimal",lr.NumLock="NumLock",lr.ShiftLeft="ShiftLeft",lr.ShiftRight="ShiftRight",lr.AltLeft="AltLeft",lr.AltRight="AltRight",lr.ControlLeft="ControlLeft",lr.ControlRight="ControlRight",lr.MetaLeft="MetaLeft",lr.MetaRight="MetaRight",lr.Key0="Digit0",lr.Key1="Digit1",lr.Key2="Digit2",lr.Key3="Digit3",lr.Key4="Digit4",lr.Key5="Digit5",lr.Key6="Digit6",lr.Key7="Digit7",lr.Key8="Digit8",lr.Key9="Digit9",lr.Digit0="Digit0",lr.Digit1="Digit1",lr.Digit2="Digit2",lr.Digit3="Digit3",lr.Digit4="Digit4",lr.Digit5="Digit5",lr.Digit6="Digit6",lr.Digit7="Digit7",lr.Digit8="Digit8",lr.Digit9="Digit9",lr.F1="F1",lr.F2="F2",lr.F3="F3",lr.F4="F4",lr.F5="F5",lr.F6="F6",lr.F7="F7",lr.F8="F8",lr.F9="F9",lr.F10="F10",lr.F11="F11",lr.F12="F12",lr.A="KeyA",lr.B="KeyB",lr.C="KeyC",lr.D="KeyD",lr.E="KeyE",lr.F="KeyF",lr.G="KeyG",lr.H="KeyH",lr.I="KeyI",lr.J="KeyJ",lr.K="KeyK",lr.L="KeyL",lr.M="KeyM",lr.N="KeyN",lr.O="KeyO",lr.P="KeyP",lr.Q="KeyQ",lr.R="KeyR",lr.S="KeyS",lr.T="KeyT",lr.U="KeyU",lr.V="KeyV",lr.W="KeyW",lr.X="KeyX",lr.Y="KeyY",lr.Z="KeyZ",lr.KeyA="KeyA",lr.KeyB="KeyB",lr.KeyC="KeyC",lr.KeyD="KeyD",lr.KeyE="KeyE",lr.KeyF="KeyF",lr.KeyG="KeyG",lr.KeyH="KeyH",lr.KeyI="KeyI",lr.KeyJ="KeyJ",lr.KeyK="KeyK",lr.KeyL="KeyL",lr.KeyM="KeyM",lr.KeyN="KeyN",lr.KeyO="KeyO",lr.KeyP="KeyP",lr.KeyQ="KeyQ",lr.KeyR="KeyR",lr.KeyS="KeyS",lr.KeyT="KeyT",lr.KeyU="KeyU",lr.KeyV="KeyV",lr.KeyW="KeyW",lr.KeyX="KeyX",lr.KeyY="KeyY",lr.KeyZ="KeyZ",lr.Semicolon="Semicolon",lr.Quote="Quote",lr.Comma="Comma",lr.Minus="Minus",lr.Period="Period",lr.Slash="Slash",lr.Equal="Equal",lr.BracketLeft="BracketLeft",lr.Backslash="Backslash",lr.BracketRight="BracketRight",lr.Backquote="Backquote",lr.Up="ArrowUp",lr.Down="ArrowDown",lr.Left="ArrowLeft",lr.Right="ArrowRight",lr.ArrowUp="ArrowUp",lr.ArrowDown="ArrowDown",lr.ArrowLeft="ArrowLeft",lr.ArrowRight="ArrowRight",lr.Space="Space",lr.Backspace="Backspace",lr.Delete="Delete",lr.Esc="Escape",lr.Escape="Escape",lr.Enter="Enter",lr.NumpadEnter="NumpadEnter",lr.ContextMenu="ContextMenu";class kr extends Rt{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class Rr extends mi{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[],this._handleKeyDown=t=>{const e=t.code;if(-1===this._keys.indexOf(e)){this._keys.push(e),this._keysDown.push(e);const i=new kr(e,t.key,t);this.eventDispatcher.emit("down",i),this.eventDispatcher.emit("press",i)}},this._handleKeyUp=t=>{const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new kr(e,t.key,t);this.eventDispatcher.emit("up",s),this.eventDispatcher.emit("release",s)}}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch(e){t=window,y.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",(()=>{this._keys.length=0})),t.addEventListener("keyup",this._handleKeyUp),t.addEventListener("keydown",this._handleKeyDown)}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new kr(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,e,i){"down"===t&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:null!=i?i:null})),"up"===t&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:null!=i?i:null}))}}class Ir extends mi{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter((t=>!0)).length,i=t.buttons.filter((t=>!0)).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(!t[e]){const t=this.at(e);t.connected&&this.eventDispatcher.emit("disconnect",new jt(e,t)),t.connected=!1;continue}if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new Gt(e,this.at(e))),this.at(e).connected=!0,t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;let i,s,n,r,o;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],hr)s=hr[i],"number"==typeof s&&t[e].buttons[s]&&(o=t[e].buttons[s].value,o!==this._oldPads[e].getButton(s)&&(t[e].buttons[s].pressed?(this.at(e).updateButton(s,o),this.at(e).eventDispatcher.emit("button",new Xt(s,o,this.at(e)))):this.at(e).updateButton(s,0)));for(n in ur)r=ur[n],"number"==typeof r&&(o=t[e].axes[r],o!==this._oldPads[e].getAxes(r)&&(this.at(e).updateAxes(r,o),this.at(e).eventDispatcher.emit("axis",new qt(r,o,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Fr),this._oldPads.push(new Fr);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter((t=>t.connected)).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new Fr;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}Ir.MinAxisMoveThreshold=.05;class Fr extends mi{constructor(){super(),this.connected=!1,this._buttons=new Array(16),this._axes=new Array(4);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}isButtonPressed(t,e=1){return this._buttons[t]>=e}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Ir.MinAxisMoveThreshold?0:e}updateButton(t,e){this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}(cr=hr||(hr={}))[cr.Face1=0]="Face1",cr[cr.Face2=1]="Face2",cr[cr.Face3=2]="Face3",cr[cr.Face4=3]="Face4",cr[cr.LeftBumper=4]="LeftBumper",cr[cr.RightBumper=5]="RightBumper",cr[cr.LeftTrigger=6]="LeftTrigger",cr[cr.RightTrigger=7]="RightTrigger",cr[cr.Select=8]="Select",cr[cr.Start=9]="Start",cr[cr.LeftStick=10]="LeftStick",cr[cr.RightStick=11]="RightStick",cr[cr.DpadUp=12]="DpadUp",cr[cr.DpadDown=13]="DpadDown",cr[cr.DpadLeft=14]="DpadLeft",cr[cr.DpadRight=15]="DpadRight",(dr=ur||(ur={}))[dr.LeftStickX=0]="LeftStickX",dr[dr.LeftStickY=1]="LeftStickY",dr[dr.RightStickX=2]="RightStickX",dr[dr.RightStickY=3]="RightStickY";class Dr{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class Mr{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new Dr(this._windowGlobal),this._documentComponent=new Dr(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class Br{constructor(t){this._ex=t,this._debugText=new qe}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~t:t,this._ex.snapToPixel?~~e:e,this._ex.snapToPixel?~~i:i,this._ex.snapToPixel?~~s:s),this._ex.__ctx.restore()}drawLine(t,e,i={color:I.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=i.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~e.x:e.x,this._ex.snapToPixel?~~e.y:e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:I.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y,e.size,0,2*Math.PI),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class Lr{constructor(t){this.backgroundColor=I.ExcaliburBlue,this._state=new _t,this.snapToPixel=!0,this.debug=new Br(this);const{canvasElement:e,enableTransparency:i,snapToPixel:s,smoothing:n,backgroundColor:r}=t;this.__ctx=e.getContext("2d",{alpha:null==i||i}),this.backgroundColor=null!=r?r:this.backgroundColor,this.snapToPixel=null!=s?s:this.snapToPixel,this.smoothing=null!=n?n:this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,s,n,r,o,a,l){if(0===s||0===n)return;if(0===a||0===l)return;if(0===t.width||0===t.height)return;this.__ctx.globalAlpha=this.opacity;const h=[t,e,i,s,n,r,o,a,l].filter((t=>void 0!==t)).map((t=>"number"==typeof t&&this.snapToPixel?~~t:t));this.__ctx.drawImage.apply(this.__ctx,h),ti.DrawCallCount++,ti.DrawnImagesCount=1}drawLine(t,e,i,s=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y),this.__ctx.lineTo(this.snapToPixel?~~e.x:e.x,this.snapToPixel?~~e.y:e.y),this.__ctx.lineWidth=s,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,s){this.__ctx.save(),this.__ctx.fillStyle=s.toString(),this.__ctx.fillRect(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y,this.snapToPixel?~~e:e,this.snapToPixel?~~i:i),this.__ctx.restore()}drawCircle(t,e,i,s,n){this.__ctx.save(),this.__ctx.beginPath(),s&&(this.__ctx.strokeStyle=s.toString()),n&&(this.__ctx.lineWidth=n),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y,e,0,2*Math.PI),this.__ctx.fill(),s&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){throw Error("Not implemented")}removePostProcessor(t){throw Error("Not implemented")}clearPostProcessors(){throw Error("Not implemented")}beginDrawLifecycle(){}endDrawLifecycle(){}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),ti.clear()}flush(){}}class zr{constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}static fromPagePosition(t,e,i){let s,n,r,o;3===arguments.length?(s=t,n=e,r=new E(s,n),o=i):(r=t,s=r.x,n=r.y,o=e);const a=o.screen.pageToScreenCoordinates(r),l=o.screen.screenToWorldCoordinates(a);return new zr(l,r,a)}}class Or{constructor(t,e,i,s,n,r){this.type=t,this.pointerId=e,this.button=i,this.pointerType=s,this.coordinates=n,this.nativeEvent=r,this.active=!0}cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}}class Nr{constructor(t,e,i,s,n,r,o,a,l,h,c,u){this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=n,this.screenY=r,this.index=o,this.deltaX=a,this.deltaY=l,this.deltaZ=h,this.deltaMode=c,this.ev=u,this.active=!0}cancel(){this.active=!1}}class Hr extends mi{constructor(){super(),this.lastPagePos=E.Zero,this.lastScreenPos=E.Zero,this.lastWorldPos=E.Zero,this._onPointerMove=t=>{this.lastPagePos=new E(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new E(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new E(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new E(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new E(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new E(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}}(fr=pr||(pr={})).Pixel="Pixel",fr.Line="Line",fr.Page="Page",(mr=gr||(gr={}))[mr.NoButton=-1]="NoButton",mr[mr.Left=0]="Left",mr[mr.Middle=1]="Middle",mr[mr.Right=2]="Right",mr[mr.Unknown=3]="Unknown",(yr=_r||(_r={})).Left="Left",yr.Middle="Middle",yr.Right="Right",yr.Unknown="Unknown",yr.NoButton="NoButton",(wr=vr||(vr={})).Touch="Touch",wr.Mouse="Mouse",wr.Pen="Pen",wr.Unknown="Unknown";class Ur extends mi{constructor(t,e){super(),this.target=t,this.engine=e,this.primary=new Hr,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new Hr);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return null!==(e=this.currentFramePointerDown.get(t))&&void 0!==e&&e}wasDown(t){var e;return null!==(e=this.lastFramePointerDown.get(t))&&void 0!==e&&e}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,s]of e)s===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(){this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const t={passive:!(this.engine.pageScrollPreventionMode===Xr.All||this.engine.pageScrollPreventionMode===Xr.Canvas)};"onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,t):void 0!==document.onmousewheel?this.target.addEventListener("mousewheel",this._boundWheel,t):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,t)}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):void 0!==document.onmousewheel?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const e=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort(((t,e)=>t-e)).findIndex((e=>e===t));return this._activeNativePointerIdsToNormalized.set(t,e),e}_handle(t){t.preventDefault();const e=new Map;let i,s;if(n=t,globalThis.TouchEvent&&n instanceof globalThis.TouchEvent){i=_r.Unknown,s=vr.Touch;for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],n=zr.fromPagePosition(s.pageX,s.pageY,this.engine),r=i+1,o=this._normalizePointerId(r);this.currentFramePointerCoords.set(o,n),e.set(o,n)}}else{i=this._nativeButtonToPointerButton(t.button),s=vr.Mouse;const n=zr.fromPagePosition(t.pageX,t.pageY,this.engine);let r=1;(function(t){return globalThis.PointerEvent&&t instanceof globalThis.PointerEvent})(t)&&(r=t.pointerId,s=this._stringToPointerType(t.pointerType));const o=this._normalizePointerId(r);this.currentFramePointerCoords.set(o,n),e.set(o,n)}var n;for(const[n,r]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Or("down",n,i,s,r,t)),this.currentFramePointerDown.set(n,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Or("up",n,i,s,r,t)),this.currentFramePointerDown.set(n,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Or("move",n,i,s,r,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Or("cancel",n,i,s,r,t))}}_handleWheel(t){(this.engine.pageScrollPreventionMode===Xr.All||this.engine.pageScrollPreventionMode===Xr.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(P(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),s=-.025,n=t.deltaX||t.wheelDeltaX*s||0,r=t.deltaY||t.wheelDeltaY*s||t.wheelDelta*s||t.detail||0,o=t.deltaZ||0;let a=pr.Pixel;t.deltaMode&&(1===t.deltaMode?a=pr.Line:2===t.deltaMode&&(a=pr.Page));const l=new Nr(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,n,r,o,a,t);this.currentFrameWheel.push(l)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const s=this.engine.currentScene.world.systemManager.get(Zn),n=this.engine.currentScene.world.queryManager.createQuery(s.types);s.update(n.getEntities())}_nativeButtonToPointerButton(t){switch(t){case gr.NoButton:return _r.NoButton;case gr.Left:return _r.Left;case gr.Middle:return _r.Middle;case gr.Right:return _r.Right;case gr.Unknown:return _r.Unknown;default:return at(t)}}_stringToPointerType(t){switch(t){case"touch":return vr.Touch;case"mouse":return vr.Mouse;case"pen":return vr.Pen;default:return vr.Unknown}}}class Wr{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=null!==(e=t.samplePeriod)&&void 0!==e?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=1e3*this._frames/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Vr{constructor(t){var e,i,s;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=null!==(e=this.now())&&void 0!==e?e:0,this._maxFps=null!==(i=t.maxFps)&&void 0!==i?i:this._maxFps,this._onFatalException=null!==(s=t.onFatalException)&&void 0!==s?s:this._onFatalException,this.fpsSampler=new Wr({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new jr({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Gr({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0){const i=this.now()+e;this._scheduledCbs.push([t,i])}_runScheduledCbs(){for(let t=this._scheduledCbs.length-1;t>-1;t--)this._scheduledCbs[t][1]<=this._totalElapsed&&(this._scheduledCbs[t][0](),this._scheduledCbs.splice(t,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const s=1e3/this._maxFps;if(i>=s){let n=0;0!==s&&(n=i%s,i-=n),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this._runScheduledCbs(),this.tick(t||i),this._lastTime=0!==s?e-n:e,this.fpsSampler.end()}}catch(t){this._onFatalException(t),this.stop()}}}class Gr extends Vr{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(t){throw window.cancelAnimationFrame(this._requestId),t}};t()}stop(){this._running=!1}}class jr extends Vr{constructor(t){super({...t}),this._logger=y.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return null!==(t=this._currentTime)&&void 0!==t?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=null!=t?t:this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(null!=e?e:this._updateMs)}}var Xr,qr,Kr=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};g(),(qr=Xr||(Xr={}))[qr.None=0]="None",qr[qr.Canvas=1]="Canvas",qr[qr.All=2]="All";class Yr extends mi{constructor(t){var e,i,s,n;super(),this.maxFps=Number.POSITIVE_INFINITY,this._hasStarted=!1,this.scenes={},this._animations=[],this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.debugColor=new I(255,255,255),this.enableCanvasTransparency=!0,this.onFatalException=t=>{y.getInstance().fatal(t)},this._timescale=1,this._isInitialized=!1,this._deferredGoTo=null,this._loadingComplete=!1,this._isReady=!1,this._isReadyPromise=new Promise((t=>{this._isReadyResolve=t})),this._screenShotRequests=[],t={...Yr._DEFAULT_ENGINE_OPTIONS,...t},m.freeze(),this.browser=new Mr(window,document);const r=new Ti;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=r.test())){const e=document.createElement("div");if(e.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(e),r.failedTests.forEach((function(t){const e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)})),t.canvasElementId){const e=document.getElementById(t.canvasElementId);e&&e.parentElement.removeChild(e)}return}this._compatible=!0,console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Mo})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=y.getInstance(),this._logger.defaultLevel===d.Debug&&r.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let o=null!==(e=t.displayMode)&&void 0!==e?e:ci.Fixed;if(t.width&&t.height||t.viewport?(void 0===t.displayMode&&(o=ci.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),o=ci.FitScreen),m.isEnabled(c.Canvas)){const e=new Lr({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}else{const e=new hi({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}this.screen=new pi({canvas:this.canvas,context:this.graphicsContext,antialiasing:null===(i=t.antialiasing)||void 0===i||i,browser:this.browser,viewport:null!==(s=t.viewport)&&void 0!==s?s:t.width&&t.height?{width:t.width,height:t.height}:di.SVGA,resolution:t.resolution,displayMode:o,position:t.position,pixelRatio:t.suppressHiDPIScaling?1:null}),Pt.filtering=t.antialiasing?ut.Blended:ut.Pixel,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=null!==(n=t.maxFps)&&void 0!==n?n:this.maxFps,this.clock=new Gr({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:t=>this.onFatalException(t)}),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new Si,this._loader.wireEngine(this),this.debug=new Er(this),this._initialize(t),this.rootScene=this.currentScene=new br,this.addScene("root",this.rootScene),window.___EXCALIBUR_DEVTOOL=this}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){t<=0?y.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t}playAnimation(t,e,i){this._animations.push(new Qr(t,e,i))}addTileMap(t){this.currentScene.addTileMap(t)}removeTileMap(t){this.currentScene.removeTileMap(t)}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof br)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]}add(t){2!==arguments.length?this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t):this.addScene(arguments[0],arguments[1])}remove(t){t instanceof ws&&this.currentScene.remove(t),t instanceof br&&this.removeScene(t),"string"==typeof t&&this.removeScene(t)}goToScene(t){if(this.isInitialized)if(this.scenes[t]){const e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.apply(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new le(i,this.currentScene))),this.currentScene=i,this.screen.setCurrentCamera(i.camera),this.currentScene._initialize(this),this.currentScene._activate.apply(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new ae(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!");else this._deferredGoTo=t}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){this.pageScrollPreventionMode=t.scrollPreventionMode;const e=t&&t.pointerScope===rr.Document?document:this.canvas;let i,s;this.input={keyboard:new Rr,pointers:new Ur(e,this),gamepads:new Ir},this.input.keyboard.init(),this.input.pointers.init(),this.input.gamepads.init(),void 0!==document.hidden?(i="hidden",s="visibilitychange"):"msHidden"in document?(i="msHidden",s="msvisibilitychange"):"webkitHidden"in document&&(i="webkitHidden",s="webkitvisibilitychange"),this.browser.document.on(s,(()=>{document[i]?(this.eventDispatcher.emit("hidden",new $t(this)),this._logger.debug("Window hidden")):(this.eventDispatcher.emit("visible",new Qt(this)),this._logger.debug("Window visible"))})),this.canvasElementId||t.canvasElement||document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0,this._deferredGoTo?this.goToScene(this._deferredGoTo):this.goToScene("root"))}_update(t){if(!this.ready)return this._loader.update(this,t),this.input.keyboard.update(),void this.input.gamepads.update();this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter((function(t){return!t.animation.isDone()})),this._postupdate(t),this.input.keyboard.update(),this.input.gamepads.update()}_preupdate(t){this.emit("preupdate",new Ht(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new Ut(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){const e=this.ctx;if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this._predraw(e,t),!this._isReady)return this._loader.canvas.draw(this.graphicsContext,0,0),void this.graphicsContext.flush();this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.ctx,t);let i=0;const s=this._animations.length;for(;i<s;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();const t=this.input.keyboard.getKeys();for(let e=0;e<t.length;e++)this.ctx.fillText(t[e].toString()+" : "+(ar[t[e]]?ar[t[e]]:"Not Mapped"),100,10*e+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}this._postdraw(e,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Lt(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new zt(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return this._loadingComplete}get ready(){return this._isReady}isReady(){return this._isReadyPromise}async start(t){if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");return t&&(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this)),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),t&&(await this.load(this._loader),this._loadingComplete=!0,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport()),this._loadingComplete=!0,this._overrideInitialize(this),this._isReady=!0,this._isReadyResolve(),this.emit("start",new Mt(this)),this._isReadyPromise}_mainloop(t){this.emit("preframe",new Wt(this,this.stats.prevFrame));const e=t*this.timescale,i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.delta=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,ti.clear();const s=this.clock.now();this._update(e);const n=this.clock.now();this._draw(e);const r=this.clock.now();this.stats.currFrame.duration.update=n-s,this.stats.currFrame.duration.draw=r-n,this.stats.currFrame.graphics.drawnImages=ti.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=ti.DrawCallCount,this.emit("postframe",new Vt(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame)}static createMainLoop(t,e,i){let s=i();const n=new Wr({nowFn:i,initialFps:t.maxFps===1/0?60:t.maxFps});return function r(){if(t._hasStarted)try{t._requestId=e(r),n.start(),t.emit("preframe",new Wt(t,t.stats.prevFrame));const o=i();let a=o-s||1;const l=t.maxFps===Number.POSITIVE_INFINITY?0:1e3/t.maxFps;if(a<=l)return;a>200&&(a=1);const h=a*t.timescale,c=t.stats.prevFrame.id+1;t.stats.currFrame.reset(),t.stats.currFrame.id=c,t.stats.currFrame.delta=h,t.stats.currFrame.fps=n.fps;const u=i();t._update(h);const d=i();t._draw(h);const p=i();t.stats.currFrame.duration.update=d-u,t.stats.currFrame.duration.draw=p-d,s=l>0?o-a%l:o,t.emit("postframe",new Vt(t,t.stats.currFrame)),n.end(),t.stats.prevFrame.reset(t.stats.currFrame)}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}}stop(){this.clock.isRunning()&&(this.emit("stop",new Bt(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isPaused(){return!this.clock.isRunning()}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise((e=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:e})}))}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,s=document.createElement("canvas");s.width=e,s.height=i,s.getContext("2d").drawImage(this.canvas,0,0,e,i);const n=new Image,r=s.toDataURL("image/png");n.src=r,t.resolve(n)}this._screenShotRequests.length=0}async load(t){try{await t.load()}catch(t){await Promise.resolve()}}}Yr._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:rr.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:Xr.Canvas,backgroundColor:I.fromHex("#2185d0")},Kr([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Actor.graphics"})],Yr.prototype,"playAnimation",null);let Qr=class{constructor(t,e,i){this.animation=t,this.x=e,this.y=i}};Qr=Kr([T({message:"Will be removed in excalibur v0.26.0"})],Qr);class $r extends Rt{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Zr extends $r{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Jr extends $r{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}var to=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class eo extends Zs{constructor(t){super(t),this._font=new Ys,this._text=new Qs({text:"",font:this._font}),this.letterSpacing=0,this.caseInsensitive=!0;const{text:e,pos:i,x:s,y:n,spriteFont:r,font:o,color:a}=t;this.pos=null!=i?i:s&&n?P(s,n):this.pos,this.text=null!=e?e:this.text,this.font=null!=o?o:this.font,this.spriteFont=null!=r?r:this.spriteFont,this._text.color=null!=a?a:this.color;const l=this.get(Ts);l.anchor=E.Zero,l.use(this._text)}get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get bold(){return this.font.bold}set bold(t){this.font.bold=t}get fontFamily(){return this.font.family}set fontFamily(t){this.font.family=t}get fontSize(){return this.font.size}set fontSize(t){this.font.size=t}get fontStyle(){return this.font.style}set fontStyle(t){this.font.style=t}get fontUnit(){return this.font.unit}set fontUnit(t){this.font.unit=t}get textAlign(){return this.font.textAlign}set textAlign(t){this.font.textAlign=t}get baseAlign(){return this.font.baseAlign}set baseAlign(t){this.font.baseAlign=t}get spriteFont(){return this._legacySpriteFont}set spriteFont(t){if(t){if(t instanceof Ge)return this._legacySpriteFont=t,this._spriteFont=Xe.fromLegacySpriteFont(t),void(this._text.font=this._spriteFont);this._spriteFont=t,this._text.font=this._spriteFont}}_initialize(t){super._initialize(t),this._graphicsContext=t.graphicsContext}getTextWidth(){return this._text.width}setTextShadow(t,e,i){this.font.shadow={offset:P(t,e),blur:2,color:i}}useTextShadow(t){this.spriteFont&&this.spriteFont.useTextShadow(t)}clearTextShadow(){this.font.shadow=null}draw(t,e){const i=this._graphicsContext;this._text.draw(i,0,0)}}to([T({message:"Label.bold will be removed in v0.26.0",alternateMethod:"Use Label.font.bold"})],eo.prototype,"bold",null),to([T({message:"Label.fontFamily will be removed in v0.26.0",alternateMethod:"Use Label.font.family"})],eo.prototype,"fontFamily",null),to([T({message:"Label.fontSize will be removed in v0.26.0",alternateMethod:"Use Label.font.size"})],eo.prototype,"fontSize",null),to([T({message:"Label.fontStyle will be removed in v0.26.0",alternateMethod:"Use Label.font.style"})],eo.prototype,"fontStyle",null),to([T({message:"Label.fontUnit will be removed in v0.26.0",alternateMethod:"Use Label.font.unit"})],eo.prototype,"fontUnit",null),to([T({message:"Label.textAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.textAlign"})],eo.prototype,"textAlign",null),to([T({message:"Label.baseAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.baseAlign"})],eo.prototype,"baseAlign",null),to([T({message:"Label.setTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"setTextShadow",null),to([T({message:"Label.useTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"useTextShadow",null),to([T({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"clearTextShadow",null);class io extends ws{constructor(t,e,i,s){super([new Ui,new Ts({offset:null!=i?i:E.Zero,onPostDraw:(t,e)=>this.draw(t,e)}),new tr(s)]),this.solid=!1,this._tileBounds=new D,this._graphics=[],this._colliders=[],this.x=t,this.y=e,this.map=s,this._transform=this.get(Ui),this._isometricEntityComponent=this.get(tr);const n=this.map.tileWidth/2,r=this.map.tileHeight/2,o=(this.x-this.y)*n,a=(this.x+this.y)*r;this._transform.pos=P(o,a),this._isometricEntityComponent.elevation=0,this._gfx=this.get(Ts),this._gfx.visible=!1;const l=this.map.tileWidth,h=this.map.tileHeight,c=P(0,this.map.renderFromTopOfGraphic?h:0);this._gfx.localBounds=this._tileBounds=new D({left:-l/2,top:-h,right:l/2,bottom:h}).translate(c)}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t),this._gfx.visible=!0,this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=P(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(P(this.x,this.y))}get center(){return this.pos.add(P(0,this.map.tileHeight/2))}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const e of this._graphics)e.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t.restore()}}class so extends ws{constructor(t){super([new Ui,new ps({type:Ei.Fixed}),new ls,new en((t=>this.debug(t)),!1)],t.name),this.renderFromTopOfGraphic=!1,this.graphicsOffset=P(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:s,width:n,height:r,renderFromTopOfGraphic:o,graphicsOffset:a}=t;this.transform=this.get(Ui),e&&(this.transform.pos=e),this.collider=this.get(ls),this.collider&&this.collider.set(this._composite=new $i([])),this.renderFromTopOfGraphic=null!=o?o:this.renderFromTopOfGraphic,this.graphicsOffset=null!=a?a:this.graphicsOffset,this.tileWidth=i,this.tileHeight=s,this.width=n,this.height=r,this.tiles=new Array(n*r);for(let t=0;t<r;t++)for(let e=0;e<n;e++){const i=new io(e,t,this.graphicsOffset,this);this.tiles[e+t*n]=i,this.addChild(i)}}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}updateColliders(){this._composite.clearColliders();for(const t of this.tiles)if(t.solid)for(const e of t.getColliders()){const i=this._getOrSetColliderOriginalOffset(e);e.offset=this.tileToWorld(P(t.x,t.y)).add(i).sub(P(this.tileWidth/2,this.tileHeight)),e.owner=this,this._composite.addCollider(e)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return P(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2;return P((t.x-t.y)*e,(t.x+t.y)*i).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.tiles[t+e*this.width]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}debug(t){for(let e=0;e<this.height+1;e++){const i=this.tileToWorld(P(0,e)),s=this.tileToWorld(P(this.width,e));t.drawLine(i,s,I.Red,2)}for(let e=0;e<this.width+1;e++){const i=this.tileToWorld(P(e,0)),s=this.tileToWorld(P(e,this.height));t.drawLine(i,s,I.Red,2)}for(const e of this.tiles)t.drawCircle(this.tileToWorld(P(e.x,e.y)),3,I.Yellow)}}class no{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const i=new Vi(t,this._CURRENT_BIT,void 0!==e?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}no._STARTING_BIT=1,no._MAX_GROUPS=32,no._CURRENT_GROUP=1,no._CURRENT_BIT=no._STARTING_BIT,no._GROUPS=new Map;let ro=class{constructor(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=E.Zero,this.offset=E.Zero,this.rotation=0,this.scale=E.One,this.opacity=1,this._points=t;const e=this._points.reduce(((t,e)=>Math.min(t,e.x)),0),i=this._points.reduce(((t,e)=>Math.max(t,e.x)),0);this.drawWidth=i-e;const s=this._points.reduce(((t,e)=>Math.min(t,e.y)),0),n=this._points.reduce(((t,e)=>Math.max(t,e.y)),0);this.drawHeight=n-s,this.height=this.drawHeight,this.width=this.drawWidth}addEffect(){}removeEffect(){}clearEffects(){}reset(){}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l,h;const{ctx:c,x:u,y:d,rotation:p,drawWidth:f,drawHeight:g,anchor:m,offset:_,opacity:y,flipHorizontal:v,flipVertical:w}={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:(null!==(l=t.opacity)&&void 0!==l?l:1)*(null!==(h=this.opacity)&&void 0!==h?h:1)},x=f*m.x+_.x+u,b=g*m.y+_.y+d;c.save(),c.translate(x,b),c.scale(this.scale.x,this.scale.y),c.rotate(p),c.beginPath(),c.lineWidth=this.lineWidth;const S=this._points[0];c.moveTo(S.x,S.y);let C=0;const T=this._points.length;for(;C<T;C++)c.lineTo(this._points[C].x,this._points[C].y);c.lineTo(S.x,S.y),c.closePath(),this.filled&&(c.fillStyle=this.fillColor.toString(),c.fill()),c.strokeStyle=this.lineColor.toString(),v&&(c.translate(f,0),c.scale(-1,1)),w&&(c.translate(0,g),c.scale(1,-1));const E=c.globalAlpha;c.globalAlpha=y,c.stroke(),c.globalAlpha=E,c.restore()}};ro=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([T({message:"Polygon will be removed in v0.26.0",alternateMethod:"Use Graphics.Polygon"})],ro);class oo{}function ao(t){return!!t._initialize}function lo(t){return!!t.onInitialize}function ho(t){return!!t._preupdate}function co(t){return!!t.onPreUpdate}function uo(t){return!!t.onPostUpdate}function po(t){return!!t.onPostUpdate}function fo(t){return!!t.onPreDraw}function go(t){return!!t.onPostDraw}oo.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class mo{constructor(t){this._src=t,this._volume=1,this._duration=void 0,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._audioContext=fi.create(),this._volumeNode=this._audioContext.createGain(),this._currentOffset=0,this._createNewBufferSource()}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())}get loop(){return this._loop}set volume(t){t=N(t,0,1),this._volume=t,this._isPlaying&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}set duration(t){this._duration=t}get duration(){return this._duration}get _playbackRate(){return this._instance?1/(this._instance.playbackRate.value||1):null}isPlaying(){return this._isPlaying}play(t=(()=>{})){return this._isPaused&&(this._resumePlayBack(),t()),this._isPlaying||(this._startPlayBack(),t()),this._playingPromise}pause(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1,this._instance.stop(0),this._setPauseOffset())}stop(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded())}_startPlayBack(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new Promise((t=>{this._playingResolve=t})),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._wireUpOnEnded()}_resumePlayBack(){if(!this._isPaused)return;this._isPaused=!1,this._isPlaying=!0,this._instance.onended=null,this._createNewBufferSource();const t=this._playbackRate*this._src.duration,e=this._currentOffset%t;this._rememberStartTime(-1e3*e),this._instance.start(0,e),this._wireUpOnEnded()}_wireUpOnEnded(){this.loop||(this._instance.onended=()=>this._handleOnEnded())}_handleOnEnded(){this._isPaused||(this._isPlaying=!1,this._playingResolve(!0))}_rememberStartTime(t){this._startTime=(new Date).getTime()+(0|t)}_setPauseOffset(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)}}function _o(t){try{const e=new Audio,i=/.*\.([A-Za-z0-9]+)(?:\?[0-9]+)$/,s=t.match(i)[1];return!!e.canPlayType("audio/"+s)}catch(t){return y.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}class yo extends mi{constructor(...t){super(),this.logger=y.getInstance(),this._loop=!1,this._volume=1,this._duration=void 0,this._isStopped=!1,this._isPaused=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._audioContext=fi.create(),this._resource=new fe("",oo.type.arraybuffer);for(const e of t)if(_o(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}set loop(t){this._loop=t;for(const t of this._tracks)t.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const t of this._tracks)t.volume=this._volume;this.emit("volumechange",new Zr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}isLoaded(){return!!this.data}async load(){if(this.data)return this.data;const t=await this._resource.load(),e=await this.decodeAudio(t.slice(0));return this._duration="object"==typeof e?e.duration:void 0,this.emit("processed",new Jr(this,e)),this.data=e}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch(t){return this.logger.error("Unable to decode audio"+this.path+" this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",(()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())})),this._engine.on("visible",(()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)})),this._engine.on("start",(()=>{this._isStopped=!1})),this._engine.on("stop",(()=>{this.stop(),this._isStopped=!0})))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some((t=>t.isPlaying()))}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this._isPaused=!0,this.emit("pause",new Zr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new Zr(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this._isPaused){const t=[];for(const e of this._tracks)t.push(e.play());this._isPaused=!1,this.emit("resume",new Zr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=await this._getTrackInstance(this.data),e=await t.play((()=>{this.emit("playbackstart",new Zr(this,t)),this.logger.debug("Playing new instance for sound",this.path)}));return this.emit("playbackend",new Zr(this,t)),this._tracks.splice(this.getTrackId(t),1),e}_getTrackInstance(t){const e=new mo(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,this._tracks.push(e),e}}class vo{constructor(t,e=I.Magenta,i=!0){this.path=t,this.color=e,this.bustCache=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new fe(t,"arraybuffer",i),this._transparentColor=e}async load(){const t=await this._resource.load();this._stream=new bo(t),this._gif=new So(this._stream,this._transparentColor);const e=this._gif.images.map((t=>new Re(t.src,!1)));return await Promise.all(e.map((t=>t.load()))),this.data=this._textures=e}isLoaded(){return!!this.data}toLegacySprite(t=0){return ke.toLegacySprite(this.toSprite(t))}toLegacySpriteSheet(){return je.toLegacySpriteSheet(this.toSpriteSheet())}toLegacyAnimation(t,e){return Gn.toLegacyAnimation(t,this.toAnimation(e))}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map((t=>t.toSprite()));return new je({sprites:t})}toAnimation(t){const e=this.toSpriteSheet(),i=e.sprites.length;return this._animation=Gn.fromSpriteSheet(e,V(0,i),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const wo=t=>t.reduce((function(t,e){return 2*t+e}),0),xo=t=>{const e=[];for(let i=7;i>=0;i--)e.push(!!(t&1<<i));return e};class bo{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=t=>{const e=[];for(let i=0;i<t;i++)e.push(this.readByte());return e},this.read=t=>{let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=()=>{const t=this.readBytes(2);return(t[1]<<8)+t[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,0===this.len)throw new Error("No data loaded from file")}}class So{constructor(t,e=I.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=t=>{const e=[];for(let i=0;i<t;i++){const t="#"+this._st.readBytes(3).map((t=>{const e=t.toString(16);return 1===e.length?"0"+e:e})).join("");e.push(t)}return e},this.readSubBlocks=()=>{let t,e;e="";do{t=this._st.readByte(),e+=this._st.read(t)}while(0!==t);return e},this.parseHeader=()=>{const t={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(t.sig=this._st.read(3),t.ver=this._st.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=xo(this._st.readByte());t.gctFlag=e.shift(),t.colorRes=wo(e.splice(0,3)),t.sorted=e.shift(),t.globalColorTableSize=wo(e.splice(0,3)),t.bgColor=this._st.readByte(),t.pixelAspectRatio=this._st.readByte(),t.gctFlag&&(t.globalColorTable=this.parseColorTable(1<<t.globalColorTableSize+1),this.globalColorTable=t.globalColorTable),this._handler.hdr&&this._handler.hdr(t)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=t=>{const e=t=>{this.checkBytes.push(this._st.readByte());const e=xo(this._st.readByte());t.reserved=e.splice(0,3),t.disposalMethod=wo(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=this._st.readUnsigned(),t.transparencyIndex=this._st.readByte(),t.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(t)&&this.checkBytes.push(this._handler.gce)},i=t=>{t.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(t)&&this.checkBytes.push(this._handler.com)},s=t=>{this.checkBytes.push(this._st.readByte()),t.ptHeader=this._st.readBytes(12),t.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(t)&&this.checkBytes.push(this._handler.pte)},n=t=>{const e=t=>{this.checkBytes.push(this._st.readByte()),t.unknown=this._st.readByte(),t.iterations=this._st.readUnsigned(),t.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(t)&&this.checkBytes.push(this._handler.app)},i=t=>{t.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[t.identifier]&&this._handler.app[t.identifier](t)&&this.checkBytes.push(this._handler.app[t.identifier])};this.checkBytes.push(this._st.readByte()),t.identifier=this._st.read(8),t.authCode=this._st.read(3),"NETSCAPE"===t.identifier?e(t):i(t)},r=t=>{t.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(t)&&this.checkBytes.push(this._handler.unknown)};switch(t.label=this._st.readByte(),t.label){case 249:t.extType="gce",e(t);break;case 254:t.extType="com",i(t);break;case 1:t.extType="pte",s(t);break;case 255:t.extType="app",n(t);break;default:t.extType="unknown",r(t)}},this.parseImg=t=>{t.leftPos=this._st.readUnsigned(),t.topPos=this._st.readUnsigned(),t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=xo(this._st.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=wo(e.splice(0,3)),t.lctFlag&&(t.lct=this.parseColorTable(1<<t.lctSize+1)),t.lzwMinCodeSize=this._st.readByte();const i=this.readSubBlocks();t.pixels=function(t,e){let i=0;const s=function(t){let s=0;for(let n=0;n<t;n++)e.charCodeAt(i>>3)&1<<(7&i)&&(s|=1<<n),i++;return s},n=[],r=1<<t,o=r+1;let a=t+1,l=[];const h=function(){l=[],a=t+1;for(let t=0;t<r;t++)l[t]=[t];l[r]=[],l[o]=null};let c,u;for(;;)if(u=c,c=s(a),c!==r){if(c===o)break;if(c<l.length)u!==r&&l.push(l[u].concat(l[c][0]));else{if(c!==l.length)throw new Error("Invalid LZW code.");l.push(l[u].concat(l[u][0]))}n.push.apply(n,l[c]),l.length===1<<a&&a<12&&a++}else h();return n}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=((t,e)=>{const i=new Array(t.length),s=t.length/e,n=(s,n)=>{const r=t.slice(n*e,(n+1)*e);i.splice.apply(i,[s*e,e].concat(r))},r=[0,4,2,1],o=[8,8,4,2];let a=0;for(let t=0;t<4;t++)for(let e=r[t];e<s;e+=o[t])n(e,a),a++;return i})(t.pixels,t.width)),this.frames.push(t),this.arrayToImage(t),this._handler.img&&this._handler.img(t)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const t={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",this.parseExt(t);break;case",":t.type="img",this.parseImg(t);break;case";":t.type="eof",this._handler.eof&&this._handler.eof(t)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&this.parseBlock()},this.arrayToImage=t=>{let e=0;const i=document.createElement("canvas");i.id=e.toString(),i.width=t.width,i.height=t.height,e++;const s=i.getContext("2d");let n=0,r=0;for(let e=0;e<t.pixels.length;e++)r%t.width==0&&(n++,r=0),this.globalColorTable[t.pixels[e]]===this._transparentColor.toHex()?s.fillStyle="rgba(0, 0, 0, 0)":s.fillStyle=this.globalColorTable[t.pixels[e]],s.fillRect(r,n,1,1),r++;const o=new Image;o.src=i.toDataURL(),this.images.push(o)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class Co extends At{constructor(t){super(t),this.points=t.points,this.filtering=ut.Blended,this.rasterize()}get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce(((t,e)=>Math.max(e.x,t)),0)-e.x,this.height=this._points.reduce(((t,e)=>Math.max(e.y,t)),0)-e.y,this.flagDirty()}get minPoint(){return P(this._points.reduce(((t,e)=>Math.min(e.x,t)),1/0),this._points.reduce(((t,e)=>Math.min(e.y,t)),1/0))}clone(){return new Co({points:this.points.map((t=>t.clone())),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach((i=>{t.lineTo(i.x+e.x,i.y+e.y)})),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}var To=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Eo=class{constructor(t){this._getComparable=t}find(t){return this._find(this._root,t)}_find(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))}get(t){return this._get(this._root,t)}_get(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)}add(t){return null==this._root?(this._root=new Po(this._getComparable(t),[t],null,null),!0):this._insert(this._root,t)}_insert(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?!(t.getData().indexOf(e)>-1||(t.getData().push(e),0)):this._getComparable(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new Po(this._getComparable(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new Po(this._getComparable(e),[e],null,null)),!0):this._insert(t.getRight(),e))}removeByComparable(t){this._root=this._remove(this._root,t)}_remove(t,e){if(null==t)return null;if(this._getComparable(e)!==t.getKey())return this._getComparable(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);{const i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return t}}return null}_cleanup(t,e){const i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return e.getKey()<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)}_findMinNode(t){let e=t;for(;null!=e.getLeft();)e=e.getLeft();return e}list(){const t=new Array;return this._list(this._root,t),t}_list(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach((t=>{e.push(t)})),this._list(t.getRight(),e))}};Eo=To([T({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use built in JS array.sort"})],Eo);let Po=class{constructor(t,e,i,s){this._key=t,this._data=e,this._left=i,this._right=s}getKey(){return this._key}setKey(t){this._key=t}getData(){return this._data}setData(t){this._data=t}getLeft(){return this._left}setLeft(t){this._left=t}getRight(){return this._right}setRight(t){this._right=t}};Po=To([T({message:"Will be removed in excalibur v0.26.0"})],Po);class Ao{constructor(t){this._key=0,this._key=t}getTheKey(){return this._key}setKey(t){this._key=t}}class ko{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this._logger=y.getInstance()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){t(this.get()),this.index--}get(...t){return this.index===this.maxObjects&&(this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=2*this.maxObjects),this.objects[this.index]?this.recycler(this.objects[this.index++],...t):(this.totalAllocations++,this.objects[this.index++]=this.builder(...t))}done(...t){this.index=0;for(const e of t){const t=this.objects.indexOf(e);this.objects[t]=this.builder(),this.totalAllocations++}return t}}var Ro,Io,Fo;(Fo=Io||(Io={}))[Fo.Resolved=0]="Resolved",Fo[Fo.Rejected=1]="Rejected",Fo[Fo.Pending=2]="Pending";let Do=Ro=class{constructor(){this._state=Io.Pending,this._successCallbacks=[],this._rejectCallback=()=>{}}static resolve(t){return(new Ro).resolve(t)}static reject(t){return(new Ro).reject(t)}static join(){let t=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(let e=0;e<arguments.length;e++)t[e-0]=arguments[e];else 1===arguments.length&&Array.isArray(arguments[0])&&(t=arguments[0]);const e=new Ro;if(!t||!t.length)return e.resolve();const i=t.length;let s=0,n=0;const r=[];return t.forEach((t=>{t.then((()=>{s+=1,s===i?e.resolve():s+n+r.length===i&&e.reject(r)}),(()=>{n+=1,s+n+r.length===i&&e.reject(r)})).error((t=>{r.push(t),r.length+s+n===i&&e.reject(r)}))})),e}then(t,e){if(t&&(this._successCallbacks.push(t),this.state()===Io.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===Io.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this}error(t){return t&&(this._errorCallback=t),this}resolve(t){if(this._state!==Io.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=Io.Resolved,this._successCallbacks.forEach((t=>{t.call(this,this._value)}))}catch(t){this._handleError(t)}return this}reject(t){if(this._state!==Io.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=Io.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this}state(){return this._state}_handleError(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)}};Do=Ro=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([T({message:"ex.Promises are being replaced by native browser promises in v0.26.0",alternateMethod:"Use browser native promises"})],Do);const Mo="0.26.0-alpha.151+483dc65";g()})(),s})()},t.exports=i()})),r.register("cT3l2",(function(i,s){t(i.exports,"Resources",(()=>Y)),t(i.exports,"FxTowerFlings",(()=>Q));var n=r("jgD1p"),o=r("9Vkbx"),a=r("3U3if"),l=r("k1AVX"),h=r("aWOwW"),c=r("6X9H5"),u=r("4Fd9l"),d=r("4MVJS"),p=r("hbAAn"),f=r("iE1AO"),g=r("7g0aJ"),m=r("1Exk9"),_=r("4FGQM"),y=r("6GYyZ"),v=r("jmdr1"),w=r("59mqK"),x=r("hVLKC"),b=r("1om6s"),S=r("3w74M"),C=r("1lfSk"),T=r("j37Ax"),E=r("3SmvG"),P=r("4f3Tk"),A=r("jvEiB"),k=r("lRgW7"),R=r("fHldL"),I=r("iIQPE"),F=r("xyj4g"),D=r("7isrs"),M=r("8qFTm"),B=r("dDqE6"),L=r("2aXFI"),z=r("5lqLr"),O=r("btmOw"),N=r("dmREU"),H=r("amrjb"),U=r("adShO"),W=r("650Gs"),V=r("6N34I"),G=r("kAnYs"),j=r("knQKN"),X=r("dVuAw"),q=r("gCA2h"),K=r("2RBdQ");const Y={Sword:new n.ImageSource(e(o)),Sand:new n.ImageSource(e(a),!1,n.ImageFiltering.Pixel),SandCastle:new n.ImageSource(e(l),!1,n.ImageFiltering.Pixel),SandCastleDamaged:new n.ImageSource(e(h),!1,n.ImageFiltering.Pixel),SandCastleDestroyed:new n.ImageSource(e(c),!1,n.ImageFiltering.Pixel),BaseTower:new n.ImageSource(e(p),!1,n.ImageFiltering.Pixel),BaseTowerBroken:new n.ImageSource(e(f),!1,n.ImageFiltering.Pixel),CatapultTower:new n.ImageSource(e(g),!1,n.ImageFiltering.Pixel),CatapultTowerLoaded:new n.ImageSource(e(_),!1,n.ImageFiltering.Pixel),CatapultTowerBroken:new n.ImageSource(e(m),!1,n.ImageFiltering.Pixel),BucketTower:new n.ImageSource(e(u),!1,n.ImageFiltering.Pixel),BucketTowerBroken:new n.ImageSource(e(d),!1,n.ImageFiltering.Pixel),Sandwall:new n.ImageSource(e(y),!1,n.ImageFiltering.Pixel),Water:new n.ImageSource(e(v),!1,n.ImageFiltering.Pixel),BucketSheet:new n.ImageSource(e(w),!1,n.ImageFiltering.Pixel),CompactedSand:new n.ImageSource(e(x),!1,n.ImageFiltering.Pixel),Beachball:new n.ImageSource(e(b),!1,n.ImageFiltering.Pixel),TurtleSheet:new n.ImageSource(e(S),!1,n.ImageFiltering.Pixel),CrabSheet:new n.ImageSource(e(C),!1,n.ImageFiltering.Pixel),SeagullSheet:new n.ImageSource(e(T),!1,n.ImageFiltering.Pixel),BottomBorder:new n.ImageSource(e(E),!1,n.ImageFiltering.Pixel),SideBorder:new n.ImageSource(e(P),!1,n.ImageFiltering.Pixel),Shield:new n.ImageSource(e(A),!1,n.ImageFiltering.Pixel),BlockedCursor:new n.ImageSource(e(k),!1,n.ImageFiltering.Pixel),Clank:new n.Sound(e(R)),BackgroundAmbiance:new n.Sound(e(I)),BackgroundMusic:new n.Sound(e(F)),FxWaveAppear:new n.Sound(e(D)),FxImpactEnemyBall:new n.Sound(e(M)),FxImpactTowerByEnemy:new n.Sound(e(B)),FxImpactCastleByEnemy:new n.Sound(e(L)),FxPlaceTower:new n.Sound(e(N)),FxHarvestTower:new n.Sound(e(O)),FxTowerFlings01:new n.Sound(e(H)),FxTowerFlings02:new n.Sound(e(U)),FxTowerFlings03:new n.Sound(e(W)),FxTowerFlings04:new n.Sound(e(V)),FxTowerFlings05:new n.Sound(e(G)),FxTowerFlings06:new n.Sound(e(j)),FxDeathGull:new n.Sound(e(q)),FxDeathCrabForCutie:new n.Sound(e(K)),FxDeathTurtle:new n.Sound(e(X)),UiPickTower:new n.Sound(e(z))},Q=[Y.FxTowerFlings01,Y.FxTowerFlings02,Y.FxTowerFlings03,Y.FxTowerFlings04,Y.FxTowerFlings05,Y.FxTowerFlings06]})),r.register("9Vkbx",(function(t,e){t.exports=new URL(r("27Lyk").resolve("93Bqc"),import.meta.url).toString()})),r.register("3U3if",(function(t,e){t.exports=new URL(r("27Lyk").resolve("1OAey"),import.meta.url).toString()})),r.register("k1AVX",(function(t,e){t.exports=new URL(r("27Lyk").resolve("5rmOr"),import.meta.url).toString()})),r.register("aWOwW",(function(t,e){t.exports=new URL(r("27Lyk").resolve("9WqmE"),import.meta.url).toString()})),r.register("6X9H5",(function(t,e){t.exports=new URL(r("27Lyk").resolve("19SBS"),import.meta.url).toString()})),r.register("4Fd9l",(function(t,e){t.exports=new URL(r("27Lyk").resolve("gQlT2"),import.meta.url).toString()})),r.register("4MVJS",(function(t,e){t.exports=new URL(r("27Lyk").resolve("auVjM"),import.meta.url).toString()})),r.register("hbAAn",(function(t,e){t.exports=new URL(r("27Lyk").resolve("hRuM7"),import.meta.url).toString()})),r.register("iE1AO",(function(t,e){t.exports=new URL(r("27Lyk").resolve("75r3y"),import.meta.url).toString()})),r.register("7g0aJ",(function(t,e){t.exports=new URL(r("27Lyk").resolve("lPda5"),import.meta.url).toString()})),r.register("1Exk9",(function(t,e){t.exports=new URL(r("27Lyk").resolve("7HMHc"),import.meta.url).toString()})),r.register("4FGQM",(function(t,e){t.exports=new URL(r("27Lyk").resolve("8x8B2"),import.meta.url).toString()})),r.register("6GYyZ",(function(t,e){t.exports=new URL(r("27Lyk").resolve("afO87"),import.meta.url).toString()})),r.register("jmdr1",(function(t,e){t.exports=new URL(r("27Lyk").resolve("cOMLy"),import.meta.url).toString()})),r.register("59mqK",(function(t,e){t.exports=new URL(r("27Lyk").resolve("6lBDw"),import.meta.url).toString()})),r.register("hVLKC",(function(t,e){t.exports=new URL(r("27Lyk").resolve("1busq"),import.meta.url).toString()})),r.register("1om6s",(function(t,e){t.exports=new URL(r("27Lyk").resolve("awm6k"),import.meta.url).toString()})),r.register("3w74M",(function(t,e){t.exports=new URL(r("27Lyk").resolve("dZKZi"),import.meta.url).toString()})),r.register("1lfSk",(function(t,e){t.exports=new URL(r("27Lyk").resolve("71OAl"),import.meta.url).toString()})),r.register("j37Ax",(function(t,e){t.exports=new URL(r("27Lyk").resolve("2fkyf"),import.meta.url).toString()})),r.register("3SmvG",(function(t,e){t.exports=new URL(r("27Lyk").resolve("e0iBh"),import.meta.url).toString()})),r.register("4f3Tk",(function(t,e){t.exports=new URL(r("27Lyk").resolve("fVEKR"),import.meta.url).toString()})),r.register("jvEiB",(function(t,e){t.exports=new URL(r("27Lyk").resolve("aUy19"),import.meta.url).toString()})),r.register("lRgW7",(function(t,e){t.exports=new URL(r("27Lyk").resolve("94wAw"),import.meta.url).toString()})),r.register("fHldL",(function(t,e){t.exports=new URL(r("27Lyk").resolve("lxy2T"),import.meta.url).toString()})),r.register("iIQPE",(function(t,e){t.exports=new URL(r("27Lyk").resolve("4mjPq"),import.meta.url).toString()})),r.register("xyj4g",(function(t,e){t.exports=new URL(r("27Lyk").resolve("f26Rk"),import.meta.url).toString()})),r.register("7isrs",(function(t,e){t.exports=new URL(r("27Lyk").resolve("bwBDW"),import.meta.url).toString()})),r.register("8qFTm",(function(t,e){t.exports=new URL(r("27Lyk").resolve("ekEOt"),import.meta.url).toString()})),r.register("dDqE6",(function(t,e){t.exports=new URL(r("27Lyk").resolve("3JmJy"),import.meta.url).toString()})),r.register("2aXFI",(function(t,e){t.exports=new URL(r("27Lyk").resolve("kcsGH"),import.meta.url).toString()})),r.register("5lqLr",(function(t,e){t.exports=new URL(r("27Lyk").resolve("uJMWc"),import.meta.url).toString()})),r.register("btmOw",(function(t,e){t.exports=new URL(r("27Lyk").resolve("cZMMR"),import.meta.url).toString()})),r.register("dmREU",(function(t,e){t.exports=new URL(r("27Lyk").resolve("3Wb9q"),import.meta.url).toString()})),r.register("amrjb",(function(t,e){t.exports=new URL(r("27Lyk").resolve("5IV6z"),import.meta.url).toString()})),r.register("adShO",(function(t,e){t.exports=new URL(r("27Lyk").resolve("259Q1"),import.meta.url).toString()})),r.register("650Gs",(function(t,e){t.exports=new URL(r("27Lyk").resolve("81n99"),import.meta.url).toString()})),r.register("6N34I",(function(t,e){t.exports=new URL(r("27Lyk").resolve("bcEwN"),import.meta.url).toString()})),r.register("kAnYs",(function(t,e){t.exports=new URL(r("27Lyk").resolve("9pOd6"),import.meta.url).toString()})),r.register("knQKN",(function(t,e){t.exports=new URL(r("27Lyk").resolve("3bwcs"),import.meta.url).toString()})),r.register("dVuAw",(function(t,e){t.exports=new URL(r("27Lyk").resolve("0548S"),import.meta.url).toString()})),r.register("gCA2h",(function(t,e){t.exports=new URL(r("27Lyk").resolve("iXkR6"),import.meta.url).toString()})),r.register("2RBdQ",(function(t,e){t.exports=new URL(r("27Lyk").resolve("gcjhn"),import.meta.url).toString()})),r.register("3HlYA",(function(e,i){t(e.exports,"Tower",(()=>d)),t(e.exports,"TowerType",(()=>p));var s=r("3OncY"),n=r("jgD1p"),o=r("1Raww"),a=r("f836V"),l=r("cTIIG"),h=r("4TY6b"),c=r("cT3l2");s=r("3OncY");const u=new n.Random(s.default.Seed);class d extends n.Actor{healthBarOpacity=1;healthBarOpacityFade=3;constructor(t,e,i,r){super({name:"Base Tower",pos:e.tileMap.getTile(i,r).pos.add(n.vec(s.default.grid.tileWidth/2,s.default.grid.tileHeight/2)),width:s.default.grid.tileWidth,height:s.default.grid.tileHeight,collisionType:n.CollisionType.Fixed,collisionGroup:n.CollisionGroup.collidesWith([o.Enemy.CollisionGroupGround]),color:s.default.tower[t].color,z:s.default.z.towers}),this._grid=e,this._tile=e.tileMap.getTile(i,r),this.row=this._grid.tileMap.getRows()[r],this.type=t,this.maxHealth=s.default.tower[this.type].maxHealth,this.currentHp=this.maxHealth,this.cost=s.default.tower[this.type].cost;const a=s.default.tower[this.type].sprite?.toSprite();a&&this.graphics.use(a),this.beachball=c.Resources.Beachball.toSprite(),this.beachball.scale=n.vec(.5,.5),this.sand=c.Resources.CompactedSand.toSprite(),this.bucketSheet=n.SpriteSheet.fromImageSource({image:c.Resources.BucketSheet,grid:{spriteWidth:64,spriteHeight:64,rows:1,columns:9}}),this.bucketLoadingFrames=4,this.bucketGlow=n.Animation.fromSpriteSheet(this.bucketSheet,n.range(5,8),200,n.AnimationStrategy.Loop),this.healthBar=new l.Healthbar(this.maxHealth),this.addChild(this.healthBar),this.on("kill",(t=>this.onKill(t))),this.on("pointerdown",(t=>this.onClick(t)))}onInitialize(t){this._engine=t}hasEnemyToFireOn(){return null!=this.row.find((t=>o.Enemy.enemiesInTile(t)>0))}setSprite(){if(this.readyToFire()){const t=s.default.tower[this.type].spriteReady?.toSprite();t&&this.graphics.use(t)}else{const t=s.default.tower[this.type].sprite?.toSprite();t&&this.graphics.use(t)}}readyToFire(){return this._currentFireTimer<=0}_currentFireTimer=0;_resourceTimer=0;_resourceAvailable=!1;onPostUpdate(t,e){if(this._resourceTimer+=e/1e3,this._currentFireTimer-=e,this.isResourceType()){if(this._resourceTimer<=s.default.tower[this.type].resourceSpawnTimer&&!this._resourceAvailable){const t=this._resourceTimer/s.default.tower[this.type].resourceSpawnTimer,e=Math.floor(t*this.bucketLoadingFrames),i=this.bucketSheet.getSprite(e,0);i&&this.graphics.use(i)}this._resourceTimer>s.default.tower[this.type].resourceSpawnTimer&&!this._resourceAvailable&&(this._resourceTimer=0,this._resourceAvailable=!0,this.graphics.use(this.bucketGlow))}else this.readyToFire()&&(this.hasEnemyToFireOn()?(this.fire(),this._currentFireTimer=s.default.tower[this.type].baseTowerFireRateMs,this.setSprite()):(this._currentFireTimer=0,this.setSprite()))}isResourceType(){return 0!==s.default.tower[this.type].resourceSpawnTimer}onClick(t){if(this.isResourceType()&&this._resourceAvailable){c.Resources.FxHarvestTower.play(),a.PlayerState.AddMoney(s.default.tower[this.type].resourceSpawnValue),this._resourceAvailable=!1,this._resourceTimer=0;const t=new n.Actor({name:"Collected Sand",pos:this.pos,z:10,scale:n.vec(.8,.8)});t.on("initialize",(t=>{t.target.graphics.use(this.sand);var e=n.vec(Math.round(s.default.grid.tileWidth+s.default.grid.tileWidth/4),Math.round(s.default.grid.tileHeight*s.default.grid.height+s.default.grid.tileHeight/2));t.target.actions.easeTo(e,500,n.EasingFunctions.EaseOutCubic).delay(200).callMethod((()=>{t.target.kill()}))})),this._engine.add(t)}}onKill(t){const e=new h.TowerBroken(this.type,this._tile,this._grid,this.pos.x,this.pos.y);this._engine.add(e)}fire=()=>{if(!s.default.tower[this.type].firesBullets)return;const t=new n.Actor({name:"Tower Bullet",pos:this.pos,vel:n.vec(s.default.tower[this.type].bulletSpeedPixelsPerSecond,0),radius:s.default.tower[this.type].bulletRadius,color:n.Color.Black,angularVelocity:2*Math.PI,collisionGroup:n.CollisionGroup.collidesWith([o.Enemy.CollisionGroupGround,o.Enemy.CollisionGroupFlying]),collisionType:n.CollisionType.Passive,z:s.default.z.bullets});t.graphics.use(this.beachball),t.on("precollision",(e=>{e.other.takeDamage(s.default.tower[this.type].bulletDamage),t.kill()})),t.on("exitviewport",(()=>{t.kill()})),this.playBulletFling(),this._engine.add(t)};playBulletFling(){u.pickOne(c.FxTowerFlings).play()}takeDamage(t){this.currentHp-=t,this.healthBar.takeDamage(t),this.playTakeDamageSound(),this.currentHp<=0&&(this._tile.data.delete("tower"),this.kill())}playTakeDamageSound(){this.type,c.Resources.FxImpactTowerByEnemy.play()}}let p;!function(t){t.default="default",t.sandBucket="sandBucket",t.upgradeCatapult="upgradeCatapult",t.sandWall="sandWall"}(p||(p={}))})),r.register("1Raww",(function(e,i){t(e.exports,"Enemy",(()=>h)),t(e.exports,"EnemyType",(()=>c));var s=r("3OncY"),n=r("jgD1p"),o=r("3HlYA"),a=r("cTIIG"),l=r("cT3l2");class h extends n.Actor{static CollisionGroupGround=n.CollisionGroupManager.create("enemy_ground");static CollisionGroupFlying=n.CollisionGroupManager.create("enemy_flying");_currentAttackingTower=null;_occupiedTile=null;_leavingTile=null;static TileDataEnemyCounterKey="enemies";constructor(t,e,i,r){const o=s.default.enemy[t];super({name:"Enemy",x:i,y:r,z:s.default.z.enemies,width:o.width,height:o.height,color:o.color,collisionType:"enemy_flying"==o.collisionGroup?n.CollisionType.Passive:n.CollisionType.Active,collisionGroup:"enemy_flying"==o.collisionGroup?h.CollisionGroupFlying:h.CollisionGroupGround,vel:new n.Vector(-1*o.speed,0)}),this.addTag("enemy"),this.type=t,this._grid=e,this._configValues=o,this.maxHealth=this._configValues.health,this.currentHp=this.maxHealth,this.damage=this._configValues.damage,this.on("postcollision",(t=>this.onPostCollision(t))),this.on("kill",(t=>this.onKill(t)));const u=s.default.enemy[this.type].sprite?.toSprite();u&&this.graphics.use(u);const d=n.SpriteSheet.fromImageSource({image:l.Resources.TurtleSheet,grid:{rows:1,columns:8,spriteHeight:64,spriteWidth:64}});this.turtleAnim=n.Animation.fromSpriteSheet(d,n.range(0,7),200,n.AnimationStrategy.Loop);const p=n.SpriteSheet.fromImageSource({image:l.Resources.CrabSheet,grid:{rows:1,columns:3,spriteHeight:64,spriteWidth:64}});this.crabAnim=n.Animation.fromSpriteSheet(p,n.range(0,2),200,n.AnimationStrategy.PingPong);const f=n.SpriteSheet.fromImageSource({image:l.Resources.SeagullSheet,grid:{rows:1,columns:3,spriteHeight:64,spriteWidth:64}});switch(this.seagullAnim=n.Animation.fromSpriteSheet(f,n.range(0,2),200,n.AnimationStrategy.PingPong),this.type){case c.Turtle:this.graphics.use(this.turtleAnim);break;case c.Crab:this.graphics.use(this.crabAnim);break;case c.Seagull:this.graphics.use(this.seagullAnim)}this.healthBar=new a.Healthbar(this.maxHealth),this.addChild(this.healthBar)}takeDamage(t){this.currentHp-=t,this.healthBar.takeDamage(t),l.Resources.FxImpactEnemyBall.play(),this.actions.blink(50,50,2),this.currentHp<=0&&(this.kill(),this.playDeathSound())}playDeathSound(){switch(this.type){case c.Turtle:l.Resources.FxDeathTurtle.play();break;case c.Seagull:l.Resources.FxDeathGull.play();break;case c.Crab:l.Resources.FxDeathCrabForCutie.play()}}_stopped=!1;stop(){this._stopped=!0}isAttacking(){return!!this._currentAttackingTower&&this._currentAttackingTower.active}static addEnemyToTile(t){t.data.has(h.TileDataEnemyCounterKey)?t.data.set(h.TileDataEnemyCounterKey,t.data.get(h.TileDataEnemyCounterKey)+1):t.data.set(h.TileDataEnemyCounterKey,1)}static removeEnemyFromTile(t){const e=this.enemiesInTile(t);e<=1&&t.data.delete(h.TileDataEnemyCounterKey),t.data.set(h.TileDataEnemyCounterKey,e-1)}static enemiesInTile(t){return t.data.has(h.TileDataEnemyCounterKey)?t.data.get(h.TileDataEnemyCounterKey):0}onKill(t){null!=this._occupiedTile&&h.removeEnemyFromTile(this._occupiedTile),null!=this._leavingTile&&h.removeEnemyFromTile(this._leavingTile)}claimTiles(t,e){this.claimOccupyingTile(t),this.claimLeavingTile(e)}claimOccupyingTile(t){this._occupiedTile!=t&&(null!=this._occupiedTile&&h.removeEnemyFromTile(this._occupiedTile),this._occupiedTile=t,null!=this._occupiedTile&&h.addEnemyToTile(this._occupiedTile))}claimLeavingTile(t){this._leavingTile!=t&&(null!=this._leavingTile&&h.removeEnemyFromTile(this._leavingTile),this._leavingTile=t,null!=this._leavingTile&&h.addEnemyToTile(this._leavingTile))}_damageTimer=0;onPostCollision(t){if(t.other instanceof o.Tower){if(this._damageTimer<=0){this._damageTimer=this._configValues.damageTimerMs;t.other.takeDamage(this.damage)}this.vel=new n.Vector(0,0)}}onPostUpdate(t,e){if(this._stopped)return;this._damageTimer-=e;const i=this._grid.tileMap.getTileByPoint(this.pos.sub(n.vec(this.width/2,0))),r=this._grid.tileMap.getTileByPoint(this.pos.add(n.vec(.2*this.width,0)));this.claimTiles(i,r),this.isAttacking()||(this.vel=new n.Vector(-1*s.default.enemy[this.type].speed,0))}}let c;!function(t){t.Crab="crab",t.Turtle="turtle",t.Seagull="seagull"}(c||(c={}))})),r.register("cTIIG",(function(e,i){t(e.exports,"Healthbar",(()=>o));var s=r("3OncY"),n=r("jgD1p");class o extends n.Actor{healthBarOpacity=0;healthBarOpacityFade=3;constructor(t){super({name:"Healthbar",pos:n.vec(0,-10),width:s.default.healthBarWidthPixels,height:5,color:n.Color.Black,collisionType:n.CollisionType.PreventCollision,z:s.default.z.healthbars}),this.MaxHealth=t,this.CurHealth=t,this._fillColor=new n.Actor({name:"Healthbar_fill",pos:n.vec(0,0),width:this.width-2,height:this.height-2,color:n.Color.Green,collisionType:n.CollisionType.PreventCollision,z:s.default.z.healthbars+1}),this.addChild(this._fillColor)}onPostUpdate(t,e){this.healthBarOpacity>=0&&(this.healthBarOpacity=this.healthBarOpacity-1*e/1e3/this.healthBarOpacityFade,this.graphics.opacity=this.healthBarOpacity,this._fillColor.graphics.opacity=this.healthBarOpacity)}takeDamage(t){this.CurHealth-=t;const e=s.default.healthBarWidthPixels/this.MaxHealth,i=this.graphics.current[0].graphic;i.width=this.CurHealth*e,this._fillColor.graphics.current[0].graphic.width=i.width-2,this.healthBarOpacity=1,this.CurHealth<=this.MaxHealth/4?this._fillColor.color=n.Color.Red:this.CurHealth<=this.MaxHealth/2&&(this._fillColor.color=n.Color.Yellow)}}})),r.register("f836V",(function(e,i){t(e.exports,"PlayerState",(()=>n));var s=r("3OncY");class n{static moneyResource=s.default.player.startingMonies;static SubtractMoney(t){return!(this.moneyResource<t)&&(this.moneyResource-=t,this.updateDisplay(),!0)}static updateDisplay(){document.getElementById("moneyContainer").style.visibility="visible";document.getElementById("moneyDisplay").innerText=`${this.moneyResource.toString()}`}static AddMoney(t){this.moneyResource+=t,this.updateDisplay()}}})),r.register("4TY6b",(function(e,i){t(e.exports,"TowerBroken",(()=>o));var s=r("3OncY"),n=r("jgD1p");class o extends n.Actor{constructor(t,e,i,r,a){console.log("Making broken tower"),super({name:"BrokenTower",pos:e.pos.add(n.vec(s.default.grid.tileWidth/2,s.default.grid.tileHeight/2)),width:s.default.grid.tileWidth,height:s.default.grid.tileHeight,collisionType:n.CollisionType.PreventCollision});const l=s.default.tower[t].spriteBroken?.toSprite();l&&this.graphics.use(l),o.removeBrokenTower(e),e.data.set(o.DataKey,this)}towerOpacity=1;towerOpacityFade=5;onPostUpdate(t,e){this.towerOpacity>=0&&(this.towerOpacity=this.towerOpacity-1*e/1e3/this.towerOpacityFade,this.graphics.opacity=this.towerOpacity)}static DataKey="BrokenTower";static removeBrokenTower(t){t.data.has(o.DataKey)&&(t.data.get(o.DataKey).kill(),t.data.delete(o.DataKey))}}})),r("27Lyk").register(JSON.parse('{"aEVhr":"index.f8cb479d.js","93Bqc":"sword.a45e8cc8.png","1OAey":"sand-placeholder.e8c0e779.png","5rmOr":"sandcastle-placeholder.53b9737d.png","9WqmE":"sandcastle-damaged.f339f7dc.png","19SBS":"sandcastle-destroyed.c939c155.png","gQlT2":"tower-bucket-placeholder.365aebaf.png","auVjM":"tower-bucket-broken-placeholder.538d05a4.png","hRuM7":"base-tower.0363d652.png","75r3y":"tower-placeholder-broken.2884aa51.png","lPda5":"catapult.019c055d.png","7HMHc":"catapult-broken.0dc8299a.png","8x8B2":"catapult-loaded.f33cf4a9.png","afO87":"wall.87848ab7.png","cOMLy":"waves.03ea2a4c.png","6lBDw":"tower-bucket.f07c370d.png","1busq":"sand.a9b2679b.png","awm6k":"beachball.ecb82f6f.png","dZKZi":"turtle.6f2bec47.png","71OAl":"crab.a4fd342a.png","2fkyf":"seagull.0a20847d.png","e0iBh":"bottom-border.43822226.png","fVEKR":"beneath-castle.0b33a5df.png","aUy19":"shield.167be777.png","94wAw":"blocked-cursor.fe364045.png","lxy2T":"clank.3e05cde9.wav","4mjPq":"bg-beach.a23d9e18.mp3","f26Rk":"bg-music.eada03a4.mp3","bwBDW":"wave-appear.050b46e5.mp3","ekEOt":"impact-enemy-ball.30cc8291.mp3","3JmJy":"impact-tower.acf2e6e8.mp3","kcsGH":"impact-castle.1a7c5cd7.mp3","uJMWc":"pick-tower.a6c05d41.mp3","cZMMR":"harvest-tower.1df1487c.mp3","3Wb9q":"place-tower.cada49fa.mp3","5IV6z":"fling-01.fa960c0c.mp3","259Q1":"fling-02.d67f35ac.mp3","81n99":"fling-03.56fb4fa3.mp3","bcEwN":"fling-04.f50fc15f.mp3","9pOd6":"fling-05.f1898619.mp3","3bwcs":"fling-06.addd7a61.mp3","0548S":"die-turtle.f953f58c.mp3","iXkR6":"die-gull.f88ef29f.mp3","gcjhn":"die-crab.56f24673.mp3","7mgYs":"index.ad5463c4.css"}'));var o,a;o=r("1b2ls"),r("acw62");var l;!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),a=(l=r("Xw6Mv")).createRoot,l.hydrateRoot;var h=r("acw62"),c=r("3OncY"),u=r("3HlYA"),d=r("cT3l2");c=r("3OncY"),h=r("acw62"),d=r("cT3l2");class p extends h.Component{constructor(t){super(t),this.handleClick=this.handleClick.bind(this)}handleClick=t=>{t.preventDefault(),this.props.selectHandler(this.props.towerName)};render(){let t="tower";this.props.towerName==this.props.selectedTower&&(t+=" selected");let e=this.props.towerName;const i=c.default.tower[e].bulletDamage>0,s=c.default.tower[e].resourceSpawnValue>0;return o.jsx(o.Fragment,{children:o.jsxs("div",{className:t,onClick:this.handleClick,children:[o.jsxs("div",{className:"imageOuter",children:[o.jsx("img",{className:"towerIcon",src:c.default.tower[e].sprite?.path?.toString()}),o.jsx("strong",{className:"towerName",children:c.default.tower[e].displayName})]}),o.jsxs("div",{className:"towerInfo",children:[o.jsxs("div",{className:"cost costs-sand",children:[o.jsx("img",{className:"towerInfoIcon",src:d.Resources.CompactedSand.path.toString()}),o.jsx("div",{className:"costText",children:c.default.tower[e].cost})]}),i?o.jsxs("div",{className:"cost has-damage",children:[o.jsx("img",{className:"towerInfoIcon",src:d.Resources.Beachball.path.toString()}),o.jsx("div",{className:"costText",children:c.default.tower[e].bulletDamage})]}):s?o.jsxs("div",{className:"cost makes-money",children:[o.jsx("img",{className:"towerInfoIcon",src:d.Resources.CompactedSand.path.toString()}),o.jsxs("div",{className:"costText",children:["+",c.default.tower[e].resourceSpawnValue,"/",c.default.tower[e].resourceSpawnTimer,"s"]})]}):o.jsx(o.Fragment,{}),o.jsxs("div",{className:"cost armor",children:[o.jsx("img",{className:"towerInfoIcon",src:d.Resources.Shield.path.toString()}),o.jsx("div",{className:"costText",children:c.default.tower[e].maxHealth})]}),o.jsx("div",{className:"towerHoverText",children:c.default.tower[e].hoverText})]})]})})}}class f extends h.Component{constructor(t){super(t)}state={selectedTower:u.TowerType.default};selectedTower=()=>this.state.selectedTower;setSelectedTower=t=>{t!=this.state.selectedTower&&(d.Resources.UiPickTower.play(),this.setState({selectedTower:t}))};render(){return o.jsx("div",{id:"towerSelection",children:Object.keys(c.default.tower).map((t=>o.jsx(p,{towerName:t.toString(),selectedTower:this.state.selectedTower.toString(),selectHandler:this.setSelectedTower},t)))})}}r("acw62");var g=r("hVLKC");const m=()=>o.jsxs("div",{id:"moneyContainer",children:[o.jsx("img",{id:"moneyImage",src:e(g)}),o.jsx("div",{id:"moneyDisplay"})]});a(document.getElementById("reactUI")).render(o.jsxs(o.Fragment,{children:[o.jsx(m,{}),o.jsx(f,{ref:t=>{window.TowerPickerUI=t}})]}));
//# sourceMappingURL=index.f8cb479d.js.map
