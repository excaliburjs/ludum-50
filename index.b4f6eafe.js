function $parcel$export(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}var $parcel$global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function $parcel$interopDefault(t){return t&&t.__esModule?t.default:t}var $parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire957c;null==parcelRequire&&(parcelRequire=function(t){if(t in $parcel$modules)return $parcel$modules[t].exports;if(t in $parcel$inits){var e=$parcel$inits[t];delete $parcel$inits[t];var i={id:t,exports:{}};return $parcel$modules[t]=i,e.call(i.exports,i,i.exports),i.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s},parcelRequire.register=function(t,e){$parcel$inits[t]=e},$parcel$global.parcelRequire957c=parcelRequire),parcelRequire.register("27Lyk",(function(t,e){var i,s;$parcel$export(t.exports,"register",(()=>i),(t=>i=t)),$parcel$export(t.exports,"resolve",(()=>s),(t=>s=t));var n={};i=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)n[e[i]]=t[e[i]]},s=function(t){var e=n[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),parcelRequire.register("jgD1p",(function(t,e){
/*!
 * excalibur - 0.26.0-alpha.16+e8f9175 - 2022-4-2
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2022 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */
var i;self,i=function(){return(()=>{var t={4662:(t,e,i)=>{i(3430);var s=i(8791);t.exports=s("Array","sort")},8343:(t,e,i)=>{i(4769);var s=i(9276);t.exports=s.Object.keys},7111:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(9821),o=s.TypeError;t.exports=function(t){if(n(t))return t;throw o(r(t)+" is not a function")}},1176:(t,e,i)=>{var s=i(9859),n=i(5052),r=s.String,o=s.TypeError;t.exports=function(t){if(n(t))return t;throw o(r(t)+" is not an object")}},9540:(t,e,i)=>{var s=i(905),n=i(3231),r=i(9646),o=function(t){return function(e,i,o){var a,l=s(e),h=r(l),c=n(o,h);if(t&&i!=i){for(;h>c;)if((a=l[c++])!=a)return!0}else for(;h>c;c++)if((t||c in l)&&l[c]===i)return t||c||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},6038:(t,e,i)=>{var s=i(4229);t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},9794:(t,e,i)=>{var s=i(9859),n=i(3231),r=i(9646),o=i(2324),a=s.Array,l=Math.max;t.exports=function(t,e,i){for(var s=r(t),h=n(e,s),c=n(void 0===i?s:i,s),d=a(l(c-h,0)),u=0;h<c;h++,u++)o(d,u,t[h]);return d.length=u,d}},3867:(t,e,i)=>{var s=i(9794),n=Math.floor,r=function(t,e){var i=t.length,l=n(i/2);return i<8?o(t,e):a(t,r(s(t,0,l),e),r(s(t,l),e),e)},o=function(t,e){for(var i,s,n=t.length,r=1;r<n;){for(s=r,i=t[r];s&&e(t[s-1],i)>0;)t[s]=t[--s];s!==r++&&(t[s]=i)}return t},a=function(t,e,i,s){for(var n=e.length,r=i.length,o=0,a=0;o<n||a<r;)t[o+a]=o<n&&a<r?s(e[o],i[a])<=0?e[o++]:i[a++]:o<n?e[o++]:i[a++];return t};t.exports=r},7079:(t,e,i)=>{var s=i(5968),n=s({}.toString),r=s("".slice);t.exports=function(t){return r(n(t),8,-1)}},1589:(t,e,i)=>{var s=i(9859),n=i(1601),r=i(6733),o=i(7079),a=i(95)("toStringTag"),l=s.Object,h="Arguments"==o(function(){return arguments}());t.exports=n?o:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=l(t),a))?i:h?o(e):"Object"==(s=o(e))&&r(e.callee)?"Arguments":s}},7081:(t,e,i)=>{var s=i(8270),n=i(4826),r=i(7933),o=i(1787);t.exports=function(t,e,i){for(var a=n(e),l=o.f,h=r.f,c=0;c<a.length;c++){var d=a[c];s(t,d)||i&&s(i,d)||l(t,d,h(e,d))}}},5762:(t,e,i)=>{var s=i(7400),n=i(1787),r=i(5358);t.exports=s?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},5358:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},2324:(t,e,i)=>{var s=i(9310),n=i(1787),r=i(5358);t.exports=function(t,e,i){var o=s(e);o in t?n.f(t,o,r(0,i)):t[o]=i}},7400:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},2635:(t,e,i)=>{var s=i(9859),n=i(5052),r=s.document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},2671:(t,e,i)=>{var s=i(598).match(/firefox\/(\d+)/i);t.exports=!!s&&+s[1]},8506:(t,e,i)=>{var s=i(598);t.exports=/MSIE|Trident/.test(s)},598:(t,e,i)=>{var s=i(1333);t.exports=s("navigator","userAgent")||""},6358:(t,e,i)=>{var s,n,r=i(9859),o=i(598),a=r.process,l=r.Deno,h=a&&a.versions||l&&l.version,c=h&&h.v8;c&&(n=(s=c.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!n&&o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(n=+s[1]),t.exports=n},9811:(t,e,i)=>{var s=i(598).match(/AppleWebKit\/(\d+)\./);t.exports=!!s&&+s[1]},8791:(t,e,i)=>{var s=i(9859),n=i(5968);t.exports=function(t,e){return n(s[t].prototype[e])}},3837:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(t,e,i)=>{var s=i(9859),n=i(7933).f,r=i(5762),o=i(7487),a=i(2079),l=i(7081),h=i(6541);t.exports=function(t,e){var i,c,d,u,p,g=t.target,_=t.global,m=t.stat;if(i=_?s:m?s[g]||a(g,{}):(s[g]||{}).prototype)for(c in e){if(u=e[c],d=t.noTargetGet?(p=n(i,c))&&p.value:i[c],!h(_?c:g+(m?".":"#")+c,t.forced)&&void 0!==d){if(typeof u==typeof d)continue;l(u,d)}(t.sham||d&&d.sham)&&r(u,"sham",!0),o(i,c,u,t)}}},4229:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},7188:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},266:(t,e,i)=>{var s=i(7188),n=Function.prototype.call;t.exports=s?n.bind(n):function(){return n.apply(n,arguments)}},1805:(t,e,i)=>{var s=i(7400),n=i(8270),r=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,a=n(r,"name"),l=a&&"something"===function(){}.name,h=a&&(!s||s&&o(r,"name").configurable);t.exports={EXISTS:a,PROPER:l,CONFIGURABLE:h}},5968:(t,e,i)=>{var s=i(7188),n=Function.prototype,r=n.bind,o=n.call,a=s&&r.bind(o,o);t.exports=s?function(t){return t&&a(t)}:function(t){return t&&function(){return o.apply(t,arguments)}}},1333:(t,e,i)=>{var s=i(9859),n=i(6733),r=function(t){return n(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?r(s[t]):s[t]&&s[t][e]}},5300:(t,e,i)=>{var s=i(7111);t.exports=function(t,e){var i=t[e];return null==i?void 0:s(i)}},9859:(t,e,i)=>{var s=function(t){return t&&t.Math==Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof i.g&&i.g)||function(){return this}()||Function("return this")()},8270:(t,e,i)=>{var s=i(5968),n=i(2991),r=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return r(n(t),e)}},5977:t=>{t.exports={}},4394:(t,e,i)=>{var s=i(7400),n=i(4229),r=i(2635);t.exports=!s&&!n((function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},9337:(t,e,i)=>{var s=i(9859),n=i(5968),r=i(4229),o=i(7079),a=s.Object,l=n("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?l(t,""):a(t)}:a},8511:(t,e,i)=>{var s=i(5968),n=i(6733),r=i(5353),o=s(Function.toString);n(r.inspectSource)||(r.inspectSource=function(t){return o(t)}),t.exports=r.inspectSource},6407:(t,e,i)=>{var s,n,r,o=i(8694),a=i(9859),l=i(5968),h=i(5052),c=i(5762),d=i(8270),u=i(5353),p=i(4399),g=i(5977),_="Object already initialized",m=a.TypeError,f=a.WeakMap;if(o||u.state){var v=u.state||(u.state=new f),b=l(v.get),w=l(v.has),x=l(v.set);s=function(t,e){if(w(v,t))throw new m(_);return e.facade=t,x(v,t,e),e},n=function(t){return b(v,t)||{}},r=function(t){return w(v,t)}}else{var y=p("state");g[y]=!0,s=function(t,e){if(d(t,y))throw new m(_);return e.facade=t,c(t,y,e),e},n=function(t){return d(t,y)?t[y]:{}},r=function(t){return d(t,y)}}t.exports={set:s,get:n,has:r,enforce:function(t){return r(t)?n(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=n(e)).type!==t)throw m("Incompatible receiver, "+t+" required");return i}}}},6733:t=>{t.exports=function(t){return"function"==typeof t}},6541:(t,e,i)=>{var s=i(4229),n=i(6733),r=/#|\.prototype\./,o=function(t,e){var i=l[a(t)];return i==c||i!=h&&(n(e)?s(e):!!e)},a=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},l=o.data={},h=o.NATIVE="N",c=o.POLYFILL="P";t.exports=o},5052:(t,e,i)=>{var s=i(6733);t.exports=function(t){return"object"==typeof t?null!==t:s(t)}},4231:t=>{t.exports=!1},9395:(t,e,i)=>{var s=i(9859),n=i(1333),r=i(6733),o=i(1321),a=i(6969),l=s.Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return r(e)&&o(e.prototype,l(t))}},9646:(t,e,i)=>{var s=i(4237);t.exports=function(t){return s(t.length)}},3839:(t,e,i)=>{var s=i(6358),n=i(4229);t.exports=!!Object.getOwnPropertySymbols&&!n((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}))},8694:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(8511),o=s.WeakMap;t.exports=n(o)&&/native code/.test(r(o))},1787:(t,e,i)=>{var s=i(9859),n=i(7400),r=i(4394),o=i(7137),a=i(1176),l=i(9310),h=s.TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u="enumerable",p="configurable",g="writable";e.f=n?o?function(t,e,i){if(a(t),e=l(e),a(i),"function"==typeof t&&"prototype"===e&&"value"in i&&g in i&&!i.writable){var s=d(t,e);s&&s.writable&&(t[e]=i.value,i={configurable:p in i?i.configurable:s.configurable,enumerable:u in i?i.enumerable:s.enumerable,writable:!1})}return c(t,e,i)}:c:function(t,e,i){if(a(t),e=l(e),a(i),r)try{return c(t,e,i)}catch(t){}if("get"in i||"set"in i)throw h("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},7933:(t,e,i)=>{var s=i(7400),n=i(266),r=i(9195),o=i(5358),a=i(905),l=i(9310),h=i(8270),c=i(4394),d=Object.getOwnPropertyDescriptor;e.f=s?d:function(t,e){if(t=a(t),e=l(e),c)try{return d(t,e)}catch(t){}if(h(t,e))return o(!n(r.f,t,e),t[e])}},8151:(t,e,i)=>{var s=i(140),n=i(3837).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},894:(t,e)=>{e.f=Object.getOwnPropertySymbols},1321:(t,e,i)=>{var s=i(5968);t.exports=s({}.isPrototypeOf)},140:(t,e,i)=>{var s=i(5968),n=i(8270),r=i(905),o=i(9540).indexOf,a=i(5977),l=s([].push);t.exports=function(t,e){var i,s=r(t),h=0,c=[];for(i in s)!n(a,i)&&n(s,i)&&l(c,i);for(;e.length>h;)n(s,i=e[h++])&&(~o(c,i)||l(c,i));return c}},5632:(t,e,i)=>{var s=i(140),n=i(3837);t.exports=Object.keys||function(t){return s(t,n)}},9195:(t,e)=>{var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,n=s&&!i.call({1:2},1);e.f=n?function(t){var e=s(this,t);return!!e&&e.enumerable}:i},2914:(t,e,i)=>{var s=i(9859),n=i(266),r=i(6733),o=i(5052),a=s.TypeError;t.exports=function(t,e){var i,s;if("string"===e&&r(i=t.toString)&&!o(s=n(i,t)))return s;if(r(i=t.valueOf)&&!o(s=n(i,t)))return s;if("string"!==e&&r(i=t.toString)&&!o(s=n(i,t)))return s;throw a("Can't convert object to primitive value")}},4826:(t,e,i)=>{var s=i(1333),n=i(5968),r=i(8151),o=i(894),a=i(1176),l=n([].concat);t.exports=s("Reflect","ownKeys")||function(t){var e=r.f(a(t)),i=o.f;return i?l(e,i(t)):e}},9276:(t,e,i)=>{var s=i(9859);t.exports=s},7487:(t,e,i)=>{var s=i(9859),n=i(6733),r=i(8270),o=i(5762),a=i(2079),l=i(8511),h=i(6407),c=i(1805).CONFIGURABLE,d=h.get,u=h.enforce,p=String(String).split("String");(t.exports=function(t,e,i,l){var h,d=!!l&&!!l.unsafe,g=!!l&&!!l.enumerable,_=!!l&&!!l.noTargetGet,m=l&&void 0!==l.name?l.name:e;n(i)&&("Symbol("===String(m).slice(0,7)&&(m="["+String(m).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!r(i,"name")||c&&i.name!==m)&&o(i,"name",m),(h=u(i)).source||(h.source=p.join("string"==typeof m?m:""))),t!==s?(d?!_&&t[e]&&(g=!0):delete t[e],g?t[e]=i:o(t,e,i)):g?t[e]=i:a(e,i)})(Function.prototype,"toString",(function(){return n(this)&&d(this).source||l(this)}))},8885:(t,e,i)=>{var s=i(9859).TypeError;t.exports=function(t){if(null==t)throw s("Can't call method on "+t);return t}},2079:(t,e,i)=>{var s=i(9859),n=Object.defineProperty;t.exports=function(t,e){try{n(s,t,{value:e,configurable:!0,writable:!0})}catch(i){s[t]=e}return e}},4399:(t,e,i)=>{var s=i(3036),n=i(1441),r=s("keys");t.exports=function(t){return r[t]||(r[t]=n(t))}},5353:(t,e,i)=>{var s=i(9859),n=i(2079),r="__core-js_shared__",o=s[r]||n(r,{});t.exports=o},3036:(t,e,i)=>{var s=i(4231),n=i(5353);(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.0",mode:s?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE",source:"https://github.com/zloirock/core-js"})},3231:(t,e,i)=>{var s=i(3329),n=Math.max,r=Math.min;t.exports=function(t,e){var i=s(t);return i<0?n(i+e,0):r(i,e)}},905:(t,e,i)=>{var s=i(9337),n=i(8885);t.exports=function(t){return s(n(t))}},3329:t=>{var e=Math.ceil,i=Math.floor;t.exports=function(t){var s=+t;return s!=s||0===s?0:(s>0?i:e)(s)}},4237:(t,e,i)=>{var s=i(3329),n=Math.min;t.exports=function(t){return t>0?n(s(t),9007199254740991):0}},2991:(t,e,i)=>{var s=i(9859),n=i(8885),r=s.Object;t.exports=function(t){return r(n(t))}},2066:(t,e,i)=>{var s=i(9859),n=i(266),r=i(5052),o=i(9395),a=i(5300),l=i(2914),h=i(95),c=s.TypeError,d=h("toPrimitive");t.exports=function(t,e){if(!r(t)||o(t))return t;var i,s=a(t,d);if(s){if(void 0===e&&(e="default"),i=n(s,t,e),!r(i)||o(i))return i;throw c("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(t,e)}},9310:(t,e,i)=>{var s=i(2066),n=i(9395);t.exports=function(t){var e=s(t,"string");return n(e)?e:e+""}},1601:(t,e,i)=>{var s={};s[i(95)("toStringTag")]="z",t.exports="[object z]"===String(s)},3326:(t,e,i)=>{var s=i(9859),n=i(1589),r=s.String;t.exports=function(t){if("Symbol"===n(t))throw TypeError("Cannot convert a Symbol value to a string");return r(t)}},9821:(t,e,i)=>{var s=i(9859).String;t.exports=function(t){try{return s(t)}catch(t){return"Object"}}},1441:(t,e,i)=>{var s=i(5968),n=0,r=Math.random(),o=s(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++n+r,36)}},6969:(t,e,i)=>{var s=i(3839);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7137:(t,e,i)=>{var s=i(7400),n=i(4229);t.exports=s&&n((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},95:(t,e,i)=>{var s=i(9859),n=i(3036),r=i(8270),o=i(1441),a=i(3839),l=i(6969),h=n("wks"),c=s.Symbol,d=c&&c.for,u=l?c:c&&c.withoutSetter||o;t.exports=function(t){if(!r(h,t)||!a&&"string"!=typeof h[t]){var e="Symbol."+t;a&&r(c,t)?h[t]=c[t]:h[t]=l&&d?d(e):u(e)}return h[t]}},3430:(t,e,i)=>{var s=i(3103),n=i(5968),r=i(7111),o=i(2991),a=i(9646),l=i(3326),h=i(4229),c=i(3867),d=i(6038),u=i(2671),p=i(8506),g=i(6358),_=i(9811),m=[],f=n(m.sort),v=n(m.push),b=h((function(){m.sort(void 0)})),w=h((function(){m.sort(null)})),x=d("sort"),y=!h((function(){if(g)return g<70;if(!(u&&u>3)){if(p)return!0;if(_)return _<603;var t,e,i,s,n="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)m.push({k:e+s,v:i})}for(m.sort((function(t,e){return e.v-t.v})),s=0;s<m.length;s++)e=m[s].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}}));s({target:"Array",proto:!0,forced:b||!w||!x||!y},{sort:function(t){void 0!==t&&r(t);var e=o(this);if(y)return void 0===t?f(e):f(e,t);var i,s,n=[],h=a(e);for(s=0;s<h;s++)s in e&&v(n,e[s]);for(c(n,function(t){return function(e,i){return void 0===i?-1:void 0===e?1:void 0!==t?+t(e,i)||0:l(e)>l(i)?1:-1}}(t)),i=n.length,s=0;s<i;)e[s]=n[s++];for(;s<h;)delete e[s++];return e}})},4769:(t,e,i)=>{var s=i(3103),n=i(2991),r=i(5632);s({target:"Object",stat:!0,forced:i(4229)((function(){r(1)}))},{keys:function(t){return r(n(t))}})},1388:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(272),n=i.n(s),r=i(2609),o=i.n(r)()(n());o.push([t.id,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  white-space: nowrap;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n","",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:["/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  white-space: nowrap;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n"],sourceRoot:""}]);const a=o},2609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var h=0;h<t.length;h++){var c=[].concat(t[h]);s&&o[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},272:t=>{t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),r="/*# ".concat(n," */"),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[e].concat(o).concat([r]).join("\n")}return[e].join("\n")}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{ActionContext:()=>qs,ActionQueue:()=>Is,ActionsComponent:()=>Ks,ActionsSystem:()=>Jn,ActivateEvent:()=>ae,Actor:()=>Qs,AddedComponent:()=>ms,AddedEntity:()=>xn,Animation:()=>jn,AnimationDirection:()=>On,AnimationStrategy:()=>zn,ArcadeSolver:()=>Bn,AudioContextFactory:()=>gi,Axis:()=>sn,BaseAlign:()=>Le,BinaryTreeNode:()=>Ao,Blink:()=>Us,BodyComponent:()=>ps,BoundingBox:()=>R,BroadphaseStrategy:()=>Ii,BrowserComponent:()=>Rr,BrowserEvents:()=>Br,Camera:()=>gn,Canvas:()=>kt,Circle:()=>As,CircleCollider:()=>es,Class:()=>mi,Clock:()=>Hr,ClosestLine:()=>Ji,ClosestLineJumpTable:()=>ts,Collider:()=>Yi,ColliderComponent:()=>ls,CollisionContact:()=>is,CollisionEndEvent:()=>re,CollisionGroup:()=>Hi,CollisionGroupManager:()=>no,CollisionJumpTable:()=>ns,CollisionPostSolveEvent:()=>se,CollisionPreSolveEvent:()=>ie,CollisionResolutionStrategy:()=>Ti,CollisionSolver:()=>Rn,CollisionStartEvent:()=>ne,CollisionSystem:()=>Ln,CollisionType:()=>Si,Color:()=>D,ColorBlindFlags:()=>Er,ColorBlindnessMode:()=>sr,ColorBlindnessPostProcessor:()=>Pr,Component:()=>Oi,CompositeCollider:()=>Zi,Configurable:()=>Se,ConsoleAppender:()=>b,ContactConstraintPoint:()=>$n,ContactEndEvent:()=>ee,ContactStartEvent:()=>te,CoordPlane:()=>Bi,CullingBox:()=>gs,DeactivateEvent:()=>le,Debug:()=>Sr,DebugGraphicsComponent:()=>en,DebugSystem:()=>Zn,DebugText:()=>qe,DegreeOfFreedom:()=>hs,Detector:()=>Ei,Die:()=>js,Direction:()=>Ue,DisplayMode:()=>ci,DynamicTree:()=>qi,DynamicTreeCollisionProcessor:()=>Xi,EX_VERSION:()=>Bo,EaseTo:()=>zs,EasingFunctions:()=>ks,EdgeCollider:()=>rs,ElasticToActorStrategy:()=>dn,EmitterType:()=>Nn,Engine:()=>Xr,EnterTriggerEvent:()=>de,EnterViewPortEvent:()=>ce,Entity:()=>ws,EntityManager:()=>En,EventDispatcher:()=>pe,EventTypes:()=>pt,Events:()=>e,ExResponse:()=>oo,ExcaliburGraphicsContext2DCanvas:()=>Fr,ExcaliburGraphicsContextWebGL:()=>hi,ExcaliburWebGLContextAccessor:()=>Ye,ExitTriggerEvent:()=>ue,ExitViewPortEvent:()=>he,Experiments:()=>h,Fade:()=>Ns,Flags:()=>m,Follow:()=>Ws,Font:()=>Xs,FontStyle:()=>Ve,FontUnit:()=>Re,FpsSampler:()=>Nr,FrameStats:()=>Ar,GameEvent:()=>It,GameStartEvent:()=>Bt,GameStopEvent:()=>$t,GamepadAxisEvent:()=>qt,GamepadButtonEvent:()=>Gt,GamepadConnectEvent:()=>jt,GamepadDisconnectEvent:()=>Wt,Gif:()=>bo,GlobalCoordinates:()=>Lr,Graphic:()=>wt,GraphicsComponent:()=>Es,GraphicsGroup:()=>Wn,GraphicsLayer:()=>Cs,GraphicsLayers:()=>Ps,GraphicsSystem:()=>Xn,HiddenEvent:()=>Zt,ImageFiltering:()=>dt,ImageSource:()=>Ie,InitializeEvent:()=>oe,Input:()=>a,Integrator:()=>Mi,IsometricEntityComponent:()=>tr,IsometricEntitySystem:()=>er,IsometricMap:()=>so,IsometricTile:()=>io,KillEvent:()=>Dt,Label:()=>eo,Legacy:()=>c,LegacyDrawing:()=>o,LimitCameraBoundsStrategy:()=>pn,Line:()=>Qi,Loader:()=>Ci,LockCameraToActorAxisStrategy:()=>cn,LockCameraToActorStrategy:()=>hn,LogLevel:()=>u,Logger:()=>v,Matrix:()=>_t,MatrixLocations:()=>ht,MediaEvent:()=>Zr,Meet:()=>Gs,MockedElement:()=>To,MotionComponent:()=>Ni,MotionSystem:()=>Mn,MoveBy:()=>Rs,MoveTo:()=>Bs,NativeSoundEvent:()=>Qr,NativeSoundProcessedEvent:()=>Jr,Observable:()=>zi,OffscreenSystem:()=>ir,Pair:()=>ji,ParseGif:()=>Co,Particle:()=>qn,ParticleEmitter:()=>Kn,Physics:()=>Fi,PhysicsStats:()=>Tr,PointerComponent:()=>Ts,PointerSystem:()=>Qn,Polygon:()=>Po,PolygonCollider:()=>os,Pool:()=>ko,PostCollisionEvent:()=>Jt,PostDebugDrawEvent:()=>Vt,PostDrawEvent:()=>Lt,PostFrameEvent:()=>Ht,PostKillEvent:()=>Rt,PostUpdateEvent:()=>Ut,PreCollisionEvent:()=>Qt,PreDebugDrawEvent:()=>Ot,PreDrawEvent:()=>Ft,PreFrameEvent:()=>Nt,PreKillEvent:()=>Mt,PreUpdateEvent:()=>zt,Projection:()=>Wi,Promise:()=>Ro,PromiseState:()=>Do,QuadIndexBuffer:()=>ni,Query:()=>An,QueryManager:()=>Tn,RadiusAroundActorStrategy:()=>un,Random:()=>$,Raster:()=>Tt,Ray:()=>Ki,RealisticSolver:()=>Fn,Rectangle:()=>Ss,RemovedComponent:()=>vs,RemovedEntity:()=>Cn,Repeat:()=>Ds,RepeatForever:()=>Ms,Resolution:()=>ui,Resource:()=>ge,RotateBy:()=>Fs,RotateTo:()=>$s,RotationType:()=>ds,ScaleBy:()=>Os,ScaleTo:()=>Ls,Scene:()=>yr,Screen:()=>pi,ScreenAppender:()=>w,ScreenElement:()=>Js,ScreenShader:()=>Cr,ScrollPreventionMode:()=>Gr,Shader:()=>Ze,Shape:()=>as,Side:()=>T,SortedList:()=>So,Sound:()=>vo,Sprite:()=>ke,SpriteFont:()=>Ge,SpriteSheet:()=>We,StandardClock:()=>jr,StrategyContainer:()=>ln,Stream:()=>yo,SubscribeEvent:()=>Kt,System:()=>wn,SystemManager:()=>kn,SystemType:()=>vn,TagComponent:()=>Vi,TestClock:()=>Wr,Text:()=>Ys,TextAlign:()=>$e,TextureLoader:()=>At,Tile:()=>an,TileMap:()=>on,Timer:()=>tn,Traits:()=>l,TransformComponent:()=>Ui,TreeNode:()=>Gi,Trigger:()=>fn,TwoPI:()=>F,UnsubscribeEvent:()=>Xt,Util:()=>g,Vector:()=>S,VectorView:()=>Li,VertexBuffer:()=>Qe,VertexLayout:()=>Je,VisibleEvent:()=>Yt,WebAudio:()=>_i,WebAudioInstance:()=>mo,World:()=>In,canonicalizeAngle:()=>z,clamp:()=>V,createId:()=>f,frac:()=>L,hasGraphicsTick:()=>ys,hasOnInitialize:()=>lo,hasOnPostUpdate:()=>po,hasOnPreUpdate:()=>co,hasPostDraw:()=>_o,hasPreDraw:()=>go,has_initialize:()=>ao,has_postupdate:()=>uo,has_preupdate:()=>ho,isAddedComponent:()=>fs,isAddedSystemEntity:()=>yn,isRemoveSystemEntity:()=>Pn,isRemovedComponent:()=>bs,maxMessages:()=>x,obsolete:()=>E,randomInRange:()=>j,randomIntInRange:()=>W,range:()=>H,resetObsoleteCounter:()=>C,sign:()=>O,toDegrees:()=>U,toRadians:()=>N,vec:()=>A,webgl:()=>t});var t={};i.r(t),i.d(t,{ensurePowerOfTwo:()=>Ct,getAttributeComponentSize:()=>Et,getAttributePointerType:()=>St,getGlTypeSizeBytes:()=>Pt,isPowerOfTwo:()=>xt,nextHighestPowerOfTwo:()=>yt});var e={};i.r(e),i.d(e,{ActivateEvent:()=>ae,CollisionEndEvent:()=>re,CollisionPostSolveEvent:()=>se,CollisionPreSolveEvent:()=>ie,CollisionStartEvent:()=>ne,ContactEndEvent:()=>ee,ContactStartEvent:()=>te,DeactivateEvent:()=>le,EnterTriggerEvent:()=>de,EnterViewPortEvent:()=>ce,EventTypes:()=>pt,ExitTriggerEvent:()=>ue,ExitViewPortEvent:()=>he,GameEvent:()=>It,GameStartEvent:()=>Bt,GameStopEvent:()=>$t,GamepadAxisEvent:()=>qt,GamepadButtonEvent:()=>Gt,GamepadConnectEvent:()=>jt,GamepadDisconnectEvent:()=>Wt,HiddenEvent:()=>Zt,InitializeEvent:()=>oe,KillEvent:()=>Dt,PostCollisionEvent:()=>Jt,PostDebugDrawEvent:()=>Vt,PostDrawEvent:()=>Lt,PostFrameEvent:()=>Ht,PostKillEvent:()=>Rt,PostUpdateEvent:()=>Ut,PreCollisionEvent:()=>Qt,PreDebugDrawEvent:()=>Ot,PreDrawEvent:()=>Ft,PreFrameEvent:()=>Nt,PreKillEvent:()=>Mt,PreUpdateEvent:()=>zt,SubscribeEvent:()=>Kt,UnsubscribeEvent:()=>Xt,VisibleEvent:()=>Yt});var n={};i.r(n),i.d(n,{Colorize:()=>be,Darken:()=>xe,Desaturate:()=>Ce,Fill:()=>Pe,Grayscale:()=>me,Invert:()=>fe,Lighten:()=>we,Opacity:()=>ve,Saturate:()=>ye});var r={};i.r(r),i.d(r,{circle:()=>xi,line:()=>fi,point:()=>vi,roundRect:()=>wi,vector:()=>bi});var o={};i.r(o),i.d(o,{Animation:()=>Me,CanvasDrawComponent:()=>xs,CanvasDrawingSystem:()=>Yn,Effects:()=>n,Polygon:()=>ro,Sprite:()=>Te,SpriteFont:()=>je,SpriteSheet:()=>He,Texture:()=>Ee});var a={};i.r(a),i.d(a,{Axes:()=>dr,Buttons:()=>hr,Gamepad:()=>Mr,Gamepads:()=>Dr,KeyEvent:()=>kr,Keyboard:()=>Ir,Keys:()=>ar,NativePointerButton:()=>_r,PointerButton:()=>fr,PointerComponent:()=>Ts,PointerEvent:()=>Or,PointerEventReceiver:()=>Ur,PointerScope:()=>rr,PointerSystem:()=>Qn,PointerType:()=>br,WheelDeltaMode:()=>pr,WheelEvent:()=>Vr});var l={};i.r(l),i.d(l,{OffscreenCulling:()=>_s});var h,c,d,u,p,g={};function _(){if("undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"!=typeof window&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise(((i,s)=>{t.call(this,e,i,s)}))}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1)}i.r(g),i.d(g,{Collection:()=>ot,ConsoleAppender:()=>b,DrawUtil:()=>r,EasingFunctions:()=>ks,LogLevel:()=>u,Logger:()=>v,Observable:()=>zi,ScreenAppender:()=>w,TwoPI:()=>G,addItemToArray:()=>et,canonicalizeAngle:()=>Y,clamp:()=>q,contains:()=>st,delay:()=>lt,fail:()=>at,getOppositeSide:()=>nt,getPosition:()=>tt,getSideFromDirection:()=>rt,randomInRange:()=>K,randomIntInRange:()=>X,range:()=>J,removeItemFromArray:()=>it,toDegrees:()=>Z,toRadians:()=>Q}),i(4662),i(8343),(h||(h={})).WebGL="use-webgl",(d=c||(c={})).Canvas="use-canvas-context",d.LegacyDrawing="use-legacy-drawing";class m{static freeze(){m._FROZEN=!0}static _reset(){m._FROZEN=!1,m._FLAGS={}}static useWebGL(){m.enable(h.WebGL)}static useCanvasGraphicsContext(){m.enable(c.Canvas)}static useLegacyDrawing(){m.enable(c.LegacyDrawing)}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");m._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");m._FLAGS[t]=!1}static isEnabled(t){return!!m._FLAGS[t]}static show(){return Object.keys(m._FLAGS)}}function f(t,e){return{type:t,value:e}}m._FROZEN=!1,m._FLAGS={},(p=u||(u={}))[p.Debug=0]="Debug",p[p.Info=1]="Info",p[p.Warn=2]="Warn",p[p.Error=3]="Error",p[p.Fatal=4]="Fatal";class v{constructor(){if(this._appenders=[],this.defaultLevel=u.Info,v._INSTANCE)throw new Error("Logger is a singleton");return v._INSTANCE=this,v._INSTANCE.addAppender(new b),v._INSTANCE}static getInstance(){return null==v._INSTANCE&&(v._INSTANCE=new v),v._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){null==t&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}debug(...t){this._log(u.Debug,t)}info(...t){this._log(u.Info,t)}warn(...t){this._log(u.Warn,t)}error(...t){this._log(u.Error,t)}fatal(...t){this._log(u.Fatal,t)}}v._INSTANCE=null;class b{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+u[t]+"] : "),t<u.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<u.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class w{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+u[t]+"] : "+i);let s=10,n=1;for(let t=0;t<this._messages.length;t++)this._ctx.fillStyle="rgba(255,255,255,"+n.toFixed(2)+")",this._ctx.fillText(this._messages[t],200,s),s+=10,n=n>0?n-.05:0}}const x=5,y={},C=()=>{for(const t in y)y[t]=0},P=(t,e)=>{const i=m.isEnabled("suppress-obsolete-message");y[t]<x&&!i&&(v.getInstance().warn(t),console.trace&&e.showStackTrace&&console.trace()),y[t]++};function E(t){return t={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...t},function(e,i,s){if(s&&"function"!=typeof s.value&&"function"!=typeof s.get&&"function"!=typeof s.set)throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const n=`${e.name||""}${e.name&&i?".":""}${i||""} is marked obsolete: ${t.message}`+(t.alternateMethod?` Use ${t.alternateMethod} instead`:"");y[n]||(y[n]=0);const r=s?{...s}:e;if(!s){class e extends r{constructor(...e){P(n,t),super(...e)}}return e}return s&&s.value?(r.value=function(){return P(n,t),s.value.apply(this,arguments)},r):(s&&s.get&&(r.get=function(){return P(n,t),s.get.apply(this,arguments)}),s&&s.set&&(r.set=function(){return P(n,t),s.set.apply(this,arguments)}),r)}}class S{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new S(0,0)}static get One(){return new S(1,1)}static get Half(){return new S(.5,.5)}static get Up(){return new S(0,-1)}static get Down(){return new S(0,1)}static get Left(){return new S(-1,0)}static get Right(){return new S(1,0)}static fromAngle(t){return new S(Math.cos(t),Math.sin(t))}static isValid(t){return null!=t&&!isNaN(t.x)&&!isNaN(t.y)&&t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new S(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new S(Math.max(t.x,e.x),Math.max(t.y,e.y))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){return t||(t=S.Zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}squareDistance(t){return t||(t=S.Zero),Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)}magnitude(){return this.distance()}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new S(this.x/t,this.y/t):new S(0,1)}average(t){return this.add(t).scale(.5)}scale(t){return t instanceof S?new S(this.x*t.x,this.y*t.y):new S(this.x*t,this.y*t)}add(t){return new S(this.x+t.x,this.y+t.y)}sub(t){return new S(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return t instanceof S?this.x*t.y-this.y*t.x:"number"==typeof t?new S(t*this.y,-t*this.x):void 0}static cross(t,e){return new S(-t*e.y,t*e.x)}perpendicular(){return new S(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new S(0,0));const i=Math.sin(t),s=Math.cos(t),n=s*(this.x-e.x)-i*(this.y-e.y)+e.x,r=i*(this.x-e.x)+s*(this.y-e.y)+e.y;return new S(n,r)}clone(){return new S(this.x,this.y)}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}function A(t,e){return new S(t,e)}!function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([E({message:"will be removed in favour of `.size` in version 0.25.0"})],S.prototype,"magnitude",null);var T,k,I=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class D{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=null!=s?s:1}static fromRGB(t,e,i,s){return new D(t,e,i,s)}static fromRGBString(t){let e=null;if(e=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i)){const t=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10);let n=1;return e[4]&&(n=parseFloat(e[4])),new D(t,i,s,n)}throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){let e=null;if(e=t.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){const t=parseInt(e[1],16),i=parseInt(e[2],16),s=parseInt(e[3],16);let n=1;return e[4]&&(n=parseInt(e[4],16)/255),new D(t,i,s,n)}throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new M(t,e,i,s).toRGBA()}lighten(t=.1){const e=M.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=M.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=M.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=M.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,n=t.a*this.a;return new D(e,i,s,n)}mulitiply(t){return this.multiply(t)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new D(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,n=(t.a+this.a)/2;return new D(e,i,s,n)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return M.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new D(this.r,this.g,this.b,this.a)}static get Black(){return D.fromHex("#000000")}static get White(){return D.fromHex("#FFFFFF")}static get Gray(){return D.fromHex("#808080")}static get LightGray(){return D.fromHex("#D3D3D3")}static get DarkGray(){return D.fromHex("#A9A9A9")}static get Yellow(){return D.fromHex("#FFFF00")}static get Orange(){return D.fromHex("#FFA500")}static get Red(){return D.fromHex("#FF0000")}static get Vermilion(){return D.fromHex("#FF5B31")}static get Vermillion(){return D.Vermilion}static get Rose(){return D.fromHex("#FF007F")}static get Magenta(){return D.fromHex("#FF00FF")}static get Violet(){return D.fromHex("#7F00FF")}static get Blue(){return D.fromHex("#0000FF")}static get Azure(){return D.fromHex("#007FFF")}static get Cyan(){return D.fromHex("#00FFFF")}static get Viridian(){return D.fromHex("#59978F")}static get Green(){return D.fromHex("#00FF00")}static get Chartreuse(){return D.fromHex("#7FFF00")}static get Transparent(){return D.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return D.fromHex("#176BAA")}}I([E({message:"Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0"})],D.prototype,"mulitiply",null),I([E({message:"Alias for incorrect spelling used in older versions",alternateMethod:"Vermilion"})],D,"Vermillion",null);class M{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const n=Math.max(t,e,i),r=Math.min(t,e,i);let o,a;const l=(n+r)/2;if(n===r)o=a=0;else{const s=n-r;switch(a=l>.5?s/(2-n-r):s/(n+r),n){case t:o=(e-i)/s+(e<i?6:0);break;case e:o=(i-t)/s+2;break;case i:o=(t-e)/s+4}o/=6}return new M(o,a,l,s)}toRGBA(){let t,e,i;if(0===this.s)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,n=2*this.l-s;t=M.hue2rgb(n,s,this.h+1/3),e=M.hue2rgb(n,s,this.h),i=M.hue2rgb(n,s,this.h-1/3)}return new D(255*t,255*e,255*i,this.a)}toString(){return`hsla(${this.h.toFixed(0)}, ${this.s.toFixed(0)}, ${this.l.toFixed(0)}, ${this.a.toFixed(0)})`}}(k=T||(T={})).None="None",k.Top="Top",k.Bottom="Bottom",k.Left="Left",k.Right="Right",function(t){t.getOpposite=function(e){return e===t.Top?t.Bottom:e===t.Bottom?t.Top:e===t.Left?t.Right:e===t.Right?t.Left:t.None},t.fromDirection=function(e){const i=[S.Left,S.Right,S.Up,S.Down],s=[t.Left,t.Right,t.Top,t.Bottom];let n=-Number.MAX_VALUE,r=-1;for(let t=0;t<i.length;t++)i[t].dot(e)>n&&(n=i[t].dot(e),r=t);return s[r]}}(T||(T={}));class R{constructor(t=0,e=0,i=0,s=0){"object"==typeof t?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):"number"==typeof t&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}clone(){return new R(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?T.Right:T.Left:t.y<0?T.Bottom:T.Top:T.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r].x<e&&(e=t[r].x),t[r].x>s&&(s=t[r].x),t[r].y<i&&(i=t[r].y),t[r].y>n&&(n=t[r].y);return new R(e,i,s,n)}static fromDimension(t,e,i=S.Half,s=S.Zero){return new R(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return 0===this.width||0===this.height}get center(){return new S((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new R(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=S.Zero){const i=this.getPoints().map((i=>i.rotate(t,e)));return R.fromPoints(i)}scale(t,e=S.Zero){const i=this.translate(e);return new R(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=A(t.data[0],t.data[1]),i=e.scale(this.left),s=e.scale(this.right),n=A(t.data[4],t.data[5]),r=n.scale(this.top),o=n.scale(this.bottom),a=t.getPosition(),l=S.min(i,s).add(S.min(r,o)).add(a),h=S.max(i,s).add(S.max(r,o)).add(a);return new R({left:l.x,top:l.y,right:h.x,bottom:h.y})}getPerimeter(){return 2*(this.width+this.height)}getPoints(){const t=[];return t.push(new S(this.left,this.top)),t.push(new S(this.right,this.top)),t.push(new S(this.right,this.bottom)),t.push(new S(this.left,this.bottom)),t}rayCast(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const l=(this.top-t.pos.y)*r,h=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(l,h)),s=Math.min(s,Math.max(l,h)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const l=(this.top-t.pos.y)*r,h=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(l,h)),s=Math.min(s,Math.max(l,h)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof S?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof R&&this.left<t.left&&this.top<t.top&&t.bottom<this.bottom&&t.right<this.right}combine(t){return new R(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new S(this.width,this.height)}overlaps(t){const e=this.combine(t);return e.width<t.width+this.width&&e.height<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let e=0;e=this.right>=t.left&&this.right<=t.right?t.left-this.right:t.right-this.left;let i=0;return i=this.top<=t.bottom&&this.top>=t.top?t.bottom-this.top:t.top-this.bottom,Math.abs(e)<Math.abs(i)?new S(e,0):new S(0,i)}if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let e=0;e=this.width-t.width>=0?this.right-t.right<=t.left-this.left?t.left-this.right:t.right-this.left:t.right-this.right<=this.left-t.left?this.left-t.right:this.right-t.left;let i=0;return i=this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?t.top-this.bottom:t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?this.top-t.bottom:this.bottom-t.top,Math.abs(e)<Math.abs(i)?new S(e,0):new S(0,i)}return null}intersectWithSide(t){const e=this.intersect(t);return R.getSideFromIntersection(e)}debugDraw(t,e=D.Yellow){t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.width,this.height)}draw(t,e=D.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}const B=4294967295;class ${constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let t=1;t<this._n;t++){const e=this._mt[t-1]^this._mt[t-1]>>>this._w-2;this._mt[t]=(this._f*((4294901760&e)>>>16)<<16)+this._f*(65535&e)+t>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[1&e]&B;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[1&e]&B;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[1&e]&B,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const n=t.slice(0);for(;s<e;){const t=this.integer(0,n.length-1);i[s++]=n[t],n.splice(t,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let t=0;t<e.length-2;t++){const s=this.integer(t,e.length-1);i=e[t],e[t]=e[s],e[s]=i}return e}range(t,e,i){const s=new Array(t);for(let n=0;n<t;n++)s[n]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const F=2*Math.PI;function L(t){return t>=0?t-Math.floor(t):t-Math.ceil(t)}function O(t){return 0===t?0:t<0?-1:1}function V(t,e,i){return Math.min(Math.max(e,t),i)}function z(t){let e=t;if(t>F)for(;e>F;)e-=F;if(t<0)for(;e<0;)e+=F;return e}function U(t){return 180/Math.PI*t}function N(t){return t/180*Math.PI}const H=(t,e)=>Array.from(new Array(e-t+1),((e,i)=>i+t));function j(t,e,i=new $){return i?i.floating(t,e):t+Math.random()*(e-t)}function W(t,e,i=new $){return i?i.integer(t,e):Math.round(j(t,e))}const G=F,q=V,K=j,X=W,Y=z,Z=U,Q=N,J=H;function tt(t){let e=0,i=0;const s=t=>{e+=t.offsetLeft,t.offsetParent&&s(t.offsetParent)},n=t=>{i+=t.offsetTop,t.offsetParent&&n(t.offsetParent)};return s(t),n(t),new S(e,i)}function et(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function it(t,e){let i=-1;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)}function st(t,e){for(let i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}function nt(t){return t===T.Top?T.Bottom:t===T.Bottom?T.Top:t===T.Left?T.Right:t===T.Right?T.Left:T.None}function rt(t){const e=[S.Left,S.Right,S.Up,S.Down],i=[T.Left,T.Right,T.Top,T.Bottom];let s=-Number.MAX_VALUE,n=-1;for(let i=0;i<e.length;i++)e[i].dot(t)>s&&(s=e[i].dot(t),n=i);return i[n]}class ot{constructor(t=ot.DefaultSize){this._internalArray=null,this._endPointer=0,this._internalArray=new Array(t)}_resize(){const t=2*this._internalArray.length,e=new Array(t),i=this.count();for(let t=0;t<i;t++)e[t]=this._internalArray[t];delete this._internalArray,this._internalArray=e}push(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t}pop(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]}count(){return this._endPointer}clear(){this._endPointer=0}internalSize(){return this._internalArray.length}elementAt(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]}insert(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e}remove(t){const e=this.count();if(0===e)throw new Error("Invalid parameter "+t);const i=this._internalArray[t];for(let i=t;i<e;i++)this._internalArray[i]=this._internalArray[i+1];return this._endPointer--,i}removeElement(t){const e=this._internalArray.indexOf(t);this.remove(e)}toArray(){return this._internalArray.slice(0,this._endPointer)}forEach(t){let e=0;const i=this.count();for(;e<i;e++)t.call(this,this._internalArray[e],e)}map(t){const e=this.count();for(let i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)}}function at(t){throw new Error(t)}function lt(t,e){var i;const s=null!==(i=null==e?void 0:e.schedule.bind(e))&&void 0!==i?i:setTimeout;return new Promise((e=>{s((()=>{e()}),t)}))}var ht,ct,dt,ut,pt,gt;ot.DefaultSize=200,(ct=ht||(ht={}))[ct.X=12]="X",ct[ct.Y=13]="Y";class _t{constructor(){this.data=new Float32Array(16),this._scaleSignX=1,this._scaleSignY=1}static ortho(t,e,i,s,n,r){const o=new _t;return o.data[0]=2/(e-t),o.data[1]=0,o.data[2]=0,o.data[3]=0,o.data[4]=0,o.data[5]=2/(s-i),o.data[6]=0,o.data[7]=0,o.data[8]=0,o.data[9]=0,o.data[10]=-2/(r-n),o.data[11]=0,o.data[12]=-(e+t)/(e-t),o.data[13]=-(s+i)/(s-i),o.data[14]=-(r+n)/(r-n),o.data[15]=1,o}clone(){const t=new _t;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=this.data[2],t.data[3]=this.data[3],t.data[4]=this.data[4],t.data[5]=this.data[5],t.data[6]=this.data[6],t.data[7]=this.data[7],t.data[8]=this.data[8],t.data[9]=this.data[9],t.data[10]=this.data[10],t.data[11]=this.data[11],t.data[12]=this.data[12],t.data[13]=this.data[13],t.data[14]=this.data[14],t.data[15]=this.data[15],t}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new _t;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=_t.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=_t.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=_t.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof S){const i=e||new S(0,0),s=t,n=s.x*this.data[0]+s.y*this.data[4]+this.data[12],r=s.x*this.data[1]+s.y*this.data[5]+this.data[13];return i.x=n,i.y=r,i}{const i=e||new _t,s=t,n=this.data[0],r=this.data[1],o=this.data[2],a=this.data[3],l=this.data[4],h=this.data[5],c=this.data[6],d=this.data[7],u=this.data[8],p=this.data[9],g=this.data[10],_=this.data[11],m=this.data[12],f=this.data[13],v=this.data[14],b=this.data[15],w=s.data[0],x=s.data[1],y=s.data[2],C=s.data[3],P=s.data[4],E=s.data[5],S=s.data[6],A=s.data[7],T=s.data[8],k=s.data[9],I=s.data[10],D=s.data[11],M=s.data[12],R=s.data[13],B=s.data[14],$=s.data[15];i.data[0]=n*w+l*x+u*y+m*C,i.data[1]=r*w+h*x+p*y+f*C,i.data[2]=o*w+c*x+g*y+v*C,i.data[3]=a*w+d*x+_*y+b*C,i.data[4]=n*P+l*E+u*S+m*A,i.data[5]=r*P+h*E+p*S+f*A,i.data[6]=o*P+c*E+g*S+v*A,i.data[7]=a*P+d*E+_*S+b*A,i.data[8]=n*T+l*k+u*I+m*D,i.data[9]=r*T+h*k+p*I+f*D,i.data[10]=o*T+c*k+g*I+v*D,i.data[11]=a*T+d*k+_*I+b*D,i.data[12]=n*M+l*R+u*B+m*$,i.data[13]=r*M+h*R+p*B+f*$,i.data[14]=o*M+c*R+g*B+v*$,i.data[15]=a*M+d*R+_*B+b*$;const F=this.getScale();return i._scaleSignX=O(F.x)*O(i._scaleSignX),i._scaleSignY=O(F.y)*O(i._scaleSignY),i}}translate(t,e){const i=this.data[0],s=this.data[1],n=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],l=this.data[6],h=this.data[7],c=this.data[8],d=this.data[9],u=this.data[10],p=this.data[11],g=this.data[12],_=this.data[13],m=this.data[14],f=this.data[15];return this.data[12]=i*t+o*e+0*c+1*g,this.data[13]=s*t+a*e+0*d+1*_,this.data[14]=n*t+l*e+0*u+1*m,this.data[15]=r*t+h*e+0*p+1*f,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return A(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],n=this.data[3],r=this.data[4],o=this.data[5],a=this.data[6],l=this.data[7],h=Math.sin(t),c=Math.cos(t);return this.data[0]=c*e+h*r,this.data[1]=c*i+h*o,this.data[2]=c*s+h*a,this.data[3]=c*n+h*l,this.data[4]=c*r-h*e,this.data[5]=c*o-h*i,this.data[6]=c*a-h*s,this.data[7]=c*l-h*n,this}scale(t,e){const i=this.data[0],s=this.data[1],n=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],l=this.data[6],h=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=n*t,this.data[3]=r*t,this.data[4]=o*e,this.data[5]=a*e,this.data[6]=l*e,this.data[7]=h*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){return z(Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX()))}getScaleX(){const t=A(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=A(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return A(this.getScaleX(),this.getScaleY())}setScaleX(t){this._scaleSignX=O(t);const e=A(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t}setScaleY(t){this._scaleSignY=O(t);const e=A(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const e=1/this.getBasisDeterminant(),i=this.data[0],s=this.data[4],n=this.data[1],r=this.data[5],o=t||_t.identity();o.data[0]=r*e,o.data[1]=-n*e,o.data[4]=-s*e,o.data[5]=i*e;const a=this.data[12],l=this.data[13];return o.data[12]=-(a*o.data[0]+l*o.data[4]),o.data[13]=-(a*o.data[1]+l*o.data[5]),o}isIdentity(){return 1===this.data[0]&&0===this.data[1]&&0===this.data[2]&&0===this.data[3]&&0===this.data[4]&&1===this.data[5]&&0===this.data[6]&&0===this.data[7]&&0===this.data[8]&&0===this.data[9]&&1===this.data[10]&&0===this.data[11]&&0===this.data[12]&&0===this.data[13]&&0===this.data[14]&&1===this.data[15]}toString(){return`\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`}}class mt{constructor(){this._transforms=[],this._currentTransform=_t.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class ft{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1}}_cloneState(){return{opacity:this._currentState.opacity}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}}function vt(t,e){return t&&void 0===t.__isProxy?new Proxy(t,{set:(t,i,s)=>(t[i]!==s&&(t[i]=s,"string"==typeof i&&"_"!==i[0]&&e(t)),!0),get:(t,e)=>"__isProxy"===e||t[e]}):t}function bt(t,e){return t&&void 0===t.__isProxy?new Proxy(t,{set:(t,i,s)=>(t[i]=s,"string"==typeof i&&"_"!==i[0]&&e(t),!0),get:(t,e)=>"__isProxy"===e||t[e]}):t}class wt{constructor(t){var e,i,s,n,r,o;this.id=wt._ID++,this.transform=_t.identity(),this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=S.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=null!==(e=t.origin)&&void 0!==e?e:this.origin,this.flipHorizontal=null!==(i=t.flipHorizontal)&&void 0!==i?i:this.flipHorizontal,this.flipVertical=null!==(s=t.flipVertical)&&void 0!==s?s:this.flipVertical,this.rotation=null!==(n=t.rotation)&&void 0!==n?n:this.rotation,this.opacity=null!==(r=t.opacity)&&void 0!==r?r:this.opacity,this.scale=null!==(o=t.scale)&&void 0!==o?o:this.scale)}isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=vt(t,(()=>{this._transformStale=!0})),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=vt(t,(()=>{this._transformStale=!0})),this._transformStale=!0}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return R.fromDimension(this.width,this.height,S.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,n=null!==(e=this.origin)&&void 0!==e?e:A(this.width/2,this.height/2);t.translate(n.x,n.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-n.x,-n.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}function xt(t){return 0==(t&t-1)}function yt(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Ct(t){return xt(t)?t:yt(t)}function Pt(t,e){switch(e){case t.FLOAT:return 4;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.BYTE:case t.UNSIGNED_BYTE:default:return 1}}function Et(t,e){switch(e){case t.LOW_FLOAT:case t.HIGH_FLOAT:case t.FLOAT:return 1;case t.FLOAT_VEC2:return 2;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC4:return 4;case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:case t.SHORT:default:return 1}}function St(t,e){switch(e){case t.LOW_FLOAT:case t.HIGH_FLOAT:case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:return t.FLOAT;case t.BYTE:return t.BYTE;case t.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case t.SHORT:return t.SHORT;case t.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;default:return t.FLOAT}}wt._ID=0,(ut=dt||(dt={})).Pixel="Pixel",ut.Blended="Blended";class At{static register(t){At._GL=t,At._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}static get(t){return At._TEXTURE_MAP.get(t)}static has(t){return At._TEXTURE_MAP.has(t)}static load(t,e,i=!1){const s=At._GL;if(!s)return null;let n=null;if(At.has(t)&&(n=At.get(t)),n){if(i){s.bindTexture(s.TEXTURE_2D,n);const e=At.toPowerOfTwoImage(t);s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)}return n}n=s.createTexture();const r=At.toPowerOfTwoImage(t);At.checkImageSizeSupportedAndLog(t),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const o=null!=e?e:At.filtering;return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o===dt.Pixel?s.NEAREST:s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o===dt.Pixel?s.NEAREST:s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,r),At._TEXTURE_MAP.set(t,n),n}static toPowerOfTwoImage(t){const e=At._POT_CANVAS,i=At._POT_CTX;return xt(t.width)&&xt(t.height)||(e.width=Ct(t.width),e.height=Ct(t.height),i.imageSmoothingEnabled=!1,i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0,t.width,t.height),t=e),t}static checkImageSizeSupportedAndLog(t){var e;const i=null!==(e=t.dataset.originalSrc)&&void 0!==e?e:"internal canvas bitmap";return t.width>At._MAX_TEXTURE_SIZE||t.height>At._MAX_TEXTURE_SIZE?(At._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${At._MAX_TEXTURE_SIZE}x${At._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.\n\nImages will likely render as black rectangles.\n\nRead more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&At._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).\n\nImages will likely render as black rectangles on some mobile platforms.\n\nRead more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}At._LOGGER=v.getInstance(),At.filtering=dt.Blended,At._POT_CANVAS=document.createElement("canvas"),At._POT_CTX=At._POT_CANVAS.getContext("2d"),At._TEXTURE_MAP=new Map,At._MAX_TEXTURE_SIZE=0;class Tt extends wt{constructor(t){var e,i,s,n,r,o,a,l;super(t),this.filtering=null,this._dirty=!0,this._smoothing=!1,this._color=vt(D.Black,(()=>this.flagDirty())),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.color=null!==(e=t.color)&&void 0!==e?e:D.Black,this.strokeColor=null==t?void 0:t.strokeColor,this.smoothing=null!==(i=t.smoothing)&&void 0!==i?i:this.smoothing,this.lineWidth=null!==(s=t.lineWidth)&&void 0!==s?s:this.lineWidth,this.lineDash=null!==(n=t.lineDash)&&void 0!==n?n:this.lineDash,this.padding=null!==(r=t.padding)&&void 0!==r?r:this.padding,this.filtering=null!==(o=t.filtering)&&void 0!==o?o:this.filtering),this._bitmap=document.createElement("canvas");const h=null!==(a=null==t?void 0:t.width)&&void 0!==a?a:this._bitmap.width,c=null!==(l=null==t?void 0:t.height)&&void 0!==l?l:this._bitmap.height;this.width=Ct(h),this.height=Ct(c);const d=this._bitmap.getContext("2d");if(!d)throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic");this._ctx=d}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(null!==(t=this._originalWidth)&&void 0!==t?t:this._bitmap.width)+2*this.padding}_getTotalHeight(){var t;return(null!==(t=this._originalHeight)&&void 0!==t?t:this._bitmap.height)+2*this.padding}get localBounds(){return R.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,S.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=vt(t,(()=>this.flagDirty()))}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=vt(t,(()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore(),At.load(this._bitmap,this.filtering,!0)}_applyRasterProperties(t){var e,i,s;this._bitmap.width=this._getTotalWidth(),this._bitmap.height=this._getTotalHeight(),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash(null!==(e=this.lineDash)&&void 0!==e?e:t.getLineDash()),t.strokeStyle=null===(i=this.strokeColor)||void 0===i?void 0:i.toString(),t.fillStyle=null===(s=this.color)||void 0===s?void 0:s.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.drawImage(this._bitmap,e,i)}}class kt extends Tt{constructor(t){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new kt({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;(null===(e=this._options)||void 0===e?void 0:e.draw)&&(null===(i=this._options)||void 0===i||i.draw(t)),this._options.cache||this.flagDirty()}}(gt=pt||(pt={})).Kill="kill",gt.PreKill="prekill",gt.PostKill="postkill",gt.PreDraw="predraw",gt.PostDraw="postdraw",gt.PreDebugDraw="predebugdraw",gt.PostDebugDraw="postdebugdraw",gt.PreUpdate="preupdate",gt.PostUpdate="postupdate",gt.PreFrame="preframe",gt.PostFrame="postframe",gt.PreCollision="precollision",gt.CollisionStart="collisionstart",gt.CollisionEnd="collisionend",gt.PostCollision="postcollision",gt.Initialize="initialize",gt.Activate="activate",gt.Deactivate="deactivate",gt.ExitViewport="exitviewport",gt.EnterViewport="enterviewport",gt.ExitTrigger="exit",gt.EnterTrigger="enter",gt.Connect="connect",gt.Disconnect="disconnect",gt.Button="button",gt.Axis="axis",gt.Subscribe="subscribe",gt.Unsubscribe="unsubscribe",gt.Visible="visible",gt.Hidden="hidden",gt.Start="start",gt.Stop="stop",gt.PointerUp="pointerup",gt.PointerDown="pointerdown",gt.PointerMove="pointermove",gt.PointerEnter="pointerenter",gt.PointerLeave="pointerleave",gt.PointerCancel="pointercancel",gt.PointerWheel="pointerwheel",gt.Up="up",gt.Down="down",gt.Move="move",gt.Enter="enter",gt.Leave="leave",gt.Cancel="cancel",gt.Wheel="wheel",gt.Press="press",gt.Release="release",gt.Hold="hold",gt.PointerDragStart="pointerdragstart",gt.PointerDragEnd="pointerdragend",gt.PointerDragEnter="pointerdragenter",gt.PointerDragLeave="pointerdragleave",gt.PointerDragMove="pointerdragmove";class It{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class Dt extends It{constructor(t){super(),this.target=t}}class Mt extends It{constructor(t){super(),this.target=t}}class Rt extends It{constructor(t){super(),this.target=t}}class Bt extends It{constructor(t){super(),this.target=t}}class $t extends It{constructor(t){super(),this.target=t}}class Ft extends It{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class Lt extends It{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class Ot extends It{constructor(t,e){super(),this.ctx=t,this.target=e}}class Vt extends It{constructor(t,e){super(),this.ctx=t,this.target=e}}class zt extends It{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class Ut extends It{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class Nt extends It{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class Ht extends It{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class jt extends It{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Wt extends It{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Gt extends It{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class qt extends It{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class Kt extends It{constructor(t,e){super(),this.topic=t,this.handler=e}}class Xt extends It{constructor(t,e){super(),this.topic=t,this.handler=e}}class Yt extends It{constructor(t){super(),this.target=t}}class Zt extends It{constructor(t){super(),this.target=t}}class Qt extends It{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}}class Jt extends It{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class te{constructor(t,e,i){this.target=t,this.other=e,this.contact=i}}class ee{constructor(t,e){this.target=t,this.other=e}}class ie{constructor(t,e,i,s,n){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=n}}class se{constructor(t,e,i,s,n){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=n}}class ne extends It{constructor(t,e,i){super(),this.other=e,this.contact=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class re extends It{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class oe extends It{constructor(t,e){super(),this.engine=t,this.target=e}}class ae extends It{constructor(t,e){super(),this.oldScene=t,this.target=e}}class le extends It{constructor(t,e){super(),this.newScene=t,this.target=e}}class he extends It{constructor(t){super(),this.target=t}}class ce extends It{constructor(t){super(),this.target=t}}class de extends It{constructor(t,e){super(),this.target=t,this.actor=e}}class ue extends It{constructor(t,e){super(),this.target=t,this.actor=e}}class pe{constructor(){this._handlers={},this._wiredEventDispatchers=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}emit(t,e){if(!t)return;let i,s;if(t=t.toLowerCase(),e||(e=new It),this._handlers[t])for(i=0,s=this._handlers[t].length;i<s;i++)this._handlers[t][i](e);for(i=0,s=this._wiredEventDispatchers.length;i<s;i++)this._wiredEventDispatchers[i].emit(t,e)}on(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new Kt(t,e))}off(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(e){const s=i.indexOf(e);this._handlers[t].splice(s,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new Xt(t,e))}once(t,e){this.on(t,(i=>{const s=i||new It;this.off(t,e),e(s)}))}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class ge{constructor(t,e,i=!0){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=v.getInstance(),this.events=new pe}isLoaded(){return null!==this.data}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise(((t,e)=>{if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),void t(this.data);const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",(t=>this.events.emit("loadstart",t))),i.addEventListener("progress",(t=>this.events.emit("progress",t))),i.addEventListener("error",(t=>this.events.emit("error",t))),i.addEventListener("load",(t=>this.events.emit("load",t))),i.addEventListener("load",(()=>{if(0!==i.status&&200!==i.status)return this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),void e(new Error(i.statusText));this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)})),i.send()}))}}var _e=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let me=class{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=(n[s+0]+n[s+1]+n[s+2])/3;n[s+0]=r,n[s+1]=r,n[s+2]=r}};me=_e([E({message:"Grayscale will be removed in v0.26.0"})],me);let fe=class{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;n[s+0]=255-n[s+0],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2]}};fe=_e([E({message:"Invert will be removed in v0.26.0"})],fe);let ve=class{constructor(t){this.opacity=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+3]=Math.round(this.opacity*n[s+3]))}};ve=_e([E({message:"Opacity will be removed in v0.26.0"})],ve);let be=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=(n[s+0]+this.color.r)/2,n[s+1]=(n[s+1]+this.color.g)/2,n[s+2]=(n[s+2]+this.color.b)/2)}};be=_e([E({message:"Colorize will be removed in v0.26.0"})],be);let we=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=D.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).lighten(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};we=_e([E({message:"Lighten will be removed in v0.26.0"})],we);let xe=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=D.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).darken(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};xe=_e([E({message:"Darken will be removed v0.26.0"})],xe);let ye=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=D.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).saturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};ye=_e([E({message:"Saturate will be removed in v0.26.0"})],ye);let Ce=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=D.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).desaturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}};Ce=_e([E({message:"Desaturate will be removed in v0.26.0"})],Ce);let Pe=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=this.color.r,n[s+1]=this.color.g,n[s+2]=this.color.b)}};Pe=_e([E({message:"Fill will be removed in v0.26.0"})],Pe);class Ee{constructor(t,e=!0){this.path=t,this.bustCache=e,this._sprite=null,this.loaded=new Promise((t=>{this._loadedResolve=t})),this._resource=new ge(t,"blob",e),this._sprite=new Te(this,0,0,0,0)}get image(){return this.data}isLoaded(){return!!this.data}async load(){try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=await this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,await e.decode(),this.data=e,this.width=this._sprite.width=e.naturalWidth,this.height=this._sprite.height=e.naturalHeight,this._sprite=new Te(this,0,0,this.width,this.height)}catch(t){await Promise.reject("Error loading texture")}return this._loadedResolve(this.data),this.data}asSprite(){return this._sprite}}function Se(t){return class extends t{assign(t){for(const e in t)"function"!=typeof this[e]&&(this[e]=t[e])}constructor(...t){super(...t),1!==t.filter((function(t){return void 0!==t})).length||!t[0]||"object"!=typeof t[0]||t[0]instanceof Array||this.assign(t[0])}}}class Ae{constructor(t,e,i,s,n){this.x=0,this.y=0,this.rotation=0,this.anchor=S.Half,this.offset=S.Zero,this.scale=S.One,this.drawAroundAnchor=!1,this.logger=v.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!0,this._opacity=1;let r=t;if(t&&!(t instanceof Ee)&&(e=0|t.x,i=0|t.y,s=0|t.width,n=0|t.height,r=t.image,!r))throw new Error("An image texture is required to construct a sprite");this.x=e||0,this.y=i||0,this.texture=r,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=s,this._spriteCanvas.height=n,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._initPixelsFromTexture(),this.width=s,this.height=n}get drawWidth(){return Math.abs(this.width*this.scale.x)}get drawHeight(){return Math.abs(this.height*this.scale.y)}async _initPixelsFromTexture(){try{const t=await this.texture.loaded;this.width=this.width||t.naturalWidth,this.height=this.height||t.naturalHeight,this._spriteCanvas.width=this._spriteCanvas.width||t.naturalWidth,this._spriteCanvas.height=this._spriteCanvas.height||t.naturalHeight,this._loadPixels(),this._dirtyEffect=!0}catch(t){this.logger.error("Error loading texture ",this.texture.path,t)}}_loadPixels(){if(this.texture.isLoaded()&&!this._pixelsLoaded){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${t} of the backing texture ${this.texture.path}`),this.width<=0||t<=0)throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${t}`);if(this.height>e&&this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${e} of the backing texture ${this.texture.path}`),this.height<=0||e<=0)throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${e}`);this._flushTexture(),this._pixelsLoaded=!0}}_flushTexture(){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this.texture.image,V(this.x,0,t),V(this.y,0,e),V(this.width,0,t),V(this.height,0,e),0,0,this.width,this.height)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new me)}invert(){this.addEffect(new fe)}fill(t){this.addEffect(new Pe(t))}colorize(t){this.addEffect(new be(t))}lighten(t=.1){this.addEffect(new we(t))}darken(t=.1){this.addEffect(new xe(t))}saturate(t=.1){this.addEffect(new ye(t))}desaturate(t=.1){this.addEffect(new Ce(t))}addEffect(t){this.effects.push(t),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0}removeEffect(t){let e=-1;e="number"==typeof t?t:this.effects.indexOf(t),e<0||e>=this.effects.length||(this.effects.splice(e,1),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)}_applyEffects(){if(this._flushTexture(),this.effects.length>0){this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);const t=this.effects.length;for(let e=0;e<t;e++)for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.effects[e].updatePixel(i,t,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0)}this._dirtyEffect=!1}clearEffects(){this.effects.length=0,this._applyEffects()}reset(){}debugDraw(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);const s=this.drawWidth*this.anchor.x,n=this.drawHeight*this.anchor.y;t.strokeStyle=D.Black.toString(),t.strokeRect(-s,-n,this.drawWidth,this.drawHeight),t.restore()}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l,h;const{ctx:c,x:d,y:u,rotation:p,drawWidth:g,drawHeight:_,anchor:m,offset:f,opacity:v,flipHorizontal:b,flipVertical:w}={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.width,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.height,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:(null!==(l=t.opacity)&&void 0!==l?l:1)*(null!==(h=this._opacity)&&void 0!==h?h:1)};this._dirtyEffect&&this._applyEffects();const x=g*m.x+f.x,y=_*m.y+f.y,C=this.scale.x>0?1:-1,P=this.scale.y>0?1:-1;c.save(),c.translate(d,u),c.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this.drawAroundAnchor&&c.translate(-x,-y),c.translate(x,y),c.rotate(p),c.scale(C,P),c.translate(-x,-y),b&&(c.translate(g,0),c.scale(-1,1)),w&&(c.translate(0,_),c.scale(1,-1));const E=c.globalAlpha;c.globalAlpha=v,c.drawImage(this._spriteCanvas,0,0,this.width,this.height,0,0,this.width,this.height),c.globalAlpha=E,c.restore()}clone(){const t=new Te(this.texture,this.x,this.y,this.width,this.height);t.anchor=this.anchor.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;const e=this.effects.length;for(let i=0;i<e;i++)t.addEffect(this.effects[i]);return t}}let Te=class extends(Se(Ae)){constructor(t,e,i,s,n){super(t,e,i,s,n)}};Te=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([E({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],Te);class ke extends wt{constructor(t){var e,i;super(t),this._dirty=!0,this.image=t.image;const{width:s,height:n}=t;this.sourceView=null!==(e=t.sourceView)&&void 0!==e?e:{x:0,y:0,width:null!=s?s:0,height:null!=n?n:0},this.destSize=null!==(i=t.destSize)&&void 0!==i?i:{width:null!=s?s:0,height:null!=n?n:0},this._updateSpriteDimensions(),this.image.ready.then((()=>{this._updateSpriteDimensions()}))}static from(t){return new ke({image:t})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,s,n,r;const{width:o,height:a}=this.image;this.sourceView.width=(null===(t=this.sourceView)||void 0===t?void 0:t.width)||o,this.sourceView.height=(null===(e=this.sourceView)||void 0===e?void 0:e.height)||a,this.destSize.width=(null===(i=this.destSize)||void 0===i?void 0:i.width)||(null===(s=this.sourceView)||void 0===s?void 0:s.width)||o,this.destSize.height=(null===(n=this.destSize)||void 0===n?void 0:n.height)||(null===(r=this.sourceView)||void 0===r?void 0:r.height)||a,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()&&t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height)}static fromLegacySprite(t){const e=t.texture,i=Ie.fromLegacyTexture(e);return new ke({image:i,sourceView:{x:t.x,y:t.y,width:t.width,height:t.height}})}static toLegacySprite(t){const e=t.image,i=new Ee(e.path);return i.data=e.image,new Te(i,t.sourceView.x,t.sourceView.y,t.sourceView.width,t.sourceView.height)}clone(){return new ke({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}class Ie{constructor(t,e=!1,i){this.path=t,this._logger=v.getInstance(),this.data=new Image,this._resource=new ge(t,"blob",e),this._filtering=i,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`),this.ready=new Promise((t=>{this._loadedResolve=t}))}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}async load(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=await this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,e.setAttribute("data-original-src",this.path),await e.decode(),this.data=e}catch(t){throw`Error loading ImageSource from path '${this.path}' with error [${t.message}]`}return At.load(this.data,this._filtering),this._loadedResolve(this.data),this.data}toSprite(){return ke.from(this)}static fromLegacyTexture(t){const e=new Ie(t.path);return t.isLoaded()?e.data=t.data:t.loaded.then((()=>{e.data=t.data})),e}unload(){this.data=new Image}}class De{constructor(t,e,i,s){this.sprites=[],this.currentFrame=0,this._timeLeftInFrame=0,this._idempotencyToken=-1,this.anchor=S.Zero,this.rotation=0,this.scale=S.One,this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0,this._opacity=1;let n=t;if(t&&!(t instanceof Xr)){const r=t;n=r.engine,e=r.sprites,i=r.speed,s=r.loop}this.sprites=e,this.speed=i,this._engine=n,this._timeLeftInFrame=this.speed,null!=s&&(this.loop=s),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new me)}invert(){this.addEffect(new fe)}fill(t){this.addEffect(new Pe(t))}colorize(t){this.addEffect(new be(t))}lighten(t=.1){this.addEffect(new we(t))}darken(t=.1){this.addEffect(new xe(t))}saturate(t=.1){this.addEffect(new ye(t))}desaturate(t=.1){this.addEffect(new Ce(t))}addEffect(t){for(const e in this.sprites)this.sprites[e].addEffect(t)}removeEffect(t){for(const e in this.sprites)this.sprites[e].removeEffect(t)}clearEffects(){for(const t in this.sprites)this.sprites[t].clearEffects()}_setAnchor(t){for(const e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)}_setRotation(t){for(const e in this.sprites)this.sprites[e].rotation=t}_setScale(t){for(const e in this.sprites)this.sprites[e].scale=t}reset(){this.currentFrame=0}isDone(){return!this.loop&&this.currentFrame>=this.sprites.length}tick(t,e){if(this._idempotencyToken===e)return;this._idempotencyToken=e,this._timeLeftInFrame-=t,this._timeLeftInFrame<=0&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._timeLeftInFrame=this.speed),this._updateValues();const i=this.sprites[this.currentFrame];i&&(this.width=i.width,this.height=i.height,this.drawWidth=i.drawWidth,this.drawHeight=i.drawHeight)}_updateValues(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)}skip(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l;const h={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,opacity:(null!==(a=t.opacity)&&void 0!==a?a:1)*(null!==(l=this._opacity)&&void 0!==l?l:1)};let c;this._updateValues(),this.currentFrame<this.sprites.length&&(c=this.sprites[this.currentFrame],c.draw(h)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(c=this.sprites[V(this.freezeFrame,0,this.sprites.length-1)],c.draw(h)),c&&(this.drawWidth=c.drawWidth,this.drawHeight=c.drawHeight)}play(t,e){this.reset(),this._engine.playAnimation(this,t,e)}}let Me=class extends(Se(De)){constructor(t,e,i,s){super(t,e,i,s)}};var Re,Be,$e,Fe,Le,Oe,Ve,ze,Ue,Ne;Me=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([E({message:"Animation will be removed in v0.26.0",alternateMethod:"Use Graphics.Animation"})],Me),(Be=Re||(Re={})).Em="em",Be.Rem="rem",Be.Px="px",Be.Pt="pt",Be.Percent="%",(Fe=$e||($e={})).Left="left",Fe.Right="right",Fe.Center="center",Fe.Start="start",Fe.End="end",(Oe=Le||(Le={})).Top="top",Oe.Hanging="hanging",Oe.Middle="middle",Oe.Alphabetic="alphabetic",Oe.Ideographic="ideographic",Oe.Bottom="bottom",(ze=Ve||(Ve={})).Normal="normal",ze.Italic="italic",ze.Oblique="oblique",(Ne=Ue||(Ue={})).LeftToRight="ltr",Ne.RightToLeft="rtl";class He{constructor(t,e,i,s,n,r){this._sprites=[],this._image=null,this._columns=0,this._rows=0,this._spWidth=0,this._spHeight=0,this._spacing=0;let o=!1;if(t instanceof Array?this._sprites=t:(!t||t instanceof Ee?(this._image=t,this._columns=e,this._rows=i,this._spWidth=s,this._spHeight=n,this._spacing=r||0):(this._columns=t.columns,this._rows=t.rows,this._spWidth=t.spWidth,this._spHeight=t.spHeight,this._image=t.image,this._spacing=t.spacing||0),this._sprites=new Array(this._columns*this._rows),o=!0),this.image instanceof Ee){let t=!1,e=!1;if(this.image.isLoaded()){if(t=this.spWidth*this.columns>this.image.image.naturalWidth,e=this.spHeight*this.rows>this.image.image.naturalHeight,t)throw new RangeError(`SpriteSheet specified is wider, ${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} pixels than image width`);if(e)throw new RangeError(`SpriteSheet specified is taller, ${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} pixels than image height`)}}if(o){const t=this.getSpacingDimensions();for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this._sprites[i+e*this.columns]=new Te(this.image,i*this.spWidth+t.margin*i+t.left,e*this.spHeight+t.margin*e+t.top,this.spWidth,this.spHeight)}}get spacing(){return this._spacing}get sprites(){return[...this._sprites]}get image(){return this._image}get columns(){return this._columns}get rows(){return this._rows}get spWidth(){return this._spWidth}get spHeight(){return this._spHeight}getSpacingDimensions(){var t,e,i;return"number"==typeof this.spacing?{left:this.spacing,top:this.spacing,margin:this.spacing}:{left:null!==(t=this.spacing.left)&&void 0!==t?t:0,top:null!==(e=this.spacing.top)&&void 0!==e?e:0,margin:null!==(i=this.spacing.margin)&&void 0!==i?i:0}}getAnimationByIndices(t,e,i){let s=e.map((t=>this.sprites[t]));return s=s.map((function(t){return t.clone()})),new Me(t,s,i)}getAnimationBetween(t,e,i,s){let n=this.sprites.slice(e,i);return n=n.map((function(t){return t.clone()})),new Me(t,n,s)}getAnimationForAll(t,e){const i=this.sprites.map((function(t){return t.clone()}));return new Me(t,i,e)}getSprite(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)}getAnimationByCoords(t,e,i){let s=0,n=0;const r=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t];i.image=i.image||this.image,s=Math.max(s,i.drawWidth),n=Math.max(n,i.drawHeight),r[t]=new Te(i)}const o=new Me(t,r,i);return o.drawWidth=s,o.drawHeight=n,o}}let je=class extends He{constructor(t,e,i,s,n,r,o,a){super(t instanceof Ee?{image:t,spWidth:r,spHeight:o,rows:n,columns:s,spacing:a||0}:t),this._currentColor=D.Black,this._currentOpacity=1,this._spriteRecord={},this._textShadowOn=!1,this._textShadowDirty=!0,this._textShadowColor=D.Black,this._textShadowSprites={},this._shadowOffsetX=5,this._shadowOffsetY=5,!t||t instanceof Ee||(e=t.alphabet,i=t.caseInsensitive),this.alphabet=e,this.caseInsensitive=i,this._spriteRecord=this.getTextSprites()}getTextSprites(){const t={};for(let e=0;e<this.alphabet.length;e++){let i=this.alphabet[e];this.caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t}setTextShadow(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0;for(const t in this._spriteRecord)this._textShadowSprites[t]=this._spriteRecord[t].clone()}useTextShadow(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)}draw(t,e,i,s,n){if(n=this._parseOptions(n),this._currentColor.toString()!==n.color.toString()||this._currentOpacity!==n.opacity){this._currentOpacity=n.opacity,this._currentColor=n.color;for(const t in this._spriteRecord)this._spriteRecord[t].clearEffects(),this._spriteRecord[t].fill(n.color),this._spriteRecord[t].opacity(n.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(const t in this._textShadowSprites)this._textShadowSprites[t].clearEffects(),this._textShadowSprites[t].addEffect(new Pe(this._textShadowColor.clone()));this._textShadowDirty=!1}const r=this.sprites[0],o=r.height,a=n.fontSize/o,l=e.length*r.width*a+e.length*n.letterSpacing;let h=i;n.textAlign===$e.Left||n.textAlign===$e.Start?h=i:n.textAlign===$e.Right||n.textAlign===$e.End?h=i-l:n.textAlign===$e.Center&&(h=i-l/2);let c=s-o*a;n.baseAlign===Le.Top||n.baseAlign===Le.Hanging?c=s:n.baseAlign===Le.Ideographic||n.baseAlign===Le.Bottom||n.baseAlign===Le.Alphabetic?c=s-o*a:n.baseAlign===Le.Middle&&(c=s-o*a/2);for(let i=0;i<e.length;i++){let s=e[i];this.caseInsensitive&&(s=s.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[s].drawAroundAnchor=!1,this._textShadowSprites[s].scale=A(a,a),this._textShadowSprites[s].draw(t,h+this._shadowOffsetX,c+this._shadowOffsetY));const e=this._spriteRecord[s];e.drawAroundAnchor=!1,e.scale=A(a,a),e.draw(t,h,c),h+=e.drawWidth+n.letterSpacing}catch(t){v.getInstance().error(`SpriteFont Error drawing char ${s}`)}}}_parseOptions(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||D.Black,textAlign:(t.textAlign,t.textAlign),baseAlign:(t.baseAlign,t.baseAlign),maxWidth:t.maxWidth||-1,opacity:t.opacity||0}}};je=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([E({message:"SpriteSheet will be removed in v0.26.0",alternateMethod:"Use Graphics.SpriteSheet"})],je);class We{constructor(t){this._logger=v.getInstance(),this.sprites=[];const{sprites:e,rows:i,columns:s}=t;this.sprites=e,this.rows=null!=i?i:1,this.columns=null!=s?s:this.sprites.length}getSprite(t,e){if(t>=this.columns||t<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1}`),null;if(e>=this.rows||e<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1}`),null;const i=t+e*this.columns;return this.sprites[i]}static fromLegacySpriteSheet(t){const e=t.sprites.map((t=>ke.fromLegacySprite(t)));return new We({sprites:e})}static toLegacySpriteSheet(t){const e=t.sprites.map((t=>ke.toLegacySprite(t)));return new He(e)}static fromImageSource(t){var e;const i=[];t.spacing=null!==(e=t.spacing)&&void 0!==e?e:{};const{image:s,grid:{rows:n,columns:r,spriteWidth:o,spriteHeight:a},spacing:{originOffset:l,margin:h}}=t,c={x:0,y:0,...l},d={x:0,y:0,...h};for(let t=0;t<r;t++)for(let e=0;e<n;e++)i[t+e*r]=new ke({image:s,sourceView:{x:t*o+d.x*t+c.x,y:e*a+d.y*e+c.y,width:o,height:a},destSize:{height:a,width:o}});return new We({sprites:i,rows:n,columns:r})}}class Ge extends wt{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=v.getInstance(),this._alreadyWarnedAlphabet=!1,this._alreadyWarnedSpriteSheet=!1;const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:n,shadow:r}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=null!=s?s:this.caseInsensitive,this.spacing=null!=n?n:this.spacing,this.shadow=null!=r?r:this.shadow}static fromLegacySpriteFont(t){const e=t.sprites.map(ke.fromLegacySprite);return new Ge({alphabet:t.alphabet,spacing:0,caseInsensitive:t.caseInsensitive,spriteSheet:new We({sprites:e})})}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let t=0;t<i.length;t++){const n=i[t];let r=s.indexOf(n);-1===r&&(r=0,this._alreadyWarnedAlphabet||(this._logger.warn(`SpriteFont - Cannot find letter '${n}' in configured alphabet '${s}'.`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedAlphabet=!0));const o=this.spriteSheet.sprites[r];o?e.push(o):this._alreadyWarnedSpriteSheet||(this._logger.warn(`SpriteFont - Cannot find sprite for '${n}' at index '${r}' in configured SpriteSheet`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedSpriteSheet=!0)}return e}measureText(t){const e=t.split("\n"),i=e.reduce(((t,e)=>t.length>e.length?t:e)),s=this._getCharacterSprites(i);let n=0,r=0;for(const t of s)n+=t.width+this.spacing,r=Math.max(r,t.height);return R.fromDimension(n,r*e.length,S.Zero)}_drawImage(t,e,i){let s=0,n=0,r=0;const o=this._text.split("\n");for(const a of o){for(const o of this._getCharacterSprites(a))o.draw(t,e+s,i+n),s+=o.width+this.spacing,r=Math.max(r,o.height);s=0,n+=r}}render(t,e,i,s,n){this._text=e;const r=this.measureText(e);this.width=r.width,this.height=r.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this.draw(t,s,n),t.restore()),this.draw(t,s,n)}clone(){return new Ge({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}}class qe{constructor(){this.fontSheet="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAwCAYAAAD+f6R/AAAAAXNSR0IArs4c6QAABcJJREFUeJztnemu7CgMhGE07//KmT9NhrAFVzkQndQntXRP3/bCZkwCSQhCCCGEEEIIIYQQQog/TRz953Ecx/nDGIe/vdNhlc9tIz605Fk/ZmWfsO1hn9Gxuv1KHbvb3iL/VN+d1WORbyr7yR/5b9M4vjNeqko6jPJHq5wGHU151o9J2Udse9hndCxuv0rH7rY3yD/Wdyf13MrnQeDfkZIUSGKM4ff3cWN82pEZuTyQGX2IxeyR63va//8VNCYCq+1yEkLtWyagXv1P1r1H+110gP3PzT4gT8uW/mdQ8mUG8E9DqOz4MS9ICKGbXpS2BpnIrRzYeS96cll08INlCMl2/glzdcfazuuPqQO03lmqrBHsf272Q6NODXj6zzZIJd/LAHYTg3Mays5gBi7ZR27fOgs0yj8rm36DLMFiPgkAdXHKOwUQeMCQ/adSh/qBQrT/tPxbAwA9+DOZEILPAATSuHMgTv7+Auk/df2lHPCZLvMSLJe34LkEQ9PwXF1SRTllMYgvIaflqyVAjLGbsiCDcOK76jflxZ+sINPyROc5071yKWK5CJTV3dMp6+tBlyCtNlhAq/+XbWoBDcRNXYBMzD4VvQygSuPYC2jGGaSSOxXfy3dTUEsanIvNeepm38N/hssSALTPZnAXfwIYRJn2b7UBcw0FKX+nDdAMpm2j9WVnxrUa7TXaVAca/B+TgaAVh6R/rH0P/5m01dt/RLYViJn+w/bhVX2P7f/duqom5qb02pRLCLGIMgBU1wCEEN9BAUCID6MAIMSHUQAQ4sMoAAjxYRQAhPgwd1uB0fuZ7H3cnn2P+9mr/Pe4B8/eB/fwP4eRtci/0f6OfTCPt/9oHwC6G6y19RHZDumxmwzR4eE/s/2Tte/q/+XLdc9DeJ19diesQc/j7Z8fCe4tAS4CxZ7sp7eiJi7HiZmjmOTGJs+93CbS3nP0XIPH3vW8/qz6QPnX2QdsV/1uw/iZYvg8ACeHd28rpPzfNfhL+7vkw/4Ou9s+Onhbv91elpKZ48Dl6bzpwwibHigRArf+Ptk9+L3Y1Q5OB4LgCeSBw1iuB3GeJh1/HrX/zF0A9Mk+u45zMkc3r4rWPomma5+p/514LB+Zo93MErJ1JHxXPzByGa/licRYVKbpeQCoQ6Q8yxuCwJF9IPsoDkHAo/3Tx26cvA4EtJ/n04w8QOq/mrR7ddfLAC5BYFNlVI/0CnOVUflOpvJUQMx9AIMIW/nWDM67/qw0+95v9goBqD9j+72u/KD9U89IbnQbMIR2Zbneh5zUY7Hdk7XIP3UffVb+r+wDYAZLq+1n1+C7y3/ny2r7p5yeByDEh9HzAIQQJwoAQnwYBQAhPowCgBBjoNu3hNxSFACE6INuKvPajPZ4EFEAEKINcybGYzOd247WEd3TgA2jlmjEyrd+j9hvfVbD2PWQ3ZmGlu2HyO8og8eBuNUvNYWoDgMVpwHTJoLWdz1Y+ZYOy5uF7t6PPruZxANrud1lQXkP0jsGz/Yz+vGGMuygFyhSPcJnc1pMnQZElc+cRnoAlxdTvoDuK7puqF7uCQy+3fyFMiA02/vJQHh7DQDogMPTSGFNA56HTzbZ9yAfBOb1Zyo3qGM3MfMZ3f76huXf6xlmAHknMlLNXsBBBvbljIz9Uyz5Y5TzIBLR/qy/rNyrZ8+L/0BZ0m+tgXD0OK5XZxC/9P7I/g4hVFvzXf1/6i5A7+3AlijMPBLMZfCvuAp7A9rY56ApHitmLQc7c8bOv6ftAxlM9Xp35nkEK7nJetBsaMhtAAAuOLQGXwhh2dXQnn1rZ/a42BI3dL7L+jkFAbQddwdA9Ah35yMKhgEgVT46EFh5D4jz+OgavNKxeBCd1wDSJ/97oR8eoJkLi9t9/BDgDHTJ5NE7Dnzechh914OVv9M1K9PCqsfqb88XVg9qN9lm6nG176UPu+zn17GOxuO0vOWEEC/j+LFKTgghlvEfYJaLS+SA2O0AAAAASUVORK5CYII=",this.size=16,this.load()}load(){return this._imageSource=new Ie(this.fontSheet),this._imageSource.load().then((()=>{this._spriteSheet=We.fromImageSource({image:this._imageSource,grid:{rows:3,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Ge({alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&.\"?-()+ ",caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})}))}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class Ke{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Xe{constructor(t){this.width=t.width,this.height=t.height,this._gl=t.gl,this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return new Ke(this._gl,this._frameTexture)}use(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}class Ye{static clear(){Ye._GL=null}static register(t){Ye._GL=t}static get gl(){if(!Ye._GL)throw Error("Attempted gl access before init");return Ye._GL}}class Ze{constructor(t){this._gl=Ye.gl,this.uniforms={},this.attributes={},this._compiled=!1;const{vertexSource:e,fragmentSource:i}=t;this.vertexSource=e,this.fragmentSource=i}get compiled(){return this._compiled}use(){this._gl.useProgram(this.program),Ze._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ze._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const s=this.getAttributes();for(const t of s)this.attributes[t.name]=t;const n=this.getUniforms();for(const t of n)this.uniforms[t.name]=t;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let s=0;s<e;s++){const e=t.getActiveUniform(this.program,s),n=t.getUniformLocation(this.program,e.name);i.push({name:e.name,glType:e.type,location:n})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let s=0;s<e;s++){const e=t.getActiveAttrib(this.program,s),n=t.getAttribLocation(this.program,e.name);i.push({name:e.name,glType:St(t,e.type),size:Et(t,e.type),location:n,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const s=this._gl.getUniformLocation(this.program,e);if(!s)throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`);{const e=[s,...i];this._gl[t].apply(this._gl,e)}}_createProgram(t,e,i){const s=t.createProgram();if(null===s)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.VERTEX_SHADER===i?"vertex":"fragment",n=t.createShader(i);if(null===n)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(n);throw Error(`Could not compile ${s} shader:\n\n${i}${this._processSourceForError(e,i)}`)}return n}_processSourceForError(t,e){const i=t.split("\n"),s=e.search(/\d:\d/),n=e.indexOf(" ",s),[r,o]=e.slice(s,n).split(":").map((t=>Number(t)));for(let t=0;t<i.length;t++)i[t]=`${t+1}: ${i[t]}${o===t+1?" <----- ERROR!":""}`;return"\n\nSource:\n"+i.join("\n")}}Ze._ACTIVE_SHADER_INSTANCE=null;class Qe{constructor(t){this._gl=Ye.gl,this.type="dynamic";const{size:e,type:i,data:s}=t;if(this.buffer=this._gl.createBuffer(),!s&&!e)throw Error("Must either provide data or a size to the VertexBuffer");this.bufferData=s||new Float32Array(e),this.type=null!=i?i:this.type}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}upload(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.bufferData,"static"===this.type?t.STATIC_DRAW:t.DYNAMIC_DRAW)}}class Je{constructor(t){this._gl=Ye.gl,this._logger=v.getInstance(),this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0;const{shader:e,vertexBuffer:i,attributes:s}=t;this._vertexBuffer=i,this._attributes=s,this._shader=e,this.initialize()}get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}initialize(){if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._layout.length=0;const t=this._shader.attributes;for(const e of this._attributes){const i=t[e[0]];if(!i)throw Error(`The attribute named: ${e[0]} size ${e[1]} not found in the shader source code:\n ${this._shader.vertexSource}`);if(i.size!==e[1])throw Error(`VertexLayout size definition for attribute: [${e[0]}, ${e[1]}], doesnt match shader source size ${i.size}:\n ${this._shader.vertexSource}`);this._layout.push(i)}let e=0;for(const t of this._layout){const i=Pt(this._gl,t.glType);this._vertexTotalSizeBytes+=i*t.size,e+=t.size}this._vertexBuffer.bufferData.length%e!=0&&this._logger.warn(`The vertex component size (${e})  does divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`)}use(t=!1){const e=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload();let i=0;for(const t of this._layout)e.vertexAttribPointer(t.location,t.size,t.glType,t.normalized,this.totalVertexSizeBytes,i),e.enableVertexAttribArray(t.location),i+=Pt(e,t.glType)*t.size}}class ti{static clear(){ti.DrawCallCount=0,ti.DrawnImagesCount=0}}ti.DrawCallCount=0,ti.DrawnImagesCount=0;class ei{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ze({vertexSource:"attribute vec2 a_position;\nattribute vec4 a_color;\n\nvarying lowp vec4 v_color;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Passthrough the color\n   v_color = a_color;\n}",fragmentSource:"precision mediump float;\n\n// Color\nvarying lowp vec4 v_color;\n\n\nvoid main() {\n  gl_FragColor = v_color;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Qe({size:12*this._maxLines,type:"dynamic"}),this._layout=new Je({vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const s=this._context.getTransform(),n=s.multiply(t),r=s.multiply(e),o=this._vertexBuffer.bufferData;o[this._vertexIndex++]=n.x,o[this._vertexIndex++]=n.y,o[this._vertexIndex++]=i.r/255,o[this._vertexIndex++]=i.g/255,o[this._vertexIndex++]=i.b/255,o[this._vertexIndex++]=i.a,o[this._vertexIndex++]=r.x,o[this._vertexIndex++]=r.y,o[this._vertexIndex++]=i.r/255,o[this._vertexIndex++]=i.g/255,o[this._vertexIndex++]=i.b/255,o[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return 0!==this._lineCount}flush(){if(0===this._lineCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,2*this._lineCount),ti.DrawnImagesCount+=this._lineCount,ti.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}class ii{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ze({vertexSource:"attribute vec2 a_position;\nattribute vec4 a_color;\nattribute float a_size;\nvarying lowp vec4 v_color;\nuniform mat4 u_matrix;\n\nvoid main() {\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n  gl_PointSize = a_size * 2.0;\n  v_color = a_color;\n}",fragmentSource:'#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\nvarying lowp vec4 v_color;\n\nvoid main() {\n  float r = 0.0, delta = 0.0, alpha = 1.0;\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  r = dot(cxy, cxy);\n\n#ifdef GL_OES_standard_derivatives\n  delta = fwidth(r);\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n#else\n  if (r > 1.0) {\n    discard;\n  }\n#endif\n  // "premultiply" the color by alpha\n  vec4 color = v_color;\n  color.a = color.a * alpha;\n  color.rgb = color.rgb * color.a;\n  gl_FragColor = color;\n}'}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Qe({size:7*this._maxPoints,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const s=this._context.getTransform(),n=this._context.opacity,r=s.multiply(t),o=this._buffer.bufferData;o[this._vertexIndex++]=r.x,o[this._vertexIndex++]=r.y,o[this._vertexIndex++]=e.r/255,o[this._vertexIndex++]=e.g/255,o[this._vertexIndex++]=e.b/255,o[this._vertexIndex++]=e.a*n,o[this._vertexIndex++]=i*Math.max(s.getScaleX(),s.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return 0!==this._pointCount}flush(){if(0===this._pointCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),ti.DrawnImagesCount+=this._pointCount,ti.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}class si{constructor(t){this._gl=t,this._shader=new Ze({vertexSource:"attribute vec2 a_position;\n\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = vec4(a_position, 0.0, 1.0);\n\n  // Pass the texcoord to the fragment shader.\n  v_texcoord = a_texcoord;\n}",fragmentSource:"precision mediump float;\n\n// Passed in from the vertex shader.\nvarying vec2 v_texcoord;\n\n// The texture.\nuniform sampler2D u_texture;\n\nvoid main() {\n   gl_FragColor = texture2D(u_texture, v_texcoord);\n}"}),this._shader.compile(),this._buffer=new Qe({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl;t.getShader().use(),t.getLayout().use(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class ni{constructor(t,e){this._gl=Ye.gl,this._logger=v.getInstance();const i=this._gl;this.buffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.buffer);const s=6*t;if(i.getExtension("OES_element_index_uint")&&!e)this.bufferData=new Uint32Array(s);else{const e=65535,n=Math.floor((e-1)/4);this.bufferGlType=i.UNSIGNED_SHORT,this.bufferData=new Uint16Array(s),t>n&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${n}) requested quads(${t})`)}let n=0;for(let t=0;t<s;t+=6)this.bufferData[t+0]=n+0,this.bufferData[t+1]=n+1,this.bufferData[t+2]=n+2,this.bufferData[t+3]=n+2,this.bufferData[t+4]=n+1,this.bufferData[t+5]=n+3,n+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.bufferData,i.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}}class ri{constructor(){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const i=this._transformFragmentSource("precision mediump float;\n\n// UV coord\nvarying vec2 v_texcoord;\n\n// Texture index\nvarying lowp float v_textureIndex;\n\n// Textures in the current draw\nuniform sampler2D u_textures[%%count%%];\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n   // In order to support the most efficient sprite batching, we have multiple\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\n   // that do not apply to a particular sprite.\n\n   vec4 color = vec4(1.0, 0, 0, 1.0);\n\n   // GLSL is templated out to pick the right texture and set the vec4 color\n   %%texture_picker%%\n\n   color.rgb = color.rgb * v_opacity;\n   color.a = color.a * v_opacity;\n   gl_FragColor = color;\n}",this._maxTextures);this._shader=new Ze({fragmentSource:i,vertexSource:"attribute vec2 a_position;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\n// UV coordinate\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n\n// Texture number\nattribute lowp float a_textureIndex;\nvarying lowp float v_textureIndex;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the UV coord to the fragment shader\n   v_texcoord = a_texcoord;\n   // Pass through the texture number to the fragment shader\n   v_textureIndex = a_textureIndex;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map(((t,e)=>e))),this._buffer=new Qe({size:24*this._maxImages,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_texcoord",2],["a_textureIndex",1]]}),this._quads=new ni(this._maxImages,!0)}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let t=0;t<e;t++)s+=0===t?`if (v_textureIndex <= ${t}.5) {\n`:`   else if (v_textureIndex <= ${t}.5) {\n`,s+=`      color = texture2D(u_textures[${t}], v_texcoord);\n`,s+="   }\n";return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){const e=At.load(t);-1===this._textures.indexOf(e)&&this._textures.push(e)}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){return t?this._textures.indexOf(At.get(t)):-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}draw(t,e,i,s,n,r,o,a,l){var h,c,d,u;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);let p=(null==t?void 0:t.width)||s||0,g=(null==t?void 0:t.height)||n||0,_=[0,0,null!==(h=null!=s?s:null==t?void 0:t.width)&&void 0!==h?h:0,null!==(c=null!=n?n:null==t?void 0:t.height)&&void 0!==c?c:0],m=[null!=e?e:1,null!=i?i:1];void 0!==r&&void 0!==o&&void 0!==a&&void 0!==l&&(_=[null!=e?e:1,null!=i?i:1,null!==(d=null!=s?s:null==t?void 0:t.width)&&void 0!==d?d:0,null!==(u=null!=n?n:null==t?void 0:t.height)&&void 0!==u?u:0],m=[r,o],p=a,g=l),e=_[0],i=_[1];const f=_[2],v=_[3],b=this._context.getTransform(),w=this._context.opacity,x=this._context.snapToPixel;let y=A(m[0],m[1]),C=A(m[0]+p,m[1]),P=A(m[0],m[1]+g),E=A(m[0]+p,m[1]+g);y=b.multiply(y),C=b.multiply(C),P=b.multiply(P),E=b.multiply(E),x&&(y.x=~~y.x,y.y=~~y.y,C.x=~~C.x,C.y=~~C.y,P.x=~~P.x,P.y=~~P.y,E.x=~~E.x,E.y=~~E.y);const S=this._getTextureIdForImage(t),T=Ct(t.width||p),k=Ct(t.height||g),I=e/T,D=i/k,M=(e+f-.01)/T,R=(i+v-.01)/k,B=this._layout.vertexBuffer.bufferData;B[this._vertexIndex++]=y.x,B[this._vertexIndex++]=y.y,B[this._vertexIndex++]=w,B[this._vertexIndex++]=I,B[this._vertexIndex++]=D,B[this._vertexIndex++]=S,B[this._vertexIndex++]=P.x,B[this._vertexIndex++]=P.y,B[this._vertexIndex++]=w,B[this._vertexIndex++]=I,B[this._vertexIndex++]=R,B[this._vertexIndex++]=S,B[this._vertexIndex++]=C.x,B[this._vertexIndex++]=C.y,B[this._vertexIndex++]=w,B[this._vertexIndex++]=M,B[this._vertexIndex++]=D,B[this._vertexIndex++]=S,B[this._vertexIndex++]=E.x,B[this._vertexIndex++]=E.y,B[this._vertexIndex++]=w,B[this._vertexIndex++]=M,B[this._vertexIndex++]=R,B[this._vertexIndex++]=S}hasPendingDraws(){return 0!==this._imageCount}flush(){if(0===this._imageCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._imageCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._imageCount,ti.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0}}class oi{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,t.getExtension("OES_standard_derivatives"),this._shader=new Ze({fragmentSource:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision mediump float;\n\n// UV coord\nvarying vec2 v_uv;\n\nvarying vec2 v_size; // in pixels\n\n// Color coord to blend with image\nvarying lowp vec4 v_color;\n\n// Stroke color if used\nvarying lowp vec4 v_strokeColor;\n\n// Stroke thickness if used\nvarying lowp float v_strokeThickness; // in pixels\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n    vec2 uv = v_uv;\n    vec2 fragCoord = uv * v_size;\n    float maxX = v_size.x - v_strokeThickness;\n    float minX = v_strokeThickness;\n    float maxY = v_size.y - v_strokeThickness;\n    float minY = v_strokeThickness;\n\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\n        fragCoord.y < maxY && fragCoord.y > minY) {\n      gl_FragColor = v_color;\n    } else {\n      gl_FragColor = v_strokeColor;\n    }\n    gl_FragColor.a *= v_opacity;\n    gl_FragColor.rgb *= gl_FragColor.a;\n\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\n\n    // float fHalfBorderDist      = 0.0;\n    // float fHalfBorderThickness = 0.0;\n\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\n    // {\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\n    // }\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\n    // {\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\n    // }\n    // else\n    // {\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\n        \n    //     float ellipse_ab    = v_radius-v_strokeThickness;\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \n            \n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\n    // }\n\n    // vec4 v4FromColor = v_strokeColor;\n    // v4FromColor.rgb *= v4FromColor.a;\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\n    // if (fHalfBorderDist < 0.0) {\n    //     v4ToColor = v_color;\n    //     v4ToColor.rgb *= v4ToColor.a;\n    // }\n\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\n\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\n    // gl_FragColor = finalColor;\n}",vertexSource:"attribute vec2 a_position;\n\n// UV coordinate\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n\nattribute vec2 a_size;\nvarying vec2 v_size;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\nattribute vec4 a_color;\nvarying vec4 v_color;\n\nattribute vec4 a_strokeColor;\nvarying vec4 v_strokeColor;\n\nattribute float a_strokeThickness;\nvarying float v_strokeThickness;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through UV coords\n   v_uv = a_uv;\n   // Pass through size\n   v_size = a_size;\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the color to the fragment shader\n   v_color = a_color;\n   // Pass through the stroke color to the fragment shader\n   v_strokeColor = a_strokeColor;\n   // Pass through the stroke thickenss to the fragment shader\n   v_strokeThickness = a_strokeThickness;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Qe({size:64*this._maxRectangles,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ni(this._maxRectangles,!0)}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof S&&t[1]instanceof S?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,s=1){this._isFull()&&this.flush(),this._rectangleCount++;const n=this._context.getTransform(),r=this._context.opacity,o=e.sub(t),a=o.size,l=o.normalize().perpendicular(),h=s/2,c=n.multiply(l.scale(h).add(t)),d=n.multiply(l.scale(-h).add(t)),u=n.multiply(l.scale(h).add(e)),p=n.multiply(l.scale(-h).add(e)),g=D.Transparent,_=this._layout.vertexBuffer.bufferData;_[this._vertexIndex++]=c.x,_[this._vertexIndex++]=c.y,_[this._vertexIndex++]=0,_[this._vertexIndex++]=0,_[this._vertexIndex++]=a,_[this._vertexIndex++]=s,_[this._vertexIndex++]=r,_[this._vertexIndex++]=i.r/255,_[this._vertexIndex++]=i.g/255,_[this._vertexIndex++]=i.b/255,_[this._vertexIndex++]=i.a,_[this._vertexIndex++]=g.r/255,_[this._vertexIndex++]=g.g/255,_[this._vertexIndex++]=g.b/255,_[this._vertexIndex++]=g.a,_[this._vertexIndex++]=0,_[this._vertexIndex++]=d.x,_[this._vertexIndex++]=d.y,_[this._vertexIndex++]=0,_[this._vertexIndex++]=1,_[this._vertexIndex++]=a,_[this._vertexIndex++]=s,_[this._vertexIndex++]=r,_[this._vertexIndex++]=i.r/255,_[this._vertexIndex++]=i.g/255,_[this._vertexIndex++]=i.b/255,_[this._vertexIndex++]=i.a,_[this._vertexIndex++]=g.r/255,_[this._vertexIndex++]=g.g/255,_[this._vertexIndex++]=g.b/255,_[this._vertexIndex++]=g.a,_[this._vertexIndex++]=0,_[this._vertexIndex++]=u.x,_[this._vertexIndex++]=u.y,_[this._vertexIndex++]=1,_[this._vertexIndex++]=0,_[this._vertexIndex++]=a,_[this._vertexIndex++]=s,_[this._vertexIndex++]=r,_[this._vertexIndex++]=i.r/255,_[this._vertexIndex++]=i.g/255,_[this._vertexIndex++]=i.b/255,_[this._vertexIndex++]=i.a,_[this._vertexIndex++]=g.r/255,_[this._vertexIndex++]=g.g/255,_[this._vertexIndex++]=g.b/255,_[this._vertexIndex++]=g.a,_[this._vertexIndex++]=0,_[this._vertexIndex++]=p.x,_[this._vertexIndex++]=p.y,_[this._vertexIndex++]=1,_[this._vertexIndex++]=1,_[this._vertexIndex++]=a,_[this._vertexIndex++]=s,_[this._vertexIndex++]=r,_[this._vertexIndex++]=i.r/255,_[this._vertexIndex++]=i.g/255,_[this._vertexIndex++]=i.b/255,_[this._vertexIndex++]=i.a,_[this._vertexIndex++]=g.r/255,_[this._vertexIndex++]=g.g/255,_[this._vertexIndex++]=g.b/255,_[this._vertexIndex++]=g.a,_[this._vertexIndex++]=0}drawRectangle(t,e,i,s,n=D.Transparent,r=0){this._isFull()&&this.flush(),this._rectangleCount++;const o=this._context.getTransform(),a=this._context.opacity,l=o.multiply(t.add(A(0,0))),h=o.multiply(t.add(A(e,0))),c=o.multiply(t.add(A(e,i))),d=o.multiply(t.add(A(0,i))),u=this._layout.vertexBuffer.bufferData;u[this._vertexIndex++]=l.x,u[this._vertexIndex++]=l.y,u[this._vertexIndex++]=0,u[this._vertexIndex++]=0,u[this._vertexIndex++]=e,u[this._vertexIndex++]=i,u[this._vertexIndex++]=a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n.r/255,u[this._vertexIndex++]=n.g/255,u[this._vertexIndex++]=n.b/255,u[this._vertexIndex++]=n.a,u[this._vertexIndex++]=r,u[this._vertexIndex++]=d.x,u[this._vertexIndex++]=d.y,u[this._vertexIndex++]=0,u[this._vertexIndex++]=1,u[this._vertexIndex++]=e,u[this._vertexIndex++]=i,u[this._vertexIndex++]=a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n.r/255,u[this._vertexIndex++]=n.g/255,u[this._vertexIndex++]=n.b/255,u[this._vertexIndex++]=n.a,u[this._vertexIndex++]=r,u[this._vertexIndex++]=h.x,u[this._vertexIndex++]=h.y,u[this._vertexIndex++]=1,u[this._vertexIndex++]=0,u[this._vertexIndex++]=e,u[this._vertexIndex++]=i,u[this._vertexIndex++]=a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n.r/255,u[this._vertexIndex++]=n.g/255,u[this._vertexIndex++]=n.b/255,u[this._vertexIndex++]=n.a,u[this._vertexIndex++]=r,u[this._vertexIndex++]=c.x,u[this._vertexIndex++]=c.y,u[this._vertexIndex++]=1,u[this._vertexIndex++]=1,u[this._vertexIndex++]=e,u[this._vertexIndex++]=i,u[this._vertexIndex++]=a,u[this._vertexIndex++]=s.r/255,u[this._vertexIndex++]=s.g/255,u[this._vertexIndex++]=s.b/255,u[this._vertexIndex++]=s.a,u[this._vertexIndex++]=n.r/255,u[this._vertexIndex++]=n.g/255,u[this._vertexIndex++]=n.b/255,u[this._vertexIndex++]=n.a,u[this._vertexIndex++]=r}hasPendingDraws(){return 0!==this._rectangleCount}flush(){if(0===this._rectangleCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._rectangleCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._rectangleCount,ti.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}class ai{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,t.getExtension("OES_standard_derivatives"),this._shader=new Ze({fragmentSource:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\n\n// UV coord\nvarying vec2 v_uv;\n\n// Color coord to blend with image\nvarying lowp vec4 v_color;\n\n// Stroke color if used\nvarying lowp vec4 v_strokeColor;\n\n// Stroke thickness if used\nvarying lowp float v_strokeThickness;\n\n// Opacity\nvarying float v_opacity;\n\nvoid main() {\n  // make (0, 0) the center the uv \n  vec2 uv = v_uv * 2.0 - 1.0;\n\n  vec4 color = v_color;\n  vec4 strokeColor = v_strokeColor;\n\n  // circle border is at radius 1.0 \n  // dist is > 0 when inside the circle \n  float d = length(uv);\n  float dist = 1.0 - length(uv);\n\n  // Fade based on fwidth\n  float fade = fwidth(dot(uv, uv));\n\n  // if dist is greater than 0 step to 1;\n  // when we cross this 0 threshold add a smooth fade\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\n\n  // if dist is greater than the stroke thickness step to 1\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\n\n  strokeColor.a *= fill * stroke;\n  strokeColor.rgb *= strokeColor.a;\n\n  color.a *= fill * (1.0 - stroke);\n  color.rgb *= color.a;\n\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\n  finalColor.rgb = finalColor.rgb * v_opacity;\n  finalColor.a = finalColor.a * v_opacity;\n  gl_FragColor = finalColor;\n}",vertexSource:"attribute vec2 a_position;\n\n// UV coordinate\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\nattribute vec4 a_color;\nvarying vec4 v_color;\n\nattribute vec4 a_strokeColor;\nvarying vec4 v_strokeColor;\n\nattribute float a_strokeThickness;\nvarying float v_strokeThickness;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\n\n   // Pass through UV coords\n   v_uv = a_uv;\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the color to the fragment shader\n   v_color = a_color;\n   // Pass through the stroke color to the fragment shader\n   v_strokeColor = a_strokeColor;\n   // Pass through the stroke thickenss to the fragment shader\n   v_strokeThickness = a_strokeThickness;\n}"}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new Qe({size:56*this._maxCircles,type:"dynamic"}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ni(this._maxCircles,!0)}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,s=D.Transparent,n=0){this._isFull()&&this.flush(),this._circleCount++;const r=this._context.getTransform(),o=this._context.opacity,a=r.multiply(t.add(A(-e,-e))),l=r.multiply(t.add(A(e,-e))),h=r.multiply(t.add(A(e,e))),c=r.multiply(t.add(A(-e,e))),d=this._layout.vertexBuffer.bufferData;d[this._vertexIndex++]=a.x,d[this._vertexIndex++]=a.y,d[this._vertexIndex++]=0,d[this._vertexIndex++]=0,d[this._vertexIndex++]=o,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n/e,d[this._vertexIndex++]=c.x,d[this._vertexIndex++]=c.y,d[this._vertexIndex++]=0,d[this._vertexIndex++]=1,d[this._vertexIndex++]=o,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n/e,d[this._vertexIndex++]=l.x,d[this._vertexIndex++]=l.y,d[this._vertexIndex++]=1,d[this._vertexIndex++]=0,d[this._vertexIndex++]=o,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n/e,d[this._vertexIndex++]=h.x,d[this._vertexIndex++]=h.y,d[this._vertexIndex++]=1,d[this._vertexIndex++]=1,d[this._vertexIndex++]=o,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a,d[this._vertexIndex++]=s.r/255,d[this._vertexIndex++]=s.g/255,d[this._vertexIndex++]=s.b/255,d[this._vertexIndex++]=s.a,d[this._vertexIndex++]=n/e}hasPendingDraws(){return 0!==this._circleCount}flush(){if(0===this._circleCount)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,6*this._circleCount,this._quads.bufferGlType,0),ti.DrawnImagesCount+=this._circleCount,ti.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class li{constructor(t){this._webglCtx=t,this._debugText=new qe}drawRect(t,e,i,s,n={color:D.Black}){this.drawLine(A(t,e),A(t+i,e),{...n}),this.drawLine(A(t+i,e),A(t+i,e+s),{...n}),this.drawLine(A(t+i,e+s),A(t,e+s),{...n}),this.drawLine(A(t,e+s),A(t,e),{...n})}drawLine(t,e,i={color:D.Black}){this._webglCtx.draw("ex.line",t,e,i.color)}drawPoint(t,e={color:D.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class hi{constructor(t){this._logger=v.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this._postProcessTargets=[],this._postprocessors=[],this._transform=new mt,this._state=new ft,this.snapToPixel=!0,this.smoothing=!1,this.backgroundColor=D.ExcaliburBlue,this._alreadyWarnedDrawLifecycle=!1,this.debug=new li(this);const{canvasElement:e,enableTransparency:i,smoothing:s,snapToPixel:n,backgroundColor:r}=t;this.__gl=e.getContext("webgl",{antialias:null!=s?s:this.smoothing,premultipliedAlpha:!1,alpha:null==i||i,depth:!0,powerPreference:"high-performance"}),Ye.register(this.__gl),At.register(this.__gl),this.snapToPixel=null!=n?n:this.snapToPixel,this.smoothing=null!=s?s:this.smoothing,this.backgroundColor=null!=r?r:this.backgroundColor,this._init()}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}_init(){const t=this.__gl;this._ortho=_t.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new ri),this.register(new oi),this.register(new ai),this.register(new ii),this.register(new ei),this._screenRenderer=new si(t),this._renderTarget=new Xe({gl:t,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Xe({gl:t,width:t.canvas.width,height:t.canvas.height}),new Xe({gl:t,width:t.canvas.width,height:t.canvas.height})],this._canvas=new kt({width:t.canvas.width,height:t.canvas.height}),this.__ctx=this._canvas.ctx}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){this._isDrawLifecycle||this._alreadyWarnedDrawLifecycle||(this._logger.warn("Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\nIf you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler."),this._alreadyWarnedDrawLifecycle=!0);const i=this._renderers.get(t);if(!i)throw Error(`No renderer with name ${t} has been registered`);this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(...e),this._currentRenderer=i}resetTransform(){this._transform.current=_t.identity()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=_t.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height),this._canvas.width=e.canvas.width,this._canvas.height=e.canvas.height}drawImage(t,e,i,s,n,r,o,a,l){if(0!==s&&0!==n&&0!==a&&0!==l&&0!==t.width&&0!==t.height)return t?void this.draw("ex.image",t,e,i,s,n,r,o,a,l):(v.getInstance().warn("Cannot draw a null or undefined image"),void(console.trace&&console.trace()))}drawLine(t,e,i,s=1){this.draw("ex.rectangle",t,e,i,s)}drawRectangle(t,e,i,s,n,r){this.draw("ex.rectangle",t,e,i,s,n,r)}drawCircle(t,e,i,s,n){this.draw("ex.circle",t,e,i,s,n)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current=this._transform.current.multiply(t)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);-1!==e&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}clear(){const t=this.__gl;this._renderTarget.use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){const t=this.__gl;this._renderTarget.use();for(const t of this._renderers.values())t.hasPendingDraws()&&t.flush();this._renderTarget.disable(),this._renderTarget.toRenderSource().use();for(let t=0;t<this._postprocessors.length;t++)this._postProcessTargets[t%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[t]),this._postProcessTargets[t%2].toRenderSource().use();t.bindFramebuffer(t.FRAMEBUFFER,null),this._screenRenderer.renderToScreen()}}var ci,di;(di=ci||(ci={})).Fixed="Fixed",di.FitScreen="FitScreen",di.FillScreen="FillScreen",di.FitContainer="FitContainer",di.FillContainer="FillContainer",di.Position="Position";class ui{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class pi{constructor(t){var e,i,s;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=v.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._resizeHandler=()=>{const t=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(t),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._alreadyWarned=!1,this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:{...this.viewport},this._displayMode=null!==(i=t.displayMode)&&void 0!==i?i:ci.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=null!==(s=t.antialiasing)&&void 0!==s?s:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._resizeHandler),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return 1!==this.pixelRatio}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){return this.displayMode===ci.FillContainer||this.displayMode===ci.FitContainer?this.canvas.parentElement||document.body:window}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this.graphicsContext instanceof hi&&(this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})||this._alreadyWarned||(this._alreadyWarned=!0,this._logger.warn(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`))),this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",""===this._canvas.style.imageRendering&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(){return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let e=t.x,i=t.y;if(this._isFullScreen||(e-=tt(this._canvas).x,i-=tt(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio;i=(i-(window.innerHeight-t)/2)/t*this.viewport.height,e=e/window.innerWidth*this.viewport.width}else{const t=window.innerHeight*this.aspectRatio;e=(e-(window.innerWidth-t)/2)/t*this.viewport.width,i=i/window.innerHeight*this.viewport.height}return e=e/this.viewport.width*this.resolution.width,i=i/this.viewport.height*this.resolution.height,new S(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;if(e=e/this.resolution.width*this.viewport.width,i=i/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio,s=(window.innerHeight-t)/2;i=i/this.viewport.height*t+s,e=e/this.viewport.width*window.innerWidth}else{const t=window.innerHeight*this.aspectRatio,s=(window.innerWidth-t)/2;e=e/this.viewport.width*t+s,i=i/this.viewport.height*window.innerHeight}return this._isFullScreen||(e+=tt(this._canvas).x,i+=tt(this._canvas).y),new S(e,i)}screenToWorldCoordinates(t){return this._camera?this._camera.inverse.multiply(t):t.sub(A(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(A(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){const t=this.screenToWorldCoordinates(S.Zero),e=t.x+this.drawWidth,i=t.y+this.drawHeight;return new R(t.x,t.y,e,i)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return A(this.halfDrawWidth,this.halfDrawHeight)}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i}}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0;const s=this.canvas.parentElement;s.clientWidth/t<s.clientHeight?(e=s.clientWidth,i=s.clientWidth/t):(e=s.clientHeight*t,i=s.clientHeight),this.viewport={width:e,height:i}}_applyDisplayMode(){this.displayMode===ci.Position?this._initializeDisplayModePosition(this._position):(this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver((()=>{this._resizeHandler()})),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler))}_setResolutionAndViewportByDisplayMode(t){this.displayMode===ci.FillContainer&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===ci.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this.displayMode===ci.FitScreen&&this._computeFit(),this.displayMode===ci.FitContainer&&this._computeFitContainer()}_initializeDisplayModePosition(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){const e=t.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";const t=-this.halfDrawHeight;this.canvas.style.marginTop=t.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";const t=-this.halfDrawWidth;this.canvas.style.marginLeft=t.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)}}class gi{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}gi._INSTANCE=null;class _i{static unlock(){return new Promise(((t,e)=>{if(_i._UNLOCKED||!gi.create())return t(!0);const i=setTimeout((()=>{v.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),t(!1)}),200),s=gi.create();s.resume().then((()=>{const e=s.createBuffer(1,1,22050),n=s.createBufferSource();let r=!1;n.buffer=e,n.connect(s.destination),n.onended=()=>r=!0,n.start(0),setTimeout((()=>{!function(t){return!!t.playbackState}(n)?(s.currentTime>0||r)&&(_i._UNLOCKED=!0):n.playbackState!==n.PLAYING_STATE&&n.playbackState!==n.FINISHED_STATE||(_i._UNLOCKED=!0)}),0),clearTimeout(i),t(!0)}),(()=>{e()}))}))}static isUnlocked(){return this._UNLOCKED}}_i._UNLOCKED=!1;class mi{constructor(){this.eventDispatcher=new pe}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}function fi(t,e=D.Red,i,s,n,r,o=1,a="butt"){t.save(),t.beginPath(),t.lineWidth=o,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(i,s),t.lineTo(n,r),t.closePath(),t.stroke(),t.restore()}function vi(t,e=D.Red,i){t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function bi(t,e,i,s,n=1){const r=e?e.toString():"blue",o=s.scale(n);t.beginPath(),t.strokeStyle=r,t.moveTo(i.x,i.y),t.lineTo(i.x+o.x,i.y+o.y),t.closePath(),t.stroke()}function wi(t,e,i,s,n,r=5,o=D.White,a=null){let l;if("number"==typeof r)l={tl:r,tr:r,br:r,bl:r};else{const t={tl:0,tr:0,br:0,bl:0};for(const e in t)if(t.hasOwnProperty(e)){const i=e;l[i]=r[i]||t[i]}}t.beginPath(),t.moveTo(e+l.tl,i),t.lineTo(e+s-l.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+l.tr),t.lineTo(e+s,i+n-l.br),t.quadraticCurveTo(e+s,i+n,e+s-l.br,i+n),t.lineTo(e+l.bl,i+n),t.quadraticCurveTo(e,i+n,e,i+n-l.bl),t.lineTo(e,i+l.tl),t.quadraticCurveTo(e,i,e+l.tl,i),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),o&&(t.strokeStyle=o.toString(),t.stroke())}function xi(t,e,i,s,n=D.White,r=null){t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),r&&(t.fillStyle=r.toString(),t.fill()),n&&(t.strokeStyle=n.toString(),t.stroke())}var yi=i(1388);class Ci extends mi{constructor(t){super(),this.canvas=new kt({filtering:dt.Blended,smoothing:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=D.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=yi.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let t=document.getElementById("excalibur-play");return t||(t=document.createElement("button")),t.id="excalibur-play",t.textContent=this.playButtonText,t.style.display="none",t},this._isLoadedPromise=new Promise((t=>{this._isLoadedResolve=t})),t&&this.addResources(t)}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const i=t.length;for(;e<i;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}async showPlayButton(){var t,e;if(!this.suppressPlayButton){const t=()=>{this._positionPlayButton()};(null===(e=this._engine)||void 0===e?void 0:e.browser)&&this._engine.browser.window.on("resize",t),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",(t=>{"Enter"===t.key&&this._playButton.click()})),this._positionPlayButton();const i=new Promise((e=>{const i=i=>{var s;i.stopPropagation(),this.hidePlayButton(),(null===(s=this._engine)||void 0===s?void 0:s.browser)&&this._engine.browser.window.off("resize",t),e()};this._playButton.addEventListener("click",i),this._playButton.addEventListener("touchend",i),this._playButton.addEventListener("pointerup",i)}));return await i}this.hidePlayButton(),await lt(500,null===(t=this._engine)||void 0===t?void 0:t.clock)}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}areResourcesLoaded(){return this._isLoadedPromise}async load(){var t,e;return await(null===(t=this._image)||void 0===t?void 0:t.decode()),await Promise.all(this._resourceList.map((t=>t.load().finally((()=>{this._numLoaded++}))))),this._isLoadedResolve(),await lt(200,null===(e=this._engine)||void 0===e?void 0:e.clock),await this.showPlayButton(),await _i.unlock(),this.data=this._resourceList}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?V(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}_positionPlayButton(){if(this._engine){const t=this._engine.screen.viewport.height,e=this._engine.screen.viewport.width;if(this._playButtonRootElement){const i=this._engine.canvas.offsetLeft,s=this._engine.canvas.offsetTop,n=this._playButton.clientWidth,r=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=i+e/2-n/2+"px",this._playButtonRootElement.style.top=s+t/2-r/2+100+"px")}}}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,i=this._engine.canvasWidth/this._engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const n=Math.min(this.logoWidth,.75*i);let r=i/2-n/2;this.logoPosition&&(r=this.logoPosition.x,s=this.logoPosition.y);const o=Math.floor(n*(this.logoHeight/this.logoWidth)),a=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s,n,o):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s-o-20,n,o),!this.suppressPlayButton&&this._playButtonShown)return void this._engine.setAntialiasing(a);let l=r,h=s;this.loadingBarPosition&&(l=this.loadingBarPosition.x,h=this.loadingBarPosition.y),t.lineWidth=2,wi(t,l,h,n,20,10,this.loadingBarColor);const c=n*this.progress-10;wi(t,l+5,h+5,c>10?c:10,10,5,null,this.loadingBarColor),this._engine.setAntialiasing(a)}}const Pi={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Ei{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n";const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(Pi))i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Pi[s]+"\n";e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),v.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const t in this._warningTest)this._warningTest[t]()||v.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",t);return!0}}var Si,Ai,Ti,ki,Ii,Di,Mi,Ri,Bi,$i;(Ai=Si||(Si={})).PreventCollision="PreventCollision",Ai.Passive="Passive",Ai.Active="Active",Ai.Fixed="Fixed",(ki=Ti||(Ti={})).Arcade="arcade",ki.Realistic="realistic",(Di=Ii||(Ii={}))[Di.DynamicAABBTree=0]="DynamicAABBTree",(Ri=Mi||(Mi={}))[Ri.Euler=0]="Euler";class Fi{static get gravity(){return Fi.acc}static set gravity(t){Fi.acc=t}static useArcadePhysics(){Fi.collisionResolutionStrategy=Ti.Arcade}static useRealisticPhysics(){Fi.collisionResolutionStrategy=Ti.Realistic}static get dynamicTreeVelocityMultiplyer(){return Fi.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){Fi.dynamicTreeVelocityMultiplier=t}}Fi.acc=new S(0,0),Fi.enabled=!0,Fi.broadphaseStrategy=Ii.DynamicAABBTree,Fi.collisionResolutionStrategy=Ti.Arcade,Fi.defaultMass=10,Fi.integrator=Mi.Euler,Fi.dynamicTreeVelocityMultiplier=2,Fi.boundsPadding=5,Fi.positionIterations=3,Fi.velocityIterations=8,Fi.slop=1,Fi.steeringFactor=.2,Fi.warmStart=!0,Fi.bodiesCanSleepByDefault=!1,Fi.surfaceEpsilon=.1,Fi.sleepEpsilon=.07,Fi.wakeThreshold=3*Fi.sleepEpsilon,Fi.sleepBias=.9,Fi.checkForFastBodies=!0,Fi.disableMinimumSpeedForFastBody=!1,function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([E({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],Fi,"dynamicTreeVelocityMultiplyer",null);class Li extends S{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class Oi{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const i in this)if(this.hasOwnProperty(i)){const s=this[i];(null==(e=s)?void 0:e.clone)&&"owner"!==i&&"clone"!==i?t[i]=s.clone():t[i]=s}var e;return t}}class Vi extends Oi{constructor(t,e){super(),this.type=t,this.value=e}}class zi{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);-1!==e&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);-1!==e&&this.subscriptions.splice(e,1)}notifyAll(t){this.observers.forEach((e=>e.notify(t))),this.subscriptions.forEach((e=>e(t)))}clear(){this.observers.length=0,this.subscriptions.length=0}}($i=Bi||(Bi={})).World="world",$i.Screen="screen";class Ui extends Oi{constructor(){super(...arguments),this.type="ex.transform",this._dirty=!1,this.matrix=_t.identity().translate(0,0).rotate(0).scale(1,1),this._position=vt((t=>{const e=t;return new Li({setX:t=>{e.data[ht.X]=t},setY:t=>{e.data[ht.Y]=t},getX:()=>e.data[ht.X],getY:()=>e.data[ht.Y]})})(this.matrix),(t=>{this.posChanged$.notifyAll(t)})),this._rotation=0,this._scale=(t=>{const e=t;return new Li({setX:t=>{e.setScaleX(t)},setY:t=>{e.setScaleY(t)},getX:()=>e.getScaleX(),getY:()=>e.getScaleY()})})(this.matrix),this.coordPlane=Bi.World,this.posChanged$=new zi,this.zIndexChanged$=new zi,this._z=0}_recalculate(){this._rotation=this.matrix.getRotation(),this._dirty=!1}getGlobalMatrix(){return this.parent?this.parent.getGlobalMatrix().multiply(this.matrix):this.matrix}getGlobalTransform(){return{pos:this.globalPos,scale:this.globalScale,rotation:this.globalRotation,z:this.z,coordPlane:this.coordPlane}}get parent(){var t,e;return null===(e=null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)||void 0===e?void 0:e.get(Ui)}get pos(){return this._dirty&&this._recalculate(),this._position}set pos(t){const e=this.matrix.getPosition();this.matrix.setPosition(t.x,t.y),this._dirty=!0,e.equals(t)||this.posChanged$.notifyAll(this._position)}get dirty(){var t;return(null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)&&this.parent.dirty||this._dirty}get globalPos(){const t=this.getGlobalMatrix();return new Li({getX:()=>t.data[ht.X],getY:()=>t.data[ht.Y],setX:e=>{var i;const s=this.matrix.data[ht.X];if(this.parent){const{x:s}=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multiply(A(e,t.data[ht.Y]));this.matrix.data[ht.X]=s}else this.matrix.data[ht.X]=e;s!==this.matrix.data[ht.X]&&this.posChanged$.notifyAll(this._position)},setY:e=>{var i;const s=this.matrix.data[ht.Y];if(this.parent){const{y:s}=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multiply(A(t.data[ht.X],e));this.matrix.data[ht.Y]=s}else this.matrix.data[ht.Y]=e;s!==this.matrix.data[ht.Y]&&this.posChanged$.notifyAll(this._position)}})}set globalPos(t){const e=this.pos,i=this.parent;this.pos=i?i.getGlobalMatrix().getAffineInverse().multiply(t):t,e.equals(t)||this.posChanged$.notifyAll(this.pos)}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get rotation(){return this._dirty&&this._recalculate(),this._rotation}set rotation(t){this.matrix.setRotation(t),this._dirty=!0}get globalRotation(){return this.getGlobalMatrix().getRotation()}set globalRotation(t){const e=this.parent;this.rotation=e?t-e.globalRotation:t}get scale(){return this._dirty&&this._recalculate(),this._scale}set scale(t){this.matrix.setScale(t),this._dirty=!0}get globalScale(){const t=this.getGlobalMatrix();return new Li({getX:()=>t.getScaleX(),getY:()=>t.getScaleY(),setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.matrix.setScaleX(t/e)}else this.matrix.setScaleX(t)},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.matrix.setScaleY(t/e)}else this.matrix.setScaleY(t)}})}set globalScale(t){const e=this.parent;this.scale=e?A(t.x/e.globalScale.x,t.y/e.globalScale.y):t}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.matrix.getAffineInverse().multiply(t)}}class Ni extends Oi{constructor(){super(...arguments),this.type="ex.motion",this.vel=S.Zero,this.acc=S.Zero,this.scaleFactor=S.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class Hi{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return 0!=(this.category&t.mask)&&0!=(t.category&this.mask)}invert(){return new Hi("~("+this.name+")",~this.category,~this.mask)}static combine(t){const e=t.map((t=>t.name)).join("+"),i=t.reduce(((t,e)=>e.category|t),0);return new Hi(e,i,~i)}static collidesWith(t){return Hi.combine(t).invert()}}Hi.All=new Hi("Collide with all groups",-1,-1);class ji{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=ji.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,s;const n=null===(i=null==t?void 0:t.owner)||void 0===i?void 0:i.get(ps),r=null===(s=null==e?void 0:e.owner)||void 0===s?void 0:s.get(ps);return!(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions()||!n||!r||!n.group.canCollide(r.group)||n.collisionType===Si.Fixed&&r.collisionType===Si.Fixed||r.collisionType===Si.PreventCollision||n.collisionType===Si.PreventCollision||!n.active||!r.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return ji.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class Wi{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Gi{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new R,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class qi{constructor(t=new R(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(null===this.root)return this.root=t,void(this.root.parent=null);const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const t=i.left,s=i.right,n=i.bounds.getPerimeter(),r=i.bounds.combine(e).getPerimeter(),o=2*r,a=2*(r-n);let l=0;const h=e.combine(t.bounds);let c,d;t.isLeaf()?l=h.getPerimeter()+a:(d=t.bounds.getPerimeter(),c=h.getPerimeter(),l=c-d+a);let u=0;const p=e.combine(s.bounds);if(s.isLeaf()?u=p.getPerimeter()+a:(d=s.bounds.getPerimeter(),c=p.getPerimeter(),u=c-d+a),o<l&&o<u)break;i=l<u?t:s}const s=i.parent,n=new Gi(s);n.bounds=e.combine(i.bounds),n.height=i.height+1,null!==s?(s.left===i?s.left=n:s.right=n,n.left=i,n.right=t,i.parent=n,t.parent=n):(n.left=i,n.right=t,i.parent=n,t.parent=n,this.root=n);let r=t.parent;for(;r;){if(r=this._balance(r),!r.left)throw new Error("Parent of current leaf cannot have a null left child"+r);if(!r.right)throw new Error("Parent of current leaf cannot have a null right child"+r);r.height=1+Math.max(r.left.height,r.right.height),r.bounds=r.left.bounds.combine(r.right.bounds),r=r.parent}}_remove(t){if(t===this.root)return void(this.root=null);const e=t.parent,i=e.parent;let s;if(s=e.left===t?e.right:e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let t=i;for(;t;)t=this._balance(t),t.bounds=t.left.bounds.combine(t.right.bounds),t.height=1+Math.max(t.left.height,t.right.height),t=t.parent}else this.root=s,s.parent=null}trackCollider(t){const e=new Gi;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const s=t.bounds;if(!this.worldBounds.contains(s))return v.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(s))return!1;if(this._remove(i),s.left-=Fi.boundsPadding,s.top-=Fi.boundsPadding,s.right+=Fi.boundsPadding,s.bottom+=Fi.boundsPadding,t.owner){const i=null===(e=t.owner)||void 0===e?void 0:e.get(ps);if(i){const t=32*i.vel.x/1e3*Fi.dynamicTreeVelocityMultiplier,e=32*i.vel.y/1e3*Fi.dynamicTreeVelocityMultiplier;t<0?s.left+=t:s.right+=t,e<0?s.top+=e:s.bottom+=e}}return i.bounds=s,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,n=e,r=i,o=e.left,a=e.right,l=i.left,h=i.right,c=r.height-n.height;if(c>1)return r.left=s,r.parent=s.parent,s.parent=r,r.parent?r.parent.left===s?r.parent.left=r:r.parent.right=r:this.root=r,l.height>h.height?(r.right=l,s.right=h,h.parent=s,s.bounds=n.bounds.combine(h.bounds),r.bounds=s.bounds.combine(l.bounds),s.height=1+Math.max(n.height,h.height),r.height=1+Math.max(s.height,l.height)):(r.right=h,s.right=l,l.parent=s,s.bounds=n.bounds.combine(l.bounds),r.bounds=s.bounds.combine(h.bounds),s.height=1+Math.max(n.height,l.height),r.height=1+Math.max(s.height,h.height)),r;if(c<-1){if(n.left=s,n.parent=s.parent,s.parent=n,n.parent)if(n.parent.left===s)n.parent.left=n;else{if(n.parent.right!==s)throw"Error rotating Dynamic Tree";n.parent.right=n}else this.root=n;return o.height>a.height?(n.right=o,s.left=a,a.parent=s,s.bounds=r.bounds.combine(a.bounds),n.bounds=s.bounds.combine(o.bounds),s.height=1+Math.max(r.height,a.height),n.height=1+Math.max(s.height,o.height)):(n.right=a,s.left=o,o.parent=s,s.bounds=r.bounds.combine(o.bounds),n.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(r.height,o.height),n.height=1+Math.max(s.height,a.height)),n}return t}getHeight(){return null===this.root?0:this.root.height}query(t,e){const i=t.bounds,s=n=>{if(n&&n.bounds.intersect(i)){if(!n.isLeaf()||n.data===t)return s(n.left)||s(n.right);if(e.call(t,n.data))return!0}return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=n=>{if(n&&n.bounds.rayCast(t,e)){if(!n.isLeaf())return s(n.left)||s(n.right);if(i.call(t,n.data))return!0}return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,D.Green):i.bounds.draw(t,D.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class Ki{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;const i=this.dir.cross(t.getSlope());if(0===i)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const n=e.cross(this.dir)/i/t.getLength();if(n>=0&&n<=1)return s}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class Xi{constructor(){this._dynamicCollisionTree=new qi,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[]}getColliders(){return this._colliders}track(t){if(t)if(t instanceof Zi){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t);else v.getInstance().warn("Cannot track null collider")}untrack(t){if(t)if(t instanceof Zi){const e=t.getColliders();for(const t of e){const e=this._colliders.indexOf(t);-1!==e&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}else{const e=this._colliders.indexOf(t);-1!==e&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}else v.getInstance().warn("Cannot untrack a null collider")}_pairExists(t,e){const i=ji.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const s=e/1e3,n=t.filter((t=>{var e,i;const s=null===(e=t.owner)||void 0===e?void 0:e.get(ps);return(null===(i=t.owner)||void 0===i?void 0:i.active)&&s.collisionType!==Si.PreventCollision}));let r;this._collisionPairCache=[],this._pairs.clear();for(let t=0,e=n.length;t<e;t++)r=n[t],this._dynamicCollisionTree.query(r,(t=>{if(!this._pairExists(r,t)&&ji.canCollide(r,t)){const e=new ji(r,t);this._pairs.add(e.id),this._collisionPairCache.push(e)}return!1}));if(i&&(i.physics.pairs=this._collisionPairCache.length),Fi.checkForFastBodies)for(const t of n){const e=t.owner.get(ps);if(e.collisionType!==Si.Active)continue;const n=e.vel.size*s+.5*e.acc.size*s*s,r=Math.min(t.bounds.height,t.bounds.width);if(Fi.disableMinimumSpeedForFastBody||n>r/2){i&&i.physics.fastBodies++;const s=e.pos.sub(e.oldPos),r=t.center,o=t.getFurthestPoint(e.vel),a=o.sub(s),l=new Ki(a,e.vel);let h;l.pos=l.pos.add(l.dir.scale(-2*Fi.surfaceEpsilon));let c=new S(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(l,n+2*Fi.surfaceEpsilon,(e=>{if(!this._pairExists(t,e)&&ji.canCollide(t,e)){const t=e.rayCast(l,n+10*Fi.surfaceEpsilon);if(t){const i=t.sub(a);i.size<c.size&&(c=i,h=e)}}return!1})),h&&S.isValid(c)){const s=new ji(t,h);this._pairs.has(s.id)||(this._pairs.add(s.id),this._collisionPairCache.push(s));const n=r.sub(o);e.pos=a.add(n).add(c).add(l.dir.scale(10*Fi.surfaceEpsilon)),t.update(e.transform),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let s=0;s<t.length;s++){const n=t[s].collide();if(i=i.concat(n),e&&n.length>0)for(const t of n)e.physics.contacts.set(t.id,t)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateCollider(t[s])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class Yi{constructor(){this.id=f("collider",Yi._ID++),this.events=new pe}touching(t){return!!this.collide(t)}}Yi._ID=0;class Zi extends Yi{constructor(t){super(),this._collisionProcessor=new Xi,this._dynamicAABBTree=new qi,this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){this.events.wire(t.events),this._colliders.push(t),this._collisionProcessor.track(t),this._dynamicAABBTree.trackCollider(t)}removeCollider(t){this.events.unwire(t.events),it(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos)&&void 0!==e?e:S.Zero}get center(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos)&&void 0!==e?e:S.Zero}get bounds(){var t,e;const i=this.getColliders();return i.reduce(((t,e)=>t.combine(e.bounds)),null!==(e=null===(t=i[0])||void 0===t?void 0:t.bounds)&&void 0!==e?e:(new R).translate(this.worldPos))}get localBounds(){var t,e;const i=this.getColliders();return i.reduce(((t,e)=>t.combine(e.localBounds)),null!==(e=null===(t=i[0])||void 0===t?void 0:t.localBounds)&&void 0!==e?e:new R)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const s of e)i.push(s.getFurthestPoint(t));let s=i[0],n=-Number.MAX_VALUE;for(const e of i){const i=e.dot(t);i>n&&(s=e,n=i)}return s}getInertia(t){const e=this.getColliders();let i=0;for(const s of e)i+=s.getInertia(t);return i}collide(t){let e=[t];t instanceof Zi&&(e=t.getColliders());const i=[];for(const t of e)this._dynamicAABBTree.query(t,(e=>(i.push(new ji(t,e)),!1)));let s=[];for(const t of i)s=s.concat(t.collide());return s}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof Zi){const s=t.getColliders();for(const t of e)for(const e of s){const s=t.getClosestLineBetween(e);s&&i.push(s)}}else for(const s of e){const e=t.getClosestLineBetween(s);e&&i.push(e)}if(i.length){let t=i[0].getLength(),e=i[0];for(const s of i){const i=s.getLength();i<t&&(t=i,e=s)}return e}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),s=[];for(const n of i){const i=n.rayCast(t,e);i&&s.push(i)}if(s.length){let e=s[0],i=e.dot(t.dir);for(const n of s){const s=t.dir.dot(n);s<i&&(e=n,i=s)}return e}return null}project(t){const e=this.getColliders(),i=[];for(const s of e){const e=s.project(t);e&&i.push(e)}if(i.length){const t=new Wi(i[0].min,i[0].max);for(const e of i)t.min=Math.min(e.min,t.min),t.max=Math.max(e.max,t.max);return t}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}draw(t,e,i){const s=this.getColliders();for(const n of s)n.draw(t,e,i)}debug(t,e){const i=this.getColliders();for(const s of i)s.debug(t,e)}debugDraw(t,e){const i=this.getColliders();for(const s of i)s.draw(t,e)}clone(){return new Zi(this._colliders.map((t=>t.clone())))}}class Qi{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this.end.sub(this.begin).normal()}dir(){return this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){const t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Qi(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e){let i=t;i=i.normalize();const s=i.dot(this.begin)-e,n=i.dot(this.end)-e,r=[];if(s<=0&&r.push(this.begin),n<=0&&r.push(this.end),s*n<0){const t=s/(s-n);r.push(this.begin.add(this.end.sub(this.begin).scale(t)))}return 2!==r.length?null:new Qi(r[0],r[1])}distanceToPoint(t,e=!1){const i=t.x,s=t.y,n=this.getLength(),r=((this.end.y-this.begin.y)*i-(this.end.x-this.begin.x)*s+this.end.x*this.begin.y-this.end.y*this.begin.x)/n;return e?r:Math.abs(r)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(null!==t)return new S(t,i*t+s);if(null!==e)return new S((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new S(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof S))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}const i=t.x-this.begin.x,s=t.y-this.begin.y,n=this.end.x-this.begin.x,r=this.end.y-this.begin.y,o=i*r-s*n;return!(Math.abs(o)>e)&&(Math.abs(n)>=Math.abs(r)?n>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:r>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)}}function Ji(t,e,i,s){const n=t.sub(i),r=e.dot(e),o=e.dot(s),a=s.dot(s),l=e.dot(n),h=s.dot(n),c=r*a-o*o;let d=c,u=c;if(0===c||c<=.01){const e=l/o;return new Qi(t,i.add(s.scale(e)))}let p=o*h-a*l,g=r*h-o*l;return p<0?(p=0,g=h,u=a):p>d&&(p=d,g=h+o,u=a),g<0?(g=0,-l<0?p=0:-l>r?p=d:(p=-l,d=r)):g>u&&(g=u,-l+o<0?p=0:-l+o>r?p=d:(p=-l+o,d=r)),p=Math.abs(p)<.001?0:p/d,g=Math.abs(g)<.001?0:g/u,new Qi(t.add(e.scale(p)),i.add(s.scale(g)))}const ts={PolygonPolygonClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=s.negate(),r=new Ki(t.worldPos,s),o=new Ki(i,n),a=t.rayCast(r).add(r.dir.scale(.1)),l=e.rayCast(o).add(o.dir.scale(.1)),h=t.getClosestFace(a),c=e.getClosestFace(l);return Ji(h.face.begin,h.face.getEdge(),c.face.begin,c.face.getEdge())},PolygonEdgeClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=new Ki(t.worldPos,i),n=t.rayCast(s).add(s.dir.scale(.1)),r=t.getClosestFace(n),o=r.face.begin,a=r.face.getEdge(),l=e.asLine();return Ji(o,a,l.begin,l.getEdge())},PolygonCircleClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=new Ki(t.worldPos,s.normalize()),r=t.rayCast(n).add(n.dir.scale(.1)),o=t.getClosestFace(r),a=o.face.begin,l=o.face.getEdge();let h=(l.x*(i.x-a.x)+l.y*(i.y-a.y))/(l.x*l.x+l.y*l.y);h>1?h=1:h<0&&(h=0);const c=Math.sqrt(Math.pow(a.x+l.x*h-i.x,2)+Math.pow(a.y+l.y*h-i.y,2))-e.radius,d=(a.x+l.x*h-i.x)*e.radius/(e.radius+c),u=(a.y+l.y*h-i.y)*e.radius/(e.radius+c);return new Qi(l.scale(h).add(a),new S(i.x+d,i.y+u))},CircleCircleClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=t.worldPos.sub(e.worldPos),n=new Ki(t.worldPos,i),r=new Ki(e.worldPos,s),o=t.rayCast(n),a=e.rayCast(r);return new Qi(o,a)},CircleEdgeClosestLine(t,e){const i=t.worldPos,s=e.asLine(),n=s.begin,r=s.getEdge();let o=(r.x*(i.x-n.x)+r.y*(i.y-n.y))/(r.x*r.x+r.y*r.y);o>1?o=1:o<0&&(o=0);const a=Math.sqrt(Math.pow(n.x+r.x*o-i.x,2)+Math.pow(n.y+r.y*o-i.y,2))-t.radius,l=(n.x+r.x*o-i.x)*t.radius/(t.radius+a),h=(n.y+r.y*o-i.y)*t.radius/(t.radius+a);return new Qi(r.scale(o).add(n),new S(i.x+l,i.y+h))},EdgeEdgeClosestLine(t,e){const i=t.asLine(),s=i.begin,n=i.getEdge(),r=e.asLine();return Ji(s,n,r.begin,r.getEdge())}};class es extends Yi{constructor(t){super(),this.offset=S.Zero,this.offset=t.offset||S.Zero,this.radius=t.radius||0}get worldPos(){var t,e,i,s;const n=this._transform,r=null!==(t=null==n?void 0:n.globalScale)&&void 0!==t?t:S.One,o=null!==(e=null==n?void 0:n.globalRotation)&&void 0!==e?e:0,a=null!==(i=null==n?void 0:n.globalPos)&&void 0!==i?i:S.Zero;return(null!==(s=this.offset)&&void 0!==s?s:S.Zero).scale(r).rotate(o).add(a)}get radius(){var t;const e=this._transform,i=null!==(t=null==e?void 0:e.globalScale)&&void 0!==t?t:S.One;return this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,s=null!==(e=null==i?void 0:i.globalScale)&&void 0!==e?e:S.One;this._naturalRadius=t/Math.min(s.x,s.y)}clone(){return new es({offset:this.offset.clone(),radius:this.radius})}get center(){var t,e,i,s;const n=this._transform,r=null!==(t=null==n?void 0:n.globalScale)&&void 0!==t?t:S.One,o=null!==(e=null==n?void 0:n.globalRotation)&&void 0!==e?e:0,a=null!==(i=null==n?void 0:n.globalPos)&&void 0!==i?i:S.Zero;return(null!==(s=this.offset)&&void 0!==s?s:S.Zero).scale(r).rotate(o).add(a)}contains(t){var e,i;return(null!==(i=null===(e=this._transform)||void 0===e?void 0:e.pos)&&void 0!==i?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){const i=this.center,s=t.dir,n=t.pos,r=Math.sqrt(Math.pow(s.dot(n.sub(i)),2)-Math.pow(n.sub(i).distance(),2)+Math.pow(this.radius,2));if(r<0)return null;{let o=0;if(0===r)return o=-s.dot(n.sub(i)),o>0&&o<e?t.getPoint(o):null;{const o=-s.dot(n.sub(i))+r,a=-s.dot(n.sub(i))-r,l=[];o>=0&&l.push(o),a>=0&&l.push(a);const h=Math.min(...l);return h<=e?t.getPoint(h):null}}}getClosestLineBetween(t){if(t instanceof es)return ts.CircleCircleClosestLine(this,t);if(t instanceof os)return ts.PolygonCircleClosestLine(t,this).flip();if(t instanceof rs)return ts.CircleEdgeClosestLine(this,t).flip();throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCircleCircle(this,t);if(t instanceof os)return ns.CollideCirclePolygon(this,t);if(t instanceof rs)return ns.CollideCircleEdge(this,t);throw new Error("Circle could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,e,i;const s=this._transform,n=null!==(t=null==s?void 0:s.globalScale)&&void 0!==t?t:S.One,r=null!==(e=null==s?void 0:s.globalRotation)&&void 0!==e?e:0,o=null!==(i=null==s?void 0:s.globalPos)&&void 0!==i?i:S.Zero;return new R(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(r).scale(n).translate(o)}get localBounds(){return new R(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){this._transform=t}project(t){const e=[],i=this.center.dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new Wi(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=D.Green,i=S.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.fill()}debug(t,e){var i,s,n,r;const o=this._transform,a=null!==(i=null==o?void 0:o.globalScale)&&void 0!==i?i:S.One,l=null!==(s=null==o?void 0:o.globalRotation)&&void 0!==s?s:0,h=null!==(n=null==o?void 0:o.globalPos)&&void 0!==n?n:S.Zero;t.save(),t.translate(h.x,h.y),t.rotate(l),t.scale(a.x,a.y),t.drawCircle(null!==(r=this.offset)&&void 0!==r?r:S.Zero,this._naturalRadius,D.Transparent,e,2),t.restore()}debugDraw(t,e=D.Green){const i=this._transform,s=i?i.pos.add(this.offset):this.offset,n=i?i.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(Math.cos(n)*this.radius+s.x,Math.sin(n)*this.radius+s.y),t.closePath(),t.stroke()}}class is{constructor(t,e,i,s,n,r,o,a){this._canceled=!1,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=s,this.tangent=n,this.points=r,this.localPoints=o,this.info=a,this.id=ji.calculatePairHash(t.id,e.id)}matchAwake(){const t=this.colliderA.owner.get(ps),e=this.colliderB.owner.get(ps);t&&e&&t.sleeping!==e.sleeping&&(t.sleeping&&t.collisionType!==Si.Fixed&&e.sleepMotion>=Fi.wakeThreshold&&t.setSleeping(!1),e.sleeping&&e.collisionType!==Si.Fixed&&t.sleepMotion>=Fi.wakeThreshold&&e.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class ss{static findPolygonPolygonSeparation(t,e){let i=-Number.MAX_VALUE,s=null,n=null,r=-1,o=null;const a=t.getSides(),l=t.getLocalSides();for(let t=0;t<a.length;t++){const l=a[t],h=l.normal(),c=e.getFurthestPoint(h.negate()),d=l.distanceToPoint(c,!0);d>i&&(i=d,s=l,n=h,r=t,o=c)}return{collider:t,separation:n?i:99,axis:n,side:s,localSide:l[r],sideId:r,point:o,localPoint:n?e.getFurthestLocalPoint(n.negate()):null}}static findCirclePolygonSeparation(t,e){const i=e.axes,s=e.center.sub(t.worldPos),n=e.getFurthestPoint(s.negate());i.push(n.sub(t.worldPos).normalize());let r=Number.MAX_VALUE,o=null,a=-1;for(let s=0;s<i.length;s++){const n=e.project(i[s]),l=t.project(i[s]),h=n.getOverlap(l);if(h<=0)return null;h<r&&(r=h,o=i[s],a=s)}return a<0?null:o.normalize().scale(r)}}const ns={CollideCircleCircle(t,e){const i=t.worldPos,s=e.worldPos,n=t.radius+e.radius,r=i.distance(s);if(r>n)return[];const o=n-r,a=s.sub(i).normalize(),l=a.perpendicular(),h=a.scale(o),c=t.getFurthestPoint(a),d=t.getFurthestLocalPoint(a);return[new is(t,e,h,a,l,[c],[d],{collider:t,separation:o,axis:a,point:c})]},CollideCirclePolygon(t,e){var i,s;let n=ss.findCirclePolygonSeparation(t,e);if(!n)return[];const r=n.dot(e.center.sub(t.center));n=r<0?n.negate():n;const o=t.getFurthestPoint(n),a=(null!==(s=null===(i=t.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui).applyInverse(o),l=n.normalize(),h={collider:t,separation:-n.size,axis:l,point:o,localPoint:a,side:e.findSide(l.negate()),localSide:e.findLocalSide(l.negate())};return[new is(t,e,n,l,l.perpendicular(),[o],[a],h)]},CollideCircleEdge(t,e){const i=t.center,s=e.asLine(),n=s.end.sub(s.begin),r=n.dot(s.end.sub(i)),o=n.dot(i.sub(s.begin)),a=e.asLine(),l=e.asLocalLine();if(o<=0){const n=s.begin.sub(i),r=n.dot(n);if(r>t.radius*t.radius)return[];const o=n.normalize(),h=t.radius-Math.sqrt(r),c={collider:t,separation:h,axis:o,point:a.begin,side:a,localSide:l};return[new is(t,e,o.scale(h),o,o.perpendicular(),[a.begin],[l.begin],c)]}if(r<=0){const n=s.end.sub(i),r=n.dot(n);if(r>t.radius*t.radius)return[];const o=n.normalize(),h=t.radius-Math.sqrt(r),c={collider:t,separation:h,axis:o,point:a.end,side:a,localSide:l};return[new is(t,e,o.scale(h),o,o.perpendicular(),[a.end],[l.end],c)]}const h=n.dot(n),c=s.begin.scale(r).add(s.end.scale(o)).scale(1/h),d=i.sub(c),u=d.dot(d);if(u>t.radius*t.radius)return[];let p=n.perpendicular();p.dot(i.sub(s.begin))<0&&(p.x=-p.x,p.y=-p.y),p=p.normalize();const g=t.radius-Math.sqrt(u),_=p.scale(g),m={collider:t,separation:g,axis:p,point:c,side:a,localSide:l};return[new is(t,e,_,p.negate(),p.negate().perpendicular(),[c],[c.sub(e.worldPos)],m)]},CollideEdgeEdge:()=>[],CollidePolygonEdge(t,e){var i;const s=t.center,n=e.center.sub(s).normalize(),r=new os({points:[e.begin,e.end,e.end.add(n.scale(100)),e.begin.add(n.scale(100))],offset:e.offset});r.owner=e.owner,(null===(i=e.owner)||void 0===i?void 0:i.get(Ui))&&r.update(e.owner.get(Ui));const o=this.CollidePolygonPolygon(t,r);return o.length&&(o[0].colliderB=e,o[0].id=ji.calculatePairHash(t.id,e.id)),o},CollidePolygonPolygon(t,e){var i,s,n,r;const o=ss.findPolygonPolygonSeparation(t,e);if(o.separation>0)return[];const a=ss.findPolygonPolygonSeparation(e,t);if(a.separation>0)return[];const l=o.separation>a.separation?o:a,h=(l.collider===t?e:t).findSide(l.axis.negate()),c=l.side,d=c.dir().normalize(),u=h.clip(d.negate(),-d.dot(c.begin));let p=null;if(u&&(p=u.clip(d,d.dot(c.end))),p){const o=p.getPoints().filter((t=>c.below(t)));let a=l.axis,h=a.perpendicular();e.center.sub(t.center).dot(a)<0&&(a=a.negate(),h=a.perpendicular());let d=[];if(l.collider===t){const t=null!==(s=null===(i=e.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui;d=o.map((e=>t.applyInverse(e)))}else{const e=null!==(r=null===(n=t.owner)||void 0===n?void 0:n.get(Ui))&&void 0!==r?r:new Ui;d=o.map((t=>e.applyInverse(t)))}return[new is(t,e,a.scale(-l.separation),a,h,o,d,l)]}return[]},FindContactSeparation(t,e){var i,s,n,r;const o=t.colliderA,a=null!==(s=null===(i=t.colliderA.owner)||void 0===i?void 0:i.get(Ui))&&void 0!==s?s:new Ui,l=t.colliderB,h=null!==(r=null===(n=t.colliderB.owner)||void 0===n?void 0:n.get(Ui))&&void 0!==r?r:new Ui;if(o instanceof es&&l instanceof es)return-(o.radius+l.radius-a.pos.distance(h.pos));if(o instanceof os&&l instanceof os&&t.info.localSide){let i,s;return t.info.collider===o?(i=new Qi(a.apply(t.info.localSide.begin),a.apply(t.info.localSide.end)),s=h.apply(e)):(i=new Qi(h.apply(t.info.localSide.begin),h.apply(t.info.localSide.end)),s=a.apply(e)),i.distanceToPoint(s,!0)}if(o instanceof os&&l instanceof es||l instanceof os&&o instanceof es){const i=a.apply(e);if(t.info.side)return t.info.side.distanceToPoint(i,!0)}if(o instanceof rs&&l instanceof os||l instanceof rs&&o instanceof os){let i;if(i=t.info.collider===o?h.apply(e):a.apply(e),t.info.side)return t.info.side.distanceToPoint(i,!0)}if(o instanceof es&&l instanceof rs||l instanceof es&&o instanceof rs){const i=h.apply(e);let s;o instanceof es&&(s=o.getFurthestPoint(t.normal));const n=i.distance(s);if(t.info.side)return n>0?-n:0}return 0}};class rs extends Yi{constructor(t){var e;super(),this.begin=t.begin||S.Zero,this.end=t.end||S.Zero,this.offset=null!==(e=t.offset)&&void 0!==e?e:S.Zero}clone(){return new rs({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return null!==(t=null==e?void 0:e.globalPos.add(this.offset))&&void 0!==t?t:this.offset}get center(){return this.begin.average(this.end).add(this._getBodyPos())}_getBodyPos(){var t;const e=this._transform;return null!==(t=null==e?void 0:e.globalPos)&&void 0!==t?t:S.Zero}_getTransformedBegin(){const t=this._transform,e=t?t.globalRotation:0;return this.begin.rotate(e).add(this._getBodyPos())}_getTransformedEnd(){const t=this._transform,e=t?t.globalRotation:0;return this.end.rotate(e).add(this._getBodyPos())}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;const s=t.dir.cross(this.getSlope());if(0===s)return null;const n=i.cross(this.getSlope())/s;if(n>=0&&n<=e){const e=i.cross(t.dir)/s/this.getLength();if(e>=0&&e<=1)return t.getPoint(n)}return null}getClosestLineBetween(t){if(t instanceof es)return ts.CircleEdgeClosestLine(t,this);if(t instanceof os)return ts.PolygonEdgeClosestLine(t,this).flip();if(t instanceof rs)return ts.EdgeEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCircleEdge(t,this);if(t instanceof os)return ns.CollidePolygonEdge(t,this);if(t instanceof rs)return ns.CollideEdgeEdge();throw new Error("Edge could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new R(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Qi(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Qi(this.begin,this.end)}get axes(){const t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){this._transform=t}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let n=0;n<s;n++)e.push(i[n].dot(t));return new Wi(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=D.Green,i=S.Zero){const s=this.begin.add(i),n=this.end.add(i);t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath(),t.stroke()}debug(t,e){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.drawLine(i,s,e,2),t.drawCircle(i,2,e),t.drawCircle(s,2,e)}debugDraw(t,e=D.Red){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.closePath(),t.stroke()}}class os extends Yi{constructor(t){var e,i;super(),this._logger=v.getInstance(),this._transformedPoints=[],this._axes=[],this._sides=[],this._localSides=[],this.offset=null!==(e=t.offset)&&void 0!==e?e:S.Zero,this.points=null!==(i=t.points)&&void 0!==i?i:[],this._isClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),s=0,n=0,r=0;for(const[o,a]of this.points.entries()){if(t=e,s=i,e=a,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let l=i-s;if(l<=-Math.PI?l+=2*Math.PI:l>Math.PI&&(l-=2*Math.PI),0===o){if(0===l)return!1;n=l>0?1:-1}else if(n*l<=0)return!1;r+=l}return 1===Math.abs(Math.round(r/(2*Math.PI)))}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Zi(t.map((t=>as.Polygon(t))))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");function t(t,e){return t>=e.length?e[t%e.length]:t<0?e[t%e.length+e.length]:e[t]}function e(t,e,i,s){const n=i.sub(e),r=s.sub(i),o=e.sub(s),a=t.sub(e),l=t.sub(i),h=t.sub(s),c=n.cross(a),d=r.cross(l),u=o.cross(h);return!(c>0||d>0||u>0)}const i=[],s=[...this.points],n=H(0,this.points.length-1);for(;n.length>3;)for(let r=0;r<n.length;r++){const o=n[r],a=t(r-1,n),l=t(r+1,n),h=s[o],c=s[a],d=s[l],u=c.sub(h);if(!(d.sub(h).cross(u)>0))continue;let p=!0;for(let t=0;t<n.length;t++){const i=n[t];if(i!==o&&i!==a&&i!==l&&e(s[i],c,h,d)){p=!1;break}}if(p){i.push([c,h,d]),n.splice(r,1);break}}return i.push([s[n[0]],s[n[1]],s[n[2]]]),new Zi(i.map((t=>as.Polygon(t))))}clone(){return new os({offset:this.offset.clone(),points:this.points.map((t=>t.clone()))})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this._transform,e=t?t.globalPos.add(this.offset):this.offset,i=t?t.globalRotation:0,s=t?t.globalScale:S.One,n=this.points.length;this._transformedPoints.length=0;for(let t=0;t<n;t++)this._transformedPoints[t]=this.points[t].scale(s).rotate(i).add(e)}getTransformedPoints(){return this._calculateTransformation(),this._transformedPoints}getSides(){if(this._sides.length)return this._sides;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new Qi(e[s],e[(s+1)%i]));return this._sides=t,this._sides}getLocalSides(){if(this._localSides.length)return this._localSides;const t=[],e=this.points,i=e.length;for(let s=0;s<i;s++)t.push(new Qi(e[s],e[(s+1)%i]));return this._localSides=t,this._localSides}findSide(t){const e=this.getSides();let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=e[n],o=r.normal().dot(t);o>s&&(i=r,s=o)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=e[n],o=r.normal().dot(t);o>s&&(i=r,s=o)}return i}get axes(){if(this._axes.length)return this._axes;const t=this.getSides().map((t=>t.normal()));return this._axes=t,this._axes}update(t){this._transform=t,this._sides.length=0,this._localSides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getSides(),this.getLocalSides()}contains(t){const e=new Ki(t,new S(1,0));return this.getSides().reduce((function(t,i){return e.intersect(i)>=0?t+1:t}),0)%2!=0}getClosestLineBetween(t){if(t instanceof es)return ts.PolygonCircleClosestLine(this,t);if(t instanceof os)return ts.PolygonPolygonClosestLine(this,t);if(t instanceof rs)return ts.PolygonEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof es)return ns.CollideCirclePolygon(t,this);if(t instanceof os)return ns.CollidePolygonPolygon(this,t);if(t instanceof rs)return ns.CollidePolygonEdge(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=t.dot(e[n]);r>s&&(s=r,i=e[n])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=t.dot(e[n]);r>s&&(s=r,i=e[n])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,n=-1;for(let r=0;r<e.length;r++){const o=e[r].distanceToPoint(t);o<i&&(i=o,s=r,n=o)}return-1!==s?{distance:e[s].normal().scale(n),face:e[s]}:null}get bounds(){var t,e,i;const s=this._transform,n=null!==(t=null==s?void 0:s.globalScale)&&void 0!==t?t:S.One,r=null!==(e=null==s?void 0:s.globalRotation)&&void 0!==e?e:0,o=(null!==(i=null==s?void 0:s.globalPos)&&void 0!==i?i:S.Zero).add(this.offset);return this.localBounds.scale(n).rotate(r).translate(o)}get localBounds(){return R.fromPoints(this.points)}getInertia(t){let e=0,i=0;for(let t=0;t<this.points.length;t++){const s=(t+1)%this.points.length,n=this.points[s].cross(this.points[t]);e+=n*(this.points[t].dot(this.points[t])+this.points[t].dot(this.points[s])+this.points[s].dot(this.points[s])),i+=n}return t/6*(e/i)}rayCast(t,e=1/0){const i=this.getSides(),s=i.length;let n=Number.MAX_VALUE,r=-1;for(let o=0;o<s;o++){const s=t.intersect(i[o]);s>=0&&s<n&&s<=e&&(n=s,r=o)}return r>=0?t.getPoint(n):null}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<i;r++){const i=e[r].dot(t);s=Math.min(s,i),n=Math.max(n,i)}return new Wi(s,n)}draw(t,e=D.Green,i=S.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString();const n=this.points[0].add(s);t.moveTo(n.x,n.y),this.points.map((t=>t.add(s))).forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(n.x,n.y),t.closePath(),t.fill()}debug(t,e){const i=this.getTransformedPoints()[0],s=[i,...this.getTransformedPoints(),i];for(let i=0;i<s.length-1;i++)t.drawLine(s[i],s[i+1],e,2),t.drawCircle(s[i],2,e),t.drawCircle(s[i+1],2,e)}debugDraw(t,e=D.Red){t.beginPath(),t.strokeStyle=e.toString();const i=this.getTransformedPoints()[0];t.moveTo(i.x,i.y),this.getTransformedPoints().forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()}}class as{static Box(t,e,i=S.Half,s=S.Zero){return new os({points:new R(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=S.Zero){return new os({points:t,offset:e})}static Circle(t,e=S.Zero){return new es({radius:t,offset:e})}static Edge(t,e){return new rs({begin:t,end:e})}static Capsule(t,e,i=S.Zero){const s=v.getInstance();return t===e&&s.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),new Zi(e>=t?[as.Circle(t/2,A(0,-e/2+t/2).add(i)),as.Box(t,e-t,S.Half,i),as.Circle(t/2,A(0,e/2-t/2).add(i))]:[as.Circle(e/2,A(-t/2+e/2,0).add(i)),as.Box(t-e,e,S.Half,i),as.Circle(e/2,A(t/2-e/2,0).add(i))])}}class ls extends Oi{constructor(t){super(),this.type="ex.collider",this.events=new pe,this.$colliderAdded=new zi,this.$colliderRemoved=new zi,this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,this.events.wire(t.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this.events.unwire(this._collider.events),this.$colliderRemoved.notifyAll(this._collider),this._collider.owner=null,this._collider=null)}get bounds(){var t,e;return null!==(e=null===(t=this._collider)||void 0===t?void 0:t.bounds)&&void 0!==e?e:new R}get localBounds(){var t,e;return null!==(e=null===(t=this._collider)||void 0===t?void 0:t.localBounds)&&void 0!==e?e:new R}update(){var t;const e=null===(t=this.owner)||void 0===t?void 0:t.get(Ui);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let s=!1;if(i instanceof Zi&&(e=i,i=this._collider,s=!0),this._collider){const n=e.collide(i);return n?(s&&n.forEach((e=>{e.mtv=e.mtv.negate(),e.normal=e.normal.negate(),e.tangent=e.normal.perpendicular(),e.colliderA=this._collider,e.colliderB=t._collider})),n):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",(e=>{const i=e;t.events.emit("precollision",new Qt(i.target.owner,i.other.owner,i.side,i.intersection))})),this.events.on("postcollision",(e=>{const i=e;t.events.emit("postcollision",new Jt(i.target.owner,i.other.owner,i.side,i.intersection))})),this.events.on("collisionstart",(e=>{const i=e;t.events.emit("collisionstart",new ne(i.target.owner,i.other.owner,i.contact))})),this.events.on("collisionend",(e=>{const i=e;t.events.emit("collisionend",new re(i.target.owner,i.other.owner))}))}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=S.Half,s=S.Zero){const n=as.Box(t,e,i,s);return this.set(n)}usePolygonCollider(t,e=S.Zero){const i=as.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=S.Zero){const i=as.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=as.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new Zi(t))}}var hs,cs,ds,us;(cs=hs||(hs={})).Rotation="rotation",cs.X="x",cs.Y="y";class ps extends Oi{constructor(t){var e,i,s;super(),this.type="ex.body",this.dependencies=[Ui,Ni],this.id=f("body",ps._ID++),this.events=new pe,this.collisionType=Si.PreventCollision,this.group=Hi.All,this.mass=Fi.defaultMass,this.sleepMotion=5*Fi.sleepEpsilon,this.canSleep=Fi.bodiesCanSleepByDefault,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldPos=new S(0,0),this.oldVel=new S(0,0),this.oldAcc=S.Zero,this.oldRotation=0,this.oldScale=S.One,t&&(this.collisionType=null!==(e=t.type)&&void 0!==e?e:this.collisionType,this.group=null!==(i=t.group)&&void 0!==i?i:this.group,this.useGravity=null!==(s=t.useGravity)&&void 0!==s?s:this.useGravity)}get inverseMass(){return this.collisionType===Si.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=S.Zero,this.acc=S.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=5*Fi.sleepEpsilon}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),e=Fi.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=V(this.sleepMotion,0,10*Fi.sleepEpsilon),this.canSleep&&this.sleepMotion<Fi.sleepEpsilon&&this.setSleeping(!0)}get inertia(){const t=this.owner.get(ls);return(null==t?void 0:t.get())?t.get().getInertia(this.mass):0}get inverseInertia(){return this.collisionType===Si.Fixed?0:1/this.inertia}get active(){var t;return!!(null===(t=this.owner)||void 0===t?void 0:t.active)}get center(){return this.pos}get transform(){var t;return null===(t=this.owner)||void 0===t?void 0:t.get(Ui)}get motion(){var t;return null===(t=this.owner)||void 0===t?void 0:t.get(Ni)}get pos(){return this.transform.globalPos}set pos(t){this.transform.globalPos=t}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get sx(){return this.motion.scaleFactor.x}set sx(t){this.motion.scaleFactor.x=t}get sy(){return this.motion.scaleFactor.y}set sy(t){this.motion.scaleFactor.y=t}get rx(){return this.motion.angularVelocity}set rx(t){this.motion.angularVelocity=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==Si.Active)return;const i=e.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(hs.X)&&(i.x=0),this.limitDegreeOfFreedom.includes(hs.Y)&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(hs.Rotation)){const i=t.sub(this.pos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==Si.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(hs.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(hs.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===Si.Active&&!this.limitDegreeOfFreedom.includes(hs.Rotation)){const i=t.sub(this.pos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation}debugDraw(t){}}ps._ID=0;class gs{constructor(){this._topLeft=new S(0,0),this._topRight=new S(0,0),this._bottomLeft=new S(0,0),this._bottomRight=new S(0,0)}isSpriteOffScreen(t,e){const i=t.currentDrawing.drawWidth,s=t.currentDrawing.drawHeight,n=t.rotation,r=t.center,o=t.getGlobalPos();this._topLeft=A(o.x-i/2,o.y-s/2),this._topLeft=this._topLeft.rotate(n,r),this._topRight=A(o.x+i/2,o.y-s/2),this._topRight=this._topRight.rotate(n,r),this._bottomLeft=A(o.x-i/2,o.y+s/2),this._bottomLeft=this._bottomLeft.rotate(n,r),this._bottomRight=A(o.x+i/2,o.y+s/2),this._bottomRight=this._bottomRight.rotate(n,r);const a=e.worldToScreenCoordinates(this._topLeft),l=e.worldToScreenCoordinates(this._topRight),h=e.worldToScreenCoordinates(this._bottomLeft),c=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,l.x,h.x,c.x),this._yCoords.push(a.y,l.y,h.y,c.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);const d=e.screenToWorldCoordinates(new S(this._xMin,this._yMin)),u=e.screenToWorldCoordinates(new S(this._xMax,this._yMax));this._xMinWorld=d.x,this._yMinWorld=d.y,this._xMaxWorld=u.x,this._yMaxWorld=u.y;const p=[new S(this._xMin,this._yMin),new S(this._xMax,this._yMin),new S(this._xMin,this._yMax),new S(this._xMax,this._yMax)];if(p[0].x<0&&p[1].x>e.canvas.clientWidth&&(p[0].y>0||p[2].y<e.canvas.clientHeight))return!1;if(p[0].y<0&&p[2].y>e.canvas.clientHeight&&(p[1].x>0||p[0].x<e.canvas.clientWidth))return!1;for(let t=0;t<p.length;t++)if(p[t].x>0&&p[t].y>0&&p[t].x<e.canvas.clientWidth&&p[t].y<e.canvas.clientHeight)return!1;return!0}debugDraw(t){t.beginPath(),t.strokeStyle=D.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=D.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=D.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=D.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=D.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()}}class _s{constructor(){this.cullingBox=new gs}update(t,e){const i=t.eventDispatcher;let s=!0;null!=t.currentDrawing&&(s=this.cullingBox.isSpriteOffScreen(t,e));let n=!1;e&&e.currentScene&&e.currentScene.camera&&e.currentScene.camera.viewport&&!t.parent&&(n=!e.currentScene.camera.viewport.intersect(t.collider.bounds)),t.isOffScreen?n&&s||(i.emit("enterviewport",new ce(t)),t.removeComponent("offscreen")):n&&s&&(i.emit("exitviewport",new he(t)),t.addComponent(new Vi("offscreen")))}}class ms{constructor(t){this.data=t,this.type="Component Added"}}function fs(t){return!!t&&"Component Added"===t.type}class vs{constructor(t){this.data=t,this.type="Component Removed"}}function bs(t){return!!t&&"Component Removed"===t.type}class ws extends mi{constructor(t,e){if(super(),this.id=ws._ID++,this._name="anonymous",this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new zi,this.componentRemoved$=new zi,this._parent=null,this.childrenAdded$=new zi,this.childrenRemoved$=new zi,this._children=[],this._isInitialized=!1,this._setName(e),t)for(const e of t)this.addComponent(e)}_setName(t){t&&(this._name=t)}get name(){return this._name}get events(){return this.eventDispatcher}kill(){this.active=!1}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new Vi(t))}removeTag(t,e=!1){return this.removeComponent(t,e)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter((t=>t instanceof Vi)).map((t=>t.type)),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();const e=new ms({component:t,entity:this});this.componentAdded$.notifyAll(e)}_notifyRemoveComponent(t){const e=new vs({component:t,entity:this});this.componentRemoved$.notifyAll(e),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(null!==t.parent)throw new Error("Entity already has a parent, cannot add without unparenting");if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");return this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t),this}removeChild(t){return t.parent===this&&(it(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){return this.children.forEach((t=>{this.removeChild(t)})),this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();e=e.concat(i.children),t=t.concat(i.children)}return t}clone(){const t=new ws;for(const e of this.types)t.addComponent(this.get(e).clone());for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const e of t.children)this.addChild(e.clone().addTemplate(e));return this}addComponent(t,e=!1){if(this.has(t.type)){if(!e)return this;this.removeComponent(t)}if(t.dependencies&&t.dependencies.length)for(const e of t.dependencies)this.addComponent(new e);t.owner=this;const i=t.constructor;return this._componentTypeToInstance.set(i,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,e=!1){return e?"string"==typeof t?this._removeComponentByType(t):t instanceof Oi&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){if(this.has(t)){const e=this.get(t);e.owner=null,e.onRemove&&e.onRemove(this);const i=e.constructor;this._componentTypeToInstance.delete(i),this._componentStringToInstance.delete(e.type),this._notifyRemoveComponent(e)}}processComponentRemoval(){for(const t of this._componentsToRemove){const e="string"==typeof t?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return"string"==typeof t?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return"string"==typeof t?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new zt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e)}}ws._ID=0;class xs extends Oi{constructor(t){var e;super(),this.draw=t,this.type="ex.canvas",this.draw=null!==(e=this.draw)&&void 0!==e?e:()=>{}}}function ys(t){return!!t.tick}class Cs{constructor(t,e){this._options=t,this._graphics=e,this.graphics=[]}get name(){return this._options.name}hide(t){if(t){let e=null;e=t instanceof wt?t:this._graphics.getGraphic(t),this.graphics=this.graphics.filter((t=>t.graphic!==e)),this._graphics.recalculateBounds()}else this.graphics.length=0}show(t,e){let i;return e={...e},t instanceof wt?i=this._graphics.copyGraphics?t.clone():t:(i=this._graphics.getGraphic(t),i||v.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),i?(this.graphics.push({graphic:i,options:e}),this._graphics.recalculateBounds(),i):null}use(t,e){return e={...e},this.hide(),this.show(t,e)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return null!==(t=this._options.offset)&&void 0!==t?t:S.Zero}set offset(t){this._options.offset=t}get currentKeys(){var t;return null!==(t=this.name)&&void 0!==t?t:"anonymous"}}class Ps{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new Cs({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){const e=new Cs(t,this._component);return this._maybeAddLayer(e)}get(t){return t?this._getLayer(t):this._layers}currentKeys(){const t=[];for(const e of this._layers)t.push(e.currentKeys);return t}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort(((t,e)=>t.order-e.order)),t)}_getLayer(t){return this._layerMap[t]}}class Es extends Oi{constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=S.Zero,this.anchor=S.Half,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,...t};const{current:e,anchor:i,opacity:s,visible:n,graphics:r,offset:o,copyGraphics:a,onPreDraw:l,onPostDraw:h}=t;this._graphics=r||{},this.offset=null!=o?o:this.offset,this.opacity=null!=s?s:this.opacity,this.anchor=null!=i?i:this.anchor,this.copyGraphics=null!=a?a:this.copyGraphics,this.onPreDraw=null!=l?l:this.onPreDraw,this.onPostDraw=null!=h?h:this.onPostDraw,this.visible=!!n,this.layers=new Ps(this),e&&this._graphics[e]&&this.show(this._graphics[e])}getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,e){let i="default",s=null;return"string"==typeof t?(i=t,s=e):s=t,this._graphics[i]=this.copyGraphics?s.clone():s,"default"===i&&this.show("default"),s}show(t,e){const i=this.layers.default.show(t,e);return this.recalculateBounds(),i}use(t,e){const i=this.layers.default.use(t,e);return this.recalculateBounds(),i}hide(t){this.layers.default.hide(t)}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new R;for(const e of this.layers.get())for(const{graphic:i,options:s}of e.graphics){let n=this.anchor,r=this.offset;(null==s?void 0:s.anchor)&&(n=s.anchor),(null==s?void 0:s.offset)&&(r=s.offset);const o=i.localBounds,a=-o.width*n.x+r.x,l=-o.height*n.y+r.y;t=null==i?void 0:i.localBounds.translate(A(a+e.offset.x,l+e.offset.y)).combine(t)}this._localBounds=t}get localBounds(){return this._localBounds||this.recalculateBounds(),this._localBounds}update(t,e=0){for(const i of this.layers.get())for(const{graphic:s}of i.graphics)ys(s)&&(null==s||s.tick(t,e))}}class Ss extends Tt{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Ss({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class As extends Tt{constructor(t){var e,i;super(t),this._radius=0,this.padding=null!==(e=t.padding)&&void 0!==e?e:2,this.radius=t.radius,this.filtering=null!==(i=t.filtering)&&void 0!==i?i:dt.Blended,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=2*this._radius,this.height=2*this._radius,this.flagDirty()}clone(){return new As({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Ts extends Oi{constructor(){super(...arguments),this.type="ex.pointer",this.useColliderShape=!0,this.useGraphicsBounds=!1}}class ks{static CreateReversibleEasingFunction(t){return(e,i,s,n)=>s<i?i-(t(e,s,i,n)-s):t(e,i,s,n)}static CreateReversableEasingFunction(t){return ks.CreateReversibleEasingFunction(t)}static CreateVectorEasingFunction(t){return(e,i,s,n)=>new S(t(e,i.x,s.x,n),t(e,i.y,s.y,n))}}ks.Linear=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*t/s+e)),ks.EaseInQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t+e)),ks.EaseOutQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>-(i-=e)*(t/=s)*(t-2)+e)),ks.EaseInOutQuad=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e))),ks.EaseInCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t*t+e)),ks.EaseOutCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(t/=s,(i-=e)*(--t*t*t+1)+e))),ks.EaseInOutCubic=ks.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e))),function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([E({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"CreateReversibleEasingFunction"})],ks,"CreateReversableEasingFunction",null);class Is{constructor(t){this._actions=[],this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return 0===this._actions.length}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._entity)&&this._completedActions.push(this._actions.shift()))}}class Ds{constructor(t,e,i){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Ms{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new qs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Rs{constructor(t,e,i,s){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(Ui),this._motion=t.get(Ni),this._speed=s,this._offset=new S(e,i),s<=0)throw v.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new S(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(Ui);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1}}class Bs{constructor(t,e,i,s){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._end=new S(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new S(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=A(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}isComplete(t){const e=t.get(Ui);return this._stopped||new S(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1}}(us=ds||(ds={}))[us.ShortestPath=0]="ShortestPath",us[us.LongestPath=1]="LongestPath",us[us.Clockwise=2]="Clockwise",us[us.CounterClockwise=3]="CounterClockwise";class $s{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._end=e,this._speed=i,this._rotationType=s||ds.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const t=Math.abs(this._end-this._start),e=F-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+F)%F>=Math.PI,this._rotationType){case ds.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ds.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ds.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ds.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1}}class Fs{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._speed=i,this._offset=e,this._rotationType=s||ds.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const t=Math.abs(this._end-this._start),e=F-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+F)%F>=Math.PI,this._rotationType){case ds.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ds.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ds.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ds.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1}}class Ls{constructor(t,e,i,s,n){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._endX=e,this._endY=i,this._speedX=s,this._speedY=n}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const t=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*t}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const t=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*t}this.isComplete()&&(this._tx.scale=A(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.y-this._startX)>=this._distanceX&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1}}class Os{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._offset=new S(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1}}class Vs{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class zs{constructor(t,e,i,s,n){this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new S(0,0),this._lerpEnd=new S(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._tx=t.get(Ui),this._motion=t.get(Ni),this._lerpDuration=s,this._lerpEnd=new S(e,i)}_initialize(){this._lerpStart=new S(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=A((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=A(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=S.Zero)}isComplete(t){return this._stopped||new S(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance}reset(){this._initialized=!1}stop(){this._motion.vel=A(0,0),this._stopped=!0}}class Us{constructor(t,e,i,s=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Es),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._elapsedTime=0,this._totalTime=0}}class Ns{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Es),this._endOpacity=e,this._speed=i}update(t){this._graphics&&(this._started||(this._started=!0,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),v.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1}}class Hs{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1}}class js{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(Ks).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Ws{constructor(t,e,i){this._started=!1,this._stopped=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._followTx=e.get(Ui),this._followMotion=e.get(Ni),this._current=new S(this._tx.pos.x,this._tx.pos.y),this._end=new S(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(0!==e&&(this._speed=e),this._current=A(this._tx.pos.x,this._tx.pos.y),this._end=A(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const t=this._dir.scale(this._speed);this._motion.vel=A(t.x,t.y)}else this._motion.vel=A(0,0);this.isComplete()&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}stop(){this._motion.vel=A(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1}}class Gs{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(Ui),this._motion=t.get(Ni),this._meetTx=e.get(Ui),this._meetMotion=e.get(Ni),this._current=new S(this._tx.pos.x,this._tx.pos.y),this._end=new S(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current=A(this._tx.pos.x,this._tx.pos.y),this._end=A(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=A(i.x,i.y),this.isComplete()&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1}}class qs{constructor(t){this._entity=t,this._queue=new Is(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}easeTo(...t){var e,i;let s=0,n=0,r=0,o=ks.Linear;return t[0]instanceof S?(s=t[0].x,n=t[0].y,r=t[1],o=null!==(e=t[2])&&void 0!==e?e:o):(s=t[0],n=t[1],r=t[2],o=null!==(i=t[3])&&void 0!==i?i:o),this._queue.add(new zs(this._entity,s,n,r,o)),this}moveTo(t,e,i){let s=0,n=0,r=0;return t instanceof S?(s=t.x,n=t.y,r=e):(s=t,n=e,r=i),this._queue.add(new Bs(this._entity,s,n,r)),this}moveBy(t,e,i){let s=0,n=0,r=0;return t instanceof S?(s=t.x,n=t.y,r=e):(s=t,n=e,r=i),this._queue.add(new Rs(this._entity,s,n,r)),this}rotateTo(t,e,i){return this._queue.add(new $s(this._entity,t,e,i)),this}rotateBy(t,e,i){return this._queue.add(new Fs(this._entity,t,e,i)),this}scaleTo(t,e,i,s){let n=1,r=1,o=0,a=0;return t instanceof S&&e instanceof S&&(n=t.x,r=t.y,o=e.x,a=e.y),"number"==typeof t&&"number"==typeof e&&(n=t,r=e,o=i,a=s),this._queue.add(new Ls(this._entity,n,r,o,a)),this}scaleBy(t,e,i){let s=1,n=1;return t instanceof S&&(s=t.x,n=t.y,i=e),"number"==typeof t&&"number"==typeof e&&(s=t,n=e),this._queue.add(new Os(this._entity,s,n,i)),this}blink(t,e,i=1){return this._queue.add(new Us(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new Ns(this._entity,t,e)),this}delay(t){return this._queue.add(new Hs(t)),this}die(){return this._queue.add(new js(this._entity)),this}callMethod(t){return this._queue.add(new Vs(t)),this}repeat(t,e){return e?(this._queue.add(new Ds(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Ms(this._entity,t)),this}follow(t,e){return void 0===e?this._queue.add(new Ws(this._entity,t)):this._queue.add(new Ws(this._entity,t,e)),this}meet(t,e){return void 0===e?this._queue.add(new Gs(this._entity,t)):this._queue.add(new Gs(this._entity,t,e)),this}asPromise(){return this.toPromise()}toPromise(){return new Promise((t=>{this._queue.add(new Vs((()=>{t()})))}))}}class Ks extends Oi{constructor(){super(...arguments),this.type="ex.actions",this.dependencies=[Ui,Ni]}onAdd(t){this._ctx=new qs(t)}onRemove(){this._ctx=null}getQueue(){var t;return null===(t=this._ctx)||void 0===t?void 0:t.getQueue()}update(t){var e;return null===(e=this._ctx)||void 0===e?void 0:e.update(t)}clearActions(){var t;null===(t=this._ctx)||void 0===t||t.clearActions()}easeTo(...t){return this._ctx.easeTo.apply(this._ctx,t)}moveTo(t,e,i){return this._ctx.moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._ctx.moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._ctx.rotateTo(t,e,i)}rotateBy(t,e,i){return this._ctx.rotateBy(t,e,i)}scaleTo(t,e,i,s){return this._ctx.scaleTo.apply(this._ctx,[t,e,i,s])}scaleBy(t,e,i){return this._ctx.scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._ctx.blink(t,e,i)}fade(t,e){return this._ctx.fade(t,e)}delay(t){return this._ctx.delay(t)}die(){return this._ctx.die()}callMethod(t){return this._ctx.callMethod(t)}repeat(t,e){return this._ctx.repeat(t,e)}repeatForever(t){return this._ctx.repeatForever(t)}follow(t,e){return this._ctx.follow(t,e)}meet(t,e){return this._ctx.meet(t,e)}asPromise(){return this.toPromise()}toPromise(){return this._ctx.toPromise()}}class Xs extends wt{constructor(t={}){var e,i,s,n,r,o,a,l,h,c,d,u,p,g,_,m,f,v,b;super(t),this.filtering=dt.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=D.Black,this.family="sans-serif",this.style=Ve.Normal,this.bold=!1,this.unit=Re.Px,this.textAlign=$e.Left,this.baseAlign=Le.Alphabetic,this.direction=Ue.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new R,this._textToBitmap=new Map,this._bitmapUsage=new Map,this.smoothing=null!==(e=null==t?void 0:t.smoothing)&&void 0!==e?e:this.smoothing,this.padding=null!==(i=null==t?void 0:t.padding)&&void 0!==i?i:this.padding,this.color=null!==(s=null==t?void 0:t.color)&&void 0!==s?s:this.color,this.strokeColor=null!==(n=null==t?void 0:t.strokeColor)&&void 0!==n?n:this.strokeColor,this.lineDash=null!==(r=null==t?void 0:t.lineDash)&&void 0!==r?r:this.lineDash,this.lineWidth=null!==(o=null==t?void 0:t.lineWidth)&&void 0!==o?o:this.lineWidth,this.filtering=null!==(a=null==t?void 0:t.filtering)&&void 0!==a?a:this.filtering,this.family=null!==(l=null==t?void 0:t.family)&&void 0!==l?l:this.family,this.style=null!==(h=null==t?void 0:t.style)&&void 0!==h?h:this.style,this.bold=null!==(c=null==t?void 0:t.bold)&&void 0!==c?c:this.bold,this.size=null!==(d=null==t?void 0:t.size)&&void 0!==d?d:this.size,this.unit=null!==(u=null==t?void 0:t.unit)&&void 0!==u?u:this.unit,this.textAlign=null!==(p=null==t?void 0:t.textAlign)&&void 0!==p?p:this.textAlign,this.baseAlign=null!==(g=null==t?void 0:t.baseAlign)&&void 0!==g?g:this.baseAlign,this.direction=null!==(_=null==t?void 0:t.direction)&&void 0!==_?_:this.direction,this.quality=null!==(m=null==t?void 0:t.quality)&&void 0!==m?m:this.quality,(null==t?void 0:t.shadow)&&(this.shadow={},this.shadow.blur=null!==(f=t.shadow.blur)&&void 0!==f?f:this.shadow.blur,this.shadow.offset=null!==(v=t.shadow.offset)&&void 0!==v?v:this.shadow.offset,this.shadow.color=null!==(b=t.shadow.color)&&void 0!==b?b:this.shadow.color)}clone(){return new Xs({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=null!==(e=this.origin)&&void 0!==e?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureText(t){const e=t.split("\n"),i=e.reduce(((t,e)=>t.length>e.length?t:e)),s=this._getTextBitmap(t);this._applyFont(s);const n=s.measureText(i);let r=Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxDescent);const o=r*e.length;r=o;const a=o-Math.abs(n.actualBoundingBoxAscent);return new R({left:0-Math.abs(n.actualBoundingBoxLeft)-this.padding,top:0-Math.abs(n.actualBoundingBoxAscent)-this.padding,bottom:0+a+this.padding,right:0+Math.abs(n.actualBoundingBoxRight)+this.padding})}_setDimension(t,e){e.canvas.width=2*(t.width+2*this.padding)*this.quality,e.canvas.height=2*(t.height+2*this.padding)*this.quality}_postDraw(t){t.restore()}_getRasterPropertiesHash(t){var e,i;return"__hashcode__"+this.fontString+this.showDebug+this.textAlign+this.baseAlign+this.direction+JSON.stringify(this.shadow)+(this.padding.toString()+this.smoothing.toString()+this.lineWidth.toString()+this.lineDash.toString()+(null===(e=this.strokeColor)||void 0===e?void 0:e.toString())+(t?t.toString():null===(i=this.color)||void 0===i?void 0:i.toString()).toString())}_applyRasterProperties(t,e){var i,s,n;t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash(null!==(i=this.lineDash)&&void 0!==i?i:t.getLineDash()),t.strokeStyle=null===(s=this.strokeColor)||void 0===s?void 0:s.toString(),t.fillStyle=e?e.toString():null===(n=this.color)||void 0===n?void 0:n.toString()}_applyFont(t){t.translate(this.padding+t.canvas.width/2,this.padding+t.canvas.height/2),t.scale(this.quality,this.quality),t.textAlign=this.textAlign,t.textBaseline=this.baseAlign,t.font=this.fontString,t.direction=this.direction,this.shadow&&(t.shadowColor=this.shadow.color.toString(),t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y)}_drawText(t,e,i,s){const n=e.split("\n");this._applyRasterProperties(t,i),this._applyFont(t);for(let e=0;e<n.length;e++){const i=n[e];this.color&&t.fillText(i,0,e*s),this.strokeColor&&t.strokeText(i,0,e*s)}this.showDebug&&(fi(t,D.Red,-t.canvas.width/2,0,t.canvas.width/2,0,2),fi(t,D.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_getTextBitmap(t,e){const i=t+this._getRasterPropertiesHash(e),s=this._textToBitmap.get(i);if(s)return s;const n=document.createElement("canvas").getContext("2d");return this._textToBitmap.set(i,n),n}render(t,e,i,s,n){this.showDebug&&this.clearCache(),this.checkAndClearCache();const r=this._getTextBitmap(e,i),o=!this._bitmapUsage.get(r);this._textBounds=this.measureText(e),o&&this._setDimension(this._textBounds,r),this._preDraw(t,s,n);const a=e.split("\n"),l=this._textBounds.height/a.length,h=r.canvas.width,c=r.canvas.height;o&&(this._drawText(r,e,i,l),At.load(r.canvas,this.filtering,!0)),t.drawImage(r.canvas,0,0,h,c,s-h/this.quality/2,n-c/this.quality/2,h/this.quality,c/this.quality),this._postDraw(t),this._bitmapUsage.set(r,performance.now())}get cacheSize(){return this._bitmapUsage.size}clearCache(){this._bitmapUsage.clear()}checkAndClearCache(){for(const[t,e]of this._bitmapUsage.entries())e+1e3<performance.now()&&this._bitmapUsage.delete(t)}}class Ys extends wt{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=null!==(e=t.font)&&void 0!==e?e:new Xs,this.color=null!==(i=t.color)&&void 0!==i?i:this.color,this.text=t.text}clone(){var t,e;return new Ys({text:this.text.slice(),color:null!==(e=null===(t=this.color)||void 0===t?void 0:t.clone())&&void 0!==e?e:D.Black,font:this.font.clone()})}get text(){return this._text}set text(t){this._text=t;const e=this.font.measureText(this._text);this._textWidth=e.width,this._textHeight=e.height}get font(){return this._font}set font(t){this._font=t}get width(){return 0===this._textWidth&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return 0===this._textHeight&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text).scale(this.scale)}_rotate(t){}_flip(t){}_drawImage(t,e,i){var s;let n=D.Black;this.font instanceof Xs&&(n=null!==(s=this.color)&&void 0!==s?s:this.font.color),(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity);const{width:r,height:o}=this.font.measureText(this._text);this._textWidth=r,this._textHeight=o,this.font.render(t,this._text,n,e,i),this.font.showDebug&&t.debug.drawRect(e-r,i-o,2*r,2*o)}}var Zs=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Qs extends ws{constructor(t){super(),this._anchor=vt(S.Half,(t=>this._handleAnchorChange(t))),this.logger=v.getInstance(),this.scene=null,this.frames={},this.currentDrawing=null,this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=t=>{this._dragging&&(this.pos=t.worldPos)},this._pointerDragLeaveHandler=t=>{this._dragging&&(this.pos=t.worldPos)},this.traits=[];const{name:e,x:i,y:s,pos:n,coordPlane:r,scale:o,width:a,height:l,radius:h,collider:d,vel:u,acc:p,rotation:g,angularVelocity:_,z:f,color:b,visible:w,anchor:x,collisionType:y,collisionGroup:C}={...t};this._setName(e),this.anchor=null!=x?x:Qs.defaults.anchor.clone();const P=new Ui;this.addComponent(P),this.pos=null!=n?n:A(null!=i?i:0,null!=s?s:0),this.rotation=null!=g?g:0,this.scale=null!=o?o:A(1,1),this.z=null!=f?f:0,P.coordPlane=null!=r?r:Bi.World,this.addComponent(new Ts),this.addComponent(new Es({anchor:this.anchor})),this.addComponent(new xs(((t,e)=>this.draw(t,e)))),this.addComponent(new Ni),this.vel=null!=u?u:S.Zero,this.acc=null!=p?p:S.Zero,this.angularVelocity=null!=_?_:0,this.addComponent(new Ks),this.addComponent(new ps),this.body.collisionType=null!=y?y:Si.Passive,C&&(this.body.group=C),d?this.addComponent(new ls(d)):h?this.addComponent(new ls(as.Circle(h,this.anchor))):a>0&&l>0?this.addComponent(new ls(as.Box(a,l,this.anchor))):this.addComponent(new ls),this.graphics.visible=null==w||w,b&&(this.color=b,a&&l?this.graphics.add(new Ss({color:b,width:a,height:l})):h&&this.graphics.add(new As({color:b,radius:h}))),m.isEnabled(c.LegacyDrawing)&&this.traits.push(new _s)}get body(){return this.get(ps)}get transform(){return this.get(Ui)}get motion(){return this.get(Ni)}get graphics(){return this.get(Es)}get collider(){return this.get(ls)}get pointer(){return this.get(Ts)}get actions(){return this.get(Ks)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(Ui).scale}set scale(t){this.get(Ui).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=vt(t,(t=>this._handleAnchorChange(t))),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get isOffScreen(){return this.hasTag("offscreen")}get visible(){return this.graphics.visible}set visible(t){this.graphics.visible=t}get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){var e;this._color=t.clone();const i=null===(e=this.graphics.layers.default.graphics[0])||void 0===e?void 0:e.graphic;(i instanceof Tt||i instanceof Ys)&&(i.color=this._color)}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new Mt(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new Rt(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new Dt(this)),super.kill(),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")}unkill(){this.active=!0}isKilled(){return!this.active}setDrawing(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):v.getInstance().error(`the specified drawing key ${t} does not exist`)),this.currentDrawing&&this.currentDrawing instanceof Me&&this.currentDrawing.tick(0)}addDrawing(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof Te&&this.addDrawing("default",arguments[0]),arguments[0]instanceof Ee&&this.addDrawing("default",arguments[0].asSprite()))}get z(){return this.get(Ui).z}getZIndex(){return this.get(Ui).z}set z(t){this.get(Ui).z=t}setZIndex(t){this.get(Ui).z=t}get center(){const t=this.getGlobalPos();return new S(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new S(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(Ui).globalRotation}getGlobalPos(){return this.get(Ui).globalPos}getGlobalScale(){return this.get(Ui).globalScale}contains(t,e,i=!1){const s=A(t,e),n=this.get(ls);n.update();const r=n.get();if(!r)return!1;const o=r.contains(s);return i?o||this.children.some((i=>i.contains(t,e,!0))):o}within(t,e){const i=this.get(ls),s=t.get(ls),n=i.get(),r=s.get();return!(!n||!r)&&n.getClosestLineBetween(r).getLength()<=e}update(t,e){this._initialize(t),this._preupdate(t,e);const i=this.currentDrawing;i&&i instanceof Me&&i.tick(e,t.stats.currFrame.id);for(const i of this.traits)i.update(this,t,e);this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new zt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new zt(t,e,this)),this.onPostUpdate(t,e)}draw(t,e){var i;if(t.save(),this.currentDrawing){t.translate(-this.width*this.anchor.x,-this.height*this.anchor.y),this._predraw(t,e);const i=this.currentDrawing,s=(this.width-i.width*i.scale.x)*this.anchor.x,n=(this.height-i.height*i.scale.y)*this.anchor.y;this.currentDrawing.draw({ctx:t,x:s,y:n,opacity:this.graphics.opacity})}else if(this._predraw(t,e),this.color&&this.collider){const e=this.get(ls);e.update(),e&&!e.bounds.hasZeroDimensions()&&(t.globalAlpha=this.graphics.opacity,null===(i=e.get())||void 0===i||i.draw(t,this.color,A(0,0)))}t.restore(),this._postdraw(t,e)}onPreDraw(t,e){}onPostDraw(t,e){}_predraw(t,e){this.emit("predraw",new Ft(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Ft(t,e,this)),this.onPostDraw(t,e)}debugDraw(t){}}Qs.defaults={anchor:S.Half},Zs([E({message:"Actor.visible will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.visible"})],Qs.prototype,"visible",null),Zs([E({message:"Actor.opacity will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.opacity"})],Qs.prototype,"opacity",null),Zs([E({message:"Actor.setDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.show() or Actor.graphics.use()"})],Qs.prototype,"setDrawing",null),Zs([E({message:"Actor.addDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.add()"})],Qs.prototype,"addDrawing",null),Zs([E({message:"Actor.getZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Qs.prototype,"getZIndex",null),Zs([E({message:"Actor.setZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Qs.prototype,"setZIndex",null);class Js extends Qs{constructor(t){super({...t}),this.get(Ui).coordPlane=Bi.Screen,this.anchor=A(0,0),this.body.collisionType=Si.PreventCollision,this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new S(t,e));return super.contains(s.x,s.y)}}class tn{constructor(t,e,i,s){if(this._logger=v.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this._complete=!1,this.scene=null,"function"!=typeof t){const n=t;t=n.fcn,e=n.interval,i=n.repeats,s=n.numberOfRepeats}if(s&&s>=0&&(this.maxNumberOfRepeats=s,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=tn._MAX_ID++,this.interval=e||this.interval,this.repeats=i||this.repeats,this._callbacks=[],t&&this.on(t)}get complete(){return this._complete}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach((t=>{t.call(this)})),this._numberOfTicks++,this.repeats||(this._complete=!0,this._running=!1),this._elapsedTime=0))}reset(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}unpause(){this._running=!0}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}tn._MAX_ID=0,function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)}([E({message:"Will be removed in v0.26.0",alternateMethod:"Use Timer.resume()"})],tn.prototype,"unpause",null);class en extends Oi{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e,this.type="ex.debuggraphics"}}var sn,nn,rn=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class on extends ws{constructor(t){var e;super(null,t.name),this._token=0,this._onScreenXStart=0,this._onScreenXEnd=Number.MAX_VALUE,this._onScreenYStart=0,this._onScreenYEnd=Number.MAX_VALUE,this._spriteSheets={},this._legacySpriteMap=new Map,this.logger=v.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this._collidersDirty=!0,this._originalOffsets=new WeakMap,this.addComponent(new Ui),this.addComponent(new Ni),this.addComponent(new ps({type:Si.Fixed})),this.addComponent(new xs(((t,e)=>this.draw(t,e)))),this.addComponent(new Es({onPostDraw:(t,e)=>this.draw(t,e)})),this.addComponent(new en((t=>this.debug(t)))),this.addComponent(new ls),this._transform=this.get(Ui),this._motion=this.get(Ni),this._collider=this.get(ls),this._composite=this._collider.useCompositeCollider([]),this._transform.pos=null!==(e=t.pos)&&void 0!==e?e:S.Zero,this._transform.posChanged$.subscribe((()=>this.flagCollidersDirty())),this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.height=t.height,this.width=t.width,this.tiles=new Array(this.height*this.width),this._rows=new Array(this.height),this._cols=new Array(this.width);let i=[];for(let t=0;t<this.width;t++){for(let e=0;e<this.height;e++){const s=new an({x:t,y:e,map:this});s.map=this,this.tiles[t+e*this.width]=s,i.push(s),this._rows[e]||(this._rows[e]=[]),this._rows[e].push(s)}this._cols[t]=i,i=[]}this.get(Es).localBounds=new R({left:0,top:0,right:this.width*this.tileWidth,bottom:this.height*this.tileHeight})}flagCollidersDirty(){this._collidersDirty=!0}get x(){var t;return null!==(t=this._transform.pos.x)&&void 0!==t?t:0}set x(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this.get(Ui).pos=A(t,this.y))}get y(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos.y)&&void 0!==e?e:0}set y(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this._transform.pos=A(this.x,t))}get z(){var t;return null!==(t=this._transform.z)&&void 0!==t?t:0}set z(t){this._transform&&(this._transform.z=t)}get rotation(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.rotation)&&void 0!==e?e:0}set rotation(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.rotation)&&(this._transform.rotation=t)}get scale(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.scale)&&void 0!==e?e:S.One}set scale(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.scale)&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}on(t,e){super.on(t,e)}_initialize(t){super._initialize(t)}registerSpriteSheet(t,e){this._spriteSheets[t]=e instanceof We?e:We.fromLegacySpriteSheet(e)}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}_updateColliders(){this._composite.clearColliders();const t=[];let e;this._composite=this._collider.useCompositeCollider([]);for(let i=0;i<this.width;i++){for(let s=0;s<this.height;s++){0===s&&(e=null);const n=this.tiles[i+s*this.width];if(n.solid)if(n.getColliders().length>0){for(const t of n.getColliders()){const e=this._getOrSetColliderOriginalOffset(t);t.offset=A(n.x*this.tileWidth,n.y*this.tileHeight).add(e),t.owner=this,this._composite.addCollider(t)}e=null}else e=e?e.combine(n.bounds):n.bounds;else e&&t.push(e),e=null}if(e){const i=t[t.length-1];i&&i.top===e.top&&i.bottom===e.bottom?t[t.length-1]=i.combine(e):t.push(e)}}for(const e of t){const t=as.Box(e.width,e.height,S.Zero,A(e.left-this.pos.x,e.top-this.pos.y));t.owner=this,this._composite.addCollider(t)}this._collider.update()}getTileByIndex(t){return this.tiles[t]}getTile(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.tiles[t+e*this.width]}getTileByPoint(t){const e=Math.floor((t.x-this.pos.x)/this.tileWidth),i=Math.floor((t.y-this.pos.y)/this.tileHeight),s=this.getTile(e,i);return e>=0&&i>=0&&e<this.width&&i<this.height&&s?s:null}getRows(){return this._rows}getColumns(){return this._cols}update(t,e){this.onPreUpdate(t,e),this.emit("preupdate",new zt(t,e,this)),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++;const i=t.getWorldBounds(),s=A(i.left,i.top),n=A(i.right,i.bottom);this._onScreenXStart=Math.max(Math.floor((s.x-this.x)/this.tileWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((s.y-this.y)/this.tileHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((n.x-this.x)/this.tileWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((n.y-this.y)/this.tileHeight)+2,0),this._transform.pos=A(this.x,this.y),this.onPostUpdate(t,e),this.emit("postupdate",new Ut(t,e,this))}draw(t,e){this.emit("predraw",new Ft(t,e,this));let i=this._onScreenXStart;const s=Math.min(this._onScreenXEnd,this.width);let n=this._onScreenYStart;const r=Math.min(this._onScreenYEnd,this.height);let o,a,l;for(;i<s;i++){for(;n<r;n++)for(o=this.getTile(i,n).getGraphics(),a=0,l=o.length;a<l;a++){const s=o[a];s&&(t instanceof CanvasRenderingContext2D?s instanceof ke&&(this._legacySpriteMap.has(s)||this._legacySpriteMap.set(s,ke.toLegacySprite(s)),this._legacySpriteMap.get(s).draw(t,i*this.tileWidth,n*this.tileHeight)):(ys(s)&&(null==s||s.tick(e,this._token)),s.draw(t,i*this.tileWidth,n*this.tileHeight)))}n=this._onScreenYStart}this.emit("postdraw",new Lt(t,e,this))}debug(t){const e=this.tileWidth*this.width,i=this.tileHeight*this.height,s=S.Zero;for(let i=0;i<this.height+1;i++){const n=A(0,i*this.tileHeight);t.drawLine(s.add(n),s.add(A(e,n.y)),D.Red,2)}for(let e=0;e<this.width+1;e++){const n=A(e*this.tileWidth,0);t.drawLine(s.add(n),s.add(A(n.x,i)),D.Red,2)}const n=this._composite.getColliders();for(const e of n){const i=D.Gray;i.a=.5;const s=e.localBounds,n=e.worldPos.sub(this.pos);t.drawRectangle(n,s.width,s.height,i)}}}rn([E({message:"No longer used, will be removed in v0.26.0"})],on.prototype,"registerSpriteSheet",null);class an extends ws{constructor(t){var e,i;super(),this._posDirty=!1,this._solid=!1,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this.width=t.map.tileWidth,this.height=t.map.tileHeight,this.solid=null!==(e=t.solid)&&void 0!==e?e:this.solid,this._graphics=null!==(i=t.graphics)&&void 0!==i?i:[],this._recalculate(),this._transform=t.map.get(Ui),this._transform.posChanged$.subscribe((()=>{this._posDirty=!0}))}get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get solid(){return this._solid}set solid(t){var e;null===(e=this.map)||void 0===e||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}addGraphic(t){t instanceof Te?this._graphics.push(ke.fromLegacySprite(t)):this._graphics.push(t)}removeGraphic(t){it(t,this._graphics)}clearGraphics(){this._graphics.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}_recalculate(){this._pos=this.map.pos.add(A(this.x*this.map.tileWidth,this.y*this.map.tileHeight)),this._bounds=new R(this._pos.x,this._pos.y,this._pos.x+this.width,this._pos.y+this.height)}get bounds(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._bounds}get center(){return new S(this._pos.x+this.width/2,this._pos.y+this.height/2)}pushSprite(t){this.addGraphic(t)}}rn([E({message:"Will be removed in v0.26.0",alternateMethod:"addSprite"})],an.prototype,"pushSprite",null);class ln{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new hn(t))}lockToActorAxis(t,e){this.camera.addStrategy(new cn(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new dn(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new un(t,e))}limitCameraBounds(t){this.camera.addStrategy(new pn(t))}}(nn=sn||(sn={}))[nn.X=0]="X",nn[nn.Y=1]="Y";class hn{constructor(t){this.target=t,this.action=(t,e,i,s)=>t.center}}class cn{constructor(t,e){this.target=t,this.axis=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus();return this.axis===sn.X?new S(n.x,r.y):new S(r.x,n.y)}}}class dn{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(t,e,i,s)=>{const n=t.center;let r=e.getFocus(),o=e.vel.clone();const a=n.sub(r).scale(this.cameraElasticity);o=o.add(a);const l=o.scale(-1).scale(this.cameraFriction);return o=o.add(l),r=r.add(o),r}}}class un{constructor(t,e){this.target=t,this.radius=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus(),o=n.sub(r),a=o.size;if(a>=this.radius){const t=a-this.radius;return r.add(o.normalize().scale(t))}return r}}}class pn{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(t,e,i,s)=>{const n=e.getFocus();this.boundSizeChecked||((t.bottom-t.top<i.drawHeight||t.right-t.left<i.drawWidth)&&v.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let r=n.x,o=n.y;return n.x<t.left+i.halfDrawWidth?r=t.left+i.halfDrawWidth:n.x>t.right-i.halfDrawWidth&&(r=t.right-i.halfDrawWidth),n.y<t.top+i.halfDrawHeight?o=t.top+i.halfDrawHeight:n.y>t.bottom-i.halfDrawHeight&&(o=t.bottom-i.halfDrawHeight),A(r,o)}}}class gn extends mi{constructor(){super(...arguments),this.transform=_t.identity(),this.inverse=_t.identity(),this._cameraStrategies=[],this.strategy=new ln(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this.rx=0,this._posChanged=!1,this._pos=bt(S.Zero,(()=>this._posChanged=!0)),this.vel=S.Zero,this.acc=S.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=ks.EaseInOutCubic,this._easing=ks.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this.rx}set angularVelocity(t){this.rx=t}get pos(){return this._pos}set pos(t){this._pos=bt(t,(()=>this._posChanged=!0)),this._posChanged=!0}get x(){return this.pos.x}set x(t){this._follow||this._cameraMoving||(this.pos=A(t,this.pos.y))}get y(){return this.pos.y}set y(t){this._follow||this._cameraMoving||(this.pos=A(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=A(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=A(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=A(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=A(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=ks.EaseInOutCubic){if("function"!=typeof i)throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise((t=>{this._lerpResolve=t})),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=ks.EaseInOutCubic){return this._zoomPromise=new Promise((t=>{this._zoomResolve=t})),e?(this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t,this._zoomPromise):(this._isZooming=!1,this.zoom=t,Promise.resolve(!0))}get viewport(){return this._viewport?this._viewport:new R(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){it(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new zt(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.resolution;let i=A(e.width/2,e.height/2);if(!this._engine.loadingComplete){const t=this._screen.peekResolution();t&&(i=A(t.width/2,t.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.updateTransform(),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(),this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0}}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new R(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const t=(0,this._zoomEasing)(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=t,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const t=ks.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=t,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const t=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(t)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0)),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(),this._postupdate(t,e)}draw(t){if(t instanceof CanvasRenderingContext2D){const e=this.getFocus(),i=this._screen.resolution.width/this.zoom,s=this._screen.resolution.height/this.zoom,n=A(-e.x+i/2+this._xShake,-e.y+s/2+this._yShake);t.scale(this.zoom,this.zoom),t.translate(n.x,n.y)}else t.multiply(this.transform)}updateTransform(){const t=this._screen.resolution.width/this.zoom,e=this._screen.resolution.height/this.zoom,i=A(-this.x+t/2+this._xShake,-this.y+e/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(i.x,i.y),this.transform.getAffineInverse(this.inverse)}debugDraw(t){}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}function _n(t){return t instanceof Js}const mn={pos:S.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class fn extends Qs{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...mn,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=Si.Passive,this.eventDispatcher=new pe,this.events.on("collisionstart",(t=>{this.filter(t.other)&&(this.emit("enter",new de(this,t.other)),this._dispatchAction(),0===this.repeat&&this.kill())})),this.events.on("collisionend",(t=>{this.filter(t.other)&&this.emit("exit",new ue(this,t.other))}))}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){0!==this.repeat&&(this.action.call(this),this.repeat--)}debugDraw(t){super.debugDraw(t),t.save(),t.translate(this.pos.x,this.pos.y);const e=this.collider.bounds,i=this.getGlobalPos();e.left=e.left-i.x,e.right=e.right-i.x,e.top=e.top-i.y,e.bottom=e.bottom-i.y,t.fillStyle=D.Violet.toString(),t.strokeStyle=D.Violet.toString(),t.fillText("Trigger",10,10),e.debugDraw(t),t.restore()}}var vn,bn;(bn=vn||(vn={})).Update="update",bn.Draw="draw";class wn{constructor(){this.priority=0}notify(t){}}class xn{constructor(t){this.data=t,this.type="Entity Added"}}function yn(t){return!!t&&"Entity Added"===t.type}class Cn{constructor(t){this.data=t,this.type="Entity Removed"}}function Pn(t){return!!t&&"Entity Removed"===t.type}class En{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,e){for(const i of this.entities)i.update(t.engine,e),i.active||this.removeEntity(i)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}notify(t){fs(t)&&this._world.queryManager.addEntity(t.data.entity),bs(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t.active=!0,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach((t=>this.addEntity(t))),t.childrenAdded$.register({notify:t=>{this.addEntity(t)}}),t.childrenRemoved$.register({notify:t=>{this.removeEntity(t,!1)}}))}removeEntity(t,e=!0){var i;let s=0;s=t instanceof ws?t.id:t;const n=this._entityIndex[s];n&&n.active&&n.kill(),n&&e?this._entitiesToRemove.push(n):(delete this._entityIndex[s],n&&(it(n,this.entities),this._world.queryManager.removeEntity(n),n.componentAdded$.unregister(this),n.componentRemoved$.unregister(this),n.children.forEach((t=>this.removeEntity(t,e))),n.childrenAdded$.clear(),n.childrenRemoved$.clear(),(null===(i=this._world.context)||void 0===i?void 0:i.engine)&&this._world.context.engine.stats.currFrame.actors.killed++))}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1)}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter((e=>e.name===t))}clear(){for(const t of this.entities)this.removeEntity(t)}}const Sn=t=>[...t].sort(((t,e)=>t.localeCompare(e))).join("+");class An extends zi{constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map((t=>(new t).type)):this.types=t}get key(){return this._key?this._key:this._key=Sn(this.types)}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!st(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new xn(t)))}removeEntity(t){it(t,this._entities)&&this.notifyAll(new Cn(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];e=t instanceof ws?t.types:t;let i=!0;for(const t of this.types)if(i=i&&e.indexOf(t)>-1,!i)return!1;return i}contain(t){return this.types.indexOf(t)>-1}}class Tn{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[Sn(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){0===t.observers.length&&(t.clear(),delete this._queries[Sn(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const i in this._queries)this._queries[i].contain(e.type)&&this._queries[i].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const i=new An(t);return this._addQuery(i),i}getQuery(t){const e=Sn(t);return this._queries[e]?this._queries[e]:null}}class kn{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find((e=>e instanceof t))}addSystem(t){if(!t.types||0===t.types.length)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort(((t,e)=>t.priority-e.priority)),e.register(t),this.initialized&&t.initialize&&t.initialize(this._world.context)}removeSystem(t){it(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world.context)}}updateSystems(t,e,i){const s=this.systems.filter((e=>e.systemType===t));for(const t of s)t.preupdate&&t.preupdate(e,i);for(const t of s){const s=this._world.queryManager.getQuery(t.types).getEntities(t.sort);if(e instanceof yr)for(const t of s)t._initialize(null==e?void 0:e.engine);t.update(s,i)}for(const t of s)t.postupdate&&t.postupdate(e,i)}clear(){for(const t of this.systems)this.removeSystem(t)}}class In{constructor(t){this.context=t,this.queryManager=new Tn(this),this.entityManager=new En(this),this.systemManager=new kn(this)}update(t,e){t===vn.Update&&this.entityManager.updateEntities(this.context,e),this.systemManager.updateSystems(t,this.context,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof ws&&this.entityManager.addEntity(t),t instanceof wn&&this.systemManager.addSystem(t)}remove(t,e=!0){t instanceof ws&&this.entityManager.removeEntity(t,e),t instanceof wn&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class Dn{static integrate(t,e,i,s){const n=s/1e3;e.vel.addEqual(i.scale(n)),t.pos.addEqual(e.vel.scale(n)).addEqual(i.scale(.5*n*n)),e.angularVelocity+=e.torque*(1/e.inertia)*n,t.rotation+=e.angularVelocity*n,t.scale.addEqual(e.scaleFactor.scale(n))}}class Mn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.motion"],this.systemType=vn.Update,this.priority=-1}update(t,e){let i,s;for(const n of t){i=n.get(Ui),s=n.get(Ni);const t=n.get(ps);if(null==t?void 0:t.sleeping)continue;const r=s.acc.clone();(null==t?void 0:t.collisionType)===Si.Active&&(null==t?void 0:t.useGravity)&&r.addEqual(Fi.gravity),null==t||t.captureOldTransform(),Dn.integrate(i,s,r,e)}}debugDraw(t){}}class Rn{solve(t){return this.preSolve(t),t=t.filter((t=>!t.isCanceled())),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}}class Bn extends Rn{preSolve(t){for(const e of t){const t=T.fromDirection(e.mtv),i=e.mtv.negate();e.colliderA.events.emit("precollision",new Qt(e.colliderA,e.colliderB,t,i)),e.colliderB.events.emit("precollision",new Qt(e.colliderB,e.colliderA,T.getOpposite(t),i.negate()))}}postSolve(t){var e,i;for(const s of t){const t=s.colliderA,n=s.colliderB,r=null===(e=t.owner)||void 0===e?void 0:e.get(ps),o=null===(i=n.owner)||void 0===i?void 0:i.get(ps);if(r&&o&&(r.collisionType===Si.Passive||o.collisionType===Si.Passive))continue;const a=T.fromDirection(s.mtv),l=s.mtv.negate();s.colliderA.events.emit("postcollision",new Jt(s.colliderA,s.colliderB,a,l)),s.colliderB.events.emit("postcollision",new Jt(s.colliderB,s.colliderA,T.getOpposite(a),l.negate()))}}solvePosition(t){var e,i;for(const s of t){if(!s.colliderA.bounds.intersect(s.colliderB.bounds))continue;let t=s.mtv;const n=s.colliderA,r=s.colliderB,o=null===(e=n.owner)||void 0===e?void 0:e.get(ps),a=null===(i=r.owner)||void 0===i?void 0:i.get(ps);if(o&&a){if(o.collisionType===Si.Passive||a.collisionType===Si.Passive)continue;o.collisionType===Si.Active&&a.collisionType===Si.Active&&(t=t.scale(.5)),o.collisionType===Si.Active&&(o.pos.x-=t.x,o.pos.y-=t.y),a.collisionType===Si.Active&&(a.pos.x+=t.x,a.pos.y+=t.y)}}}solveVelocity(t){var e,i;for(const s of t){const t=s.colliderA,n=s.colliderB,r=null===(e=t.owner)||void 0===e?void 0:e.get(ps),o=null===(i=n.owner)||void 0===i?void 0:i.get(ps);if(r&&o){if(r.collisionType===Si.Passive||o.collisionType===Si.Passive)continue;const t=s.normal,e=t.negate();if(r.collisionType===Si.Active){const e=t.scale(t.dot(r.vel.negate()));r.vel=r.vel.add(e)}if(o.collisionType===Si.Active){const t=e.scale(e.dot(o.vel.negate()));o.vel=o.vel.add(t)}}}}}class $n{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new S(0,0),this.bToContact=new S(0,0),this.update()}update(){var t,e;const i=null===(t=this.contact.colliderA.owner)||void 0===t?void 0:t.get(ps),s=null===(e=this.contact.colliderB.owner)||void 0===e?void 0:e.get(ps);if(i&&s){const t=this.contact.normal,e=this.contact.tangent;this.aToContact=this.point.sub(i.pos),this.bToContact=this.point.sub(s.pos);const n=this.aToContact.cross(t),r=this.bToContact.cross(t);this.normalMass=i.inverseMass+s.inverseMass+i.inverseInertia*n*n+s.inverseInertia*r*r;const o=this.aToContact.cross(e),a=this.bToContact.cross(e);this.tangentMass=i.inverseMass+s.inverseMass+i.inverseInertia*o*o+s.inverseInertia*a*a}return this}getRelativeVelocity(){var t,e;const i=null===(t=this.contact.colliderA.owner)||void 0===t?void 0:t.get(ps),s=null===(e=this.contact.colliderB.owner)||void 0===e?void 0:e.get(ps);if(i&&s){const t=i.vel.add(S.cross(i.angularVelocity,this.aToContact));return s.vel.add(S.cross(s.angularVelocity,this.bToContact)).sub(t)}return S.Zero}}class Fn extends Rn{constructor(){super(...arguments),this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return null!==(e=this.idToContactConstraint.get(t))&&void 0!==e?e:[]}preSolve(t){var e,i,s;for(const e of t){const t=T.fromDirection(e.mtv);e.colliderA.events.emit("precollision",new Qt(e.colliderA,e.colliderB,t,e.mtv)),e.colliderA.events.emit("beforecollisionresolve",new ie(e.colliderA,e.colliderB,t,e.mtv,e)),e.colliderB.events.emit("precollision",new Qt(e.colliderB,e.colliderA,T.getOpposite(t),e.mtv.negate())),e.colliderB.events.emit("beforecollisionresolve",new ie(e.colliderB,e.colliderA,T.getOpposite(t),e.mtv.negate(),e)),e.matchAwake()}const n=Array.from(this.idToContactConstraint.keys());for(const r of t){const t=n.indexOf(r.id);t>-1&&n.splice(t,1);const o=null!==(e=this.idToContactConstraint.get(r.id))&&void 0!==e?e:[];let a=0;const l=r.colliderA.owner.get(ps),h=r.colliderB.owner.get(ps);if(l&&h)for(const t of r.points){const e=r.normal,n=r.tangent,c=t.sub(l.pos),d=t.sub(h.pos),u=c.cross(e),p=d.cross(e),g=l.inverseMass+h.inverseMass+l.inverseInertia*u*u+h.inverseInertia*p*p,_=c.cross(n),m=d.cross(n),f=l.inverseMass+h.inverseMass+l.inverseInertia*_*_+h.inverseInertia*m*m;o[a]&&(null===(s=null===(i=o[a])||void 0===i?void 0:i.point)||void 0===s?void 0:s.squareDistance(t))<4?(o[a].point=t,o[a].local=r.localPoints[a]):o[a]=new $n(t,r.localPoints[a],r),o[a].aToContact=c,o[a].bToContact=d,o[a].normalMass=g,o[a].tangentMass=f,a++}this.idToContactConstraint.set(r.id,o)}for(const t of n)this.idToContactConstraint.delete(t);if(Fi.warmStart)this.warmStart(t);else for(const e of t){const t=this.getContactConstraints(e.id);for(const e of t)e.normalImpulse=0,e.tangentImpulse=0}}postSolve(t){for(const e of t){const t=e.colliderA.owner.get(ps),i=e.colliderB.owner.get(ps);if(t&&i){if(t.collisionType===Si.Passive||i.collisionType===Si.Passive)continue;t.updateMotion(),i.updateMotion()}const s=T.fromDirection(e.mtv);e.colliderA.events.emit("postcollision",new Jt(e.colliderA,e.colliderB,s,e.mtv)),e.colliderA.events.emit("aftercollisionresolve",new se(e.colliderA,e.colliderB,s,e.mtv,e)),e.colliderB.events.emit("postcollision",new Jt(e.colliderB,e.colliderA,T.getOpposite(s),e.mtv.negate())),e.colliderB.events.emit("aftercollisionresolve",new se(e.colliderB,e.colliderA,T.getOpposite(s),e.mtv.negate(),e))}this.lastFrameContacts.clear();for(const e of t)this.lastFrameContacts.set(e.id,e)}warmStart(t){var e,i,s;for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){const e=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const i of e)if(Fi.warmStart){const e=n.normal.scale(i.normalImpulse),s=n.tangent.scale(i.tangentImpulse),o=e.add(s);t.applyImpulse(i.point,o.negate()),r.applyImpulse(i.point,o)}else i.normalImpulse=0,i.tangentImpulse=0}}}solvePosition(t){var e,i,s;for(let n=0;n<Fi.positionIterations;n++)for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){if(t.collisionType===Si.Passive||r.collisionType===Si.Passive)continue;const e=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const i of e){const e=n.normal,s=ns.FindContactSeparation(n,i.local),o=-5,a=V(Fi.steeringFactor*(s+Fi.slop),o,0),l=e.scale(-a/i.normalMass);t.collisionType===Si.Active&&(t.pos=t.pos.add(l.negate().scale(t.inverseMass)),t.rotation-=i.aToContact.cross(l)*t.inverseInertia),r.collisionType===Si.Active&&(r.pos=r.pos.add(l.scale(r.inverseMass)),r.rotation+=i.bToContact.cross(l)*r.inverseInertia)}}}}solveVelocity(t){var e,i,s;for(let n=0;n<Fi.velocityIterations;n++)for(const n of t){const t=null===(e=n.colliderA.owner)||void 0===e?void 0:e.get(ps),r=null===(i=n.colliderB.owner)||void 0===i?void 0:i.get(ps);if(t&&r){if(t.collisionType===Si.Passive||r.collisionType===Si.Passive)continue;const e=t.bounciness*r.bounciness,i=Math.min(t.friction,r.friction),o=null!==(s=this.idToContactConstraint.get(n.id))&&void 0!==s?s:[];for(const e of o){let s=-e.getRelativeVelocity().dot(n.tangent)/e.tangentMass;const o=i*e.normalImpulse,a=V(e.tangentImpulse+s,-o,o);s=a-e.tangentImpulse,e.tangentImpulse=a;const l=n.tangent.scale(s);t.applyImpulse(e.point,l.negate()),r.applyImpulse(e.point,l)}for(const i of o){let s=-(1+e)*i.getRelativeVelocity().dot(n.normal)/i.normalMass;const o=Math.max(i.normalImpulse+s,0);s=o-i.normalImpulse,i.normalImpulse=o;const a=n.normal.scale(s);t.applyImpulse(i.point,a.negate()),r.applyImpulse(i.point,a)}}}}}class Ln extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.motion","ex.collider"],this.systemType=vn.Update,this.priority=-1,this._realisticSolver=new Fn,this._arcadeSolver=new Bn,this._processor=new Xi,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._trackCollider=t=>this._processor.track(t),this._untrackCollider=t=>this._processor.untrack(t)}notify(t){if(yn(t)){const e=t.data.get(ls);e.$colliderAdded.subscribe(this._trackCollider),e.$colliderRemoved.subscribe(this._untrackCollider);const i=e.get();i&&this._processor.track(i)}else{const e=t.data.get(ls),i=e.get();e&&i&&this._processor.untrack(i)}}initialize(t){this._engine=t.engine}update(t,e){var i;if(!Fi.enabled)return;let s=[];for(const e of t){const t=e.get(ls),n=null==t?void 0:t.get();t&&(null===(i=t.owner)||void 0===i?void 0:i.active)&&n&&(t.update(),n instanceof Zi?s=s.concat(n.getColliders()):s.push(n))}this._processor.update(s);const n=this._processor.broadphase(s,e);this._currentFrameContacts.clear();let r=this._processor.narrowphase(n,this._engine.debug.stats.currFrame);r=this.getSolver().solve(r),r.forEach((t=>this._currentFrameContacts.set(t.id,t))),this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts)}getSolver(){return Fi.collisionResolutionStrategy===Ti.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const t=e.colliderA,i=e.colliderB;t.events.emit("collisionstart",new ne(t,i,e)),t.events.emit("contactstart",new te(t,i,e)),i.events.emit("collisionstart",new ne(i,t,e)),i.events.emit("contactstart",new te(i,t,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const t=e.colliderA,i=e.colliderB;t.events.emit("collisionend",new re(t,i)),t.events.emit("contactend",new ee(t,i)),i.events.emit("collisionend",new re(i,t)),i.events.emit("contactend",new ee(i,t))}}}var On,Vn,zn,Un,Nn,Hn;(Vn=On||(On={})).Forward="forward",Vn.Backward="backward",(Un=zn||(zn={})).End="end",Un.Loop="loop",Un.PingPong="pingpong",Un.Freeze="freeze";class jn extends wt{constructor(t){var e,i;super(t),this.events=new pe,this.frames=[],this.strategy=zn.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._direction=1,this._done=!1,this._playing=!0,this._reversed=!1,this.frames=t.frames,this.strategy=null!==(e=t.strategy)&&void 0!==e?e:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:null!==(i=t.frameDuration)&&void 0!==i?i:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new jn({frames:this.frames.map((t=>({...t}))),frameDuration:this.frameDuration,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,s=zn.Loop){const n=t.sprites.length-1,r=e.filter((t=>t<0||t>n));return r.length&&jn._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${r.join(",")} no frame will be shown`),new jn({frames:t.sprites.filter(((t,i)=>e.indexOf(i)>-1)).map((t=>({graphic:t,duration:i}))),strategy:s})}static toLegacyAnimation(t,e){const i=e.frames.map((t=>ke.toLegacySprite(t.graphic)));return new Me({sprites:i,loop:e.strategy===zn.Loop,freezeFrame:e.strategy===zn.Freeze?i.length-1:void 0,speed:e.frameDuration,engine:t})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return this._reversed&&1===this._direction?On.Backward:On.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case zn.End:case zn.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;const e=this.frames[this._currentFrame];e&&!this._done&&(this._timeLeftInFrame=(null==e?void 0:e.duration)||this.frameDuration,this.events.emit("frame",e))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case zn.Loop:e=(t+1)%this.frames.length,0===e&&this.events.emit("loop",this);break;case zn.End:e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break;case zn.Freeze:e=V(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break;case zn.PingPong:t+this._direction>=this.frames.length&&(this._direction=-1,this.events.emit("loop",this)),t+this._direction<0&&(this._direction=1,this.events.emit("loop",this)),e=t+this._direction%this.frames.length}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",this.currentFrame)),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic.draw(t,e,i)}}jn._LOGGER=v.getInstance();class Wn extends wt{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new Wn({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){let t=new R;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new R;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return t}_isAnimationOrGroup(t){return t instanceof jn||t instanceof Wn}tick(t,e){for(const i of this.members){const s=i.graphic;this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){const e=t.graphic;this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){for(const s of this.members)t.save(),t.translate(e,i),s.graphic.draw(t,s.pos.x,s.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}(Hn=Nn||(Nn={}))[Hn.Circle=0]="Circle",Hn[Hn.Rectangle=1]="Rectangle";class Gn extends ws{constructor(t,e,i,s,n,r,o,a,l,h){super(),this.position=new S(0,0),this.velocity=new S(0,0),this.acceleration=new S(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=D.White,this.endColor=D.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=D.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let c=t;if(c&&!(t instanceof Kn)){const d=t;c=d.emitter,e=d.life,i=d.opacity,n=d.endColor,s=d.beginColor,r=d.position,o=d.velocity,a=d.acceleration,l=d.startSize,h=d.endSize}this.emitter=c,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=n||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=(r||this.position).add(this.emitter.pos),this.velocity=o||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=l||0,this.endSize=h||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new Ui),this.addComponent(new xs((t=>this.draw(t)))),this.addComponent(this.graphics=new Es),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=A(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(ke.fromLegacySprite(this.particleSprite))):(this.graphics.localBounds=R.fromDimension(this.particleSize,this.particleSize,S.Half),this.graphics.onPostDraw=t=>{t.save(),this.graphics.opacity=this.opacity;const e=this._currentColor.clone();e.a=1,t.debug.drawPoint(A(0,0),{color:e,size:this.particleSize}),t.restore()})}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=V(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=V(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=V(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=V(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=V(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=V(this.opacity,1e-4,1),this.focus){const t=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(t)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=A(1,1),this.graphics.opacity=this.opacity}draw(t){if(this.particleSprite)return this.particleSprite.opacity(this.opacity),void this.particleSprite.draw(t,0,0);t.save(),this._currentColor.a=V(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(0,0,this.particleSize,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}}class qn extends(Se(Gn)){constructor(t,e,i,s,n,r,o,a,l,h){super(t,e,i,s,n,r,o,a,l,h)}}class Kn extends Qs{constructor(t){var e,i;super({width:null!==(e=t.width)&&void 0!==e?e:0,height:null!==(i=t.height)&&void 0!==i?i:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new S(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=D.White,this.endColor=D.White,this._og=null,this._sprite=null,this.emitterType=Nn.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1;const{x:s,y:n,pos:r,isEmitting:o,minVel:a,maxVel:l,acceleration:h,minAngle:c,maxAngle:d,emitRate:u,particleLife:p,opacity:g,fadeFlag:_,focus:m,focusAccel:f,startSize:v,endSize:b,minSize:w,maxSize:x,beginColor:y,endColor:C,particleSprite:P,emitterType:E,radius:T,particleRotationalVelocity:k,randomRotation:I,random:M}={...t};this.pos=null!=r?r:A(null!=s?s:0,null!=n?n:0),this.isEmitting=null!=o?o:this.isEmitting,this.minVel=null!=a?a:this.minVel,this.maxVel=null!=l?l:this.maxVel,this.acceleration=null!=h?h:this.acceleration,this.minAngle=null!=c?c:this.minAngle,this.maxAngle=null!=d?d:this.maxAngle,this.emitRate=null!=u?u:this.emitRate,this.particleLife=null!=p?p:this.particleLife,this.opacity=null!=g?g:this.opacity,this.fadeFlag=null!=_?_:this.fadeFlag,this.focus=null!=m?m:this.focus,this.focusAccel=null!=f?f:this.focusAccel,this.startSize=null!=v?v:this.startSize,this.endSize=null!=b?b:this.endSize,this.minSize=null!=w?w:this.minSize,this.maxSize=null!=x?x:this.maxSize,this.beginColor=null!=y?y:this.beginColor,this.endColor=null!=C?C:this.endColor,this.particleSprite=null!=P?P:this.particleSprite,this.emitterType=null!=E?E:this.emitterType,this.radius=null!=T?T:this.radius,this.particleRotationalVelocity=null!=k?k:this.particleRotationalVelocity,this.randomRotation=null!=I?I:this.randomRotation,this.body.collisionType=Si.PreventCollision,this.random=null!=M?M:new $;for(let t=0;t<this.traits.length;t++)this.traits[t]instanceof _s&&this.traits.splice(t,1)}get opacity(){return super.graphics.opacity}set opacity(t){super.graphics.opacity=t}get particleSprite(){return this._og}set particleSprite(t){this._og=t,t&&(this._sprite=ke.fromLegacySprite(t))}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let i=0;i<t;i++){const t=this._createParticle();this.particles.push(t),(null===(e=null==this?void 0:this.scene)||void 0===e?void 0:e.world)&&this.scene.world.add(t)}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const i=j(this.minAngle,this.maxAngle,this.random),s=j(this.minVel,this.maxVel,this.random),n=this.startSize||j(this.minSize,this.maxSize,this.random),r=s*Math.cos(i),o=s*Math.sin(i);if(this.emitterType===Nn.Rectangle)t=j(0,this.width,this.random),e=j(0,this.height,this.random);else if(this.emitterType===Nn.Circle){const s=j(0,this.radius,this.random);t=s*Math.cos(i),e=s*Math.sin(i)}const a=new qn(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new S(t,e),new S(r,o),this.acceleration,this.startSize,this.endSize);return a.fadeFlag=this.fadeFlag,a.particleSize=n,this.particleSprite&&(a.particleSprite=this.particleSprite,a.graphics.opacity=this.opacity,a.graphics.use(this._sprite)),a.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(a.currentRotation=j(0,2*Math.PI,this.random)),this.focus&&(a.focus=this.focus.add(new S(this.pos.x,this.pos.y)),a.focusAccel=this.focusAccel),a}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let t=0;t<this.deadParticles.length;t++)it(this.deadParticles[t],this.particles),(null===(i=null==this?void 0:this.scene)||void 0===i?void 0:i.world)&&this.scene.world.remove(this.deadParticles[t],!1);this.deadParticles.length=0}draw(t){this.particles.forEach((e=>e.draw(t)))}debugDraw(t){super.debugDraw(t),t.fillStyle=D.Black.toString(),t.fillText("Particles: "+this.particles.length,this.pos.x,this.pos.y+20),this.focus&&(t.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),fi(t,D.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,this.center.x,this.center.y),t.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))}}class Xn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=vn.Draw,this.priority=0,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}get sortedTransforms(){return this._sortedTransforms}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine}preupdate(){this._zHasChanged&&(this._sortedTransforms.sort(((t,e)=>t.z-e.z)),this._zHasChanged=!1)}notify(t){if(yn(t)){const e=t.data.get(Ui);this._sortedTransforms.push(e),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(Ui);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&this._sortedTransforms.splice(i,1)}}update(t,e){let i;this._token++,this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const t of this._sortedTransforms){const s=t.owner;if(s.hasTag("ex.offscreen"))continue;if(i=s.get(Es),!i.visible)continue;t.coordPlane===Bi.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),i.update(e,this._token),this._applyTransform(s),i.onPreDraw&&i.onPreDraw(this._graphicsContext,e);const n=s instanceof qn?s.opacity:1;this._graphicsContext.opacity=i.opacity*n,this._drawGraphicsComponent(i),i.onPostDraw&&i.onPostDraw(this._graphicsContext,e),this._graphicsContext.restore(),t.coordPlane===Bi.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}this._graphicsContext.restore()}_drawGraphicsComponent(t){var e,i;if(t.visible)for(const s of t.layers.get())for(const{graphic:n,options:r}of s.graphics){let o=t.anchor,a=t.offset;(null==r?void 0:r.anchor)&&(o=r.anchor),(null==r?void 0:r.offset)&&(a=r.offset);const l=-n.width*o.x+a.x,h=-n.height*o.y+a.y;if(null==n||n.draw(this._graphicsContext,l+s.offset.x,h+s.offset.y),(null===(e=this._engine)||void 0===e?void 0:e.isDebug)&&this._engine.debug.graphics.showBounds){const t=A(l+s.offset.x,h+s.offset.y);if(n instanceof Wn)for(const e of n.members)null===(i=e.graphic)||void 0===i||i.localBounds.translate(t.add(e.pos)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor);else null==n||n.localBounds.translate(t).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._graphicsContext.translate(e.pos.x,e.pos.y),this._graphicsContext.scale(e.scale.x,e.scale.y),this._graphicsContext.rotate(e.rotation))}}}class Yn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.canvas"],this.systemType=vn.Draw,this.priority=-1}initialize(t){this._ctx=t.engine.ctx,this._engine=t.engine,this._camera=t.camera}sort(t,e){return t.get(Ui).z-e.get(Ui).z}update(t,e){var i,s,n;let r,o;this._clearScreen();const a=t.length;for(let l=0;l<a;l++){const a=null===(n=null===(s=null===(i=t[l])||void 0===i?void 0:i.graphics)||void 0===s?void 0:s.visible)||void 0===n||n,h=t[l].isOffScreen;a&&!h&&(r=t[l].get(Ui),o=t[l].get(xs),this._ctx.save(),this._pushCameraTransform(r),this._ctx.save(),this._applyTransform(t[l]),o.draw(this._ctx,e),this._ctx.restore(),this._popCameraTransform(r),this._ctx.restore()),this._engine.isDebug&&(this._ctx.save(),this._pushCameraTransform(r),this._ctx.strokeStyle="yellow",t[l].debugDraw(this._ctx),this._popCameraTransform(r),this._ctx.restore())}this._engine.isDebug&&(this._ctx.save(),this._camera.draw(this._ctx),this._camera.debugDraw(this._ctx),this._ctx.restore()),this._engine.stats.currFrame.graphics.drawnImages=ti.DrawnImagesCount,this._engine.stats.currFrame.graphics.drawCalls=ti.DrawCallCount}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._ctx.translate(e.pos.x,e.pos.y),this._ctx.rotate(e.rotation),this._ctx.scale(e.scale.x,e.scale.y))}}_clearScreen(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle=this._engine.backgroundColor.toString(),this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}_pushCameraTransform(t){t.coordPlane===Bi.World&&(this._ctx.save(),this._camera&&this._camera.draw(this._ctx))}_popCameraTransform(t){t.coordPlane===Bi.World&&this._ctx.restore()}}class Zn extends wn{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=vn.Draw,this.priority=999}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine,this._collisionSystem=t.world.systemManager.get(Ln)}update(t,e){var i,s;if(!this._engine.isDebug)return;const n=this._engine.debug.filter;let r,o;const a=this._engine.debug.entity;let l;const h=this._engine.debug.transform;let c;const d=this._engine.debug.motion;let u;const p=this._engine.debug.collider,g=this._engine.debug.physics;let _;const m=this._engine.debug.graphics;let f,v;const b=this._engine.debug.body,w=this._engine.debug.camera;for(const e of t){if(e.hasTag("offscreen"))continue;if(e instanceof qn)continue;if(n.useFilter){if(0!==n.ids.length&&!n.ids.includes(e.id))continue;if(""!==n.nameQuery&&!e.name.includes(n.nameQuery))continue}let t=S.Zero;const g=A(0,16);if(r=e.id,o=e.name,l=e.get(Ui),this._pushCameraTransform(l),this._graphicsContext.save(),this._applyTransform(e),l&&((h.showAll||h.showPosition)&&this._graphicsContext.debug.drawPoint(S.Zero,{size:4,color:h.positionColor}),(h.showAll||h.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${l.pos.toString(2)}`,t),t=t.add(g)),(h.showAll||h.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${l.z.toFixed(1)})`,t),t=t.add(g)),(a.showAll||a.showId)&&(this._graphicsContext.debug.drawText(`id(${r}) ${l.parent?"child of id("+(null===(s=null===(i=l.parent)||void 0===i?void 0:i.owner)||void 0===s?void 0:s.id)+")":""}`,t),t=t.add(g)),(a.showAll||a.showName)&&(this._graphicsContext.debug.drawText(`name(${o})`,t),t=t.add(g)),(h.showAll||h.showRotation)&&(this._graphicsContext.drawLine(S.Zero,S.fromAngle(l.rotation).scale(50).add(S.Zero),h.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${U(l.rotation).toFixed(2)})`,t),t=t.add(g)),(h.showAll||h.showScale)&&this._graphicsContext.drawLine(S.Zero,l.scale.add(S.Zero),h.scaleColor,2)),_=e.get(Es),_&&(m.showAll||m.showBounds)&&_.localBounds.draw(this._graphicsContext,m.boundsColor),f=e.get(en),f&&(f.useTransform||this._graphicsContext.restore(),f.draw(this._graphicsContext),f.useTransform||(this._graphicsContext.save(),this._applyTransform(e))),v=e.get(ps),v&&((b.showAll||b.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${v.group.name})`,t),t=t.add(g)),(b.showAll||b.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${v.collisionType})`,t),t=t.add(g)),(b.showAll||b.showMass)&&(this._graphicsContext.debug.drawText(`mass(${v.mass})`,t),t=t.add(g)),(b.showAll||b.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${v.sleepMotion})`,t),t=t.add(g)),(b.showAll||b.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${v.canSleep?v.sleeping:"cant sleep"})`,t),t=t.add(g))),this._graphicsContext.restore(),c=e.get(Ni),c&&((d.showAll||d.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${c.vel.toString(2)}`,t.add(l.globalPos)),this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(c.vel),d.velocityColor,2),t=t.add(g)),(d.showAll||d.showAcceleration)&&this._graphicsContext.drawLine(l.globalPos,l.globalPos.add(c.acc),d.accelerationColor,2)),u=e.get(ls),u){const t=u.get();if((p.showAll||p.showGeometry)&&t&&t.debug(this._graphicsContext,p.geometryColor),p.showAll||p.showBounds)if(t instanceof Zi){const e=t.getColliders();for(const t of e){const e=t.bounds,i=A(e.left,e.top);this._graphicsContext.debug.drawRect(i.x,i.y,e.width,e.height,{color:p.boundsColor}),(p.showAll||p.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${t.owner.id})`,i)}u.bounds.draw(this._graphicsContext,p.boundsColor)}else if(t){const t=u.bounds,e=A(t.left,t.top);this._graphicsContext.debug.drawRect(e.x,e.y,t.width,t.height,{color:p.boundsColor}),(p.showAll||p.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${u.owner.id})`,e)}}this._popCameraTransform(l)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(g.showAll||g.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),g.showAll||g.showCollisionContacts||g.showCollisionNormals)for(const[t,e]of this._engine.debug.stats.currFrame.physics.contacts){if(g.showAll||g.showCollisionContacts)for(const t of e.points)this._graphicsContext.debug.drawPoint(t,{size:5,color:g.collisionContactColor});if(g.showAll||g.showCollisionNormals)for(const t of e.points)this._graphicsContext.debug.drawLine(t,e.normal.scale(30).add(t),{color:g.collisionNormalColor})}this._graphicsContext.restore(),w&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(w.showAll||w.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,w.focusColor),(w.showAll||w.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get(Ui);e&&(this._graphicsContext.translate(e.pos.x,e.pos.y),this._graphicsContext.scale(e.scale.x,e.scale.y),this._graphicsContext.rotate(e.rotation))}}_pushCameraTransform(t){t.coordPlane===Bi.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===Bi.World&&this._graphicsContext.restore()}}class Qn extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.pointer"],this.systemType=vn.Update,this.priority=-1,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}initialize(t){this._engine=t.engine,this._receiver=this._engine.input.pointers}preupdate(){this._zHasChanged&&(this._sortedTransforms.sort(((t,e)=>e.z-t.z)),this._sortedEntities=this._sortedTransforms.map((t=>t.owner)),this._zHasChanged=!1)}notify(t){if(yn(t)){const e=t.data.get(Ui);this._sortedTransforms.push(e),this._sortedEntities.push(e.owner),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get(Ui);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&(this._sortedTransforms.splice(i,1),this._sortedEntities.splice(i,1))}}entityCurrentlyUnderPointer(t,e){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(e)}entityWasUnderPointer(t,e){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(e)}entered(t,e){return this.entityCurrentlyUnderPointer(t,e)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,e){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,e)}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id))return void this.currentFrameEntityToPointers.set(t.id,[e]);const i=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,i.concat(e))}update(t){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receiver.update(),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receiver.clear()}_processPointerToEntity(t){var e;let i,s,n,r;for(const o of t){if(i=o.get(Ui),r=null!==(e=o.get(Ts))&&void 0!==e?e:new Ts,s=o.get(ls),s&&(r.useColliderShape||this.overrideUseColliderShape)){const t=s.get();if(t)for(const[e,s]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===Bi.World?s.worldPos:s.screenPos)&&this.addPointerToEntity(o,e)}if(n=o.get(Es),n&&(r.useGraphicsBounds||this.overrideUseGraphicsBounds)){const t=n.localBounds.transform(i.getGlobalMatrix());for(const[e,s]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===Bi.World?s.worldPos:s.screenPos)&&this.addPointerToEntity(o,e)}}}_processDownAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameDown)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerdown",i),this._receiver.isDragStart(i.pointerId)&&t.events.emit("pointerdragstart",i)),e.set(i.pointerId,i);return e}_processUpAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameUp)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerup",i),this._receiver.isDragEnd(i.pointerId)&&t.events.emit("pointerdragend",i)),e.set(i.pointerId,i);return e}_processMoveAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameMove)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointermove",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragmove",i)),e.set(i.pointerId,i);return e}_processEnterLeaveAndEmit(t,e){for(const i of e){if(i.active&&t.active&&this.entered(t,i.pointerId)){t.events.emit("pointerenter",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragenter",i);break}if(i.active&&t.active&&(this.left(t,i.pointerId)||this.entityCurrentlyUnderPointer(t,i.pointerId)&&"up"===i.type)){t.events.emit("pointerleave",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragleave",i);break}}}_processCancelAndEmit(t){for(const e of this._receiver.currentFrameCancel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,e.pointerId)&&t.events.emit("pointercancel",e)}_processWheelAndEmit(t){for(const e of this._receiver.currentFrameWheel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",e)}_dispatchEvents(t){const e=new Set(this.lastFrameEntityToPointers.keys()),i=new Set(this.currentFrameEntityToPointers.keys()),s=t.filter((t=>e.has(t.id)||i.has(t.id)));let n,r,o;for(const t of s){o=this._processDownAndEmit(t),r=this._processUpAndEmit(t),n=this._processMoveAndEmit(t);const e=[...n.values(),...o.values(),...r.values()];this._processEnterLeaveAndEmit(t,e),this._processCancelAndEmit(t),this._processWheelAndEmit(t)}}}class Jn extends wn{constructor(){super(...arguments),this.types=["ex.actions"],this.systemType=vn.Update,this.priority=-1,this._actions=[]}notify(t){if(yn(t)){const e=t.data.get(Ks);this._actions.push(e)}else{const e=t.data.get(Ks),i=this._actions.indexOf(e);i>-1&&this._actions.splice(i,1)}}update(t,e){for(const t of this._actions)t.update(e)}}class tr extends Oi{constructor(t){super(),this.type="ex.isometricentity",this.elevation=0,this.map=t}}class er extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.isometricentity"],this.systemType=vn.Update,this.priority=99}update(t,e){let i,s;for(const e of t){i=e.get(Ui),s=e.get(tr);const t=Math.max(s.map.width*s.map.tileWidth,s.map.height*s.map.tileHeight)*s.elevation+i.pos.y;i.z=t}}}class ir extends wn{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=vn.Draw,this.priority=-1}initialize(t){this._camera=t.camera}update(t){let e,i;for(const s of t){i=s.get(Es),e=s.get(Ui);const t=this._isOffscreen(e,i);t&&!s.hasTag("ex.offscreen")&&(s.eventDispatcher.emit("exitviewport",new he(s)),s.addTag("ex.offscreen")),!t&&s.hasTag("ex.offscreen")&&(s.eventDispatcher.emit("enterviewport",new ce(s)),s.removeTag("ex.offscreen"))}}_isOffscreen(t,e){if(t.coordPlane===Bi.World){const i=e.localBounds.transform(t.getGlobalMatrix());return!this._camera.viewport.overlaps(i)}return!1}}var sr,nr,rr,or,ar,lr,hr,cr,dr,ur,pr,gr,_r,mr,fr,vr,br,wr,xr=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class yr extends mi{constructor(){super(),this._logger=v.getInstance(),this.camera=new gn,this.world=new In(this),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(new Jn),this.world.add(new Mn),this.world.add(new Ln),this.world.add(new Qn),this.world.add(new er),m.isEnabled(c.LegacyDrawing)?this.world.add(new Yn):(this.world.add(new ir),this.world.add(new Xn)),this.world.add(new Zn)}get actors(){return this.world.entityManager.entities.filter((t=>t instanceof Qs))}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter((t=>t instanceof fn))}get tileMaps(){return this.world.entityManager.entities.filter((t=>t instanceof on))}get screenElements(){return this.actors.filter((t=>t instanceof Js))}get timers(){return this._timers}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t,e){}onDeactivate(t,e){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera._initialize(t),this.world.systemManager.initialize(),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new oe(t,this)),this._isInitialized=!0)}_activate(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)}_deactivate(t,e){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t,e)}_preupdate(t,e){this.emit("preupdate",new zt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new Ut(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Ft(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Lt(t,e,this)),this.onPostDraw(t,e)}update(t,e){let i,s;for(this._preupdate(t,e),i=0,s=this._cancelQueue.length;i<s;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(const t of this._timers)t.update(e);this.world.update(vn.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e)}draw(t,e){var i;this._predraw(t,e),this.world.update(vn.Draw,e),(null===(i=this.engine)||void 0===i?void 0:i.isDebug)&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new Ot(t,this)),this.emit("postdebugdraw",new Vt(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof tn&&(st(this._timers,t)||this.addTimer(t))}remove(t){t instanceof ws&&(this.emit("entityremoved",{target:t}),this.world.remove(t)),t instanceof tn&&this.removeTimer(t)}addScreenElement(t){this.add(t)}removeScreenElement(t){this.remove(t)}addTileMap(t){this.world.add(t)}removeTileMap(t){this.world.remove(t)}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return!!this.engine&&this.engine.currentScene===this}_collectActorStats(t){const e=this.actors.filter((t=>t instanceof Js));for(const i of e)t.stats.currFrame.actors.ui++;for(const e of this.actors){t.stats.currFrame.actors.alive++;for(const i of e.children)_n(i)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}xr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"ScreenElements now are normal actors with a Transform Coordinate Plane of Screen"})],yr.prototype,"screenElements",null),xr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],yr.prototype,"addScreenElement",null),xr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],yr.prototype,"removeScreenElement",null),xr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],yr.prototype,"addTileMap",null),xr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],yr.prototype,"removeTileMap",null),(nr=sr||(sr={})).Protanope="Protanope",nr.Deuteranope="Deuteranope",nr.Tritanope="Tritanope";class Cr{constructor(t){this._shader=new Ze({vertexSource:"\n      attribute vec2 a_position;\n      attribute vec2 a_texcoord;\n      varying vec2 v_texcoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_texcoord;\n      }",fragmentSource:t}),this._shader.compile(),this._buffer=new Qe({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Je({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class Pr{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new Cr("precision mediump float;\n// our texture\nuniform sampler2D u_image;\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texcoord;\n\n// color blind type\nuniform int u_type;\n\n// simulation?\nuniform bool u_simulate;\n\nvoid main() {\n  vec4 o =  texture2D(u_image, v_texcoord);\n  // RGB to LMS matrix conversion\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\n  // Simulate color blindness\n  float l;\n  float m;\n  float s;\n  //MODE CODE//\n  if (u_type == 0) {\n    // Protanope\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\n  } else if (u_type == 1) {\n    // Deuteranope\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\n  } else if (u_type == 2) {\n    // Tritanope\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\n  }\n\n  // LMS to RGB matrix conversion\n  vec4 error; // simulate the colors\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\n  error.a = 1.0;\n  vec4 diff = o - error;\n  vec4 correction; // correct the colors\n  correction.r = 0.0;\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\n  correction = o + correction;\n  correction.a = o.a;\n  //SIMULATE//\n\n  // sim \n  if (u_simulate) {\n    gl_FragColor = error.rgba;\n  } else {\n    gl_FragColor = correction.rgba;\n  }\n}"),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const t=this._shader.getShader();t.use(),this._colorBlindnessMode===sr.Protanope?t.setUniformInt("u_type",0):this._colorBlindnessMode===sr.Deuteranope?t.setUniformInt("u_type",1):this._colorBlindnessMode===sr.Tritanope&&t.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Er{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Pr(sr.Protanope)}correct(t){this._engine.graphicsContext instanceof hi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof hi&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Sr{constructor(t){this.stats={currFrame:new Ar,prevFrame:new Ar},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!0,showName:!1},this.transform={showAll:!1,showPosition:!1,showPositionLabel:!1,positionColor:D.Yellow,showZIndex:!1,showScale:!1,scaleColor:D.Green,showRotation:!1,rotationColor:D.Blue},this.graphics={showAll:!1,showBounds:!0,boundsColor:D.Yellow},this.collider={showAll:!1,showBounds:!0,boundsColor:D.Blue,showOwner:!1,showGeometry:!0,geometryColor:D.Green},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:D.Cyan,showCollisionContacts:!0,collisionContactColor:D.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:D.Yellow,showAcceleration:!1,accelerationColor:D.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:D.Red,showZoom:!1},this._engine=t,this.colorBlindMode=new Er(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class Ar{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Tr,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Ar;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Tr{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Tr;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}(or=rr||(rr={})).Canvas="Canvas",or.Document="Document",(lr=ar||(ar={})).Num0="Numpad0",lr.Num1="Numpad1",lr.Num2="Numpad2",lr.Num3="Numpad3",lr.Num4="Numpad4",lr.Num5="Numpad5",lr.Num6="Numpad6",lr.Num7="Numpad7",lr.Num8="Numpad8",lr.Num9="Numpad9",lr.NumAdd="NumpadAdd",lr.NumSubtract="NumpadSubtract",lr.NumMultiply="NumpadMultiply",lr.NumDivide="NumpadDivide",lr.NumDecimal="NumpadDecimal",lr.Numpad0="Numpad0",lr.Numpad1="Numpad1",lr.Numpad2="Numpad2",lr.Numpad3="Numpad3",lr.Numpad4="Numpad4",lr.Numpad5="Numpad5",lr.Numpad6="Numpad6",lr.Numpad7="Numpad7",lr.Numpad8="Numpad8",lr.Numpad9="Numpad9",lr.NumpadAdd="NumpadAdd",lr.NumpadSubtract="NumpadSubtract",lr.NumpadMultiply="NumpadMultiply",lr.NumpadDivide="NumpadDivide",lr.NumpadDecimal="NumpadDecimal",lr.NumLock="NumLock",lr.ShiftLeft="ShiftLeft",lr.ShiftRight="ShiftRight",lr.AltLeft="AltLeft",lr.AltRight="AltRight",lr.ControlLeft="ControlLeft",lr.ControlRight="ControlRight",lr.MetaLeft="MetaLeft",lr.MetaRight="MetaRight",lr.Key0="Digit0",lr.Key1="Digit1",lr.Key2="Digit2",lr.Key3="Digit3",lr.Key4="Digit4",lr.Key5="Digit5",lr.Key6="Digit6",lr.Key7="Digit7",lr.Key8="Digit8",lr.Key9="Digit9",lr.Digit0="Digit0",lr.Digit1="Digit1",lr.Digit2="Digit2",lr.Digit3="Digit3",lr.Digit4="Digit4",lr.Digit5="Digit5",lr.Digit6="Digit6",lr.Digit7="Digit7",lr.Digit8="Digit8",lr.Digit9="Digit9",lr.F1="F1",lr.F2="F2",lr.F3="F3",lr.F4="F4",lr.F5="F5",lr.F6="F6",lr.F7="F7",lr.F8="F8",lr.F9="F9",lr.F10="F10",lr.F11="F11",lr.F12="F12",lr.A="KeyA",lr.B="KeyB",lr.C="KeyC",lr.D="KeyD",lr.E="KeyE",lr.F="KeyF",lr.G="KeyG",lr.H="KeyH",lr.I="KeyI",lr.J="KeyJ",lr.K="KeyK",lr.L="KeyL",lr.M="KeyM",lr.N="KeyN",lr.O="KeyO",lr.P="KeyP",lr.Q="KeyQ",lr.R="KeyR",lr.S="KeyS",lr.T="KeyT",lr.U="KeyU",lr.V="KeyV",lr.W="KeyW",lr.X="KeyX",lr.Y="KeyY",lr.Z="KeyZ",lr.KeyA="KeyA",lr.KeyB="KeyB",lr.KeyC="KeyC",lr.KeyD="KeyD",lr.KeyE="KeyE",lr.KeyF="KeyF",lr.KeyG="KeyG",lr.KeyH="KeyH",lr.KeyI="KeyI",lr.KeyJ="KeyJ",lr.KeyK="KeyK",lr.KeyL="KeyL",lr.KeyM="KeyM",lr.KeyN="KeyN",lr.KeyO="KeyO",lr.KeyP="KeyP",lr.KeyQ="KeyQ",lr.KeyR="KeyR",lr.KeyS="KeyS",lr.KeyT="KeyT",lr.KeyU="KeyU",lr.KeyV="KeyV",lr.KeyW="KeyW",lr.KeyX="KeyX",lr.KeyY="KeyY",lr.KeyZ="KeyZ",lr.Semicolon="Semicolon",lr.Quote="Quote",lr.Comma="Comma",lr.Minus="Minus",lr.Period="Period",lr.Slash="Slash",lr.Equal="Equal",lr.BracketLeft="BracketLeft",lr.Backslash="Backslash",lr.BracketRight="BracketRight",lr.Backquote="Backquote",lr.Up="ArrowUp",lr.Down="ArrowDown",lr.Left="ArrowLeft",lr.Right="ArrowRight",lr.ArrowUp="ArrowUp",lr.ArrowDown="ArrowDown",lr.ArrowLeft="ArrowLeft",lr.ArrowRight="ArrowRight",lr.Space="Space",lr.Backspace="Backspace",lr.Delete="Delete",lr.Esc="Escape",lr.Escape="Escape",lr.Enter="Enter",lr.NumpadEnter="NumpadEnter",lr.ContextMenu="ContextMenu";class kr extends It{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class Ir extends mi{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[],this._handleKeyDown=t=>{const e=t.code;if(-1===this._keys.indexOf(e)){this._keys.push(e),this._keysDown.push(e);const i=new kr(e,t.key,t);this.eventDispatcher.emit("down",i),this.eventDispatcher.emit("press",i)}},this._handleKeyUp=t=>{const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new kr(e,t.key,t);this.eventDispatcher.emit("up",s),this.eventDispatcher.emit("release",s)}}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch(e){t=window,v.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",(()=>{this._keys.length=0})),t.addEventListener("keyup",this._handleKeyUp),t.addEventListener("keydown",this._handleKeyDown)}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new kr(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,e,i){"down"===t&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:null!=i?i:null})),"up"===t&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:null!=i?i:null}))}}class Dr extends mi{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter((t=>!0)).length,i=t.buttons.filter((t=>!0)).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(!t[e]){const t=this.at(e);t.connected&&this.eventDispatcher.emit("disconnect",new Wt(e,t)),t.connected=!1;continue}if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new jt(e,this.at(e))),this.at(e).connected=!0,t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;let i,s,n,r,o;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],hr)s=hr[i],"number"==typeof s&&t[e].buttons[s]&&(o=t[e].buttons[s].value,o!==this._oldPads[e].getButton(s)&&(t[e].buttons[s].pressed?(this.at(e).updateButton(s,o),this.at(e).eventDispatcher.emit("button",new Gt(s,o,this.at(e)))):this.at(e).updateButton(s,0)));for(n in dr)r=dr[n],"number"==typeof r&&(o=t[e].axes[r],o!==this._oldPads[e].getAxes(r)&&(this.at(e).updateAxes(r,o),this.at(e).eventDispatcher.emit("axis",new qt(r,o,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Mr),this._oldPads.push(new Mr);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter((t=>t.connected)).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new Mr;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}Dr.MinAxisMoveThreshold=.05;class Mr extends mi{constructor(){super(),this.connected=!1,this._buttons=new Array(16),this._axes=new Array(4);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}isButtonPressed(t,e=1){return this._buttons[t]>=e}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Dr.MinAxisMoveThreshold?0:e}updateButton(t,e){this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}(cr=hr||(hr={}))[cr.Face1=0]="Face1",cr[cr.Face2=1]="Face2",cr[cr.Face3=2]="Face3",cr[cr.Face4=3]="Face4",cr[cr.LeftBumper=4]="LeftBumper",cr[cr.RightBumper=5]="RightBumper",cr[cr.LeftTrigger=6]="LeftTrigger",cr[cr.RightTrigger=7]="RightTrigger",cr[cr.Select=8]="Select",cr[cr.Start=9]="Start",cr[cr.LeftStick=10]="LeftStick",cr[cr.RightStick=11]="RightStick",cr[cr.DpadUp=12]="DpadUp",cr[cr.DpadDown=13]="DpadDown",cr[cr.DpadLeft=14]="DpadLeft",cr[cr.DpadRight=15]="DpadRight",(ur=dr||(dr={}))[ur.LeftStickX=0]="LeftStickX",ur[ur.LeftStickY=1]="LeftStickY",ur[ur.RightStickX=2]="RightStickX",ur[ur.RightStickY=3]="RightStickY";class Rr{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class Br{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new Rr(this._windowGlobal),this._documentComponent=new Rr(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class $r{constructor(t){this._ex=t,this._debugText=new qe}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~t:t,this._ex.snapToPixel?~~e:e,this._ex.snapToPixel?~~i:i,this._ex.snapToPixel?~~s:s),this._ex.__ctx.restore()}drawLine(t,e,i={color:D.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=i.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~e.x:e.x,this._ex.snapToPixel?~~e.y:e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:D.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y,e.size,0,2*Math.PI),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class Fr{constructor(t){this.backgroundColor=D.ExcaliburBlue,this._state=new ft,this.snapToPixel=!0,this.debug=new $r(this);const{canvasElement:e,enableTransparency:i,snapToPixel:s,smoothing:n,backgroundColor:r}=t;this.__ctx=e.getContext("2d",{alpha:null==i||i}),this.backgroundColor=null!=r?r:this.backgroundColor,this.snapToPixel=null!=s?s:this.snapToPixel,this.smoothing=null!=n?n:this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,s,n,r,o,a,l){if(0===s||0===n)return;if(0===a||0===l)return;if(0===t.width||0===t.height)return;this.__ctx.globalAlpha=this.opacity;const h=[t,e,i,s,n,r,o,a,l].filter((t=>void 0!==t)).map((t=>"number"==typeof t&&this.snapToPixel?~~t:t));this.__ctx.drawImage.apply(this.__ctx,h),ti.DrawCallCount++,ti.DrawnImagesCount=1}drawLine(t,e,i,s=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y),this.__ctx.lineTo(this.snapToPixel?~~e.x:e.x,this.snapToPixel?~~e.y:e.y),this.__ctx.lineWidth=s,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,s){this.__ctx.save(),this.__ctx.fillStyle=s.toString(),this.__ctx.fillRect(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y,this.snapToPixel?~~e:e,this.snapToPixel?~~i:i),this.__ctx.restore()}drawCircle(t,e,i,s,n){this.__ctx.save(),this.__ctx.beginPath(),s&&(this.__ctx.strokeStyle=s.toString()),n&&(this.__ctx.lineWidth=n),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~t.x:t.x,this.snapToPixel?~~t.y:t.y,e,0,2*Math.PI),this.__ctx.fill(),s&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){throw Error("Not implemented")}removePostProcessor(t){throw Error("Not implemented")}clearPostProcessors(){throw Error("Not implemented")}beginDrawLifecycle(){}endDrawLifecycle(){}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),ti.clear()}flush(){}}class Lr{constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}static fromPagePosition(t,e,i){let s,n,r,o;3===arguments.length?(s=t,n=e,r=new S(s,n),o=i):(r=t,s=r.x,n=r.y,o=e);const a=o.screen.pageToScreenCoordinates(r),l=o.screen.screenToWorldCoordinates(a);return new Lr(l,r,a)}}class Or{constructor(t,e,i,s,n,r){this.type=t,this.pointerId=e,this.button=i,this.pointerType=s,this.coordinates=n,this.nativeEvent=r,this.active=!0}cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}}class Vr{constructor(t,e,i,s,n,r,o,a,l,h,c,d){this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=n,this.screenY=r,this.index=o,this.deltaX=a,this.deltaY=l,this.deltaZ=h,this.deltaMode=c,this.ev=d,this.active=!0}cancel(){this.active=!1}}class zr extends mi{constructor(){super(),this.lastPagePos=S.Zero,this.lastScreenPos=S.Zero,this.lastWorldPos=S.Zero,this._onPointerMove=t=>{this.lastPagePos=new S(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new S(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new S(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new S(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new S(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new S(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}}(gr=pr||(pr={})).Pixel="Pixel",gr.Line="Line",gr.Page="Page",(mr=_r||(_r={}))[mr.NoButton=-1]="NoButton",mr[mr.Left=0]="Left",mr[mr.Middle=1]="Middle",mr[mr.Right=2]="Right",mr[mr.Unknown=3]="Unknown",(vr=fr||(fr={})).Left="Left",vr.Middle="Middle",vr.Right="Right",vr.Unknown="Unknown",vr.NoButton="NoButton",(wr=br||(br={})).Touch="Touch",wr.Mouse="Mouse",wr.Pen="Pen",wr.Unknown="Unknown";class Ur extends mi{constructor(t,e){super(),this.target=t,this.engine=e,this.primary=new zr,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new zr);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return null!==(e=this.currentFramePointerDown.get(t))&&void 0!==e&&e}wasDown(t){var e;return null!==(e=this.lastFramePointerDown.get(t))&&void 0!==e&&e}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,s]of e)s===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(){this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const t={passive:!(this.engine.pageScrollPreventionMode===Gr.All||this.engine.pageScrollPreventionMode===Gr.Canvas)};"onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,t):void 0!==document.onmousewheel?this.target.addEventListener("mousewheel",this._boundWheel,t):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,t)}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):void 0!==document.onmousewheel?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const e=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort(((t,e)=>t-e)).findIndex((e=>e===t));return this._activeNativePointerIdsToNormalized.set(t,e),e}_handle(t){t.preventDefault();const e=new Map;let i,s;if(n=t,globalThis.TouchEvent&&n instanceof globalThis.TouchEvent){i=fr.Unknown,s=br.Touch;for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],n=Lr.fromPagePosition(s.pageX,s.pageY,this.engine),r=i+1,o=this._normalizePointerId(r);this.currentFramePointerCoords.set(o,n),e.set(o,n)}}else{i=this._nativeButtonToPointerButton(t.button),s=br.Mouse;const n=Lr.fromPagePosition(t.pageX,t.pageY,this.engine);let r=1;(function(t){return globalThis.PointerEvent&&t instanceof globalThis.PointerEvent})(t)&&(r=t.pointerId,s=this._stringToPointerType(t.pointerType));const o=this._normalizePointerId(r);this.currentFramePointerCoords.set(o,n),e.set(o,n)}var n;for(const[n,r]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Or("down",n,i,s,r,t)),this.currentFramePointerDown.set(n,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Or("up",n,i,s,r,t)),this.currentFramePointerDown.set(n,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Or("move",n,i,s,r,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Or("cancel",n,i,s,r,t))}}_handleWheel(t){(this.engine.pageScrollPreventionMode===Gr.All||this.engine.pageScrollPreventionMode===Gr.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(A(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),s=-.025,n=t.deltaX||t.wheelDeltaX*s||0,r=t.deltaY||t.wheelDeltaY*s||t.wheelDelta*s||t.detail||0,o=t.deltaZ||0;let a=pr.Pixel;t.deltaMode&&(1===t.deltaMode?a=pr.Line:2===t.deltaMode&&(a=pr.Page));const l=new Vr(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,n,r,o,a,t);this.currentFrameWheel.push(l)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const s=this.engine.currentScene.world.systemManager.get(Qn),n=this.engine.currentScene.world.queryManager.createQuery(s.types);s.update(n.getEntities())}_nativeButtonToPointerButton(t){switch(t){case _r.NoButton:return fr.NoButton;case _r.Left:return fr.Left;case _r.Middle:return fr.Middle;case _r.Right:return fr.Right;case _r.Unknown:return fr.Unknown;default:return at(t)}}_stringToPointerType(t){switch(t){case"touch":return br.Touch;case"mouse":return br.Mouse;case"pen":return br.Pen;default:return br.Unknown}}}class Nr{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=null!==(e=t.samplePeriod)&&void 0!==e?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=1e3*this._frames/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Hr{constructor(t){var e,i,s;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=null!==(e=this.now())&&void 0!==e?e:0,this._maxFps=null!==(i=t.maxFps)&&void 0!==i?i:this._maxFps,this._onFatalException=null!==(s=t.onFatalException)&&void 0!==s?s:this._onFatalException,this.fpsSampler=new Nr({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new Wr({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new jr({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0){const i=this.now()+e;this._scheduledCbs.push([t,i])}_runScheduledCbs(){for(let t=this._scheduledCbs.length-1;t>-1;t--)this._scheduledCbs[t][1]<=this._totalElapsed&&(this._scheduledCbs[t][0](),this._scheduledCbs.splice(t,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const s=1e3/this._maxFps;if(i>=s){let n=0;0!==s&&(n=i%s,i-=n),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this._runScheduledCbs(),this.tick(t||i),this._lastTime=0!==s?e-n:e,this.fpsSampler.end()}}catch(t){this._onFatalException(t),this.stop()}}}class jr extends Hr{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(t){throw window.cancelAnimationFrame(this._requestId),t}};t()}stop(){this._running=!1}}class Wr extends Hr{constructor(t){super({...t}),this._logger=v.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return null!==(t=this._currentTime)&&void 0!==t?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=null!=t?t:this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(null!=e?e:this._updateMs)}}var Gr,qr,Kr=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};_(),(qr=Gr||(Gr={}))[qr.None=0]="None",qr[qr.Canvas=1]="Canvas",qr[qr.All=2]="All";class Xr extends mi{constructor(t){var e,i,s,n;super(),this.maxFps=Number.POSITIVE_INFINITY,this._hasStarted=!1,this.scenes={},this._animations=[],this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.debugColor=new D(255,255,255),this.enableCanvasTransparency=!0,this.onFatalException=t=>{v.getInstance().fatal(t)},this._timescale=1,this._isInitialized=!1,this._deferredGoTo=null,this._loadingComplete=!1,this._isReady=!1,this._isReadyPromise=new Promise((t=>{this._isReadyResolve=t})),this._screenShotRequests=[],t={...Xr._DEFAULT_ENGINE_OPTIONS,...t},m.freeze(),this.browser=new Br(window,document);const r=new Ei;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=r.test())){const e=document.createElement("div");if(e.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(e),r.failedTests.forEach((function(t){const e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)})),t.canvasElementId){const e=document.getElementById(t.canvasElementId);e&&e.parentElement.removeChild(e)}return}this._compatible=!0,console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Bo})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=v.getInstance(),this._logger.defaultLevel===u.Debug&&r.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let o=null!==(e=t.displayMode)&&void 0!==e?e:ci.Fixed;if(t.width&&t.height||t.viewport?(void 0===t.displayMode&&(o=ci.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),o=ci.FitScreen),m.isEnabled(c.Canvas)){const e=new Fr({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}else{const e=new hi({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}this.screen=new pi({canvas:this.canvas,context:this.graphicsContext,antialiasing:null===(i=t.antialiasing)||void 0===i||i,browser:this.browser,viewport:null!==(s=t.viewport)&&void 0!==s?s:t.width&&t.height?{width:t.width,height:t.height}:ui.SVGA,resolution:t.resolution,displayMode:o,position:t.position,pixelRatio:t.suppressHiDPIScaling?1:null}),At.filtering=t.antialiasing?dt.Blended:dt.Pixel,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=null!==(n=t.maxFps)&&void 0!==n?n:this.maxFps,this.clock=new jr({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:t=>this.onFatalException(t)}),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new Ci,this._loader.wireEngine(this),this.debug=new Sr(this),this._initialize(t),this.rootScene=this.currentScene=new yr,this.addScene("root",this.rootScene),window.___EXCALIBUR_DEVTOOL=this}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){t<=0?v.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t}playAnimation(t,e,i){this._animations.push(new Yr(t,e,i))}addTileMap(t){this.currentScene.addTileMap(t)}removeTileMap(t){this.currentScene.removeTileMap(t)}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof yr)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]}add(t){2!==arguments.length?this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t):this.addScene(arguments[0],arguments[1])}remove(t){t instanceof ws&&this.currentScene.remove(t),t instanceof yr&&this.removeScene(t),"string"==typeof t&&this.removeScene(t)}goToScene(t){if(this.isInitialized)if(this.scenes[t]){const e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.apply(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new le(i,this.currentScene))),this.currentScene=i,this.screen.setCurrentCamera(i.camera),this.currentScene._initialize(this),this.currentScene._activate.apply(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new ae(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!");else this._deferredGoTo=t}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){this.pageScrollPreventionMode=t.scrollPreventionMode;const e=t&&t.pointerScope===rr.Document?document:this.canvas;let i,s;this.input={keyboard:new Ir,pointers:new Ur(e,this),gamepads:new Dr},this.input.keyboard.init(),this.input.pointers.init(),this.input.gamepads.init(),void 0!==document.hidden?(i="hidden",s="visibilitychange"):"msHidden"in document?(i="msHidden",s="msvisibilitychange"):"webkitHidden"in document&&(i="webkitHidden",s="webkitvisibilitychange"),this.browser.document.on(s,(()=>{document[i]?(this.eventDispatcher.emit("hidden",new Zt(this)),this._logger.debug("Window hidden")):(this.eventDispatcher.emit("visible",new Yt(this)),this._logger.debug("Window visible"))})),this.canvasElementId||t.canvasElement||document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new oe(t,this)),this._isInitialized=!0,this._deferredGoTo?this.goToScene(this._deferredGoTo):this.goToScene("root"))}_update(t){if(!this.ready)return this._loader.update(this,t),this.input.keyboard.update(),void this.input.gamepads.update();this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter((function(t){return!t.animation.isDone()})),this._postupdate(t),this.input.keyboard.update(),this.input.gamepads.update()}_preupdate(t){this.emit("preupdate",new zt(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new Ut(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){const e=this.ctx;if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this._predraw(e,t),!this._isReady)return this._loader.canvas.draw(this.graphicsContext,0,0),void this.graphicsContext.flush();this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.ctx,t);let i=0;const s=this._animations.length;for(;i<s;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();const t=this.input.keyboard.getKeys();for(let e=0;e<t.length;e++)this.ctx.fillText(t[e].toString()+" : "+(ar[t[e]]?ar[t[e]]:"Not Mapped"),100,10*e+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}this._postdraw(e,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Ft(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new Lt(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return this._loadingComplete}get ready(){return this._isReady}isReady(){return this._isReadyPromise}async start(t){if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");return t&&(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this)),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),t&&(await this.load(this._loader),this._loadingComplete=!0,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport()),this._loadingComplete=!0,this._overrideInitialize(this),this._isReady=!0,this._isReadyResolve(),this.emit("start",new Bt(this)),this._isReadyPromise}_mainloop(t){this.emit("preframe",new Nt(this,this.stats.prevFrame));const e=t*this.timescale,i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.delta=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,ti.clear();const s=this.clock.now();this._update(e);const n=this.clock.now();this._draw(e);const r=this.clock.now();this.stats.currFrame.duration.update=n-s,this.stats.currFrame.duration.draw=r-n,this.stats.currFrame.graphics.drawnImages=ti.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=ti.DrawCallCount,this.emit("postframe",new Ht(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame)}static createMainLoop(t,e,i){let s=i();const n=new Nr({nowFn:i,initialFps:t.maxFps===1/0?60:t.maxFps});return function r(){if(t._hasStarted)try{t._requestId=e(r),n.start(),t.emit("preframe",new Nt(t,t.stats.prevFrame));const o=i();let a=o-s||1;const l=t.maxFps===Number.POSITIVE_INFINITY?0:1e3/t.maxFps;if(a<=l)return;a>200&&(a=1);const h=a*t.timescale,c=t.stats.prevFrame.id+1;t.stats.currFrame.reset(),t.stats.currFrame.id=c,t.stats.currFrame.delta=h,t.stats.currFrame.fps=n.fps;const d=i();t._update(h);const u=i();t._draw(h);const p=i();t.stats.currFrame.duration.update=u-d,t.stats.currFrame.duration.draw=p-u,s=l>0?o-a%l:o,t.emit("postframe",new Ht(t,t.stats.currFrame)),n.end(),t.stats.prevFrame.reset(t.stats.currFrame)}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}}stop(){this.clock.isRunning()&&(this.emit("stop",new $t(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isPaused(){return!this.clock.isRunning()}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise((e=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:e})}))}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,s=document.createElement("canvas");s.width=e,s.height=i,s.getContext("2d").drawImage(this.canvas,0,0,e,i);const n=new Image,r=s.toDataURL("image/png");n.src=r,t.resolve(n)}this._screenShotRequests.length=0}async load(t){try{await t.load()}catch(t){await Promise.resolve()}}}Xr._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:rr.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:Gr.Canvas,backgroundColor:D.fromHex("#2185d0")},Kr([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Actor.graphics"})],Xr.prototype,"playAnimation",null);let Yr=class{constructor(t,e,i){this.animation=t,this.x=e,this.y=i}};Yr=Kr([E({message:"Will be removed in excalibur v0.26.0"})],Yr);class Zr extends It{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Qr extends Zr{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Jr extends Zr{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}var to=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class eo extends Qs{constructor(t){super(t),this._font=new Xs,this._text=new Ys({text:"",font:this._font}),this.letterSpacing=0,this.caseInsensitive=!0;const{text:e,pos:i,x:s,y:n,spriteFont:r,font:o,color:a}=t;this.pos=null!=i?i:s&&n?A(s,n):this.pos,this.text=null!=e?e:this.text,this.font=null!=o?o:this.font,this.spriteFont=null!=r?r:this.spriteFont,this._text.color=null!=a?a:this.color;const l=this.get(Es);l.anchor=S.Zero,l.use(this._text)}get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get bold(){return this.font.bold}set bold(t){this.font.bold=t}get fontFamily(){return this.font.family}set fontFamily(t){this.font.family=t}get fontSize(){return this.font.size}set fontSize(t){this.font.size=t}get fontStyle(){return this.font.style}set fontStyle(t){this.font.style=t}get fontUnit(){return this.font.unit}set fontUnit(t){this.font.unit=t}get textAlign(){return this.font.textAlign}set textAlign(t){this.font.textAlign=t}get baseAlign(){return this.font.baseAlign}set baseAlign(t){this.font.baseAlign=t}get spriteFont(){return this._legacySpriteFont}set spriteFont(t){if(t){if(t instanceof je)return this._legacySpriteFont=t,this._spriteFont=Ge.fromLegacySpriteFont(t),void(this._text.font=this._spriteFont);this._spriteFont=t,this._text.font=this._spriteFont}}_initialize(t){super._initialize(t),this._graphicsContext=t.graphicsContext}getTextWidth(){return this._text.width}setTextShadow(t,e,i){this.font.shadow={offset:A(t,e),blur:2,color:i}}useTextShadow(t){this.spriteFont&&this.spriteFont.useTextShadow(t)}clearTextShadow(){this.font.shadow=null}draw(t,e){const i=this._graphicsContext;this._text.draw(i,0,0)}}to([E({message:"Label.bold will be removed in v0.26.0",alternateMethod:"Use Label.font.bold"})],eo.prototype,"bold",null),to([E({message:"Label.fontFamily will be removed in v0.26.0",alternateMethod:"Use Label.font.family"})],eo.prototype,"fontFamily",null),to([E({message:"Label.fontSize will be removed in v0.26.0",alternateMethod:"Use Label.font.size"})],eo.prototype,"fontSize",null),to([E({message:"Label.fontStyle will be removed in v0.26.0",alternateMethod:"Use Label.font.style"})],eo.prototype,"fontStyle",null),to([E({message:"Label.fontUnit will be removed in v0.26.0",alternateMethod:"Use Label.font.unit"})],eo.prototype,"fontUnit",null),to([E({message:"Label.textAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.textAlign"})],eo.prototype,"textAlign",null),to([E({message:"Label.baseAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.baseAlign"})],eo.prototype,"baseAlign",null),to([E({message:"Label.setTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"setTextShadow",null),to([E({message:"Label.useTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"useTextShadow",null),to([E({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],eo.prototype,"clearTextShadow",null);class io extends ws{constructor(t,e,i,s){super([new Ui,new Es({offset:null!=i?i:S.Zero,onPostDraw:(t,e)=>this.draw(t,e)}),new tr(s)]),this.solid=!1,this._tileBounds=new R,this._graphics=[],this._colliders=[],this.x=t,this.y=e,this.map=s,this._transform=this.get(Ui),this._isometricEntityComponent=this.get(tr);const n=this.map.tileWidth/2,r=this.map.tileHeight/2,o=(this.x-this.y)*n,a=(this.x+this.y)*r;this._transform.pos=A(o,a),this._isometricEntityComponent.elevation=0,this._gfx=this.get(Es),this._gfx.visible=!1;const l=this.map.tileWidth,h=this.map.tileHeight,c=A(0,this.map.renderFromTopOfGraphic?h:0);this._gfx.localBounds=this._tileBounds=new R({left:-l/2,top:-h,right:l/2,bottom:h}).translate(c)}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t),this._gfx.visible=!0,this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=A(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(A(this.x,this.y))}get center(){return this.pos.add(A(0,this.map.tileHeight/2))}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const e of this._graphics)e.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t.restore()}}class so extends ws{constructor(t){super([new Ui,new ps({type:Si.Fixed}),new ls,new en((t=>this.debug(t)),!1)],t.name),this.renderFromTopOfGraphic=!1,this.graphicsOffset=A(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:s,width:n,height:r,renderFromTopOfGraphic:o,graphicsOffset:a}=t;this.transform=this.get(Ui),e&&(this.transform.pos=e),this.collider=this.get(ls),this.collider&&this.collider.set(this._composite=new Zi([])),this.renderFromTopOfGraphic=null!=o?o:this.renderFromTopOfGraphic,this.graphicsOffset=null!=a?a:this.graphicsOffset,this.tileWidth=i,this.tileHeight=s,this.width=n,this.height=r,this.tiles=new Array(n*r);for(let t=0;t<r;t++)for(let e=0;e<n;e++){const i=new io(e,t,this.graphicsOffset,this);this.tiles[e+t*n]=i,this.addChild(i)}}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}updateColliders(){this._composite.clearColliders();for(const t of this.tiles)if(t.solid)for(const e of t.getColliders()){const i=this._getOrSetColliderOriginalOffset(e);e.offset=this.tileToWorld(A(t.x,t.y)).add(i).sub(A(this.tileWidth/2,this.tileHeight)),e.owner=this,this._composite.addCollider(e)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return A(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2;return A((t.x-t.y)*e,(t.x+t.y)*i).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.tiles[t+e*this.width]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}debug(t){for(let e=0;e<this.height+1;e++){const i=this.tileToWorld(A(0,e)),s=this.tileToWorld(A(this.width,e));t.drawLine(i,s,D.Red,2)}for(let e=0;e<this.width+1;e++){const i=this.tileToWorld(A(e,0)),s=this.tileToWorld(A(e,this.height));t.drawLine(i,s,D.Red,2)}for(const e of this.tiles)t.drawCircle(this.tileToWorld(A(e.x,e.y)),3,D.Yellow)}}class no{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const i=new Hi(t,this._CURRENT_BIT,void 0!==e?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}no._STARTING_BIT=1,no._MAX_GROUPS=32,no._CURRENT_GROUP=1,no._CURRENT_BIT=no._STARTING_BIT,no._GROUPS=new Map;let ro=class{constructor(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=S.Zero,this.offset=S.Zero,this.rotation=0,this.scale=S.One,this.opacity=1,this._points=t;const e=this._points.reduce(((t,e)=>Math.min(t,e.x)),0),i=this._points.reduce(((t,e)=>Math.max(t,e.x)),0);this.drawWidth=i-e;const s=this._points.reduce(((t,e)=>Math.min(t,e.y)),0),n=this._points.reduce(((t,e)=>Math.max(t,e.y)),0);this.drawHeight=n-s,this.height=this.drawHeight,this.width=this.drawWidth}addEffect(){}removeEffect(){}clearEffects(){}reset(){}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,l,h;const{ctx:c,x:d,y:u,rotation:p,drawWidth:g,drawHeight:_,anchor:m,offset:f,opacity:v,flipHorizontal:b,flipVertical:w}={...t,rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:(null!==(l=t.opacity)&&void 0!==l?l:1)*(null!==(h=this.opacity)&&void 0!==h?h:1)},x=g*m.x+f.x+d,y=_*m.y+f.y+u;c.save(),c.translate(x,y),c.scale(this.scale.x,this.scale.y),c.rotate(p),c.beginPath(),c.lineWidth=this.lineWidth;const C=this._points[0];c.moveTo(C.x,C.y);let P=0;const E=this._points.length;for(;P<E;P++)c.lineTo(this._points[P].x,this._points[P].y);c.lineTo(C.x,C.y),c.closePath(),this.filled&&(c.fillStyle=this.fillColor.toString(),c.fill()),c.strokeStyle=this.lineColor.toString(),b&&(c.translate(g,0),c.scale(-1,1)),w&&(c.translate(0,_),c.scale(1,-1));const S=c.globalAlpha;c.globalAlpha=v,c.stroke(),c.globalAlpha=S,c.restore()}};ro=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([E({message:"Polygon will be removed in v0.26.0",alternateMethod:"Use Graphics.Polygon"})],ro);class oo{}function ao(t){return!!t._initialize}function lo(t){return!!t.onInitialize}function ho(t){return!!t._preupdate}function co(t){return!!t.onPreUpdate}function uo(t){return!!t.onPostUpdate}function po(t){return!!t.onPostUpdate}function go(t){return!!t.onPreDraw}function _o(t){return!!t.onPostDraw}oo.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class mo{constructor(t){this._src=t,this._volume=1,this._duration=void 0,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._audioContext=gi.create(),this._volumeNode=this._audioContext.createGain(),this._currentOffset=0,this._createNewBufferSource()}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())}get loop(){return this._loop}set volume(t){t=V(t,0,1),this._volume=t,this._isPlaying&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}set duration(t){this._duration=t}get duration(){return this._duration}get _playbackRate(){return this._instance?1/(this._instance.playbackRate.value||1):null}isPlaying(){return this._isPlaying}play(t=(()=>{})){return this._isPaused&&(this._resumePlayBack(),t()),this._isPlaying||(this._startPlayBack(),t()),this._playingPromise}pause(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1,this._instance.stop(0),this._setPauseOffset())}stop(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded())}_startPlayBack(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new Promise((t=>{this._playingResolve=t})),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._wireUpOnEnded()}_resumePlayBack(){if(!this._isPaused)return;this._isPaused=!1,this._isPlaying=!0,this._instance.onended=null,this._createNewBufferSource();const t=this._playbackRate*this._src.duration,e=this._currentOffset%t;this._rememberStartTime(-1e3*e),this._instance.start(0,e),this._wireUpOnEnded()}_wireUpOnEnded(){this.loop||(this._instance.onended=()=>this._handleOnEnded())}_handleOnEnded(){this._isPaused||(this._isPlaying=!1,this._playingResolve(!0))}_rememberStartTime(t){this._startTime=(new Date).getTime()+(0|t)}_setPauseOffset(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)}}function fo(t){try{const e=new Audio,i=/.*\.([A-Za-z0-9]+)$/,s=t.match(i)[1];return!!e.canPlayType("audio/"+s)}catch(t){return v.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}class vo extends mi{constructor(...t){super(),this.logger=v.getInstance(),this._loop=!1,this._volume=1,this._duration=void 0,this._isStopped=!1,this._isPaused=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._audioContext=gi.create(),this._resource=new ge("",oo.type.arraybuffer);for(const e of t)if(fo(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}set loop(t){this._loop=t;for(const t of this._tracks)t.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const t of this._tracks)t.volume=this._volume;this.emit("volumechange",new Qr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}isLoaded(){return!!this.data}async load(){if(this.data)return this.data;const t=await this._resource.load(),e=await this.decodeAudio(t.slice(0));return this._duration="object"==typeof e?e.duration:void 0,this.emit("processed",new Jr(this,e)),this.data=e}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch(t){return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",(()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())})),this._engine.on("visible",(()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)})),this._engine.on("start",(()=>{this._isStopped=!1})),this._engine.on("stop",(()=>{this.stop(),this._isStopped=!0})))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some((t=>t.isPlaying()))}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this._isPaused=!0,this.emit("pause",new Qr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new Qr(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this._isPaused){const t=[];for(const e of this._tracks)t.push(e.play());this._isPaused=!1,this.emit("resume",new Qr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=await this._getTrackInstance(this.data),e=await t.play((()=>{this.emit("playbackstart",new Qr(this,t)),this.logger.debug("Playing new instance for sound",this.path)}));return this.emit("playbackend",new Qr(this,t)),this._tracks.splice(this.getTrackId(t),1),e}_getTrackInstance(t){const e=new mo(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,this._tracks.push(e),e}}class bo{constructor(t,e=D.Magenta,i=!0){this.path=t,this.color=e,this.bustCache=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new ge(t,"arraybuffer",i),this._transparentColor=e}async load(){const t=await this._resource.load();this._stream=new yo(t),this._gif=new Co(this._stream,this._transparentColor);const e=this._gif.images.map((t=>new Ie(t.src,!1)));return await Promise.all(e.map((t=>t.load()))),this.data=this._textures=e}isLoaded(){return!!this.data}toLegacySprite(t=0){return ke.toLegacySprite(this.toSprite(t))}toLegacySpriteSheet(){return We.toLegacySpriteSheet(this.toSpriteSheet())}toLegacyAnimation(t,e){return jn.toLegacyAnimation(t,this.toAnimation(e))}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map((t=>t.toSprite()));return new We({sprites:t})}toAnimation(t){const e=this.toSpriteSheet(),i=e.sprites.length;return this._animation=jn.fromSpriteSheet(e,H(0,i),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const wo=t=>t.reduce((function(t,e){return 2*t+e}),0),xo=t=>{const e=[];for(let i=7;i>=0;i--)e.push(!!(t&1<<i));return e};class yo{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=t=>{const e=[];for(let i=0;i<t;i++)e.push(this.readByte());return e},this.read=t=>{let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=()=>{const t=this.readBytes(2);return(t[1]<<8)+t[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,0===this.len)throw new Error("No data loaded from file")}}class Co{constructor(t,e=D.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=t=>{const e=[];for(let i=0;i<t;i++){const t="#"+this._st.readBytes(3).map((t=>{const e=t.toString(16);return 1===e.length?"0"+e:e})).join("");e.push(t)}return e},this.readSubBlocks=()=>{let t,e;e="";do{t=this._st.readByte(),e+=this._st.read(t)}while(0!==t);return e},this.parseHeader=()=>{const t={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(t.sig=this._st.read(3),t.ver=this._st.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=xo(this._st.readByte());t.gctFlag=e.shift(),t.colorRes=wo(e.splice(0,3)),t.sorted=e.shift(),t.globalColorTableSize=wo(e.splice(0,3)),t.bgColor=this._st.readByte(),t.pixelAspectRatio=this._st.readByte(),t.gctFlag&&(t.globalColorTable=this.parseColorTable(1<<t.globalColorTableSize+1),this.globalColorTable=t.globalColorTable),this._handler.hdr&&this._handler.hdr(t)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=t=>{const e=t=>{this.checkBytes.push(this._st.readByte());const e=xo(this._st.readByte());t.reserved=e.splice(0,3),t.disposalMethod=wo(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=this._st.readUnsigned(),t.transparencyIndex=this._st.readByte(),t.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(t)&&this.checkBytes.push(this._handler.gce)},i=t=>{t.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(t)&&this.checkBytes.push(this._handler.com)},s=t=>{this.checkBytes.push(this._st.readByte()),t.ptHeader=this._st.readBytes(12),t.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(t)&&this.checkBytes.push(this._handler.pte)},n=t=>{const e=t=>{this.checkBytes.push(this._st.readByte()),t.unknown=this._st.readByte(),t.iterations=this._st.readUnsigned(),t.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(t)&&this.checkBytes.push(this._handler.app)},i=t=>{t.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[t.identifier]&&this._handler.app[t.identifier](t)&&this.checkBytes.push(this._handler.app[t.identifier])};this.checkBytes.push(this._st.readByte()),t.identifier=this._st.read(8),t.authCode=this._st.read(3),"NETSCAPE"===t.identifier?e(t):i(t)},r=t=>{t.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(t)&&this.checkBytes.push(this._handler.unknown)};switch(t.label=this._st.readByte(),t.label){case 249:t.extType="gce",e(t);break;case 254:t.extType="com",i(t);break;case 1:t.extType="pte",s(t);break;case 255:t.extType="app",n(t);break;default:t.extType="unknown",r(t)}},this.parseImg=t=>{t.leftPos=this._st.readUnsigned(),t.topPos=this._st.readUnsigned(),t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=xo(this._st.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=wo(e.splice(0,3)),t.lctFlag&&(t.lct=this.parseColorTable(1<<t.lctSize+1)),t.lzwMinCodeSize=this._st.readByte();const i=this.readSubBlocks();t.pixels=function(t,e){let i=0;const s=function(t){let s=0;for(let n=0;n<t;n++)e.charCodeAt(i>>3)&1<<(7&i)&&(s|=1<<n),i++;return s},n=[],r=1<<t,o=r+1;let a=t+1,l=[];const h=function(){l=[],a=t+1;for(let t=0;t<r;t++)l[t]=[t];l[r]=[],l[o]=null};let c,d;for(;;)if(d=c,c=s(a),c!==r){if(c===o)break;if(c<l.length)d!==r&&l.push(l[d].concat(l[c][0]));else{if(c!==l.length)throw new Error("Invalid LZW code.");l.push(l[d].concat(l[d][0]))}n.push.apply(n,l[c]),l.length===1<<a&&a<12&&a++}else h();return n}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=((t,e)=>{const i=new Array(t.length),s=t.length/e,n=(s,n)=>{const r=t.slice(n*e,(n+1)*e);i.splice.apply(i,[s*e,e].concat(r))},r=[0,4,2,1],o=[8,8,4,2];let a=0;for(let t=0;t<4;t++)for(let e=r[t];e<s;e+=o[t])n(e,a),a++;return i})(t.pixels,t.width)),this.frames.push(t),this.arrayToImage(t),this._handler.img&&this._handler.img(t)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const t={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",this.parseExt(t);break;case",":t.type="img",this.parseImg(t);break;case";":t.type="eof",this._handler.eof&&this._handler.eof(t)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&this.parseBlock()},this.arrayToImage=t=>{let e=0;const i=document.createElement("canvas");i.id=e.toString(),i.width=t.width,i.height=t.height,e++;const s=i.getContext("2d");let n=0,r=0;for(let e=0;e<t.pixels.length;e++)r%t.width==0&&(n++,r=0),this.globalColorTable[t.pixels[e]]===this._transparentColor.toHex()?s.fillStyle="rgba(0, 0, 0, 0)":s.fillStyle=this.globalColorTable[t.pixels[e]],s.fillRect(r,n,1,1),r++;const o=new Image;o.src=i.toDataURL(),this.images.push(o)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class Po extends Tt{constructor(t){super(t),this.points=t.points,this.filtering=dt.Blended,this.rasterize()}get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce(((t,e)=>Math.max(e.x,t)),0)-e.x,this.height=this._points.reduce(((t,e)=>Math.max(e.y,t)),0)-e.y,this.flagDirty()}get minPoint(){return A(this._points.reduce(((t,e)=>Math.min(e.x,t)),1/0),this._points.reduce(((t,e)=>Math.min(e.y,t)),1/0))}clone(){return new Po({points:this.points.map((t=>t.clone())),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach((i=>{t.lineTo(i.x+e.x,i.y+e.y)})),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}var Eo=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let So=class{constructor(t){this._getComparable=t}find(t){return this._find(this._root,t)}_find(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))}get(t){return this._get(this._root,t)}_get(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)}add(t){return null==this._root?(this._root=new Ao(this._getComparable(t),[t],null,null),!0):this._insert(this._root,t)}_insert(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?!(t.getData().indexOf(e)>-1||(t.getData().push(e),0)):this._getComparable(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new Ao(this._getComparable(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new Ao(this._getComparable(e),[e],null,null)),!0):this._insert(t.getRight(),e))}removeByComparable(t){this._root=this._remove(this._root,t)}_remove(t,e){if(null==t)return null;if(this._getComparable(e)!==t.getKey())return this._getComparable(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);{const i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return t}}return null}_cleanup(t,e){const i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return e.getKey()<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)}_findMinNode(t){let e=t;for(;null!=e.getLeft();)e=e.getLeft();return e}list(){const t=new Array;return this._list(this._root,t),t}_list(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach((t=>{e.push(t)})),this._list(t.getRight(),e))}};So=Eo([E({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use built in JS array.sort"})],So);let Ao=class{constructor(t,e,i,s){this._key=t,this._data=e,this._left=i,this._right=s}getKey(){return this._key}setKey(t){this._key=t}getData(){return this._data}setData(t){this._data=t}getLeft(){return this._left}setLeft(t){this._left=t}getRight(){return this._right}setRight(t){this._right=t}};Ao=Eo([E({message:"Will be removed in excalibur v0.26.0"})],Ao);class To{constructor(t){this._key=0,this._key=t}getTheKey(){return this._key}setKey(t){this._key=t}}class ko{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this._logger=v.getInstance()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){t(this.get()),this.index--}get(...t){return this.index===this.maxObjects&&(this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=2*this.maxObjects),this.objects[this.index]?this.recycler(this.objects[this.index++],...t):(this.totalAllocations++,this.objects[this.index++]=this.builder(...t))}done(...t){this.index=0;for(const e of t){const t=this.objects.indexOf(e);this.objects[t]=this.builder(),this.totalAllocations++}return t}}var Io,Do,Mo;(Mo=Do||(Do={}))[Mo.Resolved=0]="Resolved",Mo[Mo.Rejected=1]="Rejected",Mo[Mo.Pending=2]="Pending";let Ro=Io=class{constructor(){this._state=Do.Pending,this._successCallbacks=[],this._rejectCallback=()=>{}}static resolve(t){return(new Io).resolve(t)}static reject(t){return(new Io).reject(t)}static join(){let t=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(let e=0;e<arguments.length;e++)t[e-0]=arguments[e];else 1===arguments.length&&Array.isArray(arguments[0])&&(t=arguments[0]);const e=new Io;if(!t||!t.length)return e.resolve();const i=t.length;let s=0,n=0;const r=[];return t.forEach((t=>{t.then((()=>{s+=1,s===i?e.resolve():s+n+r.length===i&&e.reject(r)}),(()=>{n+=1,s+n+r.length===i&&e.reject(r)})).error((t=>{r.push(t),r.length+s+n===i&&e.reject(r)}))})),e}then(t,e){if(t&&(this._successCallbacks.push(t),this.state()===Do.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===Do.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this}error(t){return t&&(this._errorCallback=t),this}resolve(t){if(this._state!==Do.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=Do.Resolved,this._successCallbacks.forEach((t=>{t.call(this,this._value)}))}catch(t){this._handleError(t)}return this}reject(t){if(this._state!==Do.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=Do.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this}state(){return this._state}_handleError(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)}};Ro=Io=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}([E({message:"ex.Promises are being replaced by native browser promises in v0.26.0",alternateMethod:"Use browser native promises"})],Ro);const Bo="0.26.0-alpha.16+e8f9175";_()})(),s})()},t.exports=i()})),parcelRequire.register("7mbQa",(function(t,e){var i=$b63e377f8a561b77$exports.Global;function s(){return i.localStorage}function n(t){return s().getItem(t)}t.exports={name:"localStorage",read:n,write:function(t,e){return s().setItem(t,e)},each:function(t){for(var e=s().length-1;e>=0;e--){var i=s().key(e);t(n(i),i)}},remove:function(t){return s().removeItem(t)},clearAll:function(){return s().clear()}}}));var $b63e377f8a561b77$exports={},$b63e377f8a561b77$var$assign=$b63e377f8a561b77$var$make_assign(),$b63e377f8a561b77$var$create=$b63e377f8a561b77$var$make_create(),$b63e377f8a561b77$var$trim=$b63e377f8a561b77$var$make_trim(),$b63e377f8a561b77$var$Global="undefined"!=typeof window?window:$parcel$global;function $b63e377f8a561b77$var$make_assign(){return Object.assign?Object.assign:function(t,e,i,s){for(var n=1;n<arguments.length;n++)$b63e377f8a561b77$var$each(Object(arguments[n]),(function(e,i){t[i]=e}));return t}}function $b63e377f8a561b77$var$make_create(){if(Object.create)return function(t,e,i,s){var n=$b63e377f8a561b77$var$slice(arguments,1);return $b63e377f8a561b77$var$assign.apply(this,[Object.create(t)].concat(n))};{function t(){}return function(e,i,s,n){var r=$b63e377f8a561b77$var$slice(arguments,1);return t.prototype=e,$b63e377f8a561b77$var$assign.apply(this,[new t].concat(r))}}}function $b63e377f8a561b77$var$make_trim(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function $b63e377f8a561b77$var$bind(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function $b63e377f8a561b77$var$slice(t,e){return Array.prototype.slice.call(t,e||0)}function $b63e377f8a561b77$var$each(t,e){$b63e377f8a561b77$var$pluck(t,(function(t,i){return e(t,i),!1}))}function $b63e377f8a561b77$var$map(t,e){var i=$b63e377f8a561b77$var$isList(t)?[]:{};return $b63e377f8a561b77$var$pluck(t,(function(t,s){return i[s]=e(t,s),!1})),i}function $b63e377f8a561b77$var$pluck(t,e){if($b63e377f8a561b77$var$isList(t)){for(var i=0;i<t.length;i++)if(e(t[i],i))return t[i]}else for(var s in t)if(t.hasOwnProperty(s)&&e(t[s],s))return t[s]}function $b63e377f8a561b77$var$isList(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}function $b63e377f8a561b77$var$isFunction(t){return t&&"[object Function]"==={}.toString.call(t)}function $b63e377f8a561b77$var$isObject(t){return t&&"[object Object]"==={}.toString.call(t)}$b63e377f8a561b77$exports={assign:$b63e377f8a561b77$var$assign,create:$b63e377f8a561b77$var$create,trim:$b63e377f8a561b77$var$trim,bind:$b63e377f8a561b77$var$bind,slice:$b63e377f8a561b77$var$slice,each:$b63e377f8a561b77$var$each,map:$b63e377f8a561b77$var$map,pluck:$b63e377f8a561b77$var$pluck,isList:$b63e377f8a561b77$var$isList,isFunction:$b63e377f8a561b77$var$isFunction,isObject:$b63e377f8a561b77$var$isObject,Global:$b63e377f8a561b77$var$Global},parcelRequire.register("deyjU",(function(t,e){var i=$b63e377f8a561b77$exports.Global;t.exports={name:"oldFF-globalStorage",read:function(t){return s[t]},write:function(t,e){s[t]=e},each:n,remove:function(t){return s.removeItem(t)},clearAll:function(){n((function(t,e){delete s[t]}))}};var s=i.globalStorage;function n(t){for(var e=s.length-1;e>=0;e--){var i=s.key(e);t(s[i],i)}}})),parcelRequire.register("eCrE3",(function(t,e){var i=$b63e377f8a561b77$exports.Global;t.exports={name:"oldIE-userDataStorage",write:function(t,e){if(o)return;var i=l(t);r((function(t){t.setAttribute(i,e),t.save(s)}))},read:function(t){if(o)return;var e=l(t),i=null;return r((function(t){i=t.getAttribute(e)})),i},each:function(t){r((function(e){for(var i=e.XMLDocument.documentElement.attributes,s=i.length-1;s>=0;s--){var n=i[s];t(e.getAttribute(n.name),n.name)}}))},remove:function(t){var e=l(t);r((function(t){t.removeAttribute(e),t.save(s)}))},clearAll:function(){r((function(t){var e=t.XMLDocument.documentElement.attributes;t.load(s);for(var i=e.length-1;i>=0;i--)t.removeAttribute(e[i].name);t.save(s)}))}};var s="storejs",n=i.document,r=function(){if(!n||!n.documentElement||!n.documentElement.addBehavior)return null;var t,e,i;try{(e=new ActiveXObject("htmlfile")).open(),e.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),e.close(),t=e.w.frames[0].document,i=t.createElement("div")}catch(e){i=n.createElement("div"),t=n.body}return function(e){var n=[].slice.call(arguments,0);n.unshift(i),t.appendChild(i),i.addBehavior("#default#userData"),i.load(s),e.apply(this,n),t.removeChild(i)}}(),o=(i.navigator?i.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);var a=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function l(t){return t.replace(/^\d/,"___$&").replace(a,"___")}})),parcelRequire.register("hmYM5",(function(t,e){var i=$b63e377f8a561b77$exports.Global,s=$b63e377f8a561b77$exports.trim;t.exports={name:"cookieStorage",read:function(t){if(!t||!a(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(n.cookie.replace(new RegExp(e),"$1"))},write:function(t,e){if(!t)return;n.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},each:r,remove:o,clearAll:function(){r((function(t,e){o(e)}))}};var n=i.document;function r(t){for(var e=n.cookie.split(/; ?/g),i=e.length-1;i>=0;i--)if(s(e[i])){var r=e[i].split("="),o=unescape(r[0]);t(unescape(r[1]),o)}}function o(t){t&&a(t)&&(n.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function a(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(n.cookie)}})),parcelRequire.register("64b1H",(function(t,e){var i=$b63e377f8a561b77$exports.Global;function s(){return i.sessionStorage}function n(t){return s().getItem(t)}t.exports={name:"sessionStorage",read:n,write:function(t,e){return s().setItem(t,e)},each:function(t){for(var e=s().length-1;e>=0;e--){var i=s().key(e);t(n(i),i)}},remove:function(t){return s().removeItem(t)},clearAll:function(){return s().clear()}}})),parcelRequire.register("ibNr9",(function(t,e){t.exports={name:"memoryStorage",read:function(t){return i[t]},write:function(t,e){i[t]=e},each:function(t){for(var e in i)i.hasOwnProperty(e)&&t(i[e],e)},remove:function(t){delete i[t]},clearAll:function(t){i={}}};var i={}})),parcelRequire.register("8RueS",(function(t,e){t.exports=function(){return parcelRequire("fZtw7"),{}}})),parcelRequire.register("fZtw7",(function(module,exports){"object"!=typeof JSON&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,(function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+t+'"'}function str(t,e){var i,s,n,r,o,a=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,i=0;i<r;i+=1)o[i]=str(i,l)||"null";return n=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,n}if(rep&&"object"==typeof rep)for(r=rep.length,i=0;i<r;i+=1)"string"==typeof rep[i]&&(n=str(s=rep[i],l))&&o.push(quote(s)+(gap?": ":":")+n);else for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(n=str(s,l))&&o.push(quote(s)+(gap?": ":":")+n);return n=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value),"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var s;if(gap="",indent="","number"==typeof i)for(s=0;s<i;s+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var i,s,n=t[e];if(n&&"object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(void 0!==(s=walk(n,i))?n[i]=s:delete n[i]);return reviver.call(t,e,n)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,(function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()}));var $add9c39736a4e4a8$exports={};parcelRequire("27Lyk").register(JSON.parse('{"aT88m":"index.b4f6eafe.js","93Bqc":"sword.a45e8cc8.png","1OAey":"sand-placeholder.566f05a5.png","5rmOr":"sandcastle-placeholder.53b9737d.png","9fEnB":"tower-placeholder.7eee11a2.png","lxy2T":"clank.3e05cde9.wav"}'));var $jgD1p=parcelRequire("jgD1p"),$1b5031d44df7baeb$exports={},$b56da5de5b72d494$exports={},$b56da5de5b72d494$var$slice=$b63e377f8a561b77$exports.slice,$b56da5de5b72d494$var$pluck=$b63e377f8a561b77$exports.pluck,$b56da5de5b72d494$var$each=$b63e377f8a561b77$exports.each,$b56da5de5b72d494$var$bind=$b63e377f8a561b77$exports.bind,$b56da5de5b72d494$var$create=$b63e377f8a561b77$exports.create,$b56da5de5b72d494$var$isList=$b63e377f8a561b77$exports.isList,$b56da5de5b72d494$var$isFunction=$b63e377f8a561b77$exports.isFunction,$b56da5de5b72d494$var$isObject=$b63e377f8a561b77$exports.isObject;$b56da5de5b72d494$exports={createStore:$b56da5de5b72d494$var$createStore};var $b56da5de5b72d494$var$storeAPI={version:"2.0.12",enabled:!1,get:function(t,e){var i=this.storage.read(this._namespacePrefix+t);return this._deserialize(i,e)},set:function(t,e){return void 0===e?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each((function(i,s){t.call(e,e._deserialize(i),(s||"").replace(e._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return $b56da5de5b72d494$var$createStore.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return $b56da5de5b72d494$var$createStore(this.storage,this.plugins,t)}};function $b56da5de5b72d494$var$_warn(){var t="undefined"==typeof console?null:console;if(t){var e=t.warn?t.warn:t.log;e.apply(t,arguments)}}function $b56da5de5b72d494$var$createStore(t,e,i){i||(i=""),t&&!$b56da5de5b72d494$var$isList(t)&&(t=[t]),e&&!$b56da5de5b72d494$var$isList(e)&&(e=[e]);var s=i?"__storejs_"+i+"_":"",n=i?new RegExp("^"+s):null;if(!/^[a-zA-Z0-9_\-]*$/.test(i))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var r={_namespacePrefix:s,_namespaceRegexp:n,_testStorage:function(t){try{var e="__storejs__test__";t.write(e,e);var i=t.read(e)===e;return t.remove(e),i}catch(t){return!1}},_assignPluginFnProp:function(t,e){var i=this[e];this[e]=function(){var e=$b56da5de5b72d494$var$slice(arguments,0),s=this;function n(){if(i)return $b56da5de5b72d494$var$each(arguments,(function(t,i){e[i]=t})),i.apply(s,e)}var r=[n].concat(e);return t.apply(s,r)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,e){if(!t)return e;var i="";try{i=JSON.parse(t)}catch(e){i=t}return void 0!==i?i:e},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var e=this;if($b56da5de5b72d494$var$isList(t))$b56da5de5b72d494$var$each(t,(function(t){e._addPlugin(t)}));else if(!$b56da5de5b72d494$var$pluck(this.plugins,(function(e){return t===e}))){if(this.plugins.push(t),!$b56da5de5b72d494$var$isFunction(t))throw new Error("Plugins must be function values that return objects");var i=t.call(this);if(!$b56da5de5b72d494$var$isObject(i))throw new Error("Plugins must return an object of function properties");$b56da5de5b72d494$var$each(i,(function(i,s){if(!$b56da5de5b72d494$var$isFunction(i))throw new Error("Bad plugin property: "+s+" from plugin "+t.name+". Plugins should only return functions.");e._assignPluginFnProp(i,s)}))}},addStorage:function(t){$b56da5de5b72d494$var$_warn("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(t)}},o=$b56da5de5b72d494$var$create(r,$b56da5de5b72d494$var$storeAPI,{plugins:[]});return o.raw={},$b56da5de5b72d494$var$each(o,(function(t,e){$b56da5de5b72d494$var$isFunction(t)&&(o.raw[e]=$b56da5de5b72d494$var$bind(o,t))})),$b56da5de5b72d494$var$each(t,(function(t){o._addStorage(t)})),$b56da5de5b72d494$var$each(e,(function(t){o._addPlugin(t)})),o}var $f590d80a5de1f4a7$exports={};$f590d80a5de1f4a7$exports=[parcelRequire("7mbQa"),parcelRequire("deyjU"),parcelRequire("eCrE3"),parcelRequire("hmYM5"),parcelRequire("64b1H"),parcelRequire("ibNr9")];var $1b5031d44df7baeb$var$plugins=[parcelRequire("8RueS")];$1b5031d44df7baeb$exports=$b56da5de5b72d494$exports.createStore($f590d80a5de1f4a7$exports,$1b5031d44df7baeb$var$plugins);let $3d149cbfd3136500$export$6b7b6cff4ccb438b={muteBackgroundMusic:!1,muteAll:!1},$3d149cbfd3136500$var$_origPreferences={...$3d149cbfd3136500$export$6b7b6cff4ccb438b};function $3d149cbfd3136500$export$de31a87075fdbfcc(){$3d149cbfd3136500$export$6b7b6cff4ccb438b={...$3d149cbfd3136500$var$_origPreferences}}function $3d149cbfd3136500$export$f1786e2fa4419c16(){$parcel$interopDefault($1b5031d44df7baeb$exports).set("pref",$3d149cbfd3136500$export$6b7b6cff4ccb438b)}function $3d149cbfd3136500$export$add4fa36ca2fc569(){$3d149cbfd3136500$export$6b7b6cff4ccb438b={...$3d149cbfd3136500$export$6b7b6cff4ccb438b,...$parcel$interopDefault($1b5031d44df7baeb$exports).get("pref")}}var $jgD1p=parcelRequire("jgD1p"),$9d936a2aecb96285$export$2e2bcd8739ae039={ShowDevTool:!0,SoundVolume:.3,Seed:1337,tileWidth:64,tileHeight:64,gridWidth:9,gridHeight:5,gridPadding:1,maxHealth:10,healthBarWidthPixels:54,crabWidth:50,crabHeight:50,crabHealth:3,crabSpeed:15,crabDamage:1,bulletSpeedPixelsPerSecond:100,bulletRadius:10,baseTowerFireRateMs:5e3},$jgD1p=parcelRequire("jgD1p"),$jgD1p=parcelRequire("jgD1p"),$73991847afc42666$exports={};$73991847afc42666$exports=new URL(parcelRequire("27Lyk").resolve("93Bqc"),import.meta.url).toString();var $2d79280c69f571b0$exports={};$2d79280c69f571b0$exports=new URL(parcelRequire("27Lyk").resolve("1OAey"),import.meta.url).toString();var $e9408ce807de14d6$exports={};$e9408ce807de14d6$exports=new URL(parcelRequire("27Lyk").resolve("5rmOr"),import.meta.url).toString();var $6144180d050a7b4e$exports={};$6144180d050a7b4e$exports=new URL(parcelRequire("27Lyk").resolve("9fEnB"),import.meta.url).toString();var $b6db5538437aa8f6$exports={};$b6db5538437aa8f6$exports=new URL(parcelRequire("27Lyk").resolve("lxy2T"),import.meta.url).toString();const $7c4c300842bd4cf2$export$e9a269813a6315a4={Sword:new $jgD1p.ImageSource($parcel$interopDefault($73991847afc42666$exports)),Sand:new $jgD1p.ImageSource($parcel$interopDefault($2d79280c69f571b0$exports),!1,$jgD1p.ImageFiltering.Pixel),SandCastle:new $jgD1p.ImageSource($parcel$interopDefault($e9408ce807de14d6$exports),!1,$jgD1p.ImageFiltering.Pixel),BaseTower:new $jgD1p.ImageSource($parcel$interopDefault($6144180d050a7b4e$exports),!1,$jgD1p.ImageFiltering.Pixel),Clank:new $jgD1p.Sound($parcel$interopDefault($b6db5538437aa8f6$exports))};class $1b9c19121388f259$export$ef2184bd89960b14{constructor(t,e,i,s,n){this.tileMap=new $jgD1p.TileMap({name:"Sand Grid",pos:t,width:i,height:e,tileWidth:s,tileHeight:n});const r=$7c4c300842bd4cf2$export$e9a269813a6315a4.Sand.toSprite();for(let t of this.tileMap.tiles)t.addGraphic(r)}}var $jgD1p=parcelRequire("jgD1p"),$jgD1p=parcelRequire("jgD1p");class $1536b058750c3eeb$export$eefe978c73a9a6 extends $jgD1p.Actor{static CollisionGroup=$jgD1p.CollisionGroupManager.create("enemy");health=$9d936a2aecb96285$export$2e2bcd8739ae039.crabHealth;constructor(t,e){super({name:"Enemey",x:t,y:e,width:$9d936a2aecb96285$export$2e2bcd8739ae039.crabWidth,height:$9d936a2aecb96285$export$2e2bcd8739ae039.crabHeight,color:$jgD1p.Color.Red,vel:new $jgD1p.Vector(-1*$9d936a2aecb96285$export$2e2bcd8739ae039.crabSpeed,0),collisionType:$jgD1p.CollisionType.Active,collisionGroup:$1536b058750c3eeb$export$eefe978c73a9a6.CollisionGroup})}takeDamage(){this.kill()}}class $202a856f300cb394$export$6d3bb735c0cfe084 extends $jgD1p.Actor{maxHp=$9d936a2aecb96285$export$2e2bcd8739ae039.maxHealth;currentHp=this.maxHp;constructor(t,e){super({name:"Sand Castle",pos:t.tileMap.pos.add($jgD1p.vec(0,e*$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight+$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight/2)),width:$9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth,height:$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight,collisionType:$jgD1p.CollisionType.Fixed,collisionGroup:$jgD1p.CollisionGroup.collidesWith([$1536b058750c3eeb$export$eefe978c73a9a6.CollisionGroup])}),this.on("postcollision",(t=>this.onPostCollision(t)));const i=$7c4c300842bd4cf2$export$e9a269813a6315a4.SandCastle.toSprite();this.graphics.use(i),this.healthBar=new $jgD1p.Actor({name:"Healthbar",width:$9d936a2aecb96285$export$2e2bcd8739ae039.healthBarWidthPixels,height:5,color:$jgD1p.Color.Green}),this.addChild(this.healthBar)}onPostCollision(t){this.takeDamage(),t.other.kill()}takeDamage(){this.currentHp-=1;const t=$9d936a2aecb96285$export$2e2bcd8739ae039.healthBarWidthPixels/$9d936a2aecb96285$export$2e2bcd8739ae039.maxHealth;this.healthBar.graphics.current[0].graphic.width=this.currentHp*t,this.currentHp<=0&&this.kill()}}class $de8be84271b58ead$export$be9b8cc71a71c056{constructor(t){this.level=t}spawnEnemy(){const t=this.level.grid.tileMap.getTile($9d936a2aecb96285$export$2e2bcd8739ae039.gridWidth-1,2);console.log({enemySpawnTile:t});const e=new $1536b058750c3eeb$export$eefe978c73a9a6(t.pos.x+$9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth/2,t.pos.y+$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight/2);this.level.add(e)}}var $jgD1p=parcelRequire("jgD1p");class $383a203830abe9d2$export$eba177f38926edac extends $jgD1p.Actor{constructor(t,e,i){super({name:"Base Tower",pos:t.tileMap.getTile(e,i).pos.add($jgD1p.vec($9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth/2,$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight/2)),width:$9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth,height:$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight,collisionType:$jgD1p.CollisionType.Fixed,collisionGroup:$jgD1p.CollisionGroup.collidesWith([$1536b058750c3eeb$export$eefe978c73a9a6.CollisionGroup])});const s=$7c4c300842bd4cf2$export$e9a269813a6315a4.BaseTower.toSprite();this.graphics.use(s)}onInitialize(t){this._engine=t}_currentFireTimer=0;onPostUpdate(t,e){this._currentFireTimer+=e,this._currentFireTimer>$9d936a2aecb96285$export$2e2bcd8739ae039.baseTowerFireRateMs&&(this.fire(),this._currentFireTimer=0)}fire=()=>{const t=new $jgD1p.Actor({name:"Tower Bullet",pos:this.pos,vel:$jgD1p.vec($9d936a2aecb96285$export$2e2bcd8739ae039.bulletSpeedPixelsPerSecond,0),radius:$9d936a2aecb96285$export$2e2bcd8739ae039.bulletRadius,color:$jgD1p.Color.Black,collisionGroup:$jgD1p.CollisionGroup.collidesWith([$1536b058750c3eeb$export$eefe978c73a9a6.CollisionGroup]),collisionType:$jgD1p.CollisionType.Active});t.on("postcollision",(e=>{e.other.takeDamage(),t.kill()})),t.on("exitviewport",(()=>{t.kill()})),this._engine.add(t)}}class $26db8c8762619bb5$export$d97afb273a2ed2b9{_highlightedTile=null;constructor(t,e){this._grid=t,this._engine=e,e.input.pointers.primary.on("move",(t=>this.onPointerMove(t))),e.input.pointers.primary.on("down",(()=>this.onConfirm()))}onPointerMove(t){const e=this._grid.tileMap.getTileByPoint(t.worldPos);e&&(this._highlightedTile=e)}onConfirm(){if(this._highlightedTile){const t=new $383a203830abe9d2$export$eba177f38926edac(this._grid,this._highlightedTile.x,this._highlightedTile.y);this._engine.add(t)}this._highlightedTile=null}}class $84ab826914df134a$export$ca664994d1d54bff extends $jgD1p.Scene{random=new $jgD1p.Random($9d936a2aecb96285$export$2e2bcd8739ae039.Seed);sandCastles=[];enemyGenerator=new $de8be84271b58ead$export$be9b8cc71a71c056(this);onInitialize(t){this.grid=new $1b9c19121388f259$export$ef2184bd89960b14($jgD1p.vec($9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth/2,$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight/2),$9d936a2aecb96285$export$2e2bcd8739ae039.gridHeight,$9d936a2aecb96285$export$2e2bcd8739ae039.gridWidth,$9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth,$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight),this.add(this.grid.tileMap);for(let t=0;t<$9d936a2aecb96285$export$2e2bcd8739ae039.gridHeight;t++){const e=new $202a856f300cb394$export$6d3bb735c0cfe084(this.grid,t);this.sandCastles.push(e),this.add(e)}this.enemyGenerator.spawnEnemy();const e=new $383a203830abe9d2$export$eba177f38926edac(this.grid,5,3);this.add(e),this.towerPlacer=new $26db8c8762619bb5$export$d97afb273a2ed2b9(this.grid,t)}}var $jgD1p=parcelRequire("jgD1p"),$60313e3b9e75c852$exports={};
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){var t={}.hasOwnProperty;function e(){for(var i=[],s=0;s<arguments.length;s++){var n=arguments[s];if(n){var r=typeof n;if("string"===r||"number"===r)i.push(n);else if(Array.isArray(n)){if(n.length){var o=e.apply(null,n);o&&i.push(o)}}else if("object"===r)if(n.toString===Object.prototype.toString)for(var a in n)t.call(n,a)&&n[a]&&i.push(a);else i.push(n.toString())}}return i.join(" ")}$60313e3b9e75c852$exports?(e.default=e,$60313e3b9e75c852$exports=e):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return e})):window.classNames=e}();class $613a632b39062363$export$a62869ddf53aa3e3{static setSoundSpecificVolume(){$7c4c300842bd4cf2$export$e9a269813a6315a4.Clank.volume=.5}static init(){$613a632b39062363$export$a62869ddf53aa3e3.setSoundSpecificVolume(),$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic&&$613a632b39062363$export$a62869ddf53aa3e3.muteBackgroundMusic(),$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll&&$613a632b39062363$export$a62869ddf53aa3e3.muteAll(),$("#mute-music").on("click",(()=>($3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic?$613a632b39062363$export$a62869ddf53aa3e3.unmuteBackgroundMusic():$613a632b39062363$export$a62869ddf53aa3e3.muteBackgroundMusic(),$3d149cbfd3136500$export$f1786e2fa4419c16(),!1))),$("#mute-all").on("click",(()=>($3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll?$613a632b39062363$export$a62869ddf53aa3e3.unmuteAll():$613a632b39062363$export$a62869ddf53aa3e3.muteAll(),$3d149cbfd3136500$export$f1786e2fa4419c16(),!1)))}static muteAll(){$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll=!0,$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic=!0;for(let t in $7c4c300842bd4cf2$export$e9a269813a6315a4){let e=$7c4c300842bd4cf2$export$e9a269813a6315a4[t];e instanceof $jgD1p.Sound&&(e.volume=0)}$613a632b39062363$export$a62869ddf53aa3e3.muteBackgroundMusic(),$613a632b39062363$export$a62869ddf53aa3e3._updateMuteAllButton()}static unmuteAll(){for(var t in $3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll=!1,$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic=!1,$7c4c300842bd4cf2$export$e9a269813a6315a4){let e=$7c4c300842bd4cf2$export$e9a269813a6315a4[t];e instanceof $jgD1p.Sound&&(e.volume=$9d936a2aecb96285$export$2e2bcd8739ae039.SoundVolume)}$613a632b39062363$export$a62869ddf53aa3e3.setSoundSpecificVolume(),$613a632b39062363$export$a62869ddf53aa3e3.unmuteBackgroundMusic(),$613a632b39062363$export$a62869ddf53aa3e3._updateMuteAllButton()}static startBackgroundMusic(){}static stopBackgroundMusic(){}static muteBackgroundMusic(){$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic=!0,$613a632b39062363$export$a62869ddf53aa3e3._updateMusicButton()}static unmuteBackgroundMusic(){$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic=!1,$613a632b39062363$export$a62869ddf53aa3e3._updateMusicButton()}static _updateMusicButton(){$("#mute-music i").get(0).className=$parcel$interopDefault($60313e3b9e75c852$exports)("fa",{"fa-music":!$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic,"fa-play":$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteBackgroundMusic})}static _updateMuteAllButton(){$("#mute-all i").get(0).className=$parcel$interopDefault($60313e3b9e75c852$exports)("fa",{"fa-volume-up":!$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll,"fa-volume-off":$3d149cbfd3136500$export$6b7b6cff4ccb438b.muteAll})}}var $d82f9d57af76c42b$exports={},t1;
/*! For license information please see dev-tools.js.LICENSE.txt */self,t1=parcelRequire("jgD1p"),$d82f9d57af76c42b$exports=(()=>{var t={"./picker-system.ts":(t,e,i)=>{i.r(e),i.d(e,{PickerSystem:()=>n});var s=i("excalibur");class n extends s.System{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=s.SystemType.Update,this.priority=99,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map}initialize(t){this._engine=t.engine,this._receiver=this._engine.input.pointers}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id))return void this.currentFrameEntityToPointers.set(t.id,[e]);const i=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,i.concat(e))}_processPointerToEntity(t){var e;let i,n,r;for(const o of t)if(!(o instanceof s.Particle)){if(i=o.get(s.TransformComponent),n=o.get(s.ColliderComponent),n){const t=n.get();if(t)for(const[e,n]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===s.CoordPlane.World?n.worldPos:n.screenPos)&&this.addPointerToEntity(o,e)}if(r=o.get(s.GraphicsComponent),r){const t=r.localBounds.transform(i.getGlobalMatrix());for(const[e,n]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===s.CoordPlane.World?n.worldPos:n.screenPos)&&this.addPointerToEntity(o,e)}if(!(null===(e=null==r?void 0:r.current)||void 0===e?void 0:e.length)&&!(null==n?void 0:n.get())||o instanceof s.ParticleEmitter){const t=s.BoundingBox.fromDimension(100,100).transform(i.getGlobalMatrix());for(const[e,n]of this._receiver.currentFramePointerCoords.entries())t.contains(i.coordPlane===s.CoordPlane.World?n.worldPos:n.screenPos)&&this.addPointerToEntity(o,e)}}}update(t,e){this._processPointerToEntity(t),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear()}}},"./node_modules/tweakpane/dist/tweakpane.js":function(t,e){!function(t){class e{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class i{constructor(t){this.target=t}}class s extends i{constructor(t,e,i,s){super(t),this.value=e,this.presetKey=i,this.last=null==s||s}}class n extends i{constructor(t,e,i){super(t),this.value=e,this.presetKey=i}}class r extends i{constructor(t,e){super(t),this.expanded=e}}function o(t){return null==t}function a(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}const l={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class h{constructor(t){var e;this.message=null!==(e=l[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new h({type:"alreadydisposed"})}static notBindable(){return new h({type:"notbindable"})}static propertyNotFound(t){return new h({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new h({type:"shouldneverhappen"})}}class c{constructor(t,e,i){this.obj_=t,this.key_=e,this.presetKey_=null!=i?i:e}static isBindable(t){return null!==t&&"object"==typeof t}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const i=this.read();if(!c.isBindable(i))throw h.notBindable();if(!(t in i))throw h.propertyNotFound(t);i[t]=e}}class d extends e{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return null!==(t=this.controller_.valueController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const s=e.bind(this);return this.controller_.valueController.emitter.on(t,(()=>{s(new i(this))})),this}}class u{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter((t=>t.handler!==e))),this}emit(t,e){const i=this.observers_[t];i&&i.forEach((t=>{t.handler(e)}))}}const p="tp";function g(t){return(e,i)=>[p,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}function _(t){return t.rawValue}function m(t,e){var i,s;t.emitter.on("change",(i=_,s=e,t=>s(i(t)))),e(t.rawValue)}function f(t,e,i){m(t.value(e),i)}function v(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}function b(t,e){m(t,(t=>{e.textContent=null!=t?t:""}))}const w=g("btn");class x{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(w()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(w("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(w("t")),b(e.props.value("title"),s),this.buttonElement.appendChild(s)}}class y{constructor(t,e){this.emitter=new u,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new x(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class C{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new u,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,s)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,rawValue:s,sender:this}))}}class P{constructor(t){this.emitter=new u,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,rawValue:this.value_,sender:this}))}}function E(t,e){const i=null==e?void 0:e.constraint,s=null==e?void 0:e.equals;return i||s?new C(t,e):new P(t)}class S{constructor(t){this.emitter=new u,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}static createCore(t){return Object.keys(t).reduce(((e,i)=>Object.assign(e,{[i]:E(t[i])})),{})}static fromObject(t){const e=this.createCore(t);return new S(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function A(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const s=t(i);return void 0!==s?{succeeded:!0,value:s}:{succeeded:!1,value:void 0}}}function T(t){return{custom:e=>A(e)(t),boolean:A((t=>"boolean"==typeof t?t:void 0))(t),number:A((t=>"number"==typeof t?t:void 0))(t),string:A((t=>"string"==typeof t?t:void 0))(t),function:A((t=>"function"==typeof t?t:void 0))(t),constant:e=>A((t=>t===e?e:void 0))(t),raw:A((t=>t))(t),object:e=>A((t=>{if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce(((i,s)=>{if(void 0===i)return;const n=(0,e[s])(t[s]);return n.succeeded?Object.assign(Object.assign({},i),{[s]:n.value}):void 0}),{})}(t,e);var i}))(t),array:e=>A((t=>{if(Array.isArray(t))return i=e,t.reduce(((t,e)=>{if(void 0===t)return;const s=i(e);return s.succeeded&&void 0!==s.value?[...t,s.value]:void 0}),[]);var i}))(t)}}const k={optional:T(!0),required:T(!1)};function I(t,e){const i=k.required.object(e)(t);return i.succeeded?i.value:void 0}const D=g(""),M={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class R{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((t=>{e.classList.remove(D(void 0,M[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(D(void 0,M[t]))}))})),this.viewProps.handleDispose((()=>{!function(t){t&&t.parentElement&&t.parentElement.removeChild(t)}(e)}))}get parent(){return this.parent_}}const B="http://www.w3.org/2000/svg";function $(t){t.offsetHeight}function F(t){return void 0!==t.ontouchstart}function L(){return new Function("return this")().document}const O={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function V(t,e){const i=t.createElementNS(B,"svg");return i.innerHTML=O[e],i}function z(t,e,i){t.insertBefore(e,t.children[i])}function U(t){t.parentElement&&t.parentElement.removeChild(t)}function N(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function H(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}const j=g("lbl");class W{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(j()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(j("l")),f(e.props,"label",(e=>{o(e)?this.element.classList.add(j(void 0,"nol")):(this.element.classList.remove(j(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){const i=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,s)=>{s>0&&i.appendChild(t.createElement("br")),i.appendChild(e)})),i}(t,e)))})),this.element.appendChild(i),this.labelElement=i;const s=t.createElement("div");s.classList.add(j("v")),this.element.appendChild(s),this.valueElement=s}}class G extends R{constructor(t,e){const i=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new W(t,{props:e.props,viewProps:i}),viewProps:i})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const q={id:"button",type:"blade",accept(t){const e=k,i=I(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return i?{params:i}:null},controller:t=>new G(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:new y(t.document,{props:S.fromObject({title:t.params.title}),viewProps:t.viewProps})}),api:t=>t.controller instanceof G&&t.controller.valueController instanceof y?new d(t.controller):null};class K extends R{constructor(t){super(t),this.value=t.value}}function X(){return new S({positions:E([],{equals:a})})}class Y extends S{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=S.createCore(e);return new Y(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!o(t)?`${t}px`:"auto"}bindExpandedClass(t,e){f(this,"expanded",(()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)}))}}function Z(t,e){e.style.height=t.styleHeight}function Q(t,e){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),o(t.get("expandedHeight"))&&t.set("expandedHeight",function(t,e){let i=0;return function(t,e){const i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),$(e),i=e.clientHeight,t.set("temporaryExpanded",null),$(e)})),i}(t,e)),t.set("shouldFixHeight",!0),$(e)})),t.emitter.on("change",(()=>{Z(t,e)})),Z(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&(t.set("shouldFixHeight",!1),t.set("expandedHeight",null),t.set("completed",!0))}))}class J extends e{constructor(t,e){super(t),this.rackApi_=e}}class tt{constructor(t){this.emitter=new u,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw h.shouldNeverHappen();const i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const s=this.extract_(t);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class et extends e{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new u,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new s(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class it extends G{constructor(t,e){super(t,e),this.binding=e.binding}}class st extends e{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new u,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new n(this,e,this.controller_.binding.target.presetKey)})}}class nt extends G{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function rt(t){return t instanceof lt?t.apiSet_:t instanceof J?t.rackApi_.apiSet_:null}function ot(t,e){const i=t.find((t=>t.controller_===e));if(!i)throw h.shouldNeverHappen();return i}function at(t,e,i){if(!c.isBindable(t))throw h.notBindable();return new c(t,e,i)}class lt extends e{constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new u,this.apiSet_=new tt(rt),this.pool_=e;const i=this.controller_.rack;i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),i.emitter.on("inputchange",this.onRackInputChange_),i.emitter.on("monitorupdate",this.onRackMonitorUpdate_),i.children.forEach((t=>{this.setUpApi_(t)}))}get children(){return this.controller_.rack.children.map((t=>ot(this.apiSet_,t)))}addInput(t,e,i){const s=i||{},n=this.controller_.view.element.ownerDocument,r=this.pool_.createInput(n,at(t,e,s.presetKey),s),o=new et(r);return this.add(o,s.index)}addMonitor(t,e,i){const s=i||{},n=this.controller_.view.element.ownerDocument,r=this.pool_.createMonitor(n,at(t,e),s),o=new st(r);return this.add(o,s.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addSeparator(t){return function(t,e){const i=e||{};return t.addBlade(Object.assign(Object.assign({},i),{view:"separator"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const i=this.apiSet_.find((e=>e.controller_===t.controller_));return i&&this.apiSet_.remove(i),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,i=this.pool_.createBlade(e,t),s=this.pool_.createBladeApi(i);return this.add(s,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}setUpApi_(t){this.apiSet_.find((e=>e.controller_===t))||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=ot(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof it){const i=ot(this.apiSet_,e),n=e.binding;this.emitter_.emit("change",{event:new s(i,n.target.read(),n.target.presetKey,t.options.last)})}else if(e instanceof K){const i=ot(this.apiSet_,e);this.emitter_.emit("change",{event:new s(i,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof nt))throw h.shouldNeverHappen();const e=ot(this.apiSet_,t.bladeController),i=t.bladeController.binding;this.emitter_.emit("update",{event:new n(e,i.target.read(),i.target.presetKey)})}}class ht extends J{constructor(t,e){super(t,new lt(t.rackController,e)),this.emitter_=new u,this.controller_.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",{event:new r(this,t.sender.rawValue)})})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,i){return this.rackApi_.addInput(t,e,i)}addMonitor(t,e,i){return this.rackApi_.addMonitor(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}}class ct extends R{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class dt{constructor(t,e){const i=g(e.viewName);this.element=t.createElement("div"),this.element.classList.add(i()),e.viewProps.bindClassModifiers(this.element)}}function ut(t){return t instanceof _t?t.rack:t instanceof ct?t.rackController.rack:null}function pt(t){const e=ut(t);return e?e.bcSet_:null}class gt{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new u,this.blade_=null!=t?t:null,null===(e=this.blade_)||void 0===e||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new tt(pt),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter((e=>e instanceof t))}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),i instanceof it)i.binding.emitter.on("change",this.onChildInputChange_);else if(i instanceof nt)i.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(i instanceof K)i.value.emitter.on("change",this.onChildValueChange_);else{const t=ut(i);if(t){const e=t.emitter;e.on("layout",this.onDescendantLayout_),e.on("inputchange",this.onDescendantInputChange_),e.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const i=t.item;if(i instanceof it)i.binding.emitter.off("change",this.onChildInputChange_);else if(i instanceof nt)i.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(i instanceof K)i.value.emitter.off("change",this.onChildValueChange_);else{const t=ut(i);if(t){const e=t.emitter;e.off("layout",this.onDescendantLayout_),e.off("inputchange",this.onDescendantInputChange_),e.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach((t=>{const s=[];t===e&&(s.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||s.push("veryfirst")),t===i&&(s.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||s.push("verylast")),t.blade.set("positions",s)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildInputChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s instanceof it&&s.binding===e)return s}return null}(this.find(it),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s instanceof nt&&s.binding===e)return s}return null}(this.find(nt),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const s=t[i];if(s instanceof K&&s.value===e)return s}return null}(this.find(K),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class _t extends R{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new dt(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const i=new gt(e.root?void 0:e.blade);i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.rack=i,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)}))}onRackAdd_(t){t.isRoot&&z(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&U(t.bladeController.view.element)}}const mt=g("cnt");class ft{constructor(t,e){this.className_=g(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),mt()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),f(this.foldable_,"completed",v(this.element,this.className_(void 0,"cpl")));const i=t.createElement("button");i.classList.add(this.className_("b")),f(e.props,"title",(t=>{o(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(this.className_("t")),b(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;const n=t.createElement("div");n.classList.add(this.className_("m")),this.buttonElement.appendChild(n);const r=e.containerElement;r.classList.add(this.className_("c")),this.element.appendChild(r),this.containerElement=r}}class vt extends ct{constructor(t,e){var i;const s=Y.create(null===(i=e.expanded)||void 0===i||i),n=new _t(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:n,view:new ft(t,{containerElement:n.view.element,foldable:s,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=s,Q(this.foldable,this.view.containerElement),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const bt={id:"folder",type:"blade",accept(t){const e=k,i=I(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return i?{params:i}:null},controller:t=>new vt(t.document,{blade:t.blade,expanded:t.params.expanded,props:S.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof vt?new ht(t.controller,t.pool):null};class wt extends K{constructor(t,e){const i=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new W(t,{props:e.props,viewProps:i}),viewProps:i})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class xt extends e{}const yt=g("spr");class Ct{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(yt()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("hr");i.classList.add(yt("r")),this.element.appendChild(i)}}class Pt extends R{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Ct(t,{viewProps:e.viewProps})}))}}const Et={id:"separator",type:"blade",accept(t){const e=I(t,{view:k.required.constant("separator")});return e?{params:e}:null},controller:t=>new Pt(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof Pt?new xt(t.controller):null},St=g("");function At(t,e){return v(t,St(void 0,e))}class Tt extends S{constructor(t){super(t)}static create(t){var e,i;const s=null!=t?t:{},n={disabled:null!==(e=s.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=s.hidden)&&void 0!==i&&i},r=S.createCore(n);return new Tt(r)}bindClassModifiers(t){f(this,"disabled",At(t,"disabled")),f(this,"hidden",At(t,"hidden"))}bindDisabled(t){f(this,"disabled",(e=>{t.disabled=e}))}bindTabIndex(t){f(this,"disabled",(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}}const kt=g("tbi");class It{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(kt()),e.viewProps.bindClassModifiers(this.element),f(e.props,"selected",(t=>{t?this.element.classList.add(kt(void 0,"sel")):this.element.classList.remove(kt(void 0,"sel"))}));const i=t.createElement("button");i.classList.add(kt("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(kt("t")),b(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class Dt{constructor(t,e){this.emitter=new u,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new It(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Mt{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Dt(t,{props:e.itemProps,viewProps:Tt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new _t(t,{blade:X(),viewProps:Tt.create()}),this.props=e.props,f(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.contentController.viewProps.set("hidden",!t)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Rt{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return null!==(t=this.controller_.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,i){return this.rackApi_.addInput(t,e,i)}addMonitor(t,e,i){return this.rackApi_.addMonitor(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class Bt extends J{constructor(t,e){super(t,new lt(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new u,this.pageApiMap_=new Map,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})})),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((t=>{this.setUpPageApi_(t)}))}get pages(){return this.controller_.pageSet.items.map((t=>{const e=this.pageApiMap_.get(t);if(!e)throw h.shouldNeverHappen();return e}))}addPage(t){const e=this.controller_.view.element.ownerDocument,i=new Mt(e,{itemProps:S.fromObject({selected:!1,title:t.title}),props:S.fromObject({selected:!1})});this.controller_.add(i,t.index);const s=this.pageApiMap_.get(i);if(!s)throw h.shouldNeverHappen();return s}removePage(t){this.controller_.remove(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find((e=>e.controller_===t.contentController));if(!e)throw h.shouldNeverHappen();const i=new Rt(t,e);this.pageApiMap_.set(t,i)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw h.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const $t=g("tab");class Ft{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add($t(),mt()),e.viewProps.bindClassModifiers(this.element),m(e.empty,v(this.element,$t(void 0,"nop")));const i=t.createElement("div");i.classList.add($t("i")),this.element.appendChild(i),this.itemsElement=i;const s=e.contentsElement;s.classList.add($t("c")),this.element.appendChild(s),this.contentsElement=s}}class Lt extends ct{constructor(t,e){const i=new _t(t,{blade:e.blade,viewProps:e.viewProps}),s=E(!0);super({blade:e.blade,rackController:i,view:new Ft(t,{contentsElement:i.view.element,empty:s,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new tt((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=s,this.applyPages_()}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,null!=e?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}onPageAdd_(t){const e=t.item;z(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const e=t.item;U(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(0===this.pageSet_.items.length)return;const t=this.pageSet_.items.findIndex((t=>t.props.get("selected")));t<0?this.pageSet_.items.forEach(((t,e)=>{t.props.set("selected",0===e)})):this.pageSet_.items.forEach(((e,i)=>{e.props.set("selected",i===t)}))}onPageSelectedChange_(t){if(t.rawValue){const e=this.pageSet_.items.findIndex((e=>e.props.value("selected")===t.sender));this.pageSet_.items.forEach(((t,i)=>{t.props.set("selected",i===e)}))}else this.keepSelection_()}}const Ot={id:"tab",type:"blade",accept(t){const e=k,i=I(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return i&&0!==i.pages.length?{params:i}:null},controller(t){const e=new Lt(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((i=>{const s=new Mt(t.document,{itemProps:S.fromObject({selected:!1,title:i.title}),props:S.fromObject({selected:!1})});e.add(s)})),e},api:t=>t.controller instanceof Lt?new Bt(t.controller,t.pool):null};class Vt{constructor(){this.disabled=!1,this.emitter=new u}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class zt{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new u,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ut{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function Nt(t,e){if(t instanceof e)return t;if(t instanceof Ut){const i=t.constraints.reduce(((t,i)=>t||(i instanceof e?i:null)),null);if(i)return i}return null}class Ht{constructor(t){this.options=t}constrain(t){const e=this.options;return 0===e.length||e.filter((e=>e.value===t)).length>0?t:e[0].value}}class jt{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let e=t;return o(this.minValue)||(e=Math.max(e,this.minValue)),o(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}class Wt{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const Gt=g("lst");class qt{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Gt()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(Gt("s")),f(this.props_,"options",(e=>{N(i),e.forEach(((e,s)=>{const n=t.createElement("option");n.dataset.index=String(s),n.textContent=e.text,n.value=String(e.value),i.appendChild(n)}))})),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=t.createElement("div");s.classList.add(Gt("m")),s.appendChild(V(t,"dropdown")),this.element.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Kt{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new qt(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget.selectedOptions.item(0);if(!e)return;const i=Number(e.dataset.index);this.value.rawValue=this.props.get("options")[i].value}}const Xt=g("pop");class Yt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Xt()),e.viewProps.bindClassModifiers(this.element),m(e.shows,v(this.element,Xt(void 0,"v")))}}class Zt{constructor(t,e){this.shows=E(!1),this.viewProps=e.viewProps,this.view=new Yt(t,{shows:this.shows,viewProps:this.viewProps})}}const Qt=g("txt");class Jt{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Qt()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(Qt("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class te{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Jt(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);o(i)||(this.value.rawValue=i),this.view.refresh()}}function ee(t){return"false"!==t&&!!t}function ie(t){return function(t){return String(t)}(t)}class se{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const ne={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class re{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=ne[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const oe={"+":t=>t,"-":t=>-t,"~":t=>~t};class ae{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=oe[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function le(t){return(e,i)=>{for(let s=0;s<t.length;s++){const n=t[s](e,i);if(""!==n)return n}return""}}function he(t,e){var i;const s=t.substr(e).match(/^\s+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function ce(t,e){var i;const s=t.substr(e).match(/^[0-9]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}function de(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const s=function(t,e){const i=ce(t,e);if(""!==i)return i;const s=t.substr(e,1);if("-"!==s&&"+"!==s)return"";const n=ce(t,e+=1);return""===n?"":s+n}(t,e);return""===s?"":i+s}function ue(t,e){const i=t.substr(e,1);if("0"===i)return i;const s=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=s.length,""===s?"":s+ce(t,e)}const pe=le([function(t,e){const i=ue(t,e);if(e+=i.length,""===i)return"";const s=t.substr(e,1);if(e+=s.length,"."!==s)return"";const n=ce(t,e);return i+s+n+de(t,e+=n.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=ce(t,e);return e+=s.length,""===s?"":i+s+de(t,e)},function(t,e){const i=ue(t,e);return e+=i.length,""===i?"":i+de(t,e)}]),ge=le([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[01]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-7]+/);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const s=function(t,e){var i;const s=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=s&&s[0])&&void 0!==i?i:""}(t,e);return""===s?"":i+s}]),_e=le([ge,pe]);function me(t,e){return function(t,e){const i=_e(t,e);return e+=i.length,""===i?null:{evaluable:new se(i),cursor:e}}(t,e)||function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const s=be(t,e);if(!s)return null;e=s.cursor,e+=he(t,e).length;const n=t.substr(e,1);return e+=n.length,")"!==n?null:{evaluable:s.evaluable,cursor:e}}(t,e)}function fe(t,e,i){i+=he(e,i).length;const s=t.filter((t=>e.startsWith(t,i)))[0];return s?(i+=s.length,{cursor:i+=he(e,i).length,operator:s}):null}const ve=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(i,s)=>{const n=t(i,s);if(!n)return null;s=n.cursor;let r=n.evaluable;for(;;){const n=fe(e,i,s);if(!n)break;s=n.cursor;const o=t(i,s);if(!o)return null;s=o.cursor,r=new re(n.operator,r,o.evaluable)}return r?{cursor:s,evaluable:r}:null}}(t,e)),(function t(e,i){const s=me(e,i);if(s)return s;const n=e.substr(i,1);if(i+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const r=t(e,i);return r?{cursor:i=r.cursor,evaluable:new ae(n,r.evaluable)}:null}));function be(t,e){return e+=he(t,e).length,ve(t,e)}function we(t){var e;const i=function(t){const e=be(t,0);return e?e.cursor+he(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function xe(t){if("number"==typeof t)return t;if("string"==typeof t){const e=we(t);if(!o(e))return e}return 0}function ye(t){return String(t)}function Ce(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}const Pe=Ce(0);function Ee(t){return Pe(t)+"%"}function Se(t){return String(t)}function Ae(t){return t}function Te(t,e){for(;t.length<e;)t.push(void 0)}function ke(t){const e=[];return Te(e,t),E(e)}function Ie(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}function De({primary:t,secondary:e,forward:i,backward:s}){let n=!1;function r(t){n||(n=!0,t(),n=!1)}t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(t,e),s.options)}))})),e.emitter.on("change",(n=>{r((()=>{t.setRawValue(s(t,e),n.options)})),r((()=>{e.setRawValue(i(t,e),n.options)}))})),r((()=>{e.setRawValue(i(t,e),{forceEmit:!1,last:!0})}))}function Me(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function Re(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function Be(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function $e(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function Fe(t,e){const i=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:t.pageX-((i&&i.scrollX||0)+s.left),y:t.pageY-((i&&i.scrollY||0)+s.top)}}class Le{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new u,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Fe(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function Oe(t,e,i,s,n){return s+(t-e)/(i-e)*(n-s)}function Ve(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ze(t,e,i){return Math.min(Math.max(t,e),i)}function Ue(t,e){return(t%e+e)%e}const Ne=g("txt");class He{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Ne(),Ne(void 0,"num")),e.arrayPosition&&this.element.classList.add(Ne(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(Ne("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ne()),this.inputElement.classList.add(Ne("i"));const s=t.createElement("div");s.classList.add(Ne("k")),this.element.appendChild(s),this.knobElement=s;const n=t.createElementNS(B,"svg");n.classList.add(Ne("g")),this.knobElement.appendChild(n);const r=t.createElementNS(B,"path");r.classList.add(Ne("gb")),n.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(B,"path");o.classList.add(Ne("gh")),n.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(g("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(Ne(void 0,"drg"));this.element.classList.add(Ne(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),i=e+(e>0?-1:e<0?1:0),s=ze(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class je{constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=E(null),this.view=new He(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new Le(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);o(i)||(this.value.rawValue=i),this.view.refresh()}onInputKeyDown_(t){const e=Me(this.baseStep_,Re(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Me(this.baseStep_,Re(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const We=g("sld");class Ge{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(We()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(We("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=t.createElement("div");s.classList.add(We("k")),this.trackElement.appendChild(s),this.knobElement=s,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=ze(Oe(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class qe{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Ge(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Le(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Oe(ze(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Me(this.baseStep_,Be(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Me(this.baseStep_,Be(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ke=g("sldtxt");class Xe{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ke());const i=t.createElement("div");i.classList.add(Ke("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Ke("t")),this.textView_=e.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Ye{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new qe(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new je(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps}),this.view=new Xe(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Ze(t,e){t.write(e)}function Qe(t){const e=k;return Array.isArray(t)?e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value:"object"==typeof t?e.required.raw(t).value:void 0}function Je(t){if("inline"===t||"popup"===t)return t}function ti(t){const e=k;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function ei(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((i=>{e.push({text:i,value:t[i]})})),e}function ii(t){return o(t)?null:new Ht(ei(t))}function si(t){const e=t?Nt(t,Ht):null;return e?e.options:null}function ni(t,e){const i=t&&Nt(t,Wt);return i?Ve(i.step):Math.max(Ve(e),2)}function ri(t){const e=function(t){const e=t?Nt(t,Wt):null;return e?e.step:null}(t);return null!=e?e:1}function oi(t,e){var i;const s=t&&Nt(t,Wt),n=Math.abs(null!==(i=null==s?void 0:s.step)&&void 0!==i?i:e);return 0===n?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}const ai=g("ckb");class li{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ai()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(ai("l")),this.element.appendChild(i);const s=t.createElement("input");s.classList.add(ai("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,e.viewProps.bindDisabled(this.inputElement);const n=t.createElement("div");n.classList.add(ai("w")),i.appendChild(n);const r=V(t,"check");n.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class hi{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new li(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}const ci={id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=I(e,{options:k.optional.custom(Qe)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>ee,constraint:t=>function(t){const e=[],i=ii(t.options);return i&&e.push(i),new Ut(e)}(t.params),writer:t=>Ze},controller:t=>{var e;const i=t.document,s=t.value,n=t.constraint;return n&&Nt(n,Ht)?new Kt(i,{props:S.fromObject({options:null!==(e=si(n))&&void 0!==e?e:[]}),value:s,viewProps:t.viewProps}):new hi(i,{value:s,viewProps:t.viewProps})}},di=g("col");class ui{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(di()),e.foldable.bindExpandedClass(this.element,di(void 0,"expanded")),f(e.foldable,"completed",v(this.element,di(void 0,"cpl")));const i=t.createElement("div");i.classList.add(di("h")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(di("s")),i.appendChild(s),this.swatchElement=s;const n=t.createElement("div");if(n.classList.add(di("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(di("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function pi(t,e,i){const s=Ue(t,360),n=ze(e/100,0,1),r=ze(i/100,0,1),o=r*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o;let h,c,d;return[h,c,d]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(c+l),255*(d+l)]}function gi(t){return[t[0],t[1],t[2]]}function _i(t,e){return[t[0],t[1],t[2],e]}const mi={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){const s=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==s?e*(100-Math.abs(2*i-100))/s:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){const s=(t%360+360)%360,n=ze(e/100,0,1),r=ze(i/100,0,1),o=(1-Math.abs(2*r-1))*n,a=o*(1-Math.abs(s/60%2-1)),l=r-o/2;let h,c,d;return[h,c,d]=s>=0&&s<60?[o,a,0]:s>=60&&s<120?[a,o,0]:s>=120&&s<180?[0,o,a]:s>=180&&s<240?[0,a,o]:s>=240&&s<300?[a,0,o]:[o,0,a],[255*(h+l),255*(c+l),255*(d+l)]}},hsv:{hsl:function(t,e,i){const s=100-Math.abs(i*(200-e)/100-100);return[t,0!==s?e*i/s:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:pi},rgb:{hsl:function(t,e,i){const s=ze(t/255,0,1),n=ze(e/255,0,1),r=ze(i/255,0,1),o=Math.max(s,n,r),a=Math.min(s,n,r),l=o-a;let h=0,c=0;const d=(a+o)/2;return 0!==l&&(c=l/(1-Math.abs(o+a-1)),h=s===o?(n-r)/l:n===o?2+(r-s)/l:4+(s-n)/l,h=h/6+(h<0?1:0)),[360*h,100*c,100*d]},hsv:function(t,e,i){const s=ze(t/255,0,1),n=ze(e/255,0,1),r=ze(i/255,0,1),o=Math.max(s,n,r),a=o-Math.min(s,n,r);let l;return l=0===a?0:o===s?((n-r)/a%6+6)%6*60:o===n?60*((r-s)/a+2):60*((s-n)/a+4),[l,100*(0===o?0:a/o),100*o]},rgb:(t,e,i)=>[t,e,i]}},fi={hsl:t=>{var e;return[Ue(t[0],360),ze(t[1],0,100),ze(t[2],0,100),ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},hsv:t=>{var e;return[Ue(t[0],360),ze(t[1],0,100),ze(t[2],0,100),ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},rgb:t=>{var e;return[ze(t[0],0,255),ze(t[1],0,255),ze(t[2],0,255),ze(null!==(e=t[3])&&void 0!==e?e:1,0,1)]}};function vi(t,e){return"object"==typeof t&&!o(t)&&e in t&&"number"==typeof t[e]}class bi{constructor(t,e){this.mode_=e,this.comps_=fi[e](t)}static black(){return new bi([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new bi(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return vi(t,"r")&&vi(t,"g")&&vi(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&vi(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return!1;const i=t.comps_,s=e.comps_;for(let t=0;t<i.length;t++)if(i[t]!==s[t])return!1;return!0}get mode(){return this.mode_}getComponents(t){var e,i,s;return _i((e=gi(this.comps_),i=this.mode_,s=t||this.mode_,mi[i][s](...e)),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const wi=g("colp");class xi{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(wi());const i=t.createElement("div");i.classList.add(wi("hsv"));const s=t.createElement("div");s.classList.add(wi("sv")),this.svPaletteView_=e.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(wi("h")),this.hPaletteView_=e.hPaletteView,n.appendChild(this.hPaletteView_.element),i.appendChild(n),this.element.appendChild(i);const r=t.createElement("div");if(r.classList.add(wi("rgb")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const i=t.createElement("div");i.classList.add(wi("a"));const s=t.createElement("div");s.classList.add(wi("ap")),s.appendChild(this.alphaViews_.palette.element),i.appendChild(s);const n=t.createElement("div");n.classList.add(wi("at")),n.appendChild(this.alphaViews_.text.element),i.appendChild(n),this.element.appendChild(i)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function yi(t){const e=k;return I(t,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(Je)})}function Ci(t){return t?.1:1}function Pi(t,e){const i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const Ei={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Si(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const i=parseFloat(e[1]),s=e[2];return Ei[s](i)}const Ai={"func.rgb":t=>{const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Pi(e[1],255),Pi(e[2],255),Pi(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:new bi(i,"rgb")},"func.rgba":t=>{const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Pi(e[1],255),Pi(e[2],255),Pi(e[3],255),Pi(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:new bi(i,"rgb")},"func.hsl":t=>{const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Si(e[1]),Pi(e[2],100),Pi(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:new bi(i,"hsl")},"func.hsla":t=>{const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Si(e[1]),Pi(e[2],100),Pi(e[3],100),Pi(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:new bi(i,"hsl")},"hex.rgb":t=>{const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new bi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");const i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?new bi([parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)],"rgb"):null},"hex.rgba":t=>{const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new bi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Oe(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");const i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?new bi([parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),Oe(parseInt(i[4],16),0,255,0,1)],"rgb"):null}};function Ti(t){return Object.keys(Ai).reduce(((e,i)=>e||((0,Ai[i])(t)?i:null)),null)}const ki=t=>{const e=Ti(t);return e?Ai[e](t):null};function Ii(t){return"func.hsla"===t||"func.rgba"===t||"hex.rgba"===t}function Di(t){if("string"==typeof t){const e=ki(t);if(e)return e}return bi.black()}function Mi(t){const e=ze(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function Ri(t,e="#"){return`${e}${gi(t.getComponents("rgb")).map(Mi).join("")}`}function Bi(t,e="#"){const i=t.getComponents("rgb");return`${e}${[i[0],i[1],i[2],255*i[3]].map(Mi).join("")}`}function $i(t){const e=Ce(0);return`rgb(${gi(t.getComponents("rgb")).map((t=>e(t))).join(", ")})`}function Fi(t){const e=Ce(2),i=Ce(0);return`rgba(${t.getComponents("rgb").map(((t,s)=>(3===s?e:i)(t))).join(", ")})`}const Li={"func.hsl":function(t){const e=[Ce(0),Ee,Ee];return`hsl(${gi(t.getComponents("hsl")).map(((t,i)=>e[i](t))).join(", ")})`},"func.hsla":function(t){const e=[Ce(0),Ee,Ee,Ce(2)];return`hsla(${t.getComponents("hsl").map(((t,i)=>e[i](t))).join(", ")})`},"func.rgb":$i,"func.rgba":Fi,"hex.rgb":Ri,"hex.rgba":Bi};function Oi(t){return Li[t]}const Vi=g("apl");class zi{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Vi()),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Vi("b")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Vi("c")),i.appendChild(s),this.colorElem_=s;const n=t.createElement("div");n.classList.add(Vi("m")),this.element.appendChild(n),this.markerElem_=n;const r=t.createElement("div");r.classList.add(Vi("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new bi([e[0],e[1],e[2],0],"rgb"),s=new bi([e[0],e[1],e[2],255],"rgb"),n=["to right",Fi(i),Fi(s)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=Fi(t);const r=Oe(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class Ui{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new zi(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Le(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,s=this.value.rawValue,[n,r,o]=s.getComponents("hsv");this.value.setRawValue(new bi([n,r,o,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Me(Ci(!0),Be(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new bi([s,n,r,o+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Me(Ci(!0),Be(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ni=g("coltxt");class Hi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ni());const i=t.createElement("div");i.classList.add(Ni("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(((e,i)=>{const s=t.createElement("option");return s.textContent=i.text,s.value=i.value,e.appendChild(s),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(Ni("ms")),i.appendChild(this.modeSelectElement);const s=t.createElement("div");s.classList.add(Ni("mm")),s.appendChild(V(t,"dropdown")),i.appendChild(s),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(Ni("w")),this.element.appendChild(n),this.textsElem_=n,this.textViews_=e.textViews,this.applyTextViews_(),m(e.colorMode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){N(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach((e=>{const i=t.createElement("div");i.classList.add(Ni("c")),i.appendChild(e.element),this.textsElem_.appendChild(i)}))}}const ji=Ce(0),Wi={rgb:()=>new jt({min:0,max:255}),hsl:t=>new jt(0===t?{min:0,max:360}:{min:0,max:100}),hsv:t=>new jt(0===t?{min:0,max:360}:{min:0,max:100})};function Gi(t,e,i){return new je(t,{arrayPosition:0===i?"fst":2===i?"lst":"mid",baseStep:Ci(!1),parser:e.parser,props:S.fromObject({draggingScale:1,formatter:ji}),value:E(0,{constraint:Wi[e.colorMode](i)}),viewProps:e.viewProps})}class qi{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=E(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Hi(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},i=[Gi(t,e,0),Gi(t,e,1),Gi(t,e,2)];return i.forEach(((t,e)=>{De({primary:this.value,secondary:t.value,forward:t=>t.rawValue.getComponents(this.colorMode.rawValue)[e],backward:(t,i)=>{const s=this.colorMode.rawValue,n=t.rawValue.getComponents(s);return n[e]=i.rawValue,new bi(_i(gi(n),n[3]),s)}})})),i}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Ki=g("hpl");class Xi{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ki()),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Ki("c")),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Ki("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=$i(new bi([e,100,100],"hsv"));const i=Oe(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Yi{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Xi(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Le(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Oe(t.point.x,0,t.bounds.width,0,360),s=this.value.rawValue,[,n,r,o]=s.getComponents("hsv");this.value.setRawValue(new bi([i,n,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Me(Ci(!1),Be(t));if(0===e)return;const i=this.value.rawValue,[s,n,r,o]=i.getComponents("hsv");this.value.setRawValue(new bi([s+e,n,r,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Me(Ci(!1),Be(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Zi=g("svp");class Qi{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Zi()),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(Zi("c")),this.element.appendChild(i),this.canvasElement=i;const s=t.createElement("div");s.classList.add(Zi("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d"):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,n=t.getImageData(0,0,i,s),r=n.data;for(let t=0;t<s;t++)for(let n=0;n<i;n++){const o=Oe(n,0,i,0,100),a=Oe(t,0,s,100,0),l=pi(e[0],o,a),h=4*(t*i+n);r[h]=l[0],r[h+1]=l[1],r[h+2]=l[2],r[h+3]=255}t.putImageData(n,0,0);const o=Oe(e[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Oe(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Ji{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Qi(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Le(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Oe(t.point.x,0,t.bounds.width,0,100),s=Oe(t.point.y,0,t.bounds.height,100,0),[n,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new bi([n,i,s,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){$e(t.key)&&t.preventDefault();const[e,i,s,n]=this.value.rawValue.getComponents("hsv"),r=Ci(!1),o=Me(r,Be(t)),a=Me(r,Re(t));0===o&&0===a||this.value.setRawValue(new bi([e,i+o,s+a,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Ci(!1),i=Me(e,Be(t)),s=Me(e,Re(t));0===i&&0===s||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ts{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Yi(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ji(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Ui(t,{value:this.value,viewProps:this.viewProps}),text:new je(t,{parser:we,baseStep:.1,props:S.fromObject({draggingScale:.01,formatter:Ce(2)}),value:E(0,{constraint:new jt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&De({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.rawValue.getComponents()[3],backward:(t,e)=>{const i=t.rawValue.getComponents();return i[3]=e.rawValue,new bi(i,t.rawValue.mode)}}),this.textC_=new qi(t,{parser:we,value:this.value,viewProps:this.viewProps}),this.view=new xi(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const es=g("colsw");class is{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(es()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(es("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=t.createElement("button");s.classList.add(es("b")),e.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Bi(t)}onValueChange_(){this.update_()}}class ss{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new is(t,{value:this.value,viewProps:this.viewProps})}}class ns{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Y.create(e.expanded),this.swatchC_=new ss(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new te(t,{parser:e.parser,props:S.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ui(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Zt(t,{viewProps:this.viewProps}):null;const s=new ts(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),De({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Q(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=H(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!F(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function rs(t){return bi.isColorObject(t)?bi.fromObject(t):bi.black()}function os(t){return gi(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function as(t){return t.getComponents("rgb").reduce(((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e)),0)>>>0}function ls(t){var e;return"number"!=typeof t?bi.black():new bi([(e=t)>>16&255,e>>8&255,255&e],"rgb")}function hs(t){var e;return"number"!=typeof t?bi.black():new bi([(e=t)>>24&255,e>>16&255,e>>8&255,Oe(255&e,0,255,0,1)],"rgb")}function cs(t,e){const i=e.toRgbaObject();t.writeProperty("r",i.r),t.writeProperty("g",i.g),t.writeProperty("b",i.b),t.writeProperty("a",i.a)}function ds(t,e){const i=e.toRgbaObject();t.writeProperty("r",i.r),t.writeProperty("g",i.g),t.writeProperty("b",i.b)}function us(t){return"alpha"in t&&!0===t.alpha}function ps(t){return t?t=>Bi(t,"0x"):t=>Ri(t,"0x")}const gs={id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!("view"in e))return null;if("color"!==e.view)return null;const i=yi(e);return i?{initialValue:t,params:i}:null},binding:{reader:t=>us(t.params)?hs:ls,equals:bi.equals,writer:t=>function(t){const e=t?as:os;return(t,i)=>{Ze(t,e(i))}}(us(t.params))},controller:t=>{const e=us(t.params),i="expanded"in t.params?t.params.expanded:void 0,s="picker"in t.params?t.params.picker:void 0;return new ns(t.document,{expanded:null!=i&&i,formatter:ps(e),parser:ki,pickerLayout:null!=s?s:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},_s={id:"input-color-object",type:"input",accept:(t,e)=>{if(!bi.isColorObject(t))return null;const i=yi(e);return i?{initialValue:t,params:i}:null},binding:{reader:t=>rs,equals:bi.equals,writer:t=>{var e;return e=t.initialValue,bi.isRgbaColorObject(e)?cs:ds}},controller:t=>{const e=bi.isRgbaColorObject(t.initialValue),i="expanded"in t.params?t.params.expanded:void 0,s="picker"in t.params?t.params.picker:void 0,n=e?Bi:Ri;return new ns(t.document,{expanded:null!=i&&i,formatter:n,parser:ki,pickerLayout:null!=s?s:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},ms={id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("view"in e&&"text"===e.view)return null;if(!Ti(t))return null;const i=yi(e);return i?{initialValue:t,params:i}:null},binding:{reader:t=>Di,equals:bi.equals,writer:t=>{const e=Ti(t.initialValue);if(!e)throw h.shouldNeverHappen();return function(t){const e=Oi(t);return(t,i)=>{Ze(t,e(i))}}(e)}},controller:t=>{const e=Ti(t.initialValue);if(!e)throw h.shouldNeverHappen();const i=Oi(e),s="expanded"in t.params?t.params.expanded:void 0,n="picker"in t.params?t.params.picker:void 0;return new ns(t.document,{expanded:null!=s&&s,formatter:i,parser:ki,pickerLayout:null!=n?n:"popup",supportsAlpha:Ii(e),value:t.value,viewProps:t.viewProps})}};class fs{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var i,s;return null!==(s=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==s?s:t}));return this.asm_.fromComponents(e)}}const vs=g("pndtxt");class bs{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(vs()),this.textViews.forEach((e=>{const i=t.createElement("div");i.classList.add(vs("a")),i.appendChild(e.element),this.element.appendChild(i)}))}}class ws{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((i,s)=>function(t,e,i){return new je(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",baseStep:e.axes[i].baseStep,parser:e.parser,props:e.axes[i].textProps,value:E(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,s))),this.acs_.forEach(((t,i)=>{De({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[i],backward:(t,s)=>{const n=e.assembly.toComponents(t.rawValue);return n[i]=s.rawValue,e.assembly.fromComponents(n)}})})),this.view=new bs(t,{textViews:this.acs_.map((t=>t.view))})}}function xs(t){const e=[],i=function(t){return"step"in t&&!o(t.step)?new Wt(t.step):null}(t);i&&e.push(i);const s=function(t){return"max"in t&&!o(t.max)||"min"in t&&!o(t.min)?new jt({max:t.max,min:t.min}):null}(t);s&&e.push(s);const n=ii(t.options);return n&&e.push(n),new Ut(e)}function ys(t){const[e,i]=function(t){const e=t?Nt(t,jt):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}(t);return[null!=e?e:0,null!=i?i:100]}const Cs={id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const i=k,s=I(e,{format:i.optional.function,max:i.optional.number,min:i.optional.number,options:i.optional.custom(Qe),step:i.optional.number});return s?{initialValue:t,params:s}:null},binding:{reader:t=>xe,constraint:t=>xs(t.params),writer:t=>Ze},controller:t=>{var e,i;const s=t.value,n=t.constraint;if(n&&Nt(n,Ht))return new Kt(t.document,{props:S.fromObject({options:null!==(e=si(n))&&void 0!==e?e:[]}),value:s,viewProps:t.viewProps});const r=null!==(i="format"in t.params?t.params.format:void 0)&&void 0!==i?i:Ce(ni(n,s.rawValue));if(n&&Nt(n,jt)){const[e,i]=ys(n);return new Ye(t.document,{baseStep:ri(n),parser:we,sliderProps:S.fromObject({maxValue:i,minValue:e}),textProps:S.fromObject({draggingScale:oi(n,s.rawValue),formatter:r}),value:s,viewProps:t.viewProps})}return new je(t.document,{baseStep:ri(n),parser:we,props:S.fromObject({draggingScale:oi(n,s.rawValue),formatter:r}),value:s,viewProps:t.viewProps})}};class Ps{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(o(t))return!1;const e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Es={toComponents:t=>t.getComponents(),fromComponents:t=>new Ps(...t)},Ss=g("p2d");class As{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ss()),e.viewProps.bindClassModifiers(this.element),m(e.expanded,v(this.element,Ss(void 0,"expanded")));const i=t.createElement("div");i.classList.add(Ss("h")),this.element.appendChild(i);const s=t.createElement("button");s.classList.add(Ss("b")),s.appendChild(V(t,"p2dpad")),e.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const n=t.createElement("div");if(n.classList.add(Ss("t")),i.appendChild(n),this.textElement=n,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ss("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Ts=g("p2dp");class ks{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Ts()),"popup"===e.layout&&this.element.classList.add(Ts(void 0,"p"));const i=t.createElement("div");i.classList.add(Ts("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=t.createElementNS(B,"svg");s.classList.add(Ts("g")),this.padElement.appendChild(s),this.svgElem_=s;const n=t.createElementNS(B,"line");n.classList.add(Ts("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);const r=t.createElementNS(B,"line");r.classList.add(Ts("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const o=t.createElementNS(B,"line");o.classList.add(Ts("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=t.createElement("div");a.classList.add(Ts("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.maxValue_,s=Oe(t,-i,+i,0,100),n=Oe(e,-i,+i,0,100),r=this.invertsY_?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Is(t,e,i){return[Me(e[0],Be(t)),Me(e[1],Re(t))*(i?1:-1)]}class Ds{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new ks(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Le(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.maxValue_,s=Oe(t.point.x,0,t.bounds.width,-i,+i),n=Oe(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new Ps(s,n),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){$e(t.key)&&t.preventDefault();const[e,i]=Is(t,this.baseSteps_,this.invertsY_);0===e&&0===i||this.value.setRawValue(new Ps(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=Is(t,this.baseSteps_,this.invertsY_);0===e&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ms{constructor(t,e){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Y.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Zt(t,{viewProps:this.viewProps}):null;const n=new Ds(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.textC_=new ws(t,{assembly:Es,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new As(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(s=this.view.buttonElement)||void 0===s||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),De({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Q(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=H(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!F(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function Rs(t){return Ps.isObject(t)?new Ps(t.x,t.y):new Ps}function Bs(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function $s(t){if(!t)return;const e=[];return o(t.step)||e.push(new Wt(t.step)),o(t.max)&&o(t.min)||e.push(new jt({max:t.max,min:t.min})),new Ut(e)}function Fs(t,e){const i=t&&Nt(t,jt);if(i)return Math.max(Math.abs(i.minValue||0),Math.abs(i.maxValue||0));const s=ri(t);return Math.max(10*Math.abs(s),10*Math.abs(e))}function Ls(t,e){const i=e instanceof fs?e.components[0]:void 0,s=e instanceof fs?e.components[1]:void 0,n=Fs(i,t.x),r=Fs(s,t.y);return Math.max(n,r)}function Os(t,e){return{baseStep:ri(e),constraint:e,textProps:S.fromObject({draggingScale:oi(e,t),formatter:Ce(ni(e,t))})}}function Vs(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const zs={id:"input-point2d",type:"input",accept:(t,e)=>{if(!Ps.isObject(t))return null;const i=k,s=I(e,{expanded:i.optional.boolean,picker:i.optional.custom(Je),x:i.optional.custom(ti),y:i.optional.object({inverted:i.optional.boolean,max:i.optional.number,min:i.optional.number,step:i.optional.number})});return s?{initialValue:t,params:s}:null},binding:{reader:t=>Rs,constraint:t=>{var e;return e=t.params,new fs({assembly:Es,components:[$s("x"in e?e.x:void 0),$s("y"in e?e.y:void 0)]})},equals:Ps.equals,writer:t=>Bs},controller:t=>{const e=t.document,i=t.value,s=t.constraint;if(!(s instanceof fs))throw h.shouldNeverHappen();const n="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0;return new Ms(e,{axes:[Os(i.rawValue.x,s.components[0]),Os(i.rawValue.y,s.components[1])],expanded:null!=n&&n,invertsY:Vs(t.params),maxValue:Ls(i.rawValue,s),parser:we,pickerLayout:null!=r?r:"popup",value:i,viewProps:t.viewProps})}};class Us{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(o(t))return!1;const e=t.x,i=t.y,s=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ns={toComponents:t=>t.getComponents(),fromComponents:t=>new Us(...t)};function Hs(t){return Us.isObject(t)?new Us(t.x,t.y,t.z):new Us}function js(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function Ws(t){if(!t)return;const e=[];return o(t.step)||e.push(new Wt(t.step)),o(t.max)&&o(t.min)||e.push(new jt({max:t.max,min:t.min})),new Ut(e)}function Gs(t,e){return{baseStep:ri(e),constraint:e,textProps:S.fromObject({draggingScale:oi(e,t),formatter:Ce(ni(e,t))})}}const qs={id:"input-point3d",type:"input",accept:(t,e)=>{if(!Us.isObject(t))return null;const i=k,s=I(e,{x:i.optional.custom(ti),y:i.optional.custom(ti),z:i.optional.custom(ti)});return s?{initialValue:t,params:s}:null},binding:{reader:t=>Hs,constraint:t=>{var e;return e=t.params,new fs({assembly:Ns,components:[Ws("x"in e?e.x:void 0),Ws("y"in e?e.y:void 0),Ws("z"in e?e.z:void 0)]})},equals:Us.equals,writer:t=>js},controller:t=>{const e=t.value,i=t.constraint;if(!(i instanceof fs))throw h.shouldNeverHappen();return new ws(t.document,{assembly:Ns,axes:[Gs(e.rawValue.x,i.components[0]),Gs(e.rawValue.y,i.components[1]),Gs(e.rawValue.z,i.components[2])],parser:we,value:e,viewProps:t.viewProps})}};class Ks{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(o(t))return!1;const e=t.x,i=t.y,s=t.z,n=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof s&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Xs={toComponents:t=>t.getComponents(),fromComponents:t=>new Ks(...t)};function Ys(t){return Ks.isObject(t)?new Ks(t.x,t.y,t.z,t.w):new Ks}function Zs(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function Qs(t){if(!t)return;const e=[];return o(t.step)||e.push(new Wt(t.step)),o(t.max)&&o(t.min)||e.push(new jt({max:t.max,min:t.min})),new Ut(e)}const Js={id:"input-point4d",type:"input",accept:(t,e)=>{if(!Ks.isObject(t))return null;const i=k,s=I(e,{x:i.optional.custom(ti),y:i.optional.custom(ti),z:i.optional.custom(ti),w:i.optional.custom(ti)});return s?{initialValue:t,params:s}:null},binding:{reader:t=>Ys,constraint:t=>{var e;return e=t.params,new fs({assembly:Xs,components:[Qs("x"in e?e.x:void 0),Qs("y"in e?e.y:void 0),Qs("z"in e?e.z:void 0),Qs("w"in e?e.w:void 0)]})},equals:Ks.equals,writer:t=>Zs},controller:t=>{const e=t.value,i=t.constraint;if(!(i instanceof fs))throw h.shouldNeverHappen();return new ws(t.document,{assembly:Xs,axes:e.rawValue.getComponents().map(((t,e)=>{var s,n;return s=t,{baseStep:ri(n=i.components[e]),constraint:n,textProps:S.fromObject({draggingScale:oi(n,s),formatter:Ce(ni(n,s))})}})),parser:we,value:e,viewProps:t.viewProps})}},tn={id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const i=I(e,{options:k.optional.custom(Qe)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Se,constraint:t=>function(t){const e=[],i=ii(t.options);return i&&e.push(i),new Ut(e)}(t.params),writer:t=>Ze},controller:t=>{var e;const i=t.document,s=t.value,n=t.constraint;return n&&Nt(n,Ht)?new Kt(i,{props:S.fromObject({options:null!==(e=si(n))&&void 0!==e?e:[]}),value:s,viewProps:t.viewProps}):new te(i,{parser:t=>t,props:S.fromObject({formatter:Ae}),value:s,viewProps:t.viewProps})}},en={defaultInterval:200,defaultLineCount:3},sn=g("mll");class nn{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(sn()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(sn("i")),i.style.height=`calc(var(--bld-us) * ${e.lineCount})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach((t=>{void 0!==t&&i.push(this.formatter_(t))})),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class rn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new nn(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const on=g("sgl");class an{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(on()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(on("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class ln{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new an(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const hn={id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=I(e,{lineCount:k.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>ee},controller:t=>{var e;return 1===t.value.rawValue.length?new ln(t.document,{formatter:ie,value:t.value,viewProps:t.viewProps}):new rn(t.document,{formatter:ie,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:en.defaultLineCount,value:t.value,viewProps:t.viewProps})}};class cn{constructor(){this.emitter=new u,this.index_=-1}get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}const dn=g("grl");class un{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(dn()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(B,"svg");i.classList.add(dn("g")),i.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(i),this.svgElem_=i;const s=t.createElementNS(B,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const n=t.createElement("div");n.classList.add(dn("t"),g("tt")()),this.element.appendChild(n),this.tooltipElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,i=this.minValue_,s=this.maxValue_,n=[];this.value.rawValue.forEach(((r,o)=>{if(void 0===r)return;const a=Oe(o,0,e,0,t.width),l=Oe(r,i,s,t.height,0);n.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",n.join(" "));const r=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0===o)return void r.classList.remove(dn("t","a"));const a=Oe(this.cursor_.index,0,e,0,t.width),l=Oe(o,i,s,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(o)}`,r.classList.contains(dn("t","a"))||(r.classList.add(dn("t","a"),dn("t","in")),$(r),r.classList.remove(dn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class pn{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new cn,this.view=new un(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),F(t)){const t=new Le(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Oe(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.index=Math.floor(Oe(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function gn(t){return"format"in t&&!o(t.format)?t.format:Ce(2)}function _n(t){return"view"in t&&"graph"===t.view}const mn={id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const i=k,s=I(e,{format:i.optional.function,lineCount:i.optional.number,max:i.optional.number,min:i.optional.number,view:i.optional.string});return s?{initialValue:t,params:s}:null},binding:{defaultBufferSize:t=>_n(t)?64:1,reader:t=>xe},controller:t=>_n(t.params)?function(t){var e,i,s;return new pn(t.document,{formatter:gn(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:en.defaultLineCount,maxValue:null!==(i="max"in t.params?t.params.max:null)&&void 0!==i?i:100,minValue:null!==(s="min"in t.params?t.params.min:null)&&void 0!==s?s:0,value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new ln(t.document,{formatter:gn(t.params),value:t.value,viewProps:t.viewProps}):new rn(t.document,{formatter:gn(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:en.defaultLineCount,value:t.value,viewProps:t.viewProps})}(t)},fn={id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const i=k,s=I(e,{lineCount:i.optional.number,multiline:i.optional.boolean});return s?{initialValue:t,params:s}:null},binding:{reader:t=>Se},controller:t=>{var e;const i=t.value;return i.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new rn(t.document,{formatter:Ae,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:en.defaultLineCount,value:i,viewProps:t.viewProps}):new ln(t.document,{formatter:Ae,value:i,viewProps:t.viewProps})}};class vn{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new u,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}class bn{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new u,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(void 0===t)return;const e=this.value.rawValue,i=this.reader_(t);this.value.rawValue=function(t,e){const i=[...Ie(t),e];return i.length>t.length?i.splice(0,i.length-t.length):Te(i,t.length),i}(e,i),this.emitter.emit("update",{rawValue:i,sender:this})}onTick_(t){this.read()}}function wn(t,e){return 0===e?new Vt:new zt(t,null!=e?e:en.defaultInterval)}class xn{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){"blade"===t.type?this.pluginsMap_.blades.unshift(t):"input"===t.type?this.pluginsMap_.inputs.unshift(t):"monitor"===t.type&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,i){if(o(e.read()))throw new h({context:{key:e.key},type:"nomatchingcontroller"});const s=this.pluginsMap_.inputs.reduce(((s,n)=>s||function(t,e){const i=t.accept(e.target.read(),e.params);if(o(i))return null;const s=k,n={target:e.target,initialValue:i.initialValue,params:i.params},r=t.binding.reader(n),a=t.binding.constraint?t.binding.constraint(n):void 0,l=E(r(i.initialValue),{constraint:a,equals:t.binding.equals}),h=new vn({reader:r,target:e.target,value:l,writer:t.binding.writer(n)}),c=s.optional.boolean(e.params.disabled).value,d=s.optional.boolean(e.params.hidden).value,u=t.controller({constraint:a,document:e.document,initialValue:i.initialValue,params:i.params,value:h.value,viewProps:Tt.create({disabled:c,hidden:d})}),p=s.optional.string(e.params.label).value;return new it(e.document,{binding:h,blade:X(),props:S.fromObject({label:p||e.target.key}),valueController:u})}(n,{document:t,target:e,params:i})),null);if(s)return s;throw new h({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,i){const s=this.pluginsMap_.monitors.reduce(((s,n)=>s||function(t,e){var i,s,n;const r=k,a=t.accept(e.target.read(),e.params);if(o(a))return null;const l={target:e.target,initialValue:a.initialValue,params:a.params},h=t.binding.reader(l),c=null!==(s=null!==(i=r.optional.number(e.params.bufferSize).value)&&void 0!==i?i:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(a.params))&&void 0!==s?s:1,d=r.optional.number(e.params.interval).value,u=new bn({reader:h,target:e.target,ticker:wn(e.document,d),value:ke(c)}),p=r.optional.boolean(e.params.disabled).value,g=r.optional.boolean(e.params.hidden).value,_=t.controller({document:e.document,params:a.params,value:u.value,viewProps:Tt.create({disabled:p,hidden:g})}),m=null!==(n=r.optional.string(e.params.label).value)&&void 0!==n?n:e.target.key;return new nt(e.document,{binding:u,blade:X(),props:S.fromObject({label:m}),valueController:_})}(n,{document:t,params:i,target:e})),null);if(s)return s;throw new h({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const i=this.pluginsMap_.blades.reduce(((i,s)=>i||function(t,e){const i=t.accept(e.params);if(!i)return null;const s=k.optional.boolean(e.params.disabled).value,n=k.optional.boolean(e.params.hidden).value;return t.controller({blade:X(),document:e.document,params:Object.assign(Object.assign({},i.params),{disabled:s,hidden:n}),viewProps:Tt.create({disabled:s,hidden:n})})}(s,{document:t,params:e})),null);if(!i)throw new h({type:"nomatchingview",context:{params:e}});return i}createBladeApi(t){if(t instanceof it)return new et(t);if(t instanceof nt)return new st(t);if(t instanceof _t)return new lt(t,this);const e=this.pluginsMap_.blades.reduce(((e,i)=>e||i.api({controller:t,pool:this})),null);if(!e)throw h.shouldNeverHappen();return e}}class yn extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}}class Cn extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}}class Pn extends e{constructor(t){super(t),this.emitter_=new u,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,(t=>{i(t.event)})),this}}const En={id:"list",type:"blade",accept(t){const e=k,i=I(t,{options:e.required.custom(Qe),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return i?{params:i}:null},controller(t){const e=new Kt(t.document,{props:S.fromObject({options:ei(t.params.options)}),value:E(t.params.value),viewProps:t.viewProps});return new wt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:e})},api:t=>t.controller instanceof wt&&t.controller.valueController instanceof Kt?new yn(t.controller):null};class Sn extends ht{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){(function(t,e){t.forEach((t=>{const i=e[t.presetKey];void 0!==i&&t.write(i)}))})(this.controller_.rackController.rack.find(it).map((t=>t.binding.target)),t),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(it).map((t=>t.binding.target)).reduce(((t,e)=>Object.assign(t,{[e.presetKey]:e.read()})),{})}refresh(){this.controller_.rackController.rack.find(it).forEach((t=>{t.binding.read()})),this.controller_.rackController.rack.find(nt).forEach((t=>{t.binding.read()}))}}class An extends vt{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Tn={id:"slider",type:"blade",accept(t){const e=k,i=I(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return i?{params:i}:null},controller(t){var e,i;const s=null!==(e=t.params.value)&&void 0!==e?e:0,n=new Ye(t.document,{baseStep:1,parser:we,sliderProps:S.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:S.fromObject({draggingScale:oi(void 0,s),formatter:null!==(i=t.params.format)&&void 0!==i?i:ye}),value:E(s),viewProps:t.viewProps});return new wt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:n})},api:t=>t.controller instanceof wt&&t.controller.valueController instanceof Ye?new Cn(t.controller):null},kn={id:"text",type:"blade",accept(t){const e=k,i=I(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return i?{params:i}:null},controller(t){var e;const i=new te(t.document,{parser:t.params.parse,props:S.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:E(t.params.value),viewProps:t.viewProps});return new wt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:i})},api:t=>t.controller instanceof wt&&t.controller.valueController instanceof te?new Pn(t.controller):null};function In(t,e,i){if(t.querySelector(`style[data-tp-style=${e}]`))return;const s=t.createElement("style");s.dataset.tpStyle=e,s.textContent=i,t.head.appendChild(s)}const Dn=new class{constructor(t){const[e,i]=t.split("-"),s=e.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=null!=i?i:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}("3.0.7");t.BladeApi=e,t.ButtonApi=d,t.FolderApi=ht,t.InputBindingApi=et,t.ListApi=yn,t.MonitorBindingApi=st,t.Pane=class extends Sn{constructor(t){var e;const i=t||{},s=null!==(e=i.document)&&void 0!==e?e:L(),n=function(){const t=new xn;return[zs,qs,Js,tn,Cs,ms,_s,gs,ci,hn,fn,mn,q,bt,Et,Ot].forEach((e=>{t.register(e)})),t}();super(new An(s,{expanded:i.expanded,blade:X(),props:S.fromObject({title:i.title}),viewProps:Tt.create()}),n),this.pool_=n,this.containerElem_=i.container||function(t){const e=t.createElement("div");return e.classList.add(g("dfw")()),t.body&&t.body.appendChild(e),e}(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!i.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw h.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw h.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((t=>{this.pool_.register(t),this.embedPluginStyle_(t)}))}embedPluginStyle_(t){t.css&&In(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){In(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187,188,196,0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187,188,196,0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187,188,196,0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187,188,196,0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}"),this.pool_.getAll().forEach((t=>{this.embedPluginStyle_(t)})),this.registerPlugin({plugins:[Tn,En,Ot,kn]})}},t.SeparatorApi=xt,t.SliderApi=Cn,t.TabApi=Bt,t.TabPageApi=Rt,t.TextApi=Pn,t.TpChangeEvent=s,t.VERSION=Dn,Object.defineProperty(t,"__esModule",{value:!0})}(e)},excalibur:t=>{t.exports=t1}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{DevTool:()=>r});var t=i("excalibur"),e=i("./node_modules/tweakpane/dist/tweakpane.js"),n=i("./picker-system.ts");class r{constructor(t){this.engine=t,this.pointerPos={x:0,y:0},this.highlightedEntities=[-1],this.selectedEntity=null,this.selectedEntityId=-1,this.pane=new e.Pane({title:"Excalibur Dev Tools",expanded:!0});const i=document.createElement("style");i.innerText=".excalibur-tweakpane-custom { width: 405px; }",document.head.appendChild(i),this.pane.element.parentElement.classList.add("excalibur-tweakpane-custom"),this._buildMain(),this.tabs=this.pane.addTab({pages:[{title:"Entity"},{title:"Screen"},{title:"Camera"},{title:"Clock"},{title:"Timers"},{title:"Physics"},{title:"Settings"}]}),this.selectedEntityTab=this.tabs.pages[0],this.screenTab=this.tabs.pages[1],this.cameraTab=this.tabs.pages[2],this.clockTab=this.tabs.pages[3],this.timerTab=this.tabs.pages[4],this.physicsTab=this.tabs.pages[5],this.debugTab=this.tabs.pages[6],this._installPickerSystemIfNeeded(t.currentScene),t.debug.transform.showPosition=!0,t.debug.entity.showName=!0,this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"}),this._buildScreenTab(),this._buildCameraTab(),this._buildClockTab(),this._buildTimersTab(),this._buildPhysicsTab(),this._buildDebugSettingsTab(),setInterval((()=>{this.update(this)}),30),this.addListeners()}addListeners(){this.engine.canvas.addEventListener("click",(()=>{-1!==this.highlightedEntities[0]&&this.selectEntityById(this.highlightedEntities[0])}))}selectEntityById(e){const i=this.engine;this.selectedEntityId=e,this.selectedEntity=i.currentScene.world.entityManager.getById(e),this._buildEntityUI(this.selectedEntity);const s=this.selectedEntity.get(t.TransformComponent);this._buildTransformUI(s);const n=this.selectedEntity.get(t.MotionComponent);if(this._buildMotionUI(n),this.selectedEntity instanceof t.ParticleEmitter)this._buildParticleEmitterUI(this.selectedEntity);else{const e=this.selectedEntity.get(t.GraphicsComponent);this._buildGraphicsUI(e);const i=this.selectedEntity.get(t.ColliderComponent),s=this.selectedEntity.get(t.BodyComponent);this._buildColliderUI(i,s)}}update(t){const e=t.engine,i=e.input.pointers.primary.lastWorldPos;this.pointerPos.x=i.x,this.pointerPos.y=i.y,this.pointerPosInput.refresh();const s=[...this.pickerSystem.lastFrameEntityToPointers.keys(),...this.pickerSystem.currentFrameEntityToPointers.keys()];0===s.length&&(s.push(-1),s.push(this.selectedEntityId)),this.highlightedEntities=s,e.debug.filter.useFilter=!0,e.debug.filter.ids=s,this.currentResolution.width===e.screen.resolution.width&&this.currentResolution.height===e.screen.resolution.height&&this.currentViewport.width===e.screen.viewport.width&&this.currentViewport.height===e.screen.viewport.height||(this.resolutionText.dispose(),this.viewportText.dispose(),this.resolutionText=this.screenFolder.addBlade({view:"text",label:"resolution",value:`(${e.screen.resolution.width}x${e.screen.resolution.height})`,parse:t=>String(t),index:0}),this.viewportText=this.screenFolder.addBlade({view:"text",label:"viewport",value:`(${e.screen.viewport.width.toFixed(0)}x${e.screen.viewport.height.toFixed(0)})`,parse:t=>String(t),index:1})),this._buildTimersTab()}_installPickerSystemIfNeeded(t){this.pickerSystem=t.world.systemManager.get(n.PickerSystem),this.pickerSystem||(this.pickerSystem=new n.PickerSystem,t.world.systemManager.addSystem(this.pickerSystem))}_buildMain(){this.pane.addInput({debug:!1},"debug").on("change",(()=>{this.engine.toggleDebug()})),this.pane.addMonitor(this.engine.clock.fpsSampler,"fps",{view:"graph",label:"fps (0 - 120)",min:0,max:120});let t,e="",i=[];for(let t in this.engine.scenes)this.engine.currentScene===this.engine.scenes[t]&&(e=t),i.push({text:t,value:t});this.pane.addBlade({view:"list",label:"current scene",options:i,value:e}).on("change",(e=>{this.engine.goToScene(e.value),this._installPickerSystemIfNeeded(this.engine.currentScene),t.dispose(),t=this.pane.addBlade({view:"text",label:"number of entities",value:this.engine.currentScene.world.entityManager.entities.length,parse:t=>String(t),index:3})})),t=this.pane.addBlade({view:"text",label:"number of entities",value:this.engine.currentScene.world.entityManager.entities.length,parse:t=>String(t),index:3}),this.pointerPos={x:10,y:10},this.pointerPosInput=this.pane.addInput(this,"pointerPos",{label:"pointer pos (world)"}),this.pane.addInput(this,"selectedEntityId",{label:"Select By Id"}).on("change",(t=>this.selectEntityById(t.value)))}_buildEntityUI(e){var i,s;this.selectedEntityFolder&&(this.selectedEntityFolder.dispose(),this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"})),this.selectedEntityFolder.addBlade({view:"text",label:"id",value:e.id.toString(),parse:t=>String(t)}),this.selectedEntityFolder.addInput(this.selectedEntity,"name"),this.selectedEntityFolder.addBlade({view:"text",label:"tags",value:e.tags.join(",")||"none",parse:t=>String(t)}),e instanceof t.Actor&&e.color&&this.selectedEntityFolder.addInput(this.selectedEntity,"color").on("change",(i=>{e.color=new t.Color(i.value.r,i.value.g,i.value.b,i.value.a)})),this.selectedEntityFolder.addBlade({view:"text",label:"parent",value:e.parent?`(${null===(i=e.parent)||void 0===i?void 0:i.id}) ${null===(s=e.parent)||void 0===s?void 0:s.name}`:"none",parse:t=>String(t)}),this.selectedEntityFolder.addBlade({view:"list",label:"children",options:e.children.map((t=>({text:`(${t.id}) ${t.name}`,value:t.id}))),value:e.children.length?e.children[0].id:"none"}),this.selectedEntityFolder.addButton({title:"Kill Entity"}).on("click",(t=>{this.selectedEntity.kill(),this.selectedEntityFolder.dispose(),this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"})}))}_buildColliderUI(e,i){var s,n;if(e){const r=this.selectedEntityFolder.addFolder({title:"Collider & Body"});r.addBlade({view:"text",label:"type",value:null!==(n=null===(s=e.get())||void 0===s?void 0:s.constructor.name)&&void 0!==n?n:"none",parse:t=>String(t)}),i&&(r.addBlade({view:"list",label:"collisionType",options:[t.CollisionType.Active,t.CollisionType.Fixed,t.CollisionType.Passive,t.CollisionType.PreventCollision].map((t=>({text:t,value:t}))),value:i.collisionType}).on("change",(t=>{i.collisionType=t.value})),r.addBlade({view:"list",label:"collisionGroup",options:[t.CollisionGroup.All,...t.CollisionGroupManager.groups].map((t=>({text:t.name,value:t}))),value:i.group}).on("change",(t=>{i.group=t.value})))}}_buildParticleEmitterUI(t){const e=this.selectedEntityFolder.addFolder({title:"Particles"});e.addInput(t,"isEmitting"),e.addInput(t,"emitRate"),e.addInput(t,"fadeFlag"),e.addInput(t,"particleLife",{min:100,max:1e4,step:100}),e.addInput(t,"width"),e.addInput(t,"height"),e.addInput(t,"minVel"),e.addInput(t,"maxVel"),e.addInput(t,"minAngle",{min:0,max:2*Math.PI,step:.1}),e.addInput(t,"maxAngle",{min:0,max:2*Math.PI,step:.1}),e.addInput(t,"minSize"),e.addInput(t,"maxSize"),e.addInput(t,"beginColor"),e.addInput(t,"endColor"),e.addInput(t,"opacity",{min:0,max:1,step:.01}),e.addInput(t,"randomRotation"),e.addInput(t,"particleRotationalVelocity")}_buildGraphicsUI(t){var e;if(t){const i=this.selectedEntityFolder.addFolder({title:"Graphics"});i.addInput(t,"anchor"),i.addInput(t,"opacity",{min:0,max:1,step:.05}),i.addInput(t,"visible");const s=[],n=[],r=t.current.map((t=>t.graphic)),o=[];let a=0;for(let e in t.graphics)s.push({text:e,value:a++}),n.push(t.graphics[e]),o.push(t.graphics[e]);let l=0;for(let t of r)-1===o.indexOf(t)&&(s.push({text:"anonymous"+l++,value:a}),n.push(t));i.addBlade({view:"list",label:"graphics",options:s,value:n.indexOf(null===(e=t.current[0])||void 0===e?void 0:e.graphic)}).on("change",(e=>{t.use(n[e.value])}))}}_buildMotionUI(t){if(t){const e=this.selectedEntityFolder.addFolder({title:"Motion"});e.addInput(t,"vel"),e.addInput(t,"acc"),e.addInput(t,"angularVelocity",{step:.1}),e.addInput(t,"scaleFactor"),e.addInput(t,"inertia")}}_buildTransformUI(e){if(e){const i=this.selectedEntityFolder.addFolder({title:"Transform"});i.addBlade({view:"list",label:"coord plane",options:[t.CoordPlane.World,t.CoordPlane.Screen].map((t=>({text:t,value:t}))),value:e.coordPlane}).on("change",(t=>e.coordPlane=t.value));const s=i.addInput(e,"pos"),n=i.addInput(e,"rotation",{min:0,max:2*Math.PI}),r=i.addInput(e,"scale");i.addSeparator();const o=i.addInput(e,"globalPos",{label:"global pos"}),a=i.addInput(e,"globalRotation",{label:"global rot",min:0,max:2*Math.PI}),l=i.addInput(e,"globalScale",{label:"global pos"});o.on("change",(()=>s.refresh())),s.on("change",(()=>o.refresh())),a.on("change",(()=>n.refresh())),n.on("change",(()=>a.refresh())),l.on("change",(()=>r.refresh())),r.on("change",(()=>l.refresh())),i.addInput(e,"z",{label:"z-index"})}}_buildScreenTab(){this.screenFolder=this.screenTab.addFolder({title:"Screen"}),this.currentResolution=this.engine.screen.resolution,this.currentViewport=this.engine.screen.viewport,this.resolutionText=this.screenFolder.addBlade({view:"text",label:"resolution",value:`(${this.engine.screen.resolution.width}x${this.engine.screen.resolution.height})`,parse:t=>String(t),index:0}),this.viewportText=this.screenFolder.addBlade({view:"text",label:"viewport",value:`(${this.engine.screen.viewport.width.toFixed(0)}x${this.engine.screen.viewport.height.toFixed(0)})`,parse:t=>String(t),index:1}),this.screenFolder.addButton({title:"Fullscreen"}).on("click",(()=>{this.engine.screen.goFullScreen()})),this.screenFolder.addSeparator();const e=this.screenFolder.addBlade({view:"list",label:"Color Blindness Mode",options:[t.ColorBlindnessMode.Deuteranope,t.ColorBlindnessMode.Protanope,t.ColorBlindnessMode.Tritanope].map((t=>({text:t,value:t}))),value:t.ColorBlindnessMode.Deuteranope}),i={simulate:!1};this.screenFolder.addInput(i,"simulate"),this.screenFolder.addButton({title:"Apply"}).on("click",(()=>{i.simulate?this.engine.debug.colorBlindMode.simulate(e.value):this.engine.debug.colorBlindMode.correct(e.value)})),this.screenFolder.addButton({title:"Clear"}).on("click",(()=>{this.engine.debug.colorBlindMode.clear()}))}_buildCameraTab(){const t=this.cameraTab.addFolder({title:"Camera"});t.addInput(this.engine.currentScene.camera,"zoom",{min:.01,max:10,step:.1}),t.addInput(this.engine.currentScene.camera,"pos")}_buildClockTab(){const e=this.clockTab.addFolder({title:"Clock"});let i=this.engine.clock instanceof t.TestClock,s=16;const n=e.addButton({title:"step",disabled:!i,index:2}).on("click",(()=>this.engine.clock.step(s)));e.addBlade({view:"slider",label:"step (ms)",min:1,max:100,step:16,value:s}).on("change",(t=>s=t.value)),e.addButton({title:"Use Test Clock",index:0}).on("click",(()=>{this.engine.debug.useTestClock(),i=!0,n.disabled=!1})),e.addButton({title:"Use Standard Clock",index:1}).on("click",(()=>{this.engine.debug.useStandardClock(),i=!1,n.disabled=!0})),this.pane.addSeparator();const r=e.addButton({title:"Stop",disabled:!1}),o=e.addButton({title:"Start",disabled:!0});r.on("click",(()=>{this.engine.clock.stop(),o.disabled=!1,r.disabled=!0})),o.on("click",(()=>{this.engine.clock.start(),r.disabled=!1,o.disabled=!0}))}_buildTimersTab(){this.timerTab,this._timersFolder&&this._timersFolder.dispose(),this._timersFolder=this.timerTab.addFolder({title:"Timers"});for(let t of this.engine.currentScene.timers){let e=t.repeats&&-1===t.maxNumberOfRepeats?"repeats":t._numberOfTicks+1+" of "+(-1===t.maxNumberOfRepeats?1:t.maxNumberOfRepeats);t.isRunning||(e="stopped"),t.complete&&(e="complete"),this._timersFolder.addBlade({view:"text",label:`timer(${t.id})`,value:`${e} next(${t.timeToNextAction.toFixed(0)}ms)`,parse:t=>String(t)})}}_buildPhysicsTab(){const e=this.physicsTab,i={};for(let e in t.Physics)i[e]=t.Physics[e];e.addInput(i,"enabled").on("change",(e=>t.Physics.enabled=e.value)),e.addInput(i,"acc");const s=e.addInput(i,"collisionResolutionStrategy");e.addButton({title:"Use Arcade"}).on("click",(()=>{t.Physics.useArcadePhysics(),i.collisionResolutionStrategy=t.Physics.collisionResolutionStrategy,s.refresh()})),e.addButton({title:"Use Realistic"}).on("click",(()=>{t.Physics.useRealisticPhysics(),i.collisionResolutionStrategy=t.Physics.collisionResolutionStrategy,s.refresh()})),e.addInput(i,"bodiesCanSleepByDefault").on("change",(e=>t.Physics.bodiesCanSleepByDefault=e.value)),e.addInput(i,"warmStart").on("change",(e=>t.Physics.warmStart=e.value)),e.addInput(i,"sleepEpsilon",{min:.01,max:2,step:.05}).on("change",(e=>t.Physics.sleepEpsilon=e.value)),e.addInput(i,"wakeThreshold",{min:.01,max:2,step:.05}).on("change",(e=>t.Physics.wakeThreshold=e.value)),e.addInput(i,"positionIterations",{min:1,max:30,step:1}).on("change",(e=>t.Physics.positionIterations=e.value)),e.addInput(i,"velocityIterations",{min:1,max:30,step:1}).on("change",(e=>t.Physics.velocityIterations=e.value)),e.addInput(i,"checkForFastBodies").on("change",(e=>t.Physics.checkForFastBodies=e.value))}_buildDebugSettingsTab(){const t=this.debugTab;for(let e of["entity","transform","motion","body","collider","physics","graphics","camera"]){let i=t.addFolder({title:e});if(this.engine.debug[e])for(let t in this.engine.debug[e])if(t)if(t.toLocaleLowerCase().includes("color"))i.addInput(this.engine.debug[e],t);else{if(Array.isArray(this.engine.debug[e][t]))continue;i.addInput(this.engine.debug[e],t)}}}}})(),s})(),$3d149cbfd3136500$export$add4fa36ca2fc569(),$613a632b39062363$export$a62869ddf53aa3e3.init();class $ad2bcec7a0192558$export$985739bfa5723e08 extends $jgD1p.Engine{showDevTool=$9d936a2aecb96285$export$2e2bcd8739ae039.ShowDevTool;constructor(){super({canvasElementId:"game",displayMode:$jgD1p.DisplayMode.FitScreen,antialiasing:!1,resolution:{width:$9d936a2aecb96285$export$2e2bcd8739ae039.tileWidth*($9d936a2aecb96285$export$2e2bcd8739ae039.gridWidth+$9d936a2aecb96285$export$2e2bcd8739ae039.gridPadding),height:$9d936a2aecb96285$export$2e2bcd8739ae039.tileHeight*($9d936a2aecb96285$export$2e2bcd8739ae039.gridHeight+$9d936a2aecb96285$export$2e2bcd8739ae039.gridPadding)}})}init(){this.startLevel();const t=new $jgD1p.Loader;for(const e of Object.values($7c4c300842bd4cf2$export$e9a269813a6315a4))t.addResource(e);this.start(t).then((()=>{this.setupDevTool()}))}startLevel=()=>{const t=new $84ab826914df134a$export$ca664994d1d54bff;this.addScene("main",t),this.goToScene("main")};setupDevTool=()=>{if(this.showDevTool){this.devTool=new $d82f9d57af76c42b$exports.DevTool(this);let t=this.devTool.pane.addTab({pages:[{title:"Config"}]}).pages[0];for(let e in $9d936a2aecb96285$export$2e2bcd8739ae039)t.addInput($9d936a2aecb96285$export$2e2bcd8739ae039,e,{disabled:!0})}}}const $ad2bcec7a0192558$export$119d2a93e2780362=new $ad2bcec7a0192558$export$985739bfa5723e08;$ad2bcec7a0192558$export$119d2a93e2780362.input.keyboard.on("release",(t=>{switch(t.key){case $jgD1p.Input.Keys.P:$ad2bcec7a0192558$export$119d2a93e2780362.isRunning()?($ad2bcec7a0192558$export$119d2a93e2780362.stop(),$jgD1p.Logger.getInstance().info("game paused")):($ad2bcec7a0192558$export$119d2a93e2780362.start(),$jgD1p.Logger.getInstance().info("game resumed"));break;case $jgD1p.Input.Keys.Semicolon:$ad2bcec7a0192558$export$119d2a93e2780362.toggleDebug()}})),$ad2bcec7a0192558$export$119d2a93e2780362.init();
//# sourceMappingURL=index.b4f6eafe.js.map
