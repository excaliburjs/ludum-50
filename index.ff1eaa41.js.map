{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-1368dd98f6c1b400.js","lib/excalibur/build/dist/webpack:/ex/webpack/universalModuleDefinition","lib/excalibur/build/dist/node_modules/core-js/es/array/sort.js","lib/excalibur/build/dist/node_modules/core-js/es/object/keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/a-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/an-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-includes.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-method-is-strict.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-slice-simple.js","lib/excalibur/build/dist/node_modules/core-js/internals/array-sort.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof-raw.js","lib/excalibur/build/dist/node_modules/core-js/internals/classof.js","lib/excalibur/build/dist/node_modules/core-js/internals/copy-constructor-properties.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-non-enumerable-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/create-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/descriptors.js","lib/excalibur/build/dist/node_modules/core-js/internals/document-create-element.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-ff-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-is-ie-or-edge.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-user-agent.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-v8-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/engine-webkit-version.js","lib/excalibur/build/dist/node_modules/core-js/internals/entry-unbind.js","lib/excalibur/build/dist/node_modules/core-js/internals/enum-bug-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/export.js","lib/excalibur/build/dist/node_modules/core-js/internals/fails.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-bind-native.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-call.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-name.js","lib/excalibur/build/dist/node_modules/core-js/internals/function-uncurry-this.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-built-in.js","lib/excalibur/build/dist/node_modules/core-js/internals/get-method.js","lib/excalibur/build/dist/node_modules/core-js/internals/global.js","lib/excalibur/build/dist/node_modules/core-js/internals/has-own-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/hidden-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/ie8-dom-define.js","lib/excalibur/build/dist/node_modules/core-js/internals/indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/inspect-source.js","lib/excalibur/build/dist/node_modules/core-js/internals/internal-state.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-callable.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-forced.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-pure.js","lib/excalibur/build/dist/node_modules/core-js/internals/is-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/length-of-array-like.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-symbol.js","lib/excalibur/build/dist/node_modules/core-js/internals/native-weak-map.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-define-property.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-descriptor.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-names.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-get-own-property-symbols.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-is-prototype-of.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys-internal.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/object-property-is-enumerable.js","lib/excalibur/build/dist/node_modules/core-js/internals/ordinary-to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/own-keys.js","lib/excalibur/build/dist/node_modules/core-js/internals/path.js","lib/excalibur/build/dist/node_modules/core-js/internals/redefine.js","lib/excalibur/build/dist/node_modules/core-js/internals/require-object-coercible.js","lib/excalibur/build/dist/node_modules/core-js/internals/set-global.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared-store.js","lib/excalibur/build/dist/node_modules/core-js/internals/shared.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-absolute-index.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-indexed-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-integer-or-infinity.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-length.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-object.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-primitive.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-property-key.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string-tag-support.js","lib/excalibur/build/dist/node_modules/core-js/internals/to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/try-to-string.js","lib/excalibur/build/dist/node_modules/core-js/internals/uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/use-symbol-as-uid.js","lib/excalibur/build/dist/node_modules/core-js/internals/v8-prototype-define-bug.js","lib/excalibur/build/dist/node_modules/core-js/internals/well-known-symbol.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.array.sort.js","lib/excalibur/build/dist/node_modules/core-js/modules/es.object.keys.js","lib/excalibur/build/dist/webpack:/ex/Loader.css","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/api.js","lib/excalibur/build/dist/node_modules/css-loader/dist/runtime/sourceMaps.js","lib/excalibur/build/dist/webpack:/ex/webpack/bootstrap","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/compat get default export","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/define property getters","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/global","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/hasOwnProperty shorthand","lib/excalibur/build/dist/webpack:/ex/webpack/runtime/make namespace object","lib/excalibur/build/dist/webpack:/ex/Flags.ts","lib/excalibur/build/dist/webpack:/ex/Util/Log.ts","lib/excalibur/build/dist/webpack:/ex/Polyfill.ts","lib/excalibur/build/dist/webpack:/ex/Id.ts","lib/excalibur/build/dist/webpack:/ex/Util/Decorators.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Side.ts","lib/excalibur/build/dist/webpack:/ex/Color.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BoundingBox.ts","lib/excalibur/build/dist/webpack:/ex/Math/Random.ts","lib/excalibur/build/dist/webpack:/ex/Math/util.ts","lib/excalibur/build/dist/webpack:/ex/Util/Util.ts","lib/excalibur/build/dist/webpack:/ex/Math/matrix.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Filtering.ts","lib/excalibur/build/dist/webpack:/ex/Events.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/transform-stack.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/state-stack.ts","lib/excalibur/build/dist/webpack:/ex/Util/Watch.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Graphic.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-util.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/texture-loader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Raster.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Canvas.ts","lib/excalibur/build/dist/webpack:/ex/EventDispatcher.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Resource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteEffects.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Texture.ts","lib/excalibur/build/dist/webpack:/ex/Configurable.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Sprite.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/ImageSource.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/FontCommon.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteSheet.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/SpriteFont.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-text.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/debug-font.png","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-source.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/render-target.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/webgl-adapter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/shader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/vertex-layout.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsDiagnostics.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/line-renderer/line-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/point-renderer/point-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-vertex.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/screen-pass-painter/screen-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/quad-index-buffer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/image-renderer/image-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.frag.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","lib/excalibur/build/dist/webpack:/ex/Screen.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/AudioContext.ts","lib/excalibur/build/dist/webpack:/ex/Util/WebAudio.ts","lib/excalibur/build/dist/webpack:/ex/Class.ts","lib/excalibur/build/dist/webpack:/ex/Util/DrawUtil.ts","lib/excalibur/build/dist/webpack:/ex/Loader.ts","lib/excalibur/build/dist/webpack:/ex/Loader.logo.png","lib/excalibur/build/dist/webpack:/ex/Util/Detector.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionType.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Physics.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/TransformComponent.ts","lib/excalibur/build/dist/webpack:/ex/Math/vector-view.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Component.ts","lib/excalibur/build/dist/webpack:/ex/Util/Observable.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Components/MotionComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroup.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/Pair.ts","lib/excalibur/build/dist/webpack:/ex/Math/projection.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTree.ts","lib/excalibur/build/dist/webpack:/ex/Math/ray.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/DynamicTreeCollisionProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Collider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CompositeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Math/line.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/ClosestLineJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CircleCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Detection/CollisionContact.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/SeparatingAxis.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/CollisionJumpTable.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/EdgeCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/PolygonCollider.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Colliders/Shape.ts","lib/excalibur/build/dist/webpack:/ex/Collision/ColliderComponent.ts","lib/excalibur/build/dist/webpack:/ex/Collision/BodyComponent.ts","lib/excalibur/build/dist/webpack:/ex/Actions/RotationType.ts","lib/excalibur/build/dist/webpack:/ex/Util/CullingBox.ts","lib/excalibur/build/dist/webpack:/ex/Traits/OffscreenCulling.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Entity.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Rectangle.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Circle.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerComponent.ts","lib/excalibur/build/dist/webpack:/ex/Util/EasingFunctions.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionQueue.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Repeat.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RepeatForever.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/MoveTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/RotateBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/ScaleBy.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/CallMethod.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/EaseTo.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Blink.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Fade.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Delay.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Die.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Follow.ts","lib/excalibur/build/dist/webpack:/ex/Actions/Action/Meet.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionContext.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Font.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Text.ts","lib/excalibur/build/dist/webpack:/ex/Actor.ts","lib/excalibur/build/dist/webpack:/ex/ScreenElement.ts","lib/excalibur/build/dist/webpack:/ex/Timer.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/DebugGraphicsComponent.ts","lib/excalibur/build/dist/webpack:/ex/Camera.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/TileMap.ts","lib/excalibur/build/dist/webpack:/ex/Util/Actors.ts","lib/excalibur/build/dist/webpack:/ex/Trigger.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/System.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/EntityManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Util.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/Query.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/QueryManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/SystemManager.ts","lib/excalibur/build/dist/webpack:/ex/EntityComponentSystem/World.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Integrator.ts","lib/excalibur/build/dist/webpack:/ex/Collision/MotionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/Solver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ArcadeSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/ContactConstraintPoint.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Solver/RealisticSolver.ts","lib/excalibur/build/dist/webpack:/ex/Collision/CollisionSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Animation.ts","lib/excalibur/build/dist/webpack:/ex/Particles.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsGroup.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/GraphicsSystem.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/CanvasDrawingSystem.ts","lib/excalibur/build/dist/webpack:/ex/Debug/DebugSystem.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerSystem.ts","lib/excalibur/build/dist/webpack:/ex/Actions/ActionsSystem.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntityComponent.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricEntitySystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/OffscreenSystem.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerScope.ts","lib/excalibur/build/dist/webpack:/ex/Input/Keyboard.ts","lib/excalibur/build/dist/webpack:/ex/Input/Gamepad.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelDeltaMode.ts","lib/excalibur/build/dist/webpack:/ex/Input/NativePointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerButton.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerType.ts","lib/excalibur/build/dist/webpack:/ex/Scene.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ScreenShader.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/PostProcessor/color-blind-fragment.glsl","lib/excalibur/build/dist/webpack:/ex/Debug/DebugFlags.ts","lib/excalibur/build/dist/webpack:/ex/Debug/Debug.ts","lib/excalibur/build/dist/webpack:/ex/Util/Browser.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","lib/excalibur/build/dist/webpack:/ex/Math/global-coordinates.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/WheelEvent.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerAbstraction.ts","lib/excalibur/build/dist/webpack:/ex/Input/PointerEventReceiver.ts","lib/excalibur/build/dist/webpack:/ex/Util/Fps.ts","lib/excalibur/build/dist/webpack:/ex/Util/Clock.ts","lib/excalibur/build/dist/webpack:/ex/Engine.ts","lib/excalibur/build/dist/webpack:/ex/Events/MediaEvents.ts","lib/excalibur/build/dist/webpack:/ex/Label.ts","lib/excalibur/build/dist/webpack:/ex/TileMap/IsometricMap.ts","lib/excalibur/build/dist/webpack:/ex/Collision/Group/CollisionGroupManager.ts","lib/excalibur/build/dist/webpack:/ex/Drawing/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/AudioImplementation.ts","lib/excalibur/build/dist/webpack:/ex/Interfaces/LifecycleEvents.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/WebAudioInstance.ts","lib/excalibur/build/dist/webpack:/ex/Util/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Sound/Sound.ts","lib/excalibur/build/dist/webpack:/ex/Resources/Gif.ts","lib/excalibur/build/dist/webpack:/ex/Graphics/Polygon.ts","lib/excalibur/build/dist/webpack:/ex/Util/SortedList.ts","lib/excalibur/build/dist/webpack:/ex/Util/Pool.ts","lib/excalibur/build/dist/webpack:/ex/Promises.ts","lib/excalibur/build/dist/webpack:/ex/index.ts","node_modules/@parcel/runtime-js/lib/runtime-77d541a110e6f92a.js","src/resources.ts","src/level.ts","src/main.ts"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"aT88m\\\":\\\"index.ff1eaa41.js\\\",\\\"93Bqc\\\":\\\"sword.a45e8cc8.png\\\"}\"));","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, function() {\nreturn ","require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar TypeError = global.TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar String = global.String;\nvar TypeError = global.TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar createProperty = require('../internals/create-property');\n\nvar Array = global.Array;\nvar max = Math.max;\n\nmodule.exports = function (O, start, end) {\n  var length = lengthOfArrayLike(O);\n  var k = toAbsoluteIndex(start, length);\n  var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n  var result = Array(max(fin - k, 0));\n  for (var n = 0; k < fin; k++, n++) createProperty(result, n, O[k]);\n  result.length = n;\n  return result;\n};\n","var arraySlice = require('../internals/array-slice-simple');\n\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    array,\n    mergeSort(arraySlice(array, 0, middle), comparefn),\n    mergeSort(arraySlice(array, middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (array, left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n\n  while (lindex < llength || rindex < rlength) {\n    array[lindex + rindex] = (lindex < llength && rindex < rlength)\n      ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n      : lindex < llength ? left[lindex++] : right[rindex++];\n  } return array;\n};\n\nmodule.exports = mergeSort;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n","var global = require('../internals/global');\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar Object = global.Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","'use strict';\nvar toPropertyKey = require('../internals/to-property-key');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPropertyKey(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar bind = FunctionPrototype.bind;\nvar call = FunctionPrototype.call;\nvar uncurryThis = NATIVE_BIND && bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? function (fn) {\n  return fn && uncurryThis(fn);\n} : function (fn) {\n  return fn && function () {\n    return call.apply(fn, arguments);\n  };\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar Object = global.Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split(it, '') : Object(it);\n} : Object;\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = uncurryThis(store.get);\n  var wmhas = uncurryThis(store.has);\n  var wmset = uncurryThis(store.set);\n  set = function (it, metadata) {\n    if (wmhas(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument == 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar Object = global.Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, Object(it));\n};\n","var toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var global = require('../internals/global');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar TypeError = global.TypeError;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar TypeError = global.TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","var global = require('../internals/global');\n\nvar TypeError = global.TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.21.0',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2014-2022 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- safe\n  return number !== number || number === 0 ? 0 : (number > 0 ? floor : ceil)(number);\n};\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var global = require('../internals/global');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar Object = global.Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TypeError = global.TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var global = require('../internals/global');\nvar classof = require('../internals/classof');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","var global = require('../internals/global');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype != 42;\n});\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar symbolFor = Symbol && Symbol['for'];\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    var description = 'Symbol.' + name;\n    if (NATIVE_SYMBOL && hasOwn(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else if (USE_SYMBOL_AS_UID && symbolFor) {\n      WellKnownSymbolsStore[name] = symbolFor(description);\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar un$Sort = uncurryThis(test.sort);\nvar push = uncurryThis(test.push);\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n    var items = [];\n    var arrayLength = lengthOfArrayLike(array);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) push(items, array[index]);\n    }\n\n    internalSort(items, getSortCompare(comparefn));\n\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  white-space: nowrap;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n/**\n * Features in preview\n */\nexport enum Experiments {\n  WebGL = 'use-webgl'\n}\n\n/**\n * Legacy features that will go away\n */\nexport enum Legacy {\n  Canvas = 'use-canvas-context',\n  LegacyDrawing = 'use-legacy-drawing'\n}\n\n/**\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\n * after which they are frozen and are read-only.\n *\n * Flags are used to enable experimental or preview features in Excalibur.\n */\nexport class Flags {\n  private static _FROZEN = false;\n  private static _FLAGS: Record<string, boolean> = {};\n\n  /**\n   * Freeze all flag modifications making them readonly\n   */\n  public static freeze() {\n    Flags._FROZEN = true;\n  }\n\n  /**\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\n   *\n   * Calling this in your game is UNSUPPORTED\n   * @internal\n   */\n  public static _reset() {\n    Flags._FROZEN = false;\n    Flags._FLAGS = {};\n  }\n\n  /**\n   * Turn on webgl support\n   */\n  public static useWebGL() {\n    Flags.enable(Experiments.WebGL);\n  }\n\n  public static useCanvasGraphicsContext() {\n    Flags.enable(Legacy.Canvas);\n  }\n\n  /**\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\n   */\n  public static useLegacyDrawing() {\n    Flags.enable(Legacy.LegacyDrawing);\n  }\n\n  /**\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static enable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be enabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = true;\n  }\n\n  /**\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static disable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be disabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = false;\n  }\n\n  /**\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\n   * @param flagName\n   */\n  public static isEnabled(flagName: string): boolean {\n    return !!Flags._FLAGS[flagName];\n  }\n\n  /**\n   * Show a list of currently known flags\n   */\n  public static show(): string[] {\n    return Object.keys(Flags._FLAGS);\n  }\n}\n","/* eslint-disable no-console */\n/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[Appender]] to create your own logging appenders.\n */\nexport class Logger {\n  private static _INSTANCE: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._INSTANCE) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._INSTANCE = this;\n    // Default console appender\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._INSTANCE == null) {\n      Logger._INSTANCE = new Logger();\n    }\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Adds a new [[Appender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    // eslint-disable-next-line\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import 'core-js/es/array/sort';\nimport 'core-js/es/object/keys';\n\n/**\n * Polyfill adding function\n */\nexport function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function () {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function (callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function () {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    if ((<any>window).webkitAudioContext) {\n      const ctx = (<any>window).webkitAudioContext;\n      const replaceMe = ctx.prototype.decodeAudioData;\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\n        return new Promise((resolve, reject) => {\n          replaceMe.call(this, arrayBuffer, resolve, reject);\n        });\n      };\n    }\n\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n}\n","export type Id<T extends string> = {\n  type: T,\n  value: number\n};\n\n/**\n * Create a branded ID type from a number\n */\nexport function createId<T extends string>(type: T, value: number): Id<T> {\n  return { type, value };\n};\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = {\n    message: 'This feature will be removed in future versions of Excalibur.',\n    alternateMethod: null,\n    showStackTrace: false,\n    ...options\n  };\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Clonable } from '../Interfaces/Clonable';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A 2D vector on a plane.\n */\n\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  public static min(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\n  }\n\n  public static max(vec1: Vector, vec2: Vector) {\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(x: number, y: number) {\n    this._x = x;\n    this._y = y;\n  }\n\n  protected _x = 0;\n  /**\n   * Get the x component of the vector\n   */\n  public get x(): number {\n    return this._x;\n  }\n\n  /**\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set x(val: number) {\n    this._x = val;\n  }\n\n  protected _y = 0;\n  /**\n   * Get the y component of the vector\n   */\n  public get y(): number {\n    return this._y;\n  }\n\n  /**\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\n   */\n  public set y(val: number) {\n    this._y = val;\n  }\n\n  /**\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\n   *\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  setTo(x: number, y: number) {\n    (this.x as number) = x;\n    (this.y as number) = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param vector The other point to compare to\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  public squareDistance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\n   */\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * The size (magnitude) of the Vector\n   */\n  public get size(): number {\n    return this.distance();\n  }\n\n  /**\n   * Setting the size mutates the current vector\n   *\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\n   */\n  public set size(newLength: number) {\n    const v = this.normalize().scale(newLength);\n    this.setTo(v.x, v.y);\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public addEqual(v: Vector): Vector {\n    this.setTo(this.x + v.x, this.y + v.y);\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @param v The vector to subtract\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public subEqual(v: Vector): Vector {\n    this.setTo(this.x - v.x, this.y - v.y);\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\n   */\n  public scaleEqual(size: number): Vector {\n    this.setTo(this.x * size, this.y * size);\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  static cross(num: number, vec: Vector): Vector {\n    return new Vector(-num * vec.y, num * vec.x);\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string representation of the vector.\n   */\n  public toString(fixed?: number): string {\n    if (fixed) {\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\n    }\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n *\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nexport function vec(x: number, y: number): Vector {\n  return new Vector(x, y);\n}\n","import { Vector } from '../Math/vector';\n\n/**\n * An enum that describes the sides of an axis aligned box for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n\nexport module Side {\n  /**\n   * Returns the opposite side from the current\n   */\n  export function getOpposite(side: Side): Side {\n    if (side === Side.Top) {\n      return Side.Bottom;\n    }\n    if (side === Side.Bottom) {\n      return Side.Top;\n    }\n    if (side === Side.Left) {\n      return Side.Right;\n    }\n    if (side === Side.Right) {\n      return Side.Left;\n    }\n\n    return Side.None;\n  }\n\n  /**\n   * Given a vector, return the Side most in that direction (via dot product)\n   */\n  export function fromDirection(direction: Vector): Side {\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n    let max = -Number.MAX_VALUE;\n    let maxIndex = -1;\n    for (let i = 0; i < directions.length; i++) {\n      if (directions[i].dot(direction) > max) {\n        max = directions[i].dot(direction);\n        maxIndex = i;\n      }\n    }\n    return directionEnum[maxIndex];\n  }\n}\n","import { obsolete } from './Util/Decorators';\n\n/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new instance of Color from a rgb string\n   *\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\n   */\n  public static fromRGBString(string: string): Color {\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\n    let match = null;\n    if ((match = string.match(rgbaRegEx))) {\n      const r = parseInt(match[1], 10);\n      const g = parseInt(match[2], 10);\n      const b = parseInt(match[3], 10);\n      let a = 1;\n      if (match[4]) {\n        a = parseFloat(match[4]);\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid rgb/a string: ' + string);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public multiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   * @param color\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\n  public mulitiply(color: Color): Color {\n    return this.multiply(color);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.multiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  public equal(color: Color): boolean {\n    return this.toString() === color.toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   */\n  public static get Vermilion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions',\n    alternateMethod: 'Vermilion'\n  })\n  public static get Vermillion(): Color {\n    return Color.Vermilion;\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n\n  /**\n   * ExcaliburBlue (#176BAA)\n   */\n  public static get ExcaliburBlue(): Color {\n    return Color.fromHex('#176BAA');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","import { vec, Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Returns a new instance of [[BoundingBox]] that is a copy of the current instance\n   */\n  public clone(): BoundingBox {\n    return new BoundingBox(this.left, this.top, this.right, this.bottom);\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Scale a bounding box by a scale factor, optionally provide a point\n   * @param scale\n   * @param point\n   */\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Transform the axis aligned bounding box by a [[Matrix]], producing a new axis aligned bounding box\n   * @param matrix\n   */\n  public transform(matrix: Matrix) {\n    const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\n    const xa = matFirstColumn.scale(this.left);\n    const xb = matFirstColumn.scale(this.right);\n\n    const matSecondColumn = vec(matrix.data[4], matrix.data[5]);\n    const ya = matSecondColumn.scale(this.top);\n    const yb = matSecondColumn.scale(this.bottom);\n\n    const matrixPos = matrix.getPosition();\n    const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\n    const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\n\n    return new BoundingBox({\n      left: topLeft.x,\n      top: topLeft.y,\n      right: bottomRight.x,\n      bottom: bottomRight.y\n    });\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Returns true if the bounding boxes overlap.\n   * @param other\n   */\n  public overlaps(other: BoundingBox): boolean {\n    const totalBoundingBox = this.combine(other);\n    return totalBoundingBox.width < other.width + this.width &&\n           totalBoundingBox.height < other.height + this.height;\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /**\n   *\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","/**\n * @module\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrence\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param array Array to pick elements out of\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param array Array to pick elements out of\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","import { Random } from './Random';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Returns the fractional part of a number\n * @param x\n */\nexport function frac(x: number): number {\n  if (x >= 0) {\n    return x - Math.floor(x);\n  } else {\n    return x - Math.ceil(x);\n  }\n}\n\n/**\n * Returns the sign of a number, if 0 returns 0\n */\nexport function sign(val: number): number {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\n\n/**\n * Convert an angle to be the equivalent in the range [0, 2PI]\n */\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\n/**\n * Convert radians to degrees\n */\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\n/**\n * Convert degrees to radians\n */\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\n/**\n * Generate a range of numbers\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\n * @param from inclusive\n * @param to inclusive\n */\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\n\n/**\n * Find a random floating point number in range\n */\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\n/**\n * Find a random integer in a range\n */\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}","import { Vector } from '../Math/vector';\nimport { Side } from '../Collision/Side';\nimport { Clock } from './Clock';\n\n// TODO remove in v0.26.0\n// Re-export hack to deprecate import site gently\nimport {\n  TwoPI as lTwoPI,\n  clamp as lclamp,\n  randomInRange as lrandomInRange,\n  randomIntInRange as lrandomIntInRange,\n  canonicalizeAngle as lcanonicalizeAngle,\n  toDegrees as ltoDegrees,\n  toRadians as ltoRadians,\n  range as lrange\n} from '../Math/util';\n\n/**\n * @deprecated ex.Util.TwoPI import site will be removed in v0.26.0, use ex.TwoPI\n */\nexport const TwoPI = lTwoPI;\n\n/**\n * @deprecated ex.Util.clamp import site will be removed in v0.26.0, use ex.clamp\n */\nexport const clamp = lclamp;\n\n/**\n * @deprecated ex.Util.randomInRange import site will be removed in v0.26.0, use ex.randomInRange\n */\nexport const randomInRange = lrandomInRange;\n\n/**\n * @deprecated ex.Util.randomIntInRange import site will be removed in v0.26.0, use ex.randomIntInRange\n */\nexport const randomIntInRange = lrandomIntInRange;\n\n/**\n * @deprecated ex.Util.canonicalizeAngle import site will be removed in v0.26.0, use ex.canonicalizeAngle\n */\nexport const canonicalizeAngle = lcanonicalizeAngle;\n\n/**\n * @deprecated ex.Util.toDegrees import site will be removed in v0.26.0, use ex.toDegrees\n */\nexport const toDegrees = ltoDegrees;\n\n/**\n * @deprecated ex.Util.toRadians import site will be removed in v0.26.0, use ex.toRadians\n */\nexport const toRadians = ltoRadians;\n\n/**\n * @deprecated ex.Util.range import site will be removed in v0.26.0, use ex.range\n */\nexport const range = lrange;\n\n// TODO END REMOVE in v0.26.0\n\n/**\n * Find the screen position of an HTML element\n */\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\n/**\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\n * @deprecated Will be removed in v0.26.0\n */\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Remove an item from an list\n * @deprecated Will be removed in v0.26.0\n */\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * See if an array contains something\n */\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get the opposite side\n * TODO: Move to Side type\n * @deprecated Will be removed in v0.26.0\n */\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n * @deprecated\n * TODO: Move to Side type\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n * @deprecated Will be removed v0.26.0\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n\n/**\n * Create a promise that resolves after a certain number of milliseconds\n *\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\n * excalibur clock which would be unaffected by stop/pause.\n * @param milliseconds\n * @param clock\n */\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\n  return new Promise<void>(resolve => {\n    schedule(() => {\n      resolve();\n    }, milliseconds);\n  });\n}\n","import { sign } from './util';\nimport { Vector, vec } from './vector';\nimport { canonicalizeAngle } from './util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Converts the current matrix into a DOMMatrix\n   *\n   * This is useful when working with the browser Canvas context\n   * @returns {DOMMatrix} DOMMatrix\n   */\n  public toDOMMatrix(): DOMMatrix {\n    return new DOMMatrix([...this.data]);\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Resets the current matrix to the identity matrix, mutating it\n   * @returns {Matrix} Current matrix as identity\n   */\n  public reset(): Matrix {\n    const mat = this;\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiply the current matrix by a vector producing a new vector\n   * @param vector\n   * @param dest\n   */\n  multiply(vector: Vector, dest?: Vector): Vector;\n  /**\n   * Multiply the current matrix by another matrix producing a new matrix\n   * @param matrix\n   * @param dest\n   */\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\n    if (vectorOrMatrix instanceof Vector) {\n      const result = (dest as Vector) || new Vector(0, 0);\n      const vector = vectorOrMatrix;\n      // these shenanigans are to allow dest and vector to be the same instance\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\n\n      result.x = resultX;\n      result.y = resultY;\n      return result;\n    } else {\n      const result = (dest as Matrix) || new Matrix();\n      const other = vectorOrMatrix;\n      const a11 = this.data[0];\n      const a21 = this.data[1];\n      const a31 = this.data[2];\n      const a41 = this.data[3];\n\n      const a12 = this.data[4];\n      const a22 = this.data[5];\n      const a32 = this.data[6];\n      const a42 = this.data[7];\n\n      const a13 = this.data[8];\n      const a23 = this.data[9];\n      const a33 = this.data[10];\n      const a43 = this.data[11];\n\n      const a14 = this.data[12];\n      const a24 = this.data[13];\n      const a34 = this.data[14];\n      const a44 = this.data[15];\n\n      const b11 = other.data[0];\n      const b21 = other.data[1];\n      const b31 = other.data[2];\n      const b41 = other.data[3];\n\n      const b12 = other.data[4];\n      const b22 = other.data[5];\n      const b32 = other.data[6];\n      const b42 = other.data[7];\n\n      const b13 = other.data[8];\n      const b23 = other.data[9];\n      const b33 = other.data[10];\n      const b43 = other.data[11];\n\n      const b14 = other.data[12];\n      const b24 = other.data[13];\n      const b34 = other.data[14];\n      const b44 = other.data[15];\n\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n      const s = this.getScale();\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\n\n      return result;\n    }\n  }\n\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  /**\n   * Return the affine inverse, optionally store it in a target matrix.\n   *\n   * It's recommended you call .reset() the target unless you know what you're doing\n   * @param target\n   */\n  public getAffineInverse(target?: Matrix): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = target || Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","\n/**\n * Describes the different image filtering modes\n */\nexport enum ImageFiltering {\n\n  /**\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\n   *\n   * Useful for Pixel art aesthetics.\n   */\n  Pixel = 'Pixel',\n\n  /**\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\n   */\n  Blended = 'Blended'\n}","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { Matrix } from '../../Math/matrix';\n\nexport class TransformStack {\n  private _transforms: Matrix[] = [];\n  private _currentTransform: Matrix = Matrix.identity();\n\n  public save(): void {\n    this._transforms.push(this._currentTransform);\n    this._currentTransform = this._currentTransform.clone();\n  }\n\n  public restore(): void {\n    this._currentTransform = this._transforms.pop();\n  }\n\n  public translate(x: number, y: number): Matrix {\n    return this._currentTransform.translate(x, y);\n  }\n\n  public rotate(angle: number): Matrix {\n    return this._currentTransform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): Matrix {\n    return this._currentTransform.scale(x, y);\n  }\n\n  public set current(matrix: Matrix) {\n    this._currentTransform = matrix;\n  }\n\n  public get current(): Matrix {\n    return this._currentTransform;\n  }\n}\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\n\nexport class StateStack {\n  private _states: ExcaliburGraphicsContextState[] = [];\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\n\n  private _getDefaultState() {\n    return {\n      opacity: 1\n    };\n  }\n\n  private _cloneState() {\n    return {\n      opacity: this._currentState.opacity\n    };\n  }\n\n  public save(): void {\n    this._states.push(this._currentState);\n    this._currentState = this._cloneState();\n  }\n\n  public restore(): void {\n    this._currentState = this._states.pop();\n  }\n\n  public get current(): ExcaliburGraphicsContextState {\n    return this._currentState;\n  }\n}\n","/**\n * Watch an object with a proxy, only fires if property value is different\n */\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        if ((obj as any)[prop] !== value) {\n          (obj as any)[prop] = value;\n          // Avoid watching private junk\n          if (typeof prop === 'string') {\n            if (prop[0] !== '_') {\n              change(obj);\n            }\n          }\n        }\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n\n/**\n * Watch an object with a proxy, fires change on any property value change\n */\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\n  if (!type) {\n    return type;\n  }\n  if ((type as any).__isProxy === undefined) {\n    // expando hack to mark a proxy\n    return new Proxy(type, {\n      set: (obj, prop, value) => {\n        // The default behavior to store the value\n        (obj as any)[prop] = value;\n        // Avoid watching private junk\n        if (typeof prop === 'string') {\n          if (prop[0] !== '_') {\n            change(obj);\n          }\n        }\n\n        // Indicate success\n        return true;\n      },\n      get: (obj, prop) => {\n        if (prop !== '__isProxy') {\n          return (obj as any)[prop];\n        }\n        return true;\n      }\n    });\n  }\n  return type;\n}\n","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { Matrix } from '..';\nimport { watch } from '../Util/Watch';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  public transform: Matrix = Matrix.identity();\n  private _transformStale = true;\n  public isStale() {\n    return this._transformStale;\n  }\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n\n  private _flipHorizontal = false;\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public get flipHorizontal(): boolean {\n    return this._flipHorizontal;\n  }\n\n  public set flipHorizontal(value: boolean) {\n    this._flipHorizontal = value;\n    this._transformStale = true;\n  }\n\n  private _flipVertical = false;\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public get flipVertical(): boolean {\n    return this._flipVertical;\n  }\n\n  public set flipVertical(value: boolean) {\n    this._flipVertical = value;\n    this._transformStale = true;\n  }\n\n  private _rotation = 0;\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public get rotation(): number {\n    return this._rotation;\n  }\n\n  public set rotation(value: number) {\n    this._rotation = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  private _scale = Vector.One;\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public get scale() {\n    return this._scale;\n  }\n\n  public set scale(value: Vector) {\n    this._scale = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  private _origin: Vector | null = null;\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public get origin(): Vector | null {\n    return this._origin;\n  }\n\n  public set origin(value: Vector | null) {\n    this._origin = watch(value, () => {\n      this._transformStale = true;\n    });\n    this._transformStale = true;\n  }\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n    this._transformStale = true;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n    this._transformStale = true;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    if (this._transformStale) {\n      this.transform.reset();\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n      this._rotate(this.transform);\n      this._flip(this.transform);\n      this._transformStale = false;\n    }\n    ex.multiply(this.transform);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext | Matrix) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext | Matrix) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any additional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\n * Checks if the current number is a power of two\n */\nexport function isPowerOfTwo(x: number): boolean {\n  return (x & (x - 1)) === 0;\n}\n\n/**\n * Returns the next highest power of two\n */\nexport function nextHighestPowerOfTwo(x: number): number {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x = x | (x >> i);\n  }\n  return x + 1;\n}\n\n/**\n * Returns the input number if a power of two, otherwise the next highest power of two\n */\nexport function ensurePowerOfTwo(x: number): number {\n  if (!isPowerOfTwo(x)) {\n    return nextHighestPowerOfTwo(x);\n  }\n  return x;\n}\n\n/**\n * Return the size of the GlType in bytes\n * @param gl\n * @param type\n */\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.FLOAT:\n      return 4;\n    case gl.SHORT:\n      return 2;\n    case gl.UNSIGNED_SHORT:\n      return 2;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n\n/**\n * Based on the type return the number of attribute components\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n * @param gl\n * @param type\n */\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n      return 1;\n    case gl.FLOAT_VEC2:\n      return 2;\n    case gl.FLOAT_VEC3:\n      return 3;\n    case gl.FLOAT_VEC4:\n      return 4;\n    case gl.BYTE:\n      return 1;\n    case gl.UNSIGNED_BYTE:\n      return 1;\n    case gl.UNSIGNED_SHORT:\n    case gl.SHORT:\n      return 1;\n    default:\n      return 1;\n  }\n}\n\n/**\n * Based on the attribute return the corresponding supported attrib pointer type\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n *\n * @param gl\n * @param type\n */\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\n  switch (type) {\n    case gl.LOW_FLOAT:\n    case gl.HIGH_FLOAT:\n    case gl.FLOAT:\n    case gl.FLOAT_VEC2:\n    case gl.FLOAT_VEC3:\n    case gl.FLOAT_VEC4:\n      return gl.FLOAT;\n    case gl.BYTE:\n      return gl.BYTE;\n    case gl.UNSIGNED_BYTE:\n      return gl.UNSIGNED_BYTE;\n    case gl.SHORT:\n      return gl.SHORT;\n    case gl.UNSIGNED_SHORT:\n      return gl.UNSIGNED_SHORT;\n    default:\n      return gl.FLOAT;\n  }\n}","import { Logger } from '../../Util/Log';\nimport { ImageFiltering } from '../Filtering';\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\n\n/**\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\n */\nexport class TextureLoader {\n  private static _LOGGER = Logger.getInstance();\n  /**\n   * Sets the default filtering for the Excalibur texture loader, default [[ImageFiltering.Blended]]\n   */\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\n  private static _POT_CANVAS = document.createElement('canvas');\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\n\n  private static _GL: WebGLRenderingContext;\n\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\n\n  private static _MAX_TEXTURE_SIZE: number  = 0;\n\n  public static register(context: WebGLRenderingContext): void {\n    TextureLoader._GL = context;\n    TextureLoader._MAX_TEXTURE_SIZE = context.getParameter(context.MAX_TEXTURE_SIZE);\n  }\n\n  /**\n   * Get the WebGL Texture from a source image\n   * @param image\n   */\n  public static get(image: HTMLImageSource): WebGLTexture {\n    return TextureLoader._TEXTURE_MAP.get(image);\n  }\n\n  /**\n   * Returns whether a source image has been loaded as a texture\n   * @param image\n   */\n  public static has(image: HTMLImageSource): boolean {\n    return TextureLoader._TEXTURE_MAP.has(image);\n  }\n\n  /**\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\n   * @param image Source graphic\n   * @param filtering {ImageFiltering} The ImageFiltering mode to apply to the loaded texture\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\n   */\n  public static load(image: HTMLImageSource, filtering?: ImageFiltering, forceUpdate = false): WebGLTexture {\n    // Ignore loading if webgl is not registered\n    const gl = TextureLoader._GL;\n    if (!gl) {\n      return null;\n    }\n\n    let tex: WebGLTexture = null;\n    // If reuse the texture if it's from the same source\n    if (TextureLoader.has(image)) {\n      tex = TextureLoader.get(image);\n    }\n\n    // Update existing webgl texture and return early\n    if (tex) {\n      if (forceUpdate) {\n        gl.bindTexture(gl.TEXTURE_2D, tex);\n        const source = TextureLoader.toPowerOfTwoImage(image);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n      }\n      return tex;\n    }\n\n    // No texture exists create a new one\n    tex = gl.createTexture();\n    const source = TextureLoader.toPowerOfTwoImage(image);\n\n    TextureLoader.checkImageSizeSupportedAndLog(image);\n\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n    // NEAREST for pixel art, LINEAR for hi-res\n    const filterMode = filtering ?? TextureLoader.filtering;\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\n\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n\n    TextureLoader._TEXTURE_MAP.set(image, tex);\n    return tex;\n  }\n\n  /**\n   * Converts source images into power of two images, WebGL only supports POT images\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\n   * @param image\n   */\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\n    const potCanvas = TextureLoader._POT_CANVAS;\n    const potCtx = TextureLoader._POT_CTX;\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\n      // Scale up the texture to the next highest power of two dimensions.\n\n      potCanvas.width = ensurePowerOfTwo(image.width);\n      potCanvas.height = ensurePowerOfTwo(image.height);\n      potCtx.imageSmoothingEnabled = false;\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\n      image = potCanvas;\n    }\n    return image;\n  }\n\n  /**\n   * Takes an image and returns if it meets size criteria for hardware\n   * @param image\n   * @returns if the image will be supported at runtime\n   */\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\n      TextureLoader._LOGGER.error(\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of `+\n        `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image `\n        +`for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n`+\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n      return false;\n    } else if (image.width > 4096 || image.height > 4096) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\n      TextureLoader._LOGGER.warn(\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, `+\n        `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\n        `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\n    }\n    return true;\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\nimport { ImageFiltering } from './Filtering';\n\n\nexport interface RasterOptions {\n  /**\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\n   */\n  smoothing?: boolean;\n\n  /**\n   * Optionally specify the color of the raster's bitmap context, by default [[Color.Black]]\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\n   */\n  strokeColor?: Color;\n\n  /**\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\n   */\n  lineWidth?: number;\n\n  /**\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\n   */\n  lineDash?: number[];\n\n  /**\n   * Optionally specify the padding to apply to the bitmap\n   */\n  padding?: number;\n\n  /**\n   * Optionally specify what image filtering mode should be used, [[ImageFiltering.Pixel]] for pixel art,\n   * [[ImageFiltering.Blended]] for hi-res art\n   *\n   * By default unset, rasters defer to the engine antialiasing setting\n   */\n  filtering?: ImageFiltering;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implement the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public filtering: ImageFiltering = null;\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n      this.filtering = options.filtering ?? this.filtering;\n    }\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return Math.abs(this._getTotalWidth() * this.scale.x);\n  }\n  public set width(value: number) {\n    value /= Math.abs(this.scale.x);\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return Math.abs(this._getTotalHeight() * this.scale.y);\n  }\n\n  public set height(value: number) {\n    value /= Math.abs(this.scale.y);\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    this.flagDirty();\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    this.flagDirty();\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperties(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, this.filtering, true);\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CanvasOptions {\n  draw?: (ctx: CanvasRenderingContext2D) => void;\n  cache?: boolean;\n}\n\n/**\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\n *\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\n *\n * **Low performance API**\n */\nexport class Canvas extends Raster {\n  /**\n   * Return the 2D graphics context of this canvas\n   */\n  public get ctx() {\n    return this._ctx;\n  }\n\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\n    super(_options);\n  }\n\n  public clone(): Canvas {\n    return new Canvas({\n      ...this._options,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._options?.draw) {\n      this._options?.draw(ctx);\n    }\n    if (!this._options.cache) {\n      this.flagDirty();\n    }\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    if (!event) {\n      event = new GameEvent();\n    }\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i](event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      this.off(eventName, handler);\n      handler(ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also receive events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Logger } from '../Util/Log';\nimport { EventDispatcher } from '../EventDispatcher';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n */\nexport class Resource<T> implements Loadable<T> {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n  public events: EventDispatcher = new EventDispatcher();\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {}\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<T> {\n    return new Promise((resolve, reject) => {\n      // Exit early if we already have data\n      if (this.data !== null) {\n        this.logger.debug('Already have data for resource', this.path);\n        this.events.emit('complete', this.data as any);\n        resolve(this.data);\n        return;\n      }\n\n      const request = new XMLHttpRequest();\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n      request.responseType = this.responseType;\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\n      request.addEventListener('load', () => {\n        // XHR on file:// success status is 0, such as with PhantomJS\n        if (request.status !== 0 && request.status !== 200) {\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n          this.events.emit('error', request.response);\n          reject(new Error(request.statusText));\n          return;\n        }\n\n        this.data = request.response;\n        this.events.emit('complete', this.data as any);\n        this.logger.debug('Completed loading resource', this.path);\n        resolve(this.data);\n      });\n      request.send();\n    });\n  }\n}\n","/**\n * @module\n * @deprecated\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n */\n\n/**\n * @typedoc\n */\n\nimport { obsolete } from '../Util/Decorators';\nimport { Color } from '../Color';\n\n/**\n * The interface that all sprite effects must implement\n * @deprecated SpriteEffect will be removed in v0.26.0\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n * @deprecated [[Grayscale]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Grayscale will be removed in v0.26.0'\n})\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n * @deprecated [[Invert]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Invert will be removed in v0.26.0'\n})\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n * @deprecated [[Opacity]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Opacity will be removed in v0.26.0'\n})\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n * @deprecated [[Colorize]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Colorize will be removed in v0.26.0'\n})\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n * @deprecated [[Lighten]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Lighten will be removed in v0.26.0'\n})\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n * @deprecated [[Darken]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Darken will be removed v0.26.0'\n})\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n * @deprecated [[Saturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Saturate will be removed in v0.26.0'\n})\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n * @deprecated [[Desaturate]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Desaturate will be removed in v0.26.0'\n})\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n * @deprecated [[Fill]] will be removed in v0.26.0\n */\n@obsolete({\n  message: 'Fill will be removed in v0.26.0'\n})\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n * @deprecated\n */\nexport class Texture implements Loadable<HTMLImageElement> {\n  private _resource: Resource<Blob>;\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public data: HTMLImageElement;\n  public get image() {\n    return this.data;\n  }\n\n  private _loadedResolve: (image: HTMLImageElement) => any;\n  public loaded = new Promise<HTMLImageElement>(resolve => {\n    this._loadedResolve = resolve;\n  });\n\n  /**\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return !!this.data;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<HTMLImageElement> {\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      await image.decode();\n\n      // Set results\n      this.data = image;\n      this.width = this._sprite.width = image.naturalWidth;\n      this.height = this._sprite.height = image.naturalHeight;\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n    } catch {\n      await Promise.reject('Error loading texture');\n    }\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\n/**\n * Configurable helper extends base type and makes all properties available as option bag arguments\n * @internal\n * @param base\n */\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        // eslint-disable-next-line\n        if (typeof (<any>this)[k] !== 'function') {\n          // eslint-disable-next-line\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Texture } from './Texture';\nimport { Vector } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @hidden\n * @deprecated Use [[Sprite]]\n */\nexport class SpriteImpl implements Drawable {\n  public texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return Math.abs(this.width * this.scale.x);\n  }\n\n  public get drawHeight(): number {\n    return Math.abs(this.height * this.scale.y);\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = Vector.Half;\n  public offset: Vector = Vector.Zero;\n  public scale: Vector = Vector.One;\n  /**\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\n   */\n  public drawAroundAnchor = false;\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = true;\n\n  /**\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to construct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this.texture = image as Texture;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\n    this._initPixelsFromTexture();\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private async _initPixelsFromTexture() {\n    try {\n      const image = await this.texture.loaded;\n      this.width = this.width || image.naturalWidth;\n      this.height = this.height || image.naturalHeight;\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\n      this._loadPixels();\n      this._dirtyEffect = true;\n    } catch (e) {\n      this.logger.error('Error loading texture ', this.texture.path, e);\n    }\n  }\n\n  private _loadPixels() {\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this.texture.image.naturalWidth || 0;\n      const naturalHeight = this.texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._flushTexture();\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  private _flushTexture() {\n    const naturalWidth = this.texture.image.naturalWidth || 0;\n    const naturalHeight = this.texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this.texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n  }\n\n  private _opacity: number = 1;\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[SpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[SpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n    this._flushTexture();\n\n    if (this.effects.length > 0) {\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n      const len = this.effects.length;\n      for (let i = 0; i < len; i++) {\n        for (let y = 0; y < this.height; y++) {\n          for (let x = 0; x < this.width; x++) {\n            this.effects[i].updatePixel(x, y, this._pixelData);\n          }\n        }\n      }\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\n    }\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.width,\n      drawHeight: options.drawHeight ?? this.height,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n    // calculating current dimensions\n    const anchorX = drawWidth * anchor.x + offset.x;\n    const anchorY = drawHeight * anchor.y + offset.y;\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n\n    ctx.save();\n    // Move the draw point of origin\n    ctx.translate(x, y);\n\n    // Rotate and scale around anchor point\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n\n    if (this.drawAroundAnchor) {\n      // In the case where you want the anchor to match with the point of draw\n      // Otherwise sprites are always drawn from top-left\n      ctx.translate(-anchorX, -anchorY);\n    }\n\n    ctx.translate(anchorX, anchorY);\n    ctx.rotate(rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ctx.scale(scaleDirX, scaleDirY);\n    ctx.translate(-anchorX, -anchorY);\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    // Context is already rotated and scaled\n    ctx.drawImage(\n      this._spriteCanvas,\n      0,\n      0,\n      this.width,\n      this.height, // source\n      0,\n      0,\n      this.width,\n      this.height\n    ); // dest\n    ctx.globalAlpha = oldAlpha;\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\n    result.anchor = this.anchor.clone();\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * @deprecated Use [[Sprite]]\n */\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\n * @deprecated Use [[Sprite]]\n */\n@obsolete({\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\n  alternateMethod: 'Use Label.font.shadow'\n})\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ImageSource } from './ImageSource';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\nimport { Texture } from '../Drawing/Texture';\n\nexport type SourceView = { x: number; y: number; width: number; height: number };\nexport type DestinationSize = { width: number; height: number };\n\nexport interface SpriteOptions {\n  /**\n   * Image to create a sprite from\n   */\n  image: ImageSource;\n  /**\n   * By default the source is the entire dimension of the [[ImageSource]]\n   */\n  sourceView?: { x: number; y: number; width: number; height: number };\n  /**\n   * By default the size of the final sprite is the size of the [[ImageSource]]\n   */\n  destSize?: { width: number; height: number };\n}\n\nexport class Sprite extends Graphic {\n  public image: ImageSource;\n  public sourceView: SourceView;\n  public destSize: DestinationSize;\n  private _dirty = true;\n\n  public static from(image: ImageSource): Sprite {\n    return new Sprite({\n      image: image\n    });\n  }\n\n  constructor(options: GraphicOptions & SpriteOptions) {\n    super(options);\n    this.image = options.image;\n    const { width, height } = options;\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\n    this._updateSpriteDimensions();\n    this.image.ready.then(() => {\n      this._updateSpriteDimensions();\n    });\n  }\n\n  public override get width(): number {\n    return Math.abs(this.destSize.width * this.scale.x);\n  }\n\n  public override get height(): number {\n    return Math.abs(this.destSize.height * this.scale.y);\n  }\n\n  public override set width(newWidth: number) {\n    newWidth /= Math.abs(this.scale.x);\n    this.destSize.width = newWidth;\n    super.width = Math.ceil(this.destSize.width);\n  }\n\n  public override set height(newHeight: number) {\n    newHeight /= Math.abs(this.scale.y);\n    this.destSize.height = newHeight;\n    super.height = Math.ceil(this.destSize.height);\n  }\n\n  private _updateSpriteDimensions() {\n    const { width: nativeWidth, height: nativeHeight } = this.image;\n    // This code uses || to avoid 0's\n    // If the source is not specified, use the native dimension\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\n\n    // If the destination is not specified, use the source if specified, then native\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\n\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded() && this._dirty) {\n      this._dirty = false;\n      this._updateSpriteDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.image.isLoaded()) {\n      ex.drawImage(\n        this.image.image,\n        this.sourceView.x,\n        this.sourceView.y,\n        this.sourceView.width,\n        this.sourceView.height,\n        x,\n        y,\n        this.destSize.width,\n        this.destSize.height\n      );\n    }\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param sprite\n   */\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\n    const tex = sprite.texture;\n    const image = ImageSource.fromLegacyTexture(tex);\n    return new Sprite({\n      image,\n      sourceView: {\n        x: sprite.x,\n        y: sprite.y,\n        width: sprite.width,\n        height: sprite.height\n      }\n    });\n  }\n\n  /**\n   * Converts a sprite to a Legacy sprite\n   * @deprecated\n   * @param sprite\n   * @returns LegacyDrawing.Sprite\n   */\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\n    const image = sprite.image;\n    const tex = new Texture(image.path);\n    tex.data = image.image;\n\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\n  }\n\n  public clone(): Sprite {\n    return new Sprite({\n      image: this.image,\n      sourceView: { ...this.sourceView },\n      destSize: { ...this.destSize },\n      ...this.cloneGraphicOptions()\n    });\n  }\n}\n","import { Resource } from '../Resources/Resource';\nimport { Texture } from '../Drawing/Texture';\nimport { Sprite } from './Sprite';\nimport { Loadable } from '../Interfaces/Index';\nimport { Logger } from '../Util/Log';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\nexport class ImageSource implements Loadable<HTMLImageElement> {\n  private _logger = Logger.getInstance();\n  private _resource: Resource<Blob>;\n  private _filtering: ImageFiltering;\n\n  /**\n   * The original size of the source image in pixels\n   */\n  public get width() {\n    return this.image.naturalWidth;\n  }\n\n  /**\n   * The original height of the source image in pixels\n   */\n  public get height() {\n    return this.image.naturalHeight;\n  }\n\n  private _src: string;\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    if (!this._src) {\n      // this boosts speed of access\n      this._src = this.data.src;\n    }\n    return !!this._src;\n  }\n\n  /**\n   * Access to the underlying html image element\n   */\n  public data: HTMLImageElement = new Image();\n  public get image(): HTMLImageElement {\n    return this.data;\n  }\n\n  /**\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\n   */\n  public ready: Promise<HTMLImageElement>;\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\n\n  /**\n   * The path to the image, can also be a data url like 'data:image/'\n   * @param path {string} Path to the image resource relative from the HTML document hosting the game, or absolute\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by [[EngineOptions.antialiasing]]\n   */\n  constructor(public readonly path: string, bustCache: boolean = false, filtering?: ImageFiltering) {\n    this._resource = new Resource(path, 'blob', bustCache);\n    this._filtering = filtering;\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\n    }\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\n      this._loadedResolve = resolve;\n    });\n  }\n\n  /**\n   * Begins loading the image and returns a promise that resolves when the image is loaded\n   */\n  async load(): Promise<HTMLImageElement> {\n    if (this.isLoaded()) {\n      return this.data;\n    }\n    try {\n      // Load base64 or blob if needed\n      let url: string;\n      if (!this.path.includes('data:image/')) {\n        const blob = await this._resource.load();\n        url = URL.createObjectURL(blob);\n      } else {\n        url = this.path;\n      }\n\n      // Decode the image\n      const image = new Image();\n      image.src = url;\n      image.setAttribute('data-original-src', this.path);\n      await image.decode();\n\n      // Set results\n      this.data = image;\n    } catch (error) {\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\n    }\n    TextureLoader.load(this.data, this._filtering);\n    // todo emit complete\n    this._loadedResolve(this.data);\n    return this.data;\n  }\n\n  /**\n   * Build a sprite from this ImageSource\n   */\n  public toSprite(): Sprite {\n    return Sprite.from(this);\n  }\n\n  /**\n   * Create a ImageSource from legacy texture\n   * @param tex\n   */\n  public static fromLegacyTexture(tex: Texture): ImageSource {\n    const image = new ImageSource(tex.path);\n    if (tex.isLoaded()) {\n      image.data = tex.data;\n    } else {\n      tex.loaded.then(() => {\n        image.data = tex.data;\n      });\n    }\n    return image;\n  }\n\n  /**\n   * Unload images from memory\n   */\n  unload(): void {\n    this.data = new Image();\n  }\n}\n","import { Sprite } from './Sprite';\nimport * as Effects from './SpriteEffects';\nimport { Color } from '../Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { Engine } from '../Engine';\nimport { Configurable } from '../Configurable';\nimport { obsolete } from '../Util/Decorators';\nimport { clamp } from '../Math/util';\n\n/**\n * @deprecated Use [[HasTick]]\n */\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\n/**\n * @hidden\n * @deprecated Use [[Animation]]\n */\nexport class AnimationImpl implements Drawable, HasTick {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _timeLeftInFrame: number = 0;\n  private _idempotencyToken: number = -1;\n\n  public anchor: Vector = Vector.Zero;\n  public rotation: number = 0.0;\n  public scale: Vector = Vector.One;\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  private _opacity = 1;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engineOrConfig  Reference to the current game engine\n   * @param sprites  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n    this._timeLeftInFrame = this.speed;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[SpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[SpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick(elapsed: number, idempotencyToken?: number) {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    this._timeLeftInFrame -= elapsed;\n    if (this._timeLeftInFrame <= 0) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._timeLeftInFrame = this.speed;\n    }\n\n    this._updateValues();\n    const current = this.sprites[this.currentFrame];\n    if (current) {\n      this.width = current.width;\n      this.height = current.height;\n      this.drawWidth = current.drawWidth;\n      this.drawHeight = current.drawHeight;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  /**\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the animation with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const animOptions = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\n    };\n\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      currSprite.draw(animOptions);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(animOptions);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\n/**\n * @deprecated Use [[Animation]]\n */\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n * @deprecated Use [[Animation]]\n */\n@obsolete({\n  message: 'Animation will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Animation'\n})\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\n/**\n * Enum representing the text direction, useful for other languages, or writing text in reverse\n */\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\n/**\n * Font rendering option\n */\nexport interface FontOptions {\n  /**\n   * Optionally the size of the font in the specified [[FontUnit]] by default 10.\n   */\n  size?: number;\n  /**\n   * Optionally specify unit to measure fonts in, by default Pixels\n   */\n  unit?: FontUnit;\n  /**\n   * Optionally specify the font family, by default 'sans-serif'\n   */\n  family?: string;\n  /**\n   * Optionally specify the font style, by default Normal\n   */\n  style?: FontStyle;\n  /**\n   * Optionally set whether the font is bold, by default false\n   */\n  bold?: boolean;\n  /**\n   * Optionally specify the text align, by default Left\n   */\n  textAlign?: TextAlign;\n  /**\n   * Optionally specify the text base align, by default Alphabetic\n   */\n  baseAlign?: BaseAlign;\n  /**\n   * Optionally specify the text direction, by default LeftToRight\n   */\n  direction?: Direction;\n  /**\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\n   * Higher quality text has a higher memory impact\n   */\n  quality?: number;\n  /**\n   * Optionally specify a text shadow, by default none is specified\n   */\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\n/**\n * @internal\n */\nexport interface FontRenderer {\n  measureText(text: string): BoundingBox;\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\nimport { Logger } from '..';\n\n\n/**\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\n * and have space between them.\n */\nexport interface SpriteSheetSpacingDimensions {\n  /**\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\n   * Default is (0, 0)\n   */\n  originOffset?: { x?: number, y?: number };\n\n  /**\n   * The margin between sprites.\n   * Default is (0, 0)\n   */\n  margin?: {x?: number, y?: number};\n}\n\n/**\n * Sprite sheet options for slicing up images\n */\nexport interface SpriteSheetGridOptions {\n  /**\n   * Source image to use for each sprite\n   */\n  image: ImageSource;\n  /**\n   * Grid definition for the sprite sheet\n   */\n  grid: {\n    /**\n     * Number of rows in the sprite sheet\n     */\n    rows: number;\n    /**\n     * Number of columns in the sprite sheet\n     */\n    columns: number;\n    /**\n     * Width of each individual sprite\n     */\n    spriteWidth: number;\n    /**\n     * Height of each individual sprite\n     */\n    spriteHeight: number;\n  };\n  /**\n   * Optionally specify any spacing information between sprites\n   */\n  spacing?: SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetOptions {\n  /**\n   * Source sprites for the sprite sheet\n   */\n  sprites: Sprite[];\n  /**\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\n   */\n  rows?: number;\n  /**\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\n   */\n  columns?: number;\n}\n\n/**\n * Represents a collection of sprites from a source image with some organization in a grid\n */\nexport class SpriteSheet {\n  private _logger = Logger.getInstance();\n  public readonly sprites: Sprite[] = [];\n  public readonly rows: number;\n  public readonly columns: number;\n\n  /**\n   * Build a new sprite sheet from a list of sprites\n   *\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\n   * @param options\n   */\n  constructor(options: SpriteSheetOptions) {\n    const { sprites, rows, columns } = options;\n    this.sprites = sprites;\n    this.rows = rows ?? 1;\n    this.columns = columns ?? this.sprites.length;\n  }\n\n  /**\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\n   * @param x\n   * @param y\n   */\n  public getSprite(x: number, y: number): Sprite | null {\n    if (x >= this.columns || x < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\n      return null;\n    }\n    if (y >= this.rows || y < 0) {\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\n      return null;\n    }\n    const spriteIndex = x + y * this.columns;\n    return this.sprites[spriteIndex];\n  }\n\n  /**\n   * To a graphics sprite sheet from a legacy sprite sheet\n   */\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\n    return new SpriteSheet({\n      sprites\n    });\n  }\n\n  /**\n   * @deprecated\n   * @param spriteSheet\n   */\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\n    return new LegacySpriteSheet(sprites);\n  }\n\n  /**\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\n   *\n   * Example:\n   * ```\n   * const spriteSheet = SpriteSheet.fromImageSource({\n   *   image: imageSource,\n   *   grid: {\n   *     rows: 5,\n   *     columns: 2,\n   *     spriteWidth: 32, // pixels\n   *     spriteHeight: 32 // pixels\n   *   },\n   *   // Optionally specify spacing\n   *   spacing: {\n   *     // pixels from the top left to start the sprite parsing\n   *     originOffset: {\n   *       x: 5,\n   *       y: 5\n   *     },\n   *     // pixels between each sprite while parsing\n   *     margin: {\n   *       x: 1,\n   *       y: 1\n   *     }\n   *   }\n   * })\n   * ```\n   *\n   * @param options\n   */\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\n    const sprites: Sprite[] = [];\n    options.spacing = options.spacing ?? {};\n    const {\n      image,\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\n      spacing: { originOffset, margin }\n    } = options;\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\n    const marginDefaults = { x: 0, y: 0, ...margin};\n    for (let x = 0; x < cols; x++) {\n      for (let y = 0; y < rows; y++) {\n        sprites[x + y * cols] = new Sprite({\n          image: image,\n          sourceView: {\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\n            width: spriteWidth,\n            height: spriteHeight\n          },\n          destSize: { height: spriteHeight, width: spriteWidth }\n        });\n      }\n    }\n    return new SpriteSheet({\n      sprites: sprites,\n      rows: rows,\n      columns: cols\n    });\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\nimport { BoundingBox, Color } from '..';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritesheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text: string = '';\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n  }\n\n  private _alreadyWarnedAlphabet = false;\n  private _alreadyWarnedSpriteSheet = false;\n  private _getCharacterSprites(text: string): Sprite[] {\n    const results: Sprite[] = [];\n    // handle case insensitive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        if (!this._alreadyWarnedAlphabet) {\n          this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedAlphabet = true;\n        }\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        if (!this._alreadyWarnedSpriteSheet) {\n          this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\n          this._alreadyWarnedSpriteSheet = true;\n        }\n      }\n    }\n    return results;\n  }\n\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const sprites = this._getCharacterSprites(maxWidthLine);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    return BoundingBox.fromDimension(width, height * lines.length, Vector.Zero);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let xCursor = 0;\n    let yCursor = 0;\n    let height = 0;\n    const lines = this._text.split('\\n');\n    for (const line of lines) {\n      for (const sprite of this._getCharacterSprites(line)) {\n        // draw it in the right spot and increase the cursor by sprite width\n        sprite.draw(ex, x + xCursor, y + yCursor);\n        xCursor += sprite.width + this.spacing;\n        height = Math.max(height, sprite.height);\n      }\n      xCursor = 0;\n      yCursor += height;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, _color: Color, x: number, y: number) {\n    // SpriteFont doesn't support _color, yet...\n    this._text = text;\n    const bounds = this.measureText(text);\n    this.width = bounds.width;\n    this.height = bounds.height;\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\nimport { Vector } from '../..';\nimport debugFont from './debug-font.png';\n\n/**\n * Internal debugtext helper\n */\nexport class DebugText {\n  constructor() {\n    this.load();\n  }\n\n  /**\n   * base64 font\n   */\n  public readonly fontSheet = debugFont;\n  public size: number = 16;\n  private _imageSource: ImageSource;\n  private _spriteSheet: SpriteSheet;\n  private _spriteFont: SpriteFont;\n  public load() {\n    this._imageSource = new ImageSource(this.fontSheet);\n    return this._imageSource.load().then(() => {\n      this._spriteSheet = SpriteSheet.fromImageSource({\n        image: this._imageSource,\n        grid: {\n          rows: 3,\n          columns: 16,\n          spriteWidth: 16,\n          spriteHeight: 16\n        }\n      });\n      this._spriteFont = new SpriteFont({\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\n        caseInsensitive: true,\n        spriteSheet: this._spriteSheet,\n        spacing: -6\n      });\n    });\n  }\n\n  /**\n   * Writes debug text using the built in sprint font\n   * @param ctx\n   * @param text\n   * @param pos\n   */\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\n    if (this._imageSource.isLoaded()) {\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\n    }\n  }\n}\n","export default \"data:image/png;base64,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\"","export class RenderSource {\n  constructor(\n    private _gl: WebGLRenderingContext,\n    private _texture: WebGLTexture) {}\n\n  public use() {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\n  }\n\n  public disable() {\n    const gl = this._gl;\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","import { RenderSource } from './render-source';\n\nexport class RenderTarget {\n  width: number;\n  height: number;\n  private _gl: WebGLRenderingContext;\n  constructor(options: {gl: WebGLRenderingContext, width: number, height: number}) {\n    this.width = options.width;\n    this.height = options.height;\n    this._gl = options.gl;\n    this._setupFramebuffer();\n  }\n\n  setResolution(width: number, height: number) {\n    const gl = this._gl;\n    this.width = width;\n    this.height = height;\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n  }\n\n  private _frameBuffer: WebGLFramebuffer;\n  public get frameBuffer() {\n    return this._frameBuffer;\n  }\n  private _frameTexture: WebGLTexture;\n  public get frameTexture() {\n    return this._frameTexture;\n  }\n  private _setupFramebuffer() {\n    // Allocates frame buffer\n    const gl = this._gl;\n    this._frameTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n    // set the filtering so we don't need mips\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\n    // attach the texture as the first color attachment\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\n\n    // After this bind all draw calls will draw to this framebuffer texture\n    this._frameBuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\n    // Reset after initialized\n    this.disable();\n  }\n\n  public toRenderSource() {\n    const source = new RenderSource(this._gl, this._frameTexture);\n    return source;\n  }\n\n  /**\n   * When called, all drawing gets redirected to this render target\n   */\n  public use() {\n    const gl = this._gl;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\n    // very important to set the viewport to the size of the framebuffer texture\n    gl.viewport(0, 0, this.width, this.height);\n  }\n\n  /**\n   * When called, all drawing is sent back to the canvas\n   */\n  public disable() {\n    const gl = this._gl;\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n}","\n/**\n * Must be accessed after Engine construction time to ensure the context has been created\n */\nexport class ExcaliburWebGLContextAccessor {\n  private static _GL: WebGLRenderingContext;\n  public static clear() {\n    ExcaliburWebGLContextAccessor._GL = null;\n  }\n  public static register(gl: WebGLRenderingContext) {\n    ExcaliburWebGLContextAccessor._GL = gl;\n  }\n  // current webgl context\n  public static get gl(): WebGLRenderingContext {\n    if (!ExcaliburWebGLContextAccessor._GL) {\n      throw Error('Attempted gl access before init');\n    }\n    return ExcaliburWebGLContextAccessor._GL;\n  }\n}","import { Vector } from '../..';\nimport { Matrix } from '../../Math/matrix';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\n\nexport type UniformTypeNames =\n  'uniform1f' |\n  'uniform1i' |\n  'uniform2f' |\n  'uniform2i' |\n  'uniform3f' |\n  'uniform3i' |\n  'uniform4f' |\n  'uniform4i' |\n  'uniform1fv' |\n  'uniform1iv' |\n  'uniform2fv' |\n  'uniform2iv' |\n  'uniform3fv' |\n  'uniform3iv' |\n  'uniform4fv' |\n  'uniform4iv' |\n  'uniformMatrix2fv' |\n  'uniformMatrix3fv' |\n  'uniformMatrix4fv';\n\ntype RemoveFirstFromTuple<T extends any[]> =\n  T['length'] extends 0 ? undefined :\n    (((...b: T) => void) extends (a: any, ...b: infer I) => void ? I : [])\n\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>\n\nexport interface UniformDefinition {\n  name: string;\n  glType: number;\n  location: WebGLUniformLocation;\n}\n\n\nexport interface VertexAttributeDefinition {\n  /**\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\n   */\n  name: string;\n  /**\n   * Number of components for a given attribute\n   * Must be 1, 2, 3, or 4\n   *\n   * For example a vec4 attribute would be `4` floats, so 4\n   */\n  size: number;\n  /**\n   * Supported types in webgl 1\n   * * gl.BYTE\n   * * gl.SHORT\n   * * gl.UNSIGNED_BYTE\n   * * gl.UNSIGNED_SHORT\n   * * gl.FLOAT\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n   */\n  glType: number;\n  /**\n   * Is the attribute normalized between (0-1)\n   */\n  normalized: boolean;\n  /**\n   * Location index in the shader program\n   */\n  location: number;\n}\n\nexport interface ShaderOptions {\n  vertexSource: string;\n  fragmentSource: string;\n}\n\nexport class Shader {\n  private static _ACTIVE_SHADER_INSTANCE: Shader = null;\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  public program: WebGLProgram;\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\n  private _compiled = false;\n  public readonly vertexSource: string;\n  public readonly fragmentSource: string;\n\n  public get compiled() {\n    return this._compiled;\n  }\n\n  /**\n   * Create a shader program in excalibur\n   * @param options specify shader vertex and fragment source\n   */\n  constructor(options?: ShaderOptions) {\n    const { vertexSource, fragmentSource } = options;\n    this.vertexSource = vertexSource;\n    this.fragmentSource = fragmentSource;\n  }\n\n  /**\n   * Binds the shader program\n   */\n  use() {\n    const gl = this._gl;\n    gl.useProgram(this.program);\n    Shader._ACTIVE_SHADER_INSTANCE = this;\n  }\n\n  isCurrentlyBound() {\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\n  }\n\n  /**\n   * Compile the current shader against a webgl context\n   */\n  compile(): WebGLProgram {\n    const gl = this._gl;\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\n\n    const attributes = this.getAttributes();\n    for (const attribute of attributes) {\n      this.attributes[attribute.name] = attribute;\n    }\n    const uniforms = this.getUniforms();\n    for (const uniform of uniforms) {\n      this.uniforms[uniform.name] = uniform;\n    }\n\n    this._compiled = true;\n    return this.program;\n  }\n\n  getUniforms(): UniformDefinition[] {\n    const gl = this._gl;\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n    const uniforms: UniformDefinition[] = [];\n    for (let i = 0; i < uniformCount; i++) {\n      const uniform = gl.getActiveUniform(this.program, i);\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\n      uniforms.push({\n        name: uniform.name,\n        glType: uniform.type,\n        location: uniformLocation\n      });\n    }\n    return uniforms;\n  }\n\n  getAttributes(): VertexAttributeDefinition[] {\n    const gl = this._gl;\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n    const attributes: VertexAttributeDefinition[] = [];\n    for (let i = 0; i < attributeCount; i++) {\n      const attribute = gl.getActiveAttrib(this.program, i);\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\n      attributes.push({\n        name: attribute.name,\n        glType: getAttributePointerType(gl, attribute.type),\n        size: getAttributeComponentSize(gl, attribute.type),\n        location: attributeLocation,\n        normalized: false\n      });\n    }\n    return attributes;\n  }\n\n  /**\n   * Set a texture in a gpu texture slot\n   * @param slotNumber\n   * @param texture\n   */\n  setTexture(slotNumber: number, texture: WebGLTexture) {\n    const gl = this._gl;\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n  }\n\n  /**\n   * Set an integer uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformInt(name: string, value: number) {\n    this.setUniform('uniform1i', name, ~~value);\n  }\n\n  /**\n   * Set an integer array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformIntArray(name: string, value: number[]) {\n    this.setUniform('uniform1iv', name, value);\n  }\n\n  /**\n   * Set a boolean uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformBoolean(name: string, value: boolean) {\n    this.setUniform('uniform1i', name, value ? 1 : 0);\n  }\n\n  /**\n   * Set a float uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloat(name: string, value: number) {\n    this.setUniform('uniform1f', name, value);\n  }\n\n  /**\n   * Set a float array uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatArray(name: string, value: number[]) {\n    this.setUniform('uniform1fv', name, value);\n  }\n\n  /**\n   * Set a [[Vector]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformFloatVector(name: string, value: Vector) {\n    this.setUniform('uniform2f', name, value.x, value.y);\n  }\n\n  /**\n   * Set an [[Matrix]] uniform for the current shader\n   *\n   * **Important** Must call ex.Shader.use() before setting a uniform!\n   *\n   * @param name\n   * @param value\n   */\n  setUniformMatrix(name: string, value: Matrix) {\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\n  }\n\n  /**\n   * Set any available uniform type in webgl\n   *\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\n   */\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\n    if (!this._compiled) {\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\n    }\n    if (!this.isCurrentlyBound()) {\n      throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\n      ' must call `shader.use()` before setting uniforms');\n    }\n    const gl = this._gl;\n    const location = gl.getUniformLocation(this.program, name);\n    if (location) {\n      const args = [location, ...value];\n      this._gl[uniformType].apply(this._gl, args);\n    } else {\n      throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,`+\n      ' unused uniforms are optimized away by most browsers');\n    }\n  }\n\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n    const program = gl.createProgram();\n    if (program === null) {\n      throw Error('Could not create graphics shader program');\n    }\n\n    // attach the shaders.\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n\n    // link the program.\n    gl.linkProgram(program);\n\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (!success) {\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\n    }\n\n    return program;\n  }\n\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\n    const shader = gl.createShader(type);\n    if (shader === null) {\n      throw Error(`Could not build shader: [${source}]`);\n    }\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n    if (!success) {\n      const errorInfo = gl.getShaderInfoLog(shader);\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\n    }\n    return shader;\n  }\n\n  private _processSourceForError(source: string, errorInfo: string) {\n    const lines = source.split('\\n');\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\n    const [_, error2] = errorInfo.slice(errorLineStart, errorLineEnd).split(':').map(v => Number(v));\n    for (let i = 0; i < lines.length; i++) {\n      lines[i] = `${i+1}: ${lines[i]}${error2 === (i+1)? ' <----- ERROR!' : ''}`;\n    }\n\n    return '\\n\\nSource:\\n' + lines.join('\\n');\n  }\n}","import { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\nexport interface VertexBufferOptions {\n  /**\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\n   *\n   * Ignored if data is passed directly\n   */\n  size?: number;\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  type?: 'static' | 'dynamic';\n\n  /**\n   * Optionally pass pre-seeded data, size parameter is ignored\n   */\n  data?: Float32Array\n}\n\n/**\n * Helper around vertex buffer to simplify creating and uploading geometry\n *\n * Under the hood uses Float32Array\n */\nexport class VertexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n\n  /**\n   * Access to the webgl buffer handle\n   */\n  public readonly buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the vertex buffer\n   */\n  public readonly bufferData: Float32Array;\n\n  /**\n   * If the vertices never change switching 'static' can be more efficient on the gpu\n   *\n   * Default is 'dynamic'\n   */\n  public type: 'static' | 'dynamic' = 'dynamic';\n\n  constructor(options: VertexBufferOptions) {\n    const { size, type, data } = options;\n    this.buffer = this._gl.createBuffer();\n    if (!data && !size) {\n      throw Error('Must either provide data or a size to the VertexBuffer');\n    }\n\n    if (!data) {\n      this.bufferData = new Float32Array(size);\n    } else {\n      this.bufferData = data;\n    }\n    this.type = type ?? this.type;\n  }\n\n  /**\n   * Bind this vertex buffer\n   */\n  bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n  }\n\n  /**\n   * Upload vertex buffer geometry to the GPU\n   */\n  upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\n  }\n}","import { Logger } from '../..';\nimport { Shader, VertexAttributeDefinition } from './shader';\nimport { VertexBuffer } from './vertex-buffer';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { getGlTypeSizeBytes } from './webgl-util';\n\n\nexport interface VertexLayoutOptions {\n  /**\n   * Shader that this layout will be for\n   */\n  shader: Shader;\n  /**\n   * Vertex buffer to use for vertex data\n   */\n  vertexBuffer: VertexBuffer,\n  /**\n   * Specify the attributes that will exist in the vertex buffer\n   *\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\n   */\n  attributes: [name: string, numberOfComponents: number][]\n}\n\n/**\n * Helper around creating vertex attributes in a given [[VertexBuffer]], this is useful for describing\n * the memory layout for your vertices inside a particular buffer\n *\n * Note: This helper assumes interleaved attributes in one [[VertexBuffer]], not many.\n *\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\n */\nexport class VertexLayout {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger = Logger.getInstance();\n  private _shader: Shader;\n  private _layout: VertexAttributeDefinition[] = [];\n  private _attributes: [name: string, numberOfComponents: number][] = [];\n  private _vertexBuffer: VertexBuffer;\n  public get vertexBuffer() {\n    return this._vertexBuffer;\n  }\n\n  public get attributes(): readonly [name: string, numberOfComponents: number][] {\n    return this._attributes;\n  }\n\n  constructor(options: VertexLayoutOptions) {\n    const {shader, vertexBuffer, attributes} = options;\n    this._vertexBuffer = vertexBuffer;\n    this._attributes = attributes;\n    this._shader = shader;\n    this.initialize();\n  }\n\n  private _vertexTotalSizeBytes = 0;\n  /**\n   * Total number of bytes that the vertex will take up\n   */\n  public get totalVertexSizeBytes(): number {\n    return this._vertexTotalSizeBytes;\n  }\n\n  /**\n   * Layouts need shader locations and must be bound to a shader\n   */\n  initialize() {\n    if (!this._shader.compiled) {\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\n    }\n    this._layout.length = 0;\n    const shaderAttributes = this._shader.attributes;\n    for (const attribute of this._attributes) {\n      const attrib = shaderAttributes[attribute[0]];\n      if (!attrib) {\n        throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}`+\n        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\n      }\n      if (attrib.size !== attribute[1]) {\n        throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],`\n        +` doesnt match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\n      }\n      this._layout.push(attrib);\n    }\n\n    // calc size\n    let componentsPerVertex = 0;\n    for (const vertAttribute of this._layout) {\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\n      componentsPerVertex += vertAttribute.size;\n    }\n\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\n      this._logger.warn(`The vertex component size (${componentsPerVertex})  does divide evenly into the specified vertex buffer`\n      +` (${this._vertexBuffer.bufferData.length})`);\n    }\n  }\n\n  /**\n   * Bind this layout with it's associated vertex buffer\n   *\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\n   */\n  use(uploadBuffer = false) {\n    const gl = this._gl;\n    if (!this._shader.isCurrentlyBound()) {\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\n    }\n    this._vertexBuffer.bind();\n    if (uploadBuffer) {\n      this._vertexBuffer.upload();\n    }\n    let offset = 0;\n    // TODO switch to VAOs if the extension is\n    for (const vert of this._layout) {\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\n      gl.enableVertexAttribArray(vert.location);\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\n    }\n  }\n}","export class GraphicsDiagnostics {\n  public static DrawCallCount: number = 0;\n  public static DrawnImagesCount: number = 0;\n  public static clear(): void {\n    GraphicsDiagnostics.DrawCallCount = 0;\n    GraphicsDiagnostics.DrawnImagesCount = 0;\n  }\n}\n","import { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport lineVertexSource from './line-vertex.glsl';\nimport lineFragmentSource from './line-fragment.glsl';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class LineRenderer implements RendererPlugin {\n  public readonly type = 'ex.line';\n  public priority: number = 0;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _maxLines: number = 10922;\n  private _vertexBuffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _vertexIndex = 0;\n  private _lineCount = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: lineVertexSource,\n      fragmentSource: lineFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    this._vertexBuffer = new VertexBuffer({\n      size: 6 * 2 * this._maxLines,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      vertexBuffer: this._vertexBuffer,\n      shader: this._shader,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4]\n      ]\n    });\n  }\n\n  draw(start: Vector, end: Vector, color: Color): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._lineCount++;\n\n    const transform = this._context.getTransform();\n    const finalStart = transform.multiply(start);\n    const finalEnd = transform.multiply(end);\n\n\n    const vertexBuffer = this._vertexBuffer.bufferData;\n    // Start\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n\n    // End\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n  }\n\n  private _isFull() {\n    if (this._lineCount >= this._maxLines) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._lineCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._lineCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\n\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // reset\n    this._vertexIndex = 0;\n    this._lineCount = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\n\\nvarying lowp vec4 v_color;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Passthrough the color\\n   v_color = a_color;\\n}\";","export default \"precision mediump float;\\n\\n// Color\\nvarying lowp vec4 v_color;\\n\\n\\nvoid main() {\\n  gl_FragColor = v_color;\\n}\";","import pointVertexSource from './point-vertex.glsl';\nimport pointFragmentSource from './point-fragment.glsl';\nimport { Vector } from '../../../Math/vector';\nimport { Color } from '../../../Color';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\n\nexport class PointRenderer implements RendererPlugin {\n  public readonly type = 'ex.point';\n  public priority: number = 0;\n  private _shader: Shader;\n  private _maxPoints: number = 10922;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _pointCount: number = 0;\n  private _vertexIndex: number = 0;\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    this._shader = new Shader({\n      vertexSource: pointVertexSource,\n      fragmentSource: pointFragmentSource\n    });\n    this._shader.compile();\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n    this._buffer = new VertexBuffer({\n      size: 7 * this._maxPoints,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_color', 4],\n        ['a_size', 1]\n      ]\n    });\n  }\n\n  draw(point: Vector, color: Color, size: number): void {\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._pointCount++;\n\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const finalPoint = transform.multiply(point);\n\n    const vertexBuffer = this._buffer.bufferData;\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\n  }\n\n  private _isFull() {\n    if (this._pointCount >= this._maxPoints) {\n      return true;\n    }\n    return false;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._pointCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._pointCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use(true);\n\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    this._pointCount = 0;\n    this._vertexIndex = 0;\n  }\n}\n","export default \"attribute vec2 a_position;\\nattribute vec4 a_color;\\nattribute float a_size;\\nvarying lowp vec4 v_color;\\nuniform mat4 u_matrix;\\n\\nvoid main() {\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n  gl_PointSize = a_size * 2.0;\\n  v_color = a_color;\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision mediump float;\\nvarying lowp vec4 v_color;\\n\\nvoid main() {\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\n  r = dot(cxy, cxy);\\n\\n#ifdef GL_OES_standard_derivatives\\n  delta = fwidth(r);\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\n#else\\n  if (r > 1.0) {\\n    discard;\\n  }\\n#endif\\n  // \\\"premultiply\\\" the color by alpha\\n  vec4 color = v_color;\\n  color.a = color.a * alpha;\\n  color.rgb = color.rgb * color.a;\\n  gl_FragColor = color;\\n}\";","\nimport screenVertex from './screen-vertex.glsl';\nimport screenFragment from './screen-fragment.glsl';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\n\n/**\n * This is responsible for painting the entire screen during the render passes\n */\nexport class ScreenPassPainter {\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(gl: WebGLRenderingContext) {\n    this._gl = gl;\n    this._shader = new Shader({\n      vertexSource: screenVertex,\n      fragmentSource: screenFragment\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\n    const gl = this._gl;\n    postprocessor.getShader().use();\n    postprocessor.getLayout().use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  renderToScreen(): void {\n    const gl = this._gl;\n    this._shader.use();\n    this._layout.use();\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}","export default \"attribute vec2 a_position;\\n\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\nvoid main() {\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\n\\n  // Pass the texcoord to the fragment shader.\\n  v_texcoord = a_texcoord;\\n}\";","export default \"precision mediump float;\\n\\n// Passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// The texture.\\nuniform sampler2D u_texture;\\n\\nvoid main() {\\n   gl_FragColor = texture2D(u_texture, v_texcoord);\\n}\";","import { Logger } from '../..';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\n\n/**\n * Helper that defines and index buffer for quad geometry\n *\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\n * it is almost always worth it in terms of performance to use an index buffer.\n */\nexport class QuadIndexBuffer {\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Access to the webgl buffer handle\n   */\n  public buffer: WebGLBuffer;\n  /**\n   * Access to the raw data of the index buffer\n   */\n  public bufferData: Uint16Array | Uint32Array;\n  /**\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\n   */\n  public bufferGlType: number;\n\n  /**\n   * @param numberOfQuads Specify the max number of quads you want to draw\n   * @param useUint16 Optionally force a uint16 buffer\n   */\n  constructor(numberOfQuads: number, useUint16?: boolean) {\n    const gl = this._gl;\n    this.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n\n    const totalVertices = numberOfQuads * 6;\n\n    const ext = gl.getExtension('OES_element_index_uint');\n    if (ext && !useUint16) {\n      this.bufferData = new Uint32Array(totalVertices);\n    } else {\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\n      const maxUint16 = 65_535;\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\n\n      this.bufferGlType = gl.UNSIGNED_SHORT;\n      this.bufferData = new Uint16Array(totalVertices);\n      // TODO Should we error if this happens?? maybe not might crash mid game\n      if (numberOfQuads > maxUint16Index) {\n        this._logger.warn(\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\n      }\n    }\n\n\n    let currentQuad = 0;\n    for (let i = 0; i < totalVertices; i += 6) {\n      // first triangle\n      this.bufferData[i + 0] = currentQuad + 0;\n      this.bufferData[i + 1] = currentQuad + 1;\n      this.bufferData[i + 2] = currentQuad + 2;\n      // second triangle\n      this.bufferData[i + 3] = currentQuad + 2;\n      this.bufferData[i + 4] = currentQuad + 1;\n      this.bufferData[i + 5] = currentQuad + 3;\n      currentQuad += 4;\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  public get size() {\n    return this.bufferData.length;\n  }\n\n  /**\n   * Upload data to the GPU\n   */\n  public upload() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\n  }\n\n  /**\n   * Bind this index buffer\n   */\n  public bind() {\n    const gl = this._gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\n  }\n}","import { vec } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { TextureLoader } from '../texture-loader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\nimport { ensurePowerOfTwo } from '../webgl-util';\nimport frag from './image-renderer.frag.glsl';\nimport vert from './image-renderer.vert.glsl';\n\nexport class ImageRenderer implements RendererPlugin {\n  public readonly type = 'ex.image';\n  public priority: number = 0;\n\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\n  private _maxTextures: number = 0;\n\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  // Per flush vars\n  private _imageCount: number = 0;\n  private _textures: WebGLTexture[] = [];\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    // Transform shader source\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\n    this._maxTextures = Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS), 125);\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\n    // Compile shader\n    this._shader = new Shader({\n      fragmentSource: transformedFrag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\n    this._shader.setUniformIntArray(\n      'u_textures',\n      [...Array(this._maxTextures)].map((_, i) => i)\n    );\n\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      size: 6 * 4 * this._maxImages, // 6 components * 4 verts\n      type: 'dynamic'\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_opacity', 1],\n        ['a_texcoord', 2],\n        ['a_textureIndex', 1]\n      ]\n    });\n\n    // Setup index buffer\n    this._quads = new QuadIndexBuffer(this._maxImages, true);\n  }\n\n  private _transformFragmentSource(source: string, maxTextures: number): string {\n    let newSource = source.replace('%%count%%', maxTextures.toString());\n    let texturePickerBuilder = '';\n    for (let i = 0; i < maxTextures; i++) {\n      if (i === 0) {\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\n      } else {\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\n      }\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\n      texturePickerBuilder += `   }\\n`;\n    }\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\n    return newSource;\n  }\n\n  private _addImageAsTexture(image: HTMLImageSource) {\n    const texture = TextureLoader.load(image);\n    if (this._textures.indexOf(texture) === -1) {\n      this._textures.push(texture);\n    }\n  }\n\n  private _bindTextures(gl: WebGLRenderingContext) {\n    // Bind textures in the correct order\n    for (let i = 0; i < this._maxTextures; i++) {\n      gl.activeTexture(gl.TEXTURE0 + i);\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\n    }\n  }\n\n  private _getTextureIdForImage(image: HTMLImageSource) {\n    if (image) {\n      return this._textures.indexOf(TextureLoader.get(image));\n    }\n    return -1;\n  }\n\n  private _isFull() {\n    if (this._imageCount >= this._maxImages) {\n      return true;\n    }\n    if (this._textures.length >= this._maxTextures) {\n      return true;\n    }\n    return false;\n  }\n\n\n  draw(image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number): void {\n\n    // Force a render if the batch is full\n    if (this._isFull()) {\n      this.flush();\n    }\n\n    this._imageCount++;\n    this._addImageAsTexture(image);\n\n    let width = image?.width || swidth || 0;\n    let height = image?.height || sheight || 0;\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n    let dest = [sx ?? 1, sy ?? 1];\n    // If destination is specified, update view and dest\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\n      dest = [dx, dy];\n      width = dwidth;\n      height = dheight;\n    }\n\n    sx = view[0];\n    sy = view[1];\n    const sw = view[2];\n    const sh = view[3];\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n    const snapToPixel = this._context.snapToPixel;\n\n    let topLeft = vec(dest[0], dest[1]);\n    let topRight = vec(dest[0] + width, dest[1]);\n    let bottomLeft = vec(dest[0], dest[1] + height);\n    let bottomRight = vec(dest[0] + width, dest[1] + height);\n\n    topLeft = transform.multiply(topLeft);\n    topRight = transform.multiply(topRight);\n    bottomLeft = transform.multiply(bottomLeft);\n    bottomRight = transform.multiply(bottomRight);\n\n    if (snapToPixel) {\n      topLeft.x = ~~topLeft.x;\n      topLeft.y = ~~topLeft.y;\n\n      topRight.x = ~~topRight.x;\n      topRight.y = ~~topRight.y;\n\n      bottomLeft.x = ~~bottomLeft.x;\n      bottomLeft.y = ~~bottomLeft.y;\n\n      bottomRight.x = ~~bottomRight.x;\n      bottomRight.y = ~~bottomRight.y;\n    }\n\n    const textureId = this._getTextureIdForImage(image);\n    const potWidth = ensurePowerOfTwo(image.width || width);\n    const potHeight = ensurePowerOfTwo(image.height || height);\n\n    const uvx0 = (sx) / potWidth;\n    const uvy0 = (sy) / potHeight;\n    const uvx1 = (sx + sw - 0.01) / potWidth;\n    const uvy1 = (sy + sh - 0.01) / potHeight;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = textureId;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = textureId;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._imageCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._imageCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind textures to\n    this._bindTextures(gl);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._imageCount = 0;\n    this._vertexIndex = 0;\n    this._textures.length = 0;\n  }\n}","export default \"precision mediump float;\\n\\n// UV coord\\nvarying vec2 v_texcoord;\\n\\n// Texture index\\nvarying lowp float v_textureIndex;\\n\\n// Textures in the current draw\\nuniform sampler2D u_textures[%%count%%];\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n   // In order to support the most efficient sprite batching, we have multiple\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\n   // that do not apply to a particular sprite.\\n\\n   vec4 color = vec4(1.0, 0, 0, 1.0);\\n\\n   // GLSL is templated out to pick the right texture and set the vec4 color\\n   %%texture_picker%%\\n\\n   color.rgb = color.rgb * v_opacity;\\n   color.a = color.a * v_opacity;\\n   gl_FragColor = color;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\n// UV coordinate\\nattribute vec2 a_texcoord;\\nvarying vec2 v_texcoord;\\n\\n// Texture number\\nattribute lowp float a_textureIndex;\\nvarying lowp float v_textureIndex;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the UV coord to the fragment shader\\n   v_texcoord = a_texcoord;\\n   // Pass through the texture number to the fragment shader\\n   v_textureIndex = a_textureIndex;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './rectangle-renderer.frag.glsl';\nimport vert from './rectangle-renderer.vert.glsl';\n\nexport class RectangleRenderer implements RendererPlugin {\n  public readonly type = 'ex.rectangle';\n  public priority: number = 0;\n\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _gl: WebGLRenderingContext;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n  private _rectangleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 16 * 4 * this._maxRectangles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_size', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n    this._quads = new QuadIndexBuffer(this._maxRectangles, true);\n  }\n\n  private _isFull() {\n    if (this._rectangleCount >= this._maxRectangles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(...args: any[]): void {\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\n      this.drawLine.apply(this, args);\n    } else {\n      this.drawRectangle.apply(this, args);\n    }\n  }\n\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\n\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const dir = end.sub(start);\n    const length = dir.size;\n    const normal = dir.normalize().perpendicular();\n    const halfThick = thickness / 2;\n\n    /**\n     *    +---------------------^----------------------+\n     *    |                     | (normal)             |\n     *   (startx, starty)------------------>(endx, endy)\n     *    |                                            |\n     *    + -------------------------------------------+\n     */\n    const startTop = transform.multiply(normal.scale(halfThick).add(start));\n    const startBottom = transform.multiply(normal.scale(-halfThick).add(start));\n    const endTop = transform.multiply(normal.scale(halfThick).add(end));\n    const endBottom = transform.multiply(normal.scale(-halfThick).add(end));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    const stroke = Color.Transparent;\n    const strokeThickness = 0;\n    const width = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = startTop.x;\n    vertexBuffer[this._vertexIndex++] = startTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = endTop.x;\n    vertexBuffer[this._vertexIndex++] = endTop.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = length;\n    vertexBuffer[this._vertexIndex++] = thickness;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\n  }\n\n  drawRectangle(\n    pos: Vector,\n    width: number,\n    height: number,\n    color: Color,\n    stroke: Color = Color.Transparent,\n    strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._rectangleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\n\n    // TODO uv could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = width;\n    vertexBuffer[this._vertexIndex++] = height;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\n\n  }\n\n  hasPendingDraws(): boolean {\n    return this._rectangleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._rectangleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._rectangleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision mediump float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\nvarying vec2 v_size; // in pixels\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness; // in pixels\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\n    vec2 uv = v_uv;\\n    vec2 fragCoord = uv * v_size;\\n    float maxX = v_size.x - v_strokeThickness;\\n    float minX = v_strokeThickness;\\n    float maxY = v_size.y - v_strokeThickness;\\n    float minY = v_strokeThickness;\\n\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\n      gl_FragColor = v_color;\\n    } else {\\n      gl_FragColor = v_strokeColor;\\n    }\\n    gl_FragColor.a *= v_opacity;\\n    gl_FragColor.rgb *= gl_FragColor.a;\\n\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\n\\n    // float fHalfBorderDist      = 0.0;\\n    // float fHalfBorderThickness = 0.0;\\n\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\n    // {\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\n    // }\\n    // else\\n    // {\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\n        \\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\n            \\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\n    // }\\n\\n    // vec4 v4FromColor = v_strokeColor;\\n    // v4FromColor.rgb *= v4FromColor.a;\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\n    // if (fHalfBorderDist < 0.0) {\\n    //     v4ToColor = v_color;\\n    //     v4ToColor.rgb *= v4ToColor.a;\\n    // }\\n\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\n\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\n    // gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\nattribute vec2 a_size;\\nvarying vec2 v_size;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through size\\n   v_size = a_size;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import { Color } from '../../../Color';\nimport { vec, Vector } from '../../../Math/vector';\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\nimport { QuadIndexBuffer } from '../quad-index-buffer';\nimport { RendererPlugin } from '../renderer';\nimport { Shader } from '../shader';\nimport { VertexBuffer } from '../vertex-buffer';\nimport { VertexLayout } from '../vertex-layout';\n\nimport frag from './circle-renderer.frag.glsl';\nimport vert from './circle-renderer.vert.glsl';\n\nexport class CircleRenderer implements RendererPlugin {\n  public readonly type = 'ex.circle';\n  public priority: number = 0;\n\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\n\n  private _shader: Shader;\n  private _context: ExcaliburGraphicsContextWebGL;\n  private _gl: WebGLRenderingContext;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  private _quads: QuadIndexBuffer;\n\n  private _circleCount: number = 0;\n  private _vertexIndex: number = 0;\n\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\n    this._gl = gl;\n    this._context = context;\n    gl.getExtension('OES_standard_derivatives');\n    this._shader = new Shader({\n      fragmentSource: frag,\n      vertexSource: vert\n    });\n    this._shader.compile();\n\n    // setup uniforms\n    this._shader.use();\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\n\n    this._buffer = new VertexBuffer({\n      size: 14 * 4 * this._maxCircles,\n      type: 'dynamic'\n    });\n\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_uv', 2],\n        ['a_opacity', 1],\n        ['a_color', 4],\n        ['a_strokeColor', 4],\n        ['a_strokeThickness', 1]\n      ]\n    });\n\n    this._quads = new QuadIndexBuffer(this._maxCircles, true);\n  }\n\n  private _isFull() {\n    if (this._circleCount >= this._maxCircles) {\n      return true;\n    }\n    return false;\n  }\n\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\n    if (this._isFull()) {\n      this.flush();\n    }\n    this._circleCount++;\n\n    // transform based on current context\n    const transform = this._context.getTransform();\n    const opacity = this._context.opacity;\n\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\n\n    // TODO UV could be static vertex buffer\n    const uvx0 = 0;\n    const uvy0 = 0;\n    const uvx1 = 1;\n    const uvy1 = 1;\n\n    // update data\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\n\n    // (0, 0) - 0\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (0, 1) - 1\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\n    vertexBuffer[this._vertexIndex++] = uvx0;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 0) - 2\n    vertexBuffer[this._vertexIndex++] = topRight.x;\n    vertexBuffer[this._vertexIndex++] = topRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy0;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n\n    // (1, 1) - 3\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\n    vertexBuffer[this._vertexIndex++] = uvx1;\n    vertexBuffer[this._vertexIndex++] = uvy1;\n    vertexBuffer[this._vertexIndex++] = opacity;\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\n    vertexBuffer[this._vertexIndex++] = color.a;\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\n    vertexBuffer[this._vertexIndex++] = stroke.a;\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\n  }\n\n  hasPendingDraws(): boolean {\n    return this._circleCount !== 0;\n  }\n\n  flush(): void {\n    // nothing to draw early exit\n    if (this._circleCount === 0) {\n      return;\n    }\n\n    const gl = this._gl;\n    // Bind the shader\n    this._shader.use();\n\n    // Bind the memory layout and upload data\n    this._layout.use(true);\n\n    // Update ortho matrix uniform\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\n\n    // Bind index buffer\n    this._quads.bind();\n\n    // Draw all the quads\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\n\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\n    GraphicsDiagnostics.DrawCallCount++;\n\n    // Reset\n    this._circleCount = 0;\n    this._vertexIndex = 0;\n  }\n\n}","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\nprecision highp float;\\n\\n// UV coord\\nvarying vec2 v_uv;\\n\\n// Color coord to blend with image\\nvarying lowp vec4 v_color;\\n\\n// Stroke color if used\\nvarying lowp vec4 v_strokeColor;\\n\\n// Stroke thickness if used\\nvarying lowp float v_strokeThickness;\\n\\n// Opacity\\nvarying float v_opacity;\\n\\nvoid main() {\\n  // make (0, 0) the center the uv \\n  vec2 uv = v_uv * 2.0 - 1.0;\\n\\n  vec4 color = v_color;\\n  vec4 strokeColor = v_strokeColor;\\n\\n  // circle border is at radius 1.0 \\n  // dist is > 0 when inside the circle \\n  float d = length(uv);\\n  float dist = 1.0 - length(uv);\\n\\n  // Fade based on fwidth\\n  float fade = fwidth(dot(uv, uv));\\n\\n  // if dist is greater than 0 step to 1;\\n  // when we cross this 0 threshold add a smooth fade\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\n\\n  // if dist is greater than the stroke thickness step to 1\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\n\\n  strokeColor.a *= fill * stroke;\\n  strokeColor.rgb *= strokeColor.a;\\n\\n  color.a *= fill * (1.0 - stroke);\\n  color.rgb *= color.a;\\n\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\n  finalColor.a = finalColor.a * v_opacity;\\n  gl_FragColor = finalColor;\\n}\";","export default \"attribute vec2 a_position;\\n\\n// UV coordinate\\nattribute vec2 a_uv;\\nvarying vec2 v_uv;\\n\\n// Opacity \\nattribute float a_opacity;\\nvarying float v_opacity;\\n\\nattribute vec4 a_color;\\nvarying vec4 v_color;\\n\\nattribute vec4 a_strokeColor;\\nvarying vec4 v_strokeColor;\\n\\nattribute float a_strokeThickness;\\nvarying float v_strokeThickness;\\n\\nuniform mat4 u_matrix;\\n\\n\\nvoid main() {\\n   // Set the vertex position using the ortho transform matrix\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\n\\n   // Pass through UV coords\\n   v_uv = a_uv;\\n   // Pass through the Opacity to the fragment shader\\n   v_opacity = a_opacity;\\n   // Pass through the color to the fragment shader\\n   v_color = a_color;\\n   // Pass through the stroke color to the fragment shader\\n   v_strokeColor = a_strokeColor;\\n   // Pass through the stroke thickenss to the fragment shader\\n   v_strokeThickness = a_strokeThickness;\\n}\";","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  RectGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\n\nimport { Matrix } from '../../Math/matrix';\nimport { TransformStack } from './transform-stack';\nimport { Vector, vec } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { Logger } from '../../Util/Log';\nimport { Canvas } from '../Canvas';\nimport { DebugText } from './debug-text';\nimport { ScreenDimension } from '../../Screen';\nimport { RenderTarget } from './render-target';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\nimport { TextureLoader } from './texture-loader';\nimport { RendererPlugin } from './renderer';\n\n// renderers\nimport { LineRenderer } from './line-renderer/line-renderer';\nimport { PointRenderer } from './point-renderer/point-renderer';\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\nimport { ImageRenderer } from './image-renderer/image-renderer';\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\n\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\n\n  /**\n   * Draw a debugging rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\n  }\n\n  /**\n   * Draw a debugging line to the context\n   * @param start\n   * @param end\n   * @param lineOptions\n   */\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions.color);\n  }\n\n  /**\n   * Draw a debugging point to the context\n   * @param point\n   * @param pointOptions\n   */\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._webglCtx, text, pos);\n  }\n}\n\nexport interface WebGLGraphicsContextInfo {\n  transform: TransformStack;\n  state: StateStack;\n  ortho: Matrix;\n  context: ExcaliburGraphicsContextWebGL;\n}\n\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\n  private _logger = Logger.getInstance();\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\n  private _isDrawLifecycle = false;\n\n  // Main render target\n  private _renderTarget: RenderTarget;\n\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\n  private _postProcessTargets: RenderTarget[] = [];\n\n  private _screenRenderer: ScreenPassPainter;\n\n  private _postprocessors: PostProcessor[] = [];\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __gl: WebGLRenderingContext;\n\n  /**\n   * Holds the 2d context shim\n   */\n  private _canvas: Canvas; // Configure z for shim?\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n\n  private _transform = new TransformStack();\n  private _state = new StateStack();\n  private _ortho!: Matrix;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __lineRenderer: LineRenderer;\n\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  // public __imageRenderer: ImageRenderer;\n\n  public snapToPixel: boolean = true;\n\n  public smoothing: boolean = false;\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public get width() {\n    return this.__gl.canvas.width;\n  }\n\n  public get height() {\n    return this.__gl.canvas.height;\n  }\n\n  public get ortho(): Matrix {\n    return this._ortho;\n  }\n\n  /**\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\n   * @param dim\n   */\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\n    let supported = true;\n    if (dim.width > 4096 || dim.height > 4096) {\n      supported = false;\n    }\n    return supported;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\n    this.__gl = canvasElement.getContext('webgl', {\n      antialias: smoothing ?? this.smoothing,\n      premultipliedAlpha: false,\n      alpha: enableTransparency ?? true,\n      depth: true,\n      powerPreference: 'high-performance'\n    });\n    ExcaliburWebGLContextAccessor.register(this.__gl);\n    TextureLoader.register(this.__gl);\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this._init();\n  }\n\n  private _init() {\n    const gl = this.__gl;\n    // Setup viewport and view matrix\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n\n    // Clear background\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    // Enable alpha blending\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\n    gl.enable(gl.BLEND);\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n    // Setup builtin renderers\n    this.register(new ImageRenderer());\n    this.register(new RectangleRenderer());\n    this.register(new CircleRenderer());\n    this.register(new PointRenderer());\n    this.register(new LineRenderer());\n\n    this._screenRenderer = new ScreenPassPainter(gl);\n\n    this._renderTarget = new RenderTarget({\n      gl,\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n\n\n    this._postProcessTargets = [\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      }),\n      new RenderTarget({\n        gl,\n        width: gl.canvas.width,\n        height: gl.canvas.height\n      })\n    ];\n\n    // 2D ctx shim\n    this._canvas = new Canvas({\n      width: gl.canvas.width,\n      height: gl.canvas.height\n    });\n    this.__ctx = this._canvas.ctx;\n  }\n\n  public register<T extends RendererPlugin>(renderer: T) {\n    this._renderers.set(renderer.type, renderer);\n    renderer.initialize(this.__gl, this);\n  }\n\n  public get(rendererName: string): RendererPlugin {\n    return this._renderers.get(rendererName);\n  }\n\n  private _currentRenderer: RendererPlugin;\n\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\n      return true;\n    }\n    return false;\n  }\n\n  public beginDrawLifecycle() {\n    this._isDrawLifecycle = true;\n  }\n\n  public endDrawLifecycle() {\n    this._isDrawLifecycle = false;\n  }\n\n  private _alreadyWarnedDrawLifecycle = false;\n\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\n    if (!this._isDrawLifecycle && !this._alreadyWarnedDrawLifecycle) {\n      this._logger.warn(\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\n        `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\n      this._alreadyWarnedDrawLifecycle = true;\n    }\n    // TODO does not handle priority yet...\n    //  in order to do this draw commands need to be captured and fed in priority order\n    const renderer = this._renderers.get(rendererName);\n    if (renderer) {\n      // Set the current renderer if not defined\n      if (!this._currentRenderer) {\n        this._currentRenderer = renderer;\n      }\n\n      if (!this._isCurrentRenderer(renderer)) {\n        // switching graphics means we must flush the previous\n        this._currentRenderer.flush();\n      }\n\n      // If we are still using the same renderer we can add to the current batch\n      renderer.draw(...args);\n\n      this._currentRenderer = renderer;\n    } else {\n      throw Error(`No renderer with name ${rendererName} has been registered`);\n    }\n  }\n\n  public resetTransform(): void {\n    this._transform.current = Matrix.identity();\n  }\n\n  public updateViewport(resolution: ScreenDimension): void {\n    const gl = this.__gl;\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\n\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\n\n    // 2D ctx shim\n    this._canvas.width = gl.canvas.width;\n    this._canvas.height = gl.canvas.height;\n  }\n\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    if (!image) {\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\n      // tslint:disable-next-line: no-console\n      if (console.trace) {\n        // tslint:disable-next-line: no-console\n        console.trace();\n      }\n      return;\n    }\n    this.draw<ImageRenderer>('ex.image', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\n  }\n\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\n\n  public save(): void {\n    this._transform.save();\n    this._state.save();\n  }\n\n  public restore(): void {\n    this._transform.restore();\n    this._state.restore();\n  }\n\n  public translate(x: number, y: number): void {\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  public rotate(angle: number): void {\n    this._transform.rotate(angle);\n  }\n\n  public scale(x: number, y: number): void {\n    this._transform.scale(x, y);\n  }\n\n  public transform(matrix: Matrix) {\n    this._transform.current = matrix;\n  }\n\n  public getTransform(): Matrix {\n    return this._transform.current;\n  }\n\n  public multiply(m: Matrix) {\n    this._transform.current = this._transform.current.multiply(m);\n  }\n\n  public addPostProcessor(postprocessor: PostProcessor) {\n    this._postprocessors.push(postprocessor);\n    postprocessor.initialize(this.__gl);\n  }\n\n  public removePostProcessor(postprocessor: PostProcessor) {\n    const index = this._postprocessors.indexOf(postprocessor);\n    if (index !== -1) {\n      this._postprocessors.splice(index, 1);\n    }\n  }\n\n  public clearPostProcessors() {\n    this._postprocessors.length = 0;\n  }\n\n  clear() {\n    const gl = this.__gl;\n    this._renderTarget.use();\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\n    // Clear the context with the newly set color. This is\n    // the function call that actually does the drawing.\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  }\n\n  /**\n   * Flushes all batched rendering to the screen\n   */\n  flush() {\n    const gl = this.__gl;\n\n    // render target captures all draws and redirects to the render target\n    this._renderTarget.use();\n    // This is the final flush at the moment to draw any leftover pending draw\n    // TODO sort by priority and flush in order\n    for (const renderer of this._renderers.values()) {\n      if (renderer.hasPendingDraws()) {\n        renderer.flush();\n      }\n    }\n    this._renderTarget.disable();\n\n    // post process step\n    const source = this._renderTarget.toRenderSource();\n    source.use();\n\n    // flip flop render targets\n    for (let i = 0; i < this._postprocessors.length; i++) {\n      this._postProcessTargets[i % 2].use();\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\n      this._postProcessTargets[i % 2].toRenderSource().use();\n    }\n\n    // passing null switches rendering back to the canvas\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    this._screenRenderer.renderToScreen();\n  }\n}\n","import { Vector, vec } from './Math/vector';\nimport { Logger } from './Util/Log';\nimport { Camera } from './Camera';\nimport { BrowserEvents } from './Util/Browser';\nimport { BoundingBox } from './Collision/Index';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { getPosition } from './Util/Util';\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\n\n/**\n * Enum representing the different display modes available to Excalibur.\n */\nexport enum DisplayMode {\n  /**\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\n   */\n  Fixed = 'Fixed',\n\n  /**\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\n   *\n   * You may want to center your game here is an example\n   * ```html\n   * <!-- html -->\n   * <body>\n   * <main>\n   *   <canvas id=\"game\"></canvas>\n   * </main>\n   * </body>\n   * ```\n   *\n   * ```css\n   * // css\n   * main {\n   *   display: flex;\n   *   align-items: center;\n   *   justify-content: center;\n   *   height: 100%;\n   *   width: 100%;\n   * }\n   * ```\n   *\n   */\n  FitScreen = 'FitScreen',\n\n  /**\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\n   */\n  FillScreen = 'FillScreen',\n\n  /**\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\n   */\n  FitContainer = 'FitContainer',\n\n  /**\n   * Use the parent DOM container's css width/height for the game resolution dynamically\n   */\n  FillContainer = 'FillContainer',\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\n   */\n  Position = 'Position'\n}\n\n/**\n * Convenience class for quick resolutions\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\n */\nexport class Resolution {\n  /* istanbul ignore next */\n  public static get SVGA(): ScreenDimension {\n    return { width: 800, height: 600 };\n  }\n\n  /* istanbul ignore next */\n  public static get Standard(): ScreenDimension {\n    return { width: 1920, height: 1080 };\n  }\n\n  /* istanbul ignore next */\n  public static get Atari2600(): ScreenDimension {\n    return { width: 160, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoy(): ScreenDimension {\n    return { width: 160, height: 144 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoyAdvance(): ScreenDimension {\n    return { width: 240, height: 160 };\n  }\n\n  /* istanbul ignore next */\n  public static get NintendoDS(): ScreenDimension {\n    return { width: 256, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get NES(): ScreenDimension {\n    return { width: 256, height: 224 };\n  }\n\n  /* istanbul ignore next */\n  public static get SNES(): ScreenDimension {\n    return { width: 256, height: 244 };\n  }\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\nexport type CanvasPosition = string | AbsolutePosition;\n\nexport interface ScreenDimension {\n  width: number;\n  height: number;\n}\n\nexport interface ScreenOptions {\n  /**\n   * Canvas element to build a screen on\n   */\n  canvas: HTMLCanvasElement;\n\n  /**\n   * Graphics context for the screen\n   */\n  context: ExcaliburGraphicsContext;\n\n  /**\n   * Browser abstraction\n   */\n  browser: BrowserEvents;\n  /**\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\n   */\n  antialiasing?: boolean;\n  /**\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\n   */\n  pixelRatio?: number;\n  /**\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\n   * [[DisplayMode.FillScreen]].\n   */\n  resolution?: ScreenDimension;\n  /**\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\n   */\n  viewport: ScreenDimension;\n  /**\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\n   */\n  displayMode?: DisplayMode;\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: CanvasPosition;\n}\n\n/**\n * The Screen handles all aspects of interacting with the screen for Excalibur.\n */\nexport class Screen {\n  public graphicsContext: ExcaliburGraphicsContext;\n  private _canvas: HTMLCanvasElement;\n  private _antialiasing: boolean = true;\n  private _browser: BrowserEvents;\n  private _camera: Camera;\n  private _resolution: ScreenDimension;\n  private _resolutionStack: ScreenDimension[] = [];\n  private _viewport: ScreenDimension;\n  private _viewportStack: ScreenDimension[] = [];\n  private _pixelRatioOverride: number | null = null;\n  private _position: CanvasPosition;\n  private _displayMode: DisplayMode;\n  private _isFullScreen = false;\n  private _mediaQueryList: MediaQueryList;\n  private _isDisposed = false;\n  private _logger = Logger.getInstance();\n  private _resizeObserver: ResizeObserver;\n\n  constructor(options: ScreenOptions) {\n    this.viewport = options.viewport;\n    this.resolution = options.resolution ?? { ...this.viewport };\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\n    this._canvas = options.canvas;\n    this.graphicsContext = options.context;\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\n    this._browser = options.browser;\n    this._position = options.position;\n    this._pixelRatioOverride = options.pixelRatio;\n\n    this._applyDisplayMode();\n\n    this._listenForPixelRatio();\n\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    this.applyResolutionAndViewport();\n  }\n\n  private _listenForPixelRatio() {\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\n      // Safari <=13.1 workaround, remove any existing handlers\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n    }\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n\n    // Safari <=13.1 workaround\n    if (this._mediaQueryList.addEventListener) {\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\n    } else {\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\n    }\n  }\n\n  public dispose(): void {\n    if (!this._isDisposed) {\n      // Clean up handlers\n      this._isDisposed = true;\n      this._browser.window.off('resize', this._resizeHandler);\n      if (this._resizeObserver) {\n        this._resizeObserver.disconnect();\n      }\n      this.parent.removeEventListener('resize', this._resizeHandler);\n      // Safari <=13.1 workaround\n      if (this._mediaQueryList.removeEventListener) {\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\n      } else {\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\n      }\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\n    }\n  }\n\n  private _fullscreenChangeHandler = () => {\n    this._isFullScreen = !this._isFullScreen;\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\n  };\n\n  private _pixelRatioChangeHandler = () => {\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\n    this._listenForPixelRatio();\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\n    this.applyResolutionAndViewport();\n  };\n\n  private _resizeHandler = () => {\n    const parent = this.parent;\n    this._logger.debug('View port resized');\n    this._setResolutionAndViewportByDisplayMode(parent);\n    this.applyResolutionAndViewport();\n  };\n\n  private _calculateDevicePixelRatio() {\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    return devicePixelRatio;\n  }\n\n  // Asking the window.devicePixelRatio is expensive we do it once\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\n\n  public get pixelRatio(): number {\n    if (this._pixelRatioOverride) {\n      return this._pixelRatioOverride;\n    }\n\n    return this._devicePixelRatio;\n  }\n\n  public get isHiDpi() {\n    return this.pixelRatio !== 1;\n  }\n\n  public get displayMode(): DisplayMode {\n    return this._displayMode;\n  }\n\n  public get canvas(): HTMLCanvasElement {\n    return this._canvas;\n  }\n\n  public get parent(): HTMLElement | Window {\n    return <HTMLElement | Window>(\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\n        ? this.canvas.parentElement || document.body\n        : window)\n    );\n  }\n\n  public get resolution(): ScreenDimension {\n    return this._resolution;\n  }\n\n  public set resolution(resolution: ScreenDimension) {\n    this._resolution = resolution;\n  }\n\n  public get viewport(): ScreenDimension {\n    if (this._viewport) {\n      return this._viewport;\n    }\n    return this._resolution;\n  }\n\n  public set viewport(viewport: ScreenDimension) {\n    this._viewport = viewport;\n  }\n\n  public get aspectRatio() {\n    return this._resolution.width / this._resolution.height;\n  }\n\n  public get scaledWidth() {\n    return this._resolution.width * this.pixelRatio;\n  }\n\n  public get scaledHeight() {\n    return this._resolution.height * this.pixelRatio;\n  }\n\n  public setCurrentCamera(camera: Camera) {\n    this._camera = camera;\n  }\n\n  public pushResolutionAndViewport() {\n    this._resolutionStack.push(this.resolution);\n    this._viewportStack.push(this.viewport);\n\n    this.resolution = { ...this.resolution };\n    this.viewport = { ...this.viewport };\n  }\n\n  public peekViewport(): ScreenDimension {\n    return this._viewportStack[this._viewportStack.length - 1];\n  }\n\n  public peekResolution(): ScreenDimension {\n    return this._resolutionStack[this._resolutionStack.length - 1];\n  }\n\n  public popResolutionAndViewport() {\n    this.resolution = this._resolutionStack.pop();\n    this.viewport = this._viewportStack.pop();\n  }\n\n  private _alreadyWarned = false;\n  public applyResolutionAndViewport() {\n    this._canvas.width = this.scaledWidth;\n    this._canvas.height = this.scaledHeight;\n\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      const supported = this.graphicsContext.checkIfResolutionSupported({\n        width: this.scaledWidth,\n        height: this.scaledHeight\n      });\n      if (!supported && !this._alreadyWarned) {\n        this._alreadyWarned = true; // warn once\n        this._logger.warn(\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\n      }\n    }\n\n    if (this._antialiasing) {\n      this._canvas.style.imageRendering = 'auto';\n    } else {\n      this._canvas.style.imageRendering = 'pixelated';\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n      if (this._canvas.style.imageRendering === '') {\n        this._canvas.style.imageRendering = 'crisp-edges';\n      }\n    }\n    this._canvas.style.width = this.viewport.width + 'px';\n    this._canvas.style.height = this.viewport.height + 'px';\n\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\n    this.graphicsContext.updateViewport(this.resolution);\n    this.graphicsContext.resetTransform();\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  public get antialiasing() {\n    return this._antialiasing;\n  }\n\n  public set antialiasing(isSmooth: boolean) {\n    this._antialiasing = isSmooth;\n    this.graphicsContext.smoothing = this._antialiasing;\n  }\n\n  /**\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\n   */\n  public get isFullScreen() {\n    return this._isFullScreen;\n  }\n\n  /**\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\n   * For example, wire this to a user click handler.\n   */\n  public goFullScreen(): Promise<void> {\n    return this._canvas.requestFullscreen();\n  }\n\n  /**\n   * Requests to exit fullscreen using the browser fullscreen api\n   */\n  public exitFullScreen(): Promise<void> {\n    return document.exitFullscreen();\n  }\n\n  /**\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\n   * Excalibur screen space.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public pageToScreenCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    if (!this._isFullScreen) {\n      newX -= getPosition(this._canvas).x;\n      newY -= getPosition(this._canvas).y;\n    }\n\n    // if fullscreen api on it centers with black bars\n    // we need to adjust the screen to world coordinates in this case\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\n        newX = (newX / window.innerWidth) * this.viewport.width;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\n        newY = (newY / window.innerHeight) * this.viewport.height;\n      }\n    }\n\n    newX = (newX / this.viewport.width) * this.resolution.width;\n    newY = (newY / this.viewport.height) * this.resolution.height;\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\n   * this is where html elements might live if you want to position them relative to Excalibur.\n   *\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\n   * bottom right corner (resolutionX, resolutionY)\n   * @param point\n   */\n  public screenToPageCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    newX = (newX / this.resolution.width) * this.viewport.width;\n    newY = (newY / this.resolution.height) * this.viewport.height;\n\n    if (this._isFullScreen) {\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\n        const screenHeight = window.innerWidth / this.aspectRatio;\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\n        newX = (newX / this.viewport.width) * window.innerWidth;\n      } else {\n        const screenWidth = window.innerHeight * this.aspectRatio;\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\n        newY = (newY / this.viewport.height) * window.innerHeight;\n      }\n    }\n\n    if (!this._isFullScreen) {\n      newX += getPosition(this._canvas).x;\n      newY += getPosition(this._canvas).y;\n    }\n\n    return new Vector(newX, newY);\n  }\n\n  /**\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\n   *\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\n   * and extends infinitely out relative from the [[Camera]].\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    // the only difference between screen & world is the camera transform\n    if (this._camera) {\n      return this._camera.inverse.multiply(point);\n    }\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  /**\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\n   *\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    if (this._camera) {\n      return this._camera.transform.multiply(point);\n    }\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\n  }\n\n  public pageToWorldCoordinates(point: Vector): Vector {\n    const screen = this.pageToScreenCoordinates(point);\n    return this.screenToWorldCoordinates(screen);\n  }\n\n  public worldToPageCoordinates(point: Vector): Vector {\n    const screen = this.worldToScreenCoordinates(point);\n    return this.screenToPageCoordinates(screen);\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   *\n   * World bounds are in world coordinates, useful for culling objects offscreen\n   */\n  public getWorldBounds(): BoundingBox {\n    const topLeft = this.screenToWorldCoordinates(Vector.Zero);\n    const right = topLeft.x + this.drawWidth;\n    const bottom = topLeft.y + this.drawHeight;\n\n    return new BoundingBox(topLeft.x, topLeft.y, right, bottom);\n  }\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this._camera) {\n      return this.resolution.width / this._camera.zoom;\n    }\n    return this.resolution.width;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this._camera) {\n      return this.resolution.height / this._camera.zoom;\n    }\n    return this.resolution.height;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  /**\n   * Returns screen center coordinates including zoom and device pixel ratio.\n   */\n  public get center(): Vector {\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\n  }\n\n  private _computeFit() {\n    document.body.style.margin = '0px';\n    document.body.style.overflow = 'hidden';\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    if (window.innerWidth / aspect < window.innerHeight) {\n      adjustedWidth = window.innerWidth;\n      adjustedHeight = window.innerWidth / aspect;\n    } else {\n      adjustedWidth = window.innerHeight * aspect;\n      adjustedHeight = window.innerHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _computeFitContainer() {\n    const aspect = this.aspectRatio;\n    let adjustedWidth = 0;\n    let adjustedHeight = 0;\n    const parent = this.canvas.parentElement;\n    if (parent.clientWidth / aspect < parent.clientHeight) {\n      adjustedWidth = parent.clientWidth;\n      adjustedHeight = parent.clientWidth / aspect;\n    } else {\n      adjustedWidth = parent.clientHeight * aspect;\n      adjustedHeight = parent.clientHeight;\n    }\n\n    this.viewport = {\n      width: adjustedWidth,\n      height: adjustedHeight\n    };\n  }\n\n  private _applyDisplayMode() {\n    if (this.displayMode === DisplayMode.Position) {\n      this._initializeDisplayModePosition(this._position);\n    } else {\n      this._setResolutionAndViewportByDisplayMode(this.parent);\n\n      // watch resizing\n      if (this.parent instanceof Window) {\n        this._browser.window.on('resize', this._resizeHandler);\n      } else {\n        this._resizeObserver = new ResizeObserver(() => {\n          this._resizeHandler();\n        });\n        this._resizeObserver.observe(this.parent);\n      }\n      this.parent.addEventListener('resize', this._resizeHandler);\n    }\n  }\n\n  /**\n   * Sets the resolution and viewport based on the selected display mode.\n   */\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.FillContainer) {\n      this.resolution = {\n        width: (<HTMLElement>parent).clientWidth,\n        height: (<HTMLElement>parent).clientHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FillScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.resolution = {\n        width: (<Window>parent).innerWidth,\n        height: (<Window>parent).innerHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FitScreen) {\n      this._computeFit();\n    }\n\n    if (this.displayMode === DisplayMode.FitContainer) {\n      this._computeFitContainer();\n    }\n  }\n\n  private _initializeDisplayModePosition(position: CanvasPosition) {\n    if (!position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof position === 'string') {\n        const specifiedPosition = position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (position.top) {\n          typeof position.top === 'number'\n            ? (this.canvas.style.top = position.top.toString() + 'px')\n            : (this.canvas.style.top = position.top);\n        }\n        if (position.right) {\n          typeof position.right === 'number'\n            ? (this.canvas.style.right = position.right.toString() + 'px')\n            : (this.canvas.style.right = position.right);\n        }\n        if (position.bottom) {\n          typeof position.bottom === 'number'\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = position.bottom);\n        }\n        if (position.left) {\n          typeof position.left === 'number'\n            ? (this.canvas.style.left = position.left.toString() + 'px')\n            : (this.canvas.style.left = position.left);\n        }\n      }\n    }\n  }\n}","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve(false);\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve(true);\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","import { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher();\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: any) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: any) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: any) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n}\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.save();\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n  ctx.restore();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Color } from './Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\nimport { Canvas } from './Graphics/Canvas';\nimport { Vector } from './Math/vector';\nimport { delay } from './Util/Util';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { clamp } from './Math/util';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\n  public canvas: Canvas = new Canvas({\n    filtering: ImageFiltering.Blended,\n    smoothing: true,\n    draw: this.draw.bind(this)\n  });\n  private _resourceList: Loadable<any>[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  /**\n   * Positions the top left corner of the logo image\n   * If not set, the loader automatically positions the logo\n   */\n  public logoPosition: Vector | null;\n  /**\n   * Positions the top left corner of the play button.\n   * If not set, the loader automatically positions the play button\n   */\n  public playButtonPosition: Vector | null;\n  /**\n   * Positions the top left corner of the loading bar\n   * If not set, the loader automatically positions the loading bar\n   */\n  public loadingBarPosition: Vector | null;\n\n  /**\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\n   */\n  public loadingBarColor: Color = Color.White;\n\n  /**\n   * Gets or sets the background color of the loader as a hex string\n   */\n  public backgroundColor: string = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  public get playButtonRootElement(): HTMLElement | null {\n    return this._playButtonRootElement;\n  }\n  public get playButtonElement(): HTMLButtonElement | null {\n    return this._playButtonElement;\n  }\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    const existingRoot = document.getElementById('excalibur-play-root');\n    if (existingRoot) {\n      this._playButtonRootElement = existingRoot;\n    }\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.id = 'excalibur-play-root';\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\n    if (!buttonElement) {\n      buttonElement = document.createElement('button');\n    }\n\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable<any>[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n    this.canvas.width = this._engine.canvas.width;\n    this.canvas.height = this._engine.canvas.height;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable<any>) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable<any>[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public async showPlayButton(): Promise<void> {\n    if (this.suppressPlayButton) {\n      this.hidePlayButton();\n      // Delay is to give the logo a chance to show, otherwise don't delay\n      await delay(500, this._engine?.clock);\n    } else {\n      const resizeHandler = () => {\n        this._positionPlayButton();\n      };\n      if (this._engine?.browser) {\n        this._engine.browser.window.on('resize', resizeHandler);\n      }\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\n        if (evt.key === 'Enter') {\n          this._playButton.click();\n        }\n      });\n      this._positionPlayButton();\n      const playButtonClicked = new Promise<void>((resolve) => {\n        const startButtonHandler = (e: Event) => {\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\n          e.stopPropagation();\n          // Hide Button after click\n          this.hidePlayButton();\n          if (this._engine?.browser) {\n            this._engine.browser.window.off('resize', resizeHandler);\n          }\n          resolve();\n        };\n        this._playButton.addEventListener('click', startButtonHandler);\n        this._playButton.addEventListener('touchend', startButtonHandler);\n        this._playButton.addEventListener('pointerup', startButtonHandler);\n      });\n\n      return await playButtonClicked;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Clean up generated elements for the loader\n   */\n  public dispose() {\n    if (this._playButtonRootElement.parentElement) {\n      this._playButtonRootElement.removeChild(this._playButtonElement);\n      document.body.removeChild(this._playButtonRootElement);\n      document.head.removeChild(this._styleBlock);\n      this._playButtonRootElement = null;\n      this._playButtonElement = null;\n      this._styleBlock = null;\n    }\n  }\n\n  update(_engine: Engine, _delta: number): void {\n    // override me\n  }\n\n  data: Loadable<any>[];\n\n  private _isLoadedResolve: () => any;\n  private _isLoadedPromise = new Promise<void>(resolve => {\n    this._isLoadedResolve = resolve;\n  });\n  public areResourcesLoaded() {\n    return this._isLoadedPromise;\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete AND the user has clicked the \"Play button\"\n   */\n  public async load(): Promise<Loadable<any>[]> {\n    await this._image?.decode(); // decode logo if it exists\n\n    await Promise.all(\n      this._resourceList.map((r) =>\n        r.load().finally(() => {\n          // capture progress\n          this._numLoaded++;\n        })\n      )\n    );\n    this._isLoadedResolve();\n\n    // short delay in showing the button for aesthetics\n    await delay(200, this._engine?.clock);\n\n    await this.showPlayButton();\n    // Unlock browser AudioContext in after user gesture\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\n    await WebAudio.unlock();\n\n    return (this.data = this._resourceList);\n  }\n\n  public markResourceComplete(): void {\n    this._numLoaded++;\n  }\n\n  /**\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\n   */\n  public get progress(): number {\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\n  }\n\n  private _positionPlayButton() {\n    if (this._engine) {\n      const screenHeight = this._engine.screen.viewport.height;\n      const screenWidth = this._engine.screen.viewport.width;\n      if (this._playButtonRootElement) {\n        const left = this._engine.canvas.offsetLeft;\n        const top = this._engine.canvas.offsetTop;\n        const buttonWidth = this._playButton.clientWidth;\n        const buttonHeight = this._playButton.clientHeight;\n        if (this.playButtonPosition) {\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n        } else {\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\n        }\n      }\n    }\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    this._positionPlayButton();\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    let logoY = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    let logoX = canvasWidth / 2 - width / 2;\n\n    if (this.logoPosition) {\n      logoX = this.logoPosition.x;\n      logoY = this.logoPosition.y;\n    }\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    if (!this.logoPosition) {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n    } else {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n    }\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    let loadingX = logoX;\n    let loadingY = logoY;\n    if (this.loadingBarPosition) {\n      loadingX = this.loadingBarPosition.x;\n      loadingY = this.loadingBarPosition.y;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n    const progress = width * this.progress;\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(\n      ctx,\n      loadingX + margin,\n      loadingY + margin,\n      progressWidth > 10 ? progressWidth : 10,\n      height,\n      5,\n      null,\n      this.loadingBarColor\n    );\n    this._engine.setAntialiasing(oldAntialias);\n  }\n}\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // (✓)\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // (✗)\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    // eslint-disable-next-line no-console\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","/**\n * An enum that describes the types of collisions bodies can participate in\n */\nexport enum CollisionType {\n  /**\n   * Bodies with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Bodies with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other bodies and do not influence or move other bodies.\n   * This is useful for use in trigger type behavior.\n   */\n  Passive = 'Passive',\n  /**\n   * Bodies with the `Active` setting raise collision events and participate\n   * in collisions with other bodies and will be push or moved by bodies sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Bodies with the `Fixed` setting raise collision events and participate in\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\n * like platformers or top down games.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Arcade = 'arcade',\n  Realistic = 'realistic'\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster.\n */\nexport enum BroadphaseStrategy {\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n  public static get gravity() {\n    return Physics.acc;\n  }\n  public static set gravity(v: Vector) {\n    Physics.acc = v;\n  }\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n\n  /**\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\n   */\n  public static useArcadePhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRealisticPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\n  }\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\n   */\n  public static dynamicTreeVelocityMultiplier = 2;\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\n  })\n  public static get dynamicTreeVelocityMultiplyer() {\n    return Physics.dynamicTreeVelocityMultiplier;\n  }\n\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\n    Physics.dynamicTreeVelocityMultiplier = value;\n  }\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Number of position iterations (overlap) to run in the solver\n   */\n  public static positionIterations = 3;\n\n  /**\n   * Number of velocity iteration (response) to run in the solver\n   */\n  public static velocityIterations = 8;\n\n  /**\n   * Amount of overlap to tolerate in pixels\n   */\n  public static slop = 1;\n\n  /**\n   * Amount of positional overlap correction to apply each position iteration of the solver\n   * O - meaning no correction, 1 - meaning correct all overlap\n   */\n  public static steeringFactor = 0.2;\n\n  /**\n   * Warm start set to true re-uses impulses from previous frames back in the solver\n   */\n  public static warmStart = true;\n\n  /**\n   * By default bodies do not sleep\n   */\n  public static bodiesCanSleepByDefault = false;\n\n  /**\n   * Surface epsilon is used to help deal with surface penetration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  public static sleepEpsilon = 0.07;\n\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\n\n  public static sleepBias = 0.9;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\nimport { VectorView } from '../../Math/vector-view';\nimport { Vector, vec } from '../../Math/vector';\nimport { Component } from '../Component';\nimport { Observable } from '../../Util/Observable';\nimport { watch } from '../../Util/Watch';\n\nexport interface Transform {\n  /**\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\n   */\n  coordPlane: CoordPlane;\n\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If the entity has a parent this position is relative to the parent entity.\n   */\n  pos: Vector;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  z: number;\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   *\n   * If the entity has a parent this rotation is relative to the parent.\n   */\n  rotation: number;\n\n  /**\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\n   */\n  scale: Vector;\n}\n\nconst createPosView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.data[MatrixLocations.X] = x;\n    },\n    setY: (y) => {\n      source.data[MatrixLocations.Y] = y;\n    },\n    getX: () => {\n      return source.data[MatrixLocations.X];\n    },\n    getY: () => {\n      return source.data[MatrixLocations.Y];\n    }\n  });\n};\n\nconst createScaleView = (matrix: Matrix) => {\n  const source = matrix;\n  return new VectorView({\n    setX: (x) => {\n      source.setScaleX(x);\n    },\n    setY: (y) => {\n      source.setScaleY(y);\n    },\n    getX: () => {\n      return source.getScaleX();\n    },\n    getY: () => {\n      return source.getScaleY();\n    }\n  });\n};\n\n/**\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\n */\nexport enum CoordPlane {\n  /**\n   * The world coordinate plane (default) represents world space, any entities drawn with world\n   * space move when the camera moves.\n   */\n  World = 'world',\n  /**\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\n   * to screen coordinates ignoring the camera.\n   */\n  Screen = 'screen'\n}\n\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\n  public readonly type = 'ex.transform';\n\n  private _dirty = false;\n\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\n  private _position = watch(createPosView(this.matrix), (v) => {\n    this.posChanged$.notifyAll(v);\n  });\n  private _rotation = 0;\n  private _scale = createScaleView(this.matrix);\n\n  private _recalculate() {\n    this._rotation = this.matrix.getRotation();\n    this._dirty = false;\n  }\n\n  public getGlobalMatrix(): Matrix {\n    if (!this.parent) {\n      return this.matrix;\n    } else {\n      return this.parent.getGlobalMatrix().multiply(this.matrix);\n    }\n  }\n\n  public getGlobalTransform(): Transform {\n    return {\n      pos: this.globalPos,\n      scale: this.globalScale,\n      rotation: this.globalRotation,\n      z: this.z,\n      coordPlane: this.coordPlane\n    };\n  }\n\n  public get parent(): TransformComponent | null {\n    return this?.owner?.parent?.get(TransformComponent);\n  }\n\n  /**\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\n   */\n  public coordPlane = CoordPlane.World;\n\n  /**\n   * Observable that notifies when the position changes\n   */\n  public posChanged$ = new Observable<Vector>();\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\n   *\n   * If a parent entity exists coordinates are local to the parent.\n   */\n  public get pos(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._position;\n  }\n\n  public set pos(val: Vector) {\n    const oldPos = this.matrix.getPosition();\n    this.matrix.setPosition(val.x, val.y);\n    this._dirty = true;\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this._position);\n    }\n  }\n\n  // Dirty flag check up the chain\n  public get dirty(): boolean {\n    if (this?.owner?.parent) {\n      const parent = this.parent;\n      return parent.dirty || this._dirty;\n    }\n    return this._dirty;\n  }\n\n  /**\n   * The current world position calculated\n   */\n  public get globalPos(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.data[MatrixLocations.X],\n      getY: () => source.data[MatrixLocations.Y],\n      setX: (x) => {\n        const oldX = this.matrix.data[MatrixLocations.X];\n        if (this.parent) {\n          const { x: newX } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(x, source.data[MatrixLocations.Y]));\n          this.matrix.data[MatrixLocations.X] = newX;\n        } else {\n          this.matrix.data[MatrixLocations.X] = x;\n        }\n        if (oldX !== this.matrix.data[MatrixLocations.X]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      },\n      setY: (y) => {\n        const oldY = this.matrix.data[MatrixLocations.Y];\n        if (this.parent) {\n          const { y: newY } = this.parent?.getGlobalMatrix().getAffineInverse().multiply(vec(source.data[MatrixLocations.X], y));\n          this.matrix.data[MatrixLocations.Y] = newY;\n        } else {\n          this.matrix.data[MatrixLocations.Y] = y;\n        }\n        if (oldY !== this.matrix.data[MatrixLocations.Y]) {\n          this.posChanged$.notifyAll(this._position);\n        }\n      }\n    });\n  }\n\n  public set globalPos(val: Vector) {\n    const oldPos = this.pos;\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.pos = val;\n    } else {\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multiply(val);\n    }\n    if (!oldPos.equals(val)) {\n      this.posChanged$.notifyAll(this.pos);\n    }\n  }\n\n  /**\n   * Observable that emits when the z index changes on this component\n   */\n  public zIndexChanged$ = new Observable<number>();\n  private _z = 0;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  public get z(): number {\n    return this._z;\n  }\n\n  public set z(val: number) {\n    const oldz = this._z;\n    this._z = val;\n    if (oldz !== val) {\n      this.zIndexChanged$.notifyAll(val);\n    }\n  }\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   */\n  public get rotation(): number {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._rotation;\n  }\n\n  public set rotation(val: number) {\n    this.matrix.setRotation(val);\n    this._dirty = true;\n  }\n\n  public get globalRotation(): number {\n    return this.getGlobalMatrix().getRotation();\n  }\n\n  public set globalRotation(val: number) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.rotation = val;\n    } else {\n      this.rotation = val - parentTransform.globalRotation;\n    }\n  }\n\n  /**\n   * The scale of the entity.\n   */\n  public get scale(): Vector {\n    if (this._dirty) {\n      this._recalculate();\n    }\n    return this._scale;\n  }\n\n  public set scale(val: Vector) {\n    this.matrix.setScale(val);\n    this._dirty = true;\n  }\n\n  public get globalScale(): Vector {\n    const source = this.getGlobalMatrix();\n    return new VectorView({\n      getX: () => source.getScaleX(),\n      getY: () => source.getScaleY(),\n      setX: (x) => {\n        if (this.parent) {\n          const globalScaleX = this.parent.globalScale.x;\n          this.matrix.setScaleX(x / globalScaleX);\n        } else {\n          this.matrix.setScaleX(x);\n        }\n      },\n      setY: (y) => {\n        if (this.parent) {\n          const globalScaleY = this.parent.globalScale.y;\n          this.matrix.setScaleY(y / globalScaleY);\n        } else {\n          this.matrix.setScaleY(y);\n        }\n      }\n    });\n  }\n\n  public set globalScale(val: Vector) {\n    const parentTransform = this.parent;\n    if (!parentTransform) {\n      this.scale = val;\n    } else {\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\n    }\n  }\n\n  /**\n   * Apply the transform to a point\n   * @param point\n   */\n  public apply(point: Vector): Vector {\n    return this.matrix.multiply(point);\n  }\n\n  /**\n   * Apply the inverse transform to a point\n   * @param point\n   */\n  public applyInverse(point: Vector): Vector {\n    return this.matrix.getAffineInverse().multiply(point);\n  }\n}\n","import { Vector } from './vector';\n\nexport interface VectorViewOptions {\n  getX: () => number;\n  getY: () => number;\n  setX: (x: number) => void;\n  setY: (y: number) => void;\n}\nexport class VectorView extends Vector {\n  private _getX: () => number;\n  private _getY: () => number;\n  private _setX: (x: number) => void;\n  private _setY: (y: number) => void;\n  constructor(options: VectorViewOptions) {\n    super(0, 0);\n    this._getX = options.getX;\n    this._getY = options.getY;\n    this._setX = options.setX;\n    this._setY = options.setY;\n  }\n  public get x() {\n    return (this._x = this._getX());\n  }\n\n  public set x(val) {\n    this._setX(val);\n    this._x = val;\n  }\n\n  public get y() {\n    return (this._y = this._getY());\n  }\n  public set y(val) {\n    this._setY(val);\n    this._y = val;\n  }\n}\n","import { Entity } from './Entity';\n\n/**\n * Component Contructor Types\n */\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\n\n/**\n * Type guard to check if a component implements clone\n * @param x\n */\nfunction hasClone(x: any): x is { clone(): any } {\n  return !!x?.clone;\n}\n\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * Plucks the string type out of a component type\n */\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\n\n/**\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\n *\n * Implementations of Component must have a zero-arg constructor to support dependencies\n *\n * ```typescript\n * class MyComponent extends ex.Component<'my'> {\n *   public readonly type = 'my';\n *   // zero arg support required if you want to use component dependencies\n *   constructor(public optionalPos?: ex.Vector) {}\n * }\n * ```\n */\nexport abstract class Component<TypeName extends string = string> {\n  /**\n   * Optionally list any component types this component depends on\n   * If the owner entity does not have these components, new components will be added to the entity\n   *\n   * Only components with zero-arg constructors are supported as automatic component dependencies\n   */\n  readonly dependencies?: ComponentCtor[];\n\n  // todo implement optional\n  readonly optional?: ComponentCtor[];\n\n  /**\n   * Type of this component, must be a unique type among component types in you game.\n   */\n  abstract readonly type: TypeName;\n\n  /**\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\n   */\n  owner?: Entity = null;\n\n  /**\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\n   */\n  clone(): this {\n    const newComponent = new (this.constructor as any)();\n    for (const prop in this) {\n      if (this.hasOwnProperty(prop)) {\n        const val = this[prop];\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\n          newComponent[prop] = val.clone();\n        } else {\n          newComponent[prop] = val;\n        }\n      }\n    }\n    return newComponent;\n  }\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onAdd?(owner: Entity): void;\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onRemove?(previousOwner: Entity): void;\n}\n\n/**\n * Tag components are a way of tagging a component with label and a simple value\n *\n * For example:\n *\n * ```typescript\n * const isOffscreen = new TagComponent('offscreen');\n * entity.addComponent(isOffscreen);\n * entity.tags.includes\n * ```\n */\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\nTypeName\n> {\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\n    super();\n  }\n}\n","/**\n * Defines a generic message that can contain any data\n * @template T is the typescript Type of the data\n */\nexport interface Message<T> {\n  type: string;\n  data: T;\n}\n\n/**\n * Defines an interface for an observer to receive a message via a notify() method\n */\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\n/**\n * Defines an interface for something that might be an observer if a notify() is present\n */\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\n/**\n * Simple Observable implementation\n * @template T is the typescript Type that defines the data being observed\n */\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n  public subscriptions: ((val: T) => any)[] = [];\n\n  /**\n   * Register an observer to listen to this observable\n   * @param observer\n   */\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Register a callback to listen to this observable\n   * @param func\n   */\n  subscribe(func: (val: T) => any) {\n    this.subscriptions.push(func);\n  }\n\n  /**\n   * Remove an observer from the observable\n   * @param observer\n   */\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  /**\n   * Remove a callback that is listening to this observable\n   * @param func\n   */\n  unsubscribe(func: (val: T) => any) {\n    const i = this.subscriptions.indexOf(func);\n    if (i !== -1) {\n      this.subscriptions.splice(i, 1);\n    }\n  }\n\n  /**\n   * Broadcasts a message to all observers and callbacks\n   * @param message\n   */\n  notifyAll(message: T) {\n    this.observers.forEach((o) => o.notify(message));\n    this.subscriptions.forEach(cb => cb(message));\n  }\n\n  /**\n   * Removes all observers and callbacks\n   */\n  clear() {\n    this.observers.length = 0;\n    this.subscriptions.length = 0;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inertia can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n\n  /**\n   * Inverts the collision group. For example, if before the group specified \"players\",\n   * inverting would specify all groups except players\n   * @returns CollisionGroup\n   */\n  public invert(): CollisionGroup {\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\n  }\n\n  /**\n   * Combine collision groups with each other. The new group includes all of the previous groups.\n   *\n   * @param collisionGroups\n   */\n  public static combine(collisionGroups: CollisionGroup[]) {\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\n    const combinedMask = ~combinedCategory;\n\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\n  }\n\n  /**\n   * Creates a collision group that collides with the listed groups\n   * @param collisionGroups\n   */\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\n    return CollisionGroup.combine(collisionGroups).invert();\n  }\n}\n","import { CollisionContact } from './CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { BodyComponent } from '../BodyComponent';\nimport { Id } from '../../Id';\nimport { Collider } from '../Colliders/Collider';\n\n/**\n * Models a potential collision between 2 colliders\n */\nexport class Pair {\n  public id: string = null;\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\n   * @param colliderA\n   * @param colliderB\n   */\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    const bodyA = colliderA?.owner?.get(BodyComponent);\n    const bodyB = colliderB?.owner?.get(BodyComponent);\n\n    // Prevent self collision\n    if (colliderA.id === colliderB.id) {\n      return false;\n    }\n\n    // Colliders with the same owner do not collide (composite colliders)\n    if (colliderA.owner &&\n        colliderB.owner &&\n        colliderA.owner.id === colliderB.owner.id) {\n      return false;\n    }\n\n    // if the pair has a member with zero dimension don't collide\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\n      return false;\n    }\n\n    // Body's needed for collision in the current state\n    // TODO can we collide without a body?\n    if (!bodyA || !bodyB) {\n      return false;\n    }\n\n    // If both are in the same collision group short circuit\n    if (!bodyA.group.canCollide(bodyB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!bodyA.active || !bodyB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const colliderA = this.colliderA;\n    const colliderB = this.colliderB;\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Runs the collision intersection logic on the members of this pair\n   */\n  public collide(): CollisionContact[] {\n    return this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Check if the collider is part of the pair\n   * @param collider\n   */\n  public hasCollider(collider: Collider) {\n    return collider === this.colliderA || collider === this.colliderB;\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair (owning id)\n   */\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\n    if (idA.value < idB.value) {\n      return `#${idA.value}+${idB.value}`;\n    } else {\n      return `#${idB.value}+${idA.value}`;\n    }\n  }\n}\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\nimport { BoundingBox } from '../BoundingBox';\n\nimport { Ray } from '../../Math/ray';\nimport { Logger } from '../../Util/Log';\nimport { Id } from '../../Id';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { BodyComponent } from '../BodyComponent';\nimport { Color, ExcaliburGraphicsContext } from '../..';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode<T> {\n  public left: TreeNode<T>;\n  public right: TreeNode<T>;\n  public bounds: BoundingBox;\n  public height: number;\n  public data: T;\n  constructor(public parent?: TreeNode<T>) {\n    this.parent = parent || null;\n    this.data = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\nexport interface ColliderProxy<T> {\n  id: Id<'collider'>;\n  owner: T;\n  bounds: BoundingBox;\n}\n\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\n  public root: TreeNode<T>;\n  public nodes: { [key: number]: TreeNode<T> };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode<T>): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode<T>) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode<T>;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackCollider(collider: T) {\n    const node = new TreeNode<T>();\n    node.data = collider;\n    node.bounds = collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[collider.id.value] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return false;\n    }\n    const b = collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn(\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\n      );\n      this.untrackCollider(collider);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    // THIS IS CAUSING UNECESSARY CHECKS\n    if (collider.owner) {\n      const body = collider.owner?.get(BodyComponent);\n      if (body) {\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\n\n        if (multdx < 0) {\n          b.left += multdx;\n        } else {\n          b.right += multdx;\n        }\n\n        if (multdy < 0) {\n          b.top += multdy;\n        } else {\n          b.bottom += multdy;\n        }\n      }\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackCollider(collider: T) {\n    const node = this.nodes[collider.id.value];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[collider.id.value] = null;\n    delete this.nodes[collider.id.value];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode<T>) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(collider: T, callback: (other: T) => boolean): void {\n    const bounds = collider.bounds;\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\n          if (callback.call(collider, currentNode.data)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\n    const helper = (currentNode: TreeNode<T>): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.data)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode<T>[] {\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode<T>) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          currentNode.bounds.draw(ex, Color.Green);\n        } else {\n          currentNode.bounds.draw(ex, Color.White);\n        }\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\nimport { CollisionProcessor } from './CollisionProcessor';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\n\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { FrameStats } from '../../Debug';\nimport { Logger } from '../../Util/Log';\nimport { CollisionType } from '../CollisionType';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BodyComponent } from '../BodyComponent';\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\nimport { ExcaliburGraphicsContext } from '../..';\n\n/**\n * Responsible for performing the collision broadphase (locating potential collisions) and\n * the narrowphase (actual collision contacts)\n */\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\n  private _pairs = new Set<string>();\n\n  private _collisionPairCache: Pair[] = [];\n  private _colliders: Collider[] = [];\n\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null collider');\n      return;\n    }\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        c.owner = target.owner;\n        this._colliders.push(c);\n        this._dynamicCollisionTree.trackCollider(c);\n      }\n    } else {\n      this._colliders.push(target);\n      this._dynamicCollisionTree.trackCollider(target);\n    }\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Collider): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null collider');\n      return;\n    }\n\n    if (target instanceof CompositeCollider) {\n      const colliders = target.getColliders();\n      for (const c of colliders) {\n        const index = this._colliders.indexOf(c);\n        if (index !== -1) {\n          this._colliders.splice(index, 1);\n        }\n        this._dynamicCollisionTree.untrackCollider(c);\n      }\n    } else {\n      const index = this._colliders.indexOf(target);\n      if (index !== -1) {\n        this._colliders.splice(index, 1);\n      }\n      this._dynamicCollisionTree.untrackCollider(target);\n    }\n  }\n\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\n    return this._pairs.has(hash);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\n   */\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets.filter((other) => {\n      const body = other.owner?.get(BodyComponent);\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\n    });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._pairs.clear();\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n          const pair = new Pair(collider, other);\n          this._pairs.add(pair.id);\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        const body = collider.owner.get(BodyComponent);\n        // Skip non-active objects. Does not make sense on other collision types\n        if (body.collisionType !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          body.vel.size * seconds + // velocity term\n          body.acc.size * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penetrating in the current position\n          const updateVec = body.pos.sub(body.oldPos);\n          const centerPoint = collider.center;\n          const furthestPoint = collider.getFurthestPoint(body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minCollider: Collider;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.size < minTranslate.size) {\n                  minTranslate = translate;\n                  minCollider = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minCollider && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minCollider);\n            if (!this._pairs.has(pair.id)) {\n              this._pairs.add(pair.id);\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\n            collider.update(body.transform);\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\n    let contacts: CollisionContact[] = [];\n    for (let i = 0; i < pairs.length; i++) {\n      const newContacts = pairs[i].collide();\n      contacts = contacts.concat(newContacts);\n      if (stats && newContacts.length > 0) {\n        for (const c of newContacts) {\n          stats.physics.contacts.set(c.id, c);\n        }\n      }\n    }\n    if (stats) {\n      stats.physics.collisions += contacts.length;\n    }\n    return contacts;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Collider[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  public debug(ex: ExcaliburGraphicsContext) {\n    this._dynamicCollisionTree.debug(ex);\n  }\n}\n","import { Color } from '../../Color';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { BoundingBox } from '../BoundingBox';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Clonable } from '../../Interfaces/Clonable';\nimport { Entity, Transform } from '../../EntityComponentSystem';\nimport { createId, Id } from '../../Id';\nimport { EventDispatcher } from '../../EventDispatcher';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\n/**\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\n * for the purposes of colliding 2 objects in excalibur.\n */\nexport abstract class Collider implements Clonable<Collider> {\n  private static _ID = 0;\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>();\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const contact = this.collide(other);\n\n    if (contact) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public owner: Entity;\n\n  /**\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\n   * on top of the collider.\n   */\n  offset: Vector;\n\n  /**\n   * Position of the collision collider in world coordinates\n   */\n  abstract get worldPos(): Vector;\n\n  /**\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\n   */\n  abstract get center(): Vector;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\n   */\n  abstract get bounds(): BoundingBox;\n\n  /**\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\n   */\n  abstract get localBounds(): BoundingBox;\n\n  /**\n   * Return the axes of this particular collider\n   */\n  abstract get axes(): Vector[];\n  /**\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\n   */\n  abstract getFurthestPoint(direction: Vector): Vector;\n\n  abstract getInertia(mass: number): number;\n\n  // All new CollisionShape need to do the following\n  // Create a new collision function in the CollisionJumpTable against all the primitives\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\n  abstract collide(collider: Collider): CollisionContact[];\n\n  /**\n   * Returns the closest line between the surfaces this collider and another\n   * @param collider\n   */\n  abstract getClosestLineBetween(collider: Collider): Line;\n\n  /**\n   * Return wether the collider contains a point inclusive to it's border\n   */\n  abstract contains(point: Vector): boolean;\n\n  /**\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\n   */\n  abstract rayCast(ray: Ray, max?: number): Vector;\n\n  /**\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\n   */\n  abstract project(axis: Vector): Projection;\n\n  /**\n   * Updates collider world space geometry\n   */\n  abstract update(transform: Transform): void;\n\n  /**\n   * Draw the collider\n   * @deprecated Will be removed in 0.26.0\n   * @param ctx\n   * @param color\n   */\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\n\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\n  /**\n   * Draw any debug information\n   * @deprecated Will be removed in 0.26.0\n   */\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\n\n  abstract clone(): Collider;\n}\n","import { Util } from '../..';\nimport { Pair } from '../Detection/Pair';\nimport { Color } from '../../Color';\nimport { Transform } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\nimport { Line } from '../../Math/line';\nimport { Projection } from '../../Math/projection';\nimport { Ray } from '../../Math/ray';\nimport { Vector } from '../../Math/vector';\nimport { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { DynamicTree } from '../Detection/DynamicTree';\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\nimport { Collider } from './Collider';\n\nexport class CompositeCollider extends Collider {\n  private _transform: Transform;\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\n  private _dynamicAABBTree = new DynamicTree();\n  private _colliders: Collider[] = [];\n\n  constructor(colliders: Collider[]) {\n    super();\n    for (const c of colliders) {\n      this.addCollider(c);\n    }\n  }\n\n  clearColliders() {\n    this._colliders = [];\n  }\n\n  addCollider(collider: Collider) {\n    this.events.wire(collider.events);\n    this._colliders.push(collider);\n    this._collisionProcessor.track(collider);\n    this._dynamicAABBTree.trackCollider(collider);\n  }\n\n  removeCollider(collider: Collider) {\n    this.events.unwire(collider.events);\n    Util.removeItemFromArray(collider, this._colliders);\n    this._collisionProcessor.untrack(collider);\n    this._dynamicAABBTree.untrackCollider(collider);\n  }\n\n  getColliders(): Collider[] {\n    return this._colliders;\n  }\n\n  get worldPos(): Vector {\n    // TODO transform component world pos\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get center(): Vector {\n    return this._transform?.pos ?? Vector.Zero;\n  }\n\n  get bounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce(\n      (acc, collider) => acc.combine(collider.bounds),\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\n    );\n\n    return results;\n  }\n\n  get localBounds(): BoundingBox {\n    // TODO cache this\n    const colliders = this.getColliders();\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\n\n    return results;\n  }\n\n  get axes(): Vector[] {\n    // TODO cache this\n    const colliders = this.getColliders();\n    let axes: Vector[] = [];\n    for (const collider of colliders) {\n      axes = axes.concat(collider.axes);\n    }\n    return axes;\n  }\n\n  getFurthestPoint(direction: Vector): Vector {\n    const colliders = this.getColliders();\n    const furthestPoints: Vector[] = [];\n    for (const collider of colliders) {\n      furthestPoints.push(collider.getFurthestPoint(direction));\n    }\n    // Pick best point from all colliders\n    let bestPoint = furthestPoints[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (const point of furthestPoints) {\n      const distance = point.dot(direction);\n      if (distance > maxDistance) {\n        bestPoint = point;\n        maxDistance = distance;\n      }\n    }\n    return bestPoint;\n  }\n\n  getInertia(mass: number): number {\n    const colliders = this.getColliders();\n    let totalInertia = 0;\n    for (const collider of colliders) {\n      totalInertia += collider.getInertia(mass);\n    }\n    return totalInertia;\n  }\n\n  collide(other: Collider): CollisionContact[] {\n    let otherColliders = [other];\n    if (other instanceof CompositeCollider) {\n      otherColliders = other.getColliders();\n    }\n\n    const pairs: Pair[] = [];\n    for (const c of otherColliders) {\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\n        pairs.push(new Pair(c, potentialCollider));\n        return false;\n      });\n    }\n\n    let contacts: CollisionContact[] = [];\n    for (const p of pairs) {\n      contacts = contacts.concat(p.collide());\n    }\n    return contacts;\n  }\n\n  getClosestLineBetween(other: Collider): Line {\n    const colliders = this.getColliders();\n    const lines: Line[] = [];\n    if (other instanceof CompositeCollider) {\n      const otherColliders = other.getColliders();\n      for (const colliderA of colliders) {\n        for (const colliderB of otherColliders) {\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\n          if (maybeLine) {\n            lines.push(maybeLine);\n          }\n        }\n      }\n    } else {\n      for (const collider of colliders) {\n        const maybeLine = other.getClosestLineBetween(collider);\n        if (maybeLine) {\n          lines.push(maybeLine);\n        }\n      }\n    }\n\n    if (lines.length) {\n      let minLength = lines[0].getLength();\n      let minLine = lines[0];\n      for (const line of lines) {\n        const length = line.getLength();\n        if (length < minLength) {\n          minLength = length;\n          minLine = line;\n        }\n      }\n      return minLine;\n    }\n    return null;\n  }\n  contains(point: Vector): boolean {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      if (collider.contains(point)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  rayCast(ray: Ray, max?: number): Vector {\n    const colliders = this.getColliders();\n    const points: Vector[] = [];\n    for (const collider of colliders) {\n      const vec = collider.rayCast(ray, max);\n      if (vec) {\n        points.push(vec);\n      }\n    }\n    if (points.length) {\n      let minPoint = points[0];\n      let minDistance = minPoint.dot(ray.dir);\n      for (const point of points) {\n        const distance = ray.dir.dot(point);\n        if (distance < minDistance) {\n          minPoint = point;\n          minDistance = distance;\n        }\n      }\n      return minPoint;\n    }\n    return null;\n  }\n  project(axis: Vector): Projection {\n    const colliders = this.getColliders();\n    const projs: Projection[] = [];\n    for (const collider of colliders) {\n      const proj = collider.project(axis);\n      if (proj) {\n        projs.push(proj);\n      }\n    }\n    // Merge all proj's on the same axis\n    if (projs.length) {\n      const newProjection = new Projection(projs[0].min, projs[0].max);\n      for (const proj of projs) {\n        newProjection.min = Math.min(proj.min, newProjection.min);\n        newProjection.max = Math.max(proj.max, newProjection.max);\n      }\n      return newProjection;\n    }\n    return null;\n  }\n\n  update(transform: Transform): void {\n    if (transform) {\n      const colliders = this.getColliders();\n      for (const collider of colliders) {\n        collider.owner = this.owner;\n        collider.update(transform);\n      }\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color, pos);\n    }\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.debug(ex, color);\n    }\n  }\n\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\n    const colliders = this.getColliders();\n    for (const collider of colliders) {\n      collider.draw(ctx, color);\n    }\n  }\n  clone(): Collider {\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\n  }\n}\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\n\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface CircleColliderOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n}\n\n/**\n * This is a circle collider for the excalibur rigid body physics simulation\n */\nexport class CircleCollider extends Collider {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0).\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  private _naturalRadius: number;\n  /**\n   * Get the radius of the circle\n   */\n  public get radius(): number {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    return this._naturalRadius * Math.min(scale.x, scale.y);\n  }\n\n  /**\n   * Set the radius of the circle\n   */\n  public set radius(val: number) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\n  }\n\n  private _transform: Transform;\n\n  constructor(options: CircleColliderOptions) {\n    super();\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): CircleCollider {\n    return new CircleCollider({\n      offset: this.offset.clone(),\n      radius: this.radius\n    });\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\n  }\n\n  /**\n   * Tests if a point is contained in this collider\n   */\n  public contains(point: Vector): boolean {\n    const pos = this._transform?.pos ?? this.offset;\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circle collider and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const positiveToi: number[] = [];\n        if (toi1 >= 0) {\n          positiveToi.push(toi1);\n        }\n\n        if (toi2 >= 0) {\n          positiveToi.push(toi2);\n        }\n\n        const mintoi = Math.min(...positiveToi);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Find the local point on the shape in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const dir = direction.normalize();\n    return dir.scale(this.radius);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    ).rotate(rotation).scale(scale).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this._naturalRadius,\n      this.offset.y - this._naturalRadius,\n      this.offset.x + this._naturalRadius,\n      this.offset.y + this._naturalRadius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return [];\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /* istanbul ignore next */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   * @param pos\n   */\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero);\n    ex.save();\n    ex.translate(pos.x, pos.y);\n    ex.rotate(rotation);\n    ex.scale(scale.x, scale.y);\n    ex.drawCircle((this.offset ?? Vector.Zero), this._naturalRadius, Color.Transparent, color, 2);\n    ex.restore();\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   * @param color\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const transform = this._transform;\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\n    const rotation = transform ? transform.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perspective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perspective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { TransformComponent } from '../../EntityComponentSystem';\nimport { Pair } from '../Detection/Pair';\n\nexport const CollisionJumpTable = {\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    const combinedRadius = circleA.radius + circleB.radius;\n    const distance = circleAPos.distance(circleBPos);\n\n    if (distance > combinedRadius) {\n      return [];\n    }\n\n    // negative means overlap\n    const separation = combinedRadius - distance;\n\n    // Normal points from A -> B\n    const normal = circleBPos.sub(circleAPos).normalize();\n    const tangent = normal.perpendicular();\n    const mvt = normal.scale(separation);\n\n    const point = circleA.getFurthestPoint(normal);\n    const local = circleA.getFurthestLocalPoint(normal);\n\n    const info: SeparationInfo = {\n      collider: circleA,\n      separation,\n      axis: normal,\n      point: point\n    };\n\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\n  },\n\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\n    if (!minAxis) {\n      return [];\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const point = circle.getFurthestPoint(minAxis);\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\n    const local = xf.applyInverse(point);\n    const normal = minAxis.normalize();\n\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: -minAxis.size,\n      axis: normal,\n      point: point,\n      localPoint: local,\n      side: polygon.findSide(normal.negate()),\n      localSide: polygon.findLocalSide(normal.negate())\n    };\n\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\n  },\n\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\n    // TODO not sure this actually abides by local/world collisions\n    // Are edge.begin and edge.end local space or world space? I think they should be local\n\n    // center of the circle in world pos\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const edgeWorld = edge.asLine();\n    const e = edgeWorld.end.sub(edgeWorld.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edgeWorld.end.sub(cc));\n    const v = e.dot(cc.sub(edgeWorld.begin));\n    const side = edge.asLine();\n    const localSide = edge.asLocalLine();\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edgeWorld.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return []; // no collision\n      }\n\n      const normal = da.normalize();\n      const separation = circle.radius - Math.sqrt(dda);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.begin,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\n      ];\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edgeWorld.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return [];\n      }\n\n      const normal = db.normalize();\n      const separation = circle.radius - Math.sqrt(ddb);\n\n      const info: SeparationInfo = {\n        collider: circle,\n        separation: separation,\n        axis: normal,\n        point: side.end,\n        side: side,\n        localSide: localSide\n      };\n\n      return [\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\n      ];\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edgeWorld.begin\n      .scale(u)\n      .add(edgeWorld.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return []; // no collision\n    }\n\n    let normal = e.perpendicular();\n    // flip correct direction\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\n      normal.x = -normal.x;\n      normal.y = -normal.y;\n    }\n\n    normal = normal.normalize();\n    const separation = circle.radius - Math.sqrt(dd);\n\n    const mvt = normal.scale(separation);\n    const info: SeparationInfo = {\n      collider: circle,\n      separation: separation,\n      axis: normal,\n      point: pointOnEdge,\n      side: side,\n      localSide: localSide\n    };\n\n    return [\n      new CollisionContact(\n        circle,\n        edge,\n        mvt,\n        normal.negate(),\n        normal.negate().perpendicular(),\n        [pointOnEdge],\n        [pointOnEdge.sub(edge.worldPos)],\n        info\n      )\n    ];\n  },\n\n  CollideEdgeEdge(): CollisionContact[] {\n    // Edge-edge collision doesn't make sense\n    return [];\n  },\n\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new PolygonCollider({\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\n      offset: edge.offset\n    });\n    linePoly.owner = edge.owner;\n    const tx = edge.owner?.get(TransformComponent);\n    if (tx) {\n      linePoly.update(edge.owner.get(TransformComponent));\n    }\n    // Gross hack but poly-poly works well\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\n    if (contact.length) {\n      // Fudge the contact back to edge\n      contact[0].colliderB = edge;\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\n      // contact[0].info.collider\n    }\n    return contact;\n  },\n\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\n    // Multi contact from SAT\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\n    // do a SAT test to find a min axis if it exists\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\n    // If there is no overlap from boxA's perspective we can end early\n    if (separationA.separation > 0) {\n      return [];\n    }\n\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\n    // If there is no overlap from boxB's perspective exit now\n    if (separationB.separation > 0) {\n      return [];\n    }\n\n    // Separations are both negative, we want to pick the least negative (minimal movement)\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\n\n    // The incident side is the most opposite from the axes of collision on the other collider\n    const other = separation.collider === polyA ? polyB : polyA;\n    const incident = other.findSide(separation.axis.negate()) as Line;\n\n    // Clip incident side by the perpendicular lines at each end of the reference side\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\n    const reference = separation.side;\n    const refDir = reference.dir().normalize();\n\n    // Find our contact points by clipping the incident by the collision side\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\n    let clipLeft: Line | null = null;\n    if (clipRight) {\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\n    }\n\n    // If there is no left there is no collision\n    if (clipLeft) {\n      // We only want clip points below the reference edge, discard the others\n      const points = clipLeft.getPoints().filter((p) => {\n        return reference.below(p);\n      });\n\n      let normal = separation.axis;\n      let tangent = normal.perpendicular();\n      // Point Contact A -> B\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\n        normal = normal.negate();\n        tangent = normal.perpendicular();\n      }\n      // Points are clipped from incident which is the other collider\n      // Store those as locals\n      let localPoints: Vector[] = [];\n      if (separation.collider === polyA) {\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      } else {\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\n        localPoints = points.map((p) => xf.applyInverse(p));\n      }\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\n    }\n    return [];\n  },\n\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\n    const shapeA = contact.colliderA;\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\n    const shapeB = contact.colliderB;\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\n\n    // both are circles\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\n      const combinedRadius = shapeA.radius + shapeB.radius;\n      const distance = txA.pos.distance(txB.pos);\n      const separation = combinedRadius - distance;\n      return -separation;\n    }\n\n    // both are polygons\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\n      if (contact.info.localSide) {\n        let side: Line;\n        let worldPoint: Vector;\n        if (contact.info.collider === shapeA) {\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\n          worldPoint = txB.apply(localPoint);\n        } else {\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\n          worldPoint = txA.apply(localPoint);\n        }\n\n        return side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v circle\n    if (\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\n    ) {\n      const worldPoint = txA.apply(localPoint);\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // polygon v edge\n    if (\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\n    ) {\n      let worldPoint: Vector;\n      if (contact.info.collider === shapeA) {\n        worldPoint = txB.apply(localPoint);\n      } else {\n        worldPoint = txA.apply(localPoint);\n      }\n      if (contact.info.side) {\n        return contact.info.side.distanceToPoint(worldPoint, true);\n      }\n    }\n\n    // circle v edge\n    if (\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\n    ) {\n      // Local point is always on the edge which is always shapeB\n      const worldPoint = txB.apply(localPoint);\n\n      let circlePoint: Vector;\n      if (shapeA instanceof CircleCollider) {\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\n      }\n\n      const dist = worldPoint.distance(circlePoint);\n\n      if (contact.info.side) {\n        return dist > 0 ? -dist : 0;\n      }\n    }\n\n    return 0;\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { Color } from '../../Color';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\n\nexport interface EdgeColliderOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally specify an offset\n   */\n  offset?: Vector;\n}\n\n/**\n * Edge is a single line collider to create collisions with a single line.\n */\nexport class EdgeCollider extends Collider {\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  private _transform: Transform;\n\n  constructor(options: EdgeColliderOptions) {\n    super();\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.offset = options.offset ?? Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): EdgeCollider {\n    return new EdgeCollider({\n      begin: this.begin.clone(),\n      end: this.end.clone()\n    });\n  }\n\n  public get worldPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    return tx?.globalPos.add(this.offset) ?? this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    const tx = this._transform as TransformComponent;\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const tx = this._transform as TransformComponent;\n    const angle = tx ? tx.globalRotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns the closes line between this and another collider, from this -> collider\n   * @param shape\n   */\n  public getClosestLineBetween(shape: Collider): Line {\n    if (shape instanceof CircleCollider) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n    } else if (shape instanceof EdgeCollider) {\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: Collider): CollisionContact[] {\n    if (shape instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof EdgeCollider) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\n    // this causes problems for the collision system so we give them some padding\n    return new BoundingBox(\n      Math.min(begin.x, end.x) - padding,\n      Math.min(begin.y, end.y) - padding,\n      Math.max(begin.x, end.x) + padding,\n      Math.max(begin.y, end.y) + padding\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge collider in local space\n   */\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Returns this edge represented as a line in world coordinates\n   */\n  public asLine(): Line {\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\n  }\n\n  /**\n   * Return this edge as a line in local line coordinates (relative to the position)\n   */\n  public asLocalLine(): Line {\n    return new Line(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public update(transform: Transform): void {\n    this._transform = transform;\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ex.drawLine(begin, end, color, 2);\n    ex.drawCircle(begin, 2, color);\n    ex.drawCircle(end, 2, color);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Color } from '../../Color';\nimport { BoundingBox } from '../BoundingBox';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CircleCollider } from './CircleCollider';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { Projection } from '../../Math/projection';\nimport { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\nimport { Collider } from './Collider';\nimport { ExcaliburGraphicsContext, Logger, range } from '../..';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Shape } from './Shape';\n\nexport interface PolygonColliderOptions {\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   */\n  points: Vector[];\n}\n\n/**\n * Polygon collider for detecting collisions\n */\nexport class PolygonCollider extends Collider {\n  private _logger = Logger.getInstance();\n  /**\n   * Pixel offset relative to a collider's body transform position.\n   */\n  public offset: Vector;\n\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\n   * Excalibur stores these in clockwise order\n   */\n  public points: Vector[];\n\n  private _transform: Transform;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n  private _localSides: Line[] = [];\n\n  constructor(options: PolygonColliderOptions) {\n    super();\n    this.offset = options.offset ?? Vector.Zero;\n    this.points = options.points ?? [];\n    const clockwise = this._isClockwiseWinding(this.points);\n    if (!clockwise) {\n      this.points.reverse();\n    }\n    if (!this.isConvex()) {\n      this._logger.warn(\n        'Excalibur only supports convex polygon colliders and will not behave properly.'+\n        'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles');\n    }\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  private _isClockwiseWinding(points: Vector[]): boolean {\n    // https://stackoverflow.com/a/1165943\n    let sum = 0;\n    for (let i = 0; i < points.length; i++) {\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\n    }\n    return sum < 0;\n  }\n\n  /**\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\n   * Call [[Polygon.triangulate]] to generate a [[CompositeCollider]] from this non-convex shape\n   */\n  public isConvex(): boolean {\n    // From SO: https://stackoverflow.com/a/45372025\n    if (this.points.length < 3) {\n      return false;\n    }\n    let oldPoint = this.points[this.points.length - 2];\n    let newPoint = this.points[this.points.length - 1];\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n    let oldDirection = 0;\n    let orientation = 0;\n    let angleSum = 0;\n    for (const [i, point] of this.points.entries()) {\n      oldPoint = newPoint;\n      oldDirection = direction;\n      newPoint =  point;\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\n      if (oldPoint.equals(newPoint)) {\n        return false; // repeat point\n      }\n      let angle = direction - oldDirection;\n      if (angle <= -Math.PI){\n        angle += Math.PI * 2;\n      } else if (angle > Math.PI) {\n        angle -= Math.PI * 2;\n      }\n      if (i === 0) {\n        if (angle === 0.0) {\n          return false;\n        }\n        orientation = angle  > 0 ? 1 : -1;\n      } else {\n        if (orientation * angle <= 0) {\n          return false;\n        }\n      }\n      angleSum += angle;\n    }\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\n  }\n\n  /**\n   * Tessellates the polygon into a triangle fan as a [[CompositeCollider]] of triangle polygons\n   */\n  public tessellate(): CompositeCollider {\n    const polygons: Vector[][] = [];\n    for (let i = 1; i < this.points.length - 2; i++) {\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\n    }\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\n\n    return new CompositeCollider(polygons.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\n   * Returns a new [[CompositeCollider]] made up of smaller triangles.\n   */\n  public triangulate(): CompositeCollider {\n    // https://www.youtube.com/watch?v=hTJFcHutls8\n    if (this.points.length < 3) {\n      throw Error('Invalid polygon');\n    }\n\n    /**\n     * Helper to get a vertex in the list\n     */\n    function getItem<T>(index: number, list: T[]) {\n      if (index >= list.length) {\n        return list[index % list.length];\n      } else if (index < 0) {\n        return list[index % list.length + list.length];\n      } else {\n        return list[index];\n      }\n    }\n\n    /**\n     * Quick test for point in triangle\n     */\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\n      const ab = b.sub(a);\n      const bc = c.sub(b);\n      const ca = a.sub(c);\n\n      const ap = point.sub(a);\n      const bp = point.sub(b);\n      const cp = point.sub(c);\n\n      const cross1 = ab.cross(ap);\n      const cross2 = bc.cross(bp);\n      const cross3 = ca.cross(cp);\n\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\n        return false;\n      }\n      return true;\n    }\n\n    const triangles: Vector[][] = [];\n    const vertices = [...this.points];\n    const indices = range(0, this.points.length - 1);\n\n    // 1. Loop through vertices clockwise\n    //    if the vertex is convex (interior angle is < 180) (cross product positive)\n    //    if the polygon formed by it's edges doesn't contain the points\n    //         it's an ear add it to our list of triangles, and restart\n\n    while (indices.length > 3) {\n      for (let i = 0; i < indices.length; i++) {\n        const a = indices[i];\n        const b = getItem(i - 1, indices);\n        const c = getItem(i + 1, indices);\n\n        const va = vertices[a];\n        const vb = vertices[b];\n        const vc = vertices[c];\n\n        // Check convexity\n        const leftArm = vb.sub(va);\n        const rightArm = vc.sub(va);\n        const isConvex = rightArm.cross(leftArm) > 0; // positive cross means convex\n        if (!isConvex) {\n          continue;\n        }\n\n        let isEar = true;\n        // Check that if any vertices are in the triangle a, b, c\n        for (let j = 0; j < indices.length; j++) {\n          const vertIndex = indices[j];\n          // We can skip these\n          if (vertIndex === a || vertIndex === b || vertIndex === c) {\n            continue;\n          }\n\n          const point = vertices[vertIndex];\n          if (isPointInTriangle(point, vb, va, vc)) {\n            isEar = false;\n            break;\n          }\n        }\n\n        // Add ear to polygon list and remove from list\n        if (isEar) {\n          triangles.push([vb, va, vc]);\n          indices.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    triangles.push([vertices[indices[0]], vertices[indices[1]], vertices[indices[2]]]);\n\n    return new CompositeCollider(triangles.map(points => Shape.Polygon(points)));\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): PolygonCollider {\n    return new PolygonCollider({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone())\n    });\n  }\n\n  /**\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\n   */\n  public get worldPos(): Vector {\n    if (this._transform) {\n      return this._transform.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collider in world coordinates\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const transform = this._transform as TransformComponent;\n\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\n    const angle = transform ? transform.globalRotation : 0;\n    const scale = transform ? transform.globalScale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    this._calculateTransformation();\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  /**\n   * Returns the local coordinate space sides\n   */\n  public getLocalSides(): Line[] {\n    if (this._localSides.length) {\n      return this._localSides;\n    }\n    const lines = [];\n    const points = this.points;\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      // This winding is important\n      lines.push(new Line(points[i], points[(i + 1) % len]));\n    }\n    this._localSides = lines;\n    return this._localSides;\n  }\n\n  /**\n   * Given a direction vector find the world space side that is most in that direction\n   * @param direction\n   */\n  public findSide(direction: Vector): Line {\n    const sides = this.getSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Given a direction vector find the local space side that is most in that direction\n   * @param direction\n   */\n  public findLocalSide(direction: Vector): Line {\n    const sides = this.getLocalSides();\n    let bestSide = sides[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let side = 0; side < sides.length; side++) {\n      const currentSide = sides[side];\n      const sideNormal = currentSide.normal();\n      const mostDirection = sideNormal.dot(direction);\n      if (mostDirection > maxDistance) {\n        bestSide = currentSide;\n        maxDistance = mostDirection;\n      }\n    }\n    return bestSide;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n    const axes = this.getSides().map((s) => s.normal());\n    this._axes = axes;\n    return this._axes;\n  }\n\n  public update(transform: Transform): void {\n    this._transform = transform;\n    this._sides.length = 0;\n    this._localSides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n    this.getLocalSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collider in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function (accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  public getClosestLineBetween(collider: Collider): Line {\n    if (collider instanceof CircleCollider) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\n    } else if (collider instanceof PolygonCollider) {\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\n   * return null.\n   * @param collider\n   */\n  public collide(collider: Collider): CollisionContact[] {\n    if (collider instanceof CircleCollider) {\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\n    } else if (collider instanceof PolygonCollider) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\n    } else if (collider instanceof EdgeCollider) {\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\n    }\n  }\n\n  /**\n   * Find the point on the collider furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Find the local point on the collider furthest in the direction specified\n   * @param direction\n   */\n  public getFurthestLocalPoint(direction: Vector): Vector {\n    const pts = this.points;\n    let furthestPoint = pts[0];\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const tx = this._transform as TransformComponent;\n    const scale = tx?.globalScale ?? Vector.One;\n    const rotation = tx?.globalRotation ?? 0;\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public getInertia(mass: number): number {\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const effectiveOffset = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n\n    const firstPoint = this.points[0].add(effectiveOffset);\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    // Points are relative\n    this.points\n      .map((p) => p.add(effectiveOffset))\n      .forEach(function (point) {\n        ctx.lineTo(point.x, point.y);\n      });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\n    const firstPoint = this.getTransformedPoints()[0];\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\n    for (let i = 0; i < points.length - 1; i++) {\n      ex.drawLine(points[i], points[i + 1], color, 2);\n      ex.drawCircle(points[i], 2, color);\n      ex.drawCircle(points[i + 1], 2, color);\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function (point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { PolygonCollider } from './PolygonCollider';\nimport { CircleCollider } from './CircleCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { BoundingBox } from '../BoundingBox';\nimport { vec, Vector } from '../../Math/vector';\nimport { CompositeCollider } from './CompositeCollider';\nimport { Logger } from '../..';\n\n/**\n * Excalibur helper for defining colliders quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\n   *\n   * PolygonColliders are useful for creating convex polygon shapes\n   * @param points Points specified in counter clockwise\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero): PolygonCollider {\n    return new PolygonCollider({\n      points: points,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[CircleCollider|circle]] collider\n   *\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\n   * @param radius Radius of the circle collider\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\n    return new CircleCollider({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[EdgeCollider|edge]] collider\n   *\n   * Edge colliders are useful for  floors, walls, and other barriers\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\n    return new EdgeCollider({\n      begin: begin,\n      end: end\n    });\n  }\n\n  /**\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\n   *\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\n   * player experience.\n   *\n   * @param width\n   * @param height\n   * @param offset Optional offset\n   */\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\n    const logger = Logger.getInstance();\n    if (width === height) {\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\n    }\n\n    const vertical = height >= width;\n\n    if (vertical) {\n      // height > width, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\n        Shape.Box(width, height - width, Vector.Half, offset),\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\n      ]);\n      return capsule;\n    } else {\n      // width > height, if equal maybe use a circle\n      const capsule = new CompositeCollider([\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\n        Shape.Box(width - height, height, Vector.Half, offset),\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\n      ]);\n      return capsule;\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport { Observable } from '../Util/Observable';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { CircleCollider } from './Colliders/CircleCollider';\nimport { Collider } from './Colliders/Collider';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { PolygonCollider } from './Colliders/PolygonCollider';\nimport { EdgeCollider } from './Colliders/EdgeCollider';\nimport { Shape } from './Colliders/Shape';\n\nexport class ColliderComponent extends Component<'ex.collider'> {\n  public readonly type = 'ex.collider';\n\n  public events = new EventDispatcher();\n  /**\n   * Observable that notifies when a collider is added to the body\n   */\n  public $colliderAdded = new Observable<Collider>();\n\n  /**\n   * Observable that notifies when a collider is removed from the body\n   */\n  public $colliderRemoved = new Observable<Collider>();\n\n  constructor(collider?: Collider) {\n    super();\n    this.set(collider);\n  }\n\n  private _collider: Collider;\n  /**\n   * Get the current collider geometry\n   */\n  public get() {\n    return this._collider;\n  }\n\n  /**\n   * Set the collider geometry\n   * @param collider\n   * @returns the collider you set\n   */\n  public set<T extends Collider>(collider: T): T {\n    this.clear();\n    if (collider) {\n      this._collider = collider;\n      this._collider.owner = this.owner;\n      this.events.wire(collider.events);\n      this.$colliderAdded.notifyAll(collider);\n      this.update();\n    }\n    return collider;\n  }\n\n  /**\n   * Remove collider geometry from collider component\n   */\n  public clear() {\n    if (this._collider) {\n      this.events.unwire(this._collider.events);\n      this.$colliderRemoved.notifyAll(this._collider);\n      this._collider.owner = null;\n      this._collider = null;\n    }\n  }\n\n  /**\n   * Return world space bounds\n   */\n  public get bounds() {\n    return this._collider?.bounds ?? new BoundingBox();\n  }\n\n  /**\n   * Return local space bounds\n   */\n  public get localBounds() {\n    return this._collider?.localBounds ?? new BoundingBox();\n  }\n\n  /**\n   * Update the collider's transformed geometry\n   */\n  public update() {\n    const tx = this.owner?.get(TransformComponent);\n    if (this._collider) {\n      this._collider.owner = this.owner;\n      if (tx) {\n        this._collider.update(tx);\n      }\n    }\n  }\n\n  /**\n   * Collide component with another\n   * @param other\n   */\n  collide(other: ColliderComponent): CollisionContact[] {\n    let colliderA = this._collider;\n    let colliderB = other._collider;\n    if (!colliderA || !colliderB) {\n      return [];\n    }\n\n    // If we have a composite lefthand side :(\n    // Might bite us, but to avoid updating all the handlers make composite always left side\n    let flipped = false;\n    if (colliderB instanceof CompositeCollider) {\n      colliderA = colliderB;\n      colliderB = this._collider;\n      flipped = true;\n    }\n\n    if (this._collider) {\n      const contacts = colliderA.collide(colliderB);\n      if (contacts) {\n        if (flipped) {\n          contacts.forEach((contact) => {\n            contact.mtv = contact.mtv.negate();\n            contact.normal = contact.normal.negate();\n            contact.tangent = contact.normal.perpendicular();\n            contact.colliderA = this._collider;\n            contact.colliderB = other._collider;\n          });\n        }\n        return contacts;\n      }\n      return [];\n    }\n    return [];\n  }\n\n  onAdd(entity: Entity) {\n    if (this._collider) {\n      this.update();\n    }\n    // Wire up the collider events to the owning entity\n    this.events.on('precollision', (evt: any) => {\n      const precollision = evt as PreCollisionEvent<Collider>;\n      entity.events.emit(\n        'precollision',\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\n      );\n    });\n    this.events.on('postcollision', (evt: any) => {\n      const postcollision = evt as PostCollisionEvent<Collider>;\n      entity.events.emit(\n        'postcollision',\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\n      );\n    });\n    this.events.on('collisionstart', (evt: any) => {\n      const start = evt as CollisionStartEvent<Collider>;\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\n    });\n    this.events.on('collisionend', (evt: any) => {\n      const end = evt as CollisionEndEvent<Collider>;\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\n    });\n  }\n\n  onRemove() {\n    this.events.clear();\n    this.$colliderRemoved.notifyAll(this._collider);\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\n    const collider = Shape.Box(width, height, anchor, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\n    const poly = Shape.Polygon(points, center);\n    return (this.set(poly));\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\n    const collider = Shape.Circle(radius, center);\n    return (this.set(collider));\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\n    const collider = Shape.Edge(begin, end);\n    return (this.set(collider));\n  }\n\n  /**\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\n   * @param colliders\n   */\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\n    return (this.set(new CompositeCollider(colliders)));\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from './Physics';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { CollisionGroup } from './Group/CollisionGroup';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { createId, Id } from '../Id';\nimport { clamp } from '../Math/util';\nimport { ColliderComponent } from './ColliderComponent';\n\nexport interface BodyComponentOptions {\n  type?: CollisionType;\n  group?: CollisionGroup;\n  useGravity?: boolean;\n}\n\nexport enum DegreeOfFreedom {\n  Rotation = 'rotation',\n  X = 'x',\n  Y = 'y'\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\n * of physics simulation.\n */\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\n  public readonly type = 'ex.body';\n  public dependencies = [TransformComponent, MotionComponent];\n  public static _ID = 0;\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\n  public events = new EventDispatcher();\n\n  constructor(options?: BodyComponentOptions) {\n    super();\n    if (options) {\n      this.collisionType = options.type ?? this.collisionType;\n      this.group = options.group ?? this.group;\n      this.useGravity = options.useGravity ?? this.useGravity;\n    }\n  }\n\n  /**\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\n   */\n  public collisionType: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * The collision group for the body's colliders, by default body colliders collide with everything\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /**\n   * The amount of mass the body has\n   */\n  public mass: number = Physics.defaultMass;\n\n  /**\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseMass(): number {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\n  }\n\n  /**\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\n   */\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\n\n  /**\n   * Can this body sleep, by default bodies do not sleep\n   */\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\n\n  private _sleeping = false;\n  /**\n   * Whether this body is sleeping or not\n   */\n  public get sleeping(): boolean {\n    return this._sleeping;\n  }\n\n  /**\n   * Set the sleep state of the body\n   * @param sleeping\n   */\n  public setSleeping(sleeping: boolean) {\n    this._sleeping = sleeping;\n    if (!sleeping) {\n      // Give it a kick to keep it from falling asleep immediately\n      this.sleepMotion = Physics.sleepEpsilon * 5;\n    } else {\n      this.vel = Vector.Zero;\n      this.acc = Vector.Zero;\n      this.angularVelocity = 0;\n      this.sleepMotion = 0;\n    }\n  }\n\n  /**\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\n   */\n  public updateMotion() {\n    if (this._sleeping) {\n      this.setSleeping(true);\n    }\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\n    const bias = Physics.sleepBias;\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\n      this.setSleeping(true);\n    }\n  }\n\n  /**\n   * Get the moment of inertia from the [[ColliderComponent]]\n   */\n  public get inertia() {\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\n    const collider = this.owner.get(ColliderComponent);\n    if (collider?.get()) {\n      return collider.get().getInertia(this.mass);\n    }\n    return 0;\n  }\n\n  /**\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\n   */\n  public get inverseInertia() {\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\n  }\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\n   */\n  public useGravity: boolean = true;\n\n  /**\n   * Degrees of freedom to limit\n   */\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\n\n  /**\n   * Returns if the owner is active\n   */\n  public get active() {\n    return !!this.owner?.active;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  public get transform(): TransformComponent {\n    return this.owner?.get(TransformComponent);\n  }\n\n  public get motion(): MotionComponent {\n    return this.owner?.get(MotionComponent);\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public get pos(): Vector {\n    return this.transform.globalPos;\n  }\n\n  public set pos(val: Vector) {\n    this.transform.globalPos = val;\n  }\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this.motion.vel = val;\n  }\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  public set acc(val: Vector) {\n    this.motion.acc = val;\n  }\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public get torque(): number {\n    return this.motion.torque;\n  }\n\n  public set torque(val: number) {\n    this.motion.torque = val;\n  }\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the body in radians\n   */\n  public get rotation() {\n    return this.transform.globalRotation;\n  }\n\n  public set rotation(val: number) {\n    this.transform.globalRotation = val;\n  }\n\n  /**\n   * The scale vector of the actor\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\n   */\n  public get scale(): Vector {\n    return this.transform.globalScale;\n  }\n\n  public set scale(val: Vector) {\n    this.transform.globalScale = val;\n  }\n\n  /**\n   * The scale of the actor last frame\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sx(): number {\n    return this.motion.scaleFactor.x;\n  }\n\n  public set sx(xFactor: number) {\n    this.motion.scaleFactor.x = xFactor;\n  }\n\n  /**\n   * The y scalar velocity of the actor in scale/second\n   * @deprecated ex.Body.scale will be removed in v0.25.0\n   */\n  public get sy(): number {\n    return this.motion.scaleFactor.y;\n  }\n\n  public set sy(yFactor: number) {\n    this.motion.scaleFactor.y = yFactor;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public get rx(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   * @deprecated\n   */\n  public set rx(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Get the angular velocity in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Set the angular velocity in radians/second\n   */\n  public set angularVelocity(value: number) {\n    this.motion.angularVelocity = value;\n  }\n\n  /**\n   * Apply a specific impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel.addEqual(finalImpulse);\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Apply only linear impulse to the body\n   * @param impulse\n   */\n  public applyLinearImpulse(impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    const finalImpulse = impulse.scale(this.inverseMass);\n\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\n      finalImpulse.x = 0;\n    }\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\n      finalImpulse.y = 0;\n    }\n\n    this.vel = this.vel.add(finalImpulse);\n  }\n\n  /**\n   * Apply only angular impulse to the body\n   * @param point\n   * @param impulse\n   */\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\n    if (this.collisionType !== CollisionType.Active) {\n      return; // only active objects participate in the simulation\n    }\n\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\n      const distanceFromCenter = point.sub(this.pos);\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\n    }\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Component, ComponentCtor, TagComponent } from './Component';\n\nimport { Observable, Message } from '../Util/Observable';\nimport { Class } from '../Class';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\nimport { Engine } from '../Engine';\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Util } from '..';\n\n/**\n * Interface holding an entity component pair\n */\nexport interface EntityComponent {\n  component: Component;\n  entity: Entity;\n}\n\n/**\n * AddedComponent message\n */\nexport class AddedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Added' = 'Component Added';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is f an Added Component\n */\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\n  return !!x && x.type === 'Component Added';\n}\n\n/**\n * RemovedComponent message\n */\nexport class RemovedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Removed' = 'Component Removed';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is for a Removed Component\n */\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\n  return !!x && x.type === 'Component Removed';\n}\n\n/**\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\n *\n * Entities can be strongly typed with the components they contain\n *\n * ```typescript\n * const entity = new Entity<ComponentA | ComponentB>();\n * entity.components.a; // Type ComponentA\n * entity.components.b; // Type ComponentB\n * ```\n */\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\n  private static _ID = 0;\n\n  constructor(components?: Component[], name?: string) {\n    super();\n    this._setName(name);\n    if (components) {\n      for (const component of components) {\n        this.addComponent(component);\n      }\n    }\n  }\n\n  /**\n   * The unique identifier for the entity\n   */\n  public id: number = Entity._ID++;\n\n  private _name: string = 'anonymous';\n  protected _setName(name: string) {\n    if (name) {\n      this._name = name;\n    }\n  }\n  public get name(): string {\n    return this._name;\n  }\n\n  public get events(): EventDispatcher {\n    return this.eventDispatcher;\n  }\n\n  /**\n   * Whether this entity is active, if set to false it will be reclaimed\n   */\n  public active: boolean = true;\n\n  /**\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\n   */\n  public kill() {\n    this.active = false;\n  }\n\n  public isKilled() {\n    return !this.active;\n  }\n\n  /**\n   * Specifically get the tags on the entity from [[TagComponent]]\n   */\n  public get tags(): readonly string[] {\n    return this._tagsMemo;\n  }\n\n  /**\n   * Check if a tag exists on the entity\n   * @param tag name to check for\n   */\n  public hasTag(tag: string): boolean {\n    return this.tags.includes(tag);\n  }\n\n  /**\n   * Adds a tag to an entity\n   * @param tag\n   * @returns Entity\n   */\n  public addTag(tag: string) {\n    return this.addComponent(new TagComponent(tag));\n  }\n\n  /**\n   * Removes a tag on the entity\n   *\n   * Removals are deferred until the end of update\n   * @param tag\n   * @param force Remove component immediately, no deferred\n   */\n  public removeTag(tag: string, force = false) {\n    return this.removeComponent(tag, force);\n  }\n\n  /**\n   * The types of the components on the Entity\n   */\n  public get types(): string[] {\n    return this._typesMemo;\n  }\n\n  /**\n   * Bucket to hold on to deferred removals\n   */\n  private _componentsToRemove: (Component | string)[] = [];\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\n  private _componentStringToInstance = new Map<string, Component>();\n\n  private _tagsMemo: string[] = [];\n  private _typesMemo: string[] = [];\n  private _rebuildMemos() {\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\n      .filter((c) => c instanceof TagComponent)\n      .map((c) => c.type);\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\n  }\n\n  public getComponents(): Component[] {\n    return Array.from(this._componentStringToInstance.values());\n  }\n\n  /**\n   * Observable that keeps track of component add or remove changes on the entity\n   */\n  public componentAdded$ = new Observable<AddedComponent>();\n  private _notifyAddComponent(component: Component) {\n    this._rebuildMemos();\n    const added = new AddedComponent({\n      component,\n      entity: this\n    });\n    this.componentAdded$.notifyAll(added);\n  }\n\n  public componentRemoved$ = new Observable<RemovedComponent>();\n  private _notifyRemoveComponent(component: Component) {\n    const removed = new RemovedComponent({\n      component,\n      entity: this\n    });\n    this.componentRemoved$.notifyAll(removed);\n    this._rebuildMemos();\n  }\n\n  private _parent: Entity = null;\n  public get parent(): Entity {\n    return this._parent;\n  }\n\n  public childrenAdded$ = new Observable<Entity>();\n  public childrenRemoved$ = new Observable<Entity>();\n\n  private _children: Entity[] = [];\n  /**\n   * Get the direct children of this entity\n   */\n  public get children(): readonly Entity[] {\n    return this._children;\n  }\n\n  /**\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\n   */\n  public unparent() {\n    if (this._parent) {\n      this._parent.removeChild(this);\n      this._parent = null;\n    }\n  }\n\n  /**\n   * Adds an entity to be a child of this entity\n   * @param entity\n   */\n  public addChild(entity: Entity): Entity {\n    if (entity.parent === null) {\n      if (this.getAncestors().includes(entity)) {\n        throw new Error('Cycle detected, cannot add entity');\n      }\n      this._children.push(entity);\n      entity._parent = this;\n      this.childrenAdded$.notifyAll(entity);\n    } else {\n      throw new Error('Entity already has a parent, cannot add without unparenting');\n    }\n    return this;\n  }\n\n  /**\n   * Remove an entity from children if it exists\n   * @param entity\n   */\n  public removeChild(entity: Entity): Entity {\n    if (entity.parent === this) {\n      Util.removeItemFromArray(entity, this._children);\n      entity._parent = null;\n      this.childrenRemoved$.notifyAll(entity);\n    }\n    return this;\n  }\n\n  /**\n   * Removes all children from this entity\n   */\n  public removeAllChildren(): Entity {\n    this.children.forEach((c) => {\n      this.removeChild(c);\n    });\n    return this;\n  }\n\n  /**\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\n   */\n  public getAncestors(): Entity[] {\n    const result: Entity[] = [this];\n    let current = this.parent;\n    while (current) {\n      result.push(current);\n      current = current.parent;\n    }\n    return result.reverse();\n  }\n\n  /**\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\n   */\n  public getDescendants(): Entity[] {\n    let result: Entity[] = [this];\n    let queue: Entity[] = [this];\n    while (queue.length > 0) {\n      const curr = queue.pop();\n      queue = queue.concat(curr.children);\n      result = result.concat(curr.children);\n    }\n    return result;\n  }\n\n  /**\n   * Creates a deep copy of the entity and a copy of all its components\n   */\n  public clone(): Entity {\n    const newEntity = new Entity();\n    for (const c of this.types) {\n      newEntity.addComponent(this.get(c).clone());\n    }\n    for (const child of this.children) {\n      newEntity.addChild(child.clone());\n    }\n    return newEntity;\n  }\n\n  /**\n   * Adds a copy of all the components from another template entity as a \"prefab\"\n   * @param templateEntity Entity to use as a template\n   * @param force Force component replacement if it already exists on the target entity\n   */\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\n    for (const c of templateEntity.getComponents()) {\n      this.addComponent(c.clone(), force);\n    }\n    for (const child of templateEntity.children) {\n      this.addChild(child.clone().addTemplate(child));\n    }\n    return this;\n  }\n\n  /**\n   * Adds a component to the entity\n   * @param component Component or Entity to add copy of components from\n   * @param force Optionally overwrite any existing components of the same type\n   */\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\n    // if component already exists, skip if not forced\n    if (this.has(component.type)) {\n      if (force) {\n        // Remove existing component type if exists when forced\n        this.removeComponent(component);\n      } else {\n        // early exit component exits\n        return this;\n      }\n    }\n\n    // TODO circular dependencies will be a problem\n    if (component.dependencies && component.dependencies.length) {\n      for (const ctor of component.dependencies) {\n        this.addComponent(new ctor());\n      }\n    }\n\n    component.owner = this;\n    const constuctorType = component.constructor as ComponentCtor<T>;\n    this._componentTypeToInstance.set(constuctorType, component);\n    this._componentStringToInstance.set(component.type, component);\n    if (component.onAdd) {\n      component.onAdd(this);\n    }\n    this._notifyAddComponent(component);\n\n    return this;\n  }\n\n  /**\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\n   *\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\n   * @param componentOrType\n   * @param force\n   */\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\n    if (force) {\n      if (typeof componentOrType === 'string') {\n        this._removeComponentByType(componentOrType);\n      } else if (componentOrType instanceof Component) {\n        this._removeComponentByType(componentOrType.type);\n      }\n    } else {\n      this._componentsToRemove.push(componentOrType);\n    }\n\n    return this as any;\n  }\n\n  private _removeComponentByType(type: string) {\n    if (this.has(type)) {\n      const component = this.get(type);\n      component.owner = null;\n      if (component.onRemove) {\n        component.onRemove(this);\n      }\n      const ctor = component.constructor as ComponentCtor;\n      this._componentTypeToInstance.delete(ctor);\n      this._componentStringToInstance.delete(component.type);\n      this._notifyRemoveComponent(component);\n    }\n  }\n\n  /**\n   * @hidden\n   * @internal\n   */\n  public processComponentRemoval() {\n    for (const componentOrType of this._componentsToRemove) {\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\n      this._removeComponentByType(type);\n    }\n    this._componentsToRemove.length = 0;\n  }\n\n  /**\n   * Check if a component type exists\n   * @param type\n   */\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\n  public has(type: string): boolean;\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.has(type);\n    } else {\n      return this._componentTypeToInstance.has(type);\n    }\n  }\n\n  /**\n   * Get a component by type with typecheck\n   *\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\n   * @param type\n   */\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\n  public get<T extends Component>(type: string): T | null;\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\n    if (typeof type === 'string') {\n      return this._componentStringToInstance.get(type) as T;\n    } else {\n      return this._componentTypeToInstance.get(type) as T;\n    }\n  }\n\n  private _isInitialized = false;\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\n   * overridden.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an entity is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an entity is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   *\n   * Entity update lifecycle, called internally\n   *\n   * @internal\n   * @param engine\n   * @param delta\n   */\n  public update(engine: Engine, delta: number): void {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n    for (const child of this.children) {\n      child.update(engine, delta);\n    }\n    this._postupdate(engine, delta);\n  }\n}\n","import { Component } from '../EntityComponentSystem';\n\n/**\n * Shim to draw to the canvas when in LegacyDrawing mode\n * @deprecated\n */\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\n  public readonly type = 'ex.canvas';\n\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\n    super();\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    this.draw = this.draw ?? (() => {});\n  }\n}\n","import { Vector, vec } from '../Math/vector';\nimport { Graphic } from './Graphic';\nimport { HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Logger } from '../Util/Log';\nimport { BoundingBox } from '../Collision/Index';\nimport { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\n * @param graphic\n */\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\n  return !!(graphic as unknown as HasTick).tick;\n}\nexport interface GraphicsShowOptions {\n  offset?: Vector;\n  anchor?: Vector;\n}\n\nexport interface GraphicsComponentOptions {\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\n\n  /**\n   * Name of current graphic to use\n   */\n  current?: string;\n\n  /**\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\n   */\n  copyGraphics?: boolean;\n\n  /**\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\n   */\n  visible?: boolean;\n\n  /**\n   * Optional opacity\n   */\n  opacity?: number;\n\n  /**\n   * List of graphics\n   */\n  graphics?: { [graphicName: string]: Graphic };\n\n  /**\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\n   */\n  offset?: Vector;\n\n  /**\n   * Optional anchor\n   */\n  anchor?: Vector;\n}\n\nexport interface GraphicsLayerOptions {\n  /**\n   * Name of the layer required, for example 'background'\n   */\n  name: string;\n  /**\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\n   */\n  order: number;\n  /**\n   * Offset to shift the entire layer\n   */\n  offset?: Vector;\n}\nexport class GraphicsLayer {\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\n  public get name(): string {\n    return this._options.name;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in this layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in this layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    if (!nameOrGraphic) {\n      this.graphics.length = 0;\n    } else {\n      let gfx: Graphic = null;\n      if (nameOrGraphic instanceof Graphic) {\n        gfx = nameOrGraphic;\n      } else {\n        gfx = this._graphics.getGraphic(nameOrGraphic);\n      }\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\n      this._graphics.recalculateBounds();\n    }\n  }\n\n  /**\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\n   *\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\n   * @param nameOrGraphic\n   * @param options\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    let gfx: Graphic;\n    if (nameOrGraphic instanceof Graphic) {\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\n    } else {\n      gfx = this._graphics.getGraphic(nameOrGraphic);\n      if (!gfx) {\n        Logger.getInstance().error(\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\n          this._graphics.getNames()\n        );\n      }\n    }\n    if (gfx) {\n      this.graphics.push({ graphic: gfx, options });\n      this._graphics.recalculateBounds();\n      return gfx as T;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Use a specific graphic, swap out any current graphics being shown\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    options = { ...options };\n    this.hide();\n    return this.show<T>(nameOrGraphic, options);\n  }\n\n  /**\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public get order(): number {\n    return this._options.order;\n  }\n\n  /**\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\n   *\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\n   */\n  public set order(order: number) {\n    this._options.order = order;\n  }\n\n  /**\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\n   */\n  public get offset(): Vector {\n    return this._options.offset ?? Vector.Zero;\n  }\n\n  public set offset(value: Vector) {\n    this._options.offset = value;\n  }\n\n  public get currentKeys(): string {\n    return this.name ?? 'anonymous';\n  }\n}\n\nexport class GraphicsLayers {\n  private _layers: GraphicsLayer[] = [];\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\n  public default: GraphicsLayer;\n  constructor(private _component: GraphicsComponent) {\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\n    this._maybeAddLayer(this.default);\n  }\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\n    const layer = new GraphicsLayer(options, this._component);\n    return this._maybeAddLayer(layer);\n  }\n\n  /**\n   * Retrieve a single layer by name\n   * @param name\n   */\n  public get(name: string): GraphicsLayer;\n  /**\n   * Retrieve all layers\n   */\n  public get(): readonly GraphicsLayer[];\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\n    if (name) {\n      return this._getLayer(name);\n    }\n    return this._layers;\n  }\n\n  public currentKeys() {\n    const graphicsLayerKeys = [];\n    for (const layer of this._layers) {\n      graphicsLayerKeys.push(layer.currentKeys);\n    }\n    return graphicsLayerKeys;\n  }\n\n  public has(name: string): boolean {\n    return name in this._layerMap;\n  }\n\n  private _maybeAddLayer(layer: GraphicsLayer) {\n    if (this._layerMap[layer.name]) {\n      // todo log warning\n      return this._layerMap[layer.name];\n    }\n    this._layerMap[layer.name] = layer;\n    this._layers.push(layer);\n    this._layers.sort((a, b) => a.order - b.order);\n    return layer;\n  }\n\n  private _getLayer(name: string): GraphicsLayer | undefined {\n    return this._layerMap[name];\n  }\n}\n\n/**\n * Component to manage drawings, using with the position component\n */\nexport class GraphicsComponent extends Component<'ex.graphics'> {\n  readonly type = 'ex.graphics';\n\n  private _graphics: { [graphicName: string]: Graphic } = {};\n\n  public layers: GraphicsLayers;\n\n  public getGraphic(name: string): Graphic | undefined {\n    return this._graphics[name];\n  }\n\n  /**\n   * Get registered graphics names\n   */\n  public getNames(): string[] {\n    return Object.keys(this._graphics);\n  }\n\n  /**\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\n   */\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\n   */\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\n\n  /**\n   * Sets or gets wether any drawing should be visible in this component\n   */\n  public visible: boolean = true;\n\n  /**\n   * Sets or gets wither all drawings should have an opacity applied\n   */\n  public opacity: number = 1;\n\n  /**\n   * Offset to apply to graphics by default\n   */\n  public offset: Vector = Vector.Zero;\n\n  /**\n   * Anchor to apply to graphics by default\n   */\n  public anchor: Vector = Vector.Half;\n\n  /**\n   * If set to true graphics added to the component will be copied. This can affect performance\n   */\n  public copyGraphics: boolean = false;\n\n  constructor(options?: GraphicsComponentOptions) {\n    super();\n    // Defaults\n    options = {\n      visible: this.visible,\n      ...options\n    };\n\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\n\n    this._graphics = graphics || {};\n    this.offset = offset ?? this.offset;\n    this.opacity = opacity ?? this.opacity;\n    this.anchor = anchor ?? this.anchor;\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\n    this.visible = !!visible;\n\n    this.layers = new GraphicsLayers(this);\n    if (current && this._graphics[current]) {\n      this.show(this._graphics[current]);\n    }\n  }\n\n  /**\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\n   */\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\n    return this.layers.default.graphics;\n  }\n\n  /**\n   * Returns all graphics associated with this component\n   */\n  public get graphics(): { [graphicName: string]: Graphic } {\n    return this._graphics;\n  }\n\n  /**\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\n   * `show(\"default\")`\n   * @param graphic\n   */\n  public add(graphic: Graphic): Graphic;\n  public add(name: string, graphic: Graphic): Graphic;\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\n    let name = 'default';\n    let graphicToSet: Graphic = null;\n    if (typeof nameOrGraphic === 'string') {\n      name = nameOrGraphic;\n      graphicToSet = graphic;\n    } else {\n      graphicToSet = nameOrGraphic;\n    }\n\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\n    if (name === 'default') {\n      this.show('default');\n    }\n    return graphicToSet;\n  }\n\n  /**\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\n   */\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.show<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\n   * @param nameOrGraphic\n   * @param options\n   */\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\n    const result = this.layers.default.use<T>(nameOrGraphic, options);\n    this.recalculateBounds();\n    return result;\n  }\n\n  /**\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\n   */\n  public hide(nameOrGraphic: string | Graphic): void;\n  /**\n   * Remove all currently shown graphics in the **default** layer\n   */\n  public hide(): void;\n  public hide(nameOrGraphic?: string | Graphic): void {\n    this.layers.default.hide(nameOrGraphic);\n  }\n\n  private _localBounds: BoundingBox = null;\n  public set localBounds(bounds: BoundingBox) {\n    this._localBounds = bounds;\n  }\n\n  public recalculateBounds() {\n    let bb = new BoundingBox();\n    for (const layer of this.layers.get()) {\n      for (const { graphic, options } of layer.graphics) {\n        let anchor = this.anchor;\n        let offset = this.offset;\n        if (options?.anchor) {\n          anchor = options.anchor;\n        }\n        if (options?.offset) {\n          offset = options.offset;\n        }\n        const bounds = graphic.localBounds;\n        const offsetX = -bounds.width *  anchor.x + offset.x;\n        const offsetY = -bounds.height *  anchor.y + offset.y;\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\n      }\n    }\n    this._localBounds = bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    if (!this._localBounds) {\n      this.recalculateBounds();\n    }\n    return this._localBounds;\n  }\n\n  /**\n   * Update underlying graphics if necesary, called internally\n   * @param elapsed\n   * @internal\n   */\n  public update(elapsed: number, idempotencyToken: number = 0) {\n    for (const layer of this.layers.get()) {\n      for (const { graphic } of layer.graphics) {\n        if (hasGraphicsTick(graphic)) {\n          graphic?.tick(elapsed, idempotencyToken);\n        }\n      }\n    }\n  }\n}\n","import { Raster, RasterOptions } from './Raster';\n\nexport interface RectangleOptions {\n  width: number;\n  height: number;\n}\n\n/**\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\n */\nexport class Rectangle extends Raster {\n  constructor(options: RasterOptions & RectangleOptions) {\n    super(options);\n    this.width = options.width;\n    this.height = options.height;\n    this.rasterize();\n  }\n\n  public clone(): Rectangle {\n    return new Rectangle({\n      width: this.width,\n      height: this.height,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.color) {\n      ctx.fillRect(0, 0, this.width, this.height);\n    }\n    if (this.strokeColor) {\n      ctx.strokeRect(0, 0, this.width, this.height);\n    }\n  }\n}\n","import { ImageFiltering } from '.';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface CircleOptions {\n  radius: number;\n}\n\n/**\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\n *\n * Circles default to [[ImageFiltering.Blended]]\n */\nexport class Circle extends Raster {\n  private _radius: number = 0;\n  public get radius() {\n    return this._radius;\n  }\n  public set radius(value: number) {\n    this._radius = value;\n    this.width = this._radius * 2;\n    this.height = this._radius * 2;\n    this.flagDirty();\n  }\n  constructor(options: RasterOptions & CircleOptions) {\n    super(options);\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\n    this.radius = options.radius;\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Circle {\n    return new Circle({\n      radius: this.radius,\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.radius > 0) {\n      ctx.beginPath();\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\n\n      if (this.color) {\n        ctx.fill();\n      }\n\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { Component } from '../EntityComponentSystem/Component';\n\n/**\n * Add this component to optionally configure how the pointer\n * system detects pointer events.\n *\n * By default the collider shape is used and graphics bounds is not.\n *\n * If both collider shape and graphics bounds are enabled it will fire events if either or\n * are intersecting the pointer.\n */\nexport class PointerComponent extends Component<'ex.pointer'> {\n  public readonly type = 'ex.pointer';\n  /**\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\n   * user pointer events only to trigger on the same collision geometry used in the collider component\n   * for collision resolution. Default is `true`.\n   */\n  public useColliderShape = true;\n  /**\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\n   * bounds around the graphic to trigger pointer events. Default is `false`.\n   */\n  public useGraphicsBounds = false;\n}","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Entity } from '../EntityComponentSystem/Entity';\nimport { Action } from './Action';\n\n/**\n * Action Queues represent an ordered sequence of actions\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _entity: Entity;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  /**\n   * Add an action to the sequence\n   * @param action\n   */\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  /**\n   * Remove an action by reference from the sequence\n   * @param action\n   */\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  /**\n   * Removes all actions from this sequence\n   */\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  /**\n   *\n   * @returns The total list of actions in this sequence complete or not\n   */\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  /**\n   *\n   * @returns `true` if there are more actions to process in the sequence\n   */\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  /**\n   * @returns `true` if the current sequence of actions is done\n   */\n  public isComplete(): boolean {\n    return this._actions.length === 0;\n  }\n\n  /**\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\n   */\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  /**\n   * Update the queue which updates actions and handles completing actions\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(elapsedMs);\n\n      if (this._currentAction.isComplete(this._entity)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\nexport class Repeat implements Action {\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    this._repeatBuilder(this._repeatContext);\n    this._repeat--; // current execution is the first repeat\n  }\n\n  public update(delta: number): void {\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionContext } from '../ActionContext';\nimport { ActionQueue } from '../ActionQueue';\n\n/**\n * RepeatForever Action implementation, it is recommended you use the fluent action\n * context API.\n *\n *\n */\nexport class RepeatForever implements Action {\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  private _repeatContext: ActionContext;\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\n    this._repeatBuilder = repeatBuilder;\n    this._repeatContext = new ActionContext(entity);\n    this._actionQueue = this._repeatContext.getQueue();\n\n    this._repeatBuilder(this._repeatContext);\n  }\n\n  public update(delta: number): void {\n    if (this._stopped) {\n      return;\n    }\n\n    if (this._actionQueue.isComplete()) {\n      this._actionQueue.clearActions();\n      this._repeatBuilder(this._repeatContext);\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class MoveBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _entity: Entity;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\n    this._entity = entity;\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    if (this.isComplete(this._entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    } else {\n      this._motion.vel = this._dir.scale(this._speed);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class MoveTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete(this.entity)) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(entity: Entity): boolean {\n    const tx = entity.get(TransformComponent);\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\nimport { RotationType } from '../RotationType';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { TwoPI } from '../../Math/util';\n\nexport class RotateBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _currentNonCannonAngle: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._tx.rotation;\n      this._currentNonCannonAngle = this._tx.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._motion.angularVelocity = this._direction * this._speed;\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\n\n    if (this.isComplete()) {\n      this._tx.rotation = this._end;\n      this._motion.angularVelocity = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._motion.angularVelocity = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { vec } from '../../Math/vector';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\nimport { Entity } from '../../EntityComponentSystem/Entity';\n\nexport class ScaleTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._tx.scale.x;\n      this._startY = this._tx.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.x = this._speedX * directionX;\n    } else {\n      this._motion.scaleFactor.x = 0;\n    }\n\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._motion.scaleFactor.y = this._speedY * directionY;\n    } else {\n      this._motion.scaleFactor.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._tx.scale = vec(this._endX, this._endY);\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Action } from '../Action';\n\nexport class ScaleBy implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._tx.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._tx.scale = this._endScale;\n      this._motion.scaleFactor.x = 0;\n      this._motion.scaleFactor.y = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._motion.scaleFactor.x = 0;\n    this._motion.scaleFactor.y = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class CallMethod implements Action {\n  private _method: () => any = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(method: () => any) {\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method();\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n","import { Entity} from '../../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { Actor } from '../../Actor';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class EaseTo implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    entity: Entity,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    // Need to update lerp time first, otherwise the first update will always be zero\n    this._currentLerpTime += delta;\n    let newX = this._tx.pos.x;\n    let newY = this._tx.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      // Given the lerp position figure out the velocity in pixels per second\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\n    } else {\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\n      this._motion.vel = Vector.Zero;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n}\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\n\nexport class Blink implements Action {\n  private _graphics: GraphicsComponent;\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n    if (!this._graphics) {\n      return;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\n      this._graphics.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._graphics.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._graphics.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    if (this._graphics) {\n      this._graphics.visible = true;\n    }\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\nimport { Logger } from '../../Util/Log';\nimport { Action } from '../Action';\n\nexport class Fade implements Action {\n  private _graphics: GraphicsComponent;\n  public x: number;\n  public y: number;\n\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, endOpacity: number, speed: number) {\n    this._graphics = entity.get(GraphicsComponent);\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._graphics) {\n      return;\n    }\n\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._graphics.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._graphics.opacity += (this._multiplier *\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._graphics.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { Action } from '../Action';\n\nexport class Delay implements Action {\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(delay: number) {\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n","import { Entity } from '../../EntityComponentSystem/Entity';\nimport { Action } from '../Action';\nimport { ActionsComponent } from '../ActionsComponent';\n\nexport class Die implements Action {\n  private _entity: Entity;\n  private _stopped = false;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  public update(_delta: number): void {\n    this._entity.get(ActionsComponent).clearActions();\n    this._entity.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { vec, Vector } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Follow implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _followTx: TransformComponent;\n  private _followMotion: MotionComponent;\n\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\n    this._tx = entity.get(TransformComponent);\n    this._motion = entity.get(MotionComponent);\n    this._followTx = entityToFollow.get(TransformComponent);\n    this._followMotion = entityToFollow.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._motion.vel = vec(m.x, m.y);\n    } else {\n      this._motion.vel = vec(0, 0);\n    }\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../../EntityComponentSystem/Entity';\nimport { Vector, vec } from '../../Math/vector';\nimport { Action } from '../Action';\n\nexport class Meet implements Action {\n  private _tx: TransformComponent;\n  private _motion: MotionComponent;\n  private _meetTx: TransformComponent;\n  private _meetMotion: MotionComponent;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\n    this._tx = actor.get(TransformComponent);\n    this._motion = actor.get(MotionComponent);\n    this._meetTx = actorToMeet.get(TransformComponent);\n    this._meetMotion = actorToMeet.get(MotionComponent);\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\n\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._motion.vel = vec(m.x, m.y);\n\n    if (this.isComplete()) {\n      this._tx.pos = vec(this._end.x, this._end.y);\n      this._motion.vel = vec(0, 0);\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._motion.vel = vec(0, 0);\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n","import { RotationType } from './RotationType';\n\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { Repeat } from './Action/Repeat';\nimport { RepeatForever } from './Action/RepeatForever';\nimport { MoveBy } from './Action/MoveBy';\nimport { MoveTo } from './Action/MoveTo';\nimport { RotateTo } from './Action/RotateTo';\nimport { RotateBy } from './Action/RotateBy';\nimport { ScaleTo } from './Action/ScaleTo';\nimport { ScaleBy } from './Action/ScaleBy';\nimport { CallMethod } from './Action/CallMethod';\nimport { EaseTo } from './Action/EaseTo';\nimport { Blink } from './Action/Blink';\nimport { Fade } from './Action/Fade';\nimport { Delay } from './Action/Delay';\nimport { Die } from './Action/Die';\nimport { Follow } from './Action/Follow';\nimport { Meet } from './Action/Meet';\nimport { Vector } from '../Math/vector';\nimport { Entity } from '../EntityComponentSystem/Entity';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[Action]] interface.\n */\nexport class ActionContext {\n  private _entity: Entity;\n  private _queue: ActionQueue;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n    this._queue = new ActionQueue(entity);\n  }\n\n  public getQueue(): ActionQueue {\n    return this._queue;\n  }\n\n  public update(elapsedMs: number) {\n    this._queue.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._queue.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\n  public easeTo(...args: any[]): ActionContext {\n    let x = 0;\n    let y = 0;\n    let duration = 0;\n    let easingFcn = EasingFunctions.Linear;\n    if (args[0] instanceof Vector) {\n      x = args[0].x;\n      y = args[0].y;\n      duration = args[1];\n      easingFcn = args[2] ?? easingFcn;\n    } else {\n      x = args[0];\n      y = args[1];\n      duration = args[2];\n      easingFcn = args[3] ?? easingFcn;\n    }\n\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let x = 0;\n    let y = 0;\n    let speed = 0;\n    if (xOrPos instanceof Vector) {\n      x = xOrPos.x;\n      y = xOrPos.y;\n      speed = yOrSpeed;\n    } else {\n      x = xOrPos;\n      y = yOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\n    let xOffset = 0;\n    let yOffset = 0;\n    let speed = 0;\n    if (xOffsetOrVector instanceof Vector) {\n      xOffset = xOffsetOrVector.x;\n      yOffset = xOffsetOrVector.y;\n      speed = yOffsetOrSpeed;\n    } else {\n      xOffset = xOffsetOrVector;\n      yOffset = yOffsetOrSpeed;\n      speed = speedOrUndefined;\n    }\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number | undefined,\n    speedYOrUndefined?: number | undefined): ActionContext {\n\n    let sizeX = 1;\n    let sizeY = 1;\n    let speedX = 0;\n    let speedY = 0;\n\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\n      sizeX = sizeXOrVector.x;\n      sizeY = sizeXOrVector.y;\n\n      speedX = sizeYOrSpeed.x;\n      speedY = sizeYOrSpeed.y;\n    }\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\n      sizeX = sizeXOrVector;\n      sizeY = sizeYOrSpeed;\n\n      speedX = speedXOrUndefined;\n      speedY = speedYOrUndefined;\n    }\n\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\n    let sizeOffsetX = 1;\n    let sizeOffsetY = 1;\n\n    if (sizeOffsetXOrVector instanceof Vector) {\n      sizeOffsetX = sizeOffsetXOrVector.x;\n      sizeOffsetY = sizeOffsetXOrVector.y;\n\n      speed = sizeOffsetYOrSpeed;\n    }\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\n      sizeOffsetX = sizeOffsetXOrVector;\n      sizeOffsetY = sizeOffsetYOrSpeed;\n    }\n\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    this._queue.add(new Fade(this._entity, opacity, time));\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    this._queue.add(new Delay(time));\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    this._queue.add(new Die(this._entity));\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    this._queue.add(new CallMethod(method));\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever(repeatBuilder);\n      return this;\n    }\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Entity, followDistance?: number): ActionContext {\n    if (followDistance === undefined) {\n      this._queue.add(new Follow(this._entity, entity));\n    } else {\n      this._queue.add(new Follow(this._entity, entity, followDistance));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Entity, speed?: number): ActionContext {\n    if (speed === undefined) {\n      this._queue.add(new Meet(this._entity, entity));\n    } else {\n      this._queue.add(new Meet(this._entity, entity, speed));\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    const temp = new Promise<void>((resolve) => {\n      this._queue.add(\n        new CallMethod(() => {\n          resolve();\n        })\n      );\n    });\n    return temp;\n  }\n}\n","import { ActionContext } from './ActionContext';\nimport { Component } from '../EntityComponentSystem/Component';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Actor } from '../Actor';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Vector } from '../Math/vector';\nimport { EasingFunction } from '../Util/EasingFunctions';\nimport { ActionQueue } from './ActionQueue';\nimport { RotationType } from './RotationType';\n\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\n\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\n  public readonly type = 'ex.actions';\n  dependencies = [TransformComponent, MotionComponent];\n  private _ctx: ActionContext;\n\n  onAdd(entity: Entity) {\n    this._ctx = new ActionContext(entity);\n  }\n\n  onRemove() {\n    this._ctx = null;\n  }\n\n  /**\n   * Returns the internal action queue\n   * @returns action queue\n   */\n  public getQueue(): ActionQueue {\n    return this._ctx?.getQueue();\n  }\n\n  /**\n   * Updates the internal action context, performing action and moving through the internal queue\n   * @param elapsedMs\n   */\n  public update(elapsedMs: number): void {\n    return this._ctx?.update(elapsedMs);\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    this._ctx?.clearActions();\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos       The x,y vector location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\n  public easeTo(...args: any[]): ActionContext {\n    return this._ctx.easeTo.apply(this._ctx, args);\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param pos    The x,y vector location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(pos: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext;\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param offset The (x, y) offset to apply to this actor\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param size    The scale to adjust the actor to over time\n   * @param speed   The speed of scaling specified in magnitude increase per second\n   */\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\n  public scaleTo(\n    sizeXOrVector: number | Vector,\n    sizeYOrSpeed: number | Vector,\n    speedXOrUndefined?: number,\n    speedYOrUndefined?: number): ActionContext {\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param offset   The scaling factor to apply to the actor\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(offset: Vector, speed: number): ActionContext;\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    return this._ctx.fade(opacity, time);\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    return this._ctx.delay(time);\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous  Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    return this._ctx.die();\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    return this._ctx.callMethod(method);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\n    return this._ctx.repeat(repeatBuilder, times);\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the actions built in\n   * the `repeatBuilder` callback. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   *\n   * ```typescript\n   * // Move up in a zig-zag by repeated moveBy's\n   * actor.actions.repeat(repeatCtx => {\n   *  repeatCtx.moveBy(10, 0, 10);\n   *  repeatCtx.moveBy(0, 10, 10);\n   * }, 5);\n   * ```\n   *\n   * @param repeatBuilder The builder to specify the repeatable list of actions\n   */\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\n    return this._ctx.repeatForever(repeatBuilder);\n  }\n\n  /**\n   * This method will cause the entity to follow another at a specified distance\n   * @param entity           The entity to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(entity: Actor, followDistance?: number): ActionContext {\n    return this._ctx.follow(entity, followDistance);\n  }\n\n  /**\n   * This method will cause the entity to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param entity  The entity to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(entity: Actor, speed?: number): ActionContext {\n    return this._ctx.meet(entity, speed);\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\n   */\n  public asPromise(): Promise<void> {\n    return this.toPromise();\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public toPromise(): Promise<void> {\n    return this._ctx.toPromise();\n  }\n}","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { RasterOptions } from './Raster';\nimport { TextureLoader } from '.';\nimport { ImageFiltering } from './Filtering';\n\n/**\n * Represents a system or web font in Excalibur\n *\n * If no options specified, the system sans-serif 10 pixel is used\n *\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\n */\nexport class Font extends Graphic implements FontRenderer {\n  /**\n   * Set the font filtering mode, by default set to [[ImageFiltering.Blended]] regardless of the engine default smoothing\n   *\n   * If you have a pixel style font that may be a reason to switch this to [[ImageFiltering.Pixel]]\n   */\n  public filtering: ImageFiltering = ImageFiltering.Blended;\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\n    super(options); // <- Graphics properties\n\n    // Raster properties\n    this.smoothing = options?.smoothing ?? this.smoothing;\n    this.padding = options?.padding ?? this.padding;\n    this.color = options?.color ?? this.color;\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\n    this.lineDash = options?.lineDash ?? this.lineDash;\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\n    this.filtering = options?.filtering ?? this.filtering;\n\n    // Font specific properties\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 2)\n   */\n  public quality = 2;\n\n  // Raster properties for fonts\n  public padding = 2;\n  public smoothing = false;\n  public lineWidth = 1;\n  public lineDash: number[] = [];\n  public color: Color = Color.Black;\n  public strokeColor: Color;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _textBounds: BoundingBox = new BoundingBox();\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\n    // TODO weird vestigial drawimage\n  }\n\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n\n  /**\n   * Returns a BoundingBox that is the total size of the text including multiple lines\n   *\n   * Does not include any padding or adjustment\n   * @param text\n   * @returns BoundingBox\n   */\n  public measureText(text: string): BoundingBox {\n    const lines = text.split('\\n');\n    const maxWidthLine = lines.reduce((a, b) => {\n      return a.length > b.length ? a : b;\n    });\n    const ctx = this._getTextBitmap(text);\n\n    this._applyFont(ctx); // font must be applied to the context to measure it\n    const metrics = ctx.measureText(maxWidthLine);\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n    // TODO lineheight makes the text bounds wonky\n    const lineAdjustedHeight = textHeight * lines.length;\n    textHeight = lineAdjustedHeight;\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n    const x = 0;\n    const y = 0;\n    return new BoundingBox({\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n      bottom: y + bottomBounds + this.padding,\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n    });\n  }\n\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\n\n    // Changing the width and height clears the context properties\n    // We double the bitmap width to account for all possible alignment\n    // We scale by \"quality\" so we render text without jaggies\n    bitmap.canvas.width = (textBounds.width + this.padding * 2) * 2 * this.quality;\n    bitmap.canvas.height = (textBounds.height + this.padding * 2) * 2 * this.quality;\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    ex.restore();\n  }\n\n  /**\n   * We need to identify bitmaps with more than just the text content\n   *\n   * Any properties that can change the rendering of the text\n   */\n  private _getRasterPropertiesHash(color?: Color): string {\n    const hash = '__hashcode__' +\n    this.fontString +\n    this.showDebug +\n    this.textAlign +\n    this.baseAlign +\n    this.direction +\n    JSON.stringify(this.shadow) +\n    (this.padding.toString() +\n    this.smoothing.toString() +\n    this.lineWidth.toString() +\n    this.lineDash.toString() +\n    this.strokeColor?.toString() +\n    ( color ? color.toString() : this.color?.toString()).toString());\n    return hash;\n  }\n\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D, color: Color) {\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = color ? color.toString() : this.color?.toString();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + ctx.canvas.width / 2, this.padding + ctx.canvas.height / 2);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  private _drawText(ctx: CanvasRenderingContext2D, text: string, colorOverride: Color, lineHeight: number): void {\n    const lines = text.split('\\n');\n    this._applyRasterProperties(ctx, colorOverride);\n    this._applyFont(ctx);\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      if (this.color) {\n        ctx.fillText(line, 0, i * lineHeight);\n      }\n\n      if (this.strokeColor) {\n        ctx.strokeText(line, 0, i * lineHeight);\n      }\n    }\n\n    if (this.showDebug) {\n      // Horizontal line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\n      // Vertical line\n      /* istanbul ignore next */\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\n    }\n  }\n\n  private _textToBitmap = new Map<string, CanvasRenderingContext2D>();\n  private _bitmapUsage = new Map<CanvasRenderingContext2D, number>();\n  private _getTextBitmap(text: string, color?: Color): CanvasRenderingContext2D {\n    const textAndHash = text + this._getRasterPropertiesHash(color);\n    const bitmap = this._textToBitmap.get(textAndHash);\n    if (bitmap) {\n      return bitmap;\n    }\n\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    this._textToBitmap.set(textAndHash, ctx);\n    return ctx;\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number) {\n    if (this.showDebug) {\n      this.clearCache();\n    }\n    this.checkAndClearCache();\n    const bitmap = this._getTextBitmap(text, colorOverride);\n    const isNewBitmap = !this._bitmapUsage.get(bitmap);\n    this._textBounds = this.measureText(text);\n\n    if (isNewBitmap) {\n      this._setDimension(this._textBounds, bitmap);\n    }\n\n    this._preDraw(ex, x, y);\n\n    const lines = text.split('\\n');\n    const lineHeight = this._textBounds.height / lines.length;\n\n\n    const rasterWidth = bitmap.canvas.width;\n    const rasterHeight = bitmap.canvas.height;\n\n    if (isNewBitmap) {\n      // draws the text to the bitmap\n      this._drawText(bitmap, text, colorOverride, lineHeight);\n      // draws the bitmap to excalibur graphics context\n      TextureLoader.load(bitmap.canvas, this.filtering, true);\n    }\n\n    ex.drawImage(\n      bitmap.canvas,\n      0,\n      0,\n      rasterWidth,\n      rasterHeight,\n      x - rasterWidth / this.quality / 2,\n      y - rasterHeight / this.quality / 2,\n      rasterWidth / this.quality,\n      rasterHeight / this.quality\n    );\n\n    this._postDraw(ex);\n\n    // Cache the bitmap for certain amount of time\n    this._bitmapUsage.set(bitmap, performance.now());\n  }\n\n  /**\n   * Get the internal cache size of the font\n   * This is useful when debugging memory usage, these numbers indicate the number of cached in memory text bitmaps\n   */\n  public get cacheSize() {\n    return this._bitmapUsage.size;\n  }\n\n  /**\n   * Force clear all cached text bitmaps\n   */\n  public clearCache() {\n    this._bitmapUsage.clear();\n  }\n\n  /**\n   * Remove any expired cached text bitmaps\n   */\n  public checkAndClearCache() {\n    for (const [bitmap, time] of this._bitmapUsage.entries()) {\n      // if bitmap hasn't been used in 1 second clear it\n      if (time + 1000 < performance.now()) {\n        this._bitmapUsage.delete(bitmap);\n      }\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { SpriteFont } from './SpriteFont';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Color } from '../Color';\nimport { Font } from './Font';\n\nexport interface TextOptions {\n  /**\n   * Text to draw\n   */\n  text: string;\n\n  /**\n   * Optionally override the font color, currently unsupported by SpriteFont\n   */\n  color?: Color;\n\n  /**\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\n   */\n  font?: Font | SpriteFont;\n}\n\n/**\n * Represent Text graphics in excalibur\n *\n * Useful for in game labels, ui, or overlays\n */\nexport class Text extends Graphic {\n  public color?: Color;\n  constructor(options: TextOptions & GraphicOptions) {\n    super(options);\n    // This order is important font, color, then text\n    this.font = options.font ?? new Font();\n    this.color = options.color ?? this.color;\n    this.text = options.text;\n  }\n\n  public clone(): Text {\n    return new Text({\n      text: this.text.slice(),\n      color: this.color?.clone() ?? Color.Black,\n      font: this.font.clone()\n    });\n  }\n\n  private _text: string = '';\n  public get text() {\n    return this._text;\n  }\n\n  public set text(value: string) {\n    this._text = value;\n    const bounds = this.font.measureText(this._text);\n    this._textWidth = bounds.width;\n    this._textHeight = bounds.height;\n  }\n\n  private _font: Font | SpriteFont;\n  public get font(): Font | SpriteFont {\n    return this._font;\n  }\n  public set font(font: Font | SpriteFont) {\n    this._font = font;\n  }\n\n  private _textWidth: number = 0;\n\n  public get width() {\n    if (this._textWidth === 0) {\n      this._calculateDimension();\n    }\n    return this._textWidth * this.scale.x;\n  }\n\n  private _textHeight: number = 0;\n  public get height() {\n    if (this._textHeight === 0) {\n      this._calculateDimension();\n    }\n    return this._textHeight * this.scale.y;\n  }\n\n  private _calculateDimension() {\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n  }\n\n  public get localBounds(): BoundingBox {\n    return this.font.measureText(this._text).scale(this.scale);\n  }\n\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\n    // None this is delegated to font\n    // This override erases the default behavior\n  }\n\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    let color = Color.Black;\n    if (this.font instanceof Font) {\n      color = this.color ?? this.font.color;\n    }\n\n    if (this.isStale() || this.font.isStale()) {\n      this.font.flipHorizontal = this.flipHorizontal;\n      this.font.flipVertical = this.flipVertical;\n      this.font.rotation = this.rotation;\n      this.font.origin = this.origin;\n      this.font.opacity = this.opacity;\n    }\n\n    const { width, height } = this.font.measureText(this._text);\n    this._textWidth = width;\n    this._textHeight = height;\n\n    this.font.render(ex, this._text, color, x, y);\n    if (this.font.showDebug) {\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\n    }\n  }\n}\n","import { Texture } from './Drawing/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { Engine } from './Engine';\nimport { Color } from './Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Animation } from './Drawing/Animation';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { Vector, vec } from './Math/vector';\nimport { BodyComponent } from './Collision/BodyComponent';\nimport { Eventable } from './Interfaces/Evented';\nimport * as Traits from './Traits/Index';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\nimport { CollisionType } from './Collision/CollisionType';\n\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Rectangle } from './Graphics/Rectangle';\nimport { Flags, Legacy } from './Flags';\nimport { obsolete } from './Util/Decorators';\nimport { ColliderComponent } from './Collision/ColliderComponent';\nimport { Shape } from './Collision/Colliders/Shape';\nimport { watch } from './Util/Watch';\nimport { Collider, CollisionGroup } from './Collision/Index';\nimport { Circle } from './Graphics/Circle';\nimport { PointerEvent } from './Input/PointerEvent';\nimport { WheelEvent } from './Input/WheelEvent';\nimport { PointerComponent } from './Input/PointerComponent';\nimport { ActionsComponent } from './Actions/ActionsComponent';\nimport { Raster } from './Graphics/Raster';\nimport { Text } from './Graphics/Text';\n\n/**\n * Type guard for checking if something is an Actor\n * @param x\n */\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\n/**\n * Actor contructor options\n */\nexport interface ActorArgs {\n  /**\n   * Optionally set the name of the actor, default is 'anonymous'\n   */\n  name?: string;\n  /**\n   * Optionally set the x position of the actor, default is 0\n   */\n  x?: number;\n  /**\n   * Optionally set the y position of the actor, default is 0\n   */\n  y?: number;\n  /**\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\n   */\n  pos?: Vector;\n  /**\n   * Optionally set the coordinate plane of the actor, default is [[CoordPlane.World]] meaning actor is subject to camera positioning\n   */\n  coordPlane?: CoordPlane;\n  /**\n   * Optionally set the width of a box collider for the actor\n   */\n  width?: number;\n  /**\n   * Optionally set the height of a box collider for the actor\n   */\n  height?: number;\n  /**\n   * Optionally set the radius of the circle collider for the actor\n   */\n  radius?: number;\n  /**\n   * Optionally set the velocity of the actor in pixels/sec\n   */\n  vel?: Vector;\n  /**\n   * Optionally set the acceleration of the actor in pixels/sec^2\n   */\n  acc?: Vector;\n  /**\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\n   */\n  rotation?: number;\n  /**\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\n   */\n  angularVelocity?: number;\n  /**\n   * Optionally set the scale of the actor's transform\n   */\n  scale?: Vector;\n  /**\n   * Optionally set the z index of the actor, default is 0\n   */\n  z?: number;\n  /**\n   * Optionally set the color of an actor, only used if no graphics are present\n   * If a width/height or a radius was set a default graphic will be added\n   */\n  color?: Color;\n  /**\n   * Optionally set the visibility of the actor\n   */\n  visible?: boolean;\n  /**\n   * Optionally set the anchor for graphics in the actor\n   */\n  anchor?: Vector;\n  /**\n   * Optionally set the collision type\n   */\n  collisionType?: CollisionType;\n  /**\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\n   */\n  collider?: Collider;\n  /**\n   * Optionally suppy a [[CollisionGroup]]\n   */\n  collisionGroup?: CollisionGroup;\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n */\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Set defaults for all Actors\n   */\n  public static defaults = {\n    anchor: Vector.Half\n  };\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): BodyComponent {\n    return this.get(BodyComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[TransformComponent]]\n   */\n  public get transform(): TransformComponent {\n    return this.get(TransformComponent);\n  }\n\n  /**\n   * Access the Actor's built in [[MotionComponent]]\n   */\n  public get motion(): MotionComponent {\n    return this.get(MotionComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[GraphicsComponent]]\n   */\n  public get graphics(): GraphicsComponent {\n    return this.get(GraphicsComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[ColliderComponent]]\n   */\n  public get collider(): ColliderComponent {\n    return this.get(ColliderComponent);\n  }\n\n  /**\n   * Access to the Actor's built in [[PointerComponent]] config\n   */\n  public get pointer(): PointerComponent {\n    return this.get(PointerComponent);\n  }\n\n  /**\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\n   *\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\n   * [[ActionContext|Action context]] of the actor.\n   */\n  public get actions(): ActionsComponent {\n    return this.get(ActionsComponent);\n  }\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.transform.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.transform.pos = thePos.clone();\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.motion.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.motion.vel = theVel.clone();\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.motion.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.motion.acc = theAcc.clone();\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.transform.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.transform.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get angularVelocity(): number {\n    return this.motion.angularVelocity;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set angularVelocity(angularVelocity: number) {\n    this.motion.angularVelocity = angularVelocity;\n  }\n\n  public get scale(): Vector {\n    return this.get(TransformComponent).scale;\n  }\n\n  public set scale(scale: Vector) {\n    this.get(TransformComponent).scale = scale;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\n  public get anchor(): Vector {\n    return this._anchor;\n  }\n\n  public set anchor(vec: Vector) {\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\n    this._handleAnchorChange(vec);\n  }\n\n  private _handleAnchorChange(v: Vector) {\n    if (this.graphics) {\n      this.graphics.anchor = v;\n    }\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public get isOffScreen(): boolean {\n    return this.hasTag('offscreen');\n  }\n  /**\n   * The visibility of an actor\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\n  public get visible(): boolean {\n    return this.graphics.visible;\n  }\n\n  public set visible(isVisible: boolean) {\n    this.graphics.visible = isVisible;\n  }\n\n  /**\n   * The opacity of an actor.\n   *\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\n   */\n  @obsolete({\n    message: 'Actor.opacity will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.opacity'\n  })\n  public get opacity(): number {\n    return this.graphics.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this.graphics.opacity = opacity;\n  }\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * @deprecated will be removed in v0.26.0\n   */\n  public frames: { [key: string]: Drawable } = {};\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   * @deprecated will be removed in v0.26.0\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Draggable helper\n   */\n  private _draggable: boolean = false;\n  private _dragging: boolean = false;\n\n  private _pointerDragStartHandler = () => {\n    this._dragging = true;\n  };\n\n  private _pointerDragEndHandler = () => {\n    this._dragging = false;\n  };\n\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.worldPos;\n    }\n  };\n\n  public get draggable(): boolean {\n    return this._draggable;\n  }\n\n  public set draggable(isDraggable: boolean) {\n    if (isDraggable) {\n      if (isDraggable && !this._draggable) {\n        this.on('pointerdragstart', this._pointerDragStartHandler);\n        this.on('pointerdragend', this._pointerDragEndHandler);\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\n      } else if (!isDraggable && this._draggable) {\n        this.off('pointerdragstart', this._pointerDragStartHandler);\n        this.off('pointerdragend', this._pointerDragEndHandler);\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\n      }\n\n      this._draggable = isDraggable;\n    }\n  }\n\n  /**\n   * Modify the current actor update pipeline.\n   * @deprecated will be removed in v0.26.0\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor's current graphic\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n    const defaultLayer = this.graphics.layers.default;\n    const currentGraphic = defaultLayer.graphics[0]?.graphic;\n    if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\n      currentGraphic.color = this._color;\n    }\n  }\n  private _color: Color;\n\n  // #endregion\n\n  /**\n   *\n   * @param config\n   */\n  constructor(config?: ActorArgs) {\n    super();\n\n    const {\n      name,\n      x,\n      y,\n      pos,\n      coordPlane,\n      scale,\n      width,\n      height,\n      radius,\n      collider,\n      vel,\n      acc,\n      rotation,\n      angularVelocity,\n      z,\n      color,\n      visible,\n      anchor,\n      collisionType,\n      collisionGroup\n    } = {\n      ...config\n    };\n\n    this._setName(name);\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\n    const tx = new TransformComponent();\n    this.addComponent(tx);\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.rotation = rotation ?? 0;\n    this.scale = scale ?? vec(1, 1);\n    this.z = z ?? 0;\n    tx.coordPlane = coordPlane ?? CoordPlane.World;\n\n    this.addComponent(new PointerComponent);\n\n    this.addComponent(new GraphicsComponent({\n      anchor: this.anchor\n    }));\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(new MotionComponent());\n    this.vel = vel ?? Vector.Zero;\n    this.acc = acc ?? Vector.Zero;\n    this.angularVelocity = angularVelocity ?? 0;\n\n    this.addComponent(new ActionsComponent());\n\n    this.addComponent(new BodyComponent());\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\n    if (collisionGroup) {\n      this.body.group = collisionGroup;\n    }\n\n    if (collider) {\n      this.addComponent(new ColliderComponent(collider));\n    } else if (radius) {\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\n    } else {\n      if (width > 0 && height > 0) {\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\n      } else {\n        this.addComponent(new ColliderComponent()); // no collider\n      }\n    }\n\n    this.graphics.visible = visible ?? true;\n\n    if (color) {\n      this.color = color;\n      if (width && height) {\n        this.graphics.add(\n          new Rectangle({\n            color: color,\n            width,\n            height\n          })\n        );\n      } else if (radius) {\n        this.graphics.add(\n          new Circle({\n            color: color,\n            radius\n          })\n        );\n      }\n    }\n\n    // Build default pipeline\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      // TODO remove offscreen trait after legacy drawing removed\n      this.traits.push(new Traits.OffscreenCulling());\n    }\n\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  // #region Events\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      super.kill();\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this.active = true;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return !this.active;\n  }\n\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\n   */\n  public setDrawing(key: number): void;\n  @obsolete({\n    message: 'Actor.setDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\n  })\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\n      this.currentDrawing.tick(0);\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  @obsolete({\n    message: 'Actor.addDrawing will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.graphics.add()'\n  })\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   */\n  public get z(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.getZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public getZIndex(): number {\n    return this.get(TransformComponent).z;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newZ new z-index to assign\n   */\n  public set z(newZ: number) {\n    this.get(TransformComponent).z = newZ;\n  }\n\n  /**\n   * @param newIndex new z-index to assign\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\n   */\n  @obsolete({\n    message: 'Actor.setZIndex will be removed in v0.26.0',\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\n  })\n  public setZIndex(newIndex: number) {\n    this.get(TransformComponent).z = newIndex;\n  }\n\n  /**\n   * Get the center point of an actor (global position)\n   */\n  public get center(): Vector {\n    const globalPos = this.getGlobalPos();\n    return new Vector(\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\n      globalPos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  /**\n   * Get the local center point of an actor\n   */\n  public get localCenter(): Vector {\n    return new Vector(\n      this.pos.x + this.width / 2 - this.anchor.x * this.width,\n      this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this.collider.localBounds.width * this.getGlobalScale().x;\n  }\n\n  public get height() {\n    return this.collider.localBounds.height * this.getGlobalScale().y;\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getGlobalRotation(): number {\n    return this.get(TransformComponent).globalRotation;\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getGlobalPos(): Vector {\n    return this.get(TransformComponent).globalPos;\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    return this.get(TransformComponent).globalScale;\n  }\n\n  // #region Collision\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    const point = vec(x, y);\n    const collider = this.get(ColliderComponent);\n    collider.update();\n    const geom = collider.get();\n    if (!geom) {\n      return false;\n    }\n    const containment = geom.contains(point);\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    const collider = this.get(ColliderComponent);\n    const otherCollider = actor.get(ColliderComponent);\n    const me = collider.get();\n    const other = otherCollider.get();\n    if (me && other) {\n      return me.getClosestLineBetween(other).getLength() <= distance;\n    }\n    return false;\n  }\n\n  // #endregion\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @internal\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Tick animations\n    const drawing = this.currentDrawing;\n    if (drawing && drawing instanceof Animation) {\n      drawing.tick(delta, engine.stats.currFrame.id);\n    }\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    // translate canvas by anchor offset\n    ctx.save();\n\n    if (this.currentDrawing) {\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\n\n      this._predraw(ctx, delta);\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\n    } else {\n      this._predraw(ctx, delta);\n      if (this.color && this.collider) {\n        // update collider geometry based on transform\n        const collider = this.get(ColliderComponent);\n        collider.update();\n        if (collider && !collider.bounds.hasZeroDimensions()) {\n          // Colliders are already shifted by anchor, unshift\n          ctx.globalAlpha = this.graphics.opacity;\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\n        }\n      }\n    }\n    ctx.restore();\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   *\n   *\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\n   * @deprecated will be removed in v0.26.0\n   * @internal\n   */\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n  // #endregion\n}\n","import { Vector, vec } from './Math/vector';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(config?: ActorArgs);\n\n  constructor(config?: ActorArgs) {\n    super({ ...config });\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\n    this.anchor = vec(0, 0);\n    this.body.collisionType = CollisionType.PreventCollision;\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\nimport { obsolete } from './Util/Decorators';\nimport { Logger } from './Util/Log';\n\nexport interface TimerOptions {\n  repeats?: boolean;\n  numberOfRepeats?: number;\n  fcn?: () => void;\n  interval: number;\n}\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  private _logger = Logger.getInstance();\n  private static _MAX_ID: number = 0;\n  public id: number = 0;\n\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n\n  private _running = false;\n\n  private _numberOfTicks: number = 0;\n  private _callbacks: Array<() => void>;\n\n  public interval: number = 10;\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n\n  private _complete = false;\n  public get complete() {\n    return this._complete;\n  }\n  public scene: Scene = null;\n\n  /**\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   * @param fcn        The callback to be fired after the interval is complete.\n   */\n  constructor(options: TimerOptions);\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (typeof fcn !== 'function') {\n      const options = fcn;\n      fcn = options.fcn;\n      interval = options.interval;\n      repeats = options.repeats;\n      numberOfRepeats = options.numberOfRepeats;\n    }\n\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.id = Timer._MAX_ID++;\n    this.interval = interval || this.interval;\n    this.repeats = repeats || this.repeats;\n\n    this._callbacks = [];\n\n    if (fcn) {\n      this.on(fcn);\n    }\n  }\n\n  /**\n   * Adds a new callback to be fired after the interval is complete\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\n   */\n  public on(fcn: () => void) {\n    this._callbacks.push(fcn);\n  }\n\n  /**\n   * Removes a callback from the callback list to be fired after the interval is complete.\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\n   */\n  public off(fcn: () => void) {\n    const index = this._callbacks.indexOf(fcn);\n    this._callbacks.splice(index, 1);\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (this._running) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this._complete = true;\n        this._running = false;\n        this._elapsedTime = 0;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this._callbacks.forEach((c) => {\n          c.call(this);\n        });\n\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this._complete = true;\n          this._running = false;\n          this._elapsedTime = 0;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   *\n   * Warning** you may need to call `timer.start()` again if the timer had completed\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this._complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * @returns milliseconds until the next action callback, if complete will return 0\n   */\n  public get timeToNextAction() {\n    if (this.complete) {\n      return 0;\n    }\n    return this.interval - this._elapsedTime;\n  }\n\n  /**\n   * @returns milliseconds elapsed toward the next action\n   */\n  public get timeElapsedTowardNextAction() {\n    return this._elapsedTime;\n  }\n\n  public get isRunning() {\n    return this._running;\n  }\n\n  /**\n   * Pauses the timer, time will no longer increment towards the next call\n   */\n  public pause(): Timer {\n    this._running = false;\n    return this;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   * @deprecated Will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\n  public unpause() {\n    this._running = true;\n  }\n\n  /**\n   * Resumes the timer, time will now increment towards the next call.\n   */\n  public resume(): Timer {\n    this._running = true;\n    return this;\n  }\n\n  /**\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\n   */\n  public start(): Timer {\n    if (!this.scene) {\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\n    }\n\n    this._running = true;\n    if (this.complete) {\n      this._complete = false;\n      this._elapsedTime = 0;\n      this._numberOfTicks = 0;\n    }\n\n    return this;\n  }\n\n  /**\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\n   */\n  public stop(): Timer {\n    this._running = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n    return this;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    this.pause();\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from '.';\nimport { Component } from '../EntityComponentSystem/Component';\n\n\n/**\n * Provide arbitrary drawing for the purposes of debugging your game\n *\n * Will only show when the Engine is set to debug mode [[Engine.showDebug]] or [[Engine.toggleDebug]]\n *\n */\nexport class DebugGraphicsComponent extends Component<'ex.debuggraphics'> {\n  readonly type = 'ex.debuggraphics';\n  constructor(public draw: (ctx: ExcaliburGraphicsContext) => void, public useTransform = true) {\n    super();\n  }\n}","import { Engine } from './Engine';\nimport { Screen } from './Screen';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { Vector, vec } from './Math/vector';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { Logger } from './Util/Log';\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\nimport { watchAny } from './Util/Watch';\nimport { Matrix } from './Math/matrix';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param actor Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param actor Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n\n  /**\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\n   * @param box The bounding box to limit the camera to.\n   */\n  public limitCameraBounds(box: BoundingBox) {\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = cam.vel.clone();\n\n    // Calculate the stretch vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.size;\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Prevent a camera from going beyond the given camera dimensions.\n */\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\n  /**\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\n   *\n   * Note that this strategy does not perform any movement by itself.\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\n   *\n   * Make sure that the camera bounds are at least as large as the viewport size.\n   *\n   * @param target The bounding box to limit the camera to\n   */\n\n  boundSizeChecked: boolean = false; // Check and warn only once\n\n  constructor(public target: BoundingBox) {}\n\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\n    const focus = cam.getFocus();\n\n    if (!this.boundSizeChecked) {\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\n      }\n      this.boundSizeChecked = true;\n    }\n\n    let focusX = focus.x;\n    let focusY = focus.y;\n    if (focus.x < target.left + _eng.halfDrawWidth) {\n      focusX = target.left + _eng.halfDrawWidth;\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\n      focusX = target.right - _eng.halfDrawWidth;\n    }\n\n    if (focus.y < target.top + _eng.halfDrawHeight) {\n      focusY = target.top + _eng.halfDrawHeight;\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\n      focusY = target.bottom - _eng.halfDrawHeight;\n    }\n\n    return vec(focusX, focusY);\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  public transform: Matrix = Matrix.identity();\n  public inverse: Matrix = Matrix.identity();\n\n\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  /**\n   * Get or set current zoom of the camera, defaults to 1\n   */\n  private _z = 1;\n  public get zoom(): number {\n    return this._z;\n  }\n\n  public set zoom(val: number) {\n    this._z = val;\n    if (this._engine) {\n      this._halfWidth = this._engine.halfDrawWidth;\n      this._halfHeight = this._engine.halfDrawHeight;\n    }\n  }\n  /**\n   * Get or set rate of change in zoom, defaults to 0\n   */\n  public dz: number = 0;\n  /**\n   * Get or set zoom acceleration\n   */\n  public az: number = 0;\n\n  /**\n   * Current rotation of the camera\n   */\n  public rotation: number = 0;\n\n  /**\n   * Current angular velocity\n   * @deprecated will be removed in v0.26.0, use angularVelocity\n   */\n  public rx: number = 0;\n\n  /**\n   * Get or set the camera's angular velocity\n   */\n  public get angularVelocity(): number {\n    return this.rx;\n  }\n\n  public set angularVelocity(value: number) {\n    this.rx = value;\n  }\n\n  /**\n   * Get or set the camera's position\n   */\n  private _posChanged = false;\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\n  public get pos(): Vector {\n    return this._pos;\n  }\n  public set pos(vec: Vector) {\n    this._pos = watchAny(vec, () => (this._posChanged = true));\n    this._posChanged = true;\n  }\n\n  /**\n   * Get or set the camera's velocity\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * Get or set the camera's acceleration\n   */\n  public acc: Vector = Vector.Zero;\n\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpResolve: (value: Vector) => void;\n  private _lerpPromise: Promise<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomResolve: (val: boolean) => void;\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  private _halfWidth: number = 0;\n  private _halfHeight: number = 0;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this.pos.x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(value, this.pos.y);\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this.pos.y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos = vec(this.pos.x, value);\n    }\n  }\n\n  /**\n   * Get or set the camera's x velocity\n   */\n  public get dx() {\n    return this.vel.x;\n  }\n\n  public set dx(value: number) {\n    this.vel = vec(value, this.vel.y);\n  }\n\n  /**\n   * Get or set the camera's y velocity\n   */\n  public get dy() {\n    return this.vel.y;\n  }\n\n  public set dy(value: number) {\n    this.vel = vec(this.vel.x, value);\n  }\n\n  /**\n   * Get or set the camera's x acceleration\n   */\n  public get ax() {\n    return this.acc.x;\n  }\n\n  public set ax(value: number) {\n    this.acc = vec(value, this.acc.y);\n  }\n\n  /**\n   * Get or set the camera's y acceleration\n   */\n  public get ay() {\n    return this.acc.y;\n  }\n\n  public set ay(value: number) {\n    this.acc = vec(this.acc.x, value);\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return this.pos;\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return Promise.reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpResolve) {\n      this._lerpResolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>((resolve) => {\n      this._lerpResolve = resolve;\n    });\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>((resolve) => {\n      this._zoomResolve = resolve;\n    });\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.zoom;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.zoom = scale;\n      return Promise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  private _viewport: BoundingBox = null;\n  /**\n   * Gets the bounding box of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._viewport) {\n      return this._viewport;\n    }\n\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _screen: Screen;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this._engine = _engine;\n      this._screen = _engine.screen;\n\n      const currentRes = this._screen.resolution;\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\n      if (!this._engine.loadingComplete) {\n        // If there was a loading screen, we peek the configured resolution\n        const res = this._screen.peekResolution();\n        if (res) {\n          center = vec(res.width / 2, res.height / 2);\n        }\n      }\n      this._halfWidth = center.x;\n      this._halfHeight = center.y;\n\n      // If the user has not set the camera pos, apply default center screen position\n      if (!this._posChanged) {\n        this.pos = center;\n      }\n      // First frame bootstrap\n\n      // Ensure camera tx is correct\n      // Run update twice to ensure properties are init'd\n      this.updateTransform();\n\n      // Run strategies for first frame\n      this.runStrategies(_engine, _engine.clock.elapsed());\n\n      // Setup the first frame viewport\n      this.updateViewport();\n\n      // It's important to update the camera after strategies\n      // This prevents jitter\n      this.updateTransform();\n\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public runStrategies(engine: Engine, delta: number) {\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, engine, delta);\n    }\n  }\n\n  public updateViewport() {\n    // recalc viewport\n    this._viewport = new BoundingBox(\n      this.x - this._halfWidth,\n      this.y - this._halfHeight,\n      this.x + this._halfWidth,\n      this.y + this._halfHeight\n    );\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\n    this.zoom += (this.dz * delta) / 1000;\n\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.angularVelocity * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.zoom = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.zoom = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomResolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this.pos = lerpPoint;\n\n        this._currentLerpTime += delta;\n      } else {\n        this.pos = this._lerpEnd;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpResolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    this.runStrategies(_engine, delta);\n\n    this.updateViewport();\n\n    // It's important to update the camera after strategies\n    // This prevents jitter\n    this.updateTransform();\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx Canvas context to apply transformations\n   */\n  public draw(ctx: CanvasRenderingContext2D): void;\n  public draw(ctx: ExcaliburGraphicsContext): void;\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\n    // Apply transform\n    if (ctx instanceof CanvasRenderingContext2D) {\n      // TODO This will be removed in v0.26.0\n      const focus = this.getFocus();\n\n      // center the camera\n      const newCanvasWidth = this._screen.resolution.width / this.zoom;\n      const newCanvasHeight = this._screen.resolution.height / this.zoom;\n      const cameraPos = vec(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n      ctx.scale(this.zoom, this.zoom);\n      ctx.translate(cameraPos.x, cameraPos.y);\n    } else {\n      ctx.multiply(this.transform);\n    }\n  }\n\n  public updateTransform() {\n    // center the camera\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\n    const cameraPos = vec(-this.x + newCanvasWidth / 2 + this._xShake, -this.y + newCanvasHeight / 2 + this._yShake);\n\n    // Calculate camera transform\n    this.transform.reset();\n    this.transform.scale(this.zoom, this.zoom);\n    this.transform.translate(cameraPos.x, cameraPos.y);\n    this.transform.getAffineInverse(this.inverse);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { BoundingBox } from '../Collision/BoundingBox';\nimport { Engine } from '../Engine';\nimport { Vector, vec } from '../Math/vector';\nimport { Logger } from '../Util/Log';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport * as Events from '../Events';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { BodyComponent } from '../Collision/BodyComponent';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { Shape } from '../Collision/Colliders/Shape';\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from '../Graphics';\nimport * as Graphics from '../Graphics';\nimport { CanvasDrawComponent, Sprite } from '../Drawing/Index';\nimport { Sprite as LegacySprite } from '../Drawing/Index';\nimport { removeItemFromArray } from '../Util/Util';\nimport { obsolete } from '../Util/Decorators';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\nimport { Color } from '../Color';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\nimport { Collider } from '../Collision/Colliders/Collider';\n\nexport interface TileMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Width of an individual tile in pixels\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\n *\n * TileMaps are useful for top down or side scrolling grid oriented games.\n */\nexport class TileMap extends Entity {\n  private _token = 0;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = Number.MAX_VALUE;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = Number.MAX_VALUE;\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\n\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\n  public logger: Logger = Logger.getInstance();\n  public readonly tiles: Tile[] = [];\n  private _rows: Tile[][] = [];\n  private _cols: Tile[][] = [];\n\n  public readonly tileWidth: number;\n  public readonly tileHeight: number;\n  public readonly height: number;\n  public readonly width: number;\n\n  private _collidersDirty = true;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n  private _transform: TransformComponent;\n  private _motion: MotionComponent;\n  private _collider: ColliderComponent;\n  private _composite: CompositeCollider;\n\n  public get x(): number {\n    return this._transform.pos.x ?? 0;\n  }\n\n  public set x(val: number) {\n    if (this._transform?.pos) {\n      this.get(TransformComponent).pos = vec(val, this.y);\n    }\n  }\n\n  public get y(): number {\n    return this._transform?.pos.y ?? 0;\n  }\n\n  public set y(val: number) {\n    if (this._transform?.pos) {\n      this._transform.pos = vec(this.x, val);\n    }\n  }\n\n  public get z(): number {\n    return this._transform.z ?? 0;\n  }\n\n  public set z(val: number) {\n    if (this._transform) {\n      this._transform.z = val;\n    }\n  }\n\n  public get rotation(): number {\n    return this._transform?.rotation ?? 0;\n  }\n\n  public set rotation(val: number) {\n    if (this._transform?.rotation) {\n      this._transform.rotation = val;\n    }\n  }\n\n  public get scale(): Vector {\n    return this._transform?.scale ?? Vector.One;\n  }\n\n  public set scale(val: Vector) {\n    if (this._transform?.scale) {\n      this._transform.scale = val;\n    }\n  }\n\n  public get pos(): Vector {\n    return this._transform.pos;\n  }\n\n  public set pos(val: Vector) {\n    this._transform.pos = val;\n  }\n\n  public get vel(): Vector {\n    return this._motion.vel;\n  }\n\n  public set vel(val: Vector) {\n    this._motion.vel = val;\n  }\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n\n  /**\n   * @param options\n   */\n  constructor(options: TileMapOptions) {\n    super(null, options.name);\n    this.addComponent(new TransformComponent());\n    this.addComponent(new MotionComponent());\n    this.addComponent(\n      new BodyComponent({\n        type: CollisionType.Fixed\n      })\n    );\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n    this.addComponent(\n      new GraphicsComponent({\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\n      })\n    );\n    this.addComponent(new DebugGraphicsComponent((ctx) => this.debug(ctx)));\n    this.addComponent(new ColliderComponent());\n    this._transform = this.get(TransformComponent);\n    this._motion = this.get(MotionComponent);\n    this._collider = this.get(ColliderComponent);\n    this._composite = this._collider.useCompositeCollider([]);\n\n    this._transform.pos = options.pos ?? Vector.Zero;\n    this._transform.posChanged$.subscribe(() => this.flagCollidersDirty());\n    this.tileWidth = options.tileWidth;\n    this.tileHeight = options.tileHeight;\n    this.height = options.height;\n    this.width = options.width;\n    this.tiles = new Array<Tile>(this.height * this.width);\n    this._rows = new Array(this.height);\n    this._cols = new Array(this.width);\n    let currentCol: Tile[] = [];\n    for (let i = 0; i < this.width; i++) {\n      for (let j = 0; j < this.height; j++) {\n        const cd = new Tile({\n          x: i,\n          y: j,\n          map: this\n        });\n        cd.map = this;\n        this.tiles[i + j * this.width] = cd;\n        currentCol.push(cd);\n        if (!this._rows[j]) {\n          this._rows[j] = [];\n        }\n        this._rows[j].push(cd);\n      }\n      this._cols[i] = currentCol;\n      currentCol = [];\n    }\n\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\n      left: 0,\n      top: 0,\n      right: this.width * this.tileWidth,\n      bottom: this.height * this.tileHeight\n    });\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  /**\n   *\n   * @param key\n   * @param spriteSheet\n   * @deprecated No longer used, will be removed in v0.26.0\n   */\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\n      this._spriteSheets[key] = spriteSheet;\n    } else {\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\n    }\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  /**\n   * Tiles colliders based on the solid tiles in the tilemap.\n   */\n  private _updateColliders(): void {\n    this._composite.clearColliders();\n    const colliders: BoundingBox[] = [];\n    this._composite = this._collider.useCompositeCollider([]);\n    let current: BoundingBox;\n    // Bad square tesselation algo\n    for (let i = 0; i < this.width; i++) {\n      // Scan column for colliders\n      for (let j = 0; j < this.height; j++) {\n        // Columns start with a new collider\n        if (j === 0) {\n          current = null;\n        }\n        const tile = this.tiles[i + j * this.width];\n        // Current tile in column is solid build up current collider\n        if (tile.solid) {\n          // Use custom collider otherwise bounding box\n          if (tile.getColliders().length > 0) {\n            for (const collider of tile.getColliders()) {\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n              collider.offset = vec(tile.x * this.tileWidth, tile.y * this.tileHeight).add(originalOffset);\n              collider.owner = this;\n              this._composite.addCollider(collider);\n            }\n            current = null;\n          } else {\n            if (!current) {\n              current = tile.bounds;\n            } else {\n              current = current.combine(tile.bounds);\n            }\n          }\n        } else {\n          // Not solid skip and cut off the current collider\n          if (current) {\n            colliders.push(current);\n          }\n          current = null;\n        }\n      }\n      // After a column is complete check to see if it can be merged into the last one\n      if (current) {\n        // if previous is the same combine it\n        const prev = colliders[colliders.length - 1];\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\n          colliders[colliders.length - 1] = prev.combine(current);\n        } else {\n          // else new collider\n          colliders.push(current);\n        }\n      }\n    }\n\n    for (const c of colliders) {\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\n      collider.owner = this;\n      this._composite.addCollider(collider);\n    }\n    this._collider.update();\n  }\n\n  /**\n   * Returns the [[Tile]] by index (row major order)\n   */\n  public getTileByIndex(index: number): Tile {\n    return this.tiles[index];\n  }\n  /**\n   * Returns the [[Tile]] by its x and y integer coordinates\n   */\n  public getTile(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n  /**\n   * Returns the [[Tile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): Tile {\n    const x = Math.floor((point.x - this.pos.x) / this.tileWidth);\n    const y = Math.floor((point.y - this.pos.y) / this.tileHeight);\n    const tile = this.getTile(x, y);\n    if (x >= 0 && y >= 0 && x < this.width && y < this.height && tile) {\n      return tile;\n    }\n    return null;\n  }\n\n  public getRows(): readonly Tile[][] {\n    return this._rows;\n  }\n\n  public getColumns(): readonly Tile[][] {\n    return this._cols;\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.onPreUpdate(engine, delta);\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n    if (this._collidersDirty) {\n      this._collidersDirty = false;\n      this._updateColliders();\n    }\n\n    this._token++;\n    const worldBounds = engine.getWorldBounds();\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.tileWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.tileHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.tileWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.tileHeight) + 2, 0);\n    this._transform.pos = vec(this.x, this.y);\n\n    this.onPostUpdate(engine, delta);\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.width);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.height);\n\n    let graphics: readonly Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        graphics = this.getTile(x, y).getGraphics();\n\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\n          // draw sprite, warning if sprite doesn't exist\n          const graphic = graphics[graphicsIndex];\n          if (graphic) {\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\n              if (hasGraphicsTick(graphic)) {\n                graphic?.tick(delta, this._token);\n              }\n              graphic.draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            } else if (graphic instanceof Graphics.Sprite) {\n              // TODO legacy drawing mode\n              if (!this._legacySpriteMap.has(graphic)) {\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\n              }\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.tileWidth, y * this.tileHeight);\n            }\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\n  }\n\n  public debug(gfx: ExcaliburGraphicsContext) {\n    const width = this.tileWidth * this.width;\n    const height = this.tileHeight * this.height;\n    const pos = Vector.Zero;\n    for (let r = 0; r < this.height + 1; r++) {\n      const yOffset = vec(0, r * this.tileHeight);\n      gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), Color.Red, 2);\n    }\n\n    for (let c = 0; c < this.width + 1; c++) {\n      const xOffset = vec(c * this.tileWidth, 0);\n      gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), Color.Red, 2);\n    }\n\n    const colliders = this._composite.getColliders();\n    for (const collider of colliders) {\n      const grayish = Color.Gray;\n      grayish.a = 0.5;\n      const bounds = collider.localBounds;\n      const pos = collider.worldPos.sub(this.pos);\n      gfx.drawRectangle(pos, bounds.width, bounds.height, grayish);\n    }\n  }\n}\n\nexport interface TileOptions {\n  /**\n   * Integer tile x coordinate\n   */\n  x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  y: number;\n  map: TileMap;\n  solid?: boolean;\n  graphics?: Graphics.Graphic[];\n}\n\n/**\n * TileMap Tile\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Tile extends Entity {\n  private _bounds: BoundingBox;\n  private _pos: Vector;\n  private _posDirty = false;\n  private _transform: TransformComponent;\n\n  /**\n   * Return the world position of the top left corner of the tile\n   */\n  public get pos() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._pos;\n  }\n\n  /**\n   * Integer x coordinate of the tile\n   */\n  public readonly x: number;\n\n  /**\n   * Integer y coordinate of the tile\n   */\n  public readonly y: number;\n\n  /**\n   * Width of the tile in pixels\n   */\n  public readonly width: number;\n\n  /**\n   * Height of the tile in pixels\n   */\n  public readonly height: number;\n\n  /**\n   * Reference to the TileMap this tile is associated with\n   */\n  public map: TileMap;\n\n  private _solid = false;\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public get solid(): boolean {\n    return this._solid;\n  }\n  /**\n   * Wether this tile should be treated as solid by the tilemap\n   */\n  public set solid(val: boolean) {\n    this.map?.flagCollidersDirty();\n    this._solid = val;\n  }\n\n  private _graphics: Graphics.Graphic[] = [];\n\n  /**\n   * Current list of graphics for this tile\n   */\n  public getGraphics(): readonly Graphics.Graphic[] {\n    return this._graphics;\n  }\n\n  /**\n   * Add another [[Graphic]] to this TileMap tile\n   * @param graphic\n   */\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    if (graphic instanceof LegacySprite) {\n      this._graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\n    } else {\n      this._graphics.push(graphic);\n    }\n  }\n\n  /**\n   * Remove an instance of a [[Graphic]] from this tile\n   */\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\n    removeItemFromArray(graphic, this._graphics);\n  }\n\n  /**\n   * Clear all graphics from this tile\n   */\n  public clearGraphics() {\n    this._graphics.length = 0;\n  }\n\n  /**\n   * Current list of colliders for this tile\n   */\n  private _colliders: Collider[] = [];\n\n  /**\n   * Returns the list of colliders\n   */\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a custom collider to the [[Tile]] to use instead of it's bounds\n   *\n   * If no collider is set but [[Tile.solid]] is set, the tile bounds are used as a collider.\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the [[Tile]]\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the [[Tile]]\n   */\n  public clearColliders() {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Arbitrary data storage per tile, useful for any game specific data\n   */\n  public data = new Map<string, any>();\n\n  constructor(options: TileOptions) {\n    super();\n    this.x = options.x;\n    this.y = options.y;\n    this.map = options.map;\n    this.width = options.map.tileWidth;\n    this.height = options.map.tileHeight;\n    this.solid = options.solid ?? this.solid;\n    this._graphics = options.graphics ?? [];\n    this._recalculate();\n    this._transform = options.map.get(TransformComponent);\n    this._transform.posChanged$.subscribe(() => {\n      this._posDirty = true;\n    });\n  }\n\n  private _recalculate() {\n    this._pos = this.map.pos.add(\n      vec(\n        this.x * this.map.tileWidth,\n        this.y * this.map.tileHeight));\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this.width, this._pos.y + this.height);\n  }\n\n  public get bounds() {\n    if (this._posDirty) {\n      this._recalculate();\n      this._posDirty = false;\n    }\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this._pos.x + this.width / 2, this._pos.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[Sprite]] to this tile\n   * @deprecated Use addSprite, will be removed in v0.26.0\n   */\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\n    this.addGraphic(sprite);\n  }\n}","import { Actor } from '../Actor';\nimport { ScreenElement } from '../ScreenElement';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\n/**\n * Type guard to detect if something is an actor\n * @deprecated Will be removed in v0.26.0\n * @param actor\n */\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\n/**\n * Type guard to detect a screen element\n * @todo move to ScreenElement\n */\nexport function isScreenElement(actor: Actor) {\n  return actor instanceof ScreenElement;\n}\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = {\n      ...triggerDefaults,\n      ...opts\n    };\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher();\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\nimport { Message, Observer } from '../Util/Observable';\nimport { Component } from './Component';\nimport { Scene } from '../Scene';\n\n/**\n * Enum that determines whether to run the system in the update or draw phase\n */\nexport enum SystemType {\n  Update = 'update',\n  Draw = 'draw'\n}\n\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * An Excalibur [[System]] that updates entities of certain types.\n * Systems are scene specific\n *\n * Excalibur Systems currently require at least 1 Component type to operated\n *\n * Multiple types are declared as a type union\n * For example:\n *\n * ```typescript\n * class MySystem extends System<ComponentA | ComponentB> {\n *   public readonly types = ['a', 'b'] as const;\n *   public readonly systemType = SystemType.Update;\n *   public update(entities: Entity<ComponentA | ComponentB>) {\n *      ...\n *   }\n * }\n * ```\n */\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\nimplements Observer<AddedEntity | RemovedEntity> {\n  /**\n   * The types of entities that this system operates on\n   * For example ['transform', 'motion']\n   */\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\n\n  /**\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\n   */\n  abstract readonly systemType: SystemType;\n\n  /**\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\n   */\n  public priority: number = 0;\n\n  /**\n   * Optionally specify a sort order for entities passed to the your system\n   * @param a The left entity\n   * @param b The right entity\n   */\n  sort?(a: Entity, b: Entity): number;\n\n  /**\n   * Optionally specify an initialize handler\n   * @param scene\n   */\n  initialize?(engine: ContextType): void;\n\n  /**\n   * Update all entities that match this system's types\n   * @param entities Entities to update that match this system's types\n   * @param delta Time in milliseconds\n   */\n  abstract update(entities: Entity[], delta: number): void;\n\n  /**\n   * Optionally run a preupdate before the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  preupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Optionally run a postupdate after the system processes matching entities\n   * @param engine\n   * @param elapsedMs Time in milliseconds since the last frame\n   */\n  postupdate?(engine: ContextType, elapsedMs: number): void;\n\n  /**\n   * Systems observe when entities match their types or no longer match their types, override\n   * @param _entityAddedOrRemoved\n   */\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\n    // Override me\n  }\n}\n\n/**\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\n */\nexport class AddedEntity implements Message<Entity> {\n  readonly type: 'Entity Added' = 'Entity Added';\n  constructor(public data: Entity) {}\n}\n\n/**\n * Type guard to check for AddedEntity messages\n * @param x\n */\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\n  return !!x && x.type === 'Entity Added';\n}\n\n/**\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\n */\nexport class RemovedEntity implements Message<Entity> {\n  readonly type: 'Entity Removed' = 'Entity Removed';\n  constructor(public data: Entity) {}\n}\n\n/**\n * type guard to check for the RemovedEntity message\n */\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\n  return !!x && x.type === 'Entity Removed';\n}\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\nimport { Observer } from '../Util/Observable';\nimport { World } from './World';\nimport { Util } from '..';\n\n// Add/Remove entities and components\n\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\n  public entities: Entity[] = [];\n  public _entityIndex: { [entityId: string]: Entity } = {};\n\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Runs the entity lifecycle\n   * @param _context\n   */\n  public updateEntities(_context: ContextType, elapsed: number) {\n    for (const entity of this.entities) {\n      // TODO is this right?\n      entity.update((_context as any).engine, elapsed);\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  public findEntitiesForRemoval() {\n    for (const entity of this.entities) {\n      if (!entity.active) {\n        this.removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * EntityManager observes changes on entities\n   * @param message\n   */\n  public notify(message: RemovedComponent | AddedComponent): void {\n    if (isAddedComponent(message)) {\n      // we don't need the component, it's already on the entity\n      this._world.queryManager.addEntity(message.data.entity);\n    }\n\n    if (isRemovedComponent(message)) {\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\n    }\n  }\n\n  /**\n   * Adds an entity to be tracked by the EntityManager\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    entity.active = true;\n    if (entity && !this._entityIndex[entity.id]) {\n      this._entityIndex[entity.id] = entity;\n      this.entities.push(entity);\n      this._world.queryManager.addEntity(entity);\n      entity.componentAdded$.register(this);\n      entity.componentRemoved$.register(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.addEntity(c));\n      entity.childrenAdded$.register({\n        notify: (e) => {\n          this.addEntity(e);\n        }\n      });\n      entity.childrenRemoved$.register({\n        notify: (e) => {\n          this.removeEntity(e, false);\n        }\n      });\n    }\n  }\n\n  public removeEntity(entity: Entity, deferred?: boolean): void;\n  public removeEntity(id: number, deferred?: boolean): void;\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\n    let id = 0;\n    if (idOrEntity instanceof Entity) {\n      id = idOrEntity.id;\n    } else {\n      id = idOrEntity;\n    }\n    const entity = this._entityIndex[id];\n    if (entity && entity.active) {\n      entity.kill();\n    }\n\n    if (entity && deferred) {\n      this._entitiesToRemove.push(entity);\n      return;\n    }\n\n    delete this._entityIndex[id];\n    if (entity) {\n      Util.removeItemFromArray(entity, this.entities);\n      this._world.queryManager.removeEntity(entity);\n      entity.componentAdded$.unregister(this);\n      entity.componentRemoved$.unregister(this);\n\n      // if entity has children\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\n      entity.childrenAdded$.clear();\n      entity.childrenRemoved$.clear();\n\n      // stats\n      if ((this._world.context as any)?.engine) {\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\n      }\n    }\n  }\n\n  private _entitiesToRemove: Entity[] = [];\n  public processEntityRemovals(): void {\n    for (const entity of this._entitiesToRemove) {\n      if (entity.active) {\n        continue;\n      }\n      this.removeEntity(entity, false);\n    }\n  }\n\n  public processComponentRemovals(): void {\n    for (const entity of this.entities) {\n      entity.processComponentRemoval();\n    }\n  }\n\n  public getById(id: number): Entity {\n    return this._entityIndex[id];\n  }\n\n  public getByName(name: string): Entity[]{\n    return this.entities.filter(e => e.name === name);\n  }\n\n  public clear(): void {\n    for (const entity of this.entities) {\n      this.removeEntity(entity);\n    }\n  }\n}\n","export const buildTypeKey = (types: readonly string[]) => {\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\n  return key;\n};\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Observable } from '../Util/Observable';\nimport { Util, Component, ComponentCtor } from '..';\nimport { AddedEntity, RemovedEntity } from './System';\n\n/**\n * Represents query for entities that match a list of types that is cached and observable\n *\n * Queries can be strongly typed by supplying a type union in the optional type parameter\n * ```typescript\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\n * ```\n */\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\n  public types: readonly string[];\n  private _entities: Entity[] = [];\n  private _key: string;\n  public get key(): string {\n    if (this._key) {\n      return this._key;\n    }\n    return (this._key = buildTypeKey(this.types));\n  }\n\n  constructor(types: readonly string[]);\n  constructor(types: readonly ComponentCtor<T>[]);\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\n    super();\n    if (types[0] instanceof Function) {\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\n    } else {\n      this.types = types as string[];\n    }\n  }\n\n  /**\n   * Returns a list of entities that match the query\n   *\n   * @param sort Optional sorting function to sort entities returned from the query\n   */\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\n    if (sort) {\n      this._entities.sort(sort);\n    }\n    return this._entities;\n  }\n\n  /**\n   * Add an entity to the query, will only be added if the entity matches the query types\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\n      this._entities.push(entity);\n      this.notifyAll(new AddedEntity(entity));\n    }\n  }\n\n  /**\n   * If the entity is part of the query it will be removed regardless of types\n   * @param entity\n   */\n  public removeEntity(entity: Entity): void {\n    if (Util.removeItemFromArray(entity, this._entities)) {\n      this.notifyAll(new RemovedEntity(entity));\n    }\n  }\n\n  /**\n   * Removes all entities and observers from the query\n   */\n  public clear(): void {\n    this._entities.length = 0;\n    for (const observer of this.observers) {\n      this.unregister(observer);\n    }\n  }\n\n  /**\n   * Returns whether the entity's types match query\n   * @param entity\n   */\n  public matches(entity: Entity): boolean;\n\n  /**\n   * Returns whether the list of ComponentTypes have at least the same types as the query\n   * @param types\n   */\n  public matches(types: string[]): boolean;\n  public matches(typesOrEntity: string[] | Entity): boolean {\n    let types: string[] = [];\n    if (typesOrEntity instanceof Entity) {\n      types = typesOrEntity.types;\n    } else {\n      types = typesOrEntity;\n    }\n\n    let matches = true;\n    for (const type of this.types) {\n      matches = matches && types.indexOf(type) > -1;\n      if (!matches) {\n        return false;\n      }\n    }\n    return matches;\n  }\n\n  public contain(type: string) {\n    return this.types.indexOf(type) > -1;\n  }\n}\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Query } from './Query';\nimport { Component } from './Component';\nimport { World } from './World';\n\n/**\n * The query manager is responsible for updating all queries when entities/components change\n */\nexport class QueryManager {\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\n\n  constructor(private _world: World<any>) {}\n\n  /**\n   * Adds a query to the manager and populates with any entities that match\n   * @param query\n   */\n  private _addQuery(query: Query<any>) {\n    this._queries[buildTypeKey(query.types)] = query;\n    for (const entity of this._world.entityManager.entities) {\n      query.addEntity(entity);\n    }\n  }\n\n  /**\n   * Removes the query if there are no observers left\n   * @param query\n   */\n  public maybeRemoveQuery(query: Query): void {\n    if (query.observers.length === 0) {\n      query.clear();\n      delete this._queries[buildTypeKey(query.types)];\n    }\n  }\n\n  /**\n   * Adds the entity to any matching query in the query manage\n   * @param entity\n   */\n  public addEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      if (this._queries[queryType]) {\n        this._queries[queryType].addEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from queries if the removed component disqualifies it\n   * @param entity\n   * @param component\n   */\n  public removeComponent(entity: Entity, component: Component) {\n    for (const queryType in this._queries) {\n      // If the component being removed from an entity is a part of a query,\n      // it is now disqualified from that query, remove it\n      if (this._queries[queryType].contain(component.type)) {\n        this._queries[queryType].removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from all queries it is currently a part of\n   * @param entity\n   */\n  public removeEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      this._queries[queryType].removeEntity(entity);\n    }\n  }\n\n  /**\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\n   * @param types\n   */\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const maybeExistingQuery = this.getQuery<T>(types);\n    if (maybeExistingQuery) {\n      return maybeExistingQuery;\n    }\n    const query = new Query<T>(types);\n    this._addQuery(query);\n    return query;\n  }\n\n  /**\n   * Retrieves an existing query by types if it exists otherwise returns null\n   * @param types\n   */\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const key = buildTypeKey(types);\n    if (this._queries[key]) {\n      return this._queries[key] as Query<T>;\n    }\n    return null;\n  }\n}\n","import { System, SystemType } from './System';\nimport { Scene, Util } from '..';\nimport { World } from './World';\n\nexport interface SystemCtor<T extends System> {\n  new (): T;\n}\n\n/**\n * The SystemManager is responsible for keeping track of all systems in a scene.\n * Systems are scene specific\n */\nexport class SystemManager<ContextType> {\n  /**\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\n   */\n  public systems: System<any, ContextType>[] = [];\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\n  public initialized = false;\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Get a system registered in the manager by type\n   * @param systemType\n   */\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\n  }\n\n  /**\n   * Adds a system to the manager, it will now be updated every frame\n   * @param system\n   */\n  public addSystem(system: System<any, ContextType>): void {\n    // validate system has types\n    if (!system.types || system.types.length === 0) {\n      throw new Error(`Attempted to add a System without any types`);\n    }\n\n    const query = this._world.queryManager.createQuery(system.types);\n    this.systems.push(system);\n    this.systems.sort((a, b) => a.priority - b.priority);\n    query.register(system);\n    if (this.initialized && system.initialize) {\n      system.initialize(this._world.context);\n    }\n  }\n\n  /**\n   * Removes a system from the manager, it will no longer be updated\n   * @param system\n   */\n  public removeSystem(system: System<any, ContextType>) {\n    Util.removeItemFromArray(system, this.systems);\n    const query = this._world.queryManager.getQuery(system.types);\n    if (query) {\n      query.unregister(system);\n      this._world.queryManager.maybeRemoveQuery(query);\n    }\n  }\n\n  /**\n   * Initialize all systems in the manager\n   *\n   * Systems added after initialize() will be initialized on add\n   */\n  public initialize() {\n    if (!this.initialized) {\n      this.initialized = true;\n      for (const s of this.systems) {\n        if (s.initialize) {\n          s.initialize(this._world.context);\n        }\n      }\n    }\n  }\n\n  /**\n   * Updates all systems\n   * @param type whether this is an update or draw system\n   * @param context context reference\n   * @param delta time in milliseconds\n   */\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\n    const systems = this.systems.filter((s) => s.systemType === type);\n    for (const s of systems) {\n      if (s.preupdate) {\n        s.preupdate(context, delta);\n      }\n    }\n\n    for (const s of systems) {\n      // Get entities that match the system types, pre-sort\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\n      // Initialize entities if needed\n      if (context instanceof Scene) {\n        for (const entity of entities) {\n          entity._initialize(context?.engine);\n        }\n      }\n      s.update(entities, delta);\n    }\n\n    for (const s of systems) {\n      if (s.postupdate) {\n        s.postupdate(context, delta);\n      }\n    }\n  }\n\n  public clear(): void {\n    for (const system of this.systems) {\n      this.removeSystem(system);\n    }\n  }\n}\n","import { Entity } from './Entity';\nimport { EntityManager } from './EntityManager';\nimport { QueryManager } from './QueryManager';\nimport { System, SystemType } from './System';\nimport { SystemManager } from './SystemManager';\n\n/**\n * The World is a self-contained entity component system for a particular context.\n */\nexport class World<ContextType> {\n  public queryManager: QueryManager = new QueryManager(this);\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\n\n  /**\n   * The context type is passed to the system updates\n   * @param context\n   */\n  constructor(public context: ContextType) {}\n\n  /**\n   * Update systems by type and time elapsed in milliseconds\n   */\n  update(type: SystemType, delta: number) {\n    if (type === SystemType.Update) {\n      this.entityManager.updateEntities(this.context, delta);\n    }\n    this.systemManager.updateSystems(type, this.context, delta);\n    this.entityManager.findEntitiesForRemoval();\n    this.entityManager.processComponentRemovals();\n    this.entityManager.processEntityRemovals();\n  }\n\n  /**\n   * Add an entity to the ECS world\n   * @param entity\n   */\n  add(entity: Entity): void;\n  /**\n   * Add a system to the ECS world\n   * @param system\n   */\n  add(system: System<any, ContextType>): void;\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.addEntity(entityOrSystem);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.addSystem(entityOrSystem);\n    }\n  }\n\n  /**\n   * Remove an entity from the ECS world\n   * @param entity\n   */\n  remove(entity: Entity, deferred?: boolean): void;\n  /**\n   * Remove a system from the ECS world\n   * @param system\n   */\n  remove(system: System<any, ContextType>): void;\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.removeEntity(entityOrSystem, deferred);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.removeSystem(entityOrSystem);\n    }\n  }\n\n  clearEntities(): void {\n    this.entityManager.clear();\n  }\n\n  clearSystems(): void {\n    this.systemManager.clear();\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { Physics } from './Physics';\nimport { BodyComponent } from './BodyComponent';\nimport { CollisionType } from './CollisionType';\nimport { EulerIntegrator } from './Integrator';\n\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    let transform: TransformComponent;\n    let motion: MotionComponent;\n    for (const entity of _entities) {\n      transform = entity.get(TransformComponent);\n      motion = entity.get(MotionComponent);\n\n      const optionalBody = entity.get(BodyComponent);\n      if (optionalBody?.sleeping) {\n        continue;\n      }\n\n      const totalAcc = motion.acc.clone();\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\n        totalAcc.addEqual(Physics.gravity);\n      }\n      optionalBody?.captureOldTransform();\n\n      // Update transform and motion based on Euler linear algebra\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\n    }\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   */\n  debugDraw(_ctx: CanvasRenderingContext2D) {\n    // pass\n  }\n}\n","import { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * A collision solver figures out how to position colliders such that they are no longer overlapping\n *\n * Solvers are executed in the order\n *\n * 1. preSolve\n * 2. solveVelocity\n * 3. solvePosition\n * 4. postSolve\n * @inheritdoc\n */\nexport abstract class CollisionSolver {\n  /**\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract preSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Post-solve is fired after all resolution is complete\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract postSolve(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solveVelocity(contacts: CollisionContact[]): void;\n\n  /**\n   * Solve position adjust the position of colliders so that they are not overlapping\n   * @param contacts\n   * @inheritdoc\n   */\n  abstract solvePosition(contacts: CollisionContact[]): void;\n\n  /**\n   * Solves overlapping contact in\n   *\n   * Solvers are executed in the order\n   * 1. preSolve\n   * 2. solveVelocity\n   * 3. solvePosition\n   * 4. postSolve\n   * @param contacts\n   */\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\n    // Events and init\n    this.preSolve(contacts);\n\n    // Remove any canceled contacts\n    contacts = contacts.filter(c => !c.isCanceled());\n\n    // Solve velocity first\n    this.solveVelocity(contacts);\n\n    // Solve position last because non-overlap is the most important\n    this.solvePosition(contacts);\n\n    // Events and any contact house-keeping the solver needs\n    this.postSolve(contacts);\n\n    return contacts;\n  }\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { Side } from '../Side';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\n * and negates velocity along the collision normal.\n *\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\n *\n */\nexport class ArcadeSolver extends CollisionSolver {\n  public preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n      }\n      const side = Side.fromDirection(contact.mtv);\n      const mtv = contact.mtv.negate();\n      // Publish collision events on both participants\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\n      );\n    }\n  }\n\n  public solvePosition(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // if bounds no longer interesect skip to the next\n      // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\n      if (!contact.colliderA.bounds.intersect(contact.colliderB.bounds)) {\n        continue;\n      }\n      let mtv = contact.mtv;\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\n          // split overlaps if both are Active\n          mtv = mtv.scale(0.5);\n        }\n\n        // Resolve overlaps\n        if (bodyA.collisionType === CollisionType.Active) {\n          bodyA.pos.x -= mtv.x;\n          bodyA.pos.y -= mtv.y;\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          bodyB.pos.x += mtv.x;\n          bodyB.pos.y += mtv.y;\n        }\n      }\n    }\n  }\n\n  public solveVelocity(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const colliderA = contact.colliderA;\n      const colliderB = contact.colliderB;\n      const bodyA = colliderA.owner?.get(BodyComponent);\n      const bodyB = colliderB.owner?.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        const normal = contact.normal;\n        const opposite = normal.negate();\n\n        // Cancel out velocity opposite direction of collision normal\n        if (bodyA.collisionType === CollisionType.Active) {\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\n          bodyA.vel = bodyA.vel.add(velAdj);\n        }\n\n        if (bodyB.collisionType === CollisionType.Active) {\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\n          bodyB.vel = bodyB.vel.add(velAdj);\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity between bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\nimport { clamp } from '../../Math/util';\nimport { CollisionContact } from '../Detection/CollisionContact';\nimport { CollisionType } from '../CollisionType';\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\nimport { Side } from '../Side';\nimport { Physics } from '../Physics';\nimport { CollisionSolver } from './Solver';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\n\nexport class RealisticSolver extends CollisionSolver {\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\n\n  // map contact id to contact points\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\n\n  getContactConstraints(id: string) {\n    return this.idToContactConstraint.get(id) ?? [];\n  }\n\n  preSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'precollision',\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'beforecollisionresolve',\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n\n      // Match awake state for sleeping\n      contact.matchAwake();\n    }\n\n    // Keep track of contacts that done\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\n    for (const contact of contacts) {\n      // Remove all current contacts that are not done\n      const index = finishedContactIds.indexOf(contact.id);\n      if (index > -1) {\n        finishedContactIds.splice(index, 1);\n      }\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n\n      let pointIndex = 0;\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n      if (bodyA && bodyB) {\n        for (const point of contact.points) {\n          const normal = contact.normal;\n          const tangent = contact.tangent;\n\n          const aToContact = point.sub(bodyA.pos);\n          const bToContact = point.sub(bodyB.pos);\n\n          const aToContactNormal = aToContact.cross(normal);\n          const bToContactNormal = bToContact.cross(normal);\n\n          const normalMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n          const aToContactTangent = aToContact.cross(tangent);\n          const bToContactTangent = bToContact.cross(tangent);\n\n          const tangentMass =\n            bodyA.inverseMass +\n            bodyB.inverseMass +\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\n            contactPoints[pointIndex].point = point;\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\n          } else {\n            // new contact if it's not close or doesn't exist\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\n          }\n\n          // Update contact point calculations\n          contactPoints[pointIndex].aToContact = aToContact;\n          contactPoints[pointIndex].bToContact = bToContact;\n          contactPoints[pointIndex].normalMass = normalMass;\n          contactPoints[pointIndex].tangentMass = tangentMass;\n\n          pointIndex++;\n        }\n      }\n      this.idToContactConstraint.set(contact.id, contactPoints);\n    }\n\n    // Clean up any contacts that did not occur last frame\n    for (const id of finishedContactIds) {\n      this.idToContactConstraint.delete(id);\n    }\n\n    // Warm contacts with accumulated impulse\n    // Useful for tall stacks\n    if (Physics.warmStart) {\n      this.warmStart(contacts);\n    } else {\n      for (const contact of contacts) {\n        const contactPoints = this.getContactConstraints(contact.id);\n        for (const point of contactPoints) {\n          point.normalImpulse = 0;\n          point.tangentImpulse = 0;\n        }\n      }\n    }\n  }\n\n  postSolve(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\n\n      if (bodyA && bodyB) {\n        // Skip post solve for active+passive collisions\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n          continue;\n        }\n\n        // Update motion values for sleeping\n        bodyA.updateMotion();\n        bodyB.updateMotion();\n      }\n\n      // Publish collision events on both participants\n      const side = Side.fromDirection(contact.mtv);\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\n      contact.colliderA.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\n      );\n      contact.colliderB.events.emit(\n        'postcollision',\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\n      );\n      contact.colliderB.events.emit(\n        'aftercollisionresolve',\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\n      );\n    }\n\n    // Store contacts\n    this.lastFrameContacts.clear();\n    for (const c of contacts) {\n      this.lastFrameContacts.set(c.id, c);\n    }\n  }\n\n  /**\n   * Warm up body's based on previous frame contact points\n   * @param contacts\n   */\n  warmStart(contacts: CollisionContact[]) {\n    for (const contact of contacts) {\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\n      if (bodyA && bodyB) {\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\n        for (const point of contactPoints) {\n          if (Physics.warmStart) {\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\n            const impulse = normalImpulse.add(tangentImpulse);\n\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          } else {\n            point.normalImpulse = 0;\n            point.tangentImpulse = 0;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Iteratively solve the position overlap constraint\n   * @param contacts\n   */\n  solvePosition(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.positionIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n          for (const point of constraints) {\n            const normal = contact.normal;\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\n\n            const steeringConstant = Physics.steeringFactor; //0.2;\n            const maxCorrection = -5;\n            const slop = Physics.slop; //1;\n\n            // Clamp to avoid over-correction\n            // Remember that we are shooting for 0 overlap in the end\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\n            const impulse = normal.scale(-steeringForce / point.normalMass);\n\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\n            // We adjust position and rotation instead of doing the velocity\n            if (bodyA.collisionType === CollisionType.Active) {\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\n            }\n\n            if (bodyB.collisionType === CollisionType.Active) {\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  solveVelocity(contacts: CollisionContact[]) {\n    for (let i = 0; i < Physics.velocityIterations; i++) {\n      for (const contact of contacts) {\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\n\n        if (bodyA && bodyB) {\n          // Skip solving active+passive\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\n            continue;\n          }\n\n          const restitution = bodyA.bounciness * bodyB.bounciness;\n          const friction = Math.min(bodyA.friction, bodyB.friction);\n\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\n\n          for (const point of constraints) {\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Negate velocity in tangent direction to simulate friction\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\n            let impulseDelta = tangentVelocity / point.tangentMass;\n\n            // Clamping based in Erin Catto's GDC 2006 talk\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\n            // But deltas can vary\n            const maxFriction = friction * point.normalImpulse;\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\n            impulseDelta = newImpulse - point.tangentImpulse;\n            point.tangentImpulse = newImpulse;\n\n            const impulse = contact.tangent.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n\n          for (const point of constraints) {\n            // Need to recalc relative velocity because the previous step could have changed vel\n            const relativeVelocity = point.getRelativeVelocity();\n\n            // Compute impulse in normal direction\n            const normalVelocity = relativeVelocity.dot(contact.normal);\n            // See https://en.wikipedia.org/wiki/Collision_response\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\n\n            // Clamping based in Erin Catto's GDC 2014 talk\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\n            // But deltas can be negative\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\n            impulseDelta = newImpulse - point.normalImpulse;\n            point.normalImpulse = newImpulse;\n\n            const impulse = contact.normal.scale(impulseDelta);\n            bodyA.applyImpulse(point.point, impulse.negate());\n            bodyB.applyImpulse(point.point, impulse);\n          }\n        }\n      }\n    }\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\nimport { CollisionResolutionStrategy, Physics } from './Physics';\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\nimport { Collider } from './Colliders/Collider';\nimport { CollisionContact } from './Detection/CollisionContact';\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\nimport { RealisticSolver } from './Solver/RealisticSolver';\nimport { CollisionSolver } from './Solver/Solver';\nimport { ColliderComponent } from './ColliderComponent';\nimport { CompositeCollider } from './Colliders/CompositeCollider';\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\n\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\n  public systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _realisticSolver = new RealisticSolver();\n  private _arcadeSolver = new ArcadeSolver();\n  private _processor = new DynamicTreeCollisionProcessor();\n  private _lastFrameContacts = new Map<string, CollisionContact>();\n  private _currentFrameContacts = new Map<string, CollisionContact>();\n\n  private _trackCollider = (c: Collider) => this._processor.track(c);\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\n\n  notify(message: AddedEntity | RemovedEntity) {\n    if (isAddedSystemEntity(message)) {\n      const colliderComponent = message.data.get(ColliderComponent);\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\n      const collider = colliderComponent.get();\n      if (collider) {\n        this._processor.track(collider);\n      }\n    } else {\n      const colliderComponent = message.data.get(ColliderComponent);\n      const collider = colliderComponent.get();\n      if (colliderComponent && collider) {\n        this._processor.untrack(collider);\n      }\n    }\n  }\n\n  initialize(scene: Scene) {\n    this._engine = scene.engine;\n  }\n\n  update(_entities: Entity[], elapsedMs: number): void {\n    if (!Physics.enabled) {\n      return;\n    }\n\n    // Collect up all the colliders\n    let colliders: Collider[] = [];\n    for (const entity of _entities) {\n      const colliderComp = entity.get(ColliderComponent);\n      const collider = colliderComp?.get();\n      if (colliderComp && colliderComp.owner?.active && collider) {\n        colliderComp.update();\n        if (collider instanceof CompositeCollider) {\n          colliders = colliders.concat(collider.getColliders());\n        } else {\n          colliders.push(collider);\n        }\n      }\n    }\n\n    // Update the spatial partitioning data structures\n    // TODO if collider invalid it will break the processor\n    // TODO rename \"update\" to something more specific\n    this._processor.update(colliders);\n\n    // Run broadphase on all colliders and locates potential collisions\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\n\n    this._currentFrameContacts.clear();\n\n    // Given possible pairs find actual contacts\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\n\n    const solver: CollisionSolver = this.getSolver();\n\n    // Solve, this resolves the position/velocity so entities aren't overlapping\n    contacts = solver.solve(contacts);\n\n    // Record contacts\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\n\n    // Emit contact start/end events\n    this.runContactStartEnd();\n\n    // reset the last frame cache\n    this._lastFrameContacts.clear();\n\n    // Keep track of collisions contacts that have started or ended\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\n  }\n\n  getSolver(): CollisionSolver {\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\n  }\n\n  debug(ex: ExcaliburGraphicsContext) {\n    this._processor.debug(ex);\n  }\n\n  public runContactStartEnd() {\n    for (const [id, c] of this._currentFrameContacts) {\n      // find all new contacts\n      if (!this._lastFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\n      }\n    }\n\n    // find all contacts taht have ceased\n    for (const [id, c] of this._lastFrameContacts) {\n      if (!this._currentFrameContacts.has(id)) {\n        const colliderA = c.colliderA;\n        const colliderB = c.colliderB;\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\n      }\n    }\n  }\n}\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { SpriteSheet } from './SpriteSheet';\nimport { Logger } from '../Util/Log';\nimport { Engine, LegacyDrawing } from '..';\nimport { Sprite } from '.';\nimport { clamp } from '../Math/util';\n\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\nexport enum AnimationDirection {\n  /**\n   * Animation is playing forwards\n   */\n  Forward = 'forward',\n  /**\n   * Animation is play backwards\n   */\n  Backward = 'backward'\n}\n\nexport enum AnimationStrategy {\n  /**\n   * Animation ends without displaying anything\n   */\n  End = 'end',\n  /**\n   * Animation loops to the first frame after the last frame\n   */\n  Loop = 'loop',\n  /**\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\n   */\n  PingPong = 'pingpong',\n  /**\n   * Animation ends stopping on the last frame\n   */\n  Freeze = 'freeze'\n}\n\n/**\n * Frame of animation\n */\nexport interface Frame {\n  /**\n   * Optionally specify a graphic to show, no graphic shows an empty frame\n   */\n  graphic?: Graphic;\n  /**\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\n   */\n  duration?: number;\n}\n\n/**\n * Animation options for building an animation via constructor.\n */\nexport interface AnimationOptions {\n  /**\n   * List of frames in the order you wish to play them\n   */\n  frames: Frame[];\n  /**\n   * Optionally reverse the direction of play\n   */\n  reverse?: boolean;\n  /**\n   * Optionally specify a default frame duration in ms (Default is 1000)\n   */\n  frameDuration?: number;\n  /**\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\n   */\n  totalDuration?: number;\n  /**\n   * Optionally specify the [[AnimationStrategy]] for the Animation\n   */\n  strategy?: AnimationStrategy;\n}\n\n// TODO wire up to new Emitter\nexport type AnimationEvents = {\n  frame: Frame;\n  loop: Animation;\n  ended: Animation;\n};\n\n/**\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\n *\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\n */\nexport class Animation extends Graphic implements HasTick {\n  private static _LOGGER = Logger.getInstance();\n  public events = new EventDispatcher<any>(); // TODO replace with new Emitter\n  public frames: Frame[] = [];\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\n  public frameDuration: number = 100;\n  public timeScale: number = 1;\n\n  private _idempotencyToken = -1;\n\n  private _firstTick = true;\n  private _currentFrame = 0;\n  private _timeLeftInFrame = 0;\n  private _direction = 1; // TODO only used in ping-pong\n  private _done = false;\n  private _playing = true;\n\n  constructor(options: GraphicOptions & AnimationOptions) {\n    super(options);\n    this.frames = options.frames;\n    this.strategy = options.strategy ?? this.strategy;\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\n    if (options.reverse) {\n      this.reverse();\n    }\n    this.goToFrame(0);\n  }\n\n  public clone(): Animation {\n    return new Animation({\n      frames: this.frames.map((f) => ({ ...f })),\n      frameDuration: this.frameDuration,\n      reverse: this._reversed,\n      strategy: this.strategy,\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  public override get width(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\n    }\n    return 0;\n  }\n\n  public override get height(): number {\n    const maybeFrame = this.currentFrame;\n    if (maybeFrame) {\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\n    }\n    return 0;\n  }\n\n\n  /**\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\n   * and optional [[AnimationStrategy]]\n   *\n   * Example:\n   * ```typescript\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\n   *\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\n   * ```\n   *\n   * @param spriteSheet\n   * @param frameIndices\n   * @param durationPerFrameMs\n   * @param strategy\n   */\n  public static fromSpriteSheet(\n    spriteSheet: SpriteSheet,\n    frameIndices: number[],\n    durationPerFrameMs: number,\n    strategy: AnimationStrategy = AnimationStrategy.Loop\n  ): Animation {\n    const maxIndex = spriteSheet.sprites.length - 1;\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\n    if (invalidIndices.length) {\n      Animation._LOGGER.warn(\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\n      );\n    }\n    return new Animation({\n      frames: spriteSheet.sprites\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\n        .map((f) => ({\n          graphic: f,\n          duration: durationPerFrameMs\n        })),\n      strategy: strategy\n    });\n  }\n\n  /**\n   * Converts an animation to a legacy animation\n   * @deprecated\n   * @param engine\n   * @param animation\n   * @returns LegacyDrawing.Animation\n   */\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\n    return new LegacyDrawing.Animation({\n      sprites: legacySprites,\n      loop: animation.strategy === AnimationStrategy.Loop,\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\n      speed: animation.frameDuration,\n      engine: engine\n    });\n  }\n\n  /**\n   * Returns the current Frame of the animation\n   */\n  public get currentFrame(): Frame | null {\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\n      return this.frames[this._currentFrame];\n    }\n    return null;\n  }\n\n  /**\n   * Returns the current frame index of the animation\n   */\n  public get currentFrameIndex(): number {\n    return this._currentFrame;\n  }\n\n  /**\n   * Returns `true` if the animation is playing\n   */\n  public get isPlaying(): boolean {\n    return this._playing;\n  }\n\n  private _reversed = false;\n  /**\n   * Reverses the play direction of the Animation, this preserves the current frame\n   */\n  public reverse(): void {\n    // Don't mutate with the original frame list, create a copy\n    this.frames = this.frames.slice().reverse();\n    this._reversed = !this._reversed;\n  }\n\n  /**\n   * Returns the current play direction of the animation\n   */\n  public get direction(): AnimationDirection {\n    // Keep logically consistent with ping-pong direction\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\n  }\n\n  /**\n   * Plays or resumes the animation from the current frame\n   */\n  public play(): void {\n    this._playing = true;\n  }\n\n  /**\n   * Pauses the animation on the current frame\n   */\n  public pause(): void {\n    this._playing = false;\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\n  }\n\n  /**\n   * Reset the animation back to the beginning, including if the animation were done\n   */\n  public reset(): void {\n    this._done = false;\n    this._firstTick = true;\n    this._currentFrame = 0;\n  }\n\n  /**\n   * Returns `true` if the animation can end\n   */\n  public get canFinish(): boolean {\n    switch (this.strategy) {\n      case AnimationStrategy.End:\n      case AnimationStrategy.Freeze: {\n        return true;\n      }\n      default: {\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Returns `true` if the animation is done, for looping type animations\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\n   *\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\n   */\n  public get done(): boolean {\n    return this._done;\n  }\n\n  /**\n   * Jump the animation immediately to a specific frame if it exists\n   * @param frameNumber\n   */\n  public goToFrame(frameNumber: number) {\n    this._currentFrame = frameNumber;\n    this._timeLeftInFrame = this.frameDuration;\n    const maybeFrame = this.frames[this._currentFrame];\n    if (maybeFrame && !this._done) {\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\n      this.events.emit('frame', maybeFrame as any);\n    }\n  }\n\n  private _nextFrame(): number {\n    const currentFrame = this._currentFrame;\n    if (this._done) {\n      return currentFrame;\n    }\n    let next = -1;\n\n    switch (this.strategy) {\n      case AnimationStrategy.Loop: {\n        next = (currentFrame + 1) % this.frames.length;\n        if (next === 0) {\n          this.events.emit('loop', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.End: {\n        next = currentFrame + 1;\n        if (next >= this.frames.length) {\n          this._done = true;\n          this._currentFrame = this.frames.length;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.Freeze: {\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\n        if (next >= this.frames.length - 1) {\n          this._done = true;\n          this.events.emit('end', this as any);\n        }\n        break;\n      }\n      case AnimationStrategy.PingPong: {\n        if (currentFrame + this._direction >= this.frames.length) {\n          this._direction = -1;\n          this.events.emit('loop', this as any);\n        }\n\n        if (currentFrame + this._direction < 0) {\n          this._direction = 1;\n          this.events.emit('loop', this as any);\n        }\n\n        next = currentFrame + (this._direction % this.frames.length);\n        break;\n      }\n    }\n    return next;\n  }\n\n  /**\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\n   * @param elapsedMilliseconds Milliseconds elapsed\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\n   */\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    if (!this._playing) {\n      return;\n    }\n\n    // if it's the first frame emit frame event\n    if (this._firstTick) {\n      this._firstTick = false;\n      this.events.emit('frame', this.currentFrame as any);\n    }\n\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\n    if (this._timeLeftInFrame <= 0) {\n      this.goToFrame(this._nextFrame());\n    }\n  }\n\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.currentFrame) {\n      this.currentFrame.graphic.draw(ctx, x, y);\n    }\n  }\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Color } from './Color';\nimport { Vector, vec } from './Math/vector';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/Index';\nimport { Sprite } from './Graphics/Sprite';\nimport { BoundingBox, LegacyDrawing } from '.';\nimport { clamp, randomInRange } from './Math/util';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl extends Entity {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: LegacyDrawing.Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  public visible = true;\n  public isOffscreen = false;\n\n  public transform: TransformComponent;\n  public graphics: GraphicsComponent;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super();\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = (position || this.position).add(this.emitter.pos);\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n\n    this.addComponent((this.transform = new TransformComponent()));\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\n    this.addComponent((this.graphics = new GraphicsComponent()));\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // TODO wut\n    if (this.particleSprite) {\n      this.graphics.opacity = this.opacity;\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\n    } else {\n      this.graphics.localBounds = BoundingBox.fromDimension(this.particleSize, this.particleSize, Vector.Half);\n      this.graphics.onPostDraw = (ctx) => {\n        ctx.save();\n        this.graphics.opacity = this.opacity;\n        const tmpColor = this._currentColor.clone();\n        tmpColor.a = 1;\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\n        ctx.restore();\n      };\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n\n    this.transform.pos = this.position;\n    this.transform.rotation = this.currentRotation;\n    this.transform.scale = vec(1, 1); // todo wut\n    this.graphics.opacity = this.opacity;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.opacity(this.opacity);\n      this.particleSprite.draw(ctx, 0, 0);\n      return;\n    }\n\n    ctx.save();\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n    ctx.restore();\n  }\n}\n\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: LegacyDrawing.Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\nexport interface ParticleEmitterArgs {\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: LegacyDrawing.Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n */\nexport class ParticleEmitter extends Actor {\n  private _particlesToEmit: number = 0;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Particle[] = [];\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Particle[] = [];\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public get opacity(): number {\n    return super.graphics.opacity;\n  }\n  /**\n   * Gets the opacity of each particle from 0 to 1.0\n   */\n  public set opacity(opacity: number) {\n    super.graphics.opacity = opacity;\n  }\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = null;\n  /**\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /**\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  private _og: LegacyDrawing.Sprite = null;\n  private _sprite: Sprite = null;\n  /**\n   * Gets or sets the sprite that a particle should use\n   */\n  public get particleSprite(): LegacyDrawing.Sprite {\n    return this._og;\n  }\n\n  public set particleSprite(val: LegacyDrawing.Sprite) {\n    this._og = val;\n    if (val) {\n      this._sprite = Sprite.fromLegacySprite(val);\n    }\n  }\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param config particle emitter options bag\n   */\n  constructor(config: ParticleEmitterArgs) {\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\n\n    const {\n      x,\n      y,\n      pos,\n      isEmitting,\n      minVel,\n      maxVel,\n      acceleration,\n      minAngle,\n      maxAngle,\n      emitRate,\n      particleLife,\n      opacity,\n      fadeFlag,\n      focus,\n      focusAccel,\n      startSize,\n      endSize,\n      minSize,\n      maxSize,\n      beginColor,\n      endColor,\n      particleSprite,\n      emitterType,\n      radius,\n      particleRotationalVelocity,\n      randomRotation,\n      random\n    } = { ...config };\n\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\n    this.isEmitting = isEmitting ?? this.isEmitting;\n    this.minVel = minVel ?? this.minVel;\n    this.maxVel = maxVel ?? this.maxVel;\n    this.acceleration = acceleration ?? this.acceleration;\n    this.minAngle = minAngle ?? this.minAngle;\n    this.maxAngle = maxAngle ?? this.maxAngle;\n    this.emitRate = emitRate ?? this.emitRate;\n    this.particleLife = particleLife ?? this.particleLife;\n    this.opacity = opacity ?? this.opacity;\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\n    this.focus = focus ?? this.focus;\n    this.focusAccel = focusAccel ?? this.focusAccel;\n    this.startSize = startSize ?? this.startSize;\n    this.endSize = endSize ?? this.endSize;\n    this.minSize = minSize ?? this.minSize;\n    this.maxSize = maxSize ?? this.maxSize;\n    this.beginColor = beginColor ?? this.beginColor;\n    this.endColor = endColor ?? this.endColor;\n    this.particleSprite = particleSprite ?? this.particleSprite;\n    this.emitterType = emitterType ?? this.emitterType;\n    this.radius = radius ?? this.radius;\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\n    this.randomRotation = randomRotation ?? this.randomRotation;\n\n    this.body.collisionType = CollisionType.PreventCollision;\n\n    this.random = random ?? new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      const p = this._createParticle();\n      this.particles.push(p);\n      if (this?.scene?.world) {\n        this.scene.world.add(p);\n      }\n    }\n  }\n\n  public clearParticles() {\n    this.particles.length = 0;\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = randomInRange(0, this.width, this.random);\n      ranY = randomInRange(0, this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle);\n      ranY = radius * Math.sin(angle);\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n      p.graphics.opacity = this.opacity;\n      p.graphics.use(this._sprite);\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    // deferred removal\n    for (let i = 0; i < this.deadParticles.length; i++) {\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\n      if (this?.scene?.world) {\n        this.scene.world.remove(this.deadParticles[i], false);\n      }\n    }\n    this.deadParticles.length = 0;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param ctx\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Scene } from '../Scene';\nimport { GraphicsComponent } from './GraphicsComponent';\nimport { vec } from '../Math/vector';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { Camera } from '../Camera';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem';\nimport { Engine } from '../Engine';\nimport { GraphicsGroup } from '.';\nimport { Particle } from '../Particles';\n\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 0;\n  private _token = 0;\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  private _sortedTransforms: TransformComponent[] = [];\n  public get sortedTransforms() {\n    return this._sortedTransforms;\n  }\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n  }\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return a.z - b.z;\n      });\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n      }\n    }\n  }\n\n  public update(_entities: Entity[], delta: number): void {\n    this._token++;\n    let graphics: GraphicsComponent;\n\n    // This is a performance enhancement, most things are in world space\n    // so if we can only do this once saves a ton of transform updates\n    this._graphicsContext.save();\n    if (this._camera) {\n      this._camera.draw(this._graphicsContext);\n    }\n    for (const transform of this._sortedTransforms) {\n      const entity = transform.owner as Entity;\n\n      // If the entity is offscreen skip\n      if (entity.hasTag('ex.offscreen')) {\n        continue;\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      // Exit if graphics set to not visible\n      if (!graphics.visible) {\n        continue;\n      }\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.restore();\n      }\n\n      this._graphicsContext.save();\n\n      // Tick any graphics state (but only once) for animations and graphics groups\n      graphics.update(delta, this._token);\n\n      // Position the entity\n      this._applyTransform(entity);\n\n      // Optionally run the onPreDraw graphics lifecycle draw\n      if (graphics.onPreDraw) {\n        graphics.onPreDraw(this._graphicsContext, delta);\n      }\n\n      // TODO remove this hack on the particle redo\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\n\n      // Draw the graphics component\n      this._drawGraphicsComponent(graphics);\n\n      // Optionally run the onPostDraw graphics lifecycle draw\n      if (graphics.onPostDraw) {\n        graphics.onPostDraw(this._graphicsContext, delta);\n      }\n\n      this._graphicsContext.restore();\n\n      // Reset the transform back to the original world space\n      if (transform.coordPlane === CoordPlane.Screen) {\n        this._graphicsContext.save();\n        if (this._camera) {\n          this._camera.draw(this._graphicsContext);\n        }\n      }\n    }\n    this._graphicsContext.restore();\n  }\n\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\n    if (graphicsComponent.visible) {\n      // this should be moved to the graphics system\n      for (const layer of graphicsComponent.layers.get()) {\n        for (const { graphic, options } of layer.graphics) {\n          let anchor = graphicsComponent.anchor;\n          let offset = graphicsComponent.offset;\n          if (options?.anchor) {\n            anchor = options.anchor;\n          }\n          if (options?.offset) {\n            offset = options.offset;\n          }\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n          const offsetX = -graphic.width * anchor.x + offset.x;\n          const offsetY = -graphic.height * anchor.y + offset.y;\n\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\n\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\n            if (graphic instanceof GraphicsGroup) {\n              for (const g of graphic.members) {\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n              }\n            } else {\n              /* istanbul ignore next */\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Actor } from '../Actor';\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\n\n/**\n * Draws anything with a transform and a \"draw\" method\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\n */\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\n  public systemType = SystemType.Draw;\n  public priority = -1;\n\n  private _ctx: CanvasRenderingContext2D;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._ctx = scene.engine.ctx;\n    this._engine = scene.engine;\n    this._camera = scene.camera;\n  }\n\n  public sort(a: Entity, b: Entity) {\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\n  }\n\n  public update(entities: Entity[], delta: number) {\n    this._clearScreen();\n\n    let transform: TransformComponent;\n    let canvasdraw: CanvasDrawComponent;\n    const length = entities.length;\n    for (let i = 0; i < length; i++) {\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\n      const offscreen = (entities[i] as Actor).isOffScreen;\n      if (visible && !offscreen) {\n        transform = entities[i].get(TransformComponent);\n        canvasdraw = entities[i].get(CanvasDrawComponent);\n\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n\n        this._ctx.save();\n        this._applyTransform(entities[i]);\n        canvasdraw.draw(this._ctx, delta);\n        this._ctx.restore();\n\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n\n      if (this._engine.isDebug) {\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n        this._ctx.strokeStyle = 'yellow';\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n    }\n    if (this._engine.isDebug) {\n      this._ctx.save();\n      this._camera.draw(this._ctx);\n      this._camera.debugDraw(this._ctx);\n      this._ctx.restore();\n    }\n\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n  }\n\n  private _applyTransform(entity: Entity) {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._ctx.translate(transform.pos.x, transform.pos.y);\n        this._ctx.rotate(transform.rotation);\n        this._ctx.scale(transform.scale.x, transform.scale.y);\n      }\n    }\n  }\n\n  private _clearScreen(): void {\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n  }\n\n  private _pushCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera transform to place entity in world space\n      this._ctx.save();\n      if (this._camera) {\n        this._camera.draw(this._ctx);\n      }\n    }\n  }\n\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Restore back to screen space from world space if we were drawing an entity there\n      this._ctx.restore();\n    }\n  }\n}\n","import { Engine } from '../Engine';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\nimport { ColliderComponent } from '../Collision/ColliderComponent';\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\nimport { System, SystemType } from '../EntityComponentSystem/System';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { vec, Vector } from '../Math/vector';\nimport { toDegrees } from '../Math/util';\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle } from '..';\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\n\nexport class DebugSystem extends System<TransformComponent> {\n  public readonly types = ['ex.transform'] as const;\n  public readonly systemType = SystemType.Draw;\n  public priority = 999; // lowest priority\n  private _graphicsContext: ExcaliburGraphicsContext;\n  private _collisionSystem: CollisionSystem;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._graphicsContext = scene.engine.graphicsContext;\n    this._camera = scene.camera;\n    this._engine = scene.engine;\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\n  }\n\n  update(entities: Entity[], _delta: number): void {\n    if (!this._engine.isDebug) {\n      return;\n    }\n\n    const filterSettings = this._engine.debug.filter;\n\n    let id: number;\n    let name: string;\n    const entitySettings = this._engine.debug.entity;\n\n    let tx: TransformComponent;\n    const txSettings = this._engine.debug.transform;\n\n    let motion: MotionComponent;\n    const motionSettings = this._engine.debug.motion;\n\n    let colliderComp: ColliderComponent;\n    const colliderSettings = this._engine.debug.collider;\n\n    const physicsSettings = this._engine.debug.physics;\n\n    let graphics: GraphicsComponent;\n    const graphicsSettings = this._engine.debug.graphics;\n\n    let debugDraw: DebugGraphicsComponent;\n\n    let body: BodyComponent;\n    const bodySettings = this._engine.debug.body;\n\n    const cameraSettings = this._engine.debug.camera;\n    for (const entity of entities) {\n      if (entity.hasTag('offscreen')) {\n        // skip offscreen entities\n        continue;\n      }\n      if (entity instanceof Particle) {\n        // Particles crush the renderer :(\n        continue;\n      }\n      if (filterSettings.useFilter) {\n        const allIds = filterSettings.ids.length === 0;\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\n        if (!idMatch) {\n          continue;\n        }\n        const allNames = filterSettings.nameQuery === '';\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\n        if (!nameMatch) {\n          continue;\n        }\n      }\n\n      let cursor = Vector.Zero;\n      const lineHeight = vec(0, 16);\n      id = entity.id;\n      name = entity.name;\n      tx = entity.get(TransformComponent);\n\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\n      this._pushCameraTransform(tx);\n\n      this._graphicsContext.save();\n\n      this._applyTransform(entity);\n      if (tx) {\n        if (txSettings.showAll || txSettings.showPosition) {\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\n        }\n        if (txSettings.showAll || txSettings.showPositionLabel) {\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n        if (txSettings.showAll || txSettings.showZIndex) {\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showId) {\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (entitySettings.showAll || entitySettings.showName) {\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showRotation) {\n          this._graphicsContext.drawLine(\n            Vector.Zero,\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\n            txSettings.rotationColor,\n            2\n          );\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (txSettings.showAll || txSettings.showScale) {\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\n        }\n      }\n\n      graphics = entity.get(GraphicsComponent);\n      if (graphics) {\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\n          const bounds = graphics.localBounds;\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\n        }\n      }\n\n      debugDraw = entity.get(DebugGraphicsComponent);\n      if (debugDraw) {\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.restore();\n        }\n        debugDraw.draw(this._graphicsContext);\n        if (!debugDraw.useTransform) {\n          this._graphicsContext.save();\n          this._applyTransform(entity);\n        }\n      }\n\n      body = entity.get(BodyComponent);\n      if (body) {\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMass) {\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showMotion) {\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (bodySettings.showAll || bodySettings.showSleeping) {\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\n          cursor = cursor.add(lineHeight);\n        }\n      }\n\n      this._graphicsContext.restore();\n\n      motion = entity.get(MotionComponent);\n      if (motion) {\n        if (motionSettings.showAll || motionSettings.showVelocity) {\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\n          cursor = cursor.add(lineHeight);\n        }\n\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\n        }\n      }\n\n      // Colliders live in world space already so after the restore()\n      colliderComp = entity.get(ColliderComponent);\n      if (colliderComp) {\n        const collider = colliderComp.get();\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\n        }\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\n          if (collider instanceof CompositeCollider) {\n            const colliders = collider.getColliders();\n            for (const collider of colliders) {\n              const bounds = collider.bounds;\n              const pos = vec(bounds.left, bounds.top);\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\n              }\n            }\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\n          } else if (collider) {\n            const bounds = colliderComp.bounds;\n            const pos = vec(bounds.left, bounds.top);\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\n            }\n          }\n        }\n      }\n\n      this._popCameraTransform(tx);\n    }\n\n    this._graphicsContext.save();\n    this._camera.draw(this._graphicsContext);\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\n      this._collisionSystem.debug(this._graphicsContext);\n    }\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\n          }\n        }\n\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\n          for (const point of contact.points) {\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\n              color: physicsSettings.collisionNormalColor\n            });\n          }\n        }\n      }\n    }\n    this._graphicsContext.restore();\n\n    if (cameraSettings) {\n      this._graphicsContext.save();\n      this._camera.draw(this._graphicsContext);\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\n      }\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\n      }\n      this._graphicsContext.restore();\n    }\n\n    this._graphicsContext.flush();\n  }\n\n  /**\n   * This applies the current entity transform to the graphics context\n   * @param entity\n   */\n  private _applyTransform(entity: Entity): void {\n    const ancestors = entity.getAncestors();\n    for (const ancestor of ancestors) {\n      const transform = ancestor?.get(TransformComponent);\n      if (transform) {\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\n        this._graphicsContext.rotate(transform.rotation);\n      }\n    }\n  }\n\n  /**\n   * Applies the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _pushCameraTransform(transform: TransformComponent) {\n    // Establish camera offset per entity\n    if (transform.coordPlane === CoordPlane.World) {\n      this._graphicsContext.save();\n      if (this._camera) {\n        this._camera.draw(this._graphicsContext);\n      }\n    }\n  }\n\n  /**\n   * Resets the current camera transform if in world coordinates\n   * @param transform\n   */\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera world offset\n      this._graphicsContext.restore();\n    }\n  }\n}\n","import { ColliderComponent } from '../Collision/ColliderComponent';\nimport { Engine } from '../Engine';\nimport {\n  System,\n  TransformComponent,\n  SystemType,\n  Entity,\n  CoordPlane,\n  AddedEntity,\n  RemovedEntity,\n  isAddedSystemEntity\n} from '../EntityComponentSystem';\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\nimport { Scene } from '../Scene';\nimport { PointerComponent } from './PointerComponent';\nimport { PointerEventReceiver } from './PointerEventReceiver';\nimport { PointerEvent } from './PointerEvent';\n\n/**\n * The PointerSystem is responsible for dispatching pointer events to entities\n * that need them.\n *\n * The PointerSystem can be optionally configured by the [[PointerComponent]], by default Entities use\n * the [[Collider]]'s shape for pointer events.\n */\nexport class PointerSystem extends System<TransformComponent | PointerComponent> {\n  public readonly types = ['ex.transform', 'ex.pointer'] as const;\n  public readonly systemType = SystemType.Update;\n  public priority = -1;\n\n  private _engine: Engine;\n  private _receiver: PointerEventReceiver;\n\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseColliderShape = false;\n  /**\n   * Optionally override component configuration for all entities\n   */\n  public overrideUseGraphicsBounds = false;\n\n  public lastFrameEntityToPointers = new Map<number, number[]>();\n  public currentFrameEntityToPointers = new Map<number, number[]>();\n\n  public initialize(scene: Scene): void {\n    this._engine = scene.engine;\n    this._receiver = this._engine.input.pointers;\n  }\n\n  private _sortedTransforms: TransformComponent[] = [];\n  private _sortedEntities: Entity[] = [];\n\n  private _zHasChanged = false;\n  private _zIndexUpdate = () => {\n    this._zHasChanged = true;\n  };\n\n  public preupdate(): void {\n    if (this._zHasChanged) {\n      this._sortedTransforms.sort((a, b) => {\n        return b.z - a.z;\n      });\n      this._sortedEntities = this._sortedTransforms.map(t => t.owner);\n      this._zHasChanged = false;\n    }\n  }\n\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      this._sortedTransforms.push(tx);\n      this._sortedEntities.push(tx.owner);\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\n      this._zHasChanged = true;\n    } else {\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\n      const index = this._sortedTransforms.indexOf(tx);\n      if (index > -1) {\n        this._sortedTransforms.splice(index, 1);\n        this._sortedEntities.splice(index, 1);\n      }\n    }\n  }\n\n  public entityCurrentlyUnderPointer(entity: Entity, pointerId: number) {\n    return this.currentFrameEntityToPointers.has(entity.id) &&\n           this.currentFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entityWasUnderPointer(entity: Entity, pointerId: number) {\n    return this.lastFrameEntityToPointers.has(entity.id) &&\n           this.lastFrameEntityToPointers.get(entity.id).includes(pointerId);\n  }\n\n  public entered(entity: Entity, pointerId: number) {\n    return this.entityCurrentlyUnderPointer(entity, pointerId) &&\n           !this.lastFrameEntityToPointers.has(entity.id);\n  }\n\n  public left(entity: Entity, pointerId: number) {\n    return !this.currentFrameEntityToPointers.has(entity.id) &&\n            this.entityWasUnderPointer(entity, pointerId);\n  }\n\n  public addPointerToEntity(entity: Entity, pointerId: number) {\n    if (!this.currentFrameEntityToPointers.has(entity.id)) {\n      this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\n      return;\n    }\n    const pointers = this.currentFrameEntityToPointers.get(entity.id);\n    this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\n  }\n\n  public update(_entities: Entity[]): void {\n    // Locate all the pointer/entity mappings\n    this._processPointerToEntity(this._sortedEntities);\n\n    // Dispatch pointer events on entities\n    this._dispatchEvents(this._sortedEntities);\n\n    // Clear last frame's events\n    this._receiver.update();\n    this.lastFrameEntityToPointers.clear();\n    this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\n    this.currentFrameEntityToPointers.clear();\n    this._receiver.clear();\n  }\n\n  private _processPointerToEntity(entities: Entity[]) {\n    let transform: TransformComponent;\n    let collider: ColliderComponent;\n    let graphics: GraphicsComponent;\n    let pointer: PointerComponent;\n\n    // TODO probably a spatial partition optimization here to quickly query bounds for pointer\n    // doesn't seem to cause issues tho for perf\n\n    // Pre-process find entities under pointers\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      pointer = entity.get(PointerComponent) ?? new PointerComponent;\n      // Check collider contains pointer\n      collider = entity.get(ColliderComponent);\n      if (collider && (pointer.useColliderShape || this.overrideUseColliderShape)) {\n        const geom = collider.get();\n        if (geom) {\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n            if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n              this.addPointerToEntity(entity, pointerId);\n            }\n          }\n        }\n      }\n\n      // Check graphics contains pointer\n      graphics = entity.get(GraphicsComponent);\n      if (graphics && (pointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\n        const graphicBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n        for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\n          if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\n            this.addPointerToEntity(entity, pointerId);\n          }\n        }\n      }\n    }\n  }\n\n  private _processDownAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastDownPerPointer = new Map<number, PointerEvent>();\n    // Loop through down and dispatch to entities\n    for (const event of this._receiver.currentFrameDown) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerdown', event as any);\n        if (this._receiver.isDragStart(event.pointerId)) {\n          entity.events.emit('pointerdragstart', event as any);\n        }\n      }\n      lastDownPerPointer.set(event.pointerId, event);\n    }\n    return lastDownPerPointer;\n  }\n\n  private _processUpAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastUpPerPointer = new Map<number, PointerEvent>();\n    // Loop through up and dispatch to entities\n    for (const event of this._receiver.currentFrameUp) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        entity.events.emit('pointerup', event as any);\n        if (this._receiver.isDragEnd(event.pointerId)) {\n          entity.events.emit('pointerdragend', event as any);\n        }\n      }\n      lastUpPerPointer.set(event.pointerId, event);\n    }\n    return lastUpPerPointer;\n  }\n\n  private _processMoveAndEmit(entity: Entity): Map<number, PointerEvent> {\n    const lastMovePerPointer = new Map<number, PointerEvent>();\n    // Loop through move and dispatch to entities\n    for (const event of this._receiver.currentFrameMove) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\n        // move\n        entity.events.emit('pointermove', event as any);\n\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragmove', event as any);\n        }\n      }\n      lastMovePerPointer.set(event.pointerId, event);\n    }\n    return lastMovePerPointer;\n  }\n\n  private _processEnterLeaveAndEmit(entity: Entity, lastUpDownMoveEvents: PointerEvent[]) {\n    // up, down, and move are considered for enter and leave\n    for (const event of lastUpDownMoveEvents) {\n      // enter\n      if (event.active && entity.active && this.entered(entity, event.pointerId)) {\n        entity.events.emit('pointerenter', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragenter', event as any);\n        }\n        break;\n      }\n      if (event.active && entity.active &&\n          // leave can happen on move\n          (this.left(entity, event.pointerId) ||\n          // or leave can happen on pointer up\n          (this.entityCurrentlyUnderPointer(entity, event.pointerId) && event.type === 'up'))) {\n        entity.events.emit('pointerleave', event as any);\n        if (this._receiver.isDragging(event.pointerId)) {\n          entity.events.emit('pointerdragleave', event as any);\n        }\n        break;\n      }\n    }\n  }\n\n  private _processCancelAndEmit(entity: Entity) {\n    // cancel\n    for (const event of this._receiver.currentFrameCancel) {\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)){\n        entity.events.emit('pointercancel', event as any);\n      }\n    }\n  }\n\n  private _processWheelAndEmit(entity: Entity) {\n    // wheel\n    for (const event of this._receiver.currentFrameWheel) {\n      // Currently the wheel only fires under the primary pointer '0'\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, 0)) {\n        entity.events.emit('pointerwheel', event as any);\n      }\n    }\n  }\n\n  private _dispatchEvents(entities: Entity[]) {\n    const lastFrameEntities = new Set(this.lastFrameEntityToPointers.keys());\n    const currentFrameEntities = new Set(this.currentFrameEntityToPointers.keys());\n    // Filter preserves z order\n    const entitiesWithEvents = entities.filter(e => lastFrameEntities.has(e.id) || currentFrameEntities.has(e.id));\n    let lastMovePerPointer: Map<number, PointerEvent>;\n    let lastUpPerPointer: Map<number, PointerEvent>;\n    let lastDownPerPointer: Map<number, PointerEvent>;\n    // Dispatch events in entity z order\n    for (const entity of entitiesWithEvents) {\n      lastDownPerPointer = this._processDownAndEmit(entity);\n\n      lastUpPerPointer = this._processUpAndEmit(entity);\n\n      lastMovePerPointer = this._processMoveAndEmit(entity);\n\n      const lastUpDownMoveEvents = [\n        ...lastMovePerPointer.values(),\n        ...lastDownPerPointer.values(),\n        ...lastUpPerPointer.values()\n      ];\n      this._processEnterLeaveAndEmit(entity, lastUpDownMoveEvents);\n\n      this._processCancelAndEmit(entity);\n\n      this._processWheelAndEmit(entity);\n    }\n  }\n}","import { Entity } from '../EntityComponentSystem';\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\nimport { ActionsComponent } from './ActionsComponent';\n\n\nexport class ActionsSystem extends System<ActionsComponent> {\n  public readonly types = ['ex.actions'] as const;\n  systemType = SystemType.Update;\n  priority = -1;\n\n  private _actions: ActionsComponent[] = [];\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      this._actions.push(action);\n    } else {\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\n      const index = this._actions.indexOf(action);\n      if (index > -1) {\n        this._actions.splice(index, 1);\n      }\n    }\n  }\n\n  update(_entities: Entity[], delta: number): void {\n    for (const actions of this._actions) {\n      actions.update(delta);\n    }\n  }\n}","import { Component } from '../EntityComponentSystem/Component';\nimport { IsometricMap } from './IsometricMap';\n\nexport class IsometricEntityComponent extends Component<'ex.isometricentity'> {\n  public readonly type = 'ex.isometricentity';\n  /**\n   * Vertical \"height\" in the isometric world\n   */\n  public elevation: number = 0;\n\n  public map: IsometricMap;\n\n  /**\n   * Specify the isometric map to use to position this entity's z-index\n   * @param map\n   */\n  constructor(map: IsometricMap) {\n    super();\n    this.map = map;\n  }\n}","import { System, SystemType } from '../EntityComponentSystem/System';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\n\nexport class IsometricEntitySystem extends System<TransformComponent | IsometricEntityComponent> {\n  public readonly types = ['ex.transform', 'ex.isometricentity'] as const;\n  public readonly systemType = SystemType.Update;\n  priority: number = 99;\n  update(entities: Entity[], _delta: number): void {\n    let transform: TransformComponent;\n    let iso: IsometricEntityComponent;\n    for (const entity of entities) {\n      transform = entity.get(TransformComponent);\n      iso = entity.get(IsometricEntityComponent);\n\n      const maxZindexPerElevation = Math.max(iso.map.width * iso.map.tileWidth, iso.map.height * iso.map.tileHeight);\n\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\n      transform.z = newZ;\n    }\n  }\n}","import { GraphicsComponent } from './GraphicsComponent';\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\nimport { Scene } from '../Scene';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { TransformComponent, CoordPlane } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Camera } from '../Camera';\nimport { System, SystemType } from '../EntityComponentSystem/System';\n\nexport class OffscreenSystem extends System<TransformComponent | GraphicsComponent> {\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\n  public systemType = SystemType.Draw;\n  priority: number = -1;\n  private _camera: Camera;\n\n  public initialize(scene: Scene): void {\n    this._camera = scene.camera;\n  }\n\n  update(entities: Entity[]): void {\n    let transform: TransformComponent;\n    let graphics: GraphicsComponent;\n\n    for (const entity of entities) {\n      graphics = entity.get(GraphicsComponent);\n      transform = entity.get(TransformComponent);\n\n      // Figure out if entities are offscreen\n      const entityOffscreen = this._isOffscreen(transform, graphics);\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\n        entity.addTag('ex.offscreen');\n      }\n\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\n        entity.removeTag('ex.offscreen');\n      }\n    }\n  }\n\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      const transformedBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\n      const graphicsOffscreen = !this._camera.viewport.overlaps(transformedBounds);\n      return graphicsOffscreen;\n    } else {\n      // TODO screen coordinates\n      return false;\n    }\n  }\n\n}","\n\nexport enum ColorBlindnessMode {\n  Protanope = 'Protanope',\n  Deuteranope = 'Deuteranope',\n  Tritanope = 'Tritanope'\n}\n","/**\n * Determines the scope of handling mouse/touch events.\n */\n\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n","import { Logger } from '../Util/Log';\nimport { Class } from '../Class';\nimport * as Events from '../Events';\n\n/**\n * Enum representing physical input key codes\n */\nexport enum Keys {\n  // NUMPAD\n  Num0 = 'Numpad0',\n  Num1 = 'Numpad1',\n  Num2 = 'Numpad2',\n  Num3 = 'Numpad3',\n  Num4 = 'Numpad4',\n  Num5 = 'Numpad5',\n  Num6 = 'Numpad6',\n  Num7 = 'Numpad7',\n  Num8 = 'Numpad8',\n  Num9 = 'Numpad9',\n  NumAdd = 'NumpadAdd',\n  NumSubtract = 'NumpadSubtract',\n  NumMultiply = 'NumpadMultiply',\n  NumDivide = 'NumpadDivide',\n  // NumComma = 'NumpadComma', // not x-browser\n  NumDecimal = 'NumpadDecimal',\n  Numpad0 = 'Numpad0',\n  Numpad1 = 'Numpad1',\n  Numpad2 = 'Numpad2',\n  Numpad3 = 'Numpad3',\n  Numpad4 = 'Numpad4',\n  Numpad5 = 'Numpad5',\n  Numpad6 = 'Numpad6',\n  Numpad7 = 'Numpad7',\n  Numpad8 = 'Numpad8',\n  Numpad9 = 'Numpad9',\n  NumpadAdd = 'NumpadAdd',\n  NumpadSubtract = 'NumpadSubtract',\n  NumpadMultiply = 'NumpadMultiply',\n  NumpadDivide = 'NumpadDivide',\n  // NumpadComma = 'NumpadComma', // not x-browser\n  NumpadDecimal = 'NumpadDecimal',\n\n  // MODIFIERS\n  NumLock = 'NumLock',\n  ShiftLeft = 'ShiftLeft',\n  ShiftRight = 'ShiftRight',\n  AltLeft = 'AltLeft',\n  AltRight = 'AltRight',\n  ControlLeft = 'ControlLeft',\n  ControlRight = 'ControlRight',\n  MetaLeft = 'MetaLeft',\n  MetaRight = 'MetaRight',\n\n  // NUMBERS\n  Key0 = 'Digit0',\n  Key1 = 'Digit1',\n  Key2 = 'Digit2',\n  Key3 = 'Digit3',\n  Key4 = 'Digit4',\n  Key5 = 'Digit5',\n  Key6 = 'Digit6',\n  Key7 = 'Digit7',\n  Key8 = 'Digit8',\n  Key9 = 'Digit9',\n  Digit0 = 'Digit0',\n  Digit1 = 'Digit1',\n  Digit2 = 'Digit2',\n  Digit3 = 'Digit3',\n  Digit4 = 'Digit4',\n  Digit5 = 'Digit5',\n  Digit6 = 'Digit6',\n  Digit7 = 'Digit7',\n  Digit8 = 'Digit8',\n  Digit9 = 'Digit9',\n\n  // FUNCTION KEYS\n  F1 = 'F1',\n  F2 = 'F2',\n  F3 = 'F3',\n  F4 = 'F4',\n  F5 = 'F5',\n  F6 = 'F6',\n  F7 = 'F7',\n  F8 = 'F8',\n  F9 = 'F9',\n  F10 = 'F10',\n  F11 = 'F11',\n  F12 = 'F12',\n\n  // LETTERS\n  A = 'KeyA',\n  B = 'KeyB',\n  C = 'KeyC',\n  D = 'KeyD',\n  E = 'KeyE',\n  F = 'KeyF',\n  G = 'KeyG',\n  H = 'KeyH',\n  I = 'KeyI',\n  J = 'KeyJ',\n  K = 'KeyK',\n  L = 'KeyL',\n  M = 'KeyM',\n  N = 'KeyN',\n  O = 'KeyO',\n  P = 'KeyP',\n  Q = 'KeyQ',\n  R = 'KeyR',\n  S = 'KeyS',\n  T = 'KeyT',\n  U = 'KeyU',\n  V = 'KeyV',\n  W = 'KeyW',\n  X = 'KeyX',\n  Y = 'KeyY',\n  Z = 'KeyZ',\n  KeyA = 'KeyA',\n  KeyB = 'KeyB',\n  KeyC = 'KeyC',\n  KeyD = 'KeyD',\n  KeyE = 'KeyE',\n  KeyF = 'KeyF',\n  KeyG = 'KeyG',\n  KeyH = 'KeyH',\n  KeyI = 'KeyI',\n  KeyJ = 'KeyJ',\n  KeyK = 'KeyK',\n  KeyL = 'KeyL',\n  KeyM = 'KeyM',\n  KeyN = 'KeyN',\n  KeyO = 'KeyO',\n  KeyP = 'KeyP',\n  KeyQ = 'KeyQ',\n  KeyR = 'KeyR',\n  KeyS = 'KeyS',\n  KeyT = 'KeyT',\n  KeyU = 'KeyU',\n  KeyV = 'KeyV',\n  KeyW = 'KeyW',\n  KeyX = 'KeyX',\n  KeyY = 'KeyY',\n  KeyZ = 'KeyZ',\n\n  // SYMBOLS\n  Semicolon = 'Semicolon',\n  Quote = 'Quote',\n  Comma = 'Comma',\n  Minus = 'Minus',\n  Period = 'Period',\n  Slash = 'Slash',\n  Equal = 'Equal',\n  BracketLeft = 'BracketLeft',\n  Backslash = 'Backslash',\n  BracketRight = 'BracketRight',\n  Backquote = 'Backquote',\n\n  // DIRECTIONS\n  Up = 'ArrowUp',\n  Down = 'ArrowDown',\n  Left = 'ArrowLeft',\n  Right = 'ArrowRight',\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n\n  // OTHER\n  Space = 'Space',\n  Backspace = 'Backspace',\n  Delete = 'Delete',\n  Esc = 'Escape',\n  Escape = 'Escape',\n  Enter = 'Enter',\n  NumpadEnter = 'NumpadEnter',\n  ContextMenu = 'ContextMenu'\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends Events.GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   * @param value The key's typed value the browser detected\n   * @param originalEvent The original keyboard event that Excalibur handled\n   */\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n */\nexport class Keyboard extends Class {\n  private _keys: Keys[] = [];\n  private _keysUp: Keys[] = [];\n  private _keysDown: Keys[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    if (!global) {\n      try {\n        // Try and listen to events on top window frame if within an iframe.\n        //\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\n        //\n        // Attempt to add an event listener, which triggers a DOMException on\n        // cross-origin iframes\n        const noop = () => {\n          return;\n        };\n        window.top.addEventListener('blur', noop);\n        window.top.removeEventListener('blur', noop);\n\n        // this will be the same as window if not embedded within an iframe\n        global = window.top;\n      } catch {\n        // fallback to current frame\n        global = window;\n\n        Logger.getInstance().warn(\n          'Failed to bind to keyboard events to top frame. ' +\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\n        );\n      }\n    }\n\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', this._handleKeyUp);\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', this._handleKeyDown);\n  }\n\n  private _handleKeyDown = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    if (this._keys.indexOf(code) === -1) {\n      this._keys.push(code);\n      this._keysDown.push(code);\n      const keyEvent = new KeyEvent(code, ev.key, ev);\n      this.eventDispatcher.emit('down', keyEvent);\n      this.eventDispatcher.emit('press', keyEvent);\n    }\n  };\n\n  private _handleKeyUp = (ev: KeyboardEvent) => {\n    const code = ev.code as Keys;\n    const key = this._keys.indexOf(code);\n    this._keys.splice(key, 1);\n    this._keysUp.push(code);\n    const keyEvent = new KeyEvent(code, ev.key, ev);\n\n    // alias the old api, we may want to deprecate this in the future\n    this.eventDispatcher.emit('up', keyEvent);\n    this.eventDispatcher.emit('release', keyEvent);\n  };\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n\n  /**\n   * Trigger a manual key event\n   * @param type\n   * @param key\n   * @param character\n   */\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\n    if (type === 'down') {\n      this._handleKeyDown(new KeyboardEvent('keydown', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n    if (type === 'up') {\n      this._handleKeyUp(new KeyboardEvent('keyup', {\n        code: key,\n        key: character ?? null\n      }));\n    }\n  }\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n","/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n","/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n","/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n","import { ScreenElement } from './ScreenElement';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { SystemType } from './EntityComponentSystem/System';\nimport { obsolete } from './Util/Decorators';\nimport { World } from './EntityComponentSystem/World';\nimport { MotionSystem } from './Collision/MotionSystem';\nimport { CollisionSystem } from './Collision/CollisionSystem';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\nimport { Flags, Legacy } from './Flags';\nimport { DebugSystem } from './Debug/DebugSystem';\nimport { PointerSystem } from './Input/PointerSystem';\nimport { ActionsSystem } from './Actions/ActionsSystem';\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  private _logger: Logger = Logger.getInstance();\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera = new Camera();\n\n  /**\n   * The ECS world for the scene\n   */\n  public world = new World(this);\n\n  /**\n   * The actors in the current scene\n   */\n  public get actors(): Actor[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Actor;\n    }) as Actor[];\n  }\n\n  /**\n   * The entities in the current scene\n   */\n  public get entities(): Entity[] {\n    return this.world.entityManager.entities;\n  }\n\n  /**\n   * The triggers in the current scene\n   */\n  public get triggers(): Trigger[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof Trigger;\n    }) as Trigger[];\n  }\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public get tileMaps(): TileMap[] {\n    return this.world.entityManager.entities.filter((e) => {\n      return e instanceof TileMap;\n    }) as TileMap[];\n  }\n\n  /**\n   * Access to the Excalibur engine\n   */\n  public engine: Engine;\n\n  /**\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\n   * @deprecated Use [[Scene.actors]]\n   */\n  @obsolete({\n    message: 'Will be removed in excalibur v0.26.0',\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\n  })\n  public get screenElements(): ScreenElement[] {\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n  }\n\n  private _isInitialized: boolean = false;\n  private _timers: Timer[] = [];\n  public get timers(): readonly Timer[] {\n    return this._timers;\n  }\n  private _cancelQueue: Timer[] = [];\n\n  constructor() {\n    super();\n    // Initialize systems\n    this.world.add(new ActionsSystem());\n    this.world.add(new MotionSystem());\n    this.world.add(new CollisionSystem());\n    this.world.add(new PointerSystem());\n    this.world.add(new IsometricEntitySystem());\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\n      this.world.add(new CanvasDrawingSystem());\n    } else {\n      this.world.add(new OffscreenSystem());\n      this.world.add(new GraphicsSystem());\n    }\n    this.world.add(new DebugSystem());\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overridden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   *\n   * @deprecated Signature will change in v0.26.0\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.entities) {\n      child._initialize(this.engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.engine = engine;\n      // Initialize camera first\n      this.camera._initialize(engine);\n\n      this.world.systemManager.initialize();\n\n      // This order is important! we want to be sure any custom init that add actors\n      // fire before the actor init\n      this.onInitialize.call(this, engine);\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDeactivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n\n    // TODO differed entity removal for timers\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    this.world.update(SystemType.Update, delta);\n\n    // Camera last keeps renders smooth that are based on entity/actor\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   *\n   * @deprecated Signature will change in v0.26.0\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n\n    this.world.update(SystemType.Draw, delta);\n\n    if (this.engine?.isDebug) {\n      this.debugDraw(ctx);\n    }\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   * @deprecated Signature will change in v0.26.0\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n    // pass\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the scene.\n   * @param screenElement  The ScreenElement to add to the current scene\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    this.emit('entityadded', { target: entity } as any);\n    this.world.add(entity);\n    entity.scene = this;\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  public remove(entity: Entity): void;\n\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the current scene\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.emit('entityremoved', { target: entity } as any);\n      this.world.remove(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `ScreenElement` only?\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addScreenElement(actor: Actor) {\n    this.add(actor);\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeScreenElement(actor: Actor) {\n    this.remove(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   * @deprecated Use [[Scene.add]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\n  public addTileMap(tileMap: TileMap) {\n    this.world.add(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @deprecated Use [[Scene.remove]]\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\n  public removeTileMap(tileMap: TileMap) {\n    this.world.remove(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  public isCurrentScene(): boolean {\n    if (this.engine) {\n      return this.engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n    for (const _ui of screenElements) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isScreenElement(child as Actor)) {\n          // TODO not true\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { Shader } from '../Context/shader';\nimport { VertexBuffer } from '../Context/vertex-buffer';\nimport { VertexLayout } from '../Context/vertex-layout';\n\n/**\n * Helper that defines a whole screen renderer, just provide a fragment source!\n *\n * Currently supports 1 varying\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\n */\nexport class ScreenShader {\n  private _shader: Shader;\n  private _buffer: VertexBuffer;\n  private _layout: VertexLayout;\n  constructor(fragmentSource: string) {\n    this._shader = new Shader({\n      vertexSource: `\n      attribute vec2 a_position;\n      attribute vec2 a_texcoord;\n      varying vec2 v_texcoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        // Pass the texcoord to the fragment shader.\n        v_texcoord = a_texcoord;\n      }`,\n      fragmentSource: fragmentSource\n    });\n    this._shader.compile();\n    // Setup memory layout\n    this._buffer = new VertexBuffer({\n      type: 'static',\n      // clip space quad + uv since we don't need a camera\n      data: new Float32Array([\n        -1, -1,          0, 0,\n        -1, 1,           0, 1,\n        1, -1,           1, 0,\n\n        1, -1,            1, 0,\n        -1, 1,           0, 1,\n        1, 1,            1, 1\n      ])\n    });\n    this._layout = new VertexLayout({\n      shader: this._shader,\n      vertexBuffer: this._buffer,\n      attributes: [\n        ['a_position', 2],\n        ['a_texcoord', 2]\n      ]\n    });\n    this._buffer.upload();\n  }\n\n  public getShader() {\n    return this._shader;\n  }\n  public getLayout() {\n    return this._layout;\n  }\n}","import colorBlindCorrectSource from './color-blind-fragment.glsl';\nimport { PostProcessor } from './PostProcessor';\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\nimport { Shader } from '../Context/shader';\nimport { VertexLayout } from '../Context/vertex-layout';\nimport { ScreenShader } from './ScreenShader';\n\nexport class ColorBlindnessPostProcessor implements PostProcessor {\n  private _shader: ScreenShader;\n  private _simulate = false;\n  constructor(private _colorBlindnessMode: ColorBlindnessMode, simulate = false) {\n    this._simulate = simulate;\n  }\n\n  initialize(_gl: WebGLRenderingContext): void {\n    this._shader = new ScreenShader(colorBlindCorrectSource);\n    this.simulate = this._simulate;\n    this.colorBlindnessMode = this._colorBlindnessMode;\n  }\n\n  getShader(): Shader {\n    return this._shader.getShader();\n  }\n\n  getLayout(): VertexLayout {\n    return this._shader.getLayout();\n  }\n\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\n    this._colorBlindnessMode = colorBlindMode;\n    if (this._shader) {\n      const shader = this._shader.getShader();\n      shader.use();\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\n        shader.setUniformInt('u_type', 0);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\n        shader.setUniformInt('u_type', 1);\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\n        shader.setUniformInt('u_type', 2);\n      }\n    }\n  }\n\n  get colorBlindnessMode(): ColorBlindnessMode {\n    return this._colorBlindnessMode;\n  }\n\n  set simulate(value: boolean) {\n    this._simulate = value;\n    if (this._shader) {\n\n      const shader = this._shader.getShader();\n      shader.use();\n      shader.setUniformBoolean('u_simulate', value);\n    }\n  }\n\n  get simulate(): boolean {\n    return this._simulate;\n  }\n}\n","export default \"precision mediump float;\\n// our texture\\nuniform sampler2D u_image;\\n// the texCoords passed in from the vertex shader.\\nvarying vec2 v_texcoord;\\n\\n// color blind type\\nuniform int u_type;\\n\\n// simulation?\\nuniform bool u_simulate;\\n\\nvoid main() {\\n  vec4 o =  texture2D(u_image, v_texcoord);\\n  // RGB to LMS matrix conversion\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\n  // Simulate color blindness\\n  float l;\\n  float m;\\n  float s;\\n  //MODE CODE//\\n  if (u_type == 0) {\\n    // Protanope\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\n  } else if (u_type == 1) {\\n    // Deuteranope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\n  } else if (u_type == 2) {\\n    // Tritanope\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\n  }\\n\\n  // LMS to RGB matrix conversion\\n  vec4 error; // simulate the colors\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\n  error.a = 1.0;\\n  vec4 diff = o - error;\\n  vec4 correction; // correct the colors\\n  correction.r = 0.0;\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\n  correction = o + correction;\\n  correction.a = o.a;\\n  //SIMULATE//\\n\\n  // sim \\n  if (u_simulate) {\\n    gl_FragColor = error.rgba;\\n  } else {\\n    gl_FragColor = correction.rgba;\\n  }\\n}\";","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\nimport { Engine } from '../Engine';\nimport { ExcaliburGraphicsContextWebGL } from '..';\n\nexport interface DebugFlags {\n  colorBlindMode: ColorBlindFlags;\n}\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\n  }\n\n  /**\n   * Correct colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public correct(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = false;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Simulate colors for a specified color blindness\n   * @param colorBlindness\n   */\n  public simulate(colorBlindness: ColorBlindnessMode) {\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\n      this.clear();\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\n      this._colorBlindPostProcessor.simulate = true;\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\n    }\n  }\n\n  /**\n   * Remove color blindness post processor\n   */\n  public clear() {\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\n  }\n}\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\nimport { StandardClock, TestClock } from '..';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n\n  /**\n   * Graphics statistics\n   */\n  graphics: GraphicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisions\n   */\n  collisions: number;\n\n  /**\n   * Copy of the current frame contacts (only updated if debug is toggled on)\n   */\n  contacts: Map<string, CollisionContact>;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\nexport interface GraphicsStatistics {\n  drawCalls: number;\n  drawnImages: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  private _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[TestClock]] and return\n   * it in the same running state.\n   *\n   * This is useful when you need to debug frame by frame.\n   */\n  public useTestClock(): TestClock {\n    const clock = this._engine.clock;\n    const wasRunning = clock.isRunning();\n    clock.stop();\n\n    const testClock = clock.toTestClock();\n    if (wasRunning) {\n      testClock.start();\n    }\n    this._engine.clock = testClock;\n    return testClock;\n  }\n\n  /**\n   * Switch the current excalibur clock with the [[StandardClock]] and\n   * return it in the same running state.\n   *\n   * This is useful when you need to switch back to normal mode after\n   * debugging.\n   */\n  public useStandardClock(): StandardClock {\n    const currentClock = this._engine.clock;\n    const wasRunning = currentClock.isRunning();\n    currentClock.stop();\n\n    const standardClock = currentClock.toStandardClock();\n    if (wasRunning) {\n      standardClock.start();\n    }\n    this._engine.clock = standardClock;\n    return standardClock;\n  }\n\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n\n  /**\n   * Correct or simulate color blindness using [[ColorBlindnessPostProcessor]].\n   * @warning Will reduce FPS.\n   */\n  public colorBlindMode: ColorBlindFlags;\n\n  /**\n   * Filter debug context to named entities or entity ids\n   */\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\n    /**\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\n     */\n    useFilter: false,\n    /**\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\n     */\n    nameQuery: '',\n    /**\n     * Query for Entity ids, if the id matches it will be included\n     */\n    ids: []\n  };\n\n  /**\n   * Entity debug settings\n   */\n  public entity = {\n    showAll: false,\n    showId: true,\n    showName: false\n  };\n\n  /**\n   * Transform component debug settings\n   */\n  public transform = {\n    showAll: false,\n\n    showPosition: false,\n    showPositionLabel: false,\n    positionColor: Color.Yellow,\n\n    showZIndex: false,\n\n    showScale: false,\n    scaleColor: Color.Green,\n\n    showRotation: false,\n    rotationColor: Color.Blue\n  };\n\n  /**\n   * Graphics component debug settings\n   */\n  public graphics = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Yellow\n  };\n\n  /**\n   * Collider component debug settings\n   */\n  public collider = {\n    showAll: false,\n\n    showBounds: true,\n    boundsColor: Color.Blue,\n\n    showOwner: false,\n\n    showGeometry: true,\n    geometryColor: Color.Green\n  };\n\n  /**\n   * Physics simulation debug settings\n   */\n  public physics = {\n    showAll: false,\n\n    showBroadphaseSpacePartitionDebug: false,\n\n    showCollisionNormals: false,\n    collisionNormalColor: Color.Cyan,\n\n    showCollisionContacts: true,\n    collisionContactColor: Color.Red\n  };\n\n  /**\n   * Motion component debug settings\n   */\n  public motion = {\n    showAll: false,\n\n    showVelocity: false,\n    velocityColor: Color.Yellow,\n\n    showAcceleration: false,\n    accelerationColor: Color.Red\n  };\n\n  /**\n   * Body component debug settings\n   */\n  public body = {\n    showAll: false,\n\n    showCollisionGroup: false,\n    showCollisionType: false,\n    showSleeping: false,\n    showMotion: false,\n    showMass: false\n  };\n\n  /**\n   * Camera debug settings\n   */\n  public camera = {\n    showAll: false,\n\n    showFocus: false,\n    focusColor: Color.Red,\n\n    showZoom: false\n  };\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining() {\n      return this.alive - this.killed;\n    },\n    get total() {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total() {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  private _graphicsStats: GraphicsStatistics = {\n    drawCalls: 0,\n    drawnImages: 0\n  };\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n\n  /**\n   * Gets the frame's graphics statistics\n   */\n  public get graphics() {\n    return this._graphicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _contacts: Map<string, CollisionContact> = new Map();\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.contacts = otherStats.contacts;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.contacts.clear();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get contacts(): Map<string, CollisionContact> {\n    return this._contacts;\n  }\n\n  public set contacts(contacts: Map<string, CollisionContact>) {\n    this._contacts = contacts;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","export interface NativeEventable {\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\n}\n\nexport class BrowserComponent<T extends NativeEventable> {\n  private _paused = false;\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\n\n  on(eventName: string, handler: (evt: any) => void): void {\n    if (this._nativeHandlers[eventName]) {\n      this.off(eventName, this._nativeHandlers[eventName]);\n    }\n    this._nativeHandlers[eventName] = this._decorate(handler);\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n  }\n  off(eventName: string, handler?: (event: any) => void): void {\n    if (!handler) {\n      handler = this._nativeHandlers[eventName];\n    }\n    this.nativeComponent.removeEventListener(eventName, handler);\n    this._nativeHandlers[eventName] = null;\n  }\n\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\n    return (evt: any) => {\n      if (!this._paused) {\n        handler(evt);\n      }\n    };\n  }\n\n  public pause() {\n    this._paused = true;\n  }\n\n  public resume() {\n    this._paused = false;\n  }\n\n  public clear() {\n    for (const event in this._nativeHandlers) {\n      this.off(event);\n    }\n  }\n\n  constructor(public nativeComponent: T) {}\n}\n\nexport class BrowserEvents {\n  private _windowComponent: BrowserComponent<Window>;\n  private _documentComponent: BrowserComponent<Document>;\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\n  }\n\n  public get window(): BrowserComponent<Window> {\n    return this._windowComponent;\n  }\n\n  public get document(): BrowserComponent<Document> {\n    return this._documentComponent;\n  }\n\n  public pause() {\n    this.window.pause();\n    this.document.pause();\n  }\n\n  public resume() {\n    this.window.resume();\n    this.document.resume();\n  }\n\n  public clear() {\n    this.window.clear();\n    this.document.clear();\n  }\n}\n","import {\n  ExcaliburGraphicsContext,\n  LineGraphicsOptions,\n  PointGraphicsOptions,\n  ExcaliburGraphicsContextOptions,\n  DebugDraw,\n  HTMLImageSource\n} from './ExcaliburGraphicsContext';\nimport { Vector } from '../../Math/vector';\nimport { Color } from '../../Color';\nimport { StateStack } from './state-stack';\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\nimport { DebugText } from './debug-text';\nimport { Matrix } from '../../Math/matrix';\nimport { ScreenDimension } from '../../Screen';\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\n\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\n  private _debugText = new DebugText();\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\n  /**\n   * Draw a debug rectangle to the context\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  drawRect(x: number, y: number, width: number, height: number): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.strokeStyle = 'red';\n    this._ex.__ctx.strokeRect(\n      this._ex.snapToPixel ? ~~x : x,\n      this._ex.snapToPixel ? ~~y : y,\n      this._ex.snapToPixel ? ~~width : width,\n      this._ex.snapToPixel ? ~~height : height\n    );\n    this._ex.__ctx.restore();\n  }\n\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\n    this._ex.__ctx.lineWidth = 2;\n    this._ex.__ctx.stroke();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\n    this._ex.__ctx.save();\n    this._ex.__ctx.beginPath();\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\n    this._ex.__ctx.arc(\n      this._ex.snapToPixel ? ~~point.x : point.x,\n      this._ex.snapToPixel ? ~~point.y : point.y,\n      pointOptions.size,\n      0,\n      Math.PI * 2\n    );\n    this._ex.__ctx.fill();\n    this._ex.__ctx.closePath();\n    this._ex.__ctx.restore();\n  }\n\n  drawText(text: string, pos: Vector) {\n    this._debugText.write(this._ex, text, pos);\n  }\n}\n\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\n  /**\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\n   * @internal\n   */\n  public __ctx: CanvasRenderingContext2D;\n  public get width() {\n    return this.__ctx.canvas.width;\n  }\n\n  public get height() {\n    return this.__ctx.canvas.height;\n  }\n\n  public backgroundColor: Color = Color.ExcaliburBlue;\n\n  private _state = new StateStack();\n\n  public get opacity(): number {\n    return this._state.current.opacity;\n  }\n\n  public set opacity(value: number) {\n    this._state.current.opacity = value;\n  }\n\n  public snapToPixel: boolean = true;\n\n  public get smoothing(): boolean {\n    return this.__ctx.imageSmoothingEnabled;\n  }\n\n  public set smoothing(value: boolean) {\n    this.__ctx.imageSmoothingEnabled = value;\n  }\n\n  constructor(options: ExcaliburGraphicsContextOptions) {\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\n    this.__ctx = canvasElement.getContext('2d', {\n      alpha: enableTransparency ?? true\n    });\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\n    this.smoothing = smoothing ?? this.smoothing;\n  }\n\n  public resetTransform(): void {\n    this.__ctx.resetTransform();\n  }\n\n  public updateViewport(_resolution: ScreenDimension): void {\n    // pass\n  }\n\n  /**\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\n   */\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\n  /**\n   *\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\n   */\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void;\n\n  drawImage(\n    image: HTMLImageSource,\n    sx: number,\n    sy: number,\n    swidth?: number,\n    sheight?: number,\n    dx?: number,\n    dy?: number,\n    dwidth?: number,\n    dheight?: number\n  ): void {\n    if (swidth === 0 || sheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (dwidth === 0 || dheight === 0) {\n      return; // zero dimension dest exit early\n    } else if (image.width === 0 || image.height === 0) {\n      return; // zero dimension source exit early\n    }\n\n    this.__ctx.globalAlpha = this.opacity;\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\n      .filter((a) => a !== undefined)\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\n    this.__ctx.drawImage.apply(this.__ctx, args);\n    GraphicsDiagnostics.DrawCallCount++;\n    GraphicsDiagnostics.DrawnImagesCount = 1;\n  }\n\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    this.__ctx.strokeStyle = color.toString();\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\n    this.__ctx.lineWidth = thickness;\n    this.__ctx.stroke();\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\n    this.__ctx.save();\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.fillRect(\n      this.snapToPixel ? ~~pos.x : pos.x,\n      this.snapToPixel ? ~~pos.y : pos.y,\n      this.snapToPixel ? ~~width : width,\n      this.snapToPixel ? ~~height : height\n    );\n    this.__ctx.restore();\n  }\n\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\n    this.__ctx.save();\n    this.__ctx.beginPath();\n    if (stroke) {\n      this.__ctx.strokeStyle = stroke.toString();\n    }\n    if (thickness) {\n      this.__ctx.lineWidth = thickness;\n    }\n    this.__ctx.fillStyle = color.toString();\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\n    this.__ctx.fill();\n    if (stroke) {\n      this.__ctx.stroke();\n    }\n    this.__ctx.closePath();\n    this.__ctx.restore();\n  }\n\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\n\n  /**\n   * Save the current state of the canvas to the stack (transforms and opacity)\n   */\n  save(): void {\n    this.__ctx.save();\n  }\n\n  /**\n   * Restore the state of the canvas from the stack\n   */\n  restore(): void {\n    this.__ctx.restore();\n  }\n\n  /**\n   * Translate the origin of the context by an x and y\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number): void {\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\n  }\n\n  /**\n   * Rotate the context about the current origin\n   */\n  rotate(angle: number): void {\n    this.__ctx.rotate(angle);\n  }\n\n  /**\n   * Scale the context by an x and y factor\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number): void {\n    this.__ctx.scale(x, y);\n  }\n\n  public getTransform(): Matrix {\n    throw new Error('Not implemented');\n  }\n\n  public multiply(_m: Matrix): void {\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\n  }\n\n  public addPostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public removePostProcessor(_postprocessor: PostProcessor) {\n    throw Error('Not implemented');\n  }\n\n  public clearPostProcessors() {\n    throw Error('Not implemented');\n  }\n\n  public beginDrawLifecycle() {\n    // pass\n  }\n\n  public endDrawLifecycle() {\n    // pass\n  }\n\n  clear(): void {\n    // Clear frame\n    this.__ctx.clearRect(0, 0, this.width, this.height);\n    this.__ctx.fillStyle = this.backgroundColor.toString();\n    this.__ctx.fillRect(0, 0, this.width, this.height);\n    GraphicsDiagnostics.clear();\n  }\n\n  /**\n   * Flushes the batched draw calls to the screen\n   */\n  flush(): void {\n    // pass\n  }\n}\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { GlobalCoordinates } from '../Math/global-coordinates';\nimport { Vector } from '../Math/vector';\nimport { PointerButton } from './PointerButton';\nimport { PointerType } from './PointerType';\n\nexport class PointerEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n\n  get pagePos(): Vector {\n    return this.coordinates.pagePos;\n  }\n\n  get screenPos(): Vector {\n    return this.coordinates.screenPos;\n  }\n\n  get worldPos(): Vector {\n    return this.coordinates.worldPos;\n  }\n\n  constructor(\n    public type: 'down' | 'up' | 'move' | 'cancel',\n    public pointerId: number,\n    public button: PointerButton,\n    public pointerType: PointerType,\n    public coordinates: GlobalCoordinates,\n    public nativeEvent: Event) { };\n}\n","import { WheelDeltaMode } from './WheelDeltaMode';\n\n\nexport class WheelEvent {\n  public active = true;\n  public cancel() {\n    this.active = false;\n  }\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: Event\n  ) { }\n}\n","import { Class } from '../Class';\nimport { Vector } from '../Math/vector';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerEvent } from './PointerEvent';\n\nexport class PointerAbstraction extends Class {\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = Vector.Zero;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = Vector.Zero;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = Vector.Zero;\n\n  constructor() {\n    super();\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  private _onPointerMove = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n\n  private _onPointerDown = (ev: PointerEvent): void => {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  };\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { GlobalCoordinates } from '../Math/global-coordinates';\nimport { vec, Vector } from '../Math/vector';\nimport { PointerEvent } from './PointerEvent';\nimport { WheelEvent } from './WheelEvent';\nimport { PointerAbstraction } from './PointerAbstraction';\n\nimport { WheelDeltaMode } from './WheelDeltaMode';\nimport { PointerSystem } from './PointerSystem';\nimport { NativePointerButton } from './NativePointerButton';\nimport { PointerButton } from './PointerButton';\nimport { Util } from '..';\nimport { PointerType } from './PointerType';\n\n\nexport type NativePointerEvent = globalThis.PointerEvent;\nexport type NativeMouseEvent = globalThis.MouseEvent;\nexport type NativeTouchEvent = globalThis.TouchEvent;\nexport type NativeWheelEvent = globalThis.WheelEvent;\n\n/**\n * Is this event a native touch event?\n */\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\n}\n\n/**\n * Is this event a native pointer event\n */\nfunction isPointerEvent(value: any): value is NativePointerEvent {\n  // Guard for Safari <= 13.1\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\n}\n\n/**\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\n */\nexport class PointerEventReceiver extends Class {\n  public primary: PointerAbstraction = new PointerAbstraction();\n\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\n\n  public currentFramePointerDown = new Map<number, boolean>();\n  public lastFramePointerDown = new Map<number, boolean>();\n\n  public currentFrameDown: PointerEvent[] = [];\n  public currentFrameUp: PointerEvent[] = [];\n  public currentFrameMove: PointerEvent[] = [];\n  public currentFrameCancel: PointerEvent[] = [];\n  public currentFrameWheel: WheelEvent[] = [];\n\n  constructor(public readonly target: GlobalEventHandlers & EventTarget, public engine: Engine) {\n    super();\n  }\n\n  private _pointers: PointerAbstraction[] = [this.primary];\n  /**\n   * Locates a specific pointer by id, creates it if it doesn't exist\n   * @param index\n   */\n  public at(index: number): PointerAbstraction {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new PointerAbstraction());\n      }\n    }\n    return this._pointers[index];\n  }\n\n  /**\n   * The number of pointers currently being tracked by excalibur\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  /**\n   * Is the specified pointer id down this frame\n   * @param pointerId\n   */\n  public isDown(pointerId: number) {\n    return this.currentFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Was the specified pointer id down last frame\n   * @param pointerId\n   */\n  public wasDown(pointerId: number) {\n    return this.lastFramePointerDown.get(pointerId) ?? false;\n  }\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public isDragging(pointerId: number): boolean {\n    return this.isDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public isDragStart(pointerId: number): boolean {\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public isDragEnd(pointerId: number): boolean {\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\n  }\n\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Called internally by excalibur\n   *\n   * Updates the current frame pointer info and emits raw pointer events\n   *\n   * This does not emit events to entities, see PointerSystem\n   */\n  public update() {\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\n\n    for (const event of this.currentFrameDown) {\n      this.emit('down', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('down', event);\n      this.primary.emit('pointerdown', event);\n    }\n\n    for (const event of this.currentFrameUp) {\n      this.emit('up', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('up', event);\n    }\n\n    for (const event of this.currentFrameMove) {\n      this.emit('move', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('move', event);\n    }\n\n    for (const event of this.currentFrameCancel) {\n      this.emit('cancel', event);\n      const pointer = this.at(event.pointerId);\n      pointer.emit('cancel', event);\n    }\n\n    for (const event of this.currentFrameWheel) {\n      this.emit('wheel', event);\n      this.primary.emit('pointerwheel', event);\n    }\n  }\n\n  /**\n   * Clears the current frame event and pointer data\n   */\n  public clear() {\n    for (const event of this.currentFrameUp) {\n      this.currentFramePointerCoords.delete(event.pointerId);\n      const ids = this._activeNativePointerIdsToNormalized.entries();\n      for (const [native, normalized] of ids) {\n        if (normalized === event.pointerId) {\n          this._activeNativePointerIdsToNormalized.delete(native);\n        }\n      }\n    }\n    this.currentFrameDown.length = 0;\n    this.currentFrameUp.length = 0;\n    this.currentFrameMove.length = 0;\n    this.currentFrameCancel.length = 0;\n    this.currentFrameWheel.length = 0;\n  }\n\n  private _boundHandle = this._handle.bind(this);\n  private _boundWheel = this._handleWheel.bind(this);\n  /**\n   * Initializes the pointer event receiver so that it can start listening to native\n   * browser events.\n   */\n  public init() {\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\n    // It is important on mobile to have touch action 'none'\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\n    if (this.target === this.engine.canvas) {\n      this.engine.canvas.style.touchAction = 'none';\n    } else {\n      document.body.style.touchAction = 'none';\n    }\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.addEventListener('pointerdown', this._boundHandle);\n      this.target.addEventListener('pointerup', this._boundHandle);\n      this.target.addEventListener('pointermove', this._boundHandle);\n      this.target.addEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.addEventListener('touchstart', this._boundHandle);\n      this.target.addEventListener('touchend', this._boundHandle);\n      this.target.addEventListener('touchmove', this._boundHandle);\n      this.target.addEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.addEventListener('mousedown', this._boundHandle);\n      this.target.addEventListener('mouseup', this._boundHandle);\n      this.target.addEventListener('mousemove', this._boundHandle);\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\n    }\n  }\n\n  public detach() {\n    // Preferred pointer events\n    if (window.PointerEvent) {\n      this.target.removeEventListener('pointerdown', this._boundHandle);\n      this.target.removeEventListener('pointerup', this._boundHandle);\n      this.target.removeEventListener('pointermove', this._boundHandle);\n      this.target.removeEventListener('pointercancel', this._boundHandle);\n    } else {\n      // Touch Events\n      this.target.removeEventListener('touchstart', this._boundHandle);\n      this.target.removeEventListener('touchend', this._boundHandle);\n      this.target.removeEventListener('touchmove', this._boundHandle);\n      this.target.removeEventListener('touchcancel', this._boundHandle);\n\n      // Mouse Events\n      this.target.removeEventListener('mousedown', this._boundHandle);\n      this.target.removeEventListener('mouseup', this._boundHandle);\n      this.target.removeEventListener('mousemove', this._boundHandle);\n    }\n\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      this.target.removeEventListener('wheel', this._boundWheel);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      this.target.addEventListener('mousewheel', this._boundWheel);\n    } else {\n      // Remaining browser and older Firefox\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\n    }\n  }\n\n  /**\n   * Take native pointer id and map it to index in active pointers\n   * @param nativePointerId\n   */\n  private _normalizePointerId(nativePointerId: number) {\n    // Add to the the native pointer set id\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\n\n    // Native pointer ids in ascending order\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\n\n    // The index into sorted ids will be the new id, will always have an id\n    const id = currentPointerIds.findIndex(p => p === nativePointerId);\n\n    // Save the mapping so we can reverse it later\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\n\n    // ignore pointer because game isn't watching\n    return id;\n  }\n\n  /**\n   * Responsible for handling and parsing pointer events\n   */\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\n    ev.preventDefault();\n    const eventCoords = new Map<number, GlobalCoordinates>();\n    let button: PointerButton;\n    let pointerType: PointerType;\n    if (isTouchEvent(ev)) {\n      button = PointerButton.Unknown;\n      pointerType = PointerType.Touch;\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\n      for (let i = 0; i < ev.changedTouches.length; i++) {\n        const touch = ev.changedTouches[i];\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\n        const nativePointerId = i + 1;\n        const pointerId = this._normalizePointerId(nativePointerId);\n        this.currentFramePointerCoords.set(pointerId, coordinates);\n        eventCoords.set(pointerId, coordinates);\n      }\n    } else {\n      button = this._nativeButtonToPointerButton(ev.button);\n      pointerType = PointerType.Mouse;\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\n      let nativePointerId = 1;\n      if (isPointerEvent(ev)) {\n        nativePointerId = ev.pointerId;\n        pointerType = this._stringToPointerType(ev.pointerType);\n      }\n      const pointerId = this._normalizePointerId(nativePointerId);\n      this.currentFramePointerCoords.set(pointerId, coordinates);\n      eventCoords.set(pointerId, coordinates);\n    }\n\n    for (const [pointerId, coord] of eventCoords.entries()) {\n      switch (ev.type) {\n        case 'mousedown':\n        case 'pointerdown':\n        case 'touchstart':\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, true);\n          break;\n        case 'mouseup':\n        case 'pointerup':\n        case 'touchend':\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\n          this.currentFramePointerDown.set(pointerId, false);\n          break;\n        case 'mousemove':\n        case 'pointermove':\n        case 'touchmove':\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\n          break;\n        case 'touchcancel':\n        case 'pointercancel':\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\n          break;\n      }\n    }\n  }\n\n  private _handleWheel(ev: NativeWheelEvent) {\n    // Should we prevent page scroll because of this event\n    if (\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\n    ) {\n      ev.preventDefault();\n    }\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\n\n    /**\n     * A constant used to normalize wheel events across different browsers\n     *\n     * This normalization factor is pulled from\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n     */\n    const ScrollWheelNormalizationFactor = -1 / 40;\n\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n    const deltaY =\n        ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\n    const deltaZ = ev.deltaZ || 0;\n    let deltaMode = WheelDeltaMode.Pixel;\n\n    if (ev.deltaMode) {\n      if (ev.deltaMode === 1) {\n        deltaMode = WheelDeltaMode.Line;\n      } else if (ev.deltaMode === 2) {\n        deltaMode = WheelDeltaMode.Page;\n      }\n    }\n\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\n    this.currentFrameWheel.push(we);\n  }\n\n  /**\n   * Triggers an excalibur pointer event in a world space pos\n   *\n   * Useful for testing pointers in excalibur\n   * @param type\n   * @param pos\n   */\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\n    const page = this.engine.screen.worldToPageCoordinates(pos);\n    // Send an event to the event receiver\n    if (window.PointerEvent) {\n      this._handle(new window.PointerEvent('pointer' + type, {\n        pointerId: 0,\n        clientX: page.x,\n        clientY: page.y\n      }));\n    } else {\n      // Safari hack\n      this._handle(new window.MouseEvent('mouse' + type, {\n        clientX: page.x,\n        clientY: page.y\n      }));\n    }\n\n    // Force update pointer system\n    const pointerSystem = this.engine.currentScene.world.systemManager.get(PointerSystem);\n    const transformEntities = this.engine.currentScene.world.queryManager.createQuery(pointerSystem.types);\n    pointerSystem.update(transformEntities.getEntities());\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}","export interface FpsSamplerOptions {\n  /**\n   * Specify the sampling period in milliseconds (default 100)\n   */\n  samplePeriod?: number;\n  /**\n   * Specify the initial FPS\n   */\n  initialFps: number;\n\n  /**\n   * Specify the function used to return the current time (in milliseconds)\n   */\n  nowFn: () => number;\n}\n\nexport class FpsSampler {\n  private _fps: number;\n  private _samplePeriod: number = 100;\n  private _currentFrameTime: number = 0;\n  private _frames: number = 0;\n  private _previousSampleTime: number = 0;\n  private _beginFrameTime: number = 0;\n  private _nowFn: () => number;\n\n  constructor(options: FpsSamplerOptions) {\n    this._fps = options.initialFps;\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\n    this._currentFrameTime = 1000/options.initialFps;\n    this._nowFn = options.nowFn;\n    this._previousSampleTime = this._nowFn();\n  }\n\n  /**\n   * Start of code block to sample FPS for\n   */\n  start() {\n    this._beginFrameTime = this._nowFn();\n  }\n\n  /**\n   * End of code block to sample FPS for\n   */\n  end() {\n    this._frames++;\n    const time = this._nowFn();\n\n    this._currentFrameTime = time - this._beginFrameTime;\n\n    if (time >= this._previousSampleTime + this._samplePeriod) {\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\n      this._previousSampleTime = time;\n      this._frames = 0;\n    }\n  }\n\n  /**\n   * Return the currently sampled fps over the last sample period, by default every 100ms\n   */\n  get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\n   */\n  get instant() {\n    return 1000 / this._currentFrameTime;\n  }\n}","import { Logger } from '..';\nimport { FpsSampler } from './Fps';\n\nexport interface ClockOptions {\n  /**\n   * Define the function you'd like the clock to tick when it is started\n   */\n  tick: (elapsedMs: number) => any;\n  /**\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\n   */\n  onFatalException?: (e: unknown) => any;\n  /**\n   * Optionally limit the maximum FPS of the clock\n   */\n  maxFps?: number;\n}\n\n\n/**\n * Abstract Clock is the base type of all Clocks\n *\n * It has a few opinions\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\n * 2. The default timing api is implemented in now()\n *\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\n * method is unique to your clock implementation.\n */\nexport abstract class Clock {\n  protected tick: (elapsedMs: number) => any;\n  private _onFatalException: (e: unknown) => any = () => { /* default nothing */ };\n  private _maxFps: number = Infinity;\n  private _lastTime: number = 0;\n  public fpsSampler: FpsSampler;\n  private _options: ClockOptions;\n  private _elapsed: number = 1;\n  private _scheduledCbs: [cb: () => any, scheduledTime: number][] = [];\n  private _totalElapsed: number = 0;\n  constructor(options: ClockOptions) {\n    this._options = options;\n    this.tick = options.tick;\n    this._lastTime = this.now() ?? 0;\n    this._maxFps = options.maxFps ?? this._maxFps;\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\n    this.fpsSampler = new FpsSampler({\n      initialFps: 60,\n      nowFn: () => this.now()\n    });\n  }\n\n  /**\n   * Get the elapsed time for the last completed frame\n   */\n  public elapsed(): number {\n    return this._elapsed;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public now(): number {\n    return performance.now();\n  }\n\n  public toTestClock() {\n    const testClock = new TestClock({\n      ...this._options,\n      defaultUpdateMs: 16.6\n    });\n    return testClock;\n  }\n\n  public toStandardClock() {\n    const clock = new StandardClock({\n      ...this._options\n    });\n    return clock;\n  }\n\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\n    this._onFatalException = handler;\n  }\n\n  /**\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur [[Clock]]\n   *\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\n   * stopped or paused.\n   *\n   * @param cb callback to fire\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\n   */\n  public schedule(cb: () => any, timeoutMs: number = 0) {\n    const scheduledTime = this.now() + timeoutMs;\n    this._scheduledCbs.push([cb, scheduledTime]);\n  }\n\n  private _runScheduledCbs() {\n    // walk backwards to delete items as we loop\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\n      if (this._scheduledCbs[i][1] <= this._totalElapsed) {\n        this._scheduledCbs[i][0]();\n        this._scheduledCbs.splice(i, 1);\n      }\n    }\n  }\n\n  protected update(overrideUpdateMs?: number): void {\n    try {\n      this.fpsSampler.start();\n      // Get the time to calculate time-elapsed\n      const now = this.now();\n      let elapsed = now - this._lastTime || 1; // first frame\n\n      // Constrain fps\n      const fpsInterval = (1000 / this._maxFps);\n\n      // only run frame if enough time has elapsed\n      if (elapsed >= fpsInterval) {\n        let leftover = 0;\n        if (fpsInterval !== 0) {\n          leftover = (elapsed % fpsInterval);\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n\n        // tick the mainloop and run scheduled callbacks\n        this._elapsed = overrideUpdateMs || elapsed;\n        this._totalElapsed += this._elapsed;\n        this._runScheduledCbs();\n        this.tick(overrideUpdateMs || elapsed);\n\n        if (fpsInterval !== 0) {\n          this._lastTime = now - leftover;\n        } else {\n          this._lastTime = now;\n        }\n        this.fpsSampler.end();\n      }\n    } catch (e) {\n      this._onFatalException(e);\n      this.stop();\n    }\n  }\n\n  /**\n   * Returns if the clock is currently running\n   */\n  public abstract isRunning(): boolean;\n\n  /**\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\n   */\n  public abstract start(): void;\n\n  /**\n   * Stop the clock, tick() is no longer called\n   */\n  public abstract stop(): void;\n}\n\n\n/**\n * The [[StandardClock]] implements the requestAnimationFrame browser api to run the tick()\n */\nexport class StandardClock extends Clock {\n\n  private _running = false;\n  private _requestId: number;\n  constructor(options: ClockOptions) {\n    super(options);\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n\n  public start(): void {\n    if (this._running) {\n      return;\n    }\n    this._running = true;\n    const mainloop = () => {\n      // stop the loop\n      if (!this._running) {\n        return;\n      }\n      try {\n        // request next loop\n        this._requestId = window.requestAnimationFrame(mainloop);\n        this.update();\n      } catch (e) {\n        window.cancelAnimationFrame(this._requestId);\n        throw e;\n      }\n    };\n\n    // begin the first frame\n    mainloop();\n  }\n\n  public stop(): void {\n    this._running = false;\n  }\n}\n\nexport interface TestClockOptions {\n  /**\n   * Specify the update milliseconds to use for each manual step()\n   */\n  defaultUpdateMs: number;\n}\n\n/**\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\n */\nexport class TestClock extends Clock {\n  private _logger = Logger.getInstance();\n  private _updateMs: number;\n  private _running: boolean = false;\n  private _currentTime = 0;\n  constructor(options: ClockOptions & TestClockOptions) {\n    super({\n      ...options\n    });\n    this._updateMs = options.defaultUpdateMs;\n  }\n\n  /**\n   * Get the current time in milliseconds\n   */\n  public override now() {\n    return this._currentTime ?? 0;\n  }\n\n  public isRunning(): boolean {\n    return this._running;\n  }\n  public start(): void {\n    this._running = true;\n  }\n  public stop(): void {\n    this._running = false;\n  }\n\n  /**\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\n   * @param overrideUpdateMs\n   */\n  step(overrideUpdateMs?: number): void {\n    const time = overrideUpdateMs ?? this._updateMs;\n\n    if (this._running) {\n      // to be comparable to RAF this needs to be a full blown Task\n      // For example, images cannot decode synchronously in a single step\n      this.update(time);\n      this._currentTime += time;\n    } else {\n      this._logger.warn('The clock is not running, no step will be performed');\n    }\n  }\n\n  /**\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\n   * @param numberOfSteps\n   * @param overrideUpdateMs\n   */\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\n    for (let i = 0; i < numberOfSteps; i++) {\n      this.step(overrideUpdateMs ?? this._updateMs);\n    }\n  }\n}","import { EX_VERSION } from './';\nimport { Flags, Legacy } from './Flags';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Vector } from './Math/vector';\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\nimport { ScreenElement } from './ScreenElement';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Color';\nimport { Scene } from './Scene';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { Debug, DebugStats } from './Debug/Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Events from './Events';\nimport { BrowserEvents } from './Util/Browser';\nimport { obsolete } from './Util/Decorators';\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL, TextureLoader } from './Graphics';\nimport { PointerEventReceiver } from './Input/PointerEventReceiver';\nimport { FpsSampler } from './Util/Fps';\nimport { Clock, StandardClock } from './Util/Clock';\nimport { ImageFiltering } from './Graphics/Filtering';\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the width of the viewport in css pixels\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the height of the viewport in css pixels\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the width & height of the viewport in css pixels.\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\n   */\n  viewport?: ScreenDimension;\n\n  /**\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\n   * See [[Resolution]] for common presets.\n   */\n  resolution?: ScreenDimension;\n\n  /**\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\n   *\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\n   * with [[ImageFiltering.Blended]]\n   *\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\n   * with [[ImageFiltering.Pixel]]\n   */\n  antialiasing?: boolean;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * Optionally specify the target canvas DOM element directly\n   */\n  canvasElement?: HTMLCanvasElement;\n\n  /**\n   * Optionally snap drawings to nearest pixel\n   */\n  snapToPixel?: boolean;\n\n  /**\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\n   * Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  maxFps?: number;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   * Excalibur browser events abstraction used for wiring to native browser events safely\n   */\n  public browser: BrowserEvents;\n\n  /**\n   * Screen abstraction\n   */\n  public screen: Screen;\n\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   * @deprecated Will be removed in v0.26.0, use Engine.graphicsContext\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\n   */\n  public graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\n   *\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\n   * one that bounces between 30fps and 60fps\n   */\n  public maxFps: number = Number.POSITIVE_INFINITY;\n\n  /**\n   * Direct access to the excalibur clock\n   */\n  public clock: Clock;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.screen.canvasWidth;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.screen.halfCanvasWidth;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.screen.canvasHeight;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.screen.halfCanvasHeight;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    return this.screen.drawWidth;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.screen.halfDrawWidth;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    return this.screen.drawHeight;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.screen.halfDrawHeight;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.screen.isHiDpi;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   *\n   * Useful when you want to debug different aspects of built in engine features like\n   *   * Transform\n   *   * Graphics\n   *   * Colliders\n   */\n  public debug: Debug;\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public readonly rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public readonly scenes: { [key: string]: Scene } = {};\n\n  /**\n   * @hidden\n   * @deprecated will be removed in v0.26.0\n   */\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public get isFullscreen(): boolean {\n    return this.screen.isFullScreen;\n  }\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public get displayMode(): DisplayMode {\n    return this.screen.displayMode;\n  }\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    return this.screen.pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   * @deprecated will be removed in v0.26.0\n   */\n  public position: string | AbsolutePosition;\n\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  private _isDebug: boolean = false;\n  public get isDebug(): boolean {\n    return this._isDebug;\n  }\n\n  /**\n   * No longer used\n   * @deprecated will be removed in v0.26.0\n   */\n  public debugColor: Color = new Color(255, 255, 255);\n\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * Hints the graphics context to truncate fractional world space coordinates\n   */\n  public get snapToPixel(): boolean {\n    return this.graphicsContext.snapToPixel;\n  };\n\n  public set snapToPixel(shouldSnapToPixel: boolean) {\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\n  };\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: Loader;\n\n  private _isInitialized: boolean = false;\n\n  private _deferredGoTo: string = null;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    canvasElement: undefined,\n    snapToPixel: false,\n    pointerScope: Input.PointerScope.Canvas,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\n\n    Flags.freeze();\n\n    // Initialize browser events facade\n    this.browser = new BrowserEvents(window, document);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function (test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    // eslint-disable-next-line no-console\n    if (console.log && !options.suppressConsoleBootMessage) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      // eslint-disable-next-line no-console\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      // eslint-disable-next-line no-console\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else if (options.canvasElement) {\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\n      this.canvas = options.canvasElement;\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\n    if ((options.width && options.height) || options.viewport) {\n      if (options.displayMode === undefined) {\n        displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fit');\n      displayMode = DisplayMode.FitScreen;\n    }\n\n    if (Flags.isEnabled(Legacy.Canvas)) {\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = ex2dCtx;\n      this.ctx = ex2dCtx.__ctx;\n    } else {\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\n        canvasElement: this.canvas,\n        enableTransparency: this.enableCanvasTransparency,\n        smoothing: options.antialiasing,\n        backgroundColor: options.backgroundColor,\n        snapToPixel: options.snapToPixel\n      });\n      this.graphicsContext = exWebglCtx;\n      this.ctx = exWebglCtx.__ctx;\n    }\n\n    this.screen = new Screen({\n      canvas: this.canvas,\n      context: this.graphicsContext,\n      antialiasing: options.antialiasing ?? true,\n      browser: this.browser,\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\n      resolution: options.resolution,\n      displayMode,\n      position: options.position,\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\n    });\n\n    TextureLoader.filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.maxFps = options.maxFps ?? this.maxFps;\n\n    this.clock = new StandardClock({\n      maxFps: this.maxFps,\n      tick: this._mainloop.bind(this),\n      onFatalException: (e) => this.onFatalException(e)\n    });\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n    this._loader.wireEngine(this);\n    this.debug = new Debug(this);\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene();\n\n    this.addScene('root', this.rootScene);\n    (window as any).___EXCALIBUR_DEVTOOL = this;\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    return this.screen.getWorldBounds();\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   * @deprecated\n   */\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  public add(entity: Entity): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\n   * ScreenElements do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n      return;\n    }\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\n      this.scenes[this._deferredGoTo].add(entity);\n    } else {\n      this.currentScene.add(entity);\n    }\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Entity) {\n      this.currentScene.remove(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string): void {\n    // if not yet initialized defer goToScene\n    if (!this.isInitialized) {\n      this._deferredGoTo = key;\n      return;\n    }\n\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n      this.screen.setCurrentCamera(newScene.camera);\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    return this.screen.screenToWorldCoordinates(point);\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    return this.screen.worldToScreenCoordinates(point);\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // initialize inputs\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new PointerEventReceiver(pointerTarget, this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init();\n    this.input.gamepads.init();\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    this.browser.document.on(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    if (!this.canvasElementId && !options.canvasElement) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this.screen.antialiasing = isSmooth;\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    return this.screen.antialiasing;\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n      if (this._deferredGoTo) {\n        this.goToScene(this._deferredGoTo);\n      } else {\n        this.goToScene('root');\n      }\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (!this.ready) {\n      // suspend updates until loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.gamepads.update();\n      return;\n    }\n\n\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    // TODO remove\n    this._animations = this._animations.filter(function (a) {\n      return !a.animation.isDone();\n    });\n\n    // Publish update event\n    this._postupdate(delta);\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.gamepads.update();\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this.graphicsContext.beginDrawLifecycle();\n    this.graphicsContext.clear();\n    this._predraw(ctx, delta);\n\n    // Drawing nothing else while loading\n    if (!this._isReady) {\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\n      this.graphicsContext.flush();\n      return;\n    }\n\n    // TODO move to graphics systems?\n    this.graphicsContext.backgroundColor = this.backgroundColor;\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    // TODO don't access ctx directly\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    this._postdraw(ctx, delta);\n\n    // Flush any pending drawings\n    this.graphicsContext.flush();\n    this.graphicsContext.endDrawLifecycle();\n\n    this._checkForScreenShots();\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Enable or disable Excalibur debugging functionality.\n   * @param toggle a value that debug drawing will be changed to\n   */\n  public showDebug(toggle: boolean): void {\n    this._isDebug = toggle;\n  }\n\n  /**\n   * Toggle Excalibur debugging functionality.\n   */\n  public toggleDebug(): boolean {\n    this._isDebug = !this._isDebug;\n    return this._isDebug;\n  }\n\n  private _loadingComplete: boolean = false;\n\n  /**\n   * Returns true when loading is totally complete and the player has clicked start\n   */\n  public get loadingComplete() {\n    return this._loadingComplete;\n  }\n\n  private _isReady = false;\n  public get ready() {\n    return this._isReady;\n  }\n  private _isReadyResolve: () => any;\n  private _isReadyPromise = new Promise<void>(resolve => {\n    this._isReadyResolve = resolve;\n  });\n  public isReady(): Promise<void> {\n    return this._isReadyPromise;\n  }\n\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   *\n   * Note: start() only resolves AFTER the user has clicked the play button\n   */\n  public async start(loader?: Loader): Promise<void> {\n    if (!this._compatible) {\n      throw new Error('Excalibur is incompatible with your browser');\n    }\n\n    // Wire loader if we have it\n    if (loader) {\n      // Push the current user entered resolution/viewport\n      this.screen.pushResolutionAndViewport();\n\n      // Configure resolution for loader, it expects resolution === viewport\n      this.screen.resolution = this.screen.viewport;\n      this.screen.applyResolutionAndViewport();\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n    }\n\n    // Start the excalibur clock which drives the mainloop\n    // has started is a slight misnomer, it's really mainloop started\n    this._logger.debug('Starting game clock...');\n    this.browser.resume();\n    this.clock.start();\n    this._logger.debug('Game clock started');\n\n    if (loader) {\n      await this.load(this._loader);\n      this._loadingComplete = true;\n\n      // reset back to previous user resolution/viewport\n      this.screen.popResolutionAndViewport();\n      this.screen.applyResolutionAndViewport();\n    }\n\n    this._loadingComplete = true;\n\n    // Initialize before ready\n    this._overrideInitialize(this);\n\n    this._isReady = true;\n\n    this._isReadyResolve();\n    this.emit('start', new GameStartEvent(this));\n    return this._isReadyPromise;\n  }\n\n  private _mainloop(elapsed: number) {\n    this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\n    const delta = elapsed * this.timescale;\n\n    // reset frame stats (reuse existing instances)\n    const frameId = this.stats.prevFrame.id + 1;\n    this.stats.currFrame.reset();\n    this.stats.currFrame.id = frameId;\n    this.stats.currFrame.delta = delta;\n    this.stats.currFrame.fps = this.clock.fpsSampler.fps;\n    GraphicsDiagnostics.clear();\n\n    const beforeUpdate = this.clock.now();\n    this._update(delta);\n    const afterUpdate = this.clock.now();\n    this._draw(delta);\n    const afterDraw = this.clock.now();\n\n    this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n    this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n    this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\n    this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\n\n    this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\n    this.stats.prevFrame.reset(this.stats.currFrame);\n  }\n\n  /**\n   *\n   * @param game\n   * @param raf\n   * @param nowFn\n   * @deprecated Use [[Clock]] to run the mainloop, will be removed in v0.26.0\n   */\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n    const fpsSampler = new FpsSampler({\n      nowFn,\n      initialFps: game.maxFps === Infinity ? 60 : game.maxFps\n    });\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        fpsSampler.start();\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = now - lastTime || 1; // first frame\n\n        // Constrain fps\n        const fpsInterval = game.maxFps === Number.POSITIVE_INFINITY ? 0 : 1000 / game.maxFps;\n        if (elapsed <= fpsInterval) {\n          return; // too fast 😎 skip this frame\n        }\n\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = fpsSampler.fps;\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        // if fps interval is not a multiple\n        if (fpsInterval > 0) {\n          lastTime = now - (elapsed % fpsInterval);\n        } else {\n          lastTime = now;\n        }\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n        fpsSampler.end();\n        game.stats.prevFrame.reset(game.stats.currFrame);\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this.clock.isRunning()) {\n      this.emit('stop', new GameStopEvent(this));\n      this.browser.pause();\n      this.clock.stop();\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   * @deprecated will be removed in v0.26.0, use isRunning()\n   */\n  public isPaused(): boolean {\n    return !this.clock.isRunning();\n  }\n\n  /**\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\n   */\n  public isRunning() {\n    return this.clock.isRunning();\n  }\n\n\n  private _screenShotRequests: { preserveHiDPIResolution: boolean, resolve: (image: HTMLImageElement) => void }[] = [];\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\n   */\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\n      this._screenShotRequests.push({preserveHiDPIResolution, resolve});\n    });\n    return screenShotPromise;\n  }\n\n  private _checkForScreenShots() {\n    // We must grab the draw buffer before we yield to the browser\n    // the draw buffer is cleared after compositing\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\n    for (const request of this._screenShotRequests) {\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\n      const screenshot = document.createElement('canvas');\n      screenshot.width = finalWidth;\n      screenshot.height = finalHeight;\n      const ctx = screenshot.getContext('2d');\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\n\n      const result = new Image();\n      const raw = screenshot.toDataURL('image/png');\n      result.src = raw;\n      request.resolve(result);\n    }\n    // Reset state\n    this._screenShotRequests.length = 0;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public async load(loader: Loadable<any>): Promise<void> {\n    try {\n      await loader.load();\n    } catch {\n      await Promise.resolve();\n    }\n  }\n}\n\n/**\n * @internal\n * @deprecated\n */\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: WebAudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n\nexport class NativeSoundProcessedEvent extends MediaEvent {\n  public data: string | AudioBuffer;\n\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\n    super(target, 'NativeSoundProcessedEvent');\n\n    this.data = this._processedData;\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Color';\nimport { vec, Vector } from './Math/vector';\nimport { Text } from './Graphics/Text';\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\nimport { obsolete } from './Util/Decorators';\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\nimport { Font } from './Graphics/Font';\nimport { Actor } from './Actor';\nimport { ActorArgs } from '.';\n\n/**\n * Option for creating a label\n */\nexport interface LabelOptions {\n  /**\n   * Specify the label text\n   */\n  text?: string;\n  /**\n   * Specify the color of the text (does not apply to SpriteFonts)\n   */\n  color?: Color;\n  x?: number;\n  y?: number;\n  pos?: Vector;\n  /**\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\n   */\n  spriteFont?: SpriteFont | LegacySpriteFont;\n  /**\n   * Specify a custom font\n   */\n  font?: Font\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n */\nexport class Label extends Actor {\n  private _font: Font = new Font();\n  private _text: Text = new Text({ text: '', font: this._font });\n\n  public get font(): Font {\n    return this._font;\n  }\n\n  public set font(newFont: Font) {\n    this._font = newFont;\n    this._text.font = newFont;\n  }\n\n  /**\n   * The text to draw.\n   */\n  public get text(): string {\n    return this._text.text;\n  }\n\n  public set text(text: string) {\n    this._text.text = text;\n  }\n\n  public override get color(): Color {\n    return this._text.color;\n  }\n\n  public override set color(color: Color) {\n    if (this._text) {\n      this._text.color = color;\n    }\n  }\n\n  public get opacity(): number {\n    return this._text.opacity;\n  }\n\n  public set opacity(opacity: number) {\n    this._text.opacity = opacity;\n  }\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   * @deprecated Use [[Font.bold|Label.font.bold]]\n   */\n  @obsolete({\n    message: 'Label.bold will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.bold'\n  })\n  public get bold(): boolean {\n    return this.font.bold;\n  }\n\n  public set bold(isBold: boolean) {\n    this.font.bold = isBold;\n  }\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   * @deprecated Use [[Font.family|Label.font.family]]\n   */\n  @obsolete({\n    message: 'Label.fontFamily will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.family'\n  })\n  public get fontFamily(): string {\n    return this.font.family;\n  }\n\n  public set fontFamily(family: string) {\n    this.font.family = family;\n  }\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   * @deprecated Use [[Font.size|Label.font.size]]\n   */\n  @obsolete({\n    message: 'Label.fontSize will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.size'\n  })\n  public get fontSize(): number {\n    return this.font.size;\n  }\n\n  public set fontSize(sizeInUnit: number) {\n    this.font.size = sizeInUnit;\n  }\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   * @deprecated Use [[Font.style|Label.font.style]]\n   */\n  @obsolete({\n    message: 'Label.fontStyle will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.style'\n  })\n  public get fontStyle(): FontStyle {\n    return this.font.style;\n  }\n\n  public set fontStyle(style: FontStyle) {\n    this.font.style = style;\n  }\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   * @deprecated Use [[Font.unit|Label.font.unit]]\n   */\n  @obsolete({\n    message: 'Label.fontUnit will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.unit'\n  })\n  public get fontUnit(): FontUnit {\n    return this.font.unit;\n  }\n\n  public set fontUnit(unit: FontUnit) {\n    this.font.unit = unit;\n  }\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\n   */\n  @obsolete({\n    message: 'Label.textAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.textAlign'\n  })\n  public get textAlign(): TextAlign {\n    return this.font.textAlign;\n  }\n\n  public set textAlign(align: TextAlign) {\n    this.font.textAlign = align;\n  }\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\n   */\n  @obsolete({\n    message: 'Label.baseAlign will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.baseAlign'\n  })\n  public get baseAlign(): BaseAlign {\n    return this.font.baseAlign;\n  }\n\n  public set baseAlign(align: BaseAlign) {\n    this.font.baseAlign = align;\n  }\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   * @deprecated The maxWidth constraint is gone\n   */\n  public maxWidth: number;\n\n  private _legacySpriteFont: LegacySpriteFont;\n  private _spriteFont: SpriteFont;\n  /**\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   * @deprecated Use [[SpriteFont]]\n   */\n  public get spriteFont(): LegacySpriteFont {\n    return this._legacySpriteFont;\n  }\n\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\n    if (sf) {\n      if (sf instanceof LegacySpriteFont) {\n        this._legacySpriteFont = sf;\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\n        this._text.font = this._spriteFont;\n        return;\n      }\n      this._spriteFont = sf;\n      this._text.font = this._spriteFont;\n    }\n  }\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   * @deprecated Use [[SpriteFont.spacing]]\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   * @deprecated Use Graphics.SpriteFont.caseInsensitive\n   */\n  public caseInsensitive: boolean = true;\n\n  private _graphicsContext: ExcaliburGraphicsContext;\n\n  /**\n   * Build a new label\n   * @param options\n   */\n  constructor(options?: LabelOptions & ActorArgs) {\n    super(options);\n    const {text, pos, x, y, spriteFont, font, color} = options;\n\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\n    this.text = text ?? this.text;\n    this.font = font ?? this.font;\n    this.spriteFont = spriteFont ?? this.spriteFont;\n    this._text.color = color ?? this.color;\n    const gfx = this.get(GraphicsComponent);\n    gfx.anchor = Vector.Zero;\n    gfx.use(this._text);\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    this._graphicsContext = engine.graphicsContext;\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   */\n  public getTextWidth(): number {\n    return this._text.width;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.setTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.useTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public useTextShadow(on: boolean) {\n    if (this.spriteFont) {\n      this.spriteFont.useTextShadow(on);\n    }\n  }\n\n  /**\n   * Clears the current text shadow\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\n   */\n  @obsolete({\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\n    alternateMethod: 'Use Label.font.shadow'\n  })\n  public clearTextShadow() {\n    this.font.shadow = null;\n  }\n\n  /**\n   * @deprecated signature will change in v0.26.0\n   * @param _ctx\n   * @param _delta\n   */\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    const exctx = this._graphicsContext;\n    this._text.draw(exctx, 0, 0);\n  }\n}\n","import { BodyComponent, BoundingBox, Collider, ColliderComponent, CollisionType, Color, CompositeCollider, vec, Vector } from '..';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\nimport { Entity } from '../EntityComponentSystem/Entity';\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\n\nexport class IsometricTile extends Entity {\n  /**\n   * Indicates whether this tile is solid\n   */\n  public solid: boolean = false;\n\n  private _gfx: GraphicsComponent;\n  private _tileBounds = new BoundingBox();\n  private _graphics: Graphic[] = [];\n  public getGraphics(): readonly Graphic[] {\n    return this._graphics;\n  }\n  /**\n   * Tile graphics\n   */\n  public addGraphic(graphic: Graphic) {\n    this._graphics.push(graphic);\n    this._gfx.visible = true;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  private _recalculateBounds(): BoundingBox {\n    let bounds = this._tileBounds.clone();\n    for (const graphic of this._graphics) {\n      const offset = vec(\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\n    }\n    return bounds;\n  }\n\n  public removeGraphic(graphic: Graphic) {\n    const index = this._graphics.indexOf(graphic);\n    if (index > -1) {\n      this._graphics.splice(index, 1);\n    }\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  public clearGraphics() {\n    this._graphics.length = 0;\n    this._gfx.visible = false;\n    this._gfx.localBounds = this._recalculateBounds();\n  }\n\n  /**\n   * Tile colliders\n   */\n  private _colliders: Collider[] = [];\n  public getColliders(): readonly Collider[] {\n    return this._colliders;\n  }\n\n  /**\n   * Adds a collider to the IsometricTile\n   *\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\n   * @param collider\n   */\n  public addCollider(collider: Collider) {\n    this._colliders.push(collider);\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Removes a collider from the IsometricTile\n   * @param collider\n   */\n  public removeCollider(collider: Collider) {\n    const index = this._colliders.indexOf(collider);\n    if (index > -1) {\n      this._colliders.splice(index, 1);\n    }\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Clears all colliders from the IsometricTile\n   */\n  public clearColliders(): void {\n    this._colliders.length = 0;\n    this.map.flagCollidersDirty();\n  }\n\n  /**\n   * Integer tile x coordinate\n   */\n  public readonly x: number;\n  /**\n   * Integer tile y coordinate\n   */\n  public readonly y: number;\n  /**\n   * Reference to the [[IsometricMap]] this tile is part of\n   */\n  public readonly map: IsometricMap;\n\n  private _transform: TransformComponent;\n  private _isometricEntityComponent: IsometricEntityComponent;\n\n  /**\n   * Returns the top left corner of the [[IsometricTile]] in world space\n   */\n  public get pos(): Vector {\n    return this.map.tileToWorld(vec(this.x, this.y));\n  }\n\n  /**\n   * Returns the center of the [[IsometricTile]]\n   */\n  public get center(): Vector {\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\n  }\n\n  /**\n   * Construct a new IsometricTile\n   * @param x tile coordinate in x (not world position)\n   * @param y tile coordinate in y (not world position)\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\n   * @param map reference to owning IsometricMap\n   */\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\n    super([\n      new TransformComponent(),\n      new GraphicsComponent({\n        offset: graphicsOffset ?? Vector.Zero,\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\n      }),\n      new IsometricEntityComponent(map)\n    ]);\n    this.x = x;\n    this.y = y;\n    this.map = map;\n    this._transform = this.get(TransformComponent);\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\n\n    const halfTileWidth = this.map.tileWidth / 2;\n    const halfTileHeight = this.map.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    // The x position shifts left with every y step\n    const xPos = (this.x - this.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (this.x + this.y) * halfTileHeight;\n    this._transform.pos = vec(xPos, yPos);\n    this._isometricEntityComponent.elevation = 0;\n\n    this._gfx = this.get(GraphicsComponent);\n    this._gfx.visible = false; // start not visible\n    const totalWidth = this.map.tileWidth;\n    const totalHeight = this.map.tileHeight;\n\n    // initial guess at gfx bounds based on the tile\n    const offset = vec(0, (this.map.renderFromTopOfGraphic ? totalHeight : 0));\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\n      left: -totalWidth / 2,\n      top: -totalHeight,\n      right: totalWidth / 2,\n      bottom: totalHeight\n    }).translate(offset);\n  }\n\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\n    const halfTileWidth = this.map.tileWidth / 2;\n    gfx.save();\n    // shift left origin to corner of map, not the left corner of the first sprite\n    gfx.translate(-halfTileWidth, 0);\n    for (const graphic of this._graphics) {\n      graphic.draw(\n        gfx,\n        this.map.graphicsOffset.x,\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\n    }\n    gfx.restore();\n  }\n}\n\nexport interface IsometricMapOptions {\n  /**\n   * Optionally name the isometric tile map\n   */\n  name?: string;\n  /**\n   * Optionally specify the position of the isometric tile map\n   */\n  pos?: Vector;\n  /**\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\n   */\n  renderFromTopOfGraphic?: boolean;\n  /**\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\n   */\n  graphicsOffset?: Vector;\n  /**\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\n   */\n  tileWidth: number;\n  /**\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\n   */\n  tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  width: number;\n  /**\n   * Number of tiles high\n   */\n  height: number;\n}\n\n/**\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\n *\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\n *\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\n * your art assets.\n */\nexport class IsometricMap extends Entity {\n  /**\n   * Width of individual tile in pixels\n   */\n  public readonly tileWidth: number;\n  /**\n   * Height of individual tile in pixels\n   */\n  public readonly tileHeight: number;\n  /**\n   * Number of tiles wide\n   */\n  public readonly width: number;\n  /**\n   * Number of tiles high\n   */\n  public readonly height: number;\n  /**\n   * List containing all of the tiles in IsometricMap\n   */\n  public readonly tiles: IsometricTile[];\n\n  /**\n   * Render the tile graphic from the top instead of the bottom\n   *\n   * default is `false` meaning rendering from the bottom\n   */\n  public renderFromTopOfGraphic: boolean = false;\n  public graphicsOffset: Vector = vec(0, 0);\n\n  /**\n   * Isometric map [[TransformComponent]]\n   */\n  public transform: TransformComponent;\n\n  /**\n   * Isometric map [[ColliderComponent]]\n   */\n  public collider: ColliderComponent;\n\n  private _composite: CompositeCollider;\n\n  constructor(options: IsometricMapOptions) {\n    super([\n      new TransformComponent(),\n      new BodyComponent({\n        type: CollisionType.Fixed\n      }),\n      new ColliderComponent(),\n      new DebugGraphicsComponent((ctx) => this.debug(ctx), false)\n    ], options.name);\n    const { pos, tileWidth, tileHeight, width, height, renderFromTopOfGraphic, graphicsOffset } = options;\n\n    this.transform = this.get(TransformComponent);\n    if (pos) {\n      this.transform.pos = pos;\n    }\n\n    this.collider = this.get(ColliderComponent);\n    if (this.collider) {\n      this.collider.set(this._composite = new CompositeCollider([]));\n    }\n\n\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\n\n    this.tileWidth = tileWidth;\n    this.tileHeight = tileHeight;\n    this.width = width;\n    this.height = height;\n\n    this.tiles = new Array(width * height);\n\n    // build up tile representation\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\n        this.tiles[x + y * width] = tile;\n        this.addChild(tile);\n        // TODO row/columns helpers\n      }\n    }\n  }\n\n  public update(): void {\n    if (this._collidersDirty) {\n      this.updateColliders();\n      this._collidersDirty = false;\n    }\n  }\n\n  private _collidersDirty = false;\n  public flagCollidersDirty() {\n    this._collidersDirty = true;\n  }\n\n  private _originalOffsets = new WeakMap<Collider, Vector>();\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\n    if (!this._originalOffsets.has(collider)) {\n      const originalOffset = collider.offset;\n      this._originalOffsets.set(collider, originalOffset);\n      return originalOffset;\n    } else {\n      return this._originalOffsets.get(collider);\n    }\n  }\n  public updateColliders() {\n    this._composite.clearColliders();\n    for (const tile of this.tiles) {\n      if (tile.solid) {\n        for (const collider of tile.getColliders()) {\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\n            .add(originalOffset)\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\n          collider.owner = this;\n          this._composite.addCollider(collider);\n        }\n      }\n    }\n    this.collider.update();\n  }\n\n  /**\n   * Convert world space coordinates to the tile x, y coordinate\n   * @param worldCoordinate\n   */\n  public worldToTile(worldCoordinate: Vector): Vector {\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\n\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\n    return vec(\n      ~~((worldCoordinate.x / halfTileWidth + (worldCoordinate.y / halfTileHeight)) / 2),\n      ~~((worldCoordinate.y / halfTileHeight - (worldCoordinate.x / halfTileWidth)) / 2));\n  }\n\n  /**\n   * Given a tile coordinate, return the top left corner in world space\n   * @param tileCoordinate\n   */\n  public tileToWorld(tileCoordinate: Vector): Vector {\n    const halfTileWidth = this.tileWidth / 2;\n    const halfTileHeight = this.tileHeight / 2;\n    // The x position shifts left with every y step\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\n    // The y position needs to go down with every x step\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\n    return vec(xPos, yPos).add(this.transform.pos);\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by its x and y coordinates\n   */\n  public getTile(x: number, y: number): IsometricTile | null {\n    if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return null;\n    }\n    return this.tiles[x + y * this.width];\n  }\n\n  /**\n   * Returns the [[IsometricTile]] by testing a point in world coordinates,\n   * returns `null` if no Tile was found.\n   */\n  public getTileByPoint(point: Vector): IsometricTile | null {\n    const tileCoord = this.worldToTile(point);\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\n    return tile;\n  }\n\n  /**\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\n   * @param gfx\n   */\n  public debug(gfx: ExcaliburGraphicsContext) {\n\n    for (let y = 0; y < this.height + 1; y++) {\n      const left = this.tileToWorld(vec(0, y));\n      const right = this.tileToWorld(vec(this.width, y));\n      gfx.drawLine(left, right, Color.Red, 2);\n    }\n\n    for (let x = 0; x < this.width + 1; x++) {\n      const top = this.tileToWorld(vec(x, 0));\n      const bottom = this.tileToWorld(vec(x, this.height));\n      gfx.drawLine(top, bottom, Color.Red, 2);\n    }\n\n    for (const tile of this.tiles) {\n      gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), 3, Color.Yellow);\n    }\n  }\n}","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @deprecated Use [[Polygon]]\n * @warning Use sparingly as Polygons are performance intensive\n */\n@obsolete({\n  message: 'Polygon will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.Polygon'\n})\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = Vector.Zero;\n  public offset = Vector.Zero;\n  public rotation: number = 0;\n  public scale = Vector.One;\n  public opacity: number = 1;\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\n    };\n\n    const xpoint = drawWidth * anchor.x + offset.x + x;\n    const ypoint = drawHeight * anchor.y + offset.y + y;\n\n    ctx.save();\n    ctx.translate(xpoint, ypoint);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity;\n    ctx.stroke();\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n}\n","import { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Engine } from './../Engine';\nimport * as Events from './../Events';\nimport { Scene } from '../Scene';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _initialize {\n  _initialize(engine: Engine): void;\n}\n\n/**\n * Type guard checking for internal initialize method\n * @internal\n * @param a\n */\nexport function has_initialize(a: any): a is _initialize {\n  return !!a._initialize;\n}\n\nexport interface OnInitialize {\n  onInitialize(engine: Engine): void;\n}\n\n/**\n *\n */\nexport function hasOnInitialize(a: any): a is OnInitialize {\n  return !!a.onInitialize;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _preupdate {\n  _preupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_preupdate(a: any): a is _preupdate {\n  return !!a._preupdate;\n}\n\nexport interface OnPreUpdate {\n  onPreUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\n  return !!a.onPreUpdate;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _postupdate {\n  _postupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_postupdate(a: any): a is _postupdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface OnPostUpdate {\n  onPostUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface CanInitialize {\n  /**\n   * Overridable implementation\n   */\n  onInitialize(_engine: Engine): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\n}\n\nexport interface CanActivate {\n  /**\n   * Overridable implementation\n   */\n  onActivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\n}\n\nexport interface CanDeactivate {\n  /**\n   * Overridable implementation\n   */\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\n}\n\nexport interface CanUpdate {\n  /**\n   * Overridable implementation\n   */\n  onPreUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\n}\n\nexport interface OnPreDraw {\n  /**\n   * Overridable implementation\n   */\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n}\n\nexport interface OnPostDraw {\n  /**\n   * Overridable implementation\n   */\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\n/**\n *\n */\nexport function hasPreDraw(a: any): a is OnPreDraw {\n  return !!a.onPreDraw;\n}\n\n/**\n *\n */\nexport function hasPostDraw(a: any): a is OnPostDraw {\n  return !!a.onPostDraw;\n}\n\nexport interface CanBeKilled {\n  /**\n   * Overridable implementation\n   */\n  onPreKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport { clamp } from '../../Math/util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\nexport class WebAudioInstance implements Audio {\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n\n  private _playingPromise: Promise<boolean>;\n  private _playingResolve: (value: boolean) => void;\n\n  private _loop = false;\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    value = clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant transition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public set duration(value: number | undefined) {\n    this._duration = value;\n  }\n\n  /**\n   * Duration of the sound, in seconds.\n   */\n  public get duration() {\n    return this._duration;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  private _isPlaying = false;\n  private _isPaused = false;\n  private _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(private _src: AudioBuffer) {\n    this._createNewBufferSource();\n  }\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public play(playStarted: () => any = () => {}) {\n    if (this._isPaused) {\n      this._resumePlayBack();\n      playStarted();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n      playStarted();\n    }\n\n    return this._playingPromise;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  private _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>((resolve) => {\n      this._playingResolve = resolve;\n    });\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._wireUpOnEnded();\n  }\n\n  private _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  private _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  private _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingResolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { WebAudioInstance } from './WebAudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\nimport { canPlayFile } from '../../Util/Sound';\nimport { Loadable } from '../../Interfaces/Index';\nimport { Logger } from '../../Util/Log';\nimport { Class } from '../../Class';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n */\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\n  public logger: Logger = Logger.getInstance();\n  public data: AudioBuffer;\n  private _resource: Resource<ArrayBuffer>;\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public get duration(): number | undefined {\n    return this._duration;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): Audio[] {\n    return this._tracks;\n  }\n\n  public get path() {\n    return this._resource.path;\n  }\n\n  public set path(val: string) {\n    this._resource.path = val;\n  }\n\n  private _loop = false;\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n  private _isStopped = false;\n  private _isPaused = false;\n  private _tracks: Audio[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super();\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\n    /**\n     * Chrome : MP3, WAV, Ogg\n     * Firefox : WAV, Ogg,\n     * IE : MP3, WAV coming soon\n     * Safari MP3, WAV, Ogg\n     */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  public async load(): Promise<AudioBuffer> {\n    if (this.data) {\n      return this.data;\n    }\n    const arraybuffer = await this._resource.load();\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\n    return this.data = audiobuffer;\n  }\n\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\n    try {\n      return await this._audioContext.decodeAudioData(data.slice(0));\n    } catch (e) {\n      this.logger.error(\n        'Unable to decode ' +\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\n          'if this is an mp3 try removing id3 tags and album art from the file.'\n      );\n      return await Promise.reject();\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n\n      this._engine.on('start', () => {\n        this._isStopped = false;\n      });\n\n      this._engine.on('stop', () => {\n        this.stop();\n        this._isStopped = true;\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    if (this._isStopped) {\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n      return Promise.resolve(false);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n   */\n  public stop() {\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[Audio]] which Id is to be given\n   */\n  public getTrackId(track: Audio): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private async _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed: Promise<boolean>[] = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      await Promise.all(resumed);\n    }\n    return true;\n  }\n\n  /**\n   * Starts playback, returns a promise that resolves when playback is complete\n   */\n  private async _startPlayback(): Promise<boolean> {\n    const track = await this._getTrackInstance(this.data);\n\n    const complete = await track.play(() => {\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    // when done, remove track\n    this.emit('playbackend', new NativeSoundEvent(this, track));\n    this._tracks.splice(this.getTrackId(track), 1);\n\n    return complete;\n  }\n\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\n    const newTrack = new WebAudioInstance(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n    newTrack.duration = this.duration;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n}\n","import { Resource } from './Resource';\nimport { Sprite } from '../Graphics/Sprite';\nimport { Color } from '../Color';\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\nimport { Animation } from '../Graphics/Animation';\nimport { Engine } from '../Engine';\nimport { Loadable } from '../Interfaces/Index';\nimport { ImageSource } from '../Graphics/ImageSource';\nimport { LegacyDrawing } from '..';\nimport { range } from '../Math/util';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n */\nexport class Gif implements Loadable<ImageSource[]> {\n  private _resource: Resource<ArrayBuffer>;\n\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _textures: ImageSource[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n\n  public data: ImageSource[];\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<ImageSource[]> {\n    const arraybuffer = await this._resource.load();\n    this._stream = new Stream(arraybuffer);\n    this._gif = new ParseGif(this._stream, this._transparentColor);\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\n\n    // Load all textures\n    await Promise.all(images.map(t => t.load()));\n    return this.data = this._textures = images;\n  }\n\n  public isLoaded() {\n    return !!this.data;\n  }\n\n  /**\n   * Return a frame of the gif as a legacy sprite by index\n   * @deprecated\n   */\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\n    return Sprite.toLegacySprite(this.toSprite(id));\n  }\n\n  /**\n   * Return the gif as a legacy spritesheet\n   * @deprecated\n   */\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\n  }\n\n  /**\n   * Return the gif as a legacy animation\n   * @deprecated\n   * @param engine\n   * @param speed\n   */\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\n  }\n\n  /**\n   * Return a frame of the gif as a sprite by id\n   * @param id\n   */\n  public toSprite(id: number = 0): Sprite {\n    const sprite = this._textures[id].toSprite();\n    return sprite;\n  }\n\n  /**\n   * Return the gif as a spritesheet\n   */\n  public toSpriteSheet(): SpriteSheet {\n    const sprites: Sprite[] = this._textures.map((image) => {\n      return image.toSprite();\n    });\n    return new SpriteSheet({ sprites });\n  }\n\n  /**\n   * Transform the GIF into an animation with duration per frame\n   */\n  public toAnimation(durationPerFrameMs: number): Animation {\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\n    const length = spriteSheet.sprites.length;\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface GifFrame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function (s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function (minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function (size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function () {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: GifFrame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: GifFrame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","import { ImageFiltering } from '.';\nimport { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n *\n * Polygons default to [[ImageFiltering.Blended]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.filtering = ImageFiltering.Blended;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\n\n/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\nexport class SortedList<T> {\n  private _getComparable: (item: T) => number;\n  private _root: BinaryTreeNode<T>;\n\n  constructor(getComparable: (item: T) => number) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: T): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: T): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\n    if (node != null) {\n      if (this._getComparable(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: T): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (element.getKey() < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<T>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach((element) => {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\nexport class BinaryTreeNode<T> {\n  private _key: number;\n  private _data: Array<T>;\n  private _left: BinaryTreeNode<T>;\n  private _right: BinaryTreeNode<T>;\n\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): T[] {\n    return this._data;\n  }\n\n  public setData(data: T[]) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode<T> {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode<T>) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode<T> {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode<T>) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n * @deprecated Will be removed in v0.26.0\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","import { Logger } from '..';\nexport class Pool<Type> {\n  public totalAllocations = 0;\n  public index = 0;\n  public objects: Type[] = [];\n  private _logger = Logger.getInstance();\n\n  constructor(\n    public builder: (...args: any[]) => Type,\n    public recycler: (instance: Type, ...args: any[]) => Type,\n    public maxObjects: number = 100\n  ) {}\n\n  /**\n   * Use many instances out of the in the context and return all to the pool.\n   *\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\n   * @param context\n   */\n  using(context: (pool: Pool<Type>) => Type[] | void) {\n    const result = context(this);\n    if (result) {\n      return this.done(...result);\n    }\n    return this.done();\n  }\n\n  /**\n   * Use a single instance out of th pool and immediately return it to the pool\n   * @param context\n   */\n  borrow(context: (object: Type) => void) {\n    const object = this.get();\n    context(object);\n    this.index--;\n  }\n\n  /**\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\n   * @param args\n   */\n  get(...args: any[]): Type {\n    if (this.index === this.maxObjects) {\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\n      this.maxObjects = this.maxObjects * 2;\n    }\n\n    if (this.objects[this.index]) {\n      // Pool has an available object already constructed\n      return this.recycler(this.objects[this.index++], ...args);\n    } else {\n      // New allocation\n      this.totalAllocations++;\n      const object = (this.objects[this.index++] = this.builder(...args));\n      return object;\n    }\n  }\n\n  /**\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\n   *\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\n   * to be passed to consumers\n   * @param objects A list of object to separate from the pool\n   */\n  done(...objects: Type[]): Type[];\n  done(): void;\n  done(...objects: Type[]): Type[] | void {\n    // All objects in pool now considered \"free\"\n    this.index = 0;\n    for (const object of objects) {\n      const poolIndex = this.objects.indexOf(object);\n      // Build a new object to take the pool place\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\n      this.totalAllocations++;\n    }\n    return objects;\n  }\n}\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Valid states for a promise to be in\n * @deprecated Will be removed in v0.26.0\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\n/**\n * @deprecated Will be removed in v0.26.0\n */\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\n  alternateMethod: 'Use browser native promises'\n})\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   * @deprecated Use browser native promises\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   * @deprecated Use browser native promises\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   * @deprecated Use browser native promises\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   * @deprecated Use browser native promises\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resolved call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   * @deprecated Use browser native promises\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   * @deprecated Use browser native promises\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   * @deprecated Use browser native promises\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   * @deprecated Use browser native promises\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport const EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\nexport * from './Flags';\nexport * from './Id';\nexport * from './Engine';\nexport * from './Screen';\nexport { Actor, ActorArgs } from './Actor';\nexport * from './Math/Index';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug/index';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport * from './Label';\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Collision/Physics';\nexport * from './Scene';\n\nexport * from './TileMap/index';\n\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './ScreenElement';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\n\n// ex.LegacyDrawing namespace\nimport * as legacyDrawing from './Drawing/Index';\nexport { legacyDrawing as LegacyDrawing };\nexport * from './Interfaces/Index';\nexport * from './Resources/Index';\n\nexport * from './EntityComponentSystem/index';\n\nexport * from './Color';\n\nexport * from './Graphics/index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\nexport { PointerComponent } from './Input/Index';\nexport { PointerSystem } from './Input/PointerSystem';\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Browser';\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Observable';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\nexport * from './Util/Pool';\nexport * from './Util/Fps';\nexport * from './Util/Clock';\nexport * from './Util/WebAudio';\n\n// ex.Deprecated\nexport * from './Promises';\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"93Bqc\")).toString();","import { ImageSource } from \"excalibur\";\n\nimport swordUrl from \"./images/sword.png\";\n\nexport const Resources = {\n    Sword: new ImageSource(swordUrl)\n}","import { Actor, Engine, Scene, vec } from \"excalibur\";\nimport { Resources } from \"./resources\";\n\nexport class Level extends Scene {\n    onInitialize(_engine: Engine): void {\n        const actor = new Actor({\n            pos: vec(100, 100),\n        });\n        actor.graphics.use(Resources.Sword.toSprite());\n        this.add(actor);\n    }\n}","import { DisplayMode, Engine, Loader } from \"excalibur\";\nimport { Level } from \"./level\";\nimport { Resources } from \"./resources\";\n\nexport class Game extends Engine {\n    constructor() {\n        super({\n            canvasElementId: 'game',\n            displayMode: DisplayMode.FitScreen\n        });\n    }\n\n    init() {\n        this.startLevel();\n        const loader = new Loader();\n        for (const resource of Object.values(Resources)) {\n            loader.addResource(resource);\n          }\n        this.start(loader).then(() => {\n            // game start stuff\n        });\n    }\n\n    startLevel = () => {\n        const level = new Level();\n        this.addScene(\"main\", level);\n        this.goToScene(\"main\");\n    }\n}\n\nexport const game = new Game();\n\ngame.init();"],"names":["$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","factory","self","__webpack_require__","entryUnbind","module","exports","path","global","isCallable","tryToString","TypeError","argument","isObject","String","toIndexedObject","toAbsoluteIndex","lengthOfArrayLike","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","index","includes","indexOf","fails","METHOD_NAME","method","call","createProperty","Array","max","Math","start","end","k","fin","undefined","result","n","arraySlice","floor","mergeSort","array","comparefn","middle","insertionSort","merge","element","j","left","right","llength","rlength","lindex","rindex","uncurryThis","toString","stringSlice","slice","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","arguments","tag","key","error","tryGet","callee","hasOwn","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","exceptions","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","toPropertyKey","propertyKey","get","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","bind","hasOwnProperty","NATIVE_BIND","Function","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","fn","aFunction","namespace","aCallable","V","P","func","check","globalThis","window","g","this","toObject","a","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","has","NATIVE_WEAK_MAP","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","isPrototypeOf","USE_SYMBOL_AS_UID","$Symbol","toLength","obj","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","V8_PROTOTYPE_DEFINE_BUG","anObject","$defineProperty","$getOwnPropertyDescriptor","ENUMERABLE","WRITABLE","Attributes","current","propertyIsEnumerableModule","internalObjectKeys","concat","getOwnPropertyNames","push","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","uid","SHARED","IS_PURE","mode","copyright","license","toIntegerOrInfinity","min","integer","IndexedObject","requireObjectCoercible","ceil","number","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","symbolFor","createWellKnownSymbol","withoutSetter","description","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","un$Sort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","v","b","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","sources","mappings","sourcesContent","sourceRoot","__WEBPACK_DEFAULT_EXPORT__","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","stringify","sourceMapping","sourceURLs","__webpack_module_cache__","__webpack_require__1","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","definition","o","e","prop","r","toStringTag","Experiments1","Legacy1","Legacy","LogLevel1","LogLevel","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","createId","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","args","len","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","body","appendChild","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","property","SyntaxError","DecoratedClass","super","Vector","_x","_y","Zero","One","Half","Up","Down","Left","Right","angle","cos","sin","vec","isNaN","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","dot","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","__decorate","Side1","Side","Color","parseInt","parseFloat","hex","h","s","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","c","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","Color_decorate","p","q","t","hue2rgb","getOpposite","side","Top","Bottom","None","fromDirection","direction","directions","directionEnum","Number","MAX_VALUE","maxIndex","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","matFirstColumn","xa","xb","matSecondColumn","ya","yb","matrixPos","getPosition","topLeft","bottomRight","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","contains","combine","other","dimensions","overlaps","totalBoundingBox","intersect","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","frac","sign","clamp","canonicalizeAngle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","randomInRange","randomIntInRange","round","Util_TwoPI","Util_clamp","Util_randomInRange","Util_randomIntInRange","Util_canonicalizeAngle","Util_toDegrees","Util_toRadians","Util_range","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","forEach","fail","delay1","milliseconds","clock","schedule","setTimeout","MatrixLocations1","MatrixLocations","ImageFiltering1","ImageFiltering","EventTypes1","EventTypes","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","toDOMMatrix","DOMMatrix","reset","identity","sx","sy","angleRadians","vectorOrMatrix","dest","resultX","resultY","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","save","restore","StateStack","_states","_currentState","_getDefaultState","_cloneState","watch","change","__isProxy","Proxy","watchAny","Graphic","_ID","_transformStale","showDebug","_flipHorizontal","_flipVertical","_rotation","_scale","_origin","_width","_height","origin","flipHorizontal","flipVertical","rotation","_d","_e","isStale","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","isPowerOfTwo","nextHighestPowerOfTwo","ensurePowerOfTwo","getGlTypeSizeBytes","gl","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","UNSIGNED_BYTE","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","getAttributePointerType","TextureLoader","context","_GL","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","image","_TEXTURE_MAP","filtering","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","Pixel","NEAREST","LINEAR","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","originalSrc","dataset","_LOGGER","Blended","Map","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","_g","bitmapHeight","_h","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperties","execute","load","setLineDash","getLineDash","_options","cache","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","emit","eventName","event","on","off","eventHandlers","once","ev","wire","eventDispatcher","unwire","Resource","responseType","bustCache","logger","events","isLoaded","_cacheBust","uri","request","XMLHttpRequest","open","addEventListener","status","response","statusText","send","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","SpriteEffects_decorate","Invert","Opacity","Colorize","Lighten","fromRGB","Darken","Saturate","Desaturate","Fill","Texture","_sprite","loaded","_loadedResolve","_resource","Sprite_Sprite","async","url","blob","URL","createObjectURL","Image","src","decode","naturalWidth","naturalHeight","asSprite","Configurable","base","assign","props","filter","SpriteImpl","imageOrConfig","offset","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","texture","_initPixelsFromTexture","drawWidth","drawHeight","_loadPixels","_flushTexture","grayscale","addEffect","fill","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","xpoint","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","_j","anchorX","anchorY","oldAlpha","globalAlpha","Sprite_decorate","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","_logger","_filtering","endsWith","_src","setAttribute","toSprite","unload","AnimationImpl","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","Engine","config","_engine","_setAnchor","_setRotation","_setScale","isDone","tick","elapsed","idempotencyToken","_updateValues","skip","frames","animOptions","currSprite","play","playAnimation","Animation_Animation","images","FontUnit1","FontUnit","TextAlign1","TextAlign","BaseAlign1","BaseAlign","FontStyle1","FontStyle","Direction1","Direction","Animation_decorate","SpriteSheet_SpriteSheet","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteFont","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","setTextShadow","offsetX","offsetY","shadowColor","character","useTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet_decorate","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","SpriteFont_SpriteFont","_text","shadow","_alreadyWarnedAlphabet","_alreadyWarnedSpriteSheet","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","measureText","lines","maxWidthLine","reduce","xCursor","yCursor","line","render","bounds","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","RenderSource","_gl","_texture","use","activeTexture","TEXTURE0","disable","RenderTarget","_setupFramebuffer","setResolution","_frameTexture","frameBuffer","_frameBuffer","frameTexture","attachmentPoint","COLOR_ATTACHMENT0","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","toRenderSource","viewport","ExcaliburWebGLContextAccessor","Shader","uniforms","attributes","_compiled","vertexSource","fragmentSource","compiled","useProgram","program","_ACTIVE_SHADER_INSTANCE","isCurrentlyBound","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","normalized","setTexture","slotNumber","setUniformInt","setUniform","setUniformIntArray","setUniformBoolean","setUniformFloat","setUniformFloatArray","setUniformFloatVector","setUniformMatrix","uniformType","createProgram","attachShader","linkProgram","LINK_STATUS","getProgramInfoLog","typeName","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","bindBuffer","ARRAY_BUFFER","upload","STATIC_DRAW","DYNAMIC_DRAW","VertexLayout","_layout","_attributes","_vertexTotalSizeBytes","vertexBuffer","_vertexBuffer","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","uploadBuffer","vert","vertexAttribPointer","enableVertexAttribArray","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","LineRenderer","priority","_maxLines","_vertexIndex","_lineCount","_context","ortho","_isFull","flush","getTransform","finalStart","finalEnd","hasPendingDraws","drawArrays","LINES","PointRenderer","_maxPoints","_pointCount","_buffer","finalPoint","POINTS","ScreenPassPainter","renderWithPostProcessor","postprocessor","getShader","getLayout","TRIANGLES","renderToScreen","QuadIndexBuffer","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","getExtension","Uint32Array","maxUint16","maxUint16Index","bufferGlType","Uint16Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","MAX_TEXTURE_IMAGE_UNITS","transformedFrag","_transformFragmentSource","_quads","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","_bindTextures","_getTextureIdForImage","swidth","sheight","dx","dy","dwidth","dheight","view","sw","sh","snapToPixel","topRight","bottomLeft","textureId","potWidth","potHeight","uvx0","uvy0","uvx1","uvy1","drawElements","RectangleRenderer","_maxRectangles","_rectangleCount","drawLine","drawRectangle","thickness","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","CircleRenderer","_maxCircles","_circleCount","radius","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","lineOptions","drawPoint","pointOptions","drawText","ExcaliburGraphicsContextWebGL","_renderers","_isDrawLifecycle","_postProcessTargets","_postprocessors","_transform","_state","backgroundColor","_alreadyWarnedDrawLifecycle","canvasElement","enableTransparency","__gl","antialias","premultipliedAlpha","alpha","depth","powerPreference","_init","canvas","_ortho","checkIfResolutionSupported","dim","supported","clearColor","COLOR_BUFFER_BIT","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","_screenRenderer","_renderTarget","__ctx","renderer","rendererName","_isCurrentRenderer","_currentRenderer","beginDrawLifecycle","endDrawLifecycle","resetTransform","updateViewport","resolution","drawCircle","addPostProcessor","removePostProcessor","clearPostProcessors","values","DisplayMode1","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","_displayMode","displayMode","Fixed","graphicsContext","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","removeListener","nativeComponent","matchMedia","addListener","dispose","_resizeObserver","disconnect","removeEventListener","isHiDpi","FillContainer","FitContainer","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","imageRendering","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","inverse","worldToScreenCoordinates","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","halfDrawWidth","halfDrawHeight","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","Position","_initializeDisplayModePosition","Window","ResizeObserver","observe","FillScreen","FitScreen","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line1","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","point1","arc","vector1","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle1","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","Loader_0","Z","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","_isLoadedPromise","_isLoadedResolve","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","addResource","loadable","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","hidePlayButton","_a1","removeChild","update","_delta","areResourcesLoaded","all","finally","showPlayButton","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType1","CollisionType","CollisionResolutionStrategy1","CollisionResolutionStrategy","BroadphaseStrategy1","BroadphaseStrategy","Integrator1","Integrator","CoordPlane1","CoordPlane","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","Physics_decorate","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","Component","owner","newComponent","TagComponent","Observable","observers","subscriptions","observer","subscribe","unregister","unsubscribe","notifyAll","notify","cb","TransformComponent","X","Y","createPosView","posChanged$","createScaleView","coordPlane","World","zIndexChanged$","_z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","z","oldPos","oldX","oldY","parentTransform","oldz","globalScaleX","globalScaleY","applyInverse","MotionComponent","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_name","_category","_mask","canCollide","collisionGroups","combinedName","combinedCategory","All","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","group","collisionType","PreventCollision","active","collide","hasCollider","collider","idA","idB","Projection","projection","getOverlap","TreeNode","isLeaf","DynamicTree","worldBounds","root","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","u","getLength","intersectPoint","time","getPoint","DynamicTreeCollisionProcessor","_dynamicCollisionTree","_pairs","Set","_collisionPairCache","_colliders","getColliders","track","CompositeCollider","colliders","untrack","_pairExists","hash","broadphase","targets","seconds","potentialColliders","pair","physics","collider1","Active","updateDistance","minDimension","fastBodies","updateVec","centerPoint","furthestPoint","getFurthestPoint","minCollider","minTranslate","hitPoint","isValid","shift","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","touching","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","maxDistance","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLength","minLine","minPoint","minDistance","project","projs","proj","newProjection","Line","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","PolygonCircleClosestLine","circle","circlex","circley","CircleCircleClosestLine","circleA","circleB","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","CircleCollider","_naturalRadius","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","scalars","dotProduct","newPos","CollisionContact","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","SeparatingAxis","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","circleAPos","circleBPos","combinedRadius","mvt","local","findCirclePolygonSeparation","samedir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clipLeft","xf","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","_isClockwiseWinding","reverse","isConvex","_calculateTransformation","sum","oldPoint","newPoint","oldDirection","orientation","angleSum","entries","tessellate","polygons","Shape","Polygon","triangulate","getItem","isPointInTriangle","ab","bc","ca","ap","bp","cp","cross1","cross2","cross3","triangles","vertices","va","vb","vc","leftArm","isEar","vertIndex","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Circle","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","poly","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom1","DegreeOfFreedom","RotationType1","RotationType","dependencies","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","inverseInertia","motion","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","OffscreenCulling","cullingBox","actorBoundsOffscreen","currentScene","isOffScreen","removeComponent","addComponent","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","Entity","components","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","component","kill","isKilled","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","getComponents","_notifyAddComponent","added","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","child","addTemplate","templateEntity","ctor","constuctorType","componentOrType","_removeComponentByType","delete","processComponentRemoval","isInitialized","_initialize","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","hasGraphicsTick","graphic","GraphicsLayer","_graphics","graphics","hide","nameOrGraphic","gfx","getGraphic","recalculateBounds","show","copyGraphics","getNames","order","currentKeys","GraphicsLayers","_component","_layers","_layerMap","default","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_localBounds","onPreDraw","onPostDraw","layers","graphicToSet","Rectangle","_radius","PointerComponent","useColliderShape","useGraphicsBounds","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","EasingFunctions_decorate","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","isComplete","elapsedMs","Repeat","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","MoveTo","destx","desty","RotateTo","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_method","_hasBeenCalled","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","Fade","endOpacity","_multiplier","_endOpacity","Delay","delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","_queue","easeTo","xOrPos","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","toPromise","Font","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textToBitmap","_bitmapUsage","_o","_p","_q","_r","blur","fontString","_ex","_getTextBitmap","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","_setDimension","textBounds","_getRasterPropertiesHash","textBaseline","font","shadowBlur","shadowOffsetX","shadowOffsetY","_drawText","colorOverride","lineHeight","strokeText","textAndHash","clearCache","checkAndClearCache","isNewBitmap","rasterWidth","rasterHeight","performance","cacheSize","Text","_textWidth","_textHeight","_font","_calculateDimension","Actor","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","_pointerDragLeaveHandler","traits","collisionGroup","defaults","Passive","pointer","actions","thePos","theVel","theAcc","theAngle","isVisible","draggable","isDraggable","currentGraphic","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","Actor_decorate","ScreenElement_ScreenElement","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","_MAX_ID","_callbacks","complete","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Timer_decorate","DebugGraphicsComponent","useTransform","Axis1","Axis","TileMap","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","tiles","_cols","_collidersDirty","_originalOffsets","_composite","flagCollidersDirty","tileWidth","tileHeight","currentCol","cd","Tile","registerSpriteSheet","fromLegacySpriteSheet","_getOrSetColliderOriginalOffset","originalOffset","_updateColliders","tile","solid","prev","getTileByIndex","getTile","getTileByPoint","getRows","getColumns","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","getGraphics","grayish","TileMap_decorate","_posDirty","_solid","_pos","addGraphic","removeGraphic","clearGraphics","_bounds","pushSprite","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","target1","_cam","_eng","target2","cam","currentFocus","getFocus","target3","focus","cameraVel","stretch","target4","target5","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","dz","az","_posChanged","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","_screen","currentRes","loadingComplete","res","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","cameraPos","isScreenElement","triggerDefaults","Trigger_Trigger","opts","_dispatchAction","_target","wp","SystemType1","SystemType","System","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","EntityManager","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","removeEntity","findEntitiesForRemoval","queryManager","addEntity","idOrEntity","deferred","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","buildTypeKey","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","QueryManager","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","maybeExistingQuery","getQuery","SystemManager","systems","initialized","systemType","find","addSystem","system","removeSystem","updateSystems","s3","preupdate","s1","Scene","s2","postupdate","systemManager","Update","entityOrSystem","clearEntities","clearSystems","EulerIntegrator","totalAcc","MotionSystem","optionalBody","integrate","CollisionSolver","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contact1","contactPoints","pointIndex","contact2","constraints","maxCorrection","steeringForce","restitution","impulseDelta","maxFriction","newImpulse","point2","CollisionSystem","_realisticSolver","_arcadeSolver","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","colliderComponent","colliderComp","getSolver","runContactStartEnd","id1","c1","AnimationDirection1","AnimationDirection","AnimationStrategy1","AnimationStrategy","EmitterType1","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","maybeFrame","frameIndices","durationPerFrameMs","invalidIndices","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","done","frameNumber","_nextFrame","PingPong","elapsedMilliseconds","GraphicsGroup","members","_updateDimensions","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","isOffscreen","ParticleEmitter","tmpColor","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","emitParticles","particleCount","_createParticle","world","clearParticles","ranX","ranY","GraphicsSystem","Draw","_sortedTransforms","_zHasChanged","_zIndexUpdate","sortedTransforms","_graphicsContext","entityAddedOrRemoved","_applyTransform","particleOpacity","_drawGraphicsComponent","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","CanvasDrawingSystem","canvasdraw","_clearScreen","offscreen","_pushCameraTransform","_popCameraTransform","drawnImages","drawCalls","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","bodySettings","cameraSettings","useFilter","ids","nameQuery","cursor","showAll","showPosition","positionColor","showPositionLabel","showZIndex","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","collider2","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","point3","collisionNormalColor","showFocus","focusColor","showZoom","PointerSystem","overrideUseColliderShape","overrideUseGraphicsBounds","lastFrameEntityToPointers","currentFrameEntityToPointers","_sortedEntities","_receiver","pointers","entityCurrentlyUnderPointer","pointerId","entityWasUnderPointer","entered","addPointerToEntity","_processPointerToEntity","_dispatchEvents","currentFramePointerCoords","screenPos","graphicBounds","_processDownAndEmit","lastDownPerPointer","currentFrameDown","isDragStart","_processUpAndEmit","lastUpPerPointer","currentFrameUp","isDragEnd","_processMoveAndEmit","lastMovePerPointer","currentFrameMove","isDragging","_processEnterLeaveAndEmit","lastUpDownMoveEvents","_processCancelAndEmit","currentFrameCancel","_processWheelAndEmit","currentFrameWheel","lastFrameEntities","currentFrameEntities","entitiesWithEvents","ActionsSystem","IsometricEntityComponent","elevation","IsometricEntitySystem","iso","OffscreenSystem","entityOffscreen","_isOffscreen","transformedBounds","ColorBlindnessMode1","ColorBlindnessMode","PointerScope1","PointerScope","Keys1","Keys","Buttons1","Buttons","Axes1","Axes","WheelDeltaMode1","WheelDeltaMode","NativePointerButton1","NativePointerButton","PointerButton1","PointerButton","PointerType1","PointerType","_timers","_cancelQueue","triggers","tileMaps","screenElements","timers","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","addTimer","addScreenElement","removeScreenElement","addTileMap","tileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","ui","alive","Scene_decorate","ScreenShader","ColorBlindnessPostProcessor","_colorBlindnessMode","simulate","_simulate","colorBlindnessMode","colorBlindMode","Protanope","Deuteranope","Tritanope","ColorBlindFlags","_colorBlindPostProcessor","correct","colorBlindness","FrameStats","prevFrame","useTestClock","wasRunning","testClock","toTestClock","useStandardClock","currentClock","standardClock","toStandardClock","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","otherStats","fps","fs","_collisions","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","_handleKeyDown","keyEvent","_handleKeyUp","init","noop","getKeys","wasPressed","isHeld","wasReleased","triggerEvent","KeyboardEvent","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","at","timestamp","bi","ai","navigatorGamepad","getButton","pressed","updateButton","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","i1","isButtonPressed","buttonIndex","axesIndex","BrowserComponent","_paused","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","ExcaliburGraphicsContext2DCanvasDebug","ExcaliburGraphicsContext2DCanvas","setTransform","_postprocessor","GlobalCoordinates","pagePos","yOrEngine","engineOrUndefined","pageX","pageY","PointerEvent","pointerType","coordinates","nativeEvent","WheelEvent","screenX","screenY","deltaX","deltaY","deltaZ","deltaMode","PointerAbstraction","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","PointerEventReceiver","primary","_activeNativePointerIdsToNormalized","lastFramePointerCoords","currentFramePointerDown","lastFramePointerDown","_pointers","_boundHandle","_handle","_boundWheel","_handleWheel","isDown","wasDown","event1","event2","event3","event4","native","touchAction","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode1","onmousewheel","detach","_normalizePointerId","nativePointerId","findIndex","preventDefault","eventCoords","TouchEvent","Unknown","Touch","changedTouches","touch","fromPagePosition","_nativeButtonToPointerButton","Mouse","isPointerEvent","_stringToPointerType","ScrollWheelNormalizationFactor","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Page","we","page","clientX","clientY","MouseEvent","pointerSystem","transformEntities","NoButton","Pen","FpsSampler","_samplePeriod","_currentFrameTime","_frames","_previousSampleTime","_beginFrameTime","initialFps","samplePeriod","_nowFn","nowFn","instant","Clock","_onFatalException","_maxFps","_lastTime","_elapsed","_scheduledCbs","_totalElapsed","maxFps","onFatalException","fpsSampler","TestClock","defaultUpdateMs","StandardClock","setFatalExceptionHandler","timeoutMs","scheduledTime","_runScheduledCbs","overrideUpdateMs","fpsInterval","leftover","mainloop","_requestId","_currentTime","_updateMs","step","run","numberOfSteps","ScrollPreventionMode","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","_timescale","_deferredGoTo","_loadingComplete","_isReady","_isReadyPromise","_isReadyResolve","_screenShotRequests","_DEFAULT_ENGINE_OPTIONS","freeze","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","ex2dCtx","exWebglCtx","suppressHiDPIScaling","_mainloop","_loader","rootScene","addScene","___EXCALIBUR_DEVTOOL","isFullscreen","shouldSnapToPixel","timescale","AnimationNode","removeScene","goToScene","scrollPreventionMode","pointerTarget","pointerScope","Document","hidden","visibilityChange","keyboard","_overrideInitialize","_update","_draw","_checkForScreenShots","toggle","toggleDebug","isReady","loader","frameId","beforeUpdate","afterUpdate","afterDraw","game","raf","lastTime","isPaused","screenshot","preserveHiDPIResolution","finalWidth","finalHeight","raw","Engine_decorate","MediaEvent","_value","_path","_val","propagate","layPath","_actor","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","Label_Label","newFont","isBold","fontFamily","sizeInUnit","fontStyle","fontUnit","align","_legacySpriteFont","sf","fromLegacySpriteFont","getTextWidth","clearTextShadow","exctx","Label_decorate","IsometricTile","graphicsOffset","_tileBounds","_isometricEntityComponent","halfTileWidth","halfTileHeight","xPos","yPos","_gfx","totalWidth","totalHeight","renderFromTopOfGraphic","_recalculateBounds","tileToWorld","IsometricMap","updateColliders","worldToTile","worldCoordinate","tileCoordinate","tileCoord","CollisionGroupManager","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","filled","_points","fillColor","lineColor","Polygon_decorate","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","any","json","WebAudioInstance","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","Sound","paths","_isStopped","_tracks","_wasPlayingOnHidden","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","resumed","_getTrackInstance","newTrack","Gif","_stream","_gif","_animation","_transparentColor","Stream","ParseGif","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","readUnsigned","Uint8Array","stream","_st","_handler","globalColorTable","parseColorTable","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block1","parseGCExt","block","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","block2","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","charCodeAt","output","clearCode","eoiCode","codeSize","dict","code1","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","fromRow1","pass","toRow1","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","Polygon_Polygon","SortedList","getComparable","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","SortedList_decorate","_data","_left","_right","MockedElement","getTheKey","Pool","builder","recycler","maxObjects","totalAllocations","objects","using","borrow","poolIndex","PromiseState1","PromiseState","Promises_Promise","Promise_1","Pending","_successCallbacks","_rejectCallback","promises","isArray","_i","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback","Promises_decorate","$e06dc7d24ca8b574$exports","$73991847afc42666$exports","import","meta","$7c4c300842bd4cf2$export$e9a269813a6315a4","Sword","$parcel$interopDefault","$84ab826914df134a$export$ca664994d1d54bff","$ad2bcec7a0192558$export$985739bfa5723e08","startLevel","resource"],"version":3,"file":"index.ff1eaa41.js.map"}